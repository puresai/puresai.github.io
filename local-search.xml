<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>äººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾1</title>
    <link href="/2023/04/25/481/"/>
    <url>/2023/04/25/481/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯æå®¢æ—¶é—´ä¸“æ ã€Šäººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾ã€‹çš„ç¬”è®°ã€‚</p><h2 id="å¦‚ä½•é˜…è¯»å¸®åŠ©å†™ä½œï¼Ÿ"><a href="#å¦‚ä½•é˜…è¯»å¸®åŠ©å†™ä½œï¼Ÿ" class="headerlink" title="å¦‚ä½•é˜…è¯»å¸®åŠ©å†™ä½œï¼Ÿ"></a>å¦‚ä½•é˜…è¯»å¸®åŠ©å†™ä½œï¼Ÿ</h2><blockquote><p>ä¼˜è´¨çš„è¾“å…¥æ˜¯è¾“å‡ºçš„åˆšéœ€</p></blockquote><p>å†™ä½œæ˜¯å»ºç«‹åœ¨é˜…è¯»é‡çš„åŸºç¡€ä¸Šçš„ï¼Œä¸€å®šè¦å¤šçœ‹ã€‚</p><h3 id="è¯»ä»€ä¹ˆï¼Ÿ"><a href="#è¯»ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¯»ä»€ä¹ˆï¼Ÿ"></a>è¯»ä»€ä¹ˆï¼Ÿ</h3><p>é˜…è¯»æ ‘ï¼š</p><ol><li>æ ¹ â€“ ç»å…¸ä½œå“ â€“ é¡ºåºæ˜¯å…ˆè¯»åŸºæœ¬åŸç†ï¼Œå†è¯»é€šå²ã€‚ï¼ˆä¸å±€é™ç‰¹å®šé¢†åŸŸï¼‰</li><li>æå¹² â€“ æœŸåˆŠã€è¡Œä¸šæ–°é—»ã€åˆ†ææŠ¥å‘Šã€æ”¿åºœå‘å¸ƒçš„ä¿¡æ¯ç­‰</li><li>å¶ â€“ è‡ªåª’ä½“ã€ç¤¾åª’</li></ol><h3 id="æ€ä¹ˆè¯»ï¼Ÿ"><a href="#æ€ä¹ˆè¯»ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè¯»ï¼Ÿ"></a>æ€ä¹ˆè¯»ï¼Ÿ</h3><p>åŒºåˆ†å¼é˜…è¯»ï¼š</p><ol><li>æ·±åº¦é˜…è¯» â€“ ç»å…¸</li><li>æ³›è¯» </li></ol><p>æç‚¼è§‚ç‚¹ï¼š</p><ol><li>ç†è§£è§‚ç‚¹ï¼ˆè¾¹è¯»è¾¹åˆ’é‡ç‚¹ï¼‰</li><li>å‰”é™¤é—®é¢˜</li></ol><p>å­¦ä¼šè”æƒ³</p><ol><li>è¿‡å»è¯»è¿‡çš„</li><li>è‡ªå·±æ›¾ç»çš„ä½“éªŒï¼Œæ„Ÿæ‚Ÿ</li><li>æ­£åœ¨å‘ç”Ÿçš„äº‹</li></ol><p>éšæ—¶è®°å½•</p><ol><li>æœ‰ç« æ³•ï¼ˆåˆ†ç±»ï¼šè§‚ç‚¹ã€è¡¨ç°æ‰‹æ³•ã€è‡ªæˆ‘æ„Ÿæƒ³ï¼‰</li><li>è®°å½•çµæ„Ÿ</li></ol><hr><h2 id="å¥½æ–‡ç« çš„æ ‡å¿—"><a href="#å¥½æ–‡ç« çš„æ ‡å¿—" class="headerlink" title="å¥½æ–‡ç« çš„æ ‡å¿—"></a>å¥½æ–‡ç« çš„æ ‡å¿—</h2><ol><li>è¡Œæ–‡èŠ‚å¥ï¼šç®€å•å³ç¾</li><li>æ–‡å­—è¡¨è¿°ï¼šç¡®ä¿å‡†ç¡®ï¼Œå†çœ‹è¯è—»</li><li>ä¸»é¢˜åˆ»ç”»ï¼šé²œæ˜ä¸å¦ï¼Œçªå‡ºä¸å¦</li></ol><blockquote><p>â€œä»¥æ­£åˆâ€ â€“ ç”¨è¯»è€…ç†Ÿæ‚‰çš„è§£è¯»æ–¹å¼ã€ç†Ÿæ‚‰çš„æ„è±¡å»è®²ä½ çš„ä¸»é¢˜ï¼Œ<br>â€œä»¥å¥‡èƒœâ€ â€“ å¼ºè°ƒä½œè€…è‡ªå·±çš„æ€è€ƒï¼Œåˆ©ç”¨ä½ çš„ç‹¬ç‰¹è§‚å¯Ÿåˆ›é€ æ€§åœ°å»è§£é‡Šè¯»è€…æ²¡æœ‰æ³¨æ„åˆ°çš„ä¸œè¥¿ã€‚</p></blockquote><hr><h2 id="å†™ä½œè¯¯åŒº"><a href="#å†™ä½œè¯¯åŒº" class="headerlink" title="å†™ä½œè¯¯åŒº"></a>å†™ä½œè¯¯åŒº</h2><blockquote><p>åœ¨å…‹æœæ¶ä¹ ä¸Šï¼Œè¿Ÿåˆ°æ€»æ¯”ä¸åšå¼ºã€‚</p></blockquote><h3 id="æ»¥ç”¨å½¢å®¹è¯å’Œè¿è¯"><a href="#æ»¥ç”¨å½¢å®¹è¯å’Œè¿è¯" class="headerlink" title="æ»¥ç”¨å½¢å®¹è¯å’Œè¿è¯"></a>æ»¥ç”¨å½¢å®¹è¯å’Œè¿è¯</h3><ul><li>æ»¥ç”¨ä¸ä»…æŒ‡ä½¿ç”¨å½¢å®¹è¯ä¸å‡†ç¡®ï¼Œè¿˜æœ‰å †ç Œå½¢å®¹è¯</li><li>ä¸æ»¥ç”¨ï¼Œä¸æ˜¯ä¸ç”¨ï¼Œè€Œæ˜¯ç”¨ç²¾å½“</li><li>æƒ³ä¸å‡ºæ¥ç²¾å‡†çš„å½¢å®¹è¯å°±ä¸è¦ç”¨</li><li>è¿è¯ç”¨å¾—è¿‡å¤šï¼Œä¼šå½±å“å¥å­çš„èŠ‚å¥å’Œç¾æ„Ÿ</li><li>é™¤éé€»è¾‘è¡¨è¾¾å®¹æ˜“æ··æ·†ï¼Œå¦åˆ™ï¼Œæ…ç”¨è¿è¯</li></ul><h3 id="ä¸­è¥¿æ–‡åŒ–"><a href="#ä¸­è¥¿æ–‡åŒ–" class="headerlink" title="ä¸­è¥¿æ–‡åŒ–"></a>ä¸­è¥¿æ–‡åŒ–</h3><ul><li>æ»¥ç”¨è¢«å­—å¥ï¼ˆä¸­æ–‡çš„æ­£å¸¸è¡¨è¾¾ï¼Œæ˜¯ä¸»è¯­ + åŠ¨è¯ + åè¯ï¼Œè¦æ”¹å˜å¥å¼é¡ºåºï¼Œä¸€å®šè¦æœ‰ç‰¹åˆ«çš„åŸå› ã€‚ï¼‰</li><li>å–œæ¬¢ç”¨å¼±åŠ¨è¯ï¼Œæ¯”å¦‚ï¼šé€ æˆã€è¿›è¡Œ æ­¤ç±»åŠ¨è¯</li><li>å–œæ¬¢ç”¨ä»å¥</li></ul><h3 id="éšæ„å †ç Œæ®µè½"><a href="#éšæ„å †ç Œæ®µè½" class="headerlink" title="éšæ„å †ç Œæ®µè½"></a>éšæ„å †ç Œæ®µè½</h3><h3 id="ç¼ºä¹é€»è¾‘æ€ç»´"><a href="#ç¼ºä¹é€»è¾‘æ€ç»´" class="headerlink" title="ç¼ºä¹é€»è¾‘æ€ç»´"></a>ç¼ºä¹é€»è¾‘æ€ç»´</h3><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><blockquote><p>å†™ä½œçš„ç¬¬ä¸€è¦åŠ¡å°±æ˜¯è¦æ¸…æ¥šçš„è¡¨è¾¾ä¿¡æ¯</p></blockquote><p>ä¿¡æ¯åˆ†ä¸‰ç±»ï¼š</p><ul><li>è®°è¿°ä¿¡æ¯ï¼šç”¨äºæè¿°äº‹ç‰©çš„æƒ…å†µå’Œç°è±¡ä¿¡æ¯</li><li>è¯„ä»·ä¿¡æ¯ï¼šä»·å€¼åˆ¤æ–­</li><li>è§„èŒƒä¿¡æ¯ï¼šäº‹ç‰©åº”è¯¥æœ‰çš„çŠ¶æ€ä»¥åŠäººè¯¥é‡‡å–çš„è¡ŒåŠ¨<br>æˆ‘ä»¬è¦æ ¹æ®ä¸åŒçš„æ–‡æœ¬ï¼Œä½¿ç”¨ä¸åŒçš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œå¯¹ä¸“ä¸šè®ºæ–‡æ¥è®²ï¼Œå¤šç”¨è®°è¿°ä¿¡æ¯ï¼Œå› ä¸º<br>å‡†ç¡®ï¼›å¯¹ç§‘æ™®æ–‡ç« ï¼Œå°±è¦å¤šç”¨äº›è¯„ä»·ä¿¡æ¯ï¼Œæ–¹ä¾¿ç†è§£ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>reading</category>
      
    </categories>
    
    
    <tags>
      
      <tag>reading</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>excelè®¡ç®—ç©ºç™½æ•°é‡</title>
    <link href="/2023/04/09/480/"/>
    <url>/2023/04/09/480/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ç»å¸¸ä½¿ç”¨ excel åšä¸€äº›ç»Ÿè®¡ï¼Œå¤‡æ³¨ä¸€ä¸‹ã€‚</p><h3 id="ç»Ÿè®¡æŸåˆ—ä¸ä¸ºç©ºæ•°é‡"><a href="#ç»Ÿè®¡æŸåˆ—ä¸ä¸ºç©ºæ•°é‡" class="headerlink" title="ç»Ÿè®¡æŸåˆ—ä¸ä¸ºç©ºæ•°é‡"></a>ç»Ÿè®¡æŸåˆ—ä¸ä¸ºç©ºæ•°é‡</h3><div class="code-wrapper"><pre><code class="hljs excel">=<span class="hljs-built_in">COUNTA</span>(<span class="hljs-symbol">O2</span>:<span class="hljs-symbol">O1657</span>)=<span class="hljs-built_in">COUNTA</span>(<span class="hljs-symbol">Q2</span>:<span class="hljs-symbol">Q1657</span>)</code></pre></div><h3 id="ç»Ÿè®¡æŸåˆ—ä¸ºç©ºæ•°é‡"><a href="#ç»Ÿè®¡æŸåˆ—ä¸ºç©ºæ•°é‡" class="headerlink" title="ç»Ÿè®¡æŸåˆ—ä¸ºç©ºæ•°é‡"></a>ç»Ÿè®¡æŸåˆ—ä¸ºç©ºæ•°é‡</h3><div class="code-wrapper"><pre><code class="hljs excel">=<span class="hljs-built_in">COUNTBLANK</span>(<span class="hljs-symbol">J2</span>:<span class="hljs-symbol">J3319</span>)</code></pre></div><h3 id="ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡"><a href="#ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡" class="headerlink" title="ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡"></a>ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡</h3><div class="code-wrapper"><pre><code class="hljs excel">=<span class="hljs-built_in">COUNTIFS</span>(<span class="hljs-symbol">M2</span>:<span class="hljs-symbol">M12095</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-symbol">O2</span>:<span class="hljs-symbol">O12095</span>,<span class="hljs-string">&quot;&quot;</span>)=<span class="hljs-built_in">COUNTIFS</span>(<span class="hljs-symbol">O2</span>:<span class="hljs-symbol">O1657</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-symbol">Q2</span>:<span class="hljs-symbol">Q1657</span>,<span class="hljs-string">&quot;&quot;</span>)</code></pre></div><h3 id="ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡-1"><a href="#ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡-1" class="headerlink" title="ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡"></a>ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡</h3><p>æ€»è¡Œæ•°å‡å»ä¸Šé¢çš„</p>]]></content>
    
    
    <categories>
      
      <category>office</category>
      
    </categories>
    
    
    <tags>
      
      <tag>office</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLçš„exists</title>
    <link href="/2023/02/13/473/"/>
    <url>/2023/02/13/473/</url>
    
    <content type="html"><![CDATA[<p>ç›¸è¾ƒäº inï¼Œexists å…¶å®æ²¡æœ‰ç‰¹åˆ«é«˜é¢‘çš„ä½¿ç”¨ã€‚exists è¯­å¥å¹¶ä¸é‚£ä¹ˆå®¹æ˜“è¯»ã€‚ä»Šå¤©æˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹:</p><h3 id="mock-data"><a href="#mock-data" class="headerlink" title="mock data"></a>mock data</h3><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `users` (  `id` <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `status` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `user_logs` (  `id` <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,  `user_id` <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `content` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `created_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci;</code></pre></div><p>æ’å…¥æµ‹è¯•æ•°æ®:</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;sai&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;os&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;jack&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;kai&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;tom&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;peter&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;li&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;bob&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">9</span>, <span class="hljs-string">&#x27;wuliuqi&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `users`(id, name) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;awesome&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;create post&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;delete post: 1&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;delete post: 55&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;delete post: 23&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;delete post:34&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;delete post:40&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;add post&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;delete post:99&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_logs`(user_id, content) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;delete post:140&#x27;</span>);</code></pre></div><h3 id="åˆ¤æ–­æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­æ˜¯å¦å­˜åœ¨</h3><p>æˆ‘ä»¬ä½¿ç”¨ exists åˆ¤æ–­æŸæ¡è®°å½•æ˜¯å¦å­˜åœ¨:</p><div class="code-wrapper"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">exists</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `users` <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>);<span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><span class="hljs-operator">|</span> <span class="hljs-keyword">exists</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `users` <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>) <span class="hljs-operator">|</span><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><span class="hljs-operator">|</span>                                           <span class="hljs-number">1</span> <span class="hljs-operator">|</span><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+</span><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">exists</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `users` <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">13</span>);<span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------+</span><span class="hljs-operator">|</span> <span class="hljs-keyword">exists</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> `users` <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">13</span>) <span class="hljs-operator">|</span><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------+</span><span class="hljs-operator">|</span>                                            <span class="hljs-number">0</span> <span class="hljs-operator">|</span><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------+</span><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)</code></pre></div><h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><p>exists æ›´å¤šç”¨äºå­æŸ¥è¯¢:</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `user_logs` <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span> (    <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `users` <span class="hljs-keyword">WHERE</span> `users`.id <span class="hljs-operator">=</span> `user_logs`.user_id <span class="hljs-keyword">and</span> `users`.id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>);</code></pre></div><p>ä½ çŸ¥é“ä¼šè¾“å‡ºä»€ä¹ˆå—?</p><p>å½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªè¯­å¥æ—¶æ˜¯è¿™ä¹ˆç†è§£çš„, where åé¢çš„æ˜¯1ï¼Œæ‰€ä»¥ä¼šåˆ—å‡ºæ‰€æœ‰çš„ <code>user_logs</code> ã€‚</p><p>æ˜¾ç„¶æˆ‘çš„ç†è§£æ˜¯:</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `user_logs` <span class="hljs-keyword">WHERE</span> <span class="hljs-number">1</span>;</code></pre></div><p>ä½†è¾“å‡ºæ‰“è„¸äº† ğŸ˜¢</p><div class="code-wrapper"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>---------<span class="hljs-code">+-----------------+</span>---------------------+<span class="hljs-section">| id | user_id | content         | created_at          |</span><span class="hljs-section">+----+---------+-----------------+---------------------+</span>|  1 |       1 | create post     | 2023-02-14 08:54:59 ||  2 |       1 | delete post: 1  | 2023-02-14 08:54:59 |<span class="hljs-section">|  3 |       1 | delete post: 55 | 2023-02-14 08:54:59 |</span><span class="hljs-section">+----+---------+-----------------+---------------------+</span>3 rows in set (0.00 sec)</code></pre></div><p>å…¶å®ä¸Šé¢çš„è¯­å¥ä¸ä¸‹é¢çš„è¯­å¥ç»“æœä¸€è‡´çš„ã€‚</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `user_logs` <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">in</span> (    <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> `users` <span class="hljs-keyword">WHERE</span> `users`.id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>);</code></pre></div><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> `user_logs`.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `user_logs` <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> `users` <span class="hljs-keyword">ON</span> `users`.id <span class="hljs-operator">=</span> `user_logs`.user_id <span class="hljs-keyword">WHERE</span> `users`.id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;</code></pre></div><h3 id="in-è¿˜æ˜¯-exists"><a href="#in-è¿˜æ˜¯-exists" class="headerlink" title="in è¿˜æ˜¯ exists"></a>in è¿˜æ˜¯ exists</h3><p>å¯¹äºå¾ˆå¤šåšå®¢ä¸­æåˆ°çš„ <code>in é€‚åˆäºå¤–è¡¨å¤§è€Œå­æŸ¥è¯¢è¡¨å°çš„æƒ…å†µï¼Œexists é€‚åˆäºå¤–è¡¨å°è€Œå­æŸ¥è¯¢è¡¨å¤§çš„æƒ…å†µ</code>ï¼Œå…¶å®å¹¶ä¸å‡†ç¡®ã€‚MySQL æ‰‹å†Œä¸­æåˆ°ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ materialization ï¼Œä¼˜åŒ–å™¨åˆæ˜¯ä¼šé‡å†™æŸ¥è¯¢ï¼Œå³å¯èƒ½ä¼šå°† in è½¬æˆ existsã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µæ€§èƒ½å…¶å®æ˜¯æ²¡ä»€ä¹ˆå·®åˆ«çš„ã€‚ä½†æ˜¯ç»™å¤§è¡¨åŠ ç´¢å¼•ä¸€èˆ¬æ˜¯æœ‰æ•ˆçš„ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/subquery-materialization.html">Optimizing Subqueries with Materialization</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis hyperloglogè¯¯åˆ¤</title>
    <link href="/2023/02/05/472/"/>
    <url>/2023/02/05/472/</url>
    
    <content type="html"><![CDATA[<p>HyperLogLog æ˜¯ Redis çš„ä¸€ç§æ•°æ®ç±»å‹ã€‚åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸº æ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚HyperLogLog çš„å…¸å‹åº”ç”¨åœºæ™¯å°±æ˜¯è®¡ç®— uvã€‚</p><p>ä½†æ˜¯ HyperLogLog æ˜¯å­˜åœ¨è¯¯åˆ¤çš„ï¼Œå®˜æ–¹ä»‹ç»å…¶æ ‡å‡†è¯¯å·®ä¸º0.81%ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³ç²¾ç¡®çš„ç»Ÿè®¡ uvï¼Œä»…ä»…ä½¿ç”¨ HyperLogLog æ˜¯ä¸å¤Ÿçš„ã€‚</p><p>æˆ‘ä»¬ä¸å¦¨æµ‹è¯•ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> Redis<span class="hljs-keyword">import</span> hashlib<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):</span>    <span class="hljs-keyword">return</span> hashlib.md5(text.encode()).hexdigest()Redis_conn = Redis.Redis(host=<span class="hljs-string">&quot;localhost&quot;</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">0</span>)Redis_conn.auth(<span class="hljs-string">&quot;123456&quot;</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):    <span class="hljs-keyword">if</span> Redis_conn.pfadd(<span class="hljs-string">&quot;hyperloglog-test&quot;</span>, md5(<span class="hljs-built_in">str</span>(i))) == <span class="hljs-number">0</span>:        <span class="hljs-built_in">print</span>(i)</code></pre></div><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs shell">âœ  user-sai git:(main) âœ— python3 codesnippets/python/hyperloglog.py193294406527579588616688706764770846872876880888941975984991</code></pre></div><p>å¯ä»¥çœ‹åˆ°æ˜¯æœ‰ä¸€äº›è¯¯åˆ¤çš„ã€‚</p><p>å› è€Œï¼Œå¦‚æœéœ€è¦å¾ˆç²¾ç¡®åœ°åšç±»ä¼¼å»é‡è®¡æ•°ä»»åŠ¡ï¼Œ HyperLogLog å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆï¼Œå³ä¾¿ HyperLogLog åˆå¿«åˆèŠ‚çœå†…å­˜ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="http://antirez.com/news/75">Redis new data structure: the HyperLogLog</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonå¦‚ä½•è·³å‡ºå¤šå±‚å¾ªç¯</title>
    <link href="/2023/01/13/471/"/>
    <url>/2023/01/13/471/</url>
    
    <content type="html"><![CDATA[<p>php break åé¢æ˜¯å¯ä»¥å¸¦æ•°é‡ï¼Œè¡¨ç¤ºè·³å‡ºçš„å±‚æ•°ï¼Œpythonå¦‚ä½•è·³å‡ºå¤šå±‚å¾ªç¯å‘¢ï¼Ÿ</p><p>ä»¥ python3 ä»£ç ä¸ºä¾‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ã€‚</p><h3 id="æ‰“åŒ…å‡½æ•°ï¼Œä½¿ç”¨-return"><a href="#æ‰“åŒ…å‡½æ•°ï¼Œä½¿ç”¨-return" class="headerlink" title="æ‰“åŒ…å‡½æ•°ï¼Œä½¿ç”¨ return"></a>æ‰“åŒ…å‡½æ•°ï¼Œä½¿ç”¨ return</h3><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sai</span>():</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):            <span class="hljs-keyword">if</span> i + j &gt; <span class="hljs-number">13</span>:                <span class="hljs-keyword">return</span> i, j<span class="hljs-built_in">print</span>(sai())</code></pre></div><p>å°†å¾ªç¯é€»è¾‘æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œæ»¡è¶³æ¡ä»¶ç›´æ¥ return</p><h3 id="å˜é‡æ ‡è®°"><a href="#å˜é‡æ ‡è®°" class="headerlink" title="å˜é‡æ ‡è®°"></a>å˜é‡æ ‡è®°</h3><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flag</span>():</span>    btn = <span class="hljs-literal">False</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):            <span class="hljs-keyword">if</span> i + j &gt; <span class="hljs-number">13</span>:                btn = <span class="hljs-literal">True</span>                <span class="hljs-keyword">break</span>        <span class="hljs-keyword">if</span> btn:            <span class="hljs-keyword">break</span>    <span class="hljs-built_in">print</span>(i, j)flag()</code></pre></div><p>ä½¿ç”¨ btn æ ‡è®°ï¼Œbtn == True åˆ™ç»§ç»­è·³å‡ºã€‚</p><h3 id="for-else"><a href="#for-else" class="headerlink" title="for/else"></a>for/else</h3><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loop</span>():</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):            <span class="hljs-keyword">if</span> i + j &gt; <span class="hljs-number">13</span>:                <span class="hljs-keyword">break</span>        <span class="hljs-keyword">else</span>:            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">break</span>    <span class="hljs-built_in">print</span>(i, j)loop()</code></pre></div><h3 id="raise-Exception"><a href="#raise-Exception" class="headerlink" title="raise Exception"></a>raise Exception</h3><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Break</span>(<span class="hljs-params">Exception</span>):</span>    <span class="hljs-keyword">pass</span><span class="hljs-keyword">try</span>:    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):            <span class="hljs-keyword">if</span> i + j &gt; <span class="hljs-number">13</span>:                <span class="hljs-keyword">raise</span> Break<span class="hljs-keyword">except</span> Break:    <span class="hljs-built_in">print</span>(i, j)</code></pre></div><p>æ€»æ„Ÿè§‰è¿™ä¸ªæ–¹æ³•ä¸å¤ªä¼˜é›…ã€‚</p><p>ä»¥ä¸Šå‡ ç§æ–¹æ³•å°±æ˜¯é’ˆå¯¹å¤šå±‚å¾ªç¯çš„è·³å‡ºï¼Œæˆ‘ä¸ªäººå€¾å‘äºæŠ½è±¡ä¸ªå‡½æ•°ï¼Œå½“ç„¶äº†ï¼Œä¹ æƒ¯å“ªç§å¦‚ä½ æ‰€æƒ³ã€‚</p><p>å¦‚æœæœ‰å…¶ä»–å¥½çš„æ–¹å¼ï¼Œæ¬¢è¿åˆ†äº«ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>git pull ä¸€ç›´å¤±è´¥</title>
    <link href="/2023/01/09/470/"/>
    <url>/2023/01/09/470/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ git pull é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå¦‚æœä½ ä¹Ÿé‡åˆ°ï¼Œå¸Œæœ›æˆ‘çš„åˆ†äº«å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><h3 id="No-such-file-or-directory"><a href="#No-such-file-or-directory" class="headerlink" title="No such file or directory."></a>No such file or directory.</h3><p>å…ˆæ˜¯é‡åˆ°è¿™ä¸ªé”™è¯¯</p><div class="code-wrapper"><pre><code class="hljs shell">git pullWarning: Identity file /home/sai/.ssh/sai not accessible: No such file or directory.</code></pre></div><p>æç¤ºæ˜¯æ²¡æœ‰æ–‡ä»¶ï¼Œæˆ‘ä»¬å»æ–°å»ºä¸€ä¸‹å³å¯ã€‚</p><p>ä½†æ˜¯åº”è¯¥æ–°å»ºæ–‡ä»¶é‡Œé¢æ˜¯ä»€ä¹ˆå†…å®¹å‘¢ï¼Ÿ</p><p>æŸ¥çœ‹äº†ä¸‹ git config</p><div class="code-wrapper"><pre><code class="hljs shell">git config -lsafe.directory=/src/abccore.repositoryformatversion=0core.filemode=truecore.bare=falsecore.logallrefupdates=truecore.sshcommand=ssh -i ~/.ssh/sairemote.origin.url=git@github.com:13sai/code.git</code></pre></div><p>å¯ä»¥çœ‹åˆ°å®šä¹‰äº† sshcommand</p><p>å¯¹äº core.sshCommand </p><blockquote><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªå˜é‡ï¼Œå½“git fetchå’Œgit pushéœ€è¦è¿æ¥åˆ°è¿œç¨‹ç³»ç»Ÿæ—¶ï¼Œå®ƒä»¬å°†ä½¿ç”¨æŒ‡å®šçš„å‘½ä»¤è€Œä¸æ˜¯sshã€‚è¯¥å‘½ä»¤ä¸GIT_SSH_COMMANDç¯å¢ƒå˜é‡çš„å½¢å¼ç›¸åŒï¼Œåœ¨è®¾ç½®ç¯å¢ƒå˜é‡æ—¶å°†è¢«è¦†ç›–ã€‚</p></blockquote><p>æˆ‘ä»¬å¤åˆ¶ ~/.ssh/id_rsa å³å¯ã€‚</p><blockquote><p>cp ~/.ssh/id_rsa ~/.ssh/sai</p></blockquote><p>å®Œæˆè¿™ä¸€æ­¥ä¹‹åï¼Œæœ‰é‡åˆ°é—®é¢˜ã€‚</p><div class="code-wrapper"><pre><code class="hljs shell">git pullERROR: Repository not found.fatal: Could not read from remote repository.Please make sure you have the correct access rightsand the repository exists.</code></pre></div><p>è¿™ä¸ªé—®é¢˜èŠ±äº†æˆ‘ä¸å°‘æ—¶é—´ï¼Œå»github ssh keys å‘ç°æœåŠ¡å™¨ä¸Šçš„ id_rsa.pub å·²ç»åŠ äº†ã€‚</p><p>æœ€åé‡æ–°ç”Ÿæˆ</p><div class="code-wrapper"><pre><code class="hljs shell">ssh-keygen -t rsa -C &quot;13sai&quot;</code></pre></div><p>éœ€è¦ä¸€æ­¥æ­¥ç¡®è®¤ï¼Œä¼šå‘ç° id_rsa.pub å’Œ id_rsa å·²ç»ç”Ÿæˆã€‚å‰å¾€ github æ·»åŠ  id_rsa.pub ã€‚</p><div class="code-wrapper"><pre><code class="hljs shell">git pullAlready up to date.</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonå¦‚ä½•éå†listå¹¶åˆ é™¤å…ƒç´ </title>
    <link href="/2022/11/14/461/"/>
    <url>/2022/11/14/461/</url>
    
    <content type="html"><![CDATA[<p>åœ¨å¼€å‘åœºæ™¯ä¸­ï¼Œpython éå†listå¹¶åˆ é™¤å…¶ä¸­éƒ¨åˆ†å…ƒç´ æ˜¯å¾ˆå¸¸è§çš„åœºæ™¯ã€‚æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼š</p><p>ç°åœ¨æœ‰ä¸€ä¸ªlist [1,2,4,-1,-4,1,9,-7,0], å¦‚ä½•åˆ é™¤listä¸­ä¸ºè´Ÿæ•°çš„å…ƒç´ ã€‚</p><p>èªæ˜å¦‚æˆ‘ï¼Œä¸éš¾æƒ³åˆ°ï¼Œéå†åˆ¤æ–­åˆ é™¤å‘—ï¼soeasyï¼</p><div class="code-wrapper"><pre><code class="hljs python">l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,-<span class="hljs-number">7</span>,<span class="hljs-number">0</span>]<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> l:    <span class="hljs-keyword">if</span> item &lt; <span class="hljs-number">0</span>:        l.remove(item)<span class="hljs-built_in">print</span>(l)</code></pre></div><p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹è¾“å‡ºï¼š</p><div class="code-wrapper"><pre><code class="hljs json">[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">-4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>]</code></pre></div><p>Wow~</p><blockquote><p>remove å‡½æ•°ç”¨äºç§»é™¤åˆ—è¡¨ä¸­æŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹</p></blockquote><p>å¥½åŠï¼Œæˆ‘ä½¿ç”¨indexåˆ é™¤ã€‚</p><div class="code-wrapper"><pre><code class="hljs python">l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,-<span class="hljs-number">7</span>,<span class="hljs-number">0</span>]<span class="hljs-keyword">for</span> (i, item) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(l):    <span class="hljs-keyword">if</span> item &lt; <span class="hljs-number">0</span>:        <span class="hljs-keyword">del</span> l[i]<span class="hljs-built_in">print</span>(l)</code></pre></div><p>å†æ¥ä¸€æ³¢ï¼š</p><div class="code-wrapper"><pre><code class="hljs json">[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">-4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>]</code></pre></div><p>é¢é¢ã€‚è²Œä¼¼ä¸å¯¹ï¼Œæˆ‘ä»¬ä¸å¦¨æ‰“å°ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs python">l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,-<span class="hljs-number">7</span>,<span class="hljs-number">0</span>]<span class="hljs-keyword">for</span> (i, item) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(l):    <span class="hljs-built_in">print</span>(l)    <span class="hljs-keyword">if</span> item &lt; <span class="hljs-number">0</span>:        <span class="hljs-keyword">del</span> l[i]<span class="hljs-built_in">print</span>(l)</code></pre></div><div class="code-wrapper"><pre><code class="hljs subunit">python3 test_list.py[1, 2, 4, <span class="hljs-string">-1</span>, <span class="hljs-string">-4</span>, 1, 9, <span class="hljs-string">-7</span>, 0][1, 2, 4, <span class="hljs-string">-1</span>, <span class="hljs-string">-4</span>, 1, 9, <span class="hljs-string">-7</span>, 0][1, 2, 4, <span class="hljs-string">-1</span>, <span class="hljs-string">-4</span>, 1, 9, <span class="hljs-string">-7</span>, 0][1, 2, 4, <span class="hljs-string">-1</span>, <span class="hljs-string">-4</span>, 1, 9, <span class="hljs-string">-7</span>, 0][1, 2, 4, <span class="hljs-string">-4</span>, 1, 9, <span class="hljs-string">-7</span>, 0][1, 2, 4, <span class="hljs-string">-4</span>, 1, 9, <span class="hljs-string">-7</span>, 0][1, 2, 4, <span class="hljs-string">-4</span>, 1, 9, <span class="hljs-string">-7</span>, 0][1, 2, 4, <span class="hljs-string">-4</span>, 1, 9, 0]</code></pre></div><p>èƒ½çœ‹å‡ºæ¥åˆ é™¤åå…¶å® index å˜åŒ–ï¼Œå¯¼è‡´éƒ¨åˆ†å…ƒç´ æ¼åˆ äº†ã€‚</p><p>é‚£ä¹ˆåˆ°åº•å¦‚ä½•æ­£ç¡®æ“ä½œå‘¢ï¼Ÿ</p><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><div class="code-wrapper"><pre><code class="hljs python">l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,-<span class="hljs-number">7</span>,<span class="hljs-number">0</span>]<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filter_small</span>(<span class="hljs-params">item</span>):</span>    <span class="hljs-keyword">if</span> item &lt; <span class="hljs-number">0</span>:        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>tmplist = <span class="hljs-built_in">filter</span>(filter_small, l)<span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(tmplist))</code></pre></div><p>éœ€è¦æ³¨æ„python2å’ŒPython3çš„filteræ˜¯æœ‰åŒºåˆ«å“ˆï¼</p><div class="code-wrapper"><pre><code class="hljs json">[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>]</code></pre></div><h3 id="è¯­æ³•ç³–"><a href="#è¯­æ³•ç³–" class="headerlink" title="è¯­æ³•ç³–"></a>è¯­æ³•ç³–</h3><div class="code-wrapper"><pre><code class="hljs python">l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,-<span class="hljs-number">7</span>,<span class="hljs-number">0</span>]l = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> l <span class="hljs-keyword">if</span> x &gt;= <span class="hljs-number">0</span>]<span class="hljs-built_in">print</span>(l)</code></pre></div><p>æ³¨æ„è¿™é‡Œæ¡ä»¶ï¼Œæ˜¯&gt;=0ï¼Œå°±æ˜¯æŠŠéæ•´æ•°ä¿ç•™ã€‚</p><h3 id="å€’åºéå†"><a href="#å€’åºéå†" class="headerlink" title="å€’åºéå†"></a>å€’åºéå†</h3><p>æ­£å‘éå†åˆ é™¤å…ƒç´ indexå˜åŒ–ï¼Œé‚£æˆ‘å€’åºéå†æ²¡æ¯›ç—…å§</p><div class="code-wrapper"><pre><code class="hljs python">l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,-<span class="hljs-number">7</span>,<span class="hljs-number">0</span>]<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(l) - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):    <span class="hljs-keyword">if</span> l[item] &lt; <span class="hljs-number">0</span>:        <span class="hljs-keyword">del</span> l[item]<span class="hljs-built_in">print</span>(l)</code></pre></div><p>å½“ç„¶äº†ï¼Œå…¶å®è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚åˆ›å»ºä¸ªæ–°çš„ listï¼Œåˆ¤æ–­åæ’å…¥ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆç®€å•çš„ã€‚</p><p>å…³äºlistéå†åˆ é™¤å°±ä»‹ç»è¿™ä¹ˆå¤šäº†ï¼Œå†™å®Œä»£ç åŠ¡å¿…è€è€å®å®å„ç§æƒ…å†µæµ‹è¯•å¥½ï¼Œä¸è¦æƒ³å½“ç„¶ï¼Œå°±åŒ†åŒ†å‘å¸ƒå“Ÿï¼</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Problems encountered when using mysql8, and how to solve them</title>
    <link href="/2022/10/31/460/"/>
    <url>/2022/10/31/460/</url>
    
    <content type="html"><![CDATA[<h3 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h3><ul><li>osx 12.5.1</li><li>mysql8.0.30</li></ul><h3 id="Public-Key-Retrieval-is-not-allowed"><a href="#Public-Key-Retrieval-is-not-allowed" class="headerlink" title="Public Key Retrieval is not allowed"></a>Public Key Retrieval is not allowed</h3><p>db manager: DBeaver</p><ol><li>Right click your connection, choose â€œEdit Connectionâ€</li><li>On the â€œConnection settingsâ€ screen (main screen) click on â€œEdit Driver Settingsâ€</li><li>Click on â€œConnection propertiesâ€, (In recent versions it named â€œDriver propertiesâ€)</li><li>Right click the â€œuser propertiesâ€ area and choose â€œAdd new propertyâ€</li><li>Add two properties: â€œuseSSLâ€(false) and â€œallowPublicKeyRetrievalâ€(true)</li></ol><h3 id="Forget-password"><a href="#Forget-password" class="headerlink" title="Forget password"></a>Forget password</h3><ol><li>Click system settings</li><li>On the â€œsystem settingsâ€ panel, Click on the MySQL icon below</li><li>Click â€˜Initailize Databaseâ€™ button</li><li>Then enter a new password, and select a type of the password encryption</li><li>Restart the MySQL</li></ol><h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><ul><li><a href="https://stackoverflow.com/questions/50379839/connection-java-mysql-public-key-retrieval-is-not-allowed">https://stackoverflow.com/questions/50379839/connection-java-mysql-public-key-retrieval-is-not-allowed</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLå¤§æ‰¹é‡æ•°æ®å¯¼å…¥</title>
    <link href="/2022/10/22/450/"/>
    <url>/2022/10/22/450/</url>
    
    <content type="html"><![CDATA[<h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>åƒä¸‡è¡Œçš„çš„ json æ•°æ®æˆ–è€… CSV å¿«é€Ÿå¯¼å…¥ MYSQL çš„åœºæ™¯ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="è„šæœ¬ä»£ç "><a href="#è„šæœ¬ä»£ç " class="headerlink" title="è„šæœ¬ä»£ç "></a>è„šæœ¬ä»£ç </h3><p>ä½¿ç”¨ php / python æˆ–è€…ä½ ç†Ÿæ‚‰çš„è¯­è¨€ï¼ŒæŒ‰è¡Œè§£æï¼Œæ’å…¥ã€‚</p><p>tipsï¼š</p><ol><li>ä¸€æ¬¡è§£æå¤šè¡Œï¼Œæäº¤æ•ˆç‡</li><li>åˆ†ç»„æ’å…¥ï¼Œå‡å°‘ MySQL æ’å…¥æ¬¡æ•°</li><li>æ³¨æ„å†…å­˜</li></ol><p>æ¯æ¬¡è§£æçš„è¡Œæ•°å’Œæ¯æ¬¡æ’å…¥çš„è¡Œæ•°æŒ‰å…·ä½“æƒ…å†µ ï¼Œä¸»è¦è€ƒè™‘è¿è¡Œå†…å­˜å’ŒMySQLçš„å‹åŠ›æƒ…å†µã€‚</p><h3 id="load-data"><a href="#load-data" class="headerlink" title="load data"></a>load data</h3><p>å¯¹äº CSV æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ SQLï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼Œæˆ–è€…é…åˆå…¶ä»–è„šæœ¬ä½¿ç”¨ã€‚</p><div class="code-wrapper"><pre><code class="hljs sql">LOAD DATA <span class="hljs-keyword">LOCAL</span> INFILE <span class="hljs-string">&#x27;/xxx.csv&#x27;</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> linkedinFIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;,&#x27;</span> LINES TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;\n&#x27;</span> IGNORE <span class="hljs-number">1</span> LINES (<span class="hljs-variable">@C1</span>,<span class="hljs-variable">@C2</span>,<span class="hljs-variable">@C3</span>,<span class="hljs-variable">@C4</span>)<span class="hljs-keyword">set</span> company<span class="hljs-operator">=</span><span class="hljs-variable">@C1</span>,website<span class="hljs-operator">=</span><span class="hljs-built_in">upper</span>(<span class="hljs-variable">@C2</span>),address<span class="hljs-operator">=</span>concat(<span class="hljs-variable">@C3</span>, &quot;-&quot;,<span class="hljs-variable">@C4</span>),imported_at<span class="hljs-operator">=</span>now(),zip<span class="hljs-operator">=</span>if(now()<span class="hljs-operator">&lt;</span><span class="hljs-string">&#x27;1988-01-01&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>);LOAD DATA <span class="hljs-keyword">LOCAL</span> INFILE <span class="hljs-string">&#x27;/13sai.json&#x27;</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> oscomeFIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;,&#x27;</span> LINES TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;\r\n&#x27;</span>;</code></pre></div><h3 id="mysqlimport"><a href="#mysqlimport" class="headerlink" title="mysqlimport"></a>mysqlimport</h3><p>å¯¹äº CSV æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨</p><div class="code-wrapper"><pre><code class="hljs sh">./mysqlimport -u root -p --<span class="hljs-built_in">local</span>  --delete --fields-terminated-by=<span class="hljs-string">&quot;,&quot;</span> --lines-terminated-by=<span class="hljs-string">&quot;\r\n&quot;</span> --ignore-lines=1 --columns=company,website testdata  <span class="hljs-string">&#x27;/13sai.csv&#x27;</span></code></pre></div><h3 id="MySQL-Shell"><a href="#MySQL-Shell" class="headerlink" title="MySQL Shell"></a>MySQL Shell</h3><div class="code-wrapper"><pre><code class="hljs sh">mysqlsh mysql://root:123456@127.0.0.1:3366 -- util import-table 13sai.json <span class="hljs-string">&quot;data_b*&quot;</span> data_d.tsv.zst --schema=mydb --table=twitter --osBucketName=mybucketmysql-py&gt; util.import_table([<span class="hljs-string">&quot;./13sai.csv&quot;</span>],&#123;<span class="hljs-string">&quot;schema&quot;</span>:<span class="hljs-string">&quot;testdata&quot;</span>,<span class="hljs-string">&quot;table&quot;</span>:<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-string">&quot;dialect&quot;</span>:<span class="hljs-string">&quot;csv&quot;</span>,<span class="hljs-string">&quot;columns&quot;</span>:[1,2,3,4,5,6,7,8,9,10,11,12],<span class="hljs-string">&quot;decodeColumns&quot;</span>:&#123;<span class="hljs-string">&quot;company&quot;</span>:<span class="hljs-string">&quot;@1&quot;</span>,<span class="hljs-string">&quot;website&quot;</span>:<span class="hljs-string">&quot;@2&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>:<span class="hljs-string">&quot;@3&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;@4&quot;</span>,<span class="hljs-string">&quot;zip&quot;</span>:<span class="hljs-string">&quot;@5&quot;</span>,&#125;,<span class="hljs-string">&quot;skipRows&quot;</span>:1,<span class="hljs-string">&quot;showProgress&quot;</span>:True,<span class="hljs-string">&quot;threads&quot;</span>: 3&#125;);mysql-py&gt; util.import_table([<span class="hljs-string">&quot;./13sai.json.gz&quot;</span>],&#123;<span class="hljs-string">&quot;schema&quot;</span>:<span class="hljs-string">&quot;testdata&quot;</span>,<span class="hljs-string">&quot;table&quot;</span>:<span class="hljs-string">&quot;twitter&quot;</span>,<span class="hljs-string">&quot;dialect&quot;</span>:<span class="hljs-string">&quot;json&quot;</span>,<span class="hljs-string">&quot;columns&quot;</span>:[1,2,3,4,5,6,7,8,9,10,11,12],<span class="hljs-string">&quot;decodeColumns&quot;</span>:&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;@1&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;@2&quot;</span>&#125;,<span class="hljs-string">&quot;skipRows&quot;</span>:1,<span class="hljs-string">&quot;showProgress&quot;</span>:True,<span class="hljs-string">&quot;threads&quot;</span>: 3&#125;);</code></pre></div><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¹äº CSV æˆ–è€…æ ¼å¼åŒ–æ–‡æœ¬ä½¿ç”¨ mysqlimportã€load data éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œè€Œè„šæœ¬è§£ææ˜¯æœ€æœ‰æ™®é€‚æ€§çš„ï¼Œå‡å¦‚éœ€è¦æ‰“å°æ—¥å¿—ã€è¿›åº¦æˆ–è€…å­—æ®µå˜æ›´ï¼Œä½¿ç”¨ php/python ç­‰å»è§£ææ›´ä¸ºçµæ´»ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VSCode æ’ä»¶æ¨è</title>
    <link href="/2022/09/29/441/"/>
    <url>/2022/09/29/441/</url>
    
    <content type="html"><![CDATA[<p>VSCode æ’ä»¶æ¨èï¼š</p><ul><li><a href="https://oscome.cn/docs/vscode/git%E6%8F%92%E4%BB%B6/">gitæ’ä»¶</a></li><li><a href="https://oscome.cn/docs/vscode/yanzhi/">é¢œå€¼æ‰©å±•</a></li><li><a href="https://oscome.cn/docs/vscode/tips/">æ•ˆç‡æå‡</a></li><li><a href="https://oscome.cn/docs/vscode/tool/">æ‹“å±•å·¥å…·</a></li><li><a href="https://oscome.cn/docs/vscode/huashui/">æ‘¸ ğŸŸ é±¼</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¼€æºåˆ°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VSCode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kuberneteå®æˆ˜ç¯‡-PVC</title>
    <link href="/2022/09/16/435/"/>
    <url>/2022/09/16/435/</url>
    
    <content type="html"><![CDATA[<p>Kubernetes å¯¹äºæœ‰çŠ¶æ€çš„æ—¥æœŸåº”ç”¨æˆ–è€…å¯¹äºæ•°æ®éœ€è¦æŒä¹…åŒ–çš„åº”ç”¨ï¼Œå°±éœ€è¦æ›´å¯é çš„å­˜å‚¨æ¥ä¿å­˜åº”ç”¨äº§ç”Ÿçš„é‡è¦æ•°æ®äº†ã€‚è¿™é‡Œéœ€è¦çš„å°±æ˜¯æŒä¹…å·ï¼ˆPersistentVolumeï¼‰å’Œ æŒä¹…å·ç”³é¢†ï¼ˆPersistentVolumeClaimï¼‰ã€‚</p><p>æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š</p><ul><li>PV</li><li>PVC</li><li>StorageClass</li><li>StatefulSet</li><li>Service</li></ul><p>æŒä¹…å·ï¼ˆPersistentVolumeï¼ŒPVï¼‰æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œå¯ä»¥äº‹å…ˆä¾›åº”ï¼Œæˆ–è€…ä½¿ç”¨<a href="https://kubernetes.io/zh/docs/concepts/storage/storage-classes/">å­˜å‚¨ç±»ï¼ˆStorage Classï¼‰</a>æ¥åŠ¨æ€ä¾›åº”ã€‚ æŒä¹…å·æ˜¯é›†ç¾¤èµ„æºï¼Œå°±åƒèŠ‚ç‚¹ä¹Ÿæ˜¯é›†ç¾¤èµ„æºä¸€æ ·ã€‚PV æŒä¹…å·å’Œæ™®é€šçš„ Volume ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ å·æ’ä»¶æ¥å®ç°çš„ï¼Œåªæ˜¯å®ƒä»¬æ‹¥æœ‰ç‹¬ç«‹äºä»»ä½•ä½¿ç”¨ PV çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ­¤ API å¯¹è±¡ä¸­è®°è¿°äº†å­˜å‚¨çš„å®ç°ç»†èŠ‚ï¼Œæ— è®ºå…¶èƒŒåæ˜¯ NFSã€iSCSI è¿˜æ˜¯ç‰¹å®šäºäº‘å¹³å°çš„å­˜å‚¨ç³»ç»Ÿã€‚</p><p>æŒä¹…å·ç”³é¢†ï¼ˆPersistentVolumeClaimï¼ŒPVCï¼‰è¡¨è¾¾çš„æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„è¯·æ±‚ã€‚æ¦‚å¿µä¸Šä¸ Pod ç±»ä¼¼ã€‚ Pod ä¼šè€—ç”¨èŠ‚ç‚¹èµ„æºï¼Œè€Œ PVC ç”³é¢†ä¼šè€—ç”¨ PV èµ„æºã€‚Pod å¯ä»¥è¯·æ±‚ç‰¹å®šæ•°é‡çš„èµ„æºï¼ˆCPU å’Œå†…å­˜ï¼‰ï¼›åŒæ · PVC ç”³é¢†ä¹Ÿå¯ä»¥è¯·æ±‚ç‰¹å®šçš„å¤§å°å’Œè®¿é—®æ¨¡å¼ ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥è¦æ±‚ PV å·èƒ½å¤Ÿä»¥ ReadWriteOnceã€ReadOnlyMany æˆ– ReadWriteMany æ¨¡å¼ä¹‹ä¸€æ¥æŒ‚è½½ï¼Œå‚è§<a href="https://kubernetes.io/zh/docs/concepts/storage/persistent-volumes/#access-modes">è®¿é—®æ¨¡å¼</a>ï¼‰ã€‚</p><p>ä¸‹é¢ä»¥ influxdb ä¸ºä¾‹å­ï¼š</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># å•ç‹¬å¼„ä¸ªNamespace influxdb</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span><span class="hljs-attr">metadata:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span><span class="hljs-meta">---</span><span class="hljs-comment"># é…ç½®æ–‡ä»¶å¼„ä¸ªConfigMapï¼Œä¾¿äºä¿®æ”¹</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">data:</span>  <span class="hljs-attr">influxdb.conf:</span> <span class="hljs-string">&gt;-</span><span class="hljs-string">    [meta]</span><span class="hljs-string">      dir = &quot;/var/lib/influxdb/meta&quot;</span><span class="hljs-string"></span>    [<span class="hljs-string">coordinator</span>]      <span class="hljs-string">log-queries-after</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;60s&quot;</span>      <span class="hljs-string">max-select-series</span> <span class="hljs-string">=</span> <span class="hljs-number">10000</span>      <span class="hljs-string">write-timeout</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;30s&quot;</span>    [<span class="hljs-string">data</span>]      <span class="hljs-string">dir</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;/var/lib/influxdb/data&quot;</span>      <span class="hljs-string">engine</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;tsm1&quot;</span>      <span class="hljs-string">wal-dir</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;/var/lib/influxdb/wal&quot;</span>      <span class="hljs-string">cache-max-memory-size</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;0&quot;</span>      <span class="hljs-string">cache-snapshot-memory-size</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;256m&quot;</span>      <span class="hljs-string">index-version</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;tsi1&quot;</span>      <span class="hljs-string">max-index-log-file-size</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;64k&quot;</span>      <span class="hljs-string">max-series-per-database</span> <span class="hljs-string">=</span> <span class="hljs-number">3000000</span>      <span class="hljs-string">max-values-per-tag</span> <span class="hljs-string">=</span> <span class="hljs-number">100000</span><span class="hljs-meta">---</span><span class="hljs-comment">## PersistentVolumeClaim</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">PersistentVolumeClaim</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-data</span>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">accessModes:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteOnce</span>  <span class="hljs-attr">storageClassName:</span> <span class="hljs-string">csi-xxx</span> <span class="hljs-comment"># éœ€è‡ªå®šä¹‰</span>  <span class="hljs-attr">resources:</span>    <span class="hljs-attr">requests:</span>      <span class="hljs-attr">storage:</span> <span class="hljs-string">16Gi</span> <span class="hljs-comment"># æŒ‰éœ€é…ç½®ï¼Œå­˜å‚¨æ•°æ®è¾ƒå¤šå¯é€‚å½“æ”¾å¤§</span><span class="hljs-meta">---</span><span class="hljs-comment"># influxdb æœ‰çŠ¶æ€åº”ç”¨</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span><span class="hljs-attr">metadata:</span>    <span class="hljs-attr">labels:</span>        <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">spec:</span>    <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>    <span class="hljs-attr">selector:</span>        <span class="hljs-attr">matchLabels:</span>            <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">serviceName:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">template:</span>        <span class="hljs-attr">metadata:</span>            <span class="hljs-attr">labels:</span>                <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>        <span class="hljs-attr">spec:</span>            <span class="hljs-attr">containers:</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">influxdb:1.8.10</span>                <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>                <span class="hljs-attr">ports:</span>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8086</span>                    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>                <span class="hljs-attr">volumeMounts:</span>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/influxdb</span>                    <span class="hljs-attr">name:</span> <span class="hljs-string">data</span>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span>                    <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/influxdb/influxdb.conf</span>                    <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span>                    <span class="hljs-attr">subPath:</span> <span class="hljs-string">influxdb.conf</span>            <span class="hljs-attr">volumes:</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">data</span>                <span class="hljs-attr">persistentVolumeClaim:</span>                  <span class="hljs-attr">claimName:</span> <span class="hljs-string">influxdb-data</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">timezone-config</span> <span class="hljs-comment"># æ—¶åŒº</span>                <span class="hljs-attr">hostPath:</span>                  <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/share/zoneinfo/Asia/Shanghai</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span>                <span class="hljs-attr">configMap:</span>                  <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">0600</span>                  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span><span class="hljs-meta">---</span><span class="hljs-comment"># æé«˜ç«¯å£ï¼Œæ–¹ä¾¿å…¶ä»– pod è°ƒç”¨</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">spec:</span>    <span class="hljs-attr">ports:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>        <span class="hljs-attr">port:</span> <span class="hljs-number">8086</span>        <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8086</span>    <span class="hljs-attr">selector:</span>        <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kuberneteå®æˆ˜ç¯‡-CronJob</title>
    <link href="/2022/08/31/434/"/>
    <url>/2022/08/31/434/</url>
    
    <content type="html"><![CDATA[<p>æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š</p><ul><li>CronJob</li><li>kubectl delete, kubectl logs</li></ul><p>CronJob æœ‰ç‚¹ç±»ä¼¼Linuxçš„crontabã€‚</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># cronjob.yaml</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">CronJob</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">hello</span><span class="hljs-attr">spec:</span>            <span class="hljs-comment"># â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59)</span>            <span class="hljs-comment"># â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23)</span>            <span class="hljs-comment"># â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆçš„æŸå¤© (1 - 31)</span>            <span class="hljs-comment"># â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆä»½ (1 - 12)</span>            <span class="hljs-comment"># â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‘¨çš„æŸå¤© (0 - 6)ï¼ˆå‘¨æ—¥åˆ°å‘¨ä¸€ï¼‰</span>            <span class="hljs-comment"># â”‚ â”‚ â”‚ â”‚ â”‚              æˆ–è€…æ˜¯ sunï¼Œmonï¼Œtueï¼Œwebï¼Œthuï¼Œfriï¼Œsat</span>            <span class="hljs-comment"># â”‚ â”‚ â”‚ â”‚ â”‚</span>            <span class="hljs-comment"># â”‚ â”‚ â”‚ â”‚ â”‚</span>            <span class="hljs-comment"># * * * * *</span>  <span class="hljs-attr">schedule:</span> <span class="hljs-string">&quot;*/1 * * * *&quot;</span>  <span class="hljs-attr">jobTemplate:</span>    <span class="hljs-attr">spec:</span>      <span class="hljs-attr">template:</span>        <span class="hljs-attr">spec:</span>          <span class="hljs-attr">containers:</span>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hello</span>            <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span>            <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>            <span class="hljs-attr">args:</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/sh</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">-c</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">date;</span> <span class="hljs-string">sleep</span> <span class="hljs-number">30</span><span class="hljs-string">;</span> <span class="hljs-string">echo</span> <span class="hljs-string">Hello,</span> <span class="hljs-string">13sai</span> <span class="hljs-string">from</span> <span class="hljs-string">the</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">cluster</span>          <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span></code></pre></div><blockquote><p>kubectl apply -f cronjob.yaml</p></blockquote><p><img src="/images/post/cronjob.png" alt="cronjob"></p><p>è¿è¡Œæ²¡é—®é¢˜ï¼ŒåŠ å…¥å‘ç°jobæœ‰é—®é¢˜ï¼Œéœ€è¦ç«‹å³ç»ˆæ­¢æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚ä½•åˆ é™¤æ­£åœ¨è¿è¡Œçš„ jobï¼Ÿ</p><blockquote><p>kubectl delete pod xxx</p></blockquote><p><img src="/images/post/deletejob.png" alt="deletejob"></p><p>å¯ä»¥çœ‹è§ç«‹å³ç”Ÿæˆäº†å¦ä¸€ä¸ªï¼Œç»§ç»­deleteã€‚</p><blockquote><p>kubectl delete pod xxx â€“grace-period 0 â€“force<br><img src="/images/post/deletejob2.png" alt="deletejob2"></p></blockquote><p>è™½ç„¶å¼ºåˆ¶æ€æ­»äº†ä¸€ä¸ªï¼Œä½†è¿˜æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªï¼Œæœ‰ä¸€æ¬¡å¤±è´¥äº†ã€‚</p><p>è™½ç„¶åˆ é™¤å¯¹åº”çš„podï¼Œä½†æ˜¯k8sä¼šè®¤ä¸ºè¿™ä¸ªpodæ‰§è¡Œå¤±è´¥ï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„podï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥åˆ é™¤æºå¤´ cronjobï¼Œç„¶åæ€æ‰æ‰§è¡Œä¸­çš„podã€‚<br>PS: cj æ˜¯ cronjobçš„åˆ«å</p><blockquote><p>kubectl delete cj hello<br>kubectl delete pod xxx â€“grace-period 0 â€“force</p></blockquote><p><img src="/images/post/deletejob3.png" alt="deletejob3"></p>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kuberneteå®æˆ˜ç¯‡-å…¬å¸ƒåº”ç”¨</title>
    <link href="/2022/08/22/433/"/>
    <url>/2022/08/22/433/</url>
    
    <content type="html"><![CDATA[<p>æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š</p><ul><li>Ingress</li><li>LoadBalancer</li></ul><h2 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰<a href="%E9%83%A8%E7%BD%B2Deployment.md">éƒ¨ç½²Deployment</a>çš„Serviceï¼Œå…·ä½“å®ç°ï¼š</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">networking.k8s.io/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Ingress</span><span class="hljs-attr">metadata:</span>  <span class="hljs-comment"># Ingress çš„åå­—ï¼Œä»…ç”¨äºæ ‡è¯†</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai-ingress</span>  <span class="hljs-attr">spec:</span>  <span class="hljs-comment"># Ingress ä¸­å®šä¹‰ L7 è·¯ç”±è§„åˆ™</span>  <span class="hljs-attr">rules:</span>    <span class="hljs-comment"># æ ¹æ® virtual hostname è¿›è¡Œè·¯ç”±ï¼ˆè¯·ä½¿ç”¨æ‚¨è‡ªå·±çš„åŸŸåï¼‰                  </span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">sai.13sai.com</span>         <span class="hljs-attr">http:</span>        <span class="hljs-attr">paths:</span>          <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/&quot;</span>            <span class="hljs-attr">pathType:</span> <span class="hljs-string">Prefix</span>            <span class="hljs-attr">backend:</span>              <span class="hljs-attr">service:</span>                <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span>  <span class="hljs-comment"># æŒ‡å®šåç«¯çš„ Service ä¸ºä¹‹å‰åˆ›å»ºçš„ sai</span>                <span class="hljs-attr">port:</span>                  <span class="hljs-attr">number:</span> <span class="hljs-number">80</span></code></pre></div><p><img src="images/ingress.png" alt="ingress"></p><h2 id="LoadBalancer"><a href="#LoadBalancer" class="headerlink" title="LoadBalancer"></a>LoadBalancer</h2><p>åœ¨ä½¿ç”¨æ”¯æŒå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„äº‘æä¾›å•†çš„æœåŠ¡æ—¶ï¼Œè®¾ç½®Â <code>type</code>Â çš„å€¼ä¸ºÂ <code>&quot;LoadBalancer&quot;</code>ï¼Œ å°†ä¸º Service æä¾›è´Ÿè½½å‡è¡¡å™¨ã€‚ è´Ÿè½½å‡è¡¡å™¨æ˜¯å¼‚æ­¥åˆ›å»ºçš„ï¼Œå…³äºè¢«æä¾›çš„è´Ÿè½½å‡è¡¡å™¨çš„ä¿¡æ¯å°†ä¼šé€šè¿‡ Service çš„Â <code>status.loadBalancer</code>Â å­—æ®µå‘å¸ƒå‡ºå»ã€‚</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai-lb</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">selector:</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span>  <span class="hljs-attr">ports:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">80</span>  <span class="hljs-attr">clusterIP:</span> <span class="hljs-number">10.0</span><span class="hljs-number">.171</span><span class="hljs-number">.239</span>  <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span><span class="hljs-attr">status:</span>  <span class="hljs-attr">loadBalancer:</span>    <span class="hljs-attr">ingress:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">ip:</span> <span class="hljs-number">192.0</span><span class="hljs-number">.2</span><span class="hljs-number">.127</span></code></pre></div><p>æ¥è‡ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„æµé‡å°†ç›´æ¥é‡å®šå‘åˆ°åç«¯ Pod ä¸Šï¼Œä¸è¿‡å®é™…å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™è¦ä¾èµ–äºäº‘æä¾›å•†ã€‚</p><p>æ¯”å¦‚ä½¿ç”¨ucloudï¼š</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">ucloud-nginx-out-tcp-new</span>  <span class="hljs-attr">labels:</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">ucloud-nginx-out-tcp-new</span>  <span class="hljs-attr">annotations:</span>    <span class="hljs-comment"># ä»£è¡¨ULBç½‘ç»œç±»å‹ï¼Œouterä¸ºå¤–ç½‘ï¼Œinnerä¸ºå†…ç½‘ï¼›outerä¸ºé»˜è®¤å€¼ï¼Œæ­¤å¤„å¯çœç•¥ã€‚</span>    <span class="hljs-attr">&quot;service.beta.kubernetes.io/ucloud-load-balancer-type&quot;:</span> <span class="hljs-string">&quot;outer&quot;</span>    <span class="hljs-comment"># è¡¨ç¤ºULBåè®®ç±»å‹ï¼Œtcpä¸udpç­‰ä»·ï¼Œè¡¨ç¤ºULB4ï¼›httpä¸httpSç­‰ä»·ï¼Œè¡¨ç¤ºULB7ï¼›tcpä¸ºé»˜è®¤å€¼ï¼Œæ­¤å¤„å¯çœç•¥ã€‚</span>    <span class="hljs-attr">&quot;service.beta.kubernetes.io/ucloud-load-balancer-vserver-protocol&quot;:</span> <span class="hljs-string">&quot;tcp&quot;</span>    <span class="hljs-comment"># bandwidthä¸‹é»˜è®¤ä¸º2Mpbs,å»ºè®®æ˜¾å¼å£°æ˜å¸¦å®½å¤§å°ï¼Œé¿å…è´¹ç”¨è¶…æ ‡ã€‚</span>    <span class="hljs-attr">&quot;service.beta.kubernetes.io/ucloud-load-balancer-eip-bandwidth&quot;:</span> <span class="hljs-string">&quot;2&quot;</span>     <span class="hljs-comment"># ä»˜è´¹æ¨¡å¼ï¼Œæ”¯æŒmonthï¼Œyearï¼Œdynamicï¼Œé»˜è®¤ä¸ºmonth</span>    <span class="hljs-attr">&quot;service.beta.kubernetes.io/ucloud-load-balancer-eip-chargetype&quot;:</span> <span class="hljs-string">&quot;month&quot;</span>     <span class="hljs-comment"># ä»˜è´¹æ—¶é•¿ï¼Œé»˜è®¤ä¸º1ï¼Œchargetypeä¸ºdynimicæ—¶æ— æ•ˆ    </span>    <span class="hljs-attr">&quot;service.beta.kubernetes.io/ucloud-load-balancer-eip-quantity&quot;:</span> <span class="hljs-string">&quot;1&quot;</span>     <span class="hljs-attr">spec:</span>  <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span>  <span class="hljs-attr">ports:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">80</span>  <span class="hljs-attr">selector:</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">ucloud-nginx-out-tcp-new</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kuberneteå®æˆ˜ç¯‡-Deploymentéƒ¨ç½²</title>
    <link href="/2022/08/11/431/"/>
    <url>/2022/08/11/431/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬ä»¥éƒ¨ç½²ä¸€ä¸ªå¯è®¿é—®httpæœåŠ¡çš„ä¸ºä¾‹ï¼Œæ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š</p><ul><li>ConfigMap</li><li>Service</li><li>Deployment</li><li>kubectl port-forward</li></ul><h2 id="ç¼–å†™yaml"><a href="#ç¼–å†™yaml" class="headerlink" title="ç¼–å†™yaml"></a>ç¼–å†™yaml</h2><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># sai-config.yaml</span><span class="hljs-comment"># å®šä¹‰ ConfigMap</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><span class="hljs-attr">metadata:</span> <span class="hljs-comment"># å…ƒæ•°æ®ï¼Œå®šä¹‰åŸºæœ¬å±æ€§å’Œä¿¡æ¯</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai-config</span> <span class="hljs-comment"># åç§°</span><span class="hljs-attr">data:</span>  <span class="hljs-attr">config.yaml:</span> <span class="hljs-string">|-</span><span class="hljs-string">    name: sai0556</span><span class="hljs-string">    mode: debug</span><span class="hljs-string">    addr: :8080</span><span class="hljs-string">    hi: w~o~w</span><span class="hljs-string"></span><span class="hljs-meta">---</span><span class="hljs-comment"># å®šä¹‰ Service</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span>  <span class="hljs-attr">labels:</span> <span class="hljs-comment"># æ ‡ç­¾</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span><span class="hljs-attr">spec:</span> <span class="hljs-comment"># æè¿°</span>  <span class="hljs-attr">ports:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">80</span> <span class="hljs-comment"># Serviceçš„è™šæ‹Ÿç«¯å£</span>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span> <span class="hljs-comment"># å®¹å™¨æš´éœ²çš„ç«¯å£</span>  <span class="hljs-attr">selector:</span> <span class="hljs-comment"># é€‰æ‹©å™¨ï¼Œå¯¹åº”ä¸‹é¢çš„ Deploymentçš„ labels</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span><span class="hljs-meta">---</span><span class="hljs-comment"># å®šä¹‰ Deployment</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># åˆ›å»ºåº”ç”¨ç¨‹åºå®ä¾‹ä¸ªæ•°</span>  <span class="hljs-attr">selector:</span> <span class="hljs-comment"># æ ‡ç­¾é€‰æ‹©å™¨</span>    <span class="hljs-attr">matchLabels:</span> <span class="hljs-comment"># é€‰æ‹©åŒ…å«æ ‡ç­¾app:saiçš„èµ„æº</span>      <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span>  <span class="hljs-attr">template:</span> <span class="hljs-comment"># æ¨¡æ¿</span>    <span class="hljs-attr">metadata:</span>      <span class="hljs-attr">labels:</span>        <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span>    <span class="hljs-attr">spec:</span>      <span class="hljs-attr">containers:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span>        <span class="hljs-attr">image:</span> <span class="hljs-string">13sai/k8s-configmap-sai:0.2</span>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>        <span class="hljs-attr">command:</span>          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;/app/13sai&#x27;</span>        <span class="hljs-attr">volumeMounts:</span> <span class="hljs-comment"># æ•°æ®å·æŒ‚è½½</span>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config</span>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/app/config.yaml</span>            <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span>            <span class="hljs-attr">subPath:</span> <span class="hljs-string">config.yaml</span>      <span class="hljs-attr">volumes:</span> <span class="hljs-comment"># æŒ‚è½½çš„å…·ä½“ä¿¡æ¯ï¼Œè¿™é‡Œä½¿ç”¨çš„ configMap</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config</span>          <span class="hljs-attr">configMap:</span>            <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">0600</span>            <span class="hljs-attr">name:</span> <span class="hljs-string">sai-config</span></code></pre></div><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><div class="code-wrapper"><pre><code class="hljs sh">kubectl apply -f sai-config.yaml</code></pre></div><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä½¿ç”¨ kubectl æŸ¥çœ‹</p><div class="code-wrapper"><pre><code class="hljs sh">kubectl get deploymentkubectl get service</code></pre></div><p><img src="/images/post/kubectl-apply.png" alt="kubectl-apply"></p><p>æµ‹è¯•ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-comment"># port-forward å¯ä»¥å°†é›†ç¾¤æ˜ å°„åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿debug</span>kubectl port-forward svc/sai 8088:80</code></pre></div><p><img src="/images/post/clusterip-service.png"></p><p>å¯ä»¥çœ‹åˆ°è¯·æ±‚æ˜¯æˆåŠŸï¼ <a href="http://127.0.0.1:8088/">http://127.0.0.1:8088/</a></p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨  <strong>NodePort</strong> </p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span>  <span class="hljs-attr">labels:</span> <span class="hljs-comment"># æ ‡ç­¾</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span><span class="hljs-attr">spec:</span> <span class="hljs-comment"># æè¿°</span>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span>  <span class="hljs-attr">ports:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>    <span class="hljs-attr">nodePort:</span> <span class="hljs-number">31080</span>  <span class="hljs-attr">selector:</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span></code></pre></div><p><img src="/images/post/nodePort-service.png" alt="nodePort"></p>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kuberneteå®æˆ˜ç¯‡-å¤–éƒ¨æœåŠ¡</title>
    <link href="/2022/08/10/432/"/>
    <url>/2022/08/10/432/</url>
    
    <content type="html"><![CDATA[<p>æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š</p><ul><li>Service</li><li>Endpoints</li></ul><h2 id="å¤–éƒ¨æœåŠ¡-Service"><a href="#å¤–éƒ¨æœåŠ¡-Service" class="headerlink" title="å¤–éƒ¨æœåŠ¡ Service"></a>å¤–éƒ¨æœåŠ¡ Service</h2><p>éœ€æ³¨æ„ Service æ˜¯ä¸€ä¸ªä¸å¸¦ selector çš„ï¼Œå¦åˆ™å°±ä¼šè‡ªåŠ¨åˆ›å»º Endpointï¼Œname ä¿æŒä¸€è‡´å³å¯ã€‚</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">to-external</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span>  <span class="hljs-attr">ports:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>      <span class="hljs-attr">nodePort:</span> <span class="hljs-number">31081</span>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><span class="hljs-meta">---</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Endpoints</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">to-external</span><span class="hljs-attr">subsets:</span><span class="hljs-bullet">-</span> <span class="hljs-attr">addresses:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">ip:</span> <span class="hljs-number">11.50</span><span class="hljs-number">.24</span><span class="hljs-number">.32</span>  <span class="hljs-attr">ports:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span></code></pre></div><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡ <a href="http://127.0.0.1:31081/">http://127.0.0.1:31081</a> è®¿é—®äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubernetesåŸºç¡€ç¯‡-é•œåƒ</title>
    <link href="/2022/08/01/423/"/>
    <url>/2022/08/01/423/</url>
    
    <content type="html"><![CDATA[<h3 id="é•œåƒ-image"><a href="#é•œåƒ-image" class="headerlink" title="é•œåƒ image"></a>é•œåƒ image</h3><h4 id="é•œåƒåç§°"><a href="#é•œåƒåç§°" class="headerlink" title="é•œåƒåç§°"></a>é•œåƒåç§°</h4><p>å¦‚æœä½ ä¸æŒ‡å®šä»“åº“çš„ä¸»æœºåï¼ŒKubernetes è®¤ä¸ºä½ åœ¨ä½¿ç”¨ Docker å…¬å…±ä»“åº“ã€‚åœ¨é•œåƒåç§°ä¹‹åï¼Œä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼ˆTagï¼‰ã€‚ </p><p>é•œåƒæ ‡ç­¾å¯ä»¥åŒ…å«å°å†™å­—æ¯ã€å¤§å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰ã€å¥ç‚¹ï¼ˆ<code>.</code>ï¼‰å’Œè¿å­—ç¬¦ï¼ˆ<code>-</code>ï¼‰ã€‚ å…³äºåœ¨é•œåƒæ ‡ç­¾ä¸­ä½•å¤„å¯ä»¥ä½¿ç”¨åˆ†éš”å­—ç¬¦ï¼ˆ<code>_</code>ã€<code>-</code>Â å’ŒÂ <code>.</code>ï¼‰è¿˜æœ‰ä¸€äº›é¢å¤–çš„è§„åˆ™ã€‚ å¦‚æœä½ ä¸æŒ‡å®šæ ‡ç­¾ï¼ŒKubernetes è®¤ä¸ºä½ æƒ³ä½¿ç”¨æ ‡ç­¾Â <code>latest</code>ã€‚</p><h4 id="é•œåƒæ‹‰å–ç­–ç•¥"><a href="#é•œåƒæ‹‰å–ç­–ç•¥" class="headerlink" title="é•œåƒæ‹‰å–ç­–ç•¥"></a>é•œåƒæ‹‰å–ç­–ç•¥</h4><p>imagePullPolicyï¼š</p><ul><li><code>IfNotPresent</code>ï¼šåªæœ‰å½“é•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨æ—¶æ‰ä¼šæ‹‰å–ã€‚</li><li><code>Always</code>ï¼šæ¯å½“ kubelet å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œkubelet ä¼šæŸ¥è¯¢å®¹å™¨çš„é•œåƒä»“åº“ï¼Œ å°†åç§°è§£æä¸ºä¸€ä¸ªé•œåƒæ‘˜è¦ã€‚ å¦‚æœ kubelet æœ‰ä¸€ä¸ªå®¹å™¨é•œåƒï¼Œå¹¶ä¸”å¯¹åº”çš„æ‘˜è¦å·²åœ¨æœ¬åœ°ç¼“å­˜ï¼Œkubelet å°±ä¼šä½¿ç”¨å…¶ç¼“å­˜çš„é•œåƒï¼› å¦åˆ™ï¼Œkubelet å°±ä¼šä½¿ç”¨è§£æåçš„æ‘˜è¦æ‹‰å–é•œåƒï¼Œå¹¶ä½¿ç”¨è¯¥é•œåƒæ¥å¯åŠ¨å®¹å™¨ã€‚</li><li><code>Never</code>ï¼šKubelet ä¸ä¼šå°è¯•è·å–é•œåƒã€‚å¦‚æœé•œåƒå·²ç»ä»¥æŸç§æ–¹å¼å­˜åœ¨æœ¬åœ°ï¼Œ kubelet ä¼šå°è¯•å¯åŠ¨å®¹å™¨ï¼›å¦åˆ™ï¼Œä¼šå¯åŠ¨å¤±è´¥ã€‚ </li></ul><h5 id="é»˜è®¤é•œåƒæ‹‰å–ç­–ç•¥"><a href="#é»˜è®¤é•œåƒæ‹‰å–ç­–ç•¥" class="headerlink" title="é»˜è®¤é•œåƒæ‹‰å–ç­–ç•¥"></a>é»˜è®¤é•œåƒæ‹‰å–ç­–ç•¥</h5><p>å½“ä½ ï¼ˆæˆ–æ§åˆ¶å™¨ï¼‰å‘ API æœåŠ¡å™¨æäº¤ä¸€ä¸ªæ–°çš„ Pod æ—¶ï¼Œä½ çš„é›†ç¾¤ä¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è®¾ç½®Â <code>imagePullPolicy</code>Â å­—æ®µï¼š</p><ul><li>  å¦‚æœä½ çœç•¥äº†Â <code>imagePullPolicy</code>Â å­—æ®µï¼Œå¹¶ä¸”å®¹å™¨é•œåƒçš„æ ‡ç­¾æ˜¯Â <code>:latest</code>ï¼ŒÂ <code>imagePullPolicy</code>Â ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºÂ <code>Always</code>ã€‚</li><li>  å¦‚æœä½ çœç•¥äº†Â <code>imagePullPolicy</code>Â å­—æ®µï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šå®¹å™¨é•œåƒçš„æ ‡ç­¾ï¼ŒÂ <code>imagePullPolicy</code>Â ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºÂ <code>Always</code>ã€‚</li><li>  å¦‚æœä½ çœç•¥äº†Â <code>imagePullPolicy</code>Â å­—æ®µï¼Œå¹¶ä¸”ä¸ºå®¹å™¨é•œåƒæŒ‡å®šäº†éÂ <code>:latest</code>Â çš„æ ‡ç­¾ï¼ŒÂ <code>imagePullPolicy</code>Â å°±ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºÂ <code>IfNotPresent</code>ã€‚</li></ul><h4 id="ä½¿ç”¨ç§æœ‰ä»“åº“"><a href="#ä½¿ç”¨ç§æœ‰ä»“åº“" class="headerlink" title="ä½¿ç”¨ç§æœ‰ä»“åº“"></a>ä½¿ç”¨ç§æœ‰ä»“åº“</h4><p>ä»ç§æœ‰ä»“åº“è¯»å–é•œåƒæ—¶å¯èƒ½éœ€è¦å¯†é’¥ã€‚ å‡­è¯å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼æä¾›:</p><ul><li>é…ç½®èŠ‚ç‚¹å‘ç§æœ‰ä»“åº“è¿›è¡Œèº«ä»½éªŒè¯<ul><li>  æ‰€æœ‰ Pod å‡å¯è¯»å–ä»»ä½•å·²é…ç½®çš„ç§æœ‰ä»“åº“</li><li>  éœ€è¦é›†ç¾¤ç®¡ç†å‘˜é…ç½®èŠ‚ç‚¹</li></ul></li><li>é¢„æ‹‰é•œåƒ<ul><li>  æ‰€æœ‰ Pod éƒ½å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šç¼“å­˜çš„æ‰€æœ‰é•œåƒ</li><li>  éœ€è¦æ‰€æœ‰èŠ‚ç‚¹çš„ root è®¿é—®æƒé™æ‰èƒ½è¿›è¡Œè®¾ç½®</li></ul></li><li>åœ¨ Pod ä¸­è®¾ç½® ImagePullSecrets<ul><li>  åªæœ‰æä¾›è‡ªå·±å¯†é’¥çš„ Pod æ‰èƒ½è®¿é—®ç§æœ‰ä»“åº“</li></ul></li><li>ç‰¹å®šäºå‚å•†çš„æ‰©å±•æˆ–è€…æœ¬åœ°æ‰©å±•<ul><li>  å¦‚æœä½ åœ¨ä½¿ç”¨å®šåˆ¶çš„èŠ‚ç‚¹é…ç½®ï¼Œä½ ï¼ˆæˆ–è€…äº‘å¹³å°æä¾›å•†ï¼‰å¯ä»¥å®ç°è®©èŠ‚ç‚¹ å‘å®¹å™¨ä»“åº“è®¤è¯çš„æœºåˆ¶</li></ul></li></ul><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p><a href="https://kubernetes.io/zh/docs/concepts/containers/images/">é•œåƒ</a></p>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubernetesåŸºç¡€ç¯‡-kubectl</title>
    <link href="/2022/07/31/422/"/>
    <url>/2022/07/31/422/</url>
    
    <content type="html"><![CDATA[<h2 id="kubectl"><a href="#kubectl" class="headerlink" title="kubectl"></a>kubectl</h2><p>Kubectl å‘½ä»¤è¡Œå·¥å…·ç®¡ç† Kubernetes é›†ç¾¤ã€‚ kubectl åœ¨ $HOME/.kube ç›®å½•ä¸­æŸ¥æ‰¾ä¸€ä¸ªåä¸º config çš„é…ç½®æ–‡ä»¶ã€‚ ä½ å¯ä»¥é€šè¿‡è®¾ç½® KUBECONFIG ç¯å¢ƒå˜é‡æˆ–è®¾ç½® â€“kubeconfig å‚æ•°æ¥æŒ‡å®šå…¶å®ƒ kubeconfig æ–‡ä»¶ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h4><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-comment"># install</span>brew install kubectl <span class="hljs-comment"># test</span>kubectl version --client<span class="hljs-comment"># è‡ªåŠ¨è¡¥å…¨å·¥å…·</span><span class="hljs-built_in">echo</span> <span class="hljs-built_in">source</span> &lt;(kubectl completion zsh) &gt;&gt; ~/.zshrc</code></pre></div><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>ä½¿ç”¨ä»¥ä¸‹è¯­æ³• <code>kubectl</code> ä»ç»ˆç«¯çª—å£è¿è¡Œå‘½ä»¤ï¼š</p><div class="code-wrapper"><pre><code class="hljs shell">kubectl [command] [TYPE] [NAME] [flags]</code></pre></div><p>å…¶ä¸­ <code>command</code>ã€<code>TYPE</code>ã€<code>NAME</code> å’Œ <code>flags</code> åˆ†åˆ«æ˜¯ï¼š</p><ul><li><p><code>command</code>ï¼šæŒ‡å®šè¦å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚ <code>create</code>ã€<code>get</code>ã€<code>describe</code>ã€<code>delete</code>ã€‚</p></li><li><p><code>TYPE</code>ï¼šæŒ‡å®š<a href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8B">èµ„æºç±»å‹</a>ã€‚èµ„æºç±»å‹ä¸åŒºåˆ†å¤§å°å†™ï¼Œ å¯ä»¥æŒ‡å®šå•æ•°ã€å¤æ•°æˆ–ç¼©å†™å½¢å¼ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤è¾“å‡ºç›¸åŒçš„ç»“æœ:</p><div class="code-wrapper"><pre><code class="hljs shell">kubectl get pod pod1kubectl get pods pod1kubectl get po pod1</code></pre></div></li><li><p><code>NAME</code>ï¼šæŒ‡å®šèµ„æºçš„åç§°ã€‚åç§°åŒºåˆ†å¤§å°å†™ã€‚ å¦‚æœçœç•¥åç§°ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰èµ„æºçš„è¯¦ç»†ä¿¡æ¯ <code>kubectl get pods</code>ã€‚</p><p>åœ¨å¯¹å¤šä¸ªèµ„æºæ‰§è¡Œæ“ä½œæ—¶ï¼Œä½ å¯ä»¥æŒ‰ç±»å‹å’Œåç§°æŒ‡å®šæ¯ä¸ªèµ„æºï¼Œæˆ–æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼š</p><ul><li><p>è¦æŒ‰ç±»å‹å’Œåç§°æŒ‡å®šèµ„æºï¼š</p><ul><li><p>è¦å¯¹æ‰€æœ‰ç±»å‹ç›¸åŒçš„èµ„æºè¿›è¡Œåˆ†ç»„ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<code>TYPE1 name1 name2 name&lt;#&gt;</code>ã€‚</p><p>ä¾‹å­ï¼š<code>kubectl get pod example-pod1 example-pod2</code></p></li><li><p>åˆ†åˆ«æŒ‡å®šå¤šä¸ªèµ„æºç±»å‹ï¼š<code>TYPE1/name1 TYPE1/name2 TYPE2/name3 TYPE&lt;#&gt;/name&lt;#&gt;</code>ã€‚</p><p>ä¾‹å­ï¼š<code>kubectl get pod/example-pod1 replicationcontroller/example-rc1</code></p></li></ul></li><li><p>ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶æŒ‡å®šèµ„æºï¼š<code>-f file1 -f file2 -f file&lt;#&gt;</code></p><ul><li><a href="https://kubernetes.io/zh/docs/concepts/configuration/overview/#general-configuration-tips">ä½¿ç”¨ YAML è€Œä¸æ˜¯ JSON</a> å› ä¸º YAML æ›´å®¹æ˜“ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯ç”¨äºé…ç½®æ–‡ä»¶æ—¶ã€‚ ä¾‹å­ï¼š<code>kubectl get -f ./pod.yaml</code></li></ul></li></ul></li><li><p><code>flags</code>: æŒ‡å®šå¯é€‰çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ <code>-s</code> æˆ– <code>-server</code> å‚æ•°æŒ‡å®š Kubernetes API æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ã€‚</p></li></ul><p><strong>PS:</strong></p><p>ä»å‘½ä»¤è¡ŒæŒ‡å®šçš„å‚æ•°ä¼šè¦†ç›–é»˜è®¤å€¼å’Œä»»ä½•ç›¸åº”çš„ç¯å¢ƒå˜é‡ã€‚</p><p>å¦‚æœä½ éœ€è¦å¸®åŠ©ï¼Œä»ç»ˆç«¯çª—å£è¿è¡Œ <code>kubectl help</code> ã€‚</p><p><a href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#%E6%93%8D%E4%BD%9C">æŸ¥çœ‹æ›´å¤šæ“ä½œ</a></p><h3 id="ç¤ºä¾‹ï¼šå¸¸ç”¨æ“ä½œ"><a href="#ç¤ºä¾‹ï¼šå¸¸ç”¨æ“ä½œ" class="headerlink" title="ç¤ºä¾‹ï¼šå¸¸ç”¨æ“ä½œ"></a>ç¤ºä¾‹ï¼šå¸¸ç”¨æ“ä½œ</h3><p>ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹é›†æ¥å¸®åŠ©ä½ ç†Ÿæ‚‰è¿è¡Œå¸¸ç”¨ kubectl æ“ä½œï¼š</p><p><code>kubectl apply</code> - ä»¥æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥ä¸ºå‡†åº”ç”¨æˆ–æ›´æ–°èµ„æºã€‚</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä½¿ç”¨ example-service.yaml ä¸­çš„å®šä¹‰åˆ›å»ºæœåŠ¡ã€‚</span>kubectl apply -f example-service.yaml<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> ä½¿ç”¨ example-controller.yaml ä¸­çš„å®šä¹‰åˆ›å»º replication controllerã€‚</span>kubectl apply -f example-controller.yaml<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> ä½¿ç”¨ &lt;directory&gt; è·¯å¾„ä¸‹çš„ä»»æ„ .yaml, .yml, æˆ– .json æ–‡ä»¶ åˆ›å»ºå¯¹è±¡ã€‚</span>kubectl apply -f &lt;directory&gt;</code></pre></div><p><code>kubectl get</code> - åˆ—å‡ºä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºã€‚</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰ podã€‚</span>kubectl get pods<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰ podï¼Œå¹¶åŒ…å«é™„åŠ ä¿¡æ¯(å¦‚èŠ‚ç‚¹å)ã€‚</span>kubectl get pods -o wide<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºå…·æœ‰æŒ‡å®šåç§°çš„å‰¯æœ¬æ§åˆ¶å™¨ã€‚æç¤ºï¼šä½ å¯ä»¥ä½¿ç”¨åˆ«å <span class="hljs-string">&#x27;rc&#x27;</span> ç¼©çŸ­å’Œæ›¿æ¢ <span class="hljs-string">&#x27;replicationcontroller&#x27;</span> èµ„æºç±»å‹ã€‚</span>kubectl get replicationcontroller &lt;rc-name&gt;<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰å‰¯æœ¬æ§åˆ¶å™¨å’ŒæœåŠ¡ã€‚</span>kubectl get rc,services<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰å®ˆæŠ¤ç¨‹åºé›†ï¼ŒåŒ…æ‹¬æœªåˆå§‹åŒ–çš„å®ˆæŠ¤ç¨‹åºé›†ã€‚</span>kubectl get ds --include-uninitialized<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> åˆ—å‡ºåœ¨èŠ‚ç‚¹ server01 ä¸Šè¿è¡Œçš„æ‰€æœ‰ pod</span>kubectl get pods --field-selector=spec.nodeName=server01</code></pre></div><p><code>kubectl describe</code> - æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„è¯¦ç»†çŠ¶æ€ï¼Œé»˜è®¤æƒ…å†µä¸‹åŒ…æ‹¬æœªåˆå§‹åŒ–çš„èµ„æºã€‚</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ˜¾ç¤ºåç§°ä¸º &lt;node-name&gt; çš„èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ã€‚</span>kubectl describe nodes &lt;node-name&gt;<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> æ˜¾ç¤ºåä¸º &lt;pod-name&gt; çš„ pod çš„è¯¦ç»†ä¿¡æ¯ã€‚</span>kubectl describe pods/&lt;pod-name&gt;<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> æ˜¾ç¤ºç”±åä¸º &lt;rc-name&gt; çš„å‰¯æœ¬æ§åˆ¶å™¨ç®¡ç†çš„æ‰€æœ‰ pod çš„è¯¦ç»†ä¿¡æ¯ã€‚</span><span class="hljs-meta">#</span><span class="bash"> è®°ä½ï¼šå‰¯æœ¬æ§åˆ¶å™¨åˆ›å»ºçš„ä»»ä½• pod éƒ½ä»¥å¤åˆ¶æ§åˆ¶å™¨çš„åç§°ä¸ºå‰ç¼€ã€‚</span>kubectl describe pods &lt;rc-name&gt;<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> æè¿°æ‰€æœ‰çš„ podï¼Œä¸åŒ…æ‹¬æœªåˆå§‹åŒ–çš„ pod</span>kubectl describe pods</code></pre></div><p><strong>Note:</strong></p><p><code>kubectl get</code> å‘½ä»¤é€šå¸¸ç”¨äºæ£€ç´¢åŒä¸€èµ„æºç±»å‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºã€‚ å®ƒå…·æœ‰ä¸°å¯Œçš„å‚æ•°ï¼Œå…è®¸ä½ ä½¿ç”¨ <code>-o</code> æˆ– <code>--output</code> å‚æ•°è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ã€‚ä½ å¯ä»¥æŒ‡å®š <code>-w</code> æˆ– <code>--watch</code> å‚æ•°ä»¥å¼€å§‹è§‚å¯Ÿç‰¹å®šå¯¹è±¡çš„æ›´æ–°ã€‚ <code>kubectl describe</code> å‘½ä»¤æ›´ä¾§é‡äºæè¿°æŒ‡å®šèµ„æºçš„è®¸å¤šç›¸å…³æ–¹é¢ã€‚å®ƒå¯ä»¥è°ƒç”¨å¯¹ <code>API æœåŠ¡å™¨</code> çš„å¤šä¸ª API è°ƒç”¨æ¥ä¸ºç”¨æˆ·æ„å»ºè§†å›¾ã€‚ ä¾‹å¦‚ï¼Œè¯¥ <code>kubectl describe node</code> å‘½ä»¤ä¸ä»…æ£€ç´¢æœ‰å…³èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿˜æ£€ç´¢åœ¨å…¶ä¸Šè¿è¡Œçš„ pod çš„æ‘˜è¦ï¼Œä¸ºèŠ‚ç‚¹ç”Ÿæˆçš„äº‹ä»¶ç­‰ã€‚</p><p><code>kubectl delete</code> - ä»æ–‡ä»¶ã€stdin æˆ–æŒ‡å®šæ ‡ç­¾é€‰æ‹©å™¨ã€åç§°ã€èµ„æºé€‰æ‹©å™¨æˆ–èµ„æºä¸­åˆ é™¤èµ„æºã€‚</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä½¿ç”¨ pod.yaml æ–‡ä»¶ä¸­æŒ‡å®šçš„ç±»å‹å’Œåç§°åˆ é™¤ podã€‚</span>kubectl delete -f pod.yaml<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤æ‰€æœ‰å¸¦æœ‰ <span class="hljs-string">&#x27;&lt;label-key&gt;=&lt;label-value&gt;&#x27;</span> æ ‡ç­¾çš„ Pod å’ŒæœåŠ¡ã€‚</span>kubectl delete pods,services -l &lt;label-key&gt;=&lt;label-value&gt;<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤æ‰€æœ‰ podï¼ŒåŒ…æ‹¬æœªåˆå§‹åŒ–çš„ podã€‚</span>kubectl delete pods --all</code></pre></div><p><code>kubectl exec</code> - å¯¹ pod ä¸­çš„å®¹å™¨æ‰§è¡Œå‘½ä»¤ã€‚</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä» pod &lt;pod-name&gt; ä¸­è·å–è¿è¡Œ <span class="hljs-string">&#x27;date&#x27;</span> çš„è¾“å‡ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ¥è‡ªç¬¬ä¸€ä¸ªå®¹å™¨ã€‚</span>kubectl exec &lt;pod-name&gt; -- date<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> è¿è¡Œè¾“å‡º <span class="hljs-string">&#x27;date&#x27;</span> è·å–åœ¨å®¹å™¨çš„ &lt;container-name&gt; ä¸­ pod &lt;pod-name&gt; çš„è¾“å‡ºã€‚</span>kubectl exec &lt;pod-name&gt; -c &lt;container-name&gt; -- date<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> è·å–ä¸€ä¸ªäº¤äº’ TTY å¹¶è¿è¡Œ /bin/bash &lt;pod-name &gt;ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ¥è‡ªç¬¬ä¸€ä¸ªå®¹å™¨ã€‚</span>kubectl exec -ti &lt;pod-name&gt; -- /bin/bash</code></pre></div><p><code>kubectl logs</code> - æ‰“å° Pod ä¸­å®¹å™¨çš„æ—¥å¿—ã€‚</p><div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä» pod è¿”å›æ—¥å¿—å¿«ç…§ã€‚</span>kubectl logs &lt;pod-name&gt;<span class="hljs-meta"></span><span class="hljs-meta">#</span><span class="bash"> ä» pod &lt;pod-name&gt; å¼€å§‹æµå¼ä¼ è¾“æ—¥å¿—ã€‚è¿™ç±»ä¼¼äº <span class="hljs-string">&#x27;tail -f&#x27;</span> Linux å‘½ä»¤ã€‚</span>kubectl logs -f &lt;pod-name&gt;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubernetesåŸºç¡€ç¯‡-ç»„ä»¶</title>
    <link href="/2022/07/29/422/"/>
    <url>/2022/07/29/422/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetesç»„ä»¶"><a href="#Kubernetesç»„ä»¶" class="headerlink" title="Kubernetesç»„ä»¶"></a>Kubernetesç»„ä»¶</h1><h2 id="æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl-Plane-Componentsï¼‰"><a href="#æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl-Plane-Componentsï¼‰" class="headerlink" title="æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰"></a>æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰</h2><p>æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(æ¯”å¦‚è°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼Œå½“ä¸æ»¡è¶³éƒ¨ç½²çš„ <code>replicas</code> å­—æ®µæ—¶ï¼Œå¯åŠ¨æ–°çš„ <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/">pod</a>ï¼‰ã€‚</p><p>æ§åˆ¶å¹³é¢ç»„ä»¶å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ ç„¶è€Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè®¾ç½®è„šæœ¬é€šå¸¸ä¼šåœ¨åŒä¸€ä¸ªè®¡ç®—æœºä¸Šå¯åŠ¨æ‰€æœ‰æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œ å¹¶ä¸”ä¸ä¼šåœ¨æ­¤è®¡ç®—æœºä¸Šè¿è¡Œç”¨æˆ·å®¹å™¨ã€‚ è¯·å‚é˜…<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/high-availability/">ä½¿ç”¨ kubeadm æ„å»ºé«˜å¯ç”¨æ€§é›†ç¾¤</a> ä¸­å…³äºè·¨å¤šæœºå™¨æ§åˆ¶å¹³é¢è®¾ç½®çš„ç¤ºä¾‹ã€‚</p><h3 id="kube-apiserver"><a href="#kube-apiserver" class="headerlink" title="kube-apiserver"></a>kube-apiserver</h3><p>API æœåŠ¡å™¨æ˜¯ Kubernetes <a href="https://kubernetes.io/zh/docs/reference/glossary/?all=true#term-control-plane">æ§åˆ¶é¢</a>çš„ç»„ä»¶ï¼Œ è¯¥ç»„ä»¶å…¬å¼€äº† Kubernetes APIã€‚ API æœåŠ¡å™¨æ˜¯ Kubernetes æ§åˆ¶é¢çš„å‰ç«¯ã€‚</p><p>Kubernetes API æœåŠ¡å™¨çš„ä¸»è¦å®ç°æ˜¯ <a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-apiserver/">kube-apiserver</a>ã€‚ kube-apiserver è®¾è®¡ä¸Šè€ƒè™‘äº†æ°´å¹³ä¼¸ç¼©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯é€šè¿‡éƒ¨ç½²å¤šä¸ªå®ä¾‹è¿›è¡Œä¼¸ç¼©ã€‚ ä½ å¯ä»¥è¿è¡Œ kube-apiserver çš„å¤šä¸ªå®ä¾‹ï¼Œå¹¶åœ¨è¿™äº›å®ä¾‹ä¹‹é—´å¹³è¡¡æµé‡ã€‚</p><h3 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h3><p>etcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ã€‚</p><p>æ‚¨çš„ Kubernetes é›†ç¾¤çš„ etcd æ•°æ®åº“é€šå¸¸éœ€è¦æœ‰ä¸ªå¤‡ä»½è®¡åˆ’ã€‚</p><p>è¦äº†è§£ etcd æ›´æ·±å±‚æ¬¡çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ <a href="https://etcd.io/docs/">etcd æ–‡æ¡£</a>ã€‚</p><h3 id="kube-scheduler"><a href="#kube-scheduler" class="headerlink" title="kube-scheduler"></a>kube-scheduler</h3><p>æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œè´Ÿè´£ç›‘è§†æ–°åˆ›å»ºçš„ã€æœªæŒ‡å®šè¿è¡Œ<a href="https://kubernetes.io/zh/docs/concepts/architecture/nodes/">èŠ‚ç‚¹ï¼ˆnodeï¼‰</a>çš„ <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/">Pods</a>ï¼Œé€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚</p><p>è°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod å’Œ Pod é›†åˆçš„èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°å’Œæœ€åæ—¶é™ã€‚</p><h3 id="kube-controller-manager"><a href="#kube-controller-manager" class="headerlink" title="kube-controller-manager"></a>kube-controller-manager</h3><p>è¿è¡Œ<a href="https://kubernetes.io/zh/docs/concepts/architecture/controller/">æ§åˆ¶å™¨</a>è¿›ç¨‹çš„æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚</p><p>ä»é€»è¾‘ä¸Šè®²ï¼Œæ¯ä¸ª<a href="https://kubernetes.io/zh/docs/concepts/architecture/controller/">æ§åˆ¶å™¨</a>éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œ ä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚</p><p>è¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬:</p><ul><li>èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</li><li>ä»»åŠ¡æ§åˆ¶å™¨ï¼ˆJob controllerï¼‰: ç›‘æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„ Job å¯¹è±¡ï¼Œç„¶ååˆ›å»º Pods æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ</li><li>ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰: å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥ Service ä¸ Pod)</li><li>æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account &amp; Token Controllersï¼‰: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ</li></ul><h3 id="cloud-controller-manager"><a href="#cloud-controller-manager" class="headerlink" title="cloud-controller-manager"></a>cloud-controller-manager</h3><p>äº‘æ§åˆ¶å™¨ç®¡ç†å™¨æ˜¯æŒ‡åµŒå…¥ç‰¹å®šäº‘çš„æ§åˆ¶é€»è¾‘çš„ <a href="https://kubernetes.io/zh/docs/reference/glossary/?all=true#term-control-plane">æ§åˆ¶å¹³é¢</a>ç»„ä»¶ã€‚ äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ä½¿å¾—ä½ å¯ä»¥å°†ä½ çš„é›†ç¾¤è¿æ¥åˆ°äº‘æä¾›å•†çš„ API ä¹‹ä¸Šï¼Œ å¹¶å°†ä¸è¯¥äº‘å¹³å°äº¤äº’çš„ç»„ä»¶åŒä¸ä½ çš„é›†ç¾¤äº¤äº’çš„ç»„ä»¶åˆ†ç¦»å¼€æ¥ã€‚</p><p><code>cloud-controller-manager</code> ä»…è¿è¡Œç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶å›è·¯ã€‚ å¦‚æœä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„ç¯å¢ƒä¸­ä¸éœ€è¦äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚</p><p>ä¸ <code>kube-controller-manager</code> ç±»ä¼¼ï¼Œ<code>cloud-controller-manager</code> å°†è‹¥å¹²é€»è¾‘ä¸Šç‹¬ç«‹çš„ æ§åˆ¶å›è·¯ç»„åˆåˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¾›ä½ ä»¥åŒä¸€è¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚ ä½ å¯ä»¥å¯¹å…¶æ‰§è¡Œæ°´å¹³æ‰©å®¹ï¼ˆè¿è¡Œä¸æ­¢ä¸€ä¸ªå‰¯æœ¬ï¼‰ä»¥æå‡æ€§èƒ½æˆ–è€…å¢å¼ºå®¹é”™èƒ½åŠ›ã€‚</p><p>ä¸‹é¢çš„æ§åˆ¶å™¨éƒ½åŒ…å«å¯¹äº‘å¹³å°é©±åŠ¨çš„ä¾èµ–ï¼š</p><ul><li>èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: ç”¨äºåœ¨èŠ‚ç‚¹ç»ˆæ­¢å“åº”åæ£€æŸ¥äº‘æä¾›å•†ä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦å·²è¢«åˆ é™¤</li><li>è·¯ç”±æ§åˆ¶å™¨ï¼ˆRoute Controllerï¼‰: ç”¨äºåœ¨åº•å±‚äº‘åŸºç¡€æ¶æ„ä¸­è®¾ç½®è·¯ç”±</li><li>æœåŠ¡æ§åˆ¶å™¨ï¼ˆService Controllerï¼‰: ç”¨äºåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤äº‘æä¾›å•†è´Ÿè½½å‡è¡¡å™¨</li></ul><h2 id="Node-ç»„ä»¶"><a href="#Node-ç»„ä»¶" class="headerlink" title="Node ç»„ä»¶"></a>Node ç»„ä»¶</h2><p>èŠ‚ç‚¹ç»„ä»¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‚</p><h3 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h3><p>ä¸€ä¸ªåœ¨é›†ç¾¤ä¸­æ¯ä¸ª<a href="https://kubernetes.io/zh/docs/concepts/architecture/nodes/">èŠ‚ç‚¹ï¼ˆnodeï¼‰</a>ä¸Šè¿è¡Œçš„ä»£ç†ã€‚ å®ƒä¿è¯<a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/#why-containers">å®¹å™¨ï¼ˆcontainersï¼‰</a>éƒ½ è¿è¡Œåœ¨ <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/">Pod</a> ä¸­ã€‚</p><p>kubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ kubelet ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚</p><h3 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a>kube-proxy</h3><p><a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-proxy/">kube-proxy</a> æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œ å®ç° Kubernetes <a href="https://kubernetes.io/zh/docs/concepts/services-networking/service/">æœåŠ¡ï¼ˆServiceï¼‰</a> æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ã€‚</p><p>kube-proxy ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ã€‚è¿™äº›ç½‘ç»œè§„åˆ™å…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p><p>å¦‚æœæ“ä½œç³»ç»Ÿæä¾›äº†æ•°æ®åŒ…è¿‡æ»¤å±‚å¹¶å¯ç”¨çš„è¯ï¼Œkube-proxy ä¼šé€šè¿‡å®ƒæ¥å®ç°ç½‘ç»œè§„åˆ™ã€‚å¦åˆ™ï¼Œ kube-proxy ä»…è½¬å‘æµé‡æœ¬èº«ã€‚</p><h3 id="å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer-Runtimeï¼‰"><a href="#å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer-Runtimeï¼‰" class="headerlink" title="å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰"></a>å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰</h3><p>å®¹å™¨è¿è¡Œç¯å¢ƒæ˜¯è´Ÿè´£è¿è¡Œå®¹å™¨çš„è½¯ä»¶ã€‚</p><p>Kubernetes æ”¯æŒå®¹å™¨è¿è¡Œæ—¶ï¼Œä¾‹å¦‚ <a href="https://kubernetes.io/zh/docs/reference/kubectl/docker-cli-to-kubectl/">Docker</a>ã€ <a href="https://containerd.io/docs/">containerd</a>ã€<a href="https://cri-o.io/#what-is-cri-o">CRI-O</a> ä»¥åŠ <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md">Kubernetes CRI (å®¹å™¨è¿è¡Œç¯å¢ƒæ¥å£)</a> çš„å…¶ä»–ä»»ä½•å®ç°ã€‚</p><h2 id="æ’ä»¶ï¼ˆAddonsï¼‰"><a href="#æ’ä»¶ï¼ˆAddonsï¼‰" class="headerlink" title="æ’ä»¶ï¼ˆAddonsï¼‰"></a>æ’ä»¶ï¼ˆAddonsï¼‰</h2><p>æ’ä»¶ä½¿ç”¨ Kubernetes èµ„æºï¼ˆ<a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/daemonset/">DaemonSet</a>ã€ <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/">Deployment</a>ç­‰ï¼‰å®ç°é›†ç¾¤åŠŸèƒ½ã€‚ å› ä¸ºè¿™äº›æ’ä»¶æä¾›é›†ç¾¤çº§åˆ«çš„åŠŸèƒ½ï¼Œæ’ä»¶ä¸­å‘½åç©ºé—´åŸŸçš„èµ„æºå±äº <code>kube-system</code> å‘½åç©ºé—´ã€‚</p><p>ä¸‹é¢æè¿°ä¼—å¤šæ’ä»¶ä¸­çš„å‡ ç§ã€‚æœ‰å…³å¯ç”¨æ’ä»¶çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è§ <a href="https://kubernetes.io/zh/docs/concepts/cluster-administration/addons/">æ’ä»¶ï¼ˆAddonsï¼‰</a>ã€‚</p><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>å°½ç®¡å…¶ä»–æ’ä»¶éƒ½å¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„å¿…éœ€ç»„ä»¶ï¼Œä½†å‡ ä¹æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½åº”è¯¥ æœ‰<a href="https://kubernetes.io/zh/docs/concepts/services-networking/dns-pod-service/">é›†ç¾¤ DNS</a>ï¼Œ å› ä¸ºå¾ˆå¤šç¤ºä¾‹éƒ½éœ€è¦ DNS æœåŠ¡ã€‚</p><p>é›†ç¾¤ DNS æ˜¯ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œå’Œç¯å¢ƒä¸­çš„å…¶ä»– DNS æœåŠ¡å™¨ä¸€èµ·å·¥ä½œï¼Œå®ƒä¸º Kubernetes æœåŠ¡æä¾› DNS è®°å½•ã€‚</p><p>Kubernetes å¯åŠ¨çš„å®¹å™¨è‡ªåŠ¨å°†æ­¤ DNS æœåŠ¡å™¨åŒ…å«åœ¨å…¶ DNS æœç´¢åˆ—è¡¨ä¸­ã€‚</p><h3 id="Web-ç•Œé¢"><a href="#Web-ç•Œé¢" class="headerlink" title="Web ç•Œé¢"></a>Web ç•Œé¢</h3><p><a href="https://kubernetes.io/zh/docs/tasks/access-application-cluster/web-ui-dashboard/">Dashboard</a> æ˜¯ Kubernetes é›†ç¾¤çš„é€šç”¨çš„ã€åŸºäº Web çš„ç”¨æˆ·ç•Œé¢ã€‚ å®ƒä½¿ç”¨æˆ·å¯ä»¥ç®¡ç†é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä»¥åŠé›†ç¾¤æœ¬èº«å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚</p><p><a href="https://kuboard.cn/install/v3/install.html">Kuboard</a> æ˜¯ä¸€æ¬¾åŸºäºKubernetesçš„å¾®æœåŠ¡ç®¡ç†ç•Œé¢ï¼Œç›¸è¾ƒäºDashboard æ¦‚å¿µæ›´å¼ºå¤§ã€‚</p><h3 id="å®¹å™¨èµ„æºç›‘æ§"><a href="#å®¹å™¨èµ„æºç›‘æ§" class="headerlink" title="å®¹å™¨èµ„æºç›‘æ§"></a>å®¹å™¨èµ„æºç›‘æ§</h3><p><a href="https://kubernetes.io/zh/docs/tasks/debug/debug-cluster/resource-usage-monitoring/">å®¹å™¨èµ„æºç›‘æ§</a> å°†å…³äºå®¹å™¨çš„ä¸€äº›å¸¸è§çš„æ—¶é—´åºåˆ—åº¦é‡å€¼ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ•°æ®åº“ä¸­ï¼Œå¹¶æä¾›ç”¨äºæµè§ˆè¿™äº›æ•°æ®çš„ç•Œé¢ã€‚</p><h3 id="é›†ç¾¤å±‚é¢æ—¥å¿—"><a href="#é›†ç¾¤å±‚é¢æ—¥å¿—" class="headerlink" title="é›†ç¾¤å±‚é¢æ—¥å¿—"></a>é›†ç¾¤å±‚é¢æ—¥å¿—</h3><p><a href="https://kubernetes.io/zh/docs/concepts/cluster-administration/logging/">é›†ç¾¤å±‚é¢æ—¥å¿—</a> æœºåˆ¶è´Ÿè´£å°†å®¹å™¨çš„æ—¥å¿—æ•°æ® ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ—¥å¿—å­˜å‚¨ä¸­ï¼Œè¯¥å­˜å‚¨èƒ½å¤Ÿæä¾›æœç´¢å’Œæµè§ˆæ¥å£ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubernetesåŸºç¡€ç¯‡-æ¦‚å¿µ</title>
    <link href="/2022/07/24/421/"/>
    <url>/2022/07/24/421/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Kubernetes-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Kubernetes æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Kubernetes æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Kubernetes æ˜¯ç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼Œæ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å¼€æºç³»ç»Ÿã€‚</p><p><strong>Kubernetes</strong> è¿™ä¸ªåå­—æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸ºâ€œèˆµæ‰‹â€æˆ–â€œé£è¡Œå‘˜â€ã€‚k8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸º k å’Œ s ä¹‹é—´æœ‰å…«ä¸ªå­—ç¬¦çš„å…³ç³»ã€‚ Kubernetesåœ¨ 2014 å¹´å®ç°å¼€æºï¼Œæºè‡ªGoogleå†…éƒ¨ç¼–æ’å·¥å…· Borg ã€‚</p><h2 id="éƒ¨ç½²å›æº¯"><a href="#éƒ¨ç½²å›æº¯" class="headerlink" title="éƒ¨ç½²å›æº¯"></a>éƒ¨ç½²å›æº¯</h2><p><strong>1. ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£ï¼š</strong></p><p>æ—©æœŸï¼Œå„ä¸ªç»„ç»‡æœºæ„åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚æ— æ³•ä¸ºç‰©ç†æœåŠ¡å™¨ä¸­çš„åº”ç”¨ç¨‹åºå®šä¹‰èµ„æºè¾¹ç•Œï¼Œè¿™ä¼šå¯¼è‡´èµ„æºåˆ†é…é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨ç¨‹åºå ç”¨å¤§éƒ¨åˆ†èµ„æºçš„æƒ…å†µï¼Œ ç»“æœå¯èƒ½å¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚ ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ç”±äºèµ„æºåˆ©ç”¨ä¸è¶³è€Œæ— æ³•æ‰©å±•ï¼Œ å¹¶ä¸”ç»´æŠ¤è®¸å¤šç‰©ç†æœåŠ¡å™¨çš„æˆæœ¬å¾ˆé«˜ã€‚</p><p><strong>2. è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼š</strong></p><p>ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Œå¼•å…¥äº†è™šæ‹ŸåŒ–ã€‚è™šæ‹ŸåŒ–æŠ€æœ¯å…è®¸ä½ åœ¨å•ä¸ªç‰©ç†æœåŠ¡å™¨çš„ CPU ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼ˆVMï¼‰ã€‚ è™šæ‹ŸåŒ–å…è®¸åº”ç”¨ç¨‹åºåœ¨ VM ä¹‹é—´éš”ç¦»ï¼Œå¹¶æä¾›ä¸€å®šç¨‹åº¦çš„å®‰å…¨ï¼Œå› ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ ä¸èƒ½è¢«å¦ä¸€åº”ç”¨ç¨‹åºéšæ„è®¿é—®ã€‚</p><p>è™šæ‹ŸåŒ–æŠ€æœ¯èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç‰©ç†æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå¹¶ä¸”å› ä¸ºå¯è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°åº”ç”¨ç¨‹åº è€Œå¯ä»¥å®ç°æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ï¼Œé™ä½ç¡¬ä»¶æˆæœ¬ç­‰ç­‰ã€‚</p><p>æ¯ä¸ª VM æ˜¯ä¸€å°å®Œæ•´çš„è®¡ç®—æœºï¼Œåœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶ä¹‹ä¸Šè¿è¡Œæ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿã€‚</p><p><strong>3. å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼š</strong></p><p>å®¹å™¨ç±»ä¼¼äº VMï¼Œä½†æ˜¯å®ƒä»¬å…·æœ‰è¢«æ”¾å®½çš„éš”ç¦»å±æ€§ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ã€‚ å› æ­¤ï¼Œå®¹å™¨è¢«è®¤ä¸ºæ˜¯è½»é‡çº§çš„ã€‚å®¹å™¨ä¸ VM ç±»ä¼¼ï¼Œå…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ã€‚ ç”±äºå®ƒä»¬ä¸åŸºç¡€æ¶æ„åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥è·¨äº‘å’Œ OS å‘è¡Œç‰ˆæœ¬è¿›è¡Œç§»æ¤ã€‚</p><p>å®¹å™¨å› å…·æœ‰è®¸å¤šä¼˜åŠ¿è€Œå˜å¾—æµè¡Œèµ·æ¥ã€‚ä¸‹é¢åˆ—å‡ºçš„æ˜¯å®¹å™¨çš„ä¸€äº›å¥½å¤„ï¼š</p><ul><li>æ•æ·åº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œéƒ¨ç½²ï¼šä¸ä½¿ç”¨ VM é•œåƒç›¸æ¯”ï¼Œæé«˜äº†å®¹å™¨é•œåƒåˆ›å»ºçš„ç®€ä¾¿æ€§å’Œæ•ˆç‡ã€‚</li><li>æŒç»­å¼€å‘ã€é›†æˆå’Œéƒ¨ç½²ï¼šé€šè¿‡å¿«é€Ÿç®€å•çš„å›æ»šï¼ˆç”±äºé•œåƒä¸å¯å˜æ€§ï¼‰ï¼Œæ”¯æŒå¯é ä¸”é¢‘ç¹çš„ å®¹å™¨é•œåƒæ„å»ºå’Œéƒ¨ç½²ã€‚</li><li>å…³æ³¨å¼€å‘ä¸è¿ç»´çš„åˆ†ç¦»ï¼šåœ¨æ„å»º/å‘å¸ƒæ—¶è€Œä¸æ˜¯åœ¨éƒ¨ç½²æ—¶åˆ›å»ºåº”ç”¨ç¨‹åºå®¹å™¨é•œåƒï¼Œ ä»è€Œå°†åº”ç”¨ç¨‹åºä¸åŸºç¡€æ¶æ„åˆ†ç¦»ã€‚</li><li>å¯è§‚å¯Ÿæ€§ï¼šä¸ä»…å¯ä»¥æ˜¾ç¤ºæ“ä½œç³»ç»Ÿçº§åˆ«çš„ä¿¡æ¯å’ŒæŒ‡æ ‡ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µå’Œå…¶ä»–æŒ‡æ ‡ä¿¡å·ã€‚</li><li>è·¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§çš„ç¯å¢ƒä¸€è‡´æ€§ï¼šåœ¨ä¾¿æºå¼è®¡ç®—æœºä¸Šä¸åœ¨äº‘ä¸­ç›¸åŒåœ°è¿è¡Œã€‚</li><li>è·¨äº‘å’Œæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆæœ¬çš„å¯ç§»æ¤æ€§ï¼šå¯åœ¨ Ubuntuã€RHELã€CoreOSã€æœ¬åœ°ã€ Google Kubernetes Engine å’Œå…¶ä»–ä»»ä½•åœ°æ–¹è¿è¡Œã€‚</li><li>ä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒçš„ç®¡ç†ï¼šæé«˜æŠ½è±¡çº§åˆ«ï¼Œä»åœ¨è™šæ‹Ÿç¡¬ä»¶ä¸Šè¿è¡Œ OS åˆ°ä½¿ç”¨é€»è¾‘èµ„æºåœ¨ OS ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚</li><li>æ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡ï¼šåº”ç”¨ç¨‹åºè¢«åˆ†è§£æˆè¾ƒå°çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œ å¹¶ä¸”å¯ä»¥åŠ¨æ€éƒ¨ç½²å’Œç®¡ç† - è€Œä¸æ˜¯åœ¨ä¸€å°å¤§å‹å•æœºä¸Šæ•´ä½“è¿è¡Œã€‚</li><li>èµ„æºéš”ç¦»ï¼šå¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</li><li>èµ„æºåˆ©ç”¨ï¼šé«˜æ•ˆç‡å’Œé«˜å¯†åº¦ã€‚</li></ul><h2 id="Kubernetesçš„åŠŸèƒ½"><a href="#Kubernetesçš„åŠŸèƒ½" class="headerlink" title="Kubernetesçš„åŠŸèƒ½"></a>Kubernetesçš„åŠŸèƒ½</h2><p>Kubernetes æä¾›ä»¥ä¸‹ç‰¹æ€§:</p><ul><li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li><li>å­˜å‚¨ç¼–æ’</li><li>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</li><li>è‡ªåŠ¨å®Œæˆé›†è£…è®¡ç®—</li><li>è‡ªæˆ‘ä¿®å¤</li><li>å¯†é’¥ä¸é…ç½®ç®¡ç†</li></ul><h2 id="Kubernetes-çš„è¾¹ç•Œ"><a href="#Kubernetes-çš„è¾¹ç•Œ" class="headerlink" title="Kubernetes çš„è¾¹ç•Œ"></a>Kubernetes çš„è¾¹ç•Œ</h2><p>Kubernetes ä¸æ˜¯ä¼ ç»Ÿçš„ã€åŒ…ç½—ä¸‡è±¡çš„ PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰ç³»ç»Ÿã€‚ ç”±äº Kubernetes åœ¨å®¹å™¨çº§åˆ«è€Œä¸æ˜¯åœ¨ç¡¬ä»¶çº§åˆ«è¿è¡Œï¼Œå®ƒæä¾›äº† PaaS äº§å“å…±æœ‰çš„ä¸€äº›æ™®éé€‚ç”¨çš„åŠŸèƒ½ï¼Œ ä¾‹å¦‚éƒ¨ç½²ã€æ‰©å±•ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘è§†ã€‚ ä½†æ˜¯ï¼ŒKubernetes ä¸æ˜¯å•ä½“ç³»ç»Ÿï¼Œé»˜è®¤è§£å†³æ–¹æ¡ˆéƒ½æ˜¯å¯é€‰å’Œå¯æ’æ‹”çš„ã€‚ Kubernetes æä¾›äº†æ„å»ºå¼€å‘äººå‘˜å¹³å°çš„åŸºç¡€ï¼Œä½†æ˜¯åœ¨é‡è¦çš„åœ°æ–¹ä¿ç•™äº†ç”¨æˆ·çš„é€‰æ‹©å’Œçµæ´»æ€§ã€‚</p><p>Kubernetesï¼š</p><ul><li><p>ä¸é™åˆ¶æ”¯æŒçš„åº”ç”¨ç¨‹åºç±»å‹ã€‚ Kubernetes æ—¨åœ¨æ”¯æŒæå…¶å¤šç§å¤šæ ·çš„å·¥ä½œè´Ÿè½½ï¼ŒåŒ…æ‹¬æ— çŠ¶æ€ã€æœ‰çŠ¶æ€å’Œæ•°æ®å¤„ç†å·¥ä½œè´Ÿè½½ã€‚ å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å¯ä»¥åœ¨ Kubernetes ä¸Šå¾ˆå¥½åœ°è¿è¡Œã€‚</p></li><li><p>ä¸éƒ¨ç½²æºä»£ç ï¼Œä¹Ÿä¸æ„å»ºä½ çš„åº”ç”¨ç¨‹åºã€‚ æŒç»­é›†æˆ(CI)ã€äº¤ä»˜å’Œéƒ¨ç½²ï¼ˆCI/CDï¼‰å·¥ä½œæµå–å†³äºç»„ç»‡çš„æ–‡åŒ–å’Œåå¥½ä»¥åŠæŠ€æœ¯è¦æ±‚ã€‚</p></li><li><p>ä¸æä¾›åº”ç”¨ç¨‹åºçº§åˆ«çš„æœåŠ¡ä½œä¸ºå†…ç½®æœåŠ¡ï¼Œä¾‹å¦‚ä¸­é—´ä»¶ï¼ˆä¾‹å¦‚ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼‰ã€ æ•°æ®å¤„ç†æ¡†æ¶ï¼ˆä¾‹å¦‚ï¼ŒSparkï¼‰ã€æ•°æ®åº“ï¼ˆä¾‹å¦‚ï¼Œmysqlï¼‰ã€ç¼“å­˜ã€é›†ç¾¤å­˜å‚¨ç³»ç»Ÿ ï¼ˆä¾‹å¦‚ï¼ŒCephï¼‰ã€‚è¿™æ ·çš„ç»„ä»¶å¯ä»¥åœ¨ Kubernetes ä¸Šè¿è¡Œï¼Œå¹¶ä¸”/æˆ–è€…å¯ä»¥ç”±è¿è¡Œåœ¨ Kubernetes ä¸Šçš„åº”ç”¨ç¨‹åºé€šè¿‡å¯ç§»æ¤æœºåˆ¶ï¼ˆä¾‹å¦‚ï¼Œ <a href="https://openservicebrokerapi.org/">å¼€æ”¾æœåŠ¡ä»£ç†</a>ï¼‰æ¥è®¿é—®ã€‚</p></li><li><p>ä¸è¦æ±‚æ—¥å¿—è®°å½•ã€ç›‘è§†æˆ–è­¦æŠ¥è§£å†³æ–¹æ¡ˆã€‚ å®ƒæä¾›äº†ä¸€äº›é›†æˆä½œä¸ºæ¦‚å¿µè¯æ˜ï¼Œå¹¶æä¾›äº†æ”¶é›†å’Œå¯¼å‡ºæŒ‡æ ‡çš„æœºåˆ¶ã€‚</p></li><li><p>ä¸æä¾›æˆ–ä¸è¦æ±‚é…ç½®è¯­è¨€/ç³»ç»Ÿï¼ˆä¾‹å¦‚ jsonnetï¼‰ï¼Œå®ƒæä¾›äº†å£°æ˜æ€§ APIï¼Œ è¯¥å£°æ˜æ€§ API å¯ä»¥ç”±ä»»æ„å½¢å¼çš„å£°æ˜æ€§è§„èŒƒæ‰€æ„æˆã€‚</p></li><li><p>ä¸æä¾›ä¹Ÿä¸é‡‡ç”¨ä»»ä½•å…¨é¢çš„æœºå™¨é…ç½®ã€ç»´æŠ¤ã€ç®¡ç†æˆ–è‡ªæˆ‘ä¿®å¤ç³»ç»Ÿã€‚</p></li><li><p>æ­¤å¤–ï¼ŒKubernetes ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¼–æ’ç³»ç»Ÿï¼Œå®é™…ä¸Šå®ƒæ¶ˆé™¤äº†ç¼–æ’çš„éœ€è¦ã€‚ ç¼–æ’çš„æŠ€æœ¯å®šä¹‰æ˜¯æ‰§è¡Œå·²å®šä¹‰çš„å·¥ä½œæµç¨‹ï¼šé¦–å…ˆæ‰§è¡Œ Aï¼Œç„¶åæ‰§è¡Œ Bï¼Œå†æ‰§è¡Œ Cã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼ŒKubernetes åŒ…å«ä¸€ç»„ç‹¬ç«‹çš„ã€å¯ç»„åˆçš„æ§åˆ¶è¿‡ç¨‹ï¼Œ è¿™äº›è¿‡ç¨‹è¿ç»­åœ°å°†å½“å‰çŠ¶æ€é©±åŠ¨åˆ°æ‰€æä¾›çš„æ‰€éœ€çŠ¶æ€ã€‚ å¦‚ä½•ä» A åˆ° C çš„æ–¹å¼æ— å…³ç´§è¦ï¼Œä¹Ÿä¸éœ€è¦é›†ä¸­æ§åˆ¶ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ ä¸”åŠŸèƒ½æ›´å¼ºå¤§ã€ç³»ç»Ÿæ›´å¥å£®ã€æ›´ä¸ºå¼¹æ€§å’Œå¯æ‰©å±•ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>k8s-learing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s-learing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jwtéªŒè¯å¤±è´¥çš„é—®é¢˜</title>
    <link href="/2022/07/20/410/"/>
    <url>/2022/07/20/410/</url>
    
    <content type="html"><![CDATA[<p>jwt åº”è¯¥æ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­ä¹Ÿæœ‰ç”¨åˆ°ï¼Œæœ€è¿‘å‡ºç°å‡ æ¬¡é—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ï¼Œæˆ–è®¸èƒ½å¸®åŠ©åˆ°å¤§å®¶ã€‚</p><p>PS: æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <a href="https://github.com/dgrijalva/jwt-go">github.com/dgrijalva/jwt-go</a></p><h3 id="Token-not-active-yet"><a href="#Token-not-active-yet" class="headerlink" title="Token not active yet"></a>Token not active yet</h3><p>å‰é¢å‡ ä¸ªæœˆå‡ºç°è¿‡æç¤º Token not active yetï¼Œåé¢è¶Šæ¥è¶Šé¢‘ç¹ï¼ŒåŸå› å…¶å®å°±æ˜¯ nbf è¿™ä¸ªæ—¶é—´æˆ³æ¯”éªŒè¯ jwt çš„æ—¶é—´è¿Ÿã€‚</p><h3 id="Token-used-before-issued-Couldnâ€™t-handle-this-token"><a href="#Token-used-before-issued-Couldnâ€™t-handle-this-token" class="headerlink" title="Token used before issued, Couldnâ€™t handle this token"></a>Token used before issued, Couldnâ€™t handle this token</h3><p>è¿™ä¸¤å¤©å‡ºç°ä¸€æ¬¡ Couldnâ€™t handle this tokenï¼Œ æ‰“å°æ—¥å¿—çŸ¥é“æ˜¯ Token used before issuedï¼ŒåŸå› æ˜¯ iat è¿™ä¸ªæ—¶é—´æˆ³æ¯”éªŒè¯ jwt çš„æ—¶é—´è¿Ÿã€‚</p><p>å…¶å®è§£å†³æ¯”è¾ƒç®€å•ï¼ŒæŠŠé‚£ä¸¤ä¸ªæ—¶é—´å‡å»60sã€‚</p><p>æ ¹æœ¬åŸå› åº”è¯¥æ˜¯å¤šå°æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´ï¼Œå¯èƒ½å·®äº†ä¸€ä¸¢ä¸¢ï¼Œå‡ºç°ç­¾å‘æ—¶é—´æ¯”éªŒè¯æ—¶é—´è¿Ÿçš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åŒæ­¥æ—¶é—´ï¼ˆæˆ‘ä¸ºå•¥ä¸ç”¨â€”å› ä¸ºæœ‰ç‚¹éº»çƒ¦ï¼‰</p><p>jwt æ–‡æ¡£å’Œå·¥å…·å‚è€ƒï¼š</p><ul><li><a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1">rfc7519</a></li><li><a href="https://jwt.io/">jwt.io</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>jwt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jwt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥å‰–æKubernetesä¹‹Pod</title>
    <link href="/2022/07/05/409/"/>
    <url>/2022/07/05/409/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Podï¼Œæ˜¯ Kubernetes é¡¹ç›®ä¸­çš„æœ€å°ç¼–æ’å•ä½ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ‰®æ¼”ä¼ ç»ŸåŸºç¡€è®¾æ–½é‡Œâ€œè™šæ‹Ÿæœºâ€çš„è§’è‰²ï¼›è€Œå®¹å™¨ï¼Œåˆ™æ˜¯è¿™ä¸ªè™šæ‹Ÿæœºé‡Œè¿è¡Œçš„ç”¨æˆ·ç¨‹åºã€‚</p></blockquote><p>å‡¡æ˜¯è°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ï¼Œä»¥åŠå®‰å…¨ç›¸å…³çš„å±æ€§ï¼ŒåŸºæœ¬ä¸Šæ˜¯ Pod çº§åˆ«çš„ã€‚</p><p>ğŸŒ°</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">lifecycle-demo</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">containers:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">lifecycle-demo-container</span>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span>    <span class="hljs-attr">lifecycle:</span>      <span class="hljs-attr">postStart:</span>        <span class="hljs-attr">exec:</span>          <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo Hello from the postStart handler &gt; /usr/share/message&quot;</span>]      <span class="hljs-attr">preStop:</span>        <span class="hljs-attr">exec:</span>          <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/usr/sbin/nginx&quot;</span>,<span class="hljs-string">&quot;-s&quot;</span>,<span class="hljs-string">&quot;quit&quot;</span>]</code></pre></div><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>Pod ç”Ÿå‘½å‘¨æœŸï¼š(ä¸»è¦ä½“ç°åœ¨ Pod API å¯¹è±¡çš„Status éƒ¨åˆ†)</p><ol><li>Pendingã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼ŒPod çš„ YAML æ–‡ä»¶å·²ç»æäº¤ç»™äº† Kubernetesï¼ŒAPI å¯¹è±¡å·²ç»è¢«åˆ›å»ºå¹¶ä¿å­˜åœ¨ Etcd å½“ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ª Pod é‡Œæœ‰äº›å®¹å™¨å› ä¸ºæŸç§åŸå› è€Œä¸èƒ½è¢«é¡ºåˆ©åˆ›å»ºã€‚æ¯”å¦‚ï¼Œè°ƒåº¦ä¸æˆåŠŸã€‚</li><li>Runningã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒPod å·²ç»è°ƒåº¦æˆåŠŸï¼Œè·Ÿä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹ç»‘å®šã€‚å®ƒåŒ…å«çš„å®¹å™¨éƒ½å·²ç»åˆ›å»ºæˆåŠŸï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­ã€‚</li><li>Succeededã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼ŒPod é‡Œçš„æ‰€æœ‰å®¹å™¨éƒ½æ­£å¸¸è¿è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”å·²ç»é€€å‡ºäº†ã€‚è¿™ç§æƒ…å†µåœ¨è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡æ—¶æœ€ä¸ºå¸¸è§ã€‚</li><li>Failedã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒPod é‡Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥ä¸æ­£å¸¸çš„çŠ¶æ€ï¼ˆé 0 çš„è¿”å›ç ï¼‰é€€å‡ºã€‚è¿™ä¸ªçŠ¶æ€çš„å‡ºç°ï¼Œæ„å‘³ç€ä½ å¾—æƒ³åŠæ³• Debug è¿™ä¸ªå®¹å™¨çš„åº”ç”¨ï¼Œæ¯”å¦‚æŸ¥çœ‹ Pod çš„ Events å’Œæ—¥å¿—ã€‚</li><li>Unknownã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸çŠ¶æ€ï¼Œæ„å‘³ç€ Pod çš„çŠ¶æ€ä¸èƒ½æŒç»­åœ°è¢« kubelet æ±‡æŠ¥ç»™ kube-apiserverï¼Œè¿™å¾ˆæœ‰å¯èƒ½æ˜¯ä¸»ä»èŠ‚ç‚¹ï¼ˆMaster å’Œ Kubeletï¼‰é—´çš„é€šä¿¡å‡ºç°äº†é—®é¢˜ã€‚</li></ol><p>æ›´è¿›ä¸€æ­¥åœ°ï¼ŒPod å¯¹è±¡çš„ Status å­—æ®µï¼Œè¿˜å¯ä»¥å†ç»†åˆ†å‡ºä¸€ç»„ Conditionsã€‚è¿™äº›ç»†åˆ†çŠ¶æ€çš„å€¼åŒ…æ‹¬ï¼šPodScheduledã€Readyã€Initializedï¼Œä»¥åŠ Unschedulableã€‚å®ƒä»¬ä¸»è¦ç”¨äºæè¿°é€ æˆå½“å‰ Status çš„å…·ä½“åŸå› æ˜¯ä»€ä¹ˆã€‚</p><p>æ¯”å¦‚ï¼ŒPod å½“å‰çš„ Status æ˜¯ Pendingï¼Œå¯¹åº”çš„ Condition æ˜¯ Unschedulableï¼Œè¿™å°±æ„å‘³ç€å®ƒçš„è°ƒåº¦å‡ºç°äº†é—®é¢˜ã€‚</p><h3 id="Projected-Volume"><a href="#Projected-Volume" class="headerlink" title="Projected Volume"></a>Projected Volume</h3><p>Kubernetes æ”¯æŒçš„ Projected Volume ä¸€å…±æœ‰å››ç§ï¼š</p><ul><li>Secret</li><li>ConfigMap</li><li>Downward API</li><li>ServiceAccountToken</li></ul><h4 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h4><p>Secret æœ€å…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼Œè«è¿‡äºå­˜æ”¾æ•°æ®åº“çš„ Credential ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">test-projected-volume</span> <span class="hljs-attr">spec:</span>  <span class="hljs-attr">containers:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test-secret-volume</span>    <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span>    <span class="hljs-attr">args:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">sleep</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;86400&quot;</span>    <span class="hljs-attr">volumeMounts:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-cred</span>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">&quot;/projected-volume&quot;</span>      <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span>  <span class="hljs-attr">volumes:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-cred</span>    <span class="hljs-attr">projected:</span>      <span class="hljs-attr">sources:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">secret:</span>          <span class="hljs-attr">name:</span> <span class="hljs-string">user</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">secret:</span>          <span class="hljs-attr">name:</span> <span class="hljs-string">pass</span></code></pre></div><p>è¿™é‡Œç”¨åˆ°çš„æ•°æ®åº“çš„ç”¨æˆ·åã€å¯†ç ï¼Œæ­£æ˜¯ä»¥ Secret å¯¹è±¡çš„æ–¹å¼äº¤ç»™ Kubernetes ä¿å­˜çš„ã€‚å®Œæˆè¿™ä¸ªæ“ä½œçš„æŒ‡ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">cat ./username.txtsaicat ./password.txt123456 kubectl create secret generic user --from-file=./username.txtkubectl create secret generic pass --from-file=./password.txt</code></pre></div><p>å…¶ä¸­ï¼Œusername.txt å’Œ password.txt æ–‡ä»¶é‡Œï¼Œå­˜æ”¾çš„å°±æ˜¯ç”¨æˆ·åå’Œå¯†ç ï¼›è€Œ user å’Œ passï¼Œåˆ™æ˜¯æˆ‘ä¸º Secret å¯¹è±¡æŒ‡å®šçš„åå­—ã€‚è€Œæˆ‘æƒ³è¦æŸ¥çœ‹è¿™äº› Secret å¯¹è±¡çš„è¯ï¼Œåªè¦æ‰§è¡Œä¸€æ¡ kubectl get å‘½ä»¤å°±å¯ä»¥äº†ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">kubectl get secretsNAME           TYPE                                DATA      AGEuser          Opaque                                1         51spass          Opaque                                1         51s</code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSecret å¯¹è±¡è¦æ±‚è¿™äº›æ•°æ®å¿…é¡»æ˜¯ç»è¿‡ Base64 è½¬ç çš„ï¼Œä»¥å…å‡ºç°æ˜æ–‡å¯†ç çš„å®‰å…¨éšæ‚£ã€‚</p><h4 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h4><p>ä¸ Secret çš„åŒºåˆ«åœ¨äºï¼ŒConfigMap ä¿å­˜çš„æ˜¯ä¸éœ€è¦åŠ å¯†çš„ã€åº”ç”¨æ‰€éœ€çš„é…ç½®ä¿¡æ¯ã€‚è€Œ ConfigMap çš„ç”¨æ³•å‡ ä¹ä¸ Secret å®Œå…¨ç›¸åŒï¼šä½ å¯ä»¥ä½¿ç”¨ kubectl create configmap ä»æ–‡ä»¶æˆ–è€…ç›®å½•åˆ›å»º ConfigMapï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç¼–å†™ ConfigMap å¯¹è±¡çš„ YAML æ–‡ä»¶ã€‚</p><h4 id="Downward-API"><a href="#Downward-API" class="headerlink" title="Downward API"></a>Downward API</h4><p>å®ƒçš„ä½œç”¨æ˜¯ï¼šè®© Pod é‡Œçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥è·å–åˆ°è¿™ä¸ª Pod API å¯¹è±¡æœ¬èº«çš„ä¿¡æ¯ã€‚</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">test-downwardapi-volume</span>  <span class="hljs-attr">labels:</span>    <span class="hljs-attr">zone:</span> <span class="hljs-string">us-est-coast</span>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">test-cluster1</span>    <span class="hljs-attr">rack:</span> <span class="hljs-string">rack-22</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">containers:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">client-container</span>      <span class="hljs-attr">image:</span> <span class="hljs-string">k8s.gcr.io/busybox</span>      <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>]      <span class="hljs-attr">args:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">while</span> <span class="hljs-literal">true</span><span class="hljs-string">;</span> <span class="hljs-string">do</span>          <span class="hljs-string">if</span> [[ <span class="hljs-string">-e</span> <span class="hljs-string">/etc/podinfo/labels</span> ]]<span class="hljs-string">;</span> <span class="hljs-string">then</span>            <span class="hljs-string">echo</span> <span class="hljs-string">-en</span> <span class="hljs-string">&#x27;\n\n&#x27;</span><span class="hljs-string">;</span> <span class="hljs-string">cat</span> <span class="hljs-string">/etc/podinfo/labels;</span> <span class="hljs-string">fi;</span>          <span class="hljs-string">sleep</span> <span class="hljs-number">5</span><span class="hljs-string">;</span>        <span class="hljs-string">done;</span>      <span class="hljs-attr">volumeMounts:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">podinfo</span>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/podinfo</span>          <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">false</span>  <span class="hljs-attr">volumes:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">podinfo</span>      <span class="hljs-attr">projected:</span>        <span class="hljs-attr">sources:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">downwardAPI:</span>            <span class="hljs-attr">items:</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;labels&quot;</span>                <span class="hljs-attr">fieldRef:</span>                  <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.labels</span></code></pre></div><p>åœ¨è¿™ä¸ª Pod çš„ YAML æ–‡ä»¶ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼Œå£°æ˜äº†ä¸€ä¸ª projected ç±»å‹çš„ Volumeã€‚åªä¸è¿‡è¿™æ¬¡ Volume çš„æ•°æ®æ¥æºï¼Œå˜æˆäº† Downward APIã€‚è€Œè¿™ä¸ª Downward API Volumeï¼Œåˆ™å£°æ˜äº†è¦æš´éœ² Pod çš„ metadata.labels ä¿¡æ¯ç»™å®¹å™¨ã€‚</p><p>é€šè¿‡è¿™æ ·çš„å£°æ˜æ–¹å¼ï¼Œå½“å‰ Pod çš„ Labels å­—æ®µçš„å€¼ï¼Œå°±ä¼šè¢« Kubernetes è‡ªåŠ¨æŒ‚è½½æˆä¸ºå®¹å™¨é‡Œçš„ /etc/podinfo/labels æ–‡ä»¶ã€‚</p><p>PS:<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDownward API èƒ½å¤Ÿè·å–åˆ°çš„ä¿¡æ¯ï¼Œä¸€å®šæ˜¯ Pod é‡Œçš„å®¹å™¨è¿›ç¨‹å¯åŠ¨ä¹‹å‰å°±èƒ½å¤Ÿç¡®å®šä¸‹æ¥çš„ä¿¡æ¯ã€‚è€Œå¦‚æœä½ æƒ³è¦è·å– Pod å®¹å™¨è¿è¡Œåæ‰ä¼šå‡ºç°çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œå®¹å™¨è¿›ç¨‹çš„ PIDï¼Œé‚£å°±è‚¯å®šä¸èƒ½ä½¿ç”¨ Downward API äº†ï¼Œè€Œåº”è¯¥è€ƒè™‘åœ¨ Pod é‡Œå®šä¹‰ä¸€ä¸ª sidecar å®¹å™¨ã€‚</p><h4 id="ServiceAccountToken"><a href="#ServiceAccountToken" class="headerlink" title="ServiceAccountToken"></a>ServiceAccountToken</h4><p>ä¸€ç§ç‰¹æ®Šçš„ Secret</p><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒKubernetes å·²ç»ä¸ºä½ æä¾›äº†ä¸€ä¸ªçš„é»˜è®¤â€œæœåŠ¡è´¦æˆ·â€ï¼ˆdefault Service Accountï¼‰ã€‚å¹¶ä¸”ï¼Œä»»ä½•ä¸€ä¸ªè¿è¡Œåœ¨ Kubernetes é‡Œçš„ Podï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé»˜è®¤çš„ Service Accountï¼Œè€Œæ— éœ€æ˜¾ç¤ºåœ°å£°æ˜æŒ‚è½½å®ƒã€‚</p><h3 id="å®¹å™¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶"><a href="#å®¹å™¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶" class="headerlink" title="å®¹å™¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶"></a>å®¹å™¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶</h3><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">labels:</span>    <span class="hljs-attr">test:</span> <span class="hljs-string">liveness</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">test-liveness-exec</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">containers:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">liveness</span>    <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span>    <span class="hljs-attr">args:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/sh</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">-c</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">touch</span> <span class="hljs-string">/tmp/healthy;</span> <span class="hljs-string">sleep</span> <span class="hljs-number">30</span><span class="hljs-string">;</span> <span class="hljs-string">rm</span> <span class="hljs-string">-rf</span> <span class="hljs-string">/tmp/healthy;</span> <span class="hljs-string">sleep</span> <span class="hljs-number">600</span>    <span class="hljs-attr">livenessProbe:</span>      <span class="hljs-attr">exec:</span>        <span class="hljs-attr">command:</span>        <span class="hljs-bullet">-</span> <span class="hljs-string">cat</span>        <span class="hljs-bullet">-</span> <span class="hljs-string">/tmp/healthy</span>      <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span>      <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">5</span></code></pre></div><p>åœ¨è¿™ä¸ª Pod ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœ‰è¶£çš„å®¹å™¨ã€‚å®ƒåœ¨å¯åŠ¨ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åœ¨ /tmp ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ª healthy æ–‡ä»¶ï¼Œä»¥æ­¤ä½œä¸ºè‡ªå·±å·²ç»æ­£å¸¸è¿è¡Œçš„æ ‡å¿—ã€‚è€Œ 30 s è¿‡åï¼Œå®ƒä¼šæŠŠè¿™ä¸ªæ–‡ä»¶åˆ é™¤æ‰ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¿™æ ·çš„ livenessProbeï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚å®ƒçš„ç±»å‹æ˜¯ execï¼Œè¿™æ„å‘³ç€ï¼Œå®ƒä¼šåœ¨å®¹å™¨å¯åŠ¨åï¼Œåœ¨å®¹å™¨é‡Œé¢æ‰§è¡Œä¸€å¥æˆ‘ä»¬æŒ‡å®šçš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼šâ€œcat /tmp/healthyâ€ã€‚è¿™æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶å­˜åœ¨ï¼Œè¿™æ¡å‘½ä»¤çš„è¿”å›å€¼å°±æ˜¯ 0ï¼ŒPod å°±ä¼šè®¤ä¸ºè¿™ä¸ªå®¹å™¨ä¸ä»…å·²ç»å¯åŠ¨ï¼Œè€Œä¸”æ˜¯å¥åº·çš„ã€‚è¿™ä¸ªå¥åº·æ£€æŸ¥ï¼Œåœ¨å®¹å™¨å¯åŠ¨ 5 s åå¼€å§‹æ‰§è¡Œï¼ˆinitialDelaySeconds: 5ï¼‰ï¼Œæ¯ 5 s æ‰§è¡Œä¸€æ¬¡ï¼ˆperiodSeconds: 5ï¼‰ã€‚</p><p>ä½ ä¸å¦¨å°è¯•ä¸€ä¸‹è¿è¡Œè¿™ä¸ªpodï¼Œæš´éœ²ä¸€ä¸ªå¥åº·å‡äº§ url å’Œ ç›‘å¬ç«¯å£æ˜¯éå¸¸å¸¸è§çš„ã€‚</p><p>å¯¹äº Web æœåŠ¡åº”ç”¨ï¼Œ</p><p>PSï¼š<br>Kubernetes ä¸­å¹¶æ²¡æœ‰ Docker çš„ Stop è¯­ä¹‰ã€‚æ‰€ä»¥è™½ç„¶æ˜¯ Restartï¼ˆé‡å¯ï¼‰ï¼Œä½†å®é™…å´æ˜¯é‡æ–°åˆ›å»ºäº†å®¹å™¨ã€‚</p><p>restartPolicyï¼Œæ”¹å˜ Pod çš„æ¢å¤ç­–ç•¥</p><ul><li>Alwaysï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å®¹å™¨ä¸åœ¨è¿è¡ŒçŠ¶æ€ï¼Œå°±è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›</li><li>OnFailure: åªåœ¨å®¹å™¨ å¼‚å¸¸æ—¶æ‰è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›</li><li>Never: ä»æ¥ä¸é‡å¯å®¹å™¨ã€‚</li></ul><p>è®°ä½å¦‚ä¸‹ä¸¤ä¸ªåŸºæœ¬çš„è®¾è®¡åŸç†å³å¯ï¼š</p><ul><li>åªè¦ Pod çš„ restartPolicy æŒ‡å®šçš„ç­–ç•¥å…è®¸é‡å¯å¼‚å¸¸çš„å®¹å™¨ï¼ˆæ¯”å¦‚ï¼šAlwaysï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ª Pod å°±ä¼šä¿æŒ Running çŠ¶æ€ï¼Œå¹¶è¿›è¡Œå®¹å™¨é‡å¯ã€‚å¦åˆ™ï¼ŒPod å°±ä¼šè¿›å…¥ Failed çŠ¶æ€ ã€‚</li><li>å¯¹äºåŒ…å«å¤šä¸ªå®¹å™¨çš„ Podï¼Œåªæœ‰å®ƒé‡Œé¢æ‰€æœ‰çš„å®¹å™¨éƒ½è¿›å…¥å¼‚å¸¸çŠ¶æ€åï¼ŒPod æ‰ä¼šè¿›å…¥ Failed çŠ¶æ€ã€‚</li></ul><p>æ›´è¯¦ç»†æ¨èçœ‹çœ‹ï¼š</p><ul><li><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/">Pod çš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="https://blog.51cto.com/u_15061935/2652301">kubernetesä¹‹å®¹å™¨æ¢é’ˆ(liveness and readiness probe)</a></li></ul><h3 id="PodPreset"><a href="#PodPreset" class="headerlink" title="PodPreset"></a>PodPreset</h3><p>å¼€å‘äººå‘˜åªéœ€è¦æäº¤ä¸€ä¸ªåŸºæœ¬çš„ã€éå¸¸ç®€å•çš„ Pod YAMLï¼ŒKubernetes å°±å¯ä»¥è‡ªåŠ¨ç»™å¯¹åº”çš„ Pod å¯¹è±¡åŠ ä¸Šå…¶ä»–å¿…è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ labelsï¼Œannotationsï¼Œvolumes ç­‰ç­‰ã€‚è€Œè¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯è¿ç»´äººå‘˜<em>äº‹å…ˆå®šä¹‰å¥½</em>çš„ã€‚</p><p>ğŸŒ°</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">settings.k8s.io/v1alpha1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">PodPreset</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">allow-database</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">selector:</span>    <span class="hljs-attr">matchLabels:</span>      <span class="hljs-attr">role:</span> <span class="hljs-string">frontend</span> <span class="hljs-comment"># è¿™é‡Œå¾ˆé‡è¦</span>  <span class="hljs-attr">env:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_PORT</span>      <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;6379&quot;</span>  <span class="hljs-attr">volumeMounts:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/cache</span>      <span class="hljs-attr">name:</span> <span class="hljs-string">cache-volume</span>  <span class="hljs-attr">volumes:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cache-volume</span>      <span class="hljs-attr">emptyDir:</span> &#123;&#125;<span class="hljs-meta">---</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span>  <span class="hljs-attr">labels:</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span>    <span class="hljs-attr">role:</span> <span class="hljs-string">frontend</span> <span class="hljs-comment"># è¿™é‡Œå¾ˆé‡è¦</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">containers:</span>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">website</span>      <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span>      <span class="hljs-attr">ports:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs sh">kubectl get pod sai -o yamlapiVersion: v1kind: Podmetadata:  name: sai  labels:    app: sai    role: frontend  annotations:    podpreset.admission.kubernetes.io/podpreset-allow-database: <span class="hljs-string">&quot;resource version&quot;</span>spec:  containers:    - name: website      image: nginx      volumeMounts:        - mountPath: /cache          name: cache-volume      ports:        - containerPort: 80      env:        - name: DB_PORT          value: <span class="hljs-string">&quot;6379&quot;</span>  volumes:    - name: cache-volume      emptyDir: &#123;&#125;</code></pre></div><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè¿™ä¸ª Pod é‡Œå¤šäº†æ–°æ·»åŠ çš„ labelsã€envã€volumes å’Œ volumeMount çš„å®šä¹‰ï¼Œå®ƒä»¬çš„é…ç½®è·Ÿ PodPreset çš„å†…å®¹ä¸€æ ·ã€‚æ­¤å¤–ï¼Œè¿™ä¸ª Pod è¿˜è¢«è‡ªåŠ¨åŠ ä¸Šäº†ä¸€ä¸ª annotation è¡¨ç¤ºè¿™ä¸ª Pod å¯¹è±¡è¢« PodPreset æ”¹åŠ¨è¿‡ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒPodPreset é‡Œå®šä¹‰çš„å†…å®¹ï¼Œåªä¼šåœ¨ Pod API å¯¹è±¡è¢«åˆ›å»ºä¹‹å‰è¿½åŠ åœ¨è¿™ä¸ªå¯¹è±¡æœ¬èº«ä¸Šï¼Œè€Œä¸ä¼šå½±å“ä»»ä½• Pod çš„æ§åˆ¶å™¨çš„å®šä¹‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥å‰–æKubernetesä¹‹å®¹å™¨åŸºç¡€ç¯‡</title>
    <link href="/2022/07/01/406/"/>
    <url>/2022/07/01/406/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å®¹å™¨æœ¬èº«æ²¡æœ‰ä»·å€¼ï¼Œæœ‰ä»·å€¼çš„æ˜¯â€œå®¹å™¨ç¼–æ’â€ã€‚</p></blockquote><h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><div class="code-wrapper"><pre><code class="hljs sh">int pid = <span class="hljs-built_in">clone</span>(main_function, stack_size, SIGCHLD, NULL); int pid = <span class="hljs-built_in">clone</span>(main_function, stack_size, CLONE_NEWPID | SIGCHLD, NULL);</code></pre></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAhEAAAEHCAMAAAAnJ+Q7AAAAkFBMVEVMaXH9/feSy9bU+v0kuOv/oUHz/v/g8Nk5TVSRxcU9V3rf5bzDzsGY0uo9aJzp+/f6+Ny+4t58XlWn6vzS7tvex4Xy5cxmWVawycRTUmEtwfI8T2Sh1dWbbVlOyfPB7/nep3JIh8yq3d1fjKegx8bDtpZ1w+/p3qe6imdbrc92xdKH5v6Ap76ioYeEfYNgd4PSaRi4AAAAAXRSTlMAQObYZgAAD/lJREFUeNrs3Qt3mkoXBuAD9ON+EQGveEOMxpjm//+7b/ZcECuxqaHQmHfWamndes6K85Q9wMye//5DQ0NDQ0NDQ0NDQ0NDQ0ND66k5HTb6//2vw4behQiIgAiIeAARVicNIiACIiACIiACIiACIiACIiACIiACIiACIiACIiACIr6NiMAclPcFIeIxRSSa5t8XhIiHFKEbVjS6K3iniMwO0+aIN7RZC3OI6FVEoPkrlhmCQRxp1vl4EWxVxMF2i/dEbH1/N3RjiOhTRDIoE5YZAlOLC2NQquNFsE0R3ng7fn5PBAWy6REiehShGyOmgX55/JSgjhfBNkVkc2fB0kYWvo7n27g6nkXsIaJXEYHps45n5wZtQgI8dbwItiniEMZrljYy23V24zBVx0qEx94AET2KYBcT1CaNIlSwRRHeeMPywjM7VRwpQejqeB5Zzo8YWfYogp0B8jwvTK8pa1TBFkWQAG/Izg00vPTGR3WsRpb+6xxZo0cRlBd41zeNLKtg2Z6IA50G2NVGswg+5Fy8d3UKER2ISERvJ1qs0VXnhJ0exPEiOGlNBLvSYKeBnX1szhoQ8e881whktwcfGjXcLYIDoLTRPLJE1vh2IuSFxMF9deXVp1u/+uQZ5ZRCxPcRcT5ZyDuT2e/vUEJELyK6fhoOERABERCBp+EQAREQAREQAREQAREQAREQAREQAREQAREQARFofTbWUWYnDSIgAiIgAiIgAiIwssTIEiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIg4ruK0A0qCzHwHT26Limkp7khysqw6IeXeN0UUZUc20+vy455P1OxApiiH1u+ARHtixjleWFoEz2+7vDA0pWIeNKWCFlyzHu97vBsK9eEWywKEb2JoN+bS4UkvhLxJ8tAfyPiRsmxw1GJ+PASL4j4WyJ8lhf0KDZMlkCcIuLVTPV0otezhiwnIaOfEbGfHlle8KbOkNes3I1t16GkEXv1rCGXissoRHQoolwNSi5Ci3NeXCbNV+yMoFtlXURVekZEPyGCSo6RiLHr+FR2aLr1D1SibJvWRaiyEjIKEV2OLDXP4SJY9weiWJ1elE7iORcifFGeSkY/M7KcHy0ugnX/Ooyp3JA3Sa310aqLUKVnZBQiOhxZ5rHpcRE+F8GUWHHp6KvJhQhZuk5GPzOypOIxPGtQn4csVczfTilLGsWFCFmWSkYhotNxhJMMaiIcJ19Fms+SRpMIGf3UOMJahFyEzkVYlv86dov9Nm0SIaMQ0aOIIOUUgpHTmDXSM5R2ROxOnEL2bDVkjVxGIaLHrBFoKXvFT3wVzsv6yFJEW8kaQkQ2P/mv0+MhV2E/ro8sRRQiuh1ZpmU9ayQme0Vn5wIVHpEIVUqfRz83snRPaT1rHKbsFXbtqcL2hkSoMtk8ipElnmvguQZEQAREQAREQAREfBERPXxDnTWIgAiIgAiIeAARvX5DEAER/bavtzYcIiACIiACIiACIjCyhAiIgAiIgAiIgAiIgAiI+AoiAvPGPtk3gxDxmCKSWwsck9urHyHiAUXohhWN7gre+Q1l9ns7p1dlFyCiTxGB5q9YZlDT0qvp6fVgq9/QwX5v7VJVdgEi+hSRDMqEZYbzomhxvAi2+Q154+34+Y6yCxDRkQhayhaY9MsTy9vk8SLY5jeUzZ0FSxtq6Uq1hKVedgEiehRBCx11QyyepyWw56WwtWCb39AhjNdURkEtb5PHi7ILENGjiIQvcNMmjSJUsMVvyBtvWF54tqrCCfJ4HlnOjxhZ9iiCnQHyPC9MrylrVMEWvyES4FHJFblM/rxcvraAFiL6E8FXx1PXN40sq2DZ3jd04Itg3aJZhFxkn0JEbyIS0duJFsuSXFVprnpw0to3xK402GlgZx+bswZE/DvPNVTZvg+X77vvG+IAKG00jyyRNb6dCHkhcXBfZdm+qnyfVSu7ABHfR8T5ZCHvTH6sxCdEPP7TcIiACIiACDwNhwiIgAiIaLrr8nNsu9sb6XCXX73Te33/MxDxxUXsx+5pcqOEreUtnq/eeXBP/m7Y/JQPItoWoa9MTd2IbWyFX70z0rSU3qkn0a3P3Pp5F7xfveEm/Y0IT70zTHlB9fdmAkBEyyJ0Q0uL2Hj/Tou+GtXfyQtiJ1qaF+8/0rnx8+7FUxrLn4hdmdYhFUifnrfR8Ba2zbWoyUHZPKdnwvQZnCO6ELEaTBznVplrJUJX7xzIPTf0yPvznzc7pwslwlu8lbVtNNQ5Yi0vvelJ38EOTzFGlp2IUN2aF2LnNnqAR3mEZpPyrXb0laaNyuphL58NIP3kd5wjeD9ndD8+ViI4kkw88fUmaSUiVCLY33c/p+z8kULE3xdRuzGvRLCTQVHbakedI9Q7yVCiDeL76mKLB/y+vzuLWPM5AHNdbbLRcI7gOWNhYxzRlYiATwZTIuRLaqsdJUI+/hcJpjBuFUu/NY6Qo4N1TURYpNTkNhpKRG0ckYlL0OaZAF+2wmnfFTZuidDzvKiL0Nh/hnKD3Ijnl3OEnFWYG9od44jqCkKKWFDWyGlbR7XJRsO1hsDhLbYQ8fdFqF0dg7OIZDApqamNeJSI2jhCnB3eXa3ykfsRbkwThHZTGlmGbGS5UdtoeAt5YVq7H7GYbye7xVy3IOKvi6iuNernCNpkw1Ib8TRda4gZhavRHSLEnciT9xZbO3bRuaOrz4U9p3/+chuNgy1JXN6znL+VFkR0IELdj9BoZ8+8MPm2bXFhjNRWO1XH1+5HrNifitW7y5fwXOOL37OkO5F6NKGrTauoXX3KrXYStUyJv5MvctTjiL3Fx5MuPNfAs0+IgAiIgAiIgAiIgAh8QxDxZURU5YT4Xd2r2zlpfR/tGCK+hQhZTsh7ve7wbKs2zGZRiOhHhNgWeeCLp8O/BtO8trP6R5d4/UbEjXJCh2NtC3WI6EvEKM8Lus8fX3d4YKnZRizapoj9VOys7gx5PTo+wYySRuzVs4ZcBiqjENGZiNozwV9a4tfmn7UogsoJkYix6/jDaoIZSxppXYRaMi6jENGtCJ/lBT2KDZMlEDHBjJLGRK9nDVlOQkY/M7KcHy0u4plPJ5MTzKz10aqLUGUlZBQiOhRRrgYlF6HF+XmCmaNbZV1EVXpGRD8xsqTCEDxrUJ+HsZpg9rO4ECFLzsgoRHQ6stQ8h4tg3R+IiWZ6UTqJ51yI8OvTzz41jrAWIRehcxFygtl+mzaJkFGI6HJkmcemx0X4XEQ1wWxyIUKWrpPRFkXICWbZs9WQNXIZhYhOxxFOMqiJUBPMrLJJhIy2kjWECDnB7JCrsB/XR5YiChE9ipATzIKR05g10vLWEpgPjSzdU1rPGnyCGbv2VGF7QyJUCVw5/Qwi+ssacoJZ4qtwXtZHliKK5xqPPbJMy3rW4BPM+BRkGR6RCFVKP7m1eAEi8FwDIiACIiACIiACIiACIj7383bWIAIiHkREr98QREAEGkRABBoaGhpaO81+4IbehYi/IeLHAzeIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgIhHE+EmfAeEzWD4gTeH6QIiIKL+5tfx9xDxQqs2jODq9Vn0dOMDmhZffcB4emgR3yZrvGjL5VOiBX8gYsnb1Qdell9XxFM2tecv6413MrQdOxe4ekTHMP25Wr9ktj1/yihrbA1tdGAJJDAHu6mIPqAIaya6+cMi+AceLGvQaSI0Fhtz9HO7yqbuy54fQ8PaDTcjRmN1YCLCaPf2NBq6CYsaa5tHH1XEzHz6MUtMbcX+QsdiRiKWZsD+6UdavKSckMQXIugVk9jM6BAt2d/PL4kP/fsiRAYcDN3Vwd7sxxuNzgDRIqQ8wn4LWb+TFJupYCLIzfxtyrMMvWKsHzJrCBFGPEu0p6VhzWaJ9bSMYiZiGQV09nhaJtpsZkSrp19ERAGP8PdrQoR4SX3o3xeRvbF2GgxZVpi+rMWIgunYkBNTWxAGyiYsTNcaTJD/OrWf91Phxlg8tgh2mvixZD2r0bFgIoxYJg/228yIL0eWAX+FvX9JCWcpRYiX1Ie+0MhyM9qycUIlYj+esiavODd7d7Xgf56/nYzRsBKRPrYI3rOsW5fi3/YsMk3ev7QfDvV/cDmynPFXZiRidhahXhIf+kIi3FXM+llljc2A9XXoj0Wfh+nJo1HmYstOEOwzVdZ4aBH/b+eMetOGwSgqL1Ng6Qh0FBB4kGSIAAqF///vZsdx1pSOhwl3Dj73oVAXhJyca3829Y3LKyIUI2V9q2v9IaKdNW4QYd7UIyJkKdRzU1nul8lUP+bNGCEr/TddR4jD5TRet5XlIxNR2dlCGDI2Az3oT1VVoeeSVba5RcTmPRH2TX3aj6iHhWJiV5+jWOzsrDE8inVNhDyNu6vPxyTC7kd0K8uRJmKl1hq6VZPxftbYtLc/U6+POkTYN/Xpe426OCgmzvcl+7Rneb36rIcO9Vu9+hx1K8tBe/vVK6LuGPG1eVN/iEi29V4TRNxDq7KuI1xsW30eEelYzQIQcSci1DJlEz3zbThEWG0yEf9aQQRE8B8zEAEREAEREAEREAERENFnIhBEIIQQQv8qKksEEVyhW1cIIiACIiACIiACIiACIiACIiACIiACIiDiAYj4a7CI3NqW5Fsk5vpoz1CeIjHZLSAiSCKS6cE8SbP561kfAh7KcvJ62Wb7RVBEeO2Z/0GErGoCkulsmdQnfdLoABG+eMZtf5sTnSZeSE6FmNXdHZsDnsVkbYiQF8YIbzzjtL/tqW8bL2S6pXOHhqabshRzZ6F1fSDCP8846a8NH7LJEE28kCXi2AyBOptIbn+aA+JhEuGhZ5z014YP2fSYJl7og/7Wj5eRCK2O8NgzTh1giWjihWx/34yJqSmnq1lgRHjsGadEWAc08UIf1E0GjvCI8NgznzJLtvFC+fJ6bbU7b0eTdaBEeOiZT6mkbbzQMc6v91+eY/HkJjS9R5WlR54JbY/W09WnR56BCL7XgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiI6NsV4vQ8RCCEEELMkggiuEKsPiECIiACIiACIiACIiACIiACIiACIiAiJCJcZqNARA+JcJqN8hhE+OkZZx/mNBvlIYjw1DOOidDZKMmXsVBOSF/OWa4PtMpy1mkLlQhPPePQAU02SlLtz9tstkyjwe6HDkZIs0OnLWwivPOMw1myyUZJ9YF49SONcu2ItT4c32kLd9bw0jNuRyWdjVLofJ1YrDUMQ1nl2gCdtnArSy894+zD2myUYr9YKqnxT9/9Yp9kqsudtpBXn/55xh0RNhul0GEY6feFufvpy+lpMey2BUqEp55xubYy2SjJdK5mxLzpm6xEriM13raFSoSfnnG5/9JkoySjWOxa2o9CP3Tbgt2P8NEzoe3R+rVn6aNnIILvNSACIiACIiACIiACIiACIiACIiACIiACIvp2hTg9DxEIIYQQQgghhBBCCN1dvwHZNQknrA4pIgAAAABJRU5ErkJggg==" alt="hypervisor &amp; docker"></p><h2 id="éš”ç¦»"><a href="#éš”ç¦»" class="headerlink" title="éš”ç¦»"></a>éš”ç¦»</h2><p>ç”¨æˆ·è¿è¡Œåœ¨å®¹å™¨é‡Œçš„åº”ç”¨è¿›ç¨‹ï¼Œè·Ÿå®¿ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹ä¸€æ ·ï¼Œéƒ½ç”±å®¿ä¸»æœºæ“ä½œç³»ç»Ÿç»Ÿä¸€ç®¡ç†ï¼Œåªä¸è¿‡è¿™äº›è¢«éš”ç¦»çš„è¿›ç¨‹æ‹¥æœ‰é¢å¤–è®¾ç½®è¿‡çš„ Namespace å‚æ•°ã€‚è€Œ Docker é¡¹ç›®åœ¨è¿™é‡Œæ‰®æ¼”çš„è§’è‰²ï¼Œæ›´å¤šçš„æ˜¯æ—è·¯å¼çš„è¾…åŠ©å’Œç®¡ç†å·¥ä½œã€‚</p><p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAZAAA/+4ADkFkb2JlAGTAAAAAAf/bAIQAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQICAgICAgICAgICAwMDAwMDAwMDAwEBAQEBAQECAQECAgIBAgIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD/8AAEQgBUAKtAwERAAIRAQMRAf/EARUAAQABAwUBAQAAAAAAAAAAAAABAggJAwUGBwoECwEBAAEEAwEAAAAAAAAAAAAAAAIBAwQFBgcICRAAAAUDAQICDBYJDgoECwkAAAECAwUEBgcRIQgxEvBBUWGRoRNX1xhYCXGB0SJSk9MU1BVVldUWdpYXl5gZChqxwTLSs5RWtzhigrIzNFR0tLU21jd4OeFCI3M1RSa2J0dyd4e48VMlhaVGZmcoiCmSwoMkRKSGxqcRAAECAwMFCAkMDggGAgEEAwEAAhEDBCESBTFBURMGYXGRodFSFBWBsSIyktJTFgfw4WKyM3M0VJRWFwjBQnIjk7PTdLTUNVU2GIJjdZW1NzgJ8aLCQySFZHYlw0SEpGUmKP/aAAwDAQACEQMRAD8A9/AIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIoM9AVI2wQ1ERa/+EBaYKWeCoJxJ6cO09NNmv2QcLuVUs0jhVevOMFSO+mvOMEjvprzjBI76a84wSO+mvOMEjvprzjBI76a84wSO+mvOMEjvprzjBI76a84wSO+mvOMEjvprzjBI76a84wSO+mvOMEjvqjqhcfiaK10110Li8JFprrw7RUi6y+SIK22aHTjJAN4NjHN/wAVKlkni8J8bg00Pg5u0W77dWZgtaBmUnPDXNYYxcVBOEpXF0PXbw6abPDFJU1k1pc3NpUnG68MOUiK1BOIVUCIRAiEQIhECIRAiEQIhECIRAiEQIhECIRAiEQIhECIRaZuJJZI0PU9dpacUtCM9p67OAGEPDiPtTBWnTQya2UQYuBtzWaUN1JbdFcOnAXiiMuYJjrjYxgpzXCU2860RzKsj1LXb4YuEQMEa6828FIopICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICKlWnL8IDGBu5UiQI5lxe6butyyYtc5dcvSQcQ2+zTKrq5SkMJfqFGlhs1IQtXGcMjItgSJMxzrLXLDxCvocPp+k1r2slxAiSRlXWPbG4KNRK+Ey2i00P9vqOUf8HGY+iqiACw5VoW7XbHtYJjquQCTAWnLwLX7ZPBfXMtr8YqPQwh0Cp5jlc889lfj0jhPInbJ4L65ltfjFR6GDoFTzHJ557K/HpHCeRO2TwX1zLa/GKj0MHQKnmOTzz2V+PSOE8idsngvrmW1+MVHoYOgVPMcnnnsr8ekcJ5E7ZPBfXMtr8YqPQwdAqeY5PPPZX49I4TyJ2yeC+uZbX4xUehg6BU8xyeeeyvx6RwnkTtk8F9cy2vxio9DB0Cp5jk889lfj0jhPInbJ4L65ltfjFR6GDoFTzHJ557K/HpHCeRO2TwX1zLa/GKj0MHQKnmOTzz2V+PSOE8idsngvrmW1+MVHoYOgVPMcnnnsr8ekcJ5E7ZPBfXMtr8YqPQwdAqeY5PPPZX49I4TyJ2yeC+uZbX4xUehg6BU8xyeeeyvx6RwnkTtk8F9cy2vxio9DB0Cp5jk889lfj0jhPInbJ4L65ltfjFR6GDoFTzHJ557K/HpHCeRGd4bCtfV09JR5Jt16pq32aWnYbefUt2ofWTbTaNactVOLURFzxSowmrm0wJY5su9lzZDZlRm22yetEtlXJdPcQBAnPkzaVy+8skWRjxqPcvS4463W5JdS3HvSLjjaatdIhpypS1xGnNrKahBq10+6IcE2j212M2CkSG7VV9PRy55c1pmEgOLIF0IA5A4R312Rs3sntHtlVzZWztFOq3SQ0nVwML0QMpGUtPAuC9svgbxiiyhbJGaSP9vqNupa/vbnjh59O3oVkxDdoMPbetjef4q5WfQl6WJs6LMErYNJHet8ZT2zGCOujbPl9R6GFPp69DHziw7wn+Krn0H+lr9y13gt8ZO2YwR10bZ8vqPQwfT16GPnFh3hP8VPoP8AS1+5a7wW+MnbMYI66Ns+X1HoYPp69DHziw7wn+Kn0H+lr9y13gt8ZO2YwR10bZ8vqPQwfT16GPnFh3hP8VPoP9LX7lrvBb4ydsxgjro2z5fUehg+nr0MfOLDvCf4qfQf6Wv3LXeC3xk7ZjBHXRtny+o9DB9PXoY+cWHeE/xU+g/0tfuWu8FvjJ2zGCOujbPl9R6GD6evQx84sO8J/ip9B/pa/ctd4LfGTtmMEddG2fL6j0MH09ehj5xYd4T/ABU+g/0tfuWu8FvjJ2zGCOujbPl9R6GD6evQx84sO8J/ip9B/pa/ctd4LfGTtmMEddG2fL6j0MH09ehj5xYd4T/FT6D/AEtfuWu8FvjJ2zGCOujbPl9R6GD6evQx84sO8J/ip9B/pa/ctd4LfGTtmMEddG2fL6j0MH09ehj5xYd4T/FT6D/S1+5a7wW+MnbMYI66Ns+X1HoYPp69DHziw7wn+Kn0H+lr9y13gt8ZO2YwR10bZ8vqPQwfT16GPnFh3hP8VPoP9LX7lrvBb4y3i3c64juuXpIG2r7gpqckTqfOEZRvPHU1fnOmfrKrqRLYSn/IUlM44rU/uUGNhs56XPRltBjDMIwPHqKqr57nlkphdeNxjnuAi0d61rnHcBWmx70X+kbZ/CZ2M4zg1ZJoKa4HTHBoaL72y2mwmEXOaBZlK7YQol6K43GIy1IuTmDtENuPixvckZVwSa5rhq5jbszLAr6U/clrybRcMDkyIyN0RyqoUU0BEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBFovHoRHqepEenP4BUODcqjNJEl8MsFaLvrK42C68+Zclul/wDuHRscMczpOkQK4B6SgyXstrXuLfvkrJukrDf9gc3LJRESBwLzVdon4dKmdImmZriAIG3QDvps53J4Qhck6BwK5df6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6imzncnhBck6BwJdf6iuS2X/PC1NC/wDWWC09cWPAGHi2HV/V7a2QSKMzLsA6AiGuJ7mO5oWXRzKGVV0uvcRUGqliF2NhcIWwWQ3vgLSXo/EzLyDNp+buNlxLa1trNLjNvJMiU2aVFs54+eH1vaGmxCv2Tw+a8hlRW1bXWRiNXIyg2Hsr62/VtnTKCTtBW0xImSKWncIGEDfnZIWjsLa292XErrTDrkNXqcNls3DKZl2kKW4hK9SabqyQRaHs0LYL2F+gXYifhFFMfJkPqplLKd3VNJOVjSYktt3yYlddYv8AWJ26psZraGmqqi+yrmtgJ85o7l7hZBwAFmQWZhYq+1jxF6h13r3Neixnfy+bHfFaX5NT+Ktf/MR6SfjNT8qn+Onax4i9Q6717mvRYfy+bHfFaX5NT+Kn8xHpJ+M1Pyqf46drHiL1DrvXua9Fh/L5sd8Vpfk1P4qfzEekn4zU/Kp/jp2seIvUOu9e5r0WH8vmx3xWl+TU/ip/MR6SfjNT8qn+Onax4i9Q6717mvRYfy+bHfFaX5NT+Kn8xHpJ+M1Pyqf46drHiL1DrvXua9Fh/L5sd8Vpfk1P4qfzEekn4zU/Kp/jp2seIvUOu9e5r0WH8vmx3xWl+TU/ip/MR6SfjNT8qn+Onax4i9Q6717mvRYfy+bHfFaX5NT+Kn8xHpJ+M1Pyqf46drHiL1DrvXua9Fh/L5sd8Vpfk1P4qfzEekn4zU/Kp/jp2seIvUOu9e5r0WH8vmx3xWl+TU/ip/MR6SfjNT8qn+Onax4i9Q6717mvRYfy+bHfFaX5NT+Kn8xHpJ+M1Pyqf46drHiL1DrvXua9Fh/L5sd8Vpfk1P4qfzEekn4zU/Kp/jp2seIvUOu9e5r0WH8vmx3xWl+TU/ip/MR6SfjNT8qn+Onax4i9Q6717mvRYfy+bHfFaX5NT+Kn8xHpJ+M1Pyqf466wxLacJZ2+da1uwdMtiLo2JtbTDynHjJdTjmdqlaOPGtxw+MszNRmZnwmOn9g9mMM2d+sjhuDUMiUyUJteBdYxve0dVmaAMy9DYxtljG1X1ccSxLF3vdU3aKJL3PNtXTm0uJJOnTnWXJKeIZK4C2ISgvudDPYehcsfR0zwySLLIgLxJ0cOn6wvc513IV9ZcAuWZlNsYW5VIKqAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAig/FA5FQ5QrRd9v+ouQ90lufxl4bDC/hI+5K4B6TbdlH+/y+2VhqPxPtjnJ70b682sAvQzQUArqAiHyuTmiriNVu2q0PduBTt26cBEaj2bNU7C1V/i/dCNKDnVyeYwgvupaOuqkPuUtBW1jdAgn61+loHKpmnaXtNbj6VoSkkJVrwCE+cJbolSGGza6QZLO+MNOa3MCvgIyIk8UzWhtHUlcZBsqURmlSFEkzVropAnKmtcwSs7XXuBVnPe6IA74QyaVPT14RKY4Pc54yTPsKDZ7pkhuHAd3LBEYc63Ll4kAMbNwmdIB7szRxFvZVC+ZR0z6oAayW4NDSLXZBENsiLcq1WWHah1qmYZOpefWnqVOyh52qcdJRIQlplDSidMzc4OMQnqBIZNc45ZLhlzwUKc9IkGklxElkZgB78uFkM8QY2DOq6qlq6GoepK2mqKOpYc4rlNVtLp6hs1NtuEaqZxBKbSpKy0PU+NofBptxKaY2dQyZQPdSwY9k2drOsg076Wnl1M0EGcDYYgi6YWgwhl0lfNtF0SSLVZM8EKrlCQMLFAWkb6pBXkBFyay/54Wp7pYP8AlJgUqSeguGaDu0VkUYBrpEfLy/bBZEd/z9z4b90NwfgreHzu+tT+0Njjn6dV+0kL6xfV6/hja45+rqb8ZOXc7f7W3/m0fsCHdWzv8O4cc/QZH4pi8mbQgecFcc/TJ34xyr1MbhaiJTUwSJU7dhiVH3OsBzuUtaGiBQ9RawucJM91/mnthYbmOmPvNJQj5OUKmTJn1c6ZPv3TC7d3t37CyZhIaJZz2RUbdeiYtSWy2F5lE9y6FuQbh3VQTbpE8RJki5DO7NEDON2xNv8Ah2jNqZmIMe0SxLhYbQY/8FISBLbqoxHfRBj2I6dxT9nnCzUVL2uvVbS57shYLOOFiowzZjbtMWtY3KH2Oh2I2pqfii2BPqQJoLNQwQItvbm5HJHsq2HyJBMt4mmoeYxELu7uwyws0IWovEyXSYyA8Mj9tljC3JmUr0yXNuzS0uhHudHZQRp7TBKkmAgoM/B2cIpNYRNDs1qrKJ1fAmpiqlEpqYJEq1e0v07LX/gkp+a2dHknA/8AVfhPvuJfodWvb+CW/VbxqP8A/jv0qmWVbll/0ftj35ALyWO+7CqFVJARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARRzPDA5FTOFaLvuf1FyHuktz+MujYYX8JH3JXAPSb/Cr/AH+X2ysNR+J9sc5PejfXm1nfHeUArqAikRee4grRsmRUkRcJko0mZNqIlEZePI1EpTJpM3CLicoy0154nJHclVBL5gB0q/HBFJQ2zalmxUrQdXRmKYkaCVNTDqipYAyei6RRKaNCaVlyuo1KNatT27D4Bo6+ZF9wZfXXZmzdPLkvbOmwEsiBJyWthlXTcRiqy4aEvSYyZI3JSv2ddNDbCKCDqY5lUrVVSJRK2adyuipI/PDPnE3tSIyJltwjLUyUmxJq4Mlzo+7P1Y3yePeWJOwOXLqZrXCyVKvkQOYR02dlcliMG4+rZZFe9clwt2HJ2RV3hFyJ+cGpSjOOlFRlbQSLq49VLUuNvGR8ZtlnRK0bOE1Z82p1UyZId30ggG3JeBPYyLCw/BJb6iViJ9ynxcLDA3O5yxXXF42FZntMo7/x9JXC/Btyxwk1H3J5zflKKoStCWK1NTQx8Ww3RV6HW+KSmTMlKPxx7CFqlqJvTWyLbswF3ESsPHcPkuw+p2iEB0KdqLmd8XAXg6MAO6yQOTKtbAMekrurrsqqfqtNYlqT1yutdSdqdJBunboIRtaWlIMnTmq+nPQtCUST2aC/iFY8yg1se6cG8II0KmCYZLm4rNxB1jqemM25bE6tzDljZHJGBXKd5OnTN1lh5MYp26dF/wBrOrrkk2pvSbgpF+jrEOJV49C/OlRTnxdSLQyMi2mZ6rCpz6arqJM3ICyEbMzlt9qZUvEsNoMalC46qE4lmUtuFjRE2Axy5ArZdNSLUiJZJJxRFykq8aRbeYocplTWvbELrybKcx8FTy/C+2LTz3XZV6SO5QSU0BFyay/54Wp7pYP+UmBGp+BP+5d2ismi+HSPf2e2CyI7/f7nw37obg/BW8Pnh9aj9obHfn1X7SSvrD9Xr+GNrv7Opvxk5dzo/a2/82j9iQ7p2d/hzDvzGR+KYvJu0P7frvzyd+Mcqht1p0BFVpsE43CBpCxqsGW0O0iKbeA9CSrT/Kfc9TJJ8ZXjj1LjK00LZyzGFUyzImNIsiQOFZ9FLDpRed37CwrVO9/m1vfzJ4p94t0qnySjdjdhGoyhXHqymugt6Y9tb04dMdb4xd8MUa2yeSwlVCZcXjccc6pMMphQNnVDQ6fMadXlBLgSLLbTkzLWzZrS95d7ky1xzAbuhXqX/v8AOBcdX5e+N5ZN+zF2Y4XRrvOhtKypG5G4COfoGpBVwSzlCv8A/I2zTUzqTq6peiac1amrQtBpplNhwe97brcMY4iqdE3WTo2NmGPcuvWQiLcyvy9fr5NPKBNdOl35DQO6fKhEuYPtm3bY22Wr67z38N3izKmwaA5yeu+QydaMneliUeP4Cou6rumJiK+Nj5JqJo411bz9fSOybajbSajJpDhmXjdSrU4ZjMC2oc+XV3Y90y0Scz4WdwNPGo09dIewTach1LrLkQYjWZ2x50My7xwzmywM8WnUXbjuRqaumoJetgpuKkqRVFcVsz9AzSvVtvXJBLUVXETFKxVsuGw7otJPJ1IyMhI4eJOG0syTWS6pr71rAIGB3Cd7sK00sm4nVMnPEp7Lvcuy2jJmWO+75XLuUt8bPGNaTe3v/BViY/tG1JO2oiz0YlYp3q2Vt+Bqa1+qq79x/ddVUoTU17jxpbWjxqdC04Su7L0dLVU2ITnSddNlVN26CY2mBFmjLkzLOx582kqcPktlu1U2lvXsx7mw9nfzrvrcPytk7Iln5Qt/J90R2RK3F2S5CyIPK0RHNx9Jf8LSx9HWIlVlRvOxFVIMvP8AEddo0s06uORE2ky2yrpDpjNYaV9JmuOiScvdWwsP2Fqql7ZNcJctwcLgMRulX366GXMWSHC05STSSTSf6olpMz8Ecel/e3kFbB8XsioPl88xKY8OfDOpMEGKBFVQEVrFpfp2Wv8AwSV/NbOjyVgn+q/CffcS/Q6te38E/wBLeNf+u/SqZZVi4f1v2x78Xksd92FUKqSAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAijmeGByKmcK0Xfc/qLkPdJbn8ZdGwwv4SPuSuAek3+FX+/y+2VhqPxPtjnJ70b682s747ygFdQEU6iJEVEtiYqtri9UI1JMySXGMyJJmoiUnVhJr0QSnkmehGe3iibTdbdCo1tx4mZwV39c+fLrVWRtFYEzPWpbEDDQ0ZQQ1BVLijNdNG0p1zlY1FvppzOpk1PLNSjParaY102jYX60kl2iC5AdpKmXSdGli4LO6DnAiEMkNJ7a7unsjY0vWwL7uiataYRC3Fdtn0UrTUrEeqsZuDzjcco9MRLh1aaeoW9Ux5suLU4RqZfWnaSjI9Z1cRJpqW8YU8/XA53EEdy7cMVzN+ISKwVGIvJa6dIMktEbAQYuGk2Z1tlhZHtudk59NNbtWixrIxNXRVHB1b6VvvN1U559knn9ahykpqmtW83qgnCTownQZE+ldNqampe436p7CQMjLgI7nfjbvLFwvEZJo6fChYykY8B9t599wd3W6IQAtXRV5X7ajtl0lh4/iJaKt/wBOHJ2TqJOoaKol6lfEKnacZpquppqqjo22Wya2qSokErhPUZMhmqqZU+AJlS7kNNkIndWhxCpY6hq8HHdSJ9SZhccoIcDCGSFi0rSyk/Ytjz0Pa5ykReNwysc4/cFI23S9Tg6FNYpyiaradZVyOr1btOa06EkzQXMGT0KXPcy+bGPDoZjDMtZTYpNw+RMly4unzJbmGYSQ+67NHLAEAgEwsC+uey5UXljZNp3kcxcFzUNxKmYG4a6pRVtx8ZWUVPRV9C/U1dSdTTtvVUclaEEWhmSj4dRCrwyU6pNTLN2+bQAABAAK83HZ87DZOHT23jTXg1xJJdfMTGOiAA3F0moy8ctOuhuuNkXCZtko1oXqWpEkzPZzRfky9UIAkhaaodrSSRBQYmReMVYY4t7kZCoEldQEXJrL/nhanulg/wCUmBGp+BP+5d2ismi+HSPf2e2CyI7/AH+58N+6G4PwVvD54fWo/aGx359V+0kr6w/V6/hja7+zqb8ZOXc6P2tv/No/YkO6dnf4cw78xkfimLybtD+36788nfjHKobdadARSQpPN2ldUjvmECGYxVueekAMIhdEOBdfZYuGZtXG173Db0JO3FPxVsy1RAwdtRklKzkpLqplU9E1Hx8Uw/WV5t1L6FLShKupp2mLtSG1Oqc6w6xuTsrLkzDTyjLaIxjxhYOJHcW3pq3dJVMqynLs3DWTlVvLrwnTYxt1i7yyjJyCrpVCe2ZiCRfjU4s2aelUwp4qhK2yQadhDn8nGJFNNpaOfKlmlkPteRFwBIJIEMo3Frm0jZkqptJmPlwDcxMCIFcmwZvIXRbuc96m65Ldnz5dMjkKFxY8/BWxim5Ja5IG9ZjGEC6/j+/Lfp6A5C1ybrXXGa5+RbZoGTbV1Z1Kdo47iFM6dgGM0lJLl9Y1uIidTy7A2dJ1l4zHu71jg2268g5oRWyly5MvG8Kq3TXtkU9C6XMmCN6U+5d1cvOWxs7myG4uG4wob+3Us7brKL1xRed6Tkfu4ZwlbntXG0BU33dllUk5kjE6mq2ngIButkqxdG8TNK8ikbdNvz5qZaEZlyXEKilr8VNVInTHYd1eJReQQdaD3Uu6bbsM8IFcWw6jmSMPEh/cTunF9wd7dIgH2WXjk0rJDuYWner07vGZluex5zG0XnHLhXfZdo3VEOwd1M2/GWRZVssz03DOtIqIOSmJCCqFHSP8SsLiEbjaVKHF5z5EuloqCnY2XLY5wi0XYxMcgAFi2TmBm0M+8A9k97AS60tAAER6sysszJY+K2N+XOV67wu6DlXOtlzFp2VS2TccNuw3tmy3aWRp4a22qooyUibNuKNoq1p5l1p5TDhOEvjJV/jCuz7zhNNiMuS9xdOqr160Ed1mhpWZtXNmzqqhfKJDKanMsCJAcIXQSONXR971si97QdztVFZ17YtwFcN2Q1VgLFOQI6XgJuzo2ipZQ7nfpbUmEIqrVgq9dVHppqMkMoS406ZNpMzNWxqZjmybk6Y+c823nkkgQNkTGwZt9a7FpLWYk10qF3VN3LYrJEkj4pGepamStD4VKWhDill+pM16FzyHEJ0BMN3J6y2EmLpdqqPgLk5ggJX/AHImKqHwNzMqRJTQEVrFpfp2Wv8AwSV/NbOjyVgn+q/CffcS/Q6te38E/wBLeNf+u/SqZZVi4f1v2x78Xksd92FUKqSAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAijmeGByKmcK0Xfc/qLkPdJbn8ZdGwwv4SPuSuAek3+FX+/y+2VhqPxPtjnJ70b682s747ygFdQEQEU83mltTqWqeMXBxk6kZloZ8vYCFDJBpJHFJJJ4/E4idDM1rWvVfjj43F42wIRsVmdLdMllgyrUN54kG0T73UT4n+SNZ9RU40hbbb62C8abptOLSZ67CWegasFZevmsk3N9VJfdbNxTTi21OklLi0GpJqZSki87mlKySbS17T112kQasLCkTJ8ubeGkaVpErUzNRJ1Phc4p9U1Ph0LjcUtoasK66oeXEnLFU7T18bpqkvHEo+OSkutKIuNxdOKpBK12cOgpGGRQvFxtVWiCP7hJ6mepmg1GRK4uw9FpJRJNJmXB90YXi7KpNN2Kg9Nuhq4xkSVnoSSUlP3PjdVcUyMuaYrkU8oUFqWzYCjdtigKaAi5NZf8APC1PdLB/ykwI1PwJ/wBy7tFZNF8Oke/s9sFkR3+/3Phv3Q3B+Ct4fPD61H7Q2O/Pqv2klfWH6vX8MbXf2dTfjJy7nR+1t/5tH7Eh3Ts7/DmHfmMj8UxeTdof2/Xfnk78Y5VDbrToCKdum3g6Yq8XpWoGV1vAoQgYqSJJ8ZJ6kSjQalEWq9EHqRJ2kSdT4eHUWIucQB9qY8CqXxQj266JSauMlXFRxjJClGRkSzUnU1oIjM9C0UZkWwiM78ye+c9swZCVExgZXlLI6ORdT2Thiz7CvvKGRoNyXO4cuysTMXW3XVbFRHN1kJGMxMeqJZRSsPUqSpGE9UJa3eOvU9U66FfmumiSWxF50CDbADQdB3FMVRlPZiECehN1V2Fr49zeDY90M8YjTBatdiC1K7MsJnR12Y9u8BYlw47oOp1rDUOUFc85bNwyTz9AdE689XFXWnSpbMn0oS2pepKMy0nIqH2kWNukQzxst3lbFMKaWaOINutjGItsux07kOyu0j1VxtSM+O2Ta9uhGZKWsnuKSdDcQbh6cBHoMKZPcS13kzFXmyw6k6Z/3LpPB6tKr4xmfGV44zSaNeIXGSk3UumST1Mj46k8JlsE5FQ9t5vlDe+yo0Temtc+ZlaYerKqE8YtdFGRnoS1aEo3CTxjJB68UkpUoy101+5IZE6rdM4PVnWPLZ0gma7KDDgQ9pkrlkkk84i1NXFIuYSlHpzhgElxWaAGiAU8JDJyMgsaH3yO+qRBXUBFaxaX6dlr/wAElfzWzo8lYJ/qvwn33Ev0OrXt/BP9LeNf+u/SqZZVi4f1v2x78Xksd92FUKqSAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAigzIuE9OEIRFiiSAQSrX97q25+7cO1sNbMPIT0q5PQVQiPi6Z2sq1MMVDqnnSZZSpZttJPVR6aEM/DXNZUAvIAgVwn0hUtTXbMvk0ct02brpZg0EmAOgLFYeBM1Hs+C699fc/IeY88cudiFCAIzZeXSF0OzZLacOiaCqhDybuRPgCzX1rb3979f5iKdY0HlpfCFc81NpfiNV+DdyJ8AWa+tbe/vfr/MQ6xoPLS+EJ5qbS/Ear8G7kUfAHmvrW3v736/zEOsaDy0vhCeam0vxGq/Bu5E+ATNXWuvf3vyHmIr1hQ+VZwhR81tpPiNT+DdyJ8Aeautbe/vfkPMRTrKhH/elx3wrkvZXaS9HoNTD3t3Ip+ALNXB8Ft7+9+Q8xDrSi8rL4QsZ+y21Jf+z6u7727kT4BM1F/ytvf3vyHmIp1nRH/us4QsobKbRBkeg1N77h3IoPAuaSPbi+9iM9untfr9dPKRTrGjNutZDfCteaW0Bdd6DU3zbDVuUfANmki/quvY/wD+P1/mIkMRw9xgJ0vhCtnZLaTKKGps/q3KosCZqMiMsXXuZHr/AOr9f5iKmvoG2a2XwhQ81Npja2hqi33t3IoPAWa9f6rb3978h5iKdY0EPdpfCFdbsntNnoKr8G7kU/AFmrrW3v735DzEOsaHy0vhCu+am0kPgNVH3t3InwBZr61t7+9+v8xDrGg8tL4Qqeam0vxGq/Bu5E+ALNfWtvf3v1/mIdY0HlpfCE81NpfiNV+DdyLfbVwdmGium26qrxreVPT0s/D1FQ87BVyG2WGq9lx11xRtaJbQgjMzPYREKz66jfRuDZrCYOzjQVeptlto5VVImTKKpbLE5lpluhY4biu93+j41Phri7f9orgTs27ep29s8EfPv60zS/ENjQwRjXVeT7iSvqJ9XwFmzG14dYerqb8ZOXfjUFMqaaMoytMjabMjJhe0jSWh8HAO9Nm8OrnbN4cWyZhHQZGY+SYvJWPva/Hq1zSC01c4jdGsctT0gmvUut8oX4g3PVmIeRmeCVqU9IJr1LrfKF+IHVmIeRmeCUU+kM1pp6V1uv8AB3ODZzhKXhlf02WXSZmqumJumAMFF5bCANqekM16l1v4u54grS4VWh8wvkzALjoWHLZBWmXibciekM1p/out/F3PEFhmGYkyVKIkzb4Jj3JstsWQWgsMcsE9IZn1LrfxdzxBdnUGIukOb0eaWkiIunujHLkVQAJss6GcFiekMzy4ut/F3OjwCEmgxW/F8ibG7CN05NGRYwvaoiEO6P8AxQoKZMjP0sreDX9zr8QS6rrA2eDKmRc3ubDaYZtKyGh4o7oB1N025oWqCgpk9pRlaenDpTr8QSdhda2bTDUzI6ruu5Nhu51CiddaWSbSTmU+kMz6l1v4u596IswquIP3mZl5pVlgcwQaLIocDMn/AKrrfxdzxBI4VXDJJmeCVcDphyhR6QTXqXW+UL8QQ6txGMNRMh9yVchnzp6QTXqXW+UL8QV6sxDyMzwSiekE16l1vlC/EDqzEPIzPBKK0a2WHqXfwtpmobWy63RyhuNuJNCkEeLZzQ1EfBrqQ8hYRTzpX1sMJbNa5rhNxLKP/h1a9vYE5rvqtY1dMbcPHZFVTRCyoke39aPeoc2MI2ryZ9t2FUJKSAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAi03C108PZzeDhEmmCoYwsaHb66Pz5kqQxJj+ovOPjKWVqWJSMjk0Va+8xTrbr3VoU6blORuEtBJ2FwGMujlibN1YymJXFtrMXn4Rgb6pkppImtEIwy7ysiPf8Abv1L/YG2S/8AOkqX/wBwbZ2BOsjEiPsV1tP9KtbLIuSJZOi8+3cVXb/3h+QNteu0t96K9QjSeBqt/S9ivxKR4Tk7f+8PyBtr12lvvQ6hGk8DU+l7FfiUjwnKk9/68NdfaDbXrtK6fsRMbPtLYkngaq/S/icIGikR+6cp7f67+t/bPrpK/Z4gh1CNJ4AqD0t4obeg0/hOTt/rw/IG2i/86yxF+xEzs+2EQTwNUz6XcTAsoqeP3Tk7f+8PyAtn12lfvRHqBuk8DVbPpexb4jI8JyFv/wB38vH9s+usr96KdQDMTwNUD6XsWzUNP4TlSrf8u8yP/YC2teUfppK6kWvAR8XXQXOoGwFpNmhqvs9LOJGcx7qKnHcZbzrLEVv+3erQvg+thO0j2Skpt5x+M4Bbbs+Ac/A1QlelvEjeDqKnHcH7Z3Aqi3/bvLgsC2tOUXprKkReAXFE3YA2AtPA1G+lvFJcpoFDT5/tnKe3/vD8gba9dpb70Q6hGk8DU+l7FfiUjwnJ2/8AeH5A2167S33odQjSeBqfS9ivxKR4Tk7f+8PyBtr12lvvQ6hGk8DU+l7FfiUjwnJ2/wDeH5A2167S33odQjSeBqfS9ivxKR4Tl9sTv1XZMzcJFLsWBZTJy0fQOOsScip1tqrqm6dbiOqcUlm2TmunOEnYLq5LzaRdOjQro9JlXXmS2ZLZKmOntF1peRCMI5IWxXKN/hZoZwypJEZpuKfURcZ0jVom3/IlroPCf1pXdGxHY2JyV9X7SRoX0O+r2507Zna9zshw6m9vO0q6Ni/KxDDSSoKdXU0dSJRuOkoybPia6aa7dB6K2Xxss2Xw+23oNPnd5Ji8lY5KZKxiqYLbtTNHBMcFq+3+u9T6fy17xBuOv3aeNy1UQnt/rvU+n8te8QOv3aeNyRCn2/1nqfTeWO+IJDaaq70SmFozxNu6rRFpgp+ECsP/AFdTeWu+IQl5yVY/7LOEq60wtKp9v9byo+n8J137RCB2jnP90Y1kNBNqk4gp7f671Pp/LXvEFOv3aeNyjEJ7f671Pp/LXvEAbQOjZad9yo49yd5Cv6sIjT6X0+mn/jHfEDzkqi4xkM7i3Kr06dqsOp5X20y8Dw+uoTftYn/V1NtPXTqjvibQO09U5ut1LIt3TnVvDmaqvlyjY1948DSnt+rS/wBX0/hOveIKnaCabZjQx2gE8Ksyn3gT7Iqfb/Xep9P5a94gp1+7TxuV2IT2/wBd6n0/lr3iB1+7TxuSIT2/13qfT+WveIHX7tPG5IhPb/Xep9P5a94gdfu08bkiFZPC17kpv9W5WOoS0t+ilE8QjPTxuLJvYRmWpkXF5Y8dUNT0j612EzTldMxL9Eq17d2fliV9VjGwMhfh7vCq6Y/ZWUYtqtedwczaPcYbF0V5Pj3XYWoLyqgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgIgItNalJ0000267PA00EgAQYqJbMJGruwzxVoe+ws1YMryMjL/aS3dumhfuh7njZ4XBlSHexK4D6TJdR5rPg6WDr5eUnSdxYcOTYOeOnsuQGUrzi2RPeS975UAI2Exs0WZVGp8z7IxoOUYyND+JNT5n2Qg5IyND+JcqtWyboveoqqO14pyTqKGmOuri88UNOzTUaFpQp1a62ppENFx1lt4yiEJkwy2QKyqagFW8Olh3/BbtcGL76tanoaycgHqWikKvzrRV7FdGyFM9VmSOLSuPR9VVNs8dKiPVw0EWmzXbprukuv7i2c3CHSZcXB2Tf+wuGyUdWQ8hVxkmz51kqR5bdXTdUQ8ptxCjQtBu06nac0GsjUk+ORmRls1GxZMc9sFx+YxsqZBwdARXxEZ6kfF1026Hrt0Pg8AxKDlNpknKHx7C1madVS63TtJVUOOOpSw0RaPvE6ZpKnY4U6tvJMzM+UoV7pXAJRzP4lyadsi7LZpKSRnoeooqWsrayhZrVvUTiXauMrX6etpuIzVOOETNTTrb14pGemuhcAtCc68W6Fen07RQuqAHWEccF8sNaNwz7TVTDR/n1pUjQwKCJ9lvqklKm4qho0pdW26aHCpFqUfF4uqCI1J1Fx0whsSrDqa6+WAHd1Ma3hWz11BVRdXUUFY0pqqpX3qeoaUaFG0+y4pt1r/JuL06mpPBtLTaSj1Mk25bzMjoCyKyRLppurcHeqC+TU+Z9kXYOWJGRofxJqfM+yEHJGRofxJqfM+yEHJGRofxJqfM+yEHJGRofxLk1l/zwtPm+2aC8Av/ACkwIzpwZTPYct13aK2OF6l2ISBb7szRzgsh+/4R8TDx8orhuD8Fbw+dv1szfr9jYZ66s9pIX1f9ALgzZfa+H7vpvxk5d1I2IRzSQn9iQ7l2Xlu82MOccnQaf8UxeRsea52P17vtRWzvxjlVqfM6RjeXWrVQCanzOkYXWpAK3zMG9VgXAs1C25lW/CtuduKhqJOKi2bWvW6Kyuj6NZN1SqZq1LbmFNqbPZ/lCQlHKNemp5sijqX96+VdOSJMYbtirdssWlam9ju93zZE7ka2MiUEtadsS8XA3NWtwt10khCSUvVMUcZQ1cFWW+1cZKra2rZLqvnIka7fuUuKTnPw+ru9/J4TyK2bFcFTPoqKdmoYUTjVS2ipS51NTSlE8klINSVqNZmbPFPUyQemw0JMhqpsibKP31zCDkuk8cQjTHKvoTqaiIy5Zcs0mfOI+Kvxx8rlGfLIWrrVIwXGrpu23rJh1z1zybENFNVVLH+e6hqpNDdZJ1tJRUSSKjZrVP1L9S8lpJGSE8Vw1GoiSK3bYCwqUsXnhukhbdY2QrOyTRSslY85S3DRwVyzFnSlUlisp2KC5YFxpqZiKhFaxSOVL1E88kuM1xmD43jXFbdM2uoqunlUcy/J/wDKe5uU5iBoGnNFYNY8vxR1F8VeD4QB9UQFxSazzia3ZWXg5y8GKCUgLhsyzpekqY24NWLmyTJxELYUWqqZhXqJ16blLhoUk4y4600t3R5TWijSkYdVuxeRhl+TGcHnKftWudojm0FbethT0HWgySmt/wCYhv8A1aQu3yUSiI0qNwjIjNxRcVSzMiPjKQRmSFGXKI1bOWMadLe2YWzS0uHNycawZbLrbc9vCmp8zpGLN1quQCanzOkYXWpAJqfM6RhdakAmp8zpGF1qQCtWtL9O21z5fnSU/NbOjyfgjv8A/q3CG6JmJfodWvcGCf6Wsa/9d+lUyyrcBlzyHvsCxeSx33YVQKSAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAiAig/FDMqZwrRN9stMFyGn5SW5/GXRsMMEagR0Fdf+k8B+yjw7Jr5fbKw18HBycI5sWNgDC2K81SpUtrrBm3VAuRKyUCJRXObtrNLUqyjT19cqMo6jHklTvVyKddUqnbcq6Q1PHTNOsOP9RNJKIiWnTTmakenxuofT08l0kwmOnAONhi2BstBhvi1cw2Lktq6qtlVUwCnlUT3sabLswEQdEQJ+5JI3FzSHiI1nFF1QlqXm9fbhz9tSN0MSLDsaiCg6b04pyqIugeqqt2kdrF1ZEt5taVf5JOhkNXiFQ+U6mMkQDy68csYXYWHJCObKt9TyxNwSpmzJ7Xz2saWm7CFrswMD2QVtE7bWMrVgMhXDM2odwSMbkV+34NmquC5aWiVHIo4x9xiXqWJdusqDpVVLjqXVvE6Z6EajSRJGXNrahmKU9NIN2S+RecIAxdA5yIjIMhWJiGE4bL2ffiJaJlYHMyOcO+LY2B0M5zcCluxMXFfdSy3DUjVJK4/jbltO07guuQjYx+4JapjUlFuTiKmnlKtujoqp95tpL6XXjY4pr2mL/SKw4fTzb8J76prHGDe8MYiEIDJlhFWX4bhPW86nl0pFOylL2i++F4Ftsb0dNkYbi2uSsWNt/IMZWOWdJWZQw9sVN0S8U9UyMvH1B09UqjXV25WVrhySI541snq7UVBocSrRREokle6VObUVcsPLpcq5cJDbIgxyARt05FrMSpqaScPNPTOYJxmawXnEGBbdykluU5IRXwZFrHpXBuJK+oW7UPSMveFa7UaGpaqipuGeedecNw3VKW44ozM1GZ6nqLMiqji9PJmGMh8kucLLXQdbHKLYWAgLIp5bJuAVpnN7tlXdYLRdaC2DbMsNJiVrYNhI5+Oj5l9mq9MqHKmO6CkdTIV7LTdPVnMu1CXqIqjzhUG4dInx62jdSWpJURKUR5lFUMqKeoM/urtO8i2EHAWGyEYaDYoYO2VUV0htU29LE5hykfbDRDNFcmkoDGuRbqydbsTZtVAXDCok5uguBNxyFVU19VRVSUSLMpRVSnYpVI6dSlTfnanplNknRSlGZmenpK2odStmNd3ZFtgOezNYt5jdFh1RjtRTCWBIY8XTecQ280ExN62J0rTcxvY9dYTMratlldtGqy6WSr7vhbrlKm44a5VRCa6RakIZp56CajYyvUaFtKo0uqYQZdUSs+qFebW1pdC9Z9yORYk/B8Jp2QbJ1pLR3Qc8QOjviOLJu2q0EyUXGTpqslmjinqkzJPGNTiSPXQtE7UnqZc3YN9TuL2RfaYLgeJU76SaDJdfYXAXQMgMYkm3IoEolW0CJRcmss/9sLT90sH/ACkwLNVLYaV8wju7ru0VfoWtGISHjvtdL9sFkS3+zPzvhvn3DcGvldvD54/Wpa12IbGxzV1X7SQvrF9X0B+zG14db/8Aj6b8ZOXc7Zn1Ns+ahB9FJDuvZwkbNYcwd70Gn/FMXk/aAkY7XsHemsnfjHKrjHzRt4BaWATjHzQgEgFir3nLnvu1d+bCkhj/AA9TZnmyw7erbttVN1UFrIp6V1+qM5NFfXwU8yaqdKjPidS18ZsMuVuMApG1OB4jWVAvVcmqa2UbRdYTaICAdZncCd1K9xlaoSbAWROeJ7KtXmcnXnYN1b211y1jxO77nOUt7B8rF4roqG3brt+tsFjL8Dbclf8AULm4F2GuG436m6yoDdRRNnSIcJSdFrSotniFG2XhUqdLsnuqmtJtPclpJEDZlhaBHdWZh0mTPxOqkVAjIZhsyY0RIhNDmgOiCCbCe5JLdxXBUWQt7fJ9073BWrvAPY/tzBEnFlYUbH46xXJVMnIKxZZ13yUFc1dcdlTKqy2/PcqS0IpipJRpypfI61TXnZqm29Rg+C07aJ0yUIzphD+7eIgEeyss0QXEcAqquqpWPq3XphFtgGcjMBmXH8k70G8hX2du637XXtdeEcT5E3fLdyDduWsYYhta+KOmyROW1FSrEfOVGQ4K+IK2bPNVa9VrSllFV1BkkIqUGZrGlZh9BM6aWs7mXUlrO6dYy8YDLbZnMSuTU7WPq2y32y4GI3Rxq4iMueVzxEbtFnzN/Wnk9mQak8tXnd9gxy6OzrxhrNo6m36U6dqklq+iYP2w3fHvKbJayN6n2aEWhMYocNpMTfIksDacUV8C8493HLEknJmjDcWrop890mXNcYzOlhsYDvdEMnZy7q5B3v8A4p40zEakp4re89m9pxKvGKbQUzQcQ2WzLVLuh7eWFXh8ip2TwarmtvVh1rmOiRB1+EYAwOQWEQVitL27YYvc9yjKh+DGdWZb3V+ZRuS7942xoCdgqOstDeH3I2Mau1drwKKWInprJOGq1itmX4yji5m5aNmbqifUzXVjxGhPU0mhGhFqNkaWpqtv6KRiBL3xnhhhdg0SZphBsI5MpW72oJl7JaqRZrJMkuzxIfLOfJ2IK4qsvnetwblWPxtOZPos+t5Twlk277AK4bEtK2p218k42rLCQmLp1Y+iLSo5615yhvdSE09TTO1qKmma0qjStaF7Y4XSYhWdW0rejvEy+6cS5zXNvXTKukwBMQ69GIDYZ1iAvkUTcSnO1kvvNUBAxAvXrwthYWwhnXB90HeDzDeOVbXs/LO8JUv31MWzIyN+bveU8T2XjW5YOdRX1yWDxM3BRNt3VX2pHNpJh5+VemnH+ok6l1vjmQz67CMNpqnEsNkStbMp5LCya1z7oc9l6N28QYEwgSQSFiU86di3/kSD0SSLbrgHxzZTDOI9lZbiM1JNadVN8YuI4SkmhaTTrxk+N8ehXCnQ/ueWY4ZVSTIfIaHRvS4v3TDitzBZrJgH3ktvuFheMlmeGS37KjjHzRCAV2ATjHzQgEgFavaX6dlr/wAElPzWzo8lYH/qvwn33Ev0OrXuDBP9LWNf+u/SqZZVuWXgfbHv2K8ljvuwqgUkBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBEBFHM8MDkVM4Vou+5/UXIe6S3P4y6NhhfwkfclcA9Jv8ACr/f5fbKw1H4n2xzk96N9ebWd8d5QCuoCLs3G2Rjx6/PKXb9BcdFcUJUQcjHyFTU0zDlJULQtZ8am8eatEaacwxjV1EKqnYct2ZHNmB0ra4Pi87Cp08skseyZILYkwJjCyy37C5I7mOhooOtgrQx/bloU8q5SlMP0LtTW1MhR0i1utUBu1qFuMU6nFmauIZcYyLXgIYkzCzOMsm25HM2yMORZ1PtFUihmyG0soX2gZd/sLYLmylX3PEzcXUxdHTom7seu195DzzptVT1NSUvnZLbhG2thDdIn7rafLE3UN3EZU823ZZGbdSs2jq34W6lMiWIlpjHRDkW8UeY3m5RNXKWrDzka7ZkdZldDyLr7jFZSRaqRyjriqTSuopKxqookL4zZpPhLXQzF2ZTxpZcoCBbODs27bozrEpNp6mZPm1LpbXAyC20nNDPlzL57uy/W3LFHB0UFHW7ENRVNC0VDHvPus0ca3VyFfWsETyS6ucnVVqVOqXqo+oNlroktMV8l+tnOJi5922wRgFGdtHNqJMl4lMAkh2c2RI025l90dl6JKy4Cy7kx5DXZS265WOUVZIy0tT1BnW1VTVL46KZRI1JVSZa7TPTU9pihoHColVDbCJcI2ZwVsqTaOpl4bNkmhkPbMmh0SRbktO6YRttXzxuXm4I3Wrfs6JiaFd1W1dTdAitralpiotzz/xKZpdRx1pbrfP58dReOTxS04TGXSURZLmDM6U4Zs6x6bH62TPZMbQyBB4OUZiCt2uDPD8rST6YiyLVteWulJsz07D0jbVbWUfVFu+dWUlTNooUuKNJuqZ4inlIJS9T2jDp6DUSwwjJvbqvV20lTV18x86RLkCYR3TTaYADNbZu6VNJnhyjj0Kasi3kXWi1jtT25MKdpZQ6U4pUOdWbFO2in8+edFnov7oj266i90W2PIoP2hdTs1UtomRblJdvZN7PptyroRxxTrjjjp8dbyzddUf3S3jNRqdM+EnVmo+MrhVqZHwjYSwGtguN1M6EwTGEvLiAQY2Rz26FpiSqgIuTWX/PC1PdLB/ykwI1PwJ/3Lu0Vk0Xw6R7+z2wWRHf7/c+G/dDcH4K3h88PrUftDY78+q/aSV9Yfq9fwxtd/Z1N+MnLudH7W3/AJtH7Eh3Ts7/AA5h35jI/FMXk3aH9v1355O/GOVQ2606Ais9zrus3JlbKNmZdsbOl1YYu6zrdlbaYqbdta17jbr6CWWpb6n0XE08ht1BLUSVJLUiPYZDYYXiApqCppMmsnB2e2B3LOFW5/35zfYiC61e73/QXJF5Cqcm5nvTJuScgUVowTmTZ+GhKeVt60rRvKGvhm1oKFpVek1DGyU3CMuVHU0Nm4pKFHqptGmVVYqJlKyST3s4Oz5gQr9PN1NXNnZL9K6XwkWac28u9rH3Z4Gx158XSXNL1ys+zLU1N+eaWkSUI83j+1rA6nQEgzKrNVFazb5Ld8elxw0lokiFzFcUfUSKdzCfvLnHKbMnJmWqwqlEgS5UM+5pXTUluNSMfC40o8W7wuS8SzlgYricRyFw21Sx1Ud425ERUfFMVctC1z/pTTTKW41pbdW0354YUn/JrSLdBWAUk97za+YHZ89qzpT7s2fN8nNLeMj1QXbuAN1izN3phLNsyknLqbtlm3GqmYQ27XtdVrnJGdkE16nHqs37irG6VdUnj8VZ0TWuvFLTHx+rdOm9JaTbLDM+6YafsK1Tyrkhohknhy6KgdyXLdi194njHfLyNYVvXdfl0X+dtUOOceSdNFSl11qayQapa6SpXa15slISklLVxjJOvCMylxITMFoaF+WjvaftnE73ArdRLvYpXVflA0x3mw3+FbpkPcFtzJ1Fk5q58p3muVyrLYVnbgn4yloYeWppjDD1nVdJIxdVGu0r0fVz9daCHnHGVNqpFvGbJlxEixQ4k2j2gk4yyAdJ1mkd+x7cot+2zLYYkOl4fIpcoMhnFdOezMt8srcmpY6cuy6MpZmyVmq5ZvHkli+2pW7K1dAVg2lMV8VKSjVs0UbW+c6eVkZC345x+uJKKt4qFpK3DSkiK1Mr59WwYdSxl1Ana50xhLX3LQWl1kWxIN2OUCxYcmX0c9LqTeoYXbrrWXssbttsARGGSyK+HF+5A7Z1+WBeWQc8ZJzTQ4npKmhxnbF6opG4+2aeqNknfPdXS1LlXcrxM0jLaXK83lpbZSkjJJEQzarGxTNqaGjOuq5ku697rwfaO5JcYRgDAWmAAyK1OluxSbraAamiBEdX3IhYD3Pc5wc2WOlX5aqMkmtXVF8RCVrUktVrSlJG8ZaaE+sy2rLx3FMy10Mxx+ZNEwyg4xnBkHbhhaI51ltcySBTSwHCEC45YjtxhaoFVNARWsWl+nZa/wDBJX81s6PJWCf6r8J99xL9Dq17fwT/AEt41/679KpllWLh/W/bHvxeSx33YVQqpICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICKDPTphmVDZboVtO9baFyX5iKtgLTinpiXcnYSpRQtO0zLimKV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mgj5v+sqcWqgg07yOYe0Vk4bLccUkQcXDXMy/dBZEN/xOreHz5lw3B+Ct0fO362biK/Y2Hx6r9pIX1m9AT7my215H7vpvxk5d0oLRKC5iEF4HjSHdOysxnmxh2t9z6DT7v8A2mLyVjwvY5XuzitnfjHKvYN9rKH2PgnkWntTYGsofY+CeRLU2BrKH2PgnkS1Ngayh9j4J5EtTYGsofY+CeRLU2BrKH2PgnkS1Ngayh9j4J5EtTYGsofY+CeRLU2BrKH2PgnkS1Ngayh9j4J5EtTYGsofY+CeRLU2BrKH2PgnkS1Ngayh9j4J5EtTYGsofY+CeRLVataX6dlr8+klPzWzo8m4MWn61mEXO81mJQ+R1a9w4J/paxr/ANd+lUyyql91+t+2PewyryX9t2FJHqQkpFSCICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICICKOZ4YHIqZwrRd9z+ouQ90lufxl0bDC/hI+5K4B6Tf4Vf7/L7ZWGo+TpjnJyDfXm2X3x3lAK6gIpExkU9Y1rLpypzemKrFLouTlCjlkDvVAgqICIZnycIKF2BvFTtFFLWhOALt5SE0EGxPt7Q1ax3uJcnBs8MLmdX2PsgVAqiAi5NZn88LU90sH/KTAjU/An/AHLu0Vk0Xw6R7+z2wWRHf7/c+G/dDcH4K3h87/rU24hsdH49V+0kr6w/V6/hja7+zqb8ZOXc6P2tv/No/YkO6dnR/wD65h35jI/FMXk3aH9v1355O/GOVQ3EAtOgQCKSIRutJhnVggxJOlOExcEgK812hDB0sMGZSJjaoEYBUQUgDYir2H4QiG3MqjkUaHzhLWDQqxTg0EdWHuvq25wa687vSIDfU6CD5Ie4QyKbYtGrd7sfUFB8AzQxrJBbZGz7Culwc2A75tjt/OqRYgFBAgEVrFpfp2Wv/BJX81s6PJWB/wCq/CffcS/Q6te38E/0t41/679KpllWLh/W/bHvwLyWO+7CqFVJARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARARRzPDA5FTOFaLvuf1FyHuktz+MujYYX8JH3JXAPSb/Cr/f5fbKw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" alt="Docker"></p><p>åŸºäº Linux Namespace çš„éš”ç¦»æœºåˆ¶ç›¸æ¯”äºè™šæ‹ŸåŒ–æŠ€æœ¯ä¹Ÿæœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯ï¼šéš”ç¦»å¾—ä¸å½»åº•ã€‚</p><p>é¦–å…ˆï¼Œæ—¢ç„¶å®¹å™¨åªæ˜¯è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå¤šä¸ªå®¹å™¨ä¹‹é—´ä½¿ç”¨çš„å°±è¿˜æ˜¯åŒä¸€ä¸ªå®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</p><p>å…¶æ¬¡ï¼Œåœ¨ Linux å†…æ ¸ä¸­ï¼Œæœ‰å¾ˆå¤šèµ„æºå’Œå¯¹è±¡æ˜¯ä¸èƒ½è¢« Namespace åŒ–çš„ï¼Œæœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼šæ—¶é—´ã€‚</p><h2 id="Linux-Control-Group"><a href="#Linux-Control-Group" class="headerlink" title="Linux Control Group"></a>Linux Control Group</h2><p>Linux Cgroups æœ€ä¸»è¦çš„ä½œç”¨ï¼Œå°±æ˜¯é™åˆ¶ä¸€ä¸ªè¿›ç¨‹ç»„èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ŒåŒ…æ‹¬ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå¸¦å®½ç­‰ç­‰ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh">mount -t cgroupcgroup on /sys/fs/cgroup/systemd <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)cgroup on /sys/fs/cgroup/devices <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,devices)cgroup on /sys/fs/cgroup/cpuset <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)cgroup on /sys/fs/cgroup/cpu,cpuacct <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)cgroup on /sys/fs/cgroup/blkio <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,blkio)cgroup on /sys/fs/cgroup/pids <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,pids)cgroup on /sys/fs/cgroup/memory <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,memory)cgroup on /sys/fs/cgroup/perf_event <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)cgroup on /sys/fs/cgroup/hugetlb <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)cgroup on /sys/fs/cgroup/freezer <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,freezer)cgroup on /sys/fs/cgroup/net_cls,net_prio <span class="hljs-built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)</code></pre></div><p>è¿›å…¥ /sys/fs/cgroup/cpu ç›®å½•ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/sys/fs/cgroup/cpu</span><span class="hljs-variable">$ </span>mkdir containerroot<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/sys/fs/cgroup/cpu</span><span class="hljs-variable">$ </span>ls container/cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us  cpu.shares notify_on_releasecgroup.procs      cpu.cfs_quota_us  cpu.rt_runtime_us cpu.stat  tasks</code></pre></div><p>è¿™ä¸ªç›®å½•å°±ç§°ä¸ºä¸€ä¸ªâ€œæ§åˆ¶ç»„â€ã€‚ä½ ä¼šå‘ç°ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ä½ æ–°åˆ›å»ºçš„ container ç›®å½•ä¸‹ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å­ç³»ç»Ÿå¯¹åº”çš„èµ„æºé™åˆ¶æ–‡ä»¶ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨åå°æ‰§è¡Œè¿™æ ·ä¸€æ¡è„šæœ¬ï¼š</p><div class="code-wrapper"><pre><code class="hljs ada"><span class="hljs-keyword">while</span> : ; <span class="hljs-keyword">do</span> : ; done &amp;[<span class="hljs-number">1</span>] <span class="hljs-number">226</span></code></pre></div><p>æ˜¾ç„¶ï¼Œå®ƒæ‰§è¡Œäº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå¯ä»¥æŠŠè®¡ç®—æœºçš„ CPU åƒåˆ° 100%ï¼Œæ ¹æ®å®ƒçš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªè„šæœ¬åœ¨åå°è¿è¡Œçš„è¿›ç¨‹å·ï¼ˆPIDï¼‰æ˜¯ 226ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ top æŒ‡ä»¤æ¥ç¡®è®¤ä¸€ä¸‹ CPU æœ‰æ²¡æœ‰è¢«æ‰“æ»¡ï¼š</p><div class="code-wrapper"><pre><code class="hljs vim">$ top%Cpu0 :<span class="hljs-number">100.0</span> us, <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>, <span class="hljs-number">0.0</span> ni, <span class="hljs-number">0.0</span> id, <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>, <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>, <span class="hljs-number">0.0</span> si, <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span></code></pre></div><p>åœ¨è¾“å‡ºé‡Œå¯ä»¥çœ‹åˆ°ï¼ŒCPU çš„ä½¿ç”¨ç‡å·²ç» 100% äº†ï¼ˆ%Cpu0 :100.0 usï¼‰ã€‚</p><p>è€Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ container ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œçœ‹åˆ° container æ§åˆ¶ç»„é‡Œçš„ CPU quota è¿˜æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼ˆå³ï¼š-1ï¼‰ï¼ŒCPU period åˆ™æ˜¯é»˜è®¤çš„ 100 msï¼ˆ100000 usï¼‰ï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">cat <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu<span class="hljs-regexp">/container/</span>cpu.cfs_quota_us -<span class="hljs-number">1</span>cat <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu<span class="hljs-regexp">/container/</span>cpu.cfs_period_us <span class="hljs-number">100000</span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›æ–‡ä»¶çš„å†…å®¹æ¥è®¾ç½®é™åˆ¶ã€‚</p><p>æ¯”å¦‚ï¼Œå‘ container ç»„é‡Œçš„ cfs_quota æ–‡ä»¶å†™å…¥ 20 msï¼ˆ20000 usï¼‰ï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">echo <span class="hljs-number">20000</span> &gt; <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu<span class="hljs-regexp">/container/</span>cpu.cfs_quota_us</code></pre></div><p>ç»“åˆå‰é¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥èƒ½æ˜ç™½è¿™ä¸ªæ“ä½œçš„å«ä¹‰ï¼Œå®ƒæ„å‘³ç€åœ¨æ¯ 100 ms çš„æ—¶é—´é‡Œï¼Œè¢«è¯¥æ§åˆ¶ç»„é™åˆ¶çš„è¿›ç¨‹åªèƒ½ä½¿ç”¨ 20 ms çš„ CPU æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿›ç¨‹åªèƒ½ä½¿ç”¨åˆ° 20% çš„ CPU å¸¦å®½ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠè¢«é™åˆ¶çš„è¿›ç¨‹çš„ PID å†™å…¥ container ç»„é‡Œçš„ tasks æ–‡ä»¶ï¼Œä¸Šé¢çš„è®¾ç½®å°±ä¼šå¯¹è¯¥è¿›ç¨‹ç”Ÿæ•ˆäº†ï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">echo <span class="hljs-number">226</span> &gt; <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu<span class="hljs-regexp">/container/</span>tasks</code></pre></div><p>æˆ‘ä»¬å¯ä»¥ç”¨ top æŒ‡ä»¤æŸ¥çœ‹ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs vim">$ top%Cpu0 : <span class="hljs-number">20.3</span> us, <span class="hljs-number">0.0</span> <span class="hljs-keyword">sy</span>, <span class="hljs-number">0.0</span> ni, <span class="hljs-number">79.7</span> id, <span class="hljs-number">0.0</span> <span class="hljs-keyword">wa</span>, <span class="hljs-number">0.0</span> <span class="hljs-keyword">hi</span>, <span class="hljs-number">0.0</span> si, <span class="hljs-number">0.0</span> <span class="hljs-keyword">st</span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè®¡ç®—æœºçš„ CPU ä½¿ç”¨ç‡ç«‹åˆ»é™åˆ°äº† 20%ï¼ˆ%Cpu0 : 20.3 usï¼‰ã€‚</p><p>é™¤ CPU å­ç³»ç»Ÿå¤–ï¼ŒCgroups çš„æ¯ä¸€é¡¹å­ç³»ç»Ÿéƒ½æœ‰å…¶ç‹¬æœ‰çš„èµ„æºé™åˆ¶èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼š</p><ul><li>blkioï¼Œä¸ºâ€‹â€‹â€‹å—â€‹â€‹â€‹è®¾â€‹â€‹â€‹å¤‡â€‹â€‹â€‹è®¾â€‹â€‹â€‹å®šâ€‹â€‹â€‹I/O é™â€‹â€‹â€‹åˆ¶ï¼Œä¸€èˆ¬ç”¨äºç£ç›˜ç­‰è®¾å¤‡ï¼›</li><li>cpusetï¼Œä¸ºè¿›ç¨‹åˆ†é…å•ç‹¬çš„ CPU æ ¸å’Œå¯¹åº”çš„å†…å­˜èŠ‚ç‚¹ï¼›</li><li>memoryï¼Œä¸ºè¿›ç¨‹è®¾å®šå†…å­˜ä½¿ç”¨çš„é™åˆ¶ã€‚</li></ul><p>Linux Cgroups çš„è®¾è®¡è¿˜æ˜¯æ¯”è¾ƒæ˜“ç”¨çš„ï¼Œç®€å•ç²—æš´åœ°ç†è§£å‘¢ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå­ç³»ç»Ÿç›®å½•åŠ ä¸Šä¸€ç»„èµ„æºé™åˆ¶æ–‡ä»¶çš„ç»„åˆã€‚è€Œå¯¹äº Docker ç­‰ Linux å®¹å™¨é¡¹ç›®æ¥è¯´ï¼Œå®ƒä»¬åªéœ€è¦åœ¨æ¯ä¸ªå­ç³»ç»Ÿä¸‹é¢ï¼Œä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªæ§åˆ¶ç»„ï¼ˆå³åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼‰ï¼Œç„¶ååœ¨å¯åŠ¨å®¹å™¨è¿›ç¨‹ä¹‹åï¼ŒæŠŠè¿™ä¸ªè¿›ç¨‹çš„ PID å¡«å†™åˆ°å¯¹åº”æ§åˆ¶ç»„çš„ tasks æ–‡ä»¶ä¸­å°±å¯ä»¥äº†ã€‚</p><div class="code-wrapper"><pre><code class="hljs routeros">docker <span class="hljs-builtin-name">run</span> -it <span class="hljs-attribute">--cpu-period</span>=100000 <span class="hljs-attribute">--cpu-quota</span>=20000 ubuntu /bin/bash</code></pre></div><p>èµ„æºç›®å½•ä¸­ï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">cat <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu<span class="hljs-regexp">/docker/</span><span class="hljs-number">5</span>d5c9f67d/cpu.cfs_period_us <span class="hljs-number">100000</span>cat <span class="hljs-regexp">/sys/</span>fs<span class="hljs-regexp">/cgroup/</span>cpu<span class="hljs-regexp">/docker/</span><span class="hljs-number">5</span>d5c9f67d/cpu.cfs_quota_us <span class="hljs-number">20000</span></code></pre></div><p>Cgroups å¯¹èµ„æºçš„é™åˆ¶èƒ½åŠ›ä¹Ÿæœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œè¢«æåŠæœ€å¤šçš„è‡ªç„¶æ˜¯ /proc æ–‡ä»¶ç³»ç»Ÿçš„é—®é¢˜ã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒLinux ä¸‹çš„ /proc ç›®å½•å­˜å‚¨çš„æ˜¯è®°å½•å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è®¿é—®è¿™äº›æ–‡ä»¶ï¼ŒæŸ¥çœ‹ç³»ç»Ÿä»¥åŠå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨æƒ…å†µã€å†…å­˜å ç”¨ç‡ç­‰ï¼Œè¿™äº›æ–‡ä»¶ä¹Ÿæ˜¯ top æŒ‡ä»¤æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯çš„ä¸»è¦æ•°æ®æ¥æºã€‚</p><p>ä½†æ˜¯ï¼Œä½ å¦‚æœåœ¨å®¹å™¨é‡Œæ‰§è¡Œ top æŒ‡ä»¤ï¼Œå°±ä¼šå‘ç°ï¼Œå®ƒæ˜¾ç¤ºçš„ä¿¡æ¯å±…ç„¶æ˜¯å®¿ä¸»æœºçš„ CPU å’Œå†…å­˜æ•°æ®ï¼Œè€Œä¸æ˜¯å½“å‰å®¹å™¨çš„æ•°æ®ã€‚</p><p>é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯ï¼Œ/proc æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸çŸ¥é“ç”¨æˆ·é€šè¿‡ Cgroups ç»™è¿™ä¸ªå®¹å™¨åšäº†ä»€ä¹ˆæ ·çš„èµ„æºé™åˆ¶ï¼Œå³ï¼š/proc æ–‡ä»¶ç³»ç»Ÿä¸äº†è§£ Cgroups é™åˆ¶çš„å­˜åœ¨ã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªé—®é¢˜å¿…é¡»è¿›è¡Œä¿®æ­£ï¼Œå¦åˆ™åº”ç”¨ç¨‹åºåœ¨å®¹å™¨é‡Œè¯»å–åˆ°çš„ CPU æ ¸æ•°ã€å¯ç”¨å†…å­˜ç­‰ä¿¡æ¯éƒ½æ˜¯å®¿ä¸»æœºä¸Šçš„æ•°æ®ï¼Œè¿™ä¼šç»™åº”ç”¨çš„è¿è¡Œå¸¦æ¥éå¸¸å¤§çš„å›°æƒ‘å’Œé£é™©ã€‚è¿™ä¹Ÿæ˜¯åœ¨ä¼ä¸šä¸­ï¼Œå®¹å™¨åŒ–åº”ç”¨ç¢°åˆ°çš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼Œä¹Ÿæ˜¯å®¹å™¨ç›¸è¾ƒäºè™šæ‹Ÿæœºå¦ä¸€ä¸ªä¸å°½å¦‚äººæ„çš„åœ°æ–¹ã€‚</p><p>[DOCKERåŸºç¡€æŠ€æœ¯ï¼šLINUX NAMESPACEï¼ˆä¸Šï¼‰]<a href="https://coolshell.cn/articles/17010.html">https://coolshell.cn/articles/17010.html</a>)</p><p>å¯¹ Docker é¡¹ç›®æ¥è¯´ï¼Œå®ƒæœ€æ ¸å¿ƒçš„åŸç†å®é™…ä¸Šå°±æ˜¯ä¸ºå¾…åˆ›å»ºçš„ç”¨æˆ·è¿›ç¨‹ï¼š</p><ul><li>å¯ç”¨ Linux Namespace é…ç½®ï¼›</li><li>è®¾ç½®æŒ‡å®šçš„ Cgroups å‚æ•°ï¼›</li><li>åˆ‡æ¢è¿›ç¨‹çš„æ ¹ç›®å½•ï¼ˆChange Rootï¼‰ã€‚</li></ul><p>å¦å¤–ï¼Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œrootfs åªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ‰€åŒ…å«çš„æ–‡ä»¶ã€é…ç½®å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™ä¸¤éƒ¨åˆ†æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œæ“ä½œç³»ç»Ÿåªæœ‰åœ¨å¼€æœºå¯åŠ¨æ—¶æ‰ä¼šåŠ è½½æŒ‡å®šç‰ˆæœ¬çš„å†…æ ¸é•œåƒã€‚</p><p>æ‰€ä»¥è¯´ï¼Œrootfs åªåŒ…æ‹¬äº†æ“ä½œç³»ç»Ÿçš„â€œèº¯å£³â€ï¼Œå¹¶æ²¡æœ‰åŒ…æ‹¬æ“ä½œç³»ç»Ÿçš„â€œçµé­‚â€ã€‚</p><p>Docker å…¬å¸åœ¨å®ç° Docker é•œåƒæ—¶å¹¶æ²¡æœ‰æ²¿ç”¨ä»¥å‰åˆ¶ä½œ rootfs çš„æ ‡å‡†æµç¨‹ï¼Œè€Œæ˜¯åšäº†ä¸€ä¸ªå°å°çš„åˆ›æ–°ï¼š</p><blockquote><p>Docker åœ¨é•œåƒçš„è®¾è®¡ä¸­ï¼Œå¼•å…¥äº†å±‚ï¼ˆlayerï¼‰çš„æ¦‚å¿µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åˆ¶ä½œé•œåƒçš„æ¯ä¸€æ­¥æ“ä½œï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå±‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¢é‡ rootfsã€‚</p></blockquote><p>å½“ç„¶ï¼Œè¿™ä¸ªæƒ³æ³•ä¸æ˜¯å‡­ç©ºè‡†é€ å‡ºæ¥çš„ï¼Œè€Œæ˜¯ç”¨åˆ°äº†ä¸€ç§å«ä½œè”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion File Systemï¼‰çš„èƒ½åŠ›ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥å‰–æKubernetesä¹‹Dockerç¯‡</title>
    <link href="/2022/07/01/405/"/>
    <url>/2022/07/01/405/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆå‡ºèŒ…åº"><a href="#åˆå‡ºèŒ…åº" class="headerlink" title="åˆå‡ºèŒ…åº"></a>åˆå‡ºèŒ…åº</h2><p>PaaS ä¹‹æ‰€ä»¥èƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·å¤§è§„æ¨¡éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤é‡Œï¼Œæ˜¯å› ä¸ºå®ƒæä¾›äº†ä¸€å¥—åº”ç”¨æ‰“åŒ…çš„åŠŸèƒ½ã€‚ç„¶è€Œä¸€æ—¦ç”¨ä¸Šäº† PaaSï¼Œç”¨æˆ·å°±å¿…é¡»ä¸ºæ¯ç§è¯­è¨€ã€æ¯ç§æ¡†æ¶ï¼Œç”šè‡³æ¯ä¸ªç‰ˆæœ¬çš„åº”ç”¨ç»´æŠ¤ä¸€ä¸ªæ‰“å¥½çš„åŒ…ã€‚è¿™ä¸ªæ‰“åŒ…è¿‡ç¨‹ï¼Œæ²¡æœ‰ä»»ä½•ç« æ³•å¯å¾ªï¼Œæ›´éº»çƒ¦çš„æ˜¯ï¼Œæ˜æ˜åœ¨æœ¬åœ°è¿è¡Œå¾—å¥½å¥½çš„åº”ç”¨ï¼Œå´éœ€è¦åšå¾ˆå¤šä¿®æ”¹å’Œé…ç½®å·¥ä½œæ‰èƒ½åœ¨ PaaS é‡Œè¿è¡Œèµ·æ¥ã€‚è€Œè¿™äº›ä¿®æ”¹å’Œé…ç½®ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç»éªŒå¯ä»¥å€Ÿé‰´ï¼ŒåŸºæœ¬ä¸Šå¾—é ä¸æ–­è¯•é”™ï¼Œç›´åˆ°ä½ æ‘¸æ¸…æ¥šäº†æœ¬åœ°åº”ç”¨å’Œè¿œç«¯ PaaS åŒ¹é…çš„â€œè„¾æ°”â€æ‰èƒ½å¤Ÿæå®šã€‚</p><p>æœ€åç»“å±€æ˜¯ï¼Œç¡®å®æ˜¯èƒ½ä¸€é”®éƒ¨ç½²äº†ï¼Œä½†æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªä¸€é”®éƒ¨ç½²ï¼Œç”¨æˆ·ä¸ºæ¯ä¸ªåº”ç”¨æ‰“åŒ…çš„å·¥ä½œå¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼Œè´¹å°½å¿ƒæœºã€‚</p><p>Docker çš„å‡ºç°æ”¹å˜äº†è¿™ä¸€ç°çŠ¶ï¼ŒDocker é•œåƒè§£å†³äº†æ‰“åŒ…æ•´ä¸ªæ ¹æœ¬æ€§çš„é—®é¢˜ã€‚è¿™ä¹Ÿæˆä¸ºäº† Docker é¡¹ç›®æˆåŠŸçš„å…³é”®ã€‚</p><p>æ‰€è°“ Docker é•œåƒï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ã€‚å¤§å¤šæ•° Docker é•œåƒæ˜¯ç›´æ¥ç”±ä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•æ„æˆçš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‹ç¼©åŒ…é‡Œçš„å†…å®¹è·Ÿä½ æœ¬åœ°å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p><p>Docker é•œåƒæœ€å‰å®³çš„åœ°æ–¹åœ¨äºï¼Œåªè¦æœ‰è¿™ä¸ªå‹ç¼©åŒ…åœ¨æ‰‹ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨æŸç§æŠ€æœ¯åˆ›å»ºä¸€ä¸ªâ€œæ²™ç›’â€ï¼Œåœ¨â€œæ²™ç›’â€ä¸­è§£å‹è¿™ä¸ªå‹ç¼©åŒ…ï¼Œç„¶åå°±å¯ä»¥è¿è¡Œä½ çš„ç¨‹åºäº†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªå‹ç¼©åŒ…åŒ…å«äº†å®Œæ•´çš„æ“ä½œç³»ç»Ÿæ–‡ä»¶å’Œç›®å½•ï¼Œä¹Ÿå°±æ˜¯åŒ…å«äº†è¿™ä¸ªåº”ç”¨è¿è¡Œæ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–ï¼Œæ‰€ä»¥ä½ å¯ä»¥å…ˆç”¨è¿™ä¸ªå‹ç¼©åŒ…åœ¨æœ¬åœ°è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œå®Œæˆä¹‹åï¼Œå†æŠŠè¿™ä¸ªå‹ç¼©åŒ…ä¸Šä¼ åˆ°äº‘ç«¯è¿è¡Œã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ å®Œå…¨ä¸éœ€è¦è¿›è¡Œä»»ä½•é…ç½®æˆ–è€…ä¿®æ”¹ï¼Œå› ä¸ºè¿™ä¸ªå‹ç¼©åŒ…èµ‹äºˆäº†ä½ ä¸€ç§æå…¶å®è´µçš„èƒ½åŠ›ï¼šæœ¬åœ°ç¯å¢ƒå’Œäº‘ç«¯ç¯å¢ƒçš„é«˜åº¦ä¸€è‡´ï¼</p><p>é‚£ä¹ˆåªéœ€è¦ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">docker build <span class="hljs-string">&quot;æŸä¸ªé•œåƒ&quot;</span>docker run <span class="hljs-string">&quot;æ•´ä¸ªé•œåƒ&quot;</span></code></pre></div><p>Docker é¡¹ç›®ç»™ PaaS ä¸–ç•Œå¸¦æ¥çš„â€œé™ç»´æ‰“å‡»â€ï¼Œå…¶å®æ˜¯æä¾›äº†ä¸€ç§éå¸¸ä¾¿åˆ©çš„æ‰“åŒ…æœºåˆ¶ã€‚è¿™ç§æœºåˆ¶ç›´æ¥æ‰“åŒ…äº†åº”ç”¨è¿è¡Œæ‰€éœ€è¦çš„æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œä»è€Œä¿è¯äº†æœ¬åœ°ç¯å¢ƒå’Œäº‘ç«¯ç¯å¢ƒçš„é«˜åº¦ä¸€è‡´ï¼Œé¿å…äº†ç”¨æˆ·é€šè¿‡â€œè¯•é”™â€æ¥åŒ¹é…ä¸¤ç§ä¸åŒè¿è¡Œç¯å¢ƒä¹‹é—´å·®å¼‚çš„ç—›è‹¦è¿‡ç¨‹ã€‚</p><h2 id="å´­éœ²å¤´è§’"><a href="#å´­éœ²å¤´è§’" class="headerlink" title="å´­éœ²å¤´è§’"></a>å´­éœ²å¤´è§’</h2><p>Docker é¡¹ç›®ä¹‹æ‰€ä»¥èƒ½å–å¾—å¦‚æ­¤é«˜çš„å…³æ³¨ï¼Œä¸€æ–¹é¢æ˜¯å®ƒè§£å†³äº†åº”ç”¨æ‰“åŒ…å’Œå‘å¸ƒè¿™ä¸€å›°æ‰°è¿ç»´äººå‘˜å¤šå¹´çš„æŠ€æœ¯éš¾é¢˜ï¼›è€Œå¦ä¸€æ–¹é¢ï¼Œå°±æ˜¯å› ä¸ºå®ƒç¬¬ä¸€æ¬¡æŠŠä¸€ä¸ªçº¯åç«¯çš„æŠ€æœ¯æ¦‚å¿µï¼Œé€šè¿‡éå¸¸å‹å¥½çš„è®¾è®¡å’Œå°è£…ï¼Œäº¤åˆ°äº†æœ€å¹¿å¤§çš„å¼€å‘è€…ç¾¤ä½“æ‰‹é‡Œã€‚</p><p>è§£å†³äº†åº”ç”¨æ‰“åŒ…è¿™ä¸ªæ ¹æœ¬æ€§çš„é—®é¢˜ï¼ŒåŒå¼€å‘è€…ä¸ç”Ÿä¿±æ¥çš„çš„äº²å¯†å…³ç³»ï¼Œå†åŠ ä¸Š PaaS æ¦‚å¿µå·²ç»æ·±å…¥äººå¿ƒçš„å®Œç¾å¥‘æœºï¼Œæˆä¸º Docker è¿™ä¸ªæŠ€æœ¯ä¸Šçœ‹ä¼¼å¹³æ·¡æ— å¥‡çš„é¡¹ç›®ä¸€ä¸¾èµ°çº¢çš„é‡è¦åŸå› ã€‚</p><p>Docker é¡¹ç›®ä»å‘å¸ƒä¹‹åˆå°±å…¨é¢å‘åŠ›ï¼Œä»æŠ€æœ¯ã€ç¤¾åŒºã€å•†ä¸šã€å¸‚åœºå…¨æ–¹ä½äº‰å–åˆ°çš„å¼€å‘è€…ç¾¤ä½“ï¼Œå®é™…ä¸Šæ˜¯ä¸ºæ­¤åå¸å¼•æ•´ä¸ªç”Ÿæ€åˆ°è‡ªå®¶â€œPaaSâ€ä¸Šçš„ä¸€ä¸ªé“ºå«ã€‚åªä¸è¿‡è¿™æ—¶ï¼Œâ€œPaaSâ€çš„å®šä¹‰å·²ç»å…¨ç„¶ä¸æ˜¯ Cloud Foundry æè¿°çš„é‚£ä¸ªæ ·å­ï¼Œè€Œæ˜¯å˜æˆäº†ä¸€å¥—ä»¥ Docker å®¹å™¨ä¸ºæŠ€æœ¯æ ¸å¿ƒï¼Œä»¥ Docker é•œåƒä¸ºæ‰“åŒ…æ ‡å‡†çš„ã€å…¨æ–°çš„â€œå®¹å™¨åŒ–â€æ€è·¯ã€‚</p><h2 id="ç¾¤é›„å¹¶èµ·"><a href="#ç¾¤é›„å¹¶èµ·" class="headerlink" title="ç¾¤é›„å¹¶èµ·"></a>ç¾¤é›„å¹¶èµ·</h2><p>Docker å…¬å¸åœ¨ 2014 å¹´å°±å·²ç»å®šå¥½äº†å¹³å°åŒ–çš„å‘å±•æ–¹å‘ï¼Œå¹¶ä¸”ç»å¯¹ä¸ä¼šè·Ÿ CoreOS åœ¨å¹³å°å±‚é¢å¼€å±•ä»»ä½•åˆä½œï¼Œåœ¨ 2014 å¹´ 12 æœˆçš„ DockerCon ä¸Šå‘å¸ƒäº† Swarm ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-comment"># å•æœº Docker é¡¹ç›®ï¼š</span>docker run <span class="hljs-string">&quot;æˆ‘çš„å®¹å™¨&quot;</span><span class="hljs-comment"># å¤šæœº Docker é¡¹ç›®ï¼š</span>docker run -H <span class="hljs-string">&quot;æˆ‘çš„ Swarm é›†ç¾¤ API åœ°å€&quot;</span> <span class="hljs-string">&quot;æˆ‘çš„å®¹å™¨&quot;</span></code></pre></div><p>Fig é¡¹ç›®ç¬¬ä¸€æ¬¡æå‡ºäº†â€œå®¹å™¨ç¼–æ’â€ï¼ˆContainer Orchestrationï¼‰çš„æ¦‚å¿µï¼Œè¢«æ”¶è´­åæ”¹åä¸º Composeï¼Œå®ƒæˆäº† Docker å…¬å¸åˆ°ç›®å‰ä¸ºæ­¢ç¬¬äºŒå¤§å—æ¬¢è¿çš„é¡¹ç›®ï¼Œä¸€ç›´åˆ°ä»Šå¤©ä¹Ÿä¾ç„¶è¢«å¾ˆå¤šäººä½¿ç”¨ã€‚</p><p>ç”±æ­¤ï¼ŒDocker å…¬å¸ Docker Composeã€Swarm å’Œ Machineâ€œä¸‰ä»¶å¥—â€ï¼Œåœ¨é‡æ–°å®šä¹‰ PaaS çš„æ–¹å‘ä¸Šèµ°å‡ºäº†æœ€å…³é”®çš„ä¸€æ­¥ã€‚</p><p>è€Œ Mesos ç¤¾åŒºå‡­å€Ÿè¶…å¤§è§„æ¨¡é›†ç¾¤çš„ç®¡ç†ç»éªŒå’Œé€šè¿‡ Marathon å®ç°äº†è¯¸å¦‚åº”ç”¨æ‰˜ç®¡å’Œè´Ÿè½½å‡è¡¡çš„ PaaS åŠŸèƒ½ä¹‹åï¼Œè¿›åŒ–æˆäº†ä¸€ä¸ªé«˜åº¦æˆç†Ÿçš„ PaaS é¡¹ç›®ç»„åˆ Mesos+Marathonï¼Œä»è€Œå æ®äº†å®¹å™¨åŒ–æµªæ½®ä¸­çš„ä¸€å¸­ä¹‹åœ°ã€‚</p><p>CoreOSã€RedHat å®Œå…¨åœ¨è¿™ä¸€æ—¶æœŸè¢« Docker å…¬å¸å‹åˆ¶äº†ã€‚</p><h2 id="å°˜åŸƒè½å®š"><a href="#å°˜åŸƒè½å®š" class="headerlink" title="å°˜åŸƒè½å®š"></a>å°˜åŸƒè½å®š</h2><p>2014 å¹´ 6 æœˆï¼ŒGoogle å…¬å¸è¯ç”Ÿ Kubernetes é¡¹ç›®ã€‚è€Œè¿™ä¸ªé¡¹ç›®ï¼Œä¸ä»…æŒ½æ•‘äº†å½“æ—¶çš„ CoreOS å’Œ RedHatï¼Œè¿˜å¦‚åŒå½“å¹´ Docker é¡¹ç›®çš„æ¨ªç©ºå‡ºä¸–ä¸€æ ·ï¼Œå†ä¸€æ¬¡æ”¹å˜äº†æ•´ä¸ªå®¹å™¨å¸‚åœºçš„æ ¼å±€ã€‚</p><p>Docker æ€¥é€Ÿæ‰©å¼ çš„åŒæ—¶ï¼Œç¤¾åŒºä¹Ÿå‡ºç°å¯¹ Docker å…¬å¸å•†ä¸šåŒ–æˆ˜ç•¥çš„ç§ç§é¡¾è™‘çš„å£°éŸ³ã€‚Docker å…¬å¸åœ¨ Docker å¼€æºé¡¹ç›®çš„å‘å±•ä¸Šï¼Œå§‹ç»ˆä¿æŒç€ç»å¯¹çš„æƒå¨å’Œå‘è¨€æƒï¼Œå¹¶åœ¨å¤šä¸ªåœºåˆç”¨å®é™…è¡ŒåŠ¨æŒ‘æˆ˜åˆ°äº†å…¶ä»–ç©å®¶ï¼ˆæ¯”å¦‚ï¼ŒCoreOSã€RedHatï¼Œç”šè‡³è°·æ­Œå’Œå¾®è½¯ï¼‰çš„åˆ‡èº«åˆ©ç›Šã€‚</p><p>2015 å¹´ 6 æœˆ 22 æ—¥ï¼Œç”± Docker å…¬å¸ç‰µå¤´ï¼ŒCoreOSã€Googleã€RedHat ç­‰å…¬å¸å…±åŒå®£å¸ƒï¼ŒDocker å…¬å¸å°† Libcontainer æå‡ºï¼Œå¹¶æ”¹åä¸º RunC é¡¹ç›®ï¼Œäº¤ç”±ä¸€ä¸ªå®Œå…¨ä¸­ç«‹çš„åŸºé‡‘ä¼šç®¡ç†ï¼Œç„¶åä»¥ RunC ä¸ºä¾æ®ï¼Œå¤§å®¶å…±åŒåˆ¶å®šä¸€å¥—å®¹å™¨å’Œé•œåƒçš„æ ‡å‡†å’Œè§„èŒƒ OCIï¼ˆ Open Container Initiative ï¼‰ã€‚OCI çš„æå‡ºï¼Œæ„åœ¨å°†å®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒçš„å®ç°ä» Docker é¡¹ç›®ä¸­å®Œå…¨å‰¥ç¦»å‡ºæ¥ã€‚è¿™æ ·åšï¼Œä¸€æ–¹é¢å¯ä»¥æ”¹å–„ Docker å…¬å¸åœ¨å®¹å™¨æŠ€æœ¯ä¸Šä¸€å®¶ç‹¬å¤§çš„ç°çŠ¶ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¸ºå…¶ä»–ç©å®¶ä¸ä¾èµ–äº Docker é¡¹ç›®æ„å»ºå„è‡ªçš„å¹³å°å±‚èƒ½åŠ›æä¾›äº†å¯èƒ½ã€‚</p><p>OCI å¹¶æ²¡æœ‰æ”¹å˜ Docker ä¸€å®¶ç‹¬å¤§çš„ç°çŠ¶ï¼Œä½† Googleã€RedHat ç­‰å¼€æºåŸºç¡€è®¾æ–½é¢†åŸŸç©å®¶ä»¬ï¼Œå…±åŒç‰µå¤´å‘èµ·äº†ä¸€ä¸ªåä¸º CNCFï¼ˆCloud Native Computing Foundationï¼‰çš„åŸºé‡‘ä¼šæ”¹å˜äº†ç¤¾åŒºçš„æ ¼å±€ã€‚</p><p>CNCF åŸºé‡‘ä¼šçš„ç›®çš„å…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼šå®ƒå¸Œæœ›ï¼Œä»¥ Kubernetes é¡¹ç›®ä¸ºåŸºç¡€ï¼Œå»ºç«‹ä¸€ä¸ªç”±å¼€æºåŸºç¡€è®¾æ–½é¢†åŸŸå‚å•†ä¸»å¯¼çš„ã€æŒ‰ç…§ç‹¬ç«‹åŸºé‡‘ä¼šæ–¹å¼è¿è¥çš„å¹³å°çº§ç¤¾åŒºï¼Œæ¥å¯¹æŠ—ä»¥ Docker å…¬å¸ä¸ºæ ¸å¿ƒçš„å®¹å™¨å•†ä¸šç”Ÿæ€ã€‚</p><p>è€Œä¸ºäº†æ‰“é€ å‡ºè¿™æ ·ä¸€ä¸ªå›´ç»• Kubernetes é¡¹ç›®çš„â€œæŠ¤åŸæ²³â€ï¼ŒCNCF ç¤¾åŒºå°±éœ€è¦è‡³å°‘ç¡®ä¿ä¸¤ä»¶äº‹æƒ…ï¼š</p><ol><li>Kubernetes é¡¹ç›®å¿…é¡»èƒ½å¤Ÿåœ¨å®¹å™¨ç¼–æ’é¢†åŸŸå–å¾—è¶³å¤Ÿå¤§çš„ç«äº‰ä¼˜åŠ¿</li><li>CNCF ç¤¾åŒºå¿…é¡»ä»¥ Kubernetes é¡¹ç›®ä¸ºæ ¸å¿ƒï¼Œè¦†ç›–è¶³å¤Ÿå¤šçš„åœºæ™¯</li></ol><p>åœ¨å®¹å™¨ç¼–æ’é¢†åŸŸï¼ŒKubernetes é¡¹ç›®éœ€è¦é¢å¯¹æ¥è‡ª Docker å…¬å¸å’Œ Mesos ç¤¾åŒºä¸¤ä¸ªæ–¹å‘çš„å‹åŠ›ã€‚ä¸éš¾çœ‹å‡ºï¼ŒSwarm å’Œ Mesos å®é™…ä¸Šåˆ†åˆ«ä»ä¸¤ä¸ªä¸åŒçš„æ–¹å‘è®²å‡ºäº†è‡ªå·±æœ€æ“…é•¿çš„æ•…äº‹ï¼šSwarm æ“…é•¿çš„æ˜¯è·Ÿ Docker ç”Ÿæ€çš„æ— ç¼é›†æˆï¼Œè€Œ Mesos æ“…é•¿çš„åˆ™æ˜¯å¤§è§„æ¨¡é›†ç¾¤çš„è°ƒåº¦ä¸ç®¡ç†ã€‚</p><p>è¿™ä¸¤ä¸ªæ–¹å‘ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°äººåšå®¹å™¨é›†ç¾¤ç®¡ç†é¡¹ç›®æ—¶æœ€å®¹æ˜“æƒ³åˆ°çš„ä¸¤ä¸ªå‡ºå‘ç‚¹ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼ŒKubernetes é¡¹ç›®å¦‚æœç»§ç»­åœ¨è¿™ä¸¤ä¸ªæ–¹å‘ä¸Šåšæ–‡ç« ææ€•å°±ä¸å¤ªæ˜æ™ºäº†ã€‚</p><p>æ‰€ä»¥è¿™ä¸€æ¬¡ï¼ŒKubernetes é€‰æ‹©çš„åº”å¯¹æ–¹å¼æ˜¯ï¼šBorgã€‚</p><p>å¦‚æœä½ çœ‹è¿‡ Kubernetes é¡¹ç›®æ—©æœŸçš„ GitHub Issue å’Œ Feature çš„è¯ï¼Œå°±ä¼šå‘ç°å®ƒä»¬å¤§å¤šæ¥è‡ªäº Borg å’Œ Omega ç³»ç»Ÿçš„å†…éƒ¨ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§è½åˆ° Kubernetes é¡¹ç›®ä¸Šï¼Œå°±æ˜¯ Podã€Sidecar ç­‰åŠŸèƒ½å’Œè®¾è®¡æ¨¡å¼ã€‚</p><p>è¿™å°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆ Kubernetes å‘å¸ƒåï¼Œå¾ˆå¤šäººâ€œæŠ±æ€¨â€å…¶è®¾è®¡æ€æƒ³è¿‡äºâ€œè¶…å‰â€çš„åŸå› ï¼šKubernetes é¡¹ç›®çš„åŸºç¡€ç‰¹æ€§ï¼Œå¹¶ä¸æ˜¯å‡ ä¸ªå·¥ç¨‹å¸ˆçªç„¶â€œæ‹è„‘è¢‹â€æƒ³å‡ºæ¥çš„ä¸œè¥¿ï¼Œè€Œæ˜¯ Google å…¬å¸åœ¨å®¹å™¨åŒ–åŸºç¡€è®¾æ–½é¢†åŸŸå¤šå¹´æ¥å®è·µç»éªŒçš„æ²‰æ·€ä¸å‡åã€‚è¿™ï¼Œæ­£æ˜¯ Kubernetes é¡¹ç›®èƒ½å¤Ÿä»ä¸€å¼€å§‹å°±é¿å…åŒ Swarm å’Œ Mesos ç¤¾åŒºåŒè´¨åŒ–çš„é‡è¦æ‰‹æ®µã€‚</p><p>CNCF å®ç°äº†ç›®æ ‡ä¸€ä¹‹åçš„ä»»åŠ¡å°±æ˜¯ï¼Œå¦‚ä½•æŠŠè¿™äº›å…ˆè¿›çš„æ€æƒ³é€šè¿‡æŠ€æœ¯æ‰‹æ®µåœ¨å¼€æºç¤¾åŒºè½åœ°ï¼Œå¹¶åŸ¹è‚²å‡ºä¸€ä¸ªè®¤åŒè¿™äº›ç†å¿µçš„ç”Ÿæ€ï¼Ÿè¿™æ—¶ï¼ŒRedHat å°±å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚</p><p>å½“æ—¶ï¼ŒKubernetes å›¢é˜Ÿè§„æ¨¡å¾ˆå°ï¼Œèƒ½å¤ŸæŠ•å…¥çš„å·¥ç¨‹èƒ½åŠ›ä¹Ÿååˆ†ç´§å¼ ï¼Œè€Œè¿™æ°æ°æ˜¯ RedHat çš„é•¿å¤„ã€‚æ›´éš¾å¾—çš„æ˜¯ï¼ŒRedHat æ˜¯ä¸–ç•Œä¸Šä¸ºæ•°ä¸å¤šçš„ã€èƒ½çœŸæ­£ç†è§£å¼€æºç¤¾åŒºè¿ä½œå’Œé¡¹ç›®ç ”å‘çœŸè°›çš„åˆä½œä¼™ä¼´ã€‚</p><p>æ‰€ä»¥ï¼ŒRedHat ä¸ Google è”ç›Ÿçš„æˆç«‹ï¼Œä¸ä»…ä¿è¯äº† RedHat åœ¨ Kubernetes é¡¹ç›®ä¸Šçš„å½±å“åŠ›ï¼Œä¹Ÿæ­£å¼å¼€å¯äº†å®¹å™¨ç¼–æ’é¢†åŸŸâ€œä¸‰å›½é¼ç«‹â€çš„å±€é¢ã€‚</p><p>ä» 2017 å¹´å¼€å§‹ï¼ŒDocker å…¬å¸å…ˆæ˜¯å°† Docker é¡¹ç›®çš„å®¹å™¨è¿è¡Œæ—¶éƒ¨åˆ† Containerd æèµ ç»™ CNCF ç¤¾åŒºï¼Œæ ‡å¿—ç€ Docker é¡¹ç›®å·²ç»å…¨é¢å‡çº§æˆä¸ºä¸€ä¸ª PaaS å¹³å°ï¼›ç´§æ¥ç€ï¼ŒDocker å…¬å¸å®£å¸ƒå°† Docker é¡¹ç›®æ”¹åä¸º Mobyï¼Œç„¶åäº¤ç»™ç¤¾åŒºè‡ªè¡Œç»´æŠ¤ï¼Œè€Œ Docker å…¬å¸çš„å•†ä¸šäº§å“å°†å æœ‰ Docker è¿™ä¸ªæ³¨å†Œå•†æ ‡ã€‚</p><p>Docker å…¬å¸è¿™äº›ä¸¾æªèƒŒåçš„å«ä¹‰éå¸¸æ˜ç¡®ï¼šå®ƒå°†å…¨é¢æ”¾å¼ƒåœ¨å¼€æºç¤¾åŒºåŒ Kubernetes ç”Ÿæ€çš„ç«äº‰ï¼Œè½¬è€Œä¸“æ³¨äºè‡ªå·±çš„å•†ä¸šä¸šåŠ¡ï¼Œå¹¶ä¸”é€šè¿‡å°† Docker é¡¹ç›®æ”¹åä¸º Moby çš„ä¸¾åŠ¨ï¼Œå°†åŸæœ¬å±äº Docker ç¤¾åŒºçš„ç”¨æˆ·è½¬åŒ–æˆäº†è‡ªå·±çš„å®¢æˆ·ã€‚</p><p>2017 å¹´ 10 æœˆï¼ŒDocker å…¬å¸å‡ºäººæ„æ–™åœ°å®£å¸ƒï¼Œå°†åœ¨è‡ªå·±çš„ä¸»æ‰“äº§å“ Docker ä¼ä¸šç‰ˆä¸­å†…ç½® Kubernetes é¡¹ç›®ï¼Œè¿™æ ‡å¿—ç€æŒç»­äº†è¿‘ä¸¤å¹´ä¹‹ä¹…çš„â€œç¼–æ’ä¹‹äº‰â€è‡³æ­¤è½ä¸‹å¸·å¹•ã€‚</p><p>2018 å¹´ 1 æœˆ 30 æ—¥ï¼ŒRedHat å®£å¸ƒæ–¥èµ„ 2.5 äº¿ç¾å…ƒæ”¶è´­ CoreOSã€‚</p><p>2018 å¹´ 3 æœˆ 28 æ—¥ï¼Œè¿™ä¸€åˆ‡çº·äº‰çš„å§‹ä½œä¿‘è€…ï¼ŒDocker å…¬å¸çš„ CTO Solomon Hykes å®£å¸ƒè¾èŒï¼Œæ›¾ç»çº·çº·æ‰°æ‰°çš„å®¹å™¨æŠ€æœ¯åœˆå­ï¼Œåˆ°æ­¤å°˜åŸƒè½å®šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitåˆ é™¤æ•æ„Ÿæ–‡ä»¶çš„æäº¤å†å²</title>
    <link href="/2022/06/23/403/"/>
    <url>/2022/06/23/403/</url>
    
    <content type="html"><![CDATA[<p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‡ºç°è¿‡ git è¯¯æäº¤æ•æ„Ÿä¿¡æ¯çš„æƒ…å†µï¼Œå¦‚æœæ˜¯ç§æœ‰åº“è¿˜å¥½ï¼ŒåŠ å…¥æ˜¯å…¬æœ‰åº“å°±éå¸¸å±é™©äº†ï¼Œæˆ‘ä¹‹å‰çš„åº”å¯¹æªæ–½æ˜¯â€”â€“æ•´ä¸ªåº“åˆ é™¤ï¼Œé‡æ–°å»ºä¸ªä»“åº“æäº¤ã€‚ä½†å®é™…æ²¡å¿…è¦è¿™æ ·ï¼Œæ¯”è¾ƒ git history ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-comment"># config.yaml ä¸ºæ•æ„Ÿæ–‡ä»¶</span>git filter-branch --force --index-filter <span class="hljs-string">&#x27;git rm --cached --ignore-unmatch config.yaml&#x27;</span> --prune-empty --tag-name-filter cat -- --all<span class="hljs-comment"># éšä¾¿ä¿®æ”¹ä¸ªæ–‡ä»¶ï¼Œåšç‚¹æ— å…³ç—›ç—’çš„ä¿®æ”¹å•¥çš„</span>git commit -am <span class="hljs-string">&quot;13sai&quot;</span> <span class="hljs-comment"># å¼ºåˆ¶ push</span>git push origin --force --all</code></pre></div><p>Thatâ€™s all!</p>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gormè¯»å†™åˆ†ç¦»</title>
    <link href="/2022/06/05/402/"/>
    <url>/2022/06/05/402/</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åŒäº‹åé¦ˆ MySQL ä¸»åº“å‹åŠ›è¶Šæ¥è¶Šå¤§ï¼Œè™½ç„¶ä¸»ä»åŒæ­¥æ—©å°±å·²ç»æœ‰äº†ï¼Œä½†å‡çº§ gorm ä¹‹åä¸€ç›´æ²¡æœ‰å¼•å…¥è¯»å†™åˆ†ç¦»ï¼Œä¾¿å•†é‡ç€åŠ å…¥è¯»å†™åˆ†ç¦»å‡è½»ä¸»åº“å‹åŠ›ã€‚å¦‚ä»Šå·²ä¸Šçº¿ä¸¤æœˆæœ‰ä½™äº†ï¼Œæ¯”è¾ƒç¨³å®šï¼Œä»Šå¤©æ¥åˆ†äº«ä¸€ä¸‹åˆ©ç”¨ gorm å®ç°è¯»å†™åˆ†ç¦»ã€‚</p><p>gorm çš„è¯»å†™åˆ†ç¦»æ˜¯å·²æ‰©å±•æ’ä»¶çš„å½¢å¼å®ç°çš„ï¼Œå³ <a href="https://github.com/go-gorm/dbresolver">dbresolver</a></p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">db:</span>  <span class="hljs-attr">separation:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># é…ç½®æ˜¯å¦ä½¿ç”¨è¯»å†™åˆ†ç¦»ï¼Œæ–¹ä¾¿æ”¹é…ç½®åˆ‡æ¢</span>  <span class="hljs-attr">master:</span> <span class="hljs-string">&quot;root:123456@tcp(127.0.0.1:3306)/a0001_chat?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>  <span class="hljs-attr">slave:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;root:123456@tcp(127.0.0.1:3307)/a0001_chat?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;root:123456@tcp(127.0.0.1:3308)/a0001_chat?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></code></pre></div><h3 id="ä¸»è¦ä»£ç "><a href="#ä¸»è¦ä»£ç " class="headerlink" title="ä¸»è¦ä»£ç "></a>ä¸»è¦ä»£ç </h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;github.com/pkg/errors&quot;</span><span class="hljs-string">&quot;github.com/sirupsen/logrus&quot;</span><span class="hljs-string">&quot;github.com/spf13/viper&quot;</span><span class="hljs-string">&quot;gorm.io/driver/mysql&quot;</span><span class="hljs-string">&quot;gorm.io/gorm&quot;</span><span class="hljs-string">&quot;gorm.io/plugin/dbresolver&quot;</span>)<span class="hljs-keyword">var</span> (MainDB *gorm.DB)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)viper.SetConfigType(<span class="hljs-string">&quot;yaml&quot;</span>)viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)err := viper.ReadInConfig()<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(fmt.Errorf(<span class="hljs-string">&quot;Fatal error config file: %w \n&quot;</span>, err))&#125;MainDB, err = ConnectDB()<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(fmt.Errorf(<span class="hljs-string">&quot;Fatal MainDB config file: %w \n&quot;</span>, err))&#125;err = MainDB.Raw(<span class="hljs-string">&quot;select version()&quot;</span>).Error<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;logrus.Infof(<span class="hljs-string">&quot;err=%+v&quot;</span>, err)<span class="hljs-keyword">return</span>&#125;logrus.Info(<span class="hljs-string">&quot;13sai&quot;</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ConnectDB</span><span class="hljs-params">()</span> <span class="hljs-params">(d *gorm.DB, err error)</span></span> &#123;<span class="hljs-keyword">if</span> viper.GetBool(<span class="hljs-string">&quot;db.separation&quot;</span>) &#123;<span class="hljs-keyword">return</span> ConnectRWDB()&#125;dsn := viper.GetString(<span class="hljs-string">&quot;db.master&quot;</span>)d, err = gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.Wrap(err, <span class="hljs-string">&quot;æ•°æ®åº“è¿æ¥å¤±è´¥&quot;</span>)&#125;db, err := d.DB()<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.Wrap(err, <span class="hljs-string">&quot;è·å–æ•°æ®åº“å®ä¾‹å¤±è´¥&quot;</span>)&#125;db.SetMaxIdleConns(<span class="hljs-number">10</span>)db.SetConnMaxLifetime(time.Hour)<span class="hljs-keyword">return</span> d, <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ConnectRWDB</span><span class="hljs-params">()</span> <span class="hljs-params">(d *gorm.DB, err error)</span></span> &#123;logrus.Info(<span class="hljs-string">&quot;ä½¿ç”¨è¯»å†™åˆ†ç¦»&quot;</span>)dsn := viper.GetString(<span class="hljs-string">&quot;db.master&quot;</span>)d, err = gorm.Open(mysql.New(mysql.Config&#123;DSN: dsn,&#125;))<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err&#125;replicas := []gorm.Dialector&#123;&#125;<span class="hljs-keyword">for</span> i, s := <span class="hljs-keyword">range</span> viper.GetStringSlice(<span class="hljs-string">&quot;db.slave&quot;</span>) &#123;cfg := mysql.Config&#123;DSN: s,&#125;logrus.Infof(<span class="hljs-string">&quot;è¯»å†™åˆ†ç¦»-%d-%s&quot;</span>, i, s)replicas = <span class="hljs-built_in">append</span>(replicas, mysql.New(cfg))&#125;d.Use(dbresolver.Register(dbresolver.Config&#123;Sources: []gorm.Dialector&#123;mysql.New(mysql.Config&#123;DSN: dsn,&#125;)&#125;,Replicas: replicas,Policy:   dbresolver.RandomPolicy&#123;&#125;,&#125;).SetMaxIdleConns(<span class="hljs-number">10</span>).SetConnMaxLifetime(time.Hour).SetMaxOpenConns(<span class="hljs-number">200</span>),)<span class="hljs-keyword">return</span> d, <span class="hljs-literal">nil</span>&#125;</code></pre></div><p>ä¸»è¦ä»£ç å°±æ˜¯:</p><div class="code-wrapper"><pre><code class="hljs go">d.Use(dbresolver.Register(dbresolver.Config&#123;Sources: []gorm.Dialector&#123;mysql.New(mysql.Config&#123;DSN: dsn,&#125;)&#125;,Replicas: replicas,Policy:   dbresolver.RandomPolicy&#123;&#125;,&#125;),)</code></pre></div><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p>è¿™é‡Œåªæ˜¯åšä¸ªdemoï¼Œçœç•¥äº†ä¸šåŠ¡ä»£ç ï¼Œæ‰€ä»¥æé†’ä¸€ä¸‹</p><ul><li>åŠ¡å¿…æµ‹è¯•ä¸‹å…·ä½“ä¸šåŠ¡</li><li>æ³¨æ„å†™åç«‹å³è¯»çš„é—®é¢˜</li><li>æ³¨æ„dbä¸ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</li><li>è¿æ¥æ± å’Œè¶…æ—¶è®¾ç½®æ ¹æ®ä¸šåŠ¡å®šä¹‰</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://gorm.io/zh_CN/docs/dbresolver.html">gorm  DBResolver</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gorm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLç´¢å¼•æç¤º-å¼ºåˆ¶ç´¢å¼•å’Œå¿½ç•¥ç´¢å¼•</title>
    <link href="/2022/06/02/401/"/>
    <url>/2022/06/02/401/</url>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æ˜¨å¤©åœ¨è¿­ä»£æ–°åŠŸèƒ½æ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚<br>æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤§è¡¨ï¼Œåƒä¸‡çº§æ•°æ®ï¼Œå¤§æ¦‚ç»“æ„å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `msg` (  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,  `uid` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ç”¨æˆ·id&#x27;</span>,  `nickname` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span> COMMENT <span class="hljs-string">&#x27;ç”¨æˆ·æ˜µç§°&#x27;</span>,  `room_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;æˆ¿é—´id&#x27;</span>,  `msg` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  `add_time` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;æ·»åŠ æ—¶é—´&#x27;</span>,  `del_flag` tinyint(<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;åˆ é™¤æ ‡è®°&#x27;</span>,  `check_status` tinyint(<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å®¡æ ¸çŠ¶æ€&#x27;</span>,  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),  KEY `idx` (`room_id`,`add_time`,`check_status`)) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;</code></pre></div><p>æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `msg`  <span class="hljs-keyword">WHERE</span> room_id <span class="hljs-operator">=</span> <span class="hljs-number">225928</span>  <span class="hljs-keyword">AND</span> (add_time <span class="hljs-operator">&gt;=</span> <span class="hljs-number">1653926400</span> <span class="hljs-keyword">and</span> add_time <span class="hljs-operator">&lt;</span> <span class="hljs-number">1654012800</span>) <span class="hljs-keyword">AND</span> uid <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">1111111</span>,<span class="hljs-number">2222222</span>) <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">desc</span> LIMIT <span class="hljs-number">10</span>;</code></pre></div><p>Explain æ‰§è¡Œä¹‹åå‘ç° key æ˜¯ PRIMARYï¼Œ possible_keys æ˜¯ idxã€‚<br>å½“ç„¶ï¼ŒExplain çš„æ˜¾ç¤ºä¿¡æ¯å¹¶ä¸ä¸€å®šæ­£ç¡®ï¼Œå®é™…æŸ¥è¯¢ä¸€ä¸‹è¯•è¯•çœ‹ï¼ˆå»ºè®®åœ¨mysqlè´Ÿè½½ä¸é«˜æ—¶è¯•éªŒï¼Œå¾ˆæ…¢çš„å“¦ï¼‰</p><p><img src="/images/post/indexforce.png" alt="slow query"><br>æ…¢å‡ºå¤©é™…äº†ï¼ï¼ï¼</p><h3 id="è§£é‡Šä¸è§£å†³"><a href="#è§£é‡Šä¸è§£å†³" class="headerlink" title="è§£é‡Šä¸è§£å†³"></a>è§£é‡Šä¸è§£å†³</h3><p>è¯´æ˜å¯èƒ½å¦‚ Explain æ˜¾ç¤ºï¼Œæ²¡èµ°idxè¿™ä¸ªç´¢å¼•ï¼Œè€Œæ‰«æäº†å…¨è¡¨ã€‚MySQL çš„æŸ¥è¯¢ä¼˜åŒ–å¹¶ä¸å®Œå…¨å¯é ï¼Œå®ƒè®¤ä¸ºå…¨è¡¨æ‰«æä»£ä»·æ›´å°æ—¶ï¼Œä¼šæŒ‰å…¨è¡¨æ‰«æèµ°é€æ¸ç´¢å¼•ã€‚</p><p>é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h3 id="Index-Hints-ç´¢å¼•æç¤º"><a href="#Index-Hints-ç´¢å¼•æç¤º" class="headerlink" title="Index Hints ç´¢å¼•æç¤º"></a>Index Hints ç´¢å¼•æç¤º</h3><p>MySQL æœ‰ä¸‰ç§ç´¢å¼•æç¤ºï¼š</p><ul><li><code>USE</code> ç”¨æŒ‡å®šçš„æŸä¸ªç´¢å¼•å»åšæŸ¥è¯¢ï¼Œä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ï¼ˆå¯ä»¥æŒ‡å®šå¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯MySQLä¹Ÿå¯èƒ½ä¸ä¼šç”¨æŒ‡å®šçš„è¿™äº›ç´¢å¼•ï¼‰</li><li><code>FORCE</code> å¼ºåˆ¶MySQLä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•æŸ¥è¯¢</li><li><code>IGNORE</code> ä¸è¦ä½¿ç”¨æŸäº›ç´¢å¼•æŸ¥è¯¢</li></ul><p>ä¸Šé¢é‡åˆ°çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Force</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `msg`  FORCE INDEX(index_team_id_add_time)<span class="hljs-keyword">WHERE</span> room_id <span class="hljs-operator">=</span> <span class="hljs-number">225928</span>  <span class="hljs-keyword">AND</span> (add_time <span class="hljs-operator">&gt;=</span> <span class="hljs-number">1653926400</span> <span class="hljs-keyword">and</span> add_time <span class="hljs-operator">&lt;</span> <span class="hljs-number">1654012800</span>) <span class="hljs-keyword">AND</span> uid <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">1111111</span>,<span class="hljs-number">2222222</span>) <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">desc</span> LIMIT <span class="hljs-number">10</span>;</code></pre></div><p>æˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹çœ‹çœ‹ï¼š<br><img src="/images/post/indexerr.png" alt="force index"><br>å¤šæµ‹è¯•å‡ æ¬¡ï¼Œå‘ç°ç¡®å®å¿«äº†å¾ˆå¤šï¼Œè¾¾æˆé¢„æœŸæ•ˆæœã€‚</p><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><ul><li>ç´¢å¼•æç¤ºå»ºè®®é…åˆ explain ä½¿ç”¨</li><li>æµ‹è¯•çš„æ—¶å€™åŠ¡å¿…åœ¨æµé‡è°·åº•ï¼Œä»¥å…å½±å“ç”Ÿäº§</li></ul><h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><ul><li><a href="https://dev.mysql.com/doc/refman/5.7/en/index-hints.html">Index Hints</a></li><li><a href="https://www.cnblogs.com/jkin/p/12868434.html">MySQLç´¢å¼•æç¤º</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>db</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>protoæ–‡ä»¶ç”Ÿæˆgoä»£ç </title>
    <link href="/2022/05/25/400/"/>
    <url>/2022/05/25/400/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä¿®æ”¹å†å²é¡¹ç›®çš„æ—¶å€™ï¼Œæœ‰ä½¿ç”¨åˆ° protoæ–‡ä»¶ç”Ÿæˆgoä»£ç ï¼Œæœ‰è¸©ä¸€ä¸‹å‘ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚</p><h2 id="å¼€å§‹å‰"><a href="#å¼€å§‹å‰" class="headerlink" title="å¼€å§‹å‰"></a>å¼€å§‹å‰</h2><p>å¦‚æœä¸ç†Ÿæ‚‰Protobufè¯­æ³•å¯ä»¥å…ˆçœ‹è¿™ç¯‡-<a href="/2021/05/27/340/">Protobufè¯­æ³•</a>ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ç”Ÿäº§å·¥å…·è¯·å…ˆæ‰§è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">go get -u github.com/golang/protobuf/protogo get -u github.com/golang/protobuf/protoc-gen-gogo get -u github.com/micro/micro/v2/cmd/protoc-gen-micro</code></pre></div><h2 id="å°è¯•"><a href="#å°è¯•" class="headerlink" title="å°è¯•"></a>å°è¯•</h2><h4 id="ç¼–å†™-proto-æ–‡ä»¶"><a href="#ç¼–å†™-proto-æ–‡ä»¶" class="headerlink" title="ç¼–å†™ proto æ–‡ä»¶"></a>ç¼–å†™ proto æ–‡ä»¶</h4><p>æˆ‘ä»¬å…ˆæ–°å»ºcommon.protoï¼š</p><div class="code-wrapper"><pre><code class="hljs abnf"><span class="hljs-attribute">syntax</span> = <span class="hljs-string">&quot;proto3&quot;</span><span class="hljs-comment">;  //è¯­æ³•å£°æ˜</span>enum TypeHello &#123;    Unuse = <span class="hljs-number">0</span><span class="hljs-comment">;</span>    Morning = <span class="hljs-number">1</span><span class="hljs-comment">;</span>    Afernoon = <span class="hljs-number">2</span><span class="hljs-comment">;</span>    Evening = <span class="hljs-number">3</span><span class="hljs-comment">;</span>&#125;</code></pre></div><h3 id="protoc-ç”Ÿæˆ-pb-go"><a href="#protoc-ç”Ÿæˆ-pb-go" class="headerlink" title="protoc ç”Ÿæˆ .pb.go"></a>protoc ç”Ÿæˆ .pb.go</h3><div class="code-wrapper"><pre><code class="hljs sh">protoc --proto_path=./ --micro_out=. --go_out=. *.proto</code></pre></div><p><img src="/images/post/proto.png" alt="proto"></p><h4 id="é”™è¯¯åˆ†æ"><a href="#é”™è¯¯åˆ†æ" class="headerlink" title="é”™è¯¯åˆ†æ"></a>é”™è¯¯åˆ†æ</h4><p>èƒ½çœ‹åˆ°é”™è¯¯å…¶å®æ˜¯protoc-gen-goæŠ¥å‡ºçš„ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ol><li>ä½¿ç”¨ go_package å‚æ•°</li><li>å‘½ä»¤è¡Œä½¿ç”¨â€“go_opt=M</li></ol><p>æˆ‘æ¯”è¾ƒå»ºè®®ä½¿ç”¨ go_packageï¼Œå½“å¤šä¸ªprotoæ–‡ä»¶æœ‰ä¾èµ–æ—¶ï¼Œä½¿ç”¨ go_package æ¯”è¾ƒæ¸…æ™°ï¼Œä½¿ç”¨ â€“go_opt=M å¯èƒ½è¦éº»çƒ¦å¾—å¤šï¼Œç”šè‡³å‡ºé”™ã€‚è¯¸å¦‚ä»¥ä¸‹ï¼š<br><img src="/images/post/protoerror.png"></p><div class="code-wrapper"><pre><code class="hljs abnf">// common.proto<span class="hljs-attribute">syntax</span> = <span class="hljs-string">&quot;proto3&quot;</span><span class="hljs-comment">;  //è¯­æ³•å£°æ˜</span>package common<span class="hljs-comment">; //åŒ…å</span>// go_package ä½¿ç”¨ go mod éœ€è¦çš„è·¯å¾„å³å¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ç§æœ‰ gitlab packageoption go_package = <span class="hljs-string">&quot;github.com/13sai/go-learing/micro/hello/common&quot;</span><span class="hljs-comment">;</span>enum TypeHello &#123;    Unuse = <span class="hljs-number">0</span><span class="hljs-comment">;</span>    Morning = <span class="hljs-number">1</span><span class="hljs-comment">;</span>    Afernoon = <span class="hljs-number">2</span><span class="hljs-comment">;</span>    Evening = <span class="hljs-number">3</span><span class="hljs-comment">;</span>&#125;</code></pre></div><p>ç”Ÿæˆæ—¶åŠ¡å¿…åŠ ä¸Š â€“go_out=paths=source_relativeï¼Œå…·ä½“è¯´æ˜å¯è§æ–‡æœ«è¯´æ˜ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh">protoc --proto_path=. --go_out=paths=source_relative:. -I=../common *.proto</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬ç¨å¾®å¼„å¤æ‚ä¸€ç‚¹ï¼Œhello.proto ä¾èµ– common.proto:</p><div class="code-wrapper"><pre><code class="hljs awk">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;  <span class="hljs-regexp">//</span>è¯­æ³•å£°æ˜import <span class="hljs-string">&quot;common.proto&quot;</span>; <span class="hljs-regexp">//</span> ä¾èµ–package hello; option go_package=<span class="hljs-string">&quot;github.com/13sai/go-learing/micro/hello/hello&quot;</span>;<span class="hljs-regexp">//</span> å®šä¹‰æœåŠ¡service Demo &#123;  rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;&#125;<span class="hljs-regexp">//</span> è¯·æ±‚æ•°æ®æ ¼å¼message HelloRequest &#123;  string name = <span class="hljs-number">1</span>;&#125;<span class="hljs-regexp">//</span> å“åº”æ•°æ®æ ¼å¼message HelloReply &#123;  common.TypeHello hello = <span class="hljs-number">2</span>;  string message = <span class="hljs-number">1</span>;&#125;</code></pre></div><p>æ³¨æ„è¿™é‡Œå¤šäº†ä¸ª micro_outï¼Œè¿™æ—¶éœ€è¦ protoc-gen-microçš„ï¼Œä¼šå¤šç”Ÿæˆä¸€ä¸ª.pb.micro.goæ–‡ä»¶ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh">protoc --proto_path=. --go_out=paths=source_relative:. --micro_out=paths=source_relative:. -I=../common *.proto</code></pre></div><p>æ–‡ä»¶ç”Ÿæˆäº†ï¼Œä½¿ç”¨go-microï¼ˆV2ï¼‰å†™ä¸€ä¸ªç®€å•çš„demoã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;log&quot;</span><span class="hljs-string">&quot;os&quot;</span><span class="hljs-string">&quot;os/signal&quot;</span><span class="hljs-string">&quot;syscall&quot;</span><span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;github.com/13sai/go-learing/micro/hello/common&quot;</span><span class="hljs-string">&quot;github.com/13sai/go-learing/micro/hello/hello&quot;</span><span class="hljs-string">&quot;github.com/micro/go-micro/v2&quot;</span>_ <span class="hljs-string">&quot;github.com/micro/go-plugins/registry/kubernetes/v2&quot;</span><span class="hljs-string">&quot;github.com/sirupsen/logrus&quot;</span>)<span class="hljs-keyword">const</span> (ServiceName = <span class="hljs-string">&quot;hello-server&quot;</span>)<span class="hljs-keyword">type</span> HelloServer <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *HelloServer)</span> <span class="hljs-title">SayHello</span><span class="hljs-params">(ctx context.Context, req *hello.HelloRequest, res *hello.HelloReply)</span> <span class="hljs-title">error</span></span> &#123;res.Message = <span class="hljs-string">&quot;hello &quot;</span> + req.Nameres.Hello = common.TypeHello_Afernoon<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;service := micro.NewService(<span class="hljs-comment">// Set service name</span>micro.Name(ServiceName),micro.AfterStart(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">&quot;starting...&quot;</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;),micro.Address(<span class="hljs-string">&quot;:8089&quot;</span>),)service.Init()hello.RegisterDemoHandler(service.Server(), &amp;HelloServer&#123;&#125;)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">if</span> err := service.Run(); err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;&#125;()stop := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal)signal.Notify(stop, syscall.SIGTERM, syscall.SIGINT, os.Interrupt)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;tick := time.NewTicker(<span class="hljs-number">3</span> * time.Second)<span class="hljs-keyword">for</span> &#123;<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-stop:tick.Stop()<span class="hljs-keyword">default</span>:&lt;-tick.Cclient()&#125;&#125;&#125;()<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-stop:logrus.Infof(<span class="hljs-string">&quot;got exit signal, shutdown&quot;</span>)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">client</span><span class="hljs-params">()</span></span> &#123;service := micro.NewService(micro.Name(ServiceName + <span class="hljs-string">&quot;client&quot;</span>))c := hello.NewDemoService(ServiceName, service.Client())<span class="hljs-comment">// å‘èµ·RPCè°ƒç”¨</span>rsp, err := c.SayHello(context.TODO(), &amp;hello.HelloRequest&#123;Name: <span class="hljs-string">&quot;13sai&quot;</span>&#125;)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(err)&#125;<span class="hljs-comment">// æ‰“å°è¿”å›å€¼</span>fmt.Println(rsp.Message)&#125;</code></pre></div><p><img src="/images/post/protorpc.png"><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡protocç”Ÿæˆçš„ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><h2 id="more"><a href="#more" class="headerlink" title="more"></a>more</h2><h4 id="paths"><a href="#paths" class="headerlink" title="paths"></a>paths</h4><p>ç”Ÿæˆçš„æ–‡ä»¶åœ¨è¾“å‡ºç›®å½•ä¸­çš„<code>.pb.go</code>ä½ç½®å–å†³äºâ€“go_out æ ‡è¯†ç¬¦ã€‚æœ‰ä»¥ä¸‹æ¨¡å¼ï¼š</p><ul><li>  <code>paths=import</code>: è¾“å‡ºæ–‡ä»¶å°†æ”¾ç½®åœ¨ä»¥ Go åŒ…çš„å¯¼å…¥è·¯å¾„å‘½åçš„ç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œ<code>protos/buzz.proto</code>Â å…·æœ‰ Go å¯¼å…¥è·¯å¾„çš„è¾“å…¥æ–‡ä»¶ä¼š<code>example.com/project/protos/fizz</code>Â å¯¼è‡´è¾“å‡ºæ–‡ä»¶ä½äº<code>example.com/project/protos/fizz/buzz.pb.go</code>.Â <code>paths</code></li><li>  <code>module=$PREFIX</code>: è¾“å‡ºæ–‡ä»¶å°†æ”¾ç½®åœ¨ä»¥ Go åŒ…çš„å¯¼å…¥è·¯å¾„å‘½åçš„ç›®å½•ä¸­ï¼Œä½†ä»è¾“å‡ºæ–‡ä»¶åä¸­åˆ é™¤æŒ‡å®šçš„ç›®å½•å‰ç¼€ã€‚ä¾‹å¦‚ï¼Œ<code>protos/buzz.proto</code>Â å…·æœ‰ Go å¯¼å…¥è·¯å¾„<code>example.com/project/protos/fizz</code>å¹¶Â <code>example.com/project</code>æŒ‡å®šä¸º<code>module</code>å‰ç¼€çš„è¾“å…¥æ–‡ä»¶ä¼šç”Ÿæˆä½äº<code>protos/fizz/buzz.pb.go</code>.Â åœ¨æ¨¡å—è·¯å¾„ä¹‹å¤–ç”Ÿæˆä»»ä½• Go åŒ…éƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚æ­¤æ¨¡å¼å¯¹äºå°†ç”Ÿæˆçš„æ–‡ä»¶ç›´æ¥è¾“å‡ºåˆ° Go æ¨¡å—å¾ˆæœ‰ç”¨ã€‚</li><li>  <code>paths=source_relative</code>: è¾“å‡ºæ–‡ä»¶ä¸è¾“å…¥æ–‡ä»¶æ”¾åœ¨ç›¸åŒçš„ç›¸å¯¹ç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥æ–‡ä»¶<code>protos/buzz.proto</code>Â å¯¼è‡´è¾“å‡ºæ–‡ä»¶ä½äº<code>protos/buzz.pb.go</code>.<br>é»˜è®¤æ˜¯ç¬¬ä¸€ç§ `paths=import</li></ul><hr><p>å…¶å®å†™æ–‡ç« çš„æ—¶å€™æˆ‘ä¹Ÿå°è¯•äº†ä¸‹ä½¿ç”¨Mï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">// è¿™é‡Œå†™æ³•æœ‰ç‚¹ç‰¹æ®Šå“¦ï¼Œæ³¨æ„ï¼Œå› ä¸ºæˆ‘æ˜¯åœ¨æ–‡ä»¶åŒä¸€ç›®å½•è¿è¡Œï¼Œæ‰€ä»¥ common.proto=../commonï¼Œè¿™æ ·ç”Ÿæˆçš„packageæ‰ä¼šæ˜¯commonï¼Œè‹¥æ˜¯ common.proto=./ç”Ÿæˆå°±æ˜¯ä¸‹åˆ’çº¿äº†protoc --proto_path=./ --micro_out=. --go_out=. --go_opt=Mcommon.proto=../common *.proto</code></pre></div><p>è™½ç„¶è¿™æ ·ä¹Ÿèƒ½ç”Ÿæˆï¼Œä½†ç”Ÿæˆä»£ç å¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼ˆimportéƒ¨åˆ†åªæ˜¯ä¸ªç›¸å¯¹è·¯å¾„ï¼Œæˆ–è®¸æ¢æˆç±»ä¼¼<code>example.com/project/protos/fizz</code>ä¹Ÿèƒ½ç”Ÿæˆï¼‰ã€‚å¦‚æœæ„Ÿå…´è¶£ï¼Œæˆ‘æ›´å»ºè®®å¯ä»¥é˜…è¯»å‚è€ƒæ–‡ç« ï¼Œè‡ªè‡ªå·±ï¼Œæˆ‘ç”¨é”™äº†ä¹Ÿæœªå°ä¸å¯èƒ½å‘¢ï¼Ÿ</p><p>å‚è€ƒ:</p><ul><li><a href="https://developers.google.com/protocol-buffers/docs/reference/go-generated#package">Go Generated Code</a></li><li><a href="https://www.sining.io/2022/01/15/how-to-use-a-shared-protobuf-schema-in-golang/">How to: use a shared protobuf schema (in golang)</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Protobuf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>influxdbæ•°æ®è¿ç§»</title>
    <link href="/2022/03/07/391/"/>
    <url>/2022/03/07/391/</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰å…¬å¸ç”¨çš„influxdbæ˜¯ç›´æ¥ä¹°çš„influxdbå®ä¾‹ï¼Œæœ€è¿‘å‚å•†äº§å“ä¸‹çº¿ï¼Œä¸å¾—ä¸è¿ç§»åˆ°è‡ªå·±çš„æœºå™¨ï¼Œä»¥ä¸‹æ˜¯è¿ç§»è¿‡ç¨‹ã€‚</p><p>è€ƒè™‘ç”Ÿäº§æœ‰ç°æˆçš„k8sé›†ç¾¤ï¼Œinfluxdbå®˜ç½‘æ–‡æ¡£ä¹Ÿæœ‰k8séƒ¨ç½²è¯´æ˜ï¼Œä¾¿ç›´æ¥å°†influxdbéƒ¨ç½²åˆ°k8sä¸­ã€‚ï¼ˆç‰ˆæœ¬1.8.x)</p><h3 id="éƒ¨ç½²æ–°çš„influxdb"><a href="#éƒ¨ç½²æ–°çš„influxdb" class="headerlink" title="éƒ¨ç½²æ–°çš„influxdb"></a>éƒ¨ç½²æ–°çš„influxdb</h3><p>éƒ¨ç½²çš„yamlæ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># å•ç‹¬å¼„ä¸ªns influxdb</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span><span class="hljs-attr">metadata:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span><span class="hljs-meta">---</span><span class="hljs-comment"># é…ç½®æ–‡ä»¶å¼„ä¸ªConfigMapï¼Œä¾¿äºä¿®æ”¹</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">data:</span>  <span class="hljs-attr">influxdb.conf:</span> <span class="hljs-string">&gt;-</span><span class="hljs-string">    [meta]</span><span class="hljs-string">      dir = &quot;/var/lib/influxdb/meta&quot;</span><span class="hljs-string"></span>    [<span class="hljs-string">coordinator</span>]      <span class="hljs-string">log-queries-after</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;60s&quot;</span>      <span class="hljs-string">max-select-series</span> <span class="hljs-string">=</span> <span class="hljs-number">10000</span>      <span class="hljs-string">write-timeout</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;30s&quot;</span>    [<span class="hljs-string">data</span>]      <span class="hljs-string">dir</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;/var/lib/influxdb/data&quot;</span>      <span class="hljs-string">engine</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;tsm1&quot;</span>      <span class="hljs-string">wal-dir</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;/var/lib/influxdb/wal&quot;</span>      <span class="hljs-string">cache-max-memory-size</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;0&quot;</span>      <span class="hljs-string">cache-snapshot-memory-size</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;256m&quot;</span>      <span class="hljs-string">index-version</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;tsi1&quot;</span>      <span class="hljs-string">max-index-log-file-size</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;64k&quot;</span>      <span class="hljs-string">max-series-per-database</span> <span class="hljs-string">=</span> <span class="hljs-number">3000000</span>      <span class="hljs-string">max-values-per-tag</span> <span class="hljs-string">=</span> <span class="hljs-number">100000</span><span class="hljs-meta">---</span><span class="hljs-comment">## æŒ‚ä¸ªPersistentVolumeClaim</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">PersistentVolumeClaim</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-data</span>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">accessModes:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteOnce</span>  <span class="hljs-attr">storageClassName:</span> <span class="hljs-string">csi-xxx</span> <span class="hljs-comment"># è‡ªè¡Œé…ç½®</span>  <span class="hljs-attr">resources:</span>    <span class="hljs-attr">requests:</span>      <span class="hljs-attr">storage:</span> <span class="hljs-string">8Gi</span> <span class="hljs-comment"># æŒ‰éœ€é…ç½®ï¼Œå­˜å‚¨æ•°æ®è¾ƒå¤šå¯é€‚å½“æ”¾å¤§</span><span class="hljs-meta">---</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span><span class="hljs-attr">metadata:</span>    <span class="hljs-attr">labels:</span>        <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">spec:</span>    <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>    <span class="hljs-attr">selector:</span>        <span class="hljs-attr">matchLabels:</span>            <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">serviceName:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">template:</span>        <span class="hljs-attr">metadata:</span>            <span class="hljs-attr">labels:</span>                <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>        <span class="hljs-attr">spec:</span>            <span class="hljs-attr">containers:</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">uhub.service.ucloud.cn/tv1234pub/influxdb:1.8.10</span>                <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>                <span class="hljs-attr">ports:</span>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8086</span>                    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>                <span class="hljs-attr">volumeMounts:</span>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/influxdb</span>                    <span class="hljs-attr">name:</span> <span class="hljs-string">data</span>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span>                    <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/influxdb/influxdb.conf</span>                    <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span>                    <span class="hljs-attr">subPath:</span> <span class="hljs-string">influxdb.conf</span>            <span class="hljs-attr">volumes:</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">data</span>                <span class="hljs-attr">persistentVolumeClaim:</span>                  <span class="hljs-attr">claimName:</span> <span class="hljs-string">influxdb-data</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">timezone-config</span>                <span class="hljs-attr">hostPath:</span>                  <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/share/zoneinfo/Asia/Shanghai</span>              <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span>                <span class="hljs-attr">configMap:</span>                  <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">0600</span>                  <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb-config</span><span class="hljs-meta">---</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">influxdb</span><span class="hljs-attr">spec:</span>    <span class="hljs-attr">ports:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">influxdb</span>        <span class="hljs-attr">port:</span> <span class="hljs-number">8086</span>        <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8086</span>    <span class="hljs-attr">selector:</span>        <span class="hljs-attr">app:</span> <span class="hljs-string">influxdb</span>    <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span></code></pre></div><h3 id="dump-å†å²æ•°æ®"><a href="#dump-å†å²æ•°æ®" class="headerlink" title="dump å†å²æ•°æ®"></a>dump å†å²æ•°æ®</h3><p>dump éœ€è¦å¼€å¯ 8088 ç«¯å£</p><div class="code-wrapper"><pre><code class="hljs sh">influxd backup -portable -host 172.16.xx.xxx:8088 sai-snapshot</code></pre></div><h3 id="æ¢å¤æ•°æ®"><a href="#æ¢å¤æ•°æ®" class="headerlink" title="æ¢å¤æ•°æ®"></a>æ¢å¤æ•°æ®</h3><p>ä¸Šä¼ </p><div class="code-wrapper"><pre><code class="hljs sh">kubectl cp -r sai-snapshot influxdb/influxdb-0:/root/</code></pre></div><div class="code-wrapper"><pre><code class="hljs sh">influxd restore -portable ./sai-snapshot</code></pre></div><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>influxå®¢æˆ·ç«¯æŸ¥éªŒæ•°æ®å³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>sql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>influxdb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vimå¿«æ·æ“ä½œåˆ é™¤,ç§»åŠ¨</title>
    <link href="/2022/02/24/390/"/>
    <url>/2022/02/24/390/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h2><ol><li>å‘½ä»¤æ¨¡å¼(è¿›å…¥å³æ­¤æ¨¡å¼)</li><li>è¾“å…¥æ¨¡å¼(è¾“å…¥iåˆ‡æ¢åˆ°æ­¤æ¨¡å¼)</li><li>åº•çº¿å‘½ä»¤æ¨¡å¼(ESCç„¶å:)</li></ol><h2 id="å¸¸ç”¨ï¼ˆä¸ç‰¹æ®Šè¯´æ˜éƒ½åœ¨å‘½ä»¤æ¨¡å¼ï¼Œå¸¦-çš„åº•çº¿å‘½ä»¤æ¨¡å¼ï¼‰"><a href="#å¸¸ç”¨ï¼ˆä¸ç‰¹æ®Šè¯´æ˜éƒ½åœ¨å‘½ä»¤æ¨¡å¼ï¼Œå¸¦-çš„åº•çº¿å‘½ä»¤æ¨¡å¼ï¼‰" class="headerlink" title="å¸¸ç”¨ï¼ˆä¸ç‰¹æ®Šè¯´æ˜éƒ½åœ¨å‘½ä»¤æ¨¡å¼ï¼Œå¸¦:çš„åº•çº¿å‘½ä»¤æ¨¡å¼ï¼‰"></a>å¸¸ç”¨ï¼ˆä¸ç‰¹æ®Šè¯´æ˜éƒ½åœ¨å‘½ä»¤æ¨¡å¼ï¼Œå¸¦:çš„åº•çº¿å‘½ä»¤æ¨¡å¼ï¼‰</h2><div class="code-wrapper"><pre><code class="hljs ruby">ç©ºæ ¼é”®  å‘å³ç§»åŠ¨ä¸€æ ¼x  åˆ é™¤åé¢çš„å­—ç¬¦,åˆ é™¤<span class="hljs-number">3</span>ä¸ªå­—ç¬¦å°±æ˜¯3x  X  åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦  dd  åˆ é™¤ä¸€è¡Œ   D  åˆ é™¤åˆ°è¡Œå°¾caw æ”¹å†™å•è¯  J  åˆ é™¤æ¢è¡Œç¬¦ï¼Œä½¿ä¸‹ä¸€è¡Œå¹¶ä¸Šæ¥,<span class="hljs-symbol">nJ:</span>è¿æ¥åé¢çš„nè¡Œu  æ’¤é”€ä¸Šä¸€æ¬¡æ“ä½œ      U  æ’¤é”€å½“å‰è¡Œçš„æ‰€æœ‰ä¿®æ”¹i  åœ¨å…‰æ ‡å‰æ’å…¥I  åœ¨è¡Œé¦–æ’å…¥ a  åœ¨å…‰æ ‡åæ’å…¥A  åœ¨è¡Œæœ«æ’å…¥o  åœ¨å½“å‰è¡Œçš„ä¸‹é¢å¦èµ·ä¸€è¡Œï¼Œå¹¶å˜ä¸ºæ’å…¥æ¨¡å¼O  åœ¨å½“å‰è¡Œä¸Šé¢å¦èµ·ä¸€è¡Œï¼Œå˜ä¸ºæ’å…¥æ¨¡å¼bã€3bã€wã€3w  å‘å‰\åç§»åŠ¨å‡ ä¸ªå•è¯ï¼Œæ ‡ç‚¹ä¹Ÿç®—ä¸€ä¸ªå•è¯ã€‚ç›¸åº”çš„å¤§å†™çŠ¶æ€ä¸ºä¸å«æ ‡ç‚¹ï¼Œå³åªæŠŠç©ºæ ¼å’Œæ¢è¡Œç¬¦ä½œä¸ºå•è¯é—´éš”ç¬¦ã€‚<span class="hljs-variable">$ </span> ç§»åŠ¨åˆ°è¡Œå°¾ï¼Œ<span class="hljs-number">3</span><span class="hljs-variable">$ç§»</span>åŠ¨åˆ°<span class="hljs-number">3</span>è¡Œåçš„è¡Œå°¾^  ç§»åŠ¨åˆ°è¡Œé¦–ï¼Œ<span class="hljs-number">0</span>ä¹Ÿæ˜¯+  ç§»åˆ°ä¸‹ä¸€è¡Œçš„è¡Œé¦–-  ç§»åˆ°ä¸Šä¸€è¡Œçš„è¡Œé¦–f  æœç´¢å‘½ä»¤ï¼Œå°å†™æ—¶å‘åæœç´¢ï¼ˆç”¨æ¥å®šä½ï¼‰å¦‚ fxï¼šå®šä½åˆ°ä¸‹ä¸€ä¸ªxä¸ŠFx  å®šä½åˆ°ä¸Šä¸€ä¸ªxä¸Šï¼Œé‡å¤æ—¶ï¼Œå¯ç”¨;æˆ–,  ä¸è¿‡ , è¡¨ç¤ºåæ–¹å‘% è·³åˆ°ç›¸å¯¹åº”çš„æ‹¬å·ä¸Šï¼Œç¼–ç¨‹æ—¶å¸¸ç”¨33G  è·³è½¬åˆ°<span class="hljs-number">33</span>è¡Œ   æ­¤æ—¶æŒ‰<span class="hljs-string">``</span>å¯ä»¥è¿”å›åˆ°åŸæ¥è¡Œgg æ–‡ä»¶å¤´   G  æ–‡ä»¶å°¾<span class="hljs-number">30</span>% è·³è½¬åˆ°æ–‡ä»¶çš„<span class="hljs-number">30</span>%å¤„Hä¸ºHomeMä¸ºMiddleLä¸ºLastå½“å‰å±å¹•çš„ä¸Šä¸­ä¸‹ä½ç½®ï¼Œå¤§å°å†™çš†å¯Ctrl+<span class="hljs-symbol">G:</span>æ˜¾ç¤ºå½“å‰ä½ç½®set <span class="hljs-symbol">number:</span>è®¾ç½®æ˜¾ç¤ºè¡Œå·ï¼Œset <span class="hljs-symbol">nonumber:</span>å…³é—­æ˜¾ç¤ºctrl+u\d  å‘ä¸Š\ä¸‹æ»šåŠ¨åŠå±ctrl+e\y  å‘ä¸Š\ä¸‹æ»šåŠ¨ä¸€è¡Œctrl+b\f  å‘ä¸Š\ä¸‹æ»šåŠ¨ä¸€å±ã€€ã€€è¿™ä¸ªæ¯”è¾ƒå®ç”¨ï¼Œè®°ä½ã€‚zz  å°†å½“å‰è¡Œæ»šåŠ¨äºå±å¹•ä¸­é—´ï¼Œæ–¹ä¾¿æŸ¥çœ‹ä¸Šä¸‹æ–‡  zt  ç½®é¡¶zb  ç½®å°¾/string  æŸ¥æ‰¾stringï¼Œå›è½¦åï¼ŒæŒ‰né”®å¯ä»¥è·³åˆ°ä¸‹ä¸€ä¸ªï¼ŒNä¸Šä¸€ä¸ªï¼Œå¦å¤–æŒ‰/é”®åï¼ŒæŒ‰ä¸Šä¸‹é”®å¯ä»¥æ‰¾åˆ°ä»¥å‰æŸ¥æ‰¾çš„è®°å½•ï¼ŒåŒæ ·çš„ ï¼šä¹Ÿæœ‰è®°å½•<span class="hljs-string">?/</span>string åŒä¸Šï¼Œé»˜è®¤å‘ä¸ŠæŸ¥æ‰¾% åŒ¹é…åˆ°ç›¸åº”æ‹¬å·å¤„<span class="hljs-meta">&gt;&gt;</span>   å‘å³ç§»åŠ¨æœ¬è¡Œä¸€æ®µè·ç¦»     &lt;&lt;   å‘å·¦ç§»åŠ¨æœ¬è¡Œä¸€æ®µè·ç¦»    <span class="hljs-number">3</span>&lt;&lt;    æŠŠä¸‹é¢<span class="hljs-number">3</span>è¡Œï¼ˆåŒ…æ‹¬æœ¬è¡Œï¼‰ï¼Œå‘å·¦ç§»åŠ¨ä¸€æ®µè·ç¦» <span class="hljs-symbol">:</span><span class="hljs-number">20</span>,<span class="hljs-number">30</span>&gt;&gt;  æŠŠ<span class="hljs-number">20</span>è¡Œåˆ°<span class="hljs-number">30</span>è¡Œå‘å³ç§»åŠ¨ä¸€æ®µè·ç¦»<span class="hljs-symbol">:set</span> ignorecase å¤§å°å†™æ— å…³<span class="hljs-symbol">:set</span> noignorecase å¤§å°å†™æ•æ„Ÿ*  æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå…‰æ ‡æ‰€åœ¨å•è¯  <span class="hljs-comment">#  æŸ¥æ‰¾ä¸Šä¸€ä¸ª</span><span class="hljs-symbol">:set</span> hlsearch  é«˜äº®æ˜¾ç¤ºæŸ¥æ‰¾ç»“æœ<span class="hljs-symbol">:set</span> nohlsearch  å–æ¶ˆé«˜äº®<span class="hljs-symbol">:nohlsearch</span>  å»æ‰å½“å‰æ˜¾ç¤ºçš„é«˜å®Œï¼ˆä¸€æ¬¡æ€§ï¼‰<span class="hljs-symbol">:set</span> paste æ ¼å¼åŒ–ç²˜è´´<span class="hljs-symbol">:set</span> ruler è®¾ç½®åœ¨çª—å£å³ä¸‹è§’æ˜¾ç¤ºè¡Œå·ï¼Œä¸ä¸Šé¢çš„å¥½å¤„æ˜¯ï¼ŒèŠ‚çœç©ºé—´<span class="hljs-symbol">:wq</span>  ä¿å­˜é€€å‡º<span class="hljs-symbol">:q!</span>  ä¸¢å¼ƒä¿®æ”¹é€€å‡º<span class="hljs-symbol">:q</span>  æ­£å¸¸é€€å‡º</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goæ€§èƒ½å·¥å…·pprof</title>
    <link href="/2022/01/29/385/"/>
    <url>/2022/01/29/385/</url>
    
    <content type="html"><![CDATA[<p>Go è¯­è¨€è‡ªå¸¦çš„ pprof åº“å°±å¯ä»¥åˆ†æç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œå¹¶ä¸”æä¾›å¯è§†åŒ–çš„åŠŸèƒ½ã€‚å®ƒåŒ…å«ä¸¤ä¸ªç›¸å…³çš„åº“ï¼š</p><ol><li><p>runtime/pprof<br>å¯¹äºåªè·‘ä¸€æ¬¡çš„ç¨‹åºï¼Œä¾‹å¦‚æ¯å¤©åªè·‘ä¸€æ¬¡çš„ç¦»çº¿é¢„å¤„ç†ç¨‹åºï¼Œè°ƒç”¨ pprof åŒ…æä¾›çš„å‡½æ•°ï¼Œæ‰‹åŠ¨å¼€å¯æ€§èƒ½æ•°æ®é‡‡é›†ã€‚</p></li><li><p>net/http/pprof<br>å¯¹äºåœ¨çº¿æœåŠ¡ï¼Œå¯¹äºä¸€ä¸ª HTTP Serverï¼Œè®¿é—® pprof æä¾›çš„ HTTP æ¥å£ï¼Œè·å¾—æ€§èƒ½æ•°æ®ã€‚å½“ç„¶ï¼Œå®é™…ä¸Šè¿™é‡Œåº•å±‚ä¹Ÿæ˜¯è°ƒç”¨çš„ runtime/pprof æä¾›çš„å‡½æ•°ï¼Œå°è£…æˆæ¥å£å¯¹å¤–æä¾›ç½‘ç»œè®¿é—®ã€‚</p></li></ol><p>å› ä¸ºè‡ªå·±ç”¨ginæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ä½¿ç”¨github.com/gin-contrib/pprofï¼Œå…¶å®å†…éƒ¨ä¹Ÿå°±æ˜¯ä¸Šé¢ä¸¤ä¸ªåº“ã€‚ä½¿ç”¨éå¸¸ç®€å•ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> debugHttp *http.Server<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">runPPROF</span><span class="hljs-params">()</span></span> &#123;g := gin.New()g.Use(gin.Recovery())g.Use(gin.Logger())pprof.Register(g)    <span class="hljs-comment">// ä½¿ç”¨9000ç«¯å£å¼€å¯httpæœåŠ¡</span>debugHttp = &amp;http.Server&#123;Addr:    <span class="hljs-string">&quot;:9000&quot;</span>,Handler: g,&#125;debugHttp.ListenAndServe()&#125;</code></pre></div><p>å¼€å¯ä¹‹åå¯ä»¥webè®¿é—® <a href="http://127.0.0.1:9000/debug/pprof/%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%EF%BC%8C">http://127.0.0.1:9000/debug/pprof/å¯ä»¥æŸ¥çœ‹å®æ—¶æ•°æ®ï¼Œ</a><br><img src="/images/pprof/pprof.png" alt="pprof"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„æ€§èƒ½æƒ…å†µï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">// ç›‘å¬60sæ€§èƒ½æƒ…å†µï¼Œé»˜è®¤è¿›å…¥å‘½ä»¤è¡Œgo tool pprof http://127.0.0.1:9000/debug/pprof/profile\?seconds\=60</code></pre></div><p><img src="/images/pprof/pprof2.png" alt="pprof"></p><div class="code-wrapper"><pre><code class="hljs sh">// æœ¬åœ°å¯åŠ¨httpæœåŠ¡æŸ¥çœ‹ï¼Œéœ€è¦è£…graphvizæ’ä»¶go tool pprof -http=:8080  ~/pprof/pprof.go.samples.cpu.032.pb.gz</code></pre></div><p><img src="/images/pprof/pprof3.png" alt="pprof"></p><p>å¯ä»¥åˆ‡æ¢çœ‹å ç”¨æœ€é«˜çš„ï¼Œè¿˜æœ‰ç«ç„°å›¾ç­‰ç­‰ï¼Œç›¸å½“å¥½ç”¨ï¼Œä¸€èˆ¬æ€§èƒ½ç“¶é¢ˆå°±åœ¨å ç”¨æ¯”è¾ƒå¤šçš„ã€‚</p><p>PS: æœ‰æ—¶å€™çº¿ä¸Šå¯èƒ½æ²¡æœ‰å¼€å¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨perfå»debugæŸ¥çœ‹å ç”¨èµ„æºæ¯”è¾ƒå¤šçš„ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh">// 19323 ç«¯å£å·perf record -p 19323perf report</code></pre></div><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/qcrao-2018/p/11832732.html">æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹ pprof</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>supervisord</title>
    <link href="/2022/01/29/384/"/>
    <url>/2022/01/29/384/</url>
    
    <content type="html"><![CDATA[<p>ç›¸ä¿¡å¤§å¤šæ•°äººéƒ½ç”¨è¿‡ python ç‰ˆæœ¬çš„ supervisor ï¼Œé‚£ä¹ˆä½ çŸ¥é“ go ç‰ˆæœ¬çš„ supervisor å—ï¼Ÿ</p><h2 id="ochinchina-supervisord"><a href="#ochinchina-supervisord" class="headerlink" title="ochinchina/supervisord"></a>ochinchina/supervisord</h2><p><a href="https://github.com/ochinchina/supervisord">ochinchina/supervisordæºç </a></p><p><a href="https://github.com/ochinchina/supervisord/releases">ä¸‹è½½åœ°å€</a></p><p>æºç å®‰è£…ï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ochinchina/</span>supervisord.git<span class="hljs-regexp">//</span> åˆ‡æ¢åˆ°éœ€è¦çš„ç‰ˆæœ¬åˆ†æ”¯git checkout v0.<span class="hljs-number">7.3</span> <span class="hljs-regexp">//</span> linux ç¼–è¯‘å®‰è£…<span class="hljs-regexp">//</span> <span class="hljs-number">64</span>ä½ç‰ˆæœ¬env GOOS=linux GOARCH=amd64 go build -o supervisord_linux_amd64</code></pre></div><p>é…ç½®æ–‡ä»¶demo</p><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> å†…ç½‘åœ°å€[inet_http_server]port = :<span class="hljs-number">9001</span><span class="hljs-regexp">//</span> UIåœ°å€[supervisorctl]serverurl=http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9001</span><span class="hljs-regexp">//</span> è¿›ç¨‹é…ç½®[program:hello]directory = Work<span class="hljs-regexp">/golang/</span>command =stdout_logfile = stderr_logfile = autostart = trueuser=<span class="hljs-regexp">//</span> depends_on=B, C</code></pre></div><p>å¯åŠ¨å‘½ä»¤</p><blockquote><p>supervisord -c supervisor.conf -d</p></blockquote><p>ctl å‘½ä»¤</p><div class="code-wrapper"><pre><code class="hljs fortran">// ä¸æ˜¯<span class="hljs-number">9001</span>ç«¯å£ï¼ŒåŠ¡å¿…æŒ‡å®š-så‚æ•°supervisord ctl -s=http://localhost:<span class="hljs-number">9010</span> <span class="hljs-keyword">status</span>supervisord ctl -s=http://localhost:<span class="hljs-number">9010</span> <span class="hljs-keyword">status</span> <span class="hljs-function"><span class="hljs-keyword">program</span></span>-<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">program</span></span>-<span class="hljs-number">2.</span>..supervisord ctl -s=http://localhost:<span class="hljs-number">9010</span> <span class="hljs-keyword">status</span> group:*supervisord ctl <span class="hljs-keyword">stop</span> <span class="hljs-function"><span class="hljs-keyword">program</span></span>-<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">program</span></span>-<span class="hljs-number">2.</span>..supervisord ctl <span class="hljs-keyword">stop</span> group:*supervisord ctl <span class="hljs-keyword">stop</span> <span class="hljs-built_in">all</span>supervisord ctl -s=http://localhost:<span class="hljs-number">9010</span> start <span class="hljs-function"><span class="hljs-keyword">program</span></span>-<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">program</span></span>-<span class="hljs-number">2.</span>..supervisord ctl start group:*supervisord ctl start <span class="hljs-built_in">all</span>supervisord ctl shutdownsupervisord ctl reloadsupervisord ctl signal &lt;signal_name&gt; &lt;process_name&gt; &lt;process_name&gt; ...supervisord ctl signal <span class="hljs-built_in">all</span>supervisord ctl pid &lt;process_name&gt;supervisord ctl fg &lt;process_name&gt;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>supervisord</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goå®ç°LRU</title>
    <link href="/2022/01/16/383/"/>
    <url>/2022/01/16/383/</url>
    
    <content type="html"><![CDATA[<p>å‰ä¸€æ®µæ—¶é—´é‡æ„èŠå¤©æœåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦å®šæœŸå»æ£€æµ‹Cç«¯é•¿è¿æ¥çš„æ´»è·ƒæƒ…å†µï¼Œå½“æ£€æµ‹åˆ°é•¿é“¾æ¥å¤±å»å¿ƒè·³60såï¼Œä¸»åŠ¨é‡Šæ”¾æ‰ä»¥èŠ‚çœå†…å­˜å¼€é”€ã€‚éœ€è¦æ£€æµ‹æ‰€æœ‰çš„é•¿è¿æ¥æ˜¾ç„¶æ˜¯ä¸å¤ªæ˜æ™ºçš„åšæ³•ï¼Œå› è€Œæƒ³åˆ°äº†ä½¿ç”¨LRUç®—æ³•ï¼Œä»æœ€ä¸æ´»è·ƒçš„è¿æ¥æ£€æµ‹ï¼Œå½“æ£€æµ‹åˆ°æŸä¸ªè¿æ¥çš„æ´»è·ƒæ—¶é—´å¤§äºæœ€è¿‘ä¸€åˆ†é’Ÿï¼Œåç»­çš„è¿æ¥å°±æ— éœ€æ£€æµ‹äº†ã€‚</p><p>LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•æ˜¯ä¸€ç§å¸¸ç”¨çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜â€ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> lru<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;container/list&quot;</span>)<span class="hljs-keyword">type</span> Link <span class="hljs-keyword">struct</span> &#123;ID         <span class="hljs-keyword">int</span>ActiveTime <span class="hljs-keyword">int</span>&#125;<span class="hljs-keyword">type</span> Lru <span class="hljs-keyword">struct</span> &#123;maxSize <span class="hljs-keyword">int</span> <span class="hljs-comment">// æœ€å¤§å®¹é‡</span>list    *list.List <span class="hljs-comment">// é“¾è¡¨</span>cache   <span class="hljs-keyword">map</span>[*Link]*list.Element <span class="hljs-comment">// map</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newLru</span><span class="hljs-params">(max <span class="hljs-keyword">int</span>)</span> *<span class="hljs-title">Lru</span></span> &#123;<span class="hljs-keyword">return</span> &amp;Lru&#123;maxSize: max,cache:   <span class="hljs-keyword">map</span>[*Link]*list.Element&#123;&#125;,list:    list.New(),&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *Lru)</span> <span class="hljs-title">Push</span><span class="hljs-params">(key *Link)</span></span> &#123;    <span class="hljs-comment">// å·²å­˜åœ¨ï¼Œè°ƒæ•´é“¾è¡¨é¡ºåº</span><span class="hljs-keyword">if</span> e, ok := l.cache[key]; ok &#123;l.list.MoveToFront(e)&#125; <span class="hljs-keyword">else</span> &#123;row := l.list.PushFront(key)l.cache[key] = row&#125;    <span class="hljs-comment">// æˆ‘è¿™é‡Œæ— éœ€æ£€æµ‹é•¿åº¦</span><span class="hljs-keyword">for</span> l.maxSize &gt; <span class="hljs-number">0</span> &amp;&amp; l.list.Len() &gt; l.maxSize &#123;l.removePassive()&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *Lru)</span> <span class="hljs-title">CheckPassive</span><span class="hljs-params">()</span> <span class="hljs-params">(*Link, <span class="hljs-keyword">bool</span>)</span></span> &#123;e := l.list.Back()<span class="hljs-keyword">if</span> e == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>&#125;link := e.Value.(*Link)<span class="hljs-keyword">return</span> link, <span class="hljs-literal">true</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *Lru)</span> <span class="hljs-title">Remove</span><span class="hljs-params">(key *Link)</span></span> &#123;<span class="hljs-keyword">if</span> e, ok := l.cache[key]; ok &#123;l.list.Remove(e)<span class="hljs-built_in">delete</span>(l.cache, key)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *Lru)</span> <span class="hljs-title">Len</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;<span class="hljs-keyword">return</span> l.list.Len()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *Lru)</span> <span class="hljs-title">removePassive</span><span class="hljs-params">()</span></span> &#123;e := l.list.Back()l.list.Remove(e)<span class="hljs-built_in">delete</span>(l.cache, e.Value.(*Link))&#125;</code></pre></div><p>æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> lru<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;testing&quot;</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestLRU</span><span class="hljs-params">(t *testing.T)</span></span> &#123;lru := newLru(<span class="hljs-number">10</span>)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++ &#123;link1 := &amp;Link&#123;i, i + <span class="hljs-number">1642262400</span>&#125;lru.Push(link1)&#125;old, _ := lru.CheckPassive()t.Logf(<span class="hljs-string">&quot;CheckPassive:%+v&quot;</span>, old)t.Log(<span class="hljs-string">&quot;len=&quot;</span>, lru.Len())<span class="hljs-keyword">for</span> <span class="hljs-literal">true</span> &#123;item, ok := lru.CheckPassive()<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">break</span>&#125;t.Logf(<span class="hljs-string">&quot;Remove:%+v&quot;</span>, item)lru.Remove(item)&#125;old, _ = lru.CheckPassive()t.Logf(<span class="hljs-string">&quot;CheckPassive:%+v&quot;</span>, old)t.Log(<span class="hljs-string">&quot;len=&quot;</span>, lru.Len())&#125;</code></pre></div><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¾“å‡ºï¼š<br><img src="/images/post/lru.png" alt="LRU"></p><p>çœ‹æ•ˆæœæ˜¯okçš„ã€‚åˆ«ç€æ€¥åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œè®°å¾—å‹æµ‹å¯¹æ¯”ä¸‹å†å®æ–½å“¦ï¼</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/Jun10ng/p/12562818.html">golang å®ç° LRU</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goæœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel</title>
    <link href="/2022/01/11/382/"/>
    <url>/2022/01/11/382/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“é€šé“ï¼ˆchannelï¼‰åˆ†ä¸¤ç§ï¼š</p><ol><li>ç¼“å†²é€šé“</li><li>éç¼“å†²é€šé“<div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// ç¼“å†²é€šé“</span>ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">10</span>)ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>, <span class="hljs-number">2</span>)<span class="hljs-comment">// éç¼“å†²é€šé“</span>ch3 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)ch4 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>, <span class="hljs-number">0</span>)</code></pre></div></li></ol><h3 id="å‘é€é€šé“æ•°æ®"><a href="#å‘é€é€šé“æ•°æ®" class="headerlink" title="å‘é€é€šé“æ•°æ®"></a>å‘é€é€šé“æ•°æ®</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç©ºæ¥å£é€šé“ï¼Œæ³¨æ„å®šä¹‰çš„é€šé“ç±»å‹æœ‰</span>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125;)<span class="hljs-comment">// å°†0æ”¾å…¥é€šé“ä¸­</span>ch &lt;- <span class="hljs-number">0</span><span class="hljs-comment">// å°†helloå­—ç¬¦ä¸²æ”¾å…¥é€šé“ä¸­</span>ch &lt;- <span class="hljs-string">&quot;hello&quot;</span></code></pre></div><h3 id="æ¥æ”¶é€šé“æ•°æ®"><a href="#æ¥æ”¶é€šé“æ•°æ®" class="headerlink" title="æ¥æ”¶é€šé“æ•°æ®"></a>æ¥æ”¶é€šé“æ•°æ®</h3><ol><li><p>é˜»å¡æ¥æ”¶æ•°æ®</p><div class="code-wrapper"><pre><code class="hljs go">data := &lt;-ch</code></pre></div><p>æ‰§è¡Œè¯¥è¯­å¥æ—¶å°†ä¼šé˜»å¡ï¼Œç›´åˆ°æ¥æ”¶åˆ°æ•°æ®å¹¶èµ‹å€¼ç»™ data å˜é‡ã€‚</p></li><li><p>éé˜»å¡æ¥æ”¶æ•°æ®</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// dataï¼šè¡¨ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®ã€‚æœªæ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œdata ä¸ºé€šé“ç±»å‹çš„é›¶å€¼</span><span class="hljs-comment">// okï¼šè¡¨ç¤ºæ˜¯å¦æ¥æ”¶åˆ°æ•°æ®ã€‚</span>data, ok := &lt;-ch</code></pre></div><p>éé˜»å¡çš„é€šé“æ¥æ”¶æ–¹æ³•å¯èƒ½é€ æˆé«˜çš„ CPU å ç”¨ï¼Œå› æ­¤ä½¿ç”¨éå¸¸å°‘ã€‚å¦‚æœéœ€è¦å®ç°æ¥æ”¶è¶…æ—¶æ£€æµ‹ï¼Œå¯ä»¥é…åˆ select å’Œè®¡æ—¶å™¨ channel è¿›è¡Œï¼Œå¯ä»¥å‚è§åé¢çš„å†…å®¹ã€‚</p></li><li><p>æ¥æ”¶ä»»æ„æ•°æ®ï¼Œå¿½ç•¥æ¥æ”¶çš„æ•°æ®</p><div class="code-wrapper"><pre><code class="hljs go">&lt;-ch</code></pre></div></li><li><p>å¾ªç¯æ¥æ”¶</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;fmt&quot;</span>    <span class="hljs-string">&quot;time&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)    <span class="hljs-comment">// å¼€å¯ä¸€ä¸ªå¹¶å‘åŒ¿åå‡½æ•°</span>    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;        <span class="hljs-keyword">for</span> i := <span class="hljs-number">3</span>; i &gt;= <span class="hljs-number">0</span>; i-- &#123;            ch &lt;- i            time.Sleep(time.Second)        &#125;    &#125;()    <span class="hljs-comment">// éå†æ¥æ”¶é€šé“æ•°æ®</span>    <span class="hljs-keyword">for</span> data := <span class="hljs-keyword">range</span> ch &#123;        fmt.Println(data)        <span class="hljs-keyword">if</span> data == <span class="hljs-number">0</span> &#123;            <span class="hljs-keyword">break</span>        &#125;    &#125;&#125;</code></pre></div></li></ol><h3 id="å…³é—­é€šé“"><a href="#å…³é—­é€šé“" class="headerlink" title="å…³é—­é€šé“"></a>å…³é—­é€šé“</h3><div class="code-wrapper"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)...<span class="hljs-built_in">close</span>(ch)</code></pre></div><p>é€šé“ç‰¹æ€§:</p><ol><li>åŒä¸€ä¸ªé€šé“ï¼Œå‘é€æ“ä½œä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œæ¥æ”¶æ“ä½œä¹‹é—´ä¹Ÿæ˜¯äº’æ–¥çš„ï¼ˆå¹¶å‘å®‰å…¨ï¼‰</li><li>å‘é€æ“ä½œå’Œæ¥æ”¶æ“ä½œä¸­å¯¹å…ƒç´ å€¼çš„å¤„ç†éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„ã€‚</li><li>å‘é€æ“ä½œåœ¨å®Œå…¨å®Œæˆä¹‹å‰ä¼šè¢«é˜»å¡ï¼Œæ¥æ”¶æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ã€‚</li><li>å¯¹äºç¼“å†²é€šé“ï¼šå¦‚æœé€šé“å·²æ»¡ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰å‘é€æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰å…ƒç´ å€¼è¢«æ¥æ”¶èµ°ï¼›å¦‚æœé€šé“å·²ç©ºï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰æ¥æ”¶æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰æ–°çš„å…ƒç´ å€¼å‡ºç°ã€‚<br>å¯¹äºéç¼“å†²é€šé“ï¼šæ— è®ºæ˜¯å‘é€æ“ä½œè¿˜æ˜¯æ¥æ”¶æ“ä½œï¼Œä¸€å¼€å§‹æ‰§è¡Œå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é…å¯¹çš„æ“ä½œä¹Ÿå¼€å§‹æ‰§è¡Œï¼Œæ‰ä¼šç»§ç»­ä¼ é€’ã€‚</li></ol><h3 id="æ³¨æ„ç‚¹ï¼š"><a href="#æ³¨æ„ç‚¹ï¼š" class="headerlink" title="æ³¨æ„ç‚¹ï¼š"></a>æ³¨æ„ç‚¹ï¼š</h3><p>å…³é—­é€šé“è¦åœ¨å‘é€æ–¹å…³é—­ï¼Œå…³é—­åå¦‚æœchannelå†…è¿˜æœ‰å…ƒç´ ï¼Œå¹¶ä¸ä¼šå¯¹æ¥ä¸‹æ¥çš„æ¥æ”¶äº§ç”Ÿå½±å“<br>å•å‘é€šé“æœ€ä¸»è¦çš„ç”¨é€”å°±æ˜¯çº¦æŸå…¶ä»–ä»£ç çš„è¡Œä¸º<br>é€šè¿‡å‡½æ•°çš„å‚æ•°ç±»å‹æˆ–è€…è¿”å›å€¼ç±»å‹æ¥é™åˆ¶ï¼ˆGoçš„è¯­æ³•ç³–ï¼‰ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ch <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span>)</span> //ä¼ å…¥åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°é‡Œé¢è°ƒç”¨<span class="hljs-title">ch</span>åªèƒ½å‘é€</span><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-params">(ch &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span> //è¿”å›åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°å¤–é¢é‡Œé¢è°ƒç”¨<span class="hljs-title">ch</span>åªèƒ½æ¥æ”¶</span></code></pre></div><p>é‚£ä¹ˆéç¼“å†²é€šé“æ˜¯ä¸æ˜¯å°±æ˜¯ç¼“å†²sizeä¸º1çš„ç¼“å†²é€šé“å‘¢ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestChan</span><span class="hljs-params">(t *testing.T)</span></span> &#123;ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)ch &lt;- <span class="hljs-number">1</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;&lt;-ch&#125;()ch &lt;- <span class="hljs-number">2</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestChan2</span><span class="hljs-params">(t *testing.T)</span></span> &#123;ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">1</span>)ch &lt;- <span class="hljs-number">1</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;&lt;-ch&#125;()ch &lt;- <span class="hljs-number">2</span>&#125;</code></pre></div><p>go test è¿è¡Œä¸€ä¸‹ï¼Œä¼šå‘ç°TestChané˜»å¡ä½äº†ï¼Œch &lt;- 1 ä¸èƒ½å†™åœ¨go func å‰é¢ï¼Œé‚£ä¹ˆéç¼“å†²é€šé“æ˜¾ç„¶ä¸æ˜¯å°±æ˜¯ç¼“å†²sizeä¸º1çš„ç¼“å†²é€šé“ã€‚éç¼“å†²é€šé“åƒæ˜¯ä»¥å‰çš„å¿«é€’å‘˜ï¼Œå¿…é¡»æœ‰æ”¶è´§äººå½“é¢æ¥æ”¶æˆåŠŸï¼Œå¦åˆ™ä»–ä¼šç­‰ç€ä½ é€è´§ï¼Œæœ‰ç¼“å†²é€šé“æ›´åƒæ˜¯ç°åœ¨çš„å¿«é€’å‘˜ï¼Œç›´æ¥æ”¾åœ¨é©¿ç«™æˆ–è€…å¿«é€’æŸœï¼Œé™¤éé©¿ç«™å¿«é€’æŸœæ»¡äº†ï¼Œå¦åˆ™ä»–å°±èƒ¡å¡ï¼Œä¸ç®¡ä½ åœ¨ä¸åœ¨å®¶ï¼Œæœ‰æ²¡æœ‰æ¥æ”¶æˆåŠŸã€‚</p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubebuilderå®æˆ˜ä¹‹äºŒ</title>
    <link href="/2021/11/30/382/"/>
    <url>/2021/11/30/382/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–°å»ºé¡¹ç›®"><a href="#æ–°å»ºé¡¹ç›®" class="headerlink" title="æ–°å»ºé¡¹ç›®"></a>æ–°å»ºé¡¹ç›®</h2><blockquote><p>go mod init elastic-web</p><p>kubebuilder init â€“domain com.13sai</p></blockquote><div class="code-wrapper"><pre><code class="hljs sh">kubebuilder create api --group sai --version v1 --kind ElasticWeb</code></pre></div><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">/*</span><span class="hljs-comment">Copyright 2021.</span><span class="hljs-comment"></span><span class="hljs-comment">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><span class="hljs-comment">you may not use this file except in compliance with the License.</span><span class="hljs-comment">You may obtain a copy of the License at</span><span class="hljs-comment"></span><span class="hljs-comment">    http://www.apache.org/licenses/LICENSE-2.0</span><span class="hljs-comment"></span><span class="hljs-comment">Unless required by applicable law or agreed to in writing, software</span><span class="hljs-comment">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><span class="hljs-comment">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span class="hljs-comment">See the License for the specific language governing permissions and</span><span class="hljs-comment">limitations under the License.</span><span class="hljs-comment">*/</span><span class="hljs-keyword">package</span> v1<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;github.com/spf13/cast&quot;</span>metav1 <span class="hljs-string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>)<span class="hljs-keyword">type</span> ElasticWebSpec <span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">// é•œåƒ</span>Image     <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;image&quot;`</span><span class="hljs-comment">// ç«¯å£</span>Port      *<span class="hljs-keyword">int</span>   <span class="hljs-string">`json:&quot;port&quot;`</span><span class="hljs-comment">// å•ä¸ª pod çš„ qps</span>SingleQPS *<span class="hljs-keyword">int</span>   <span class="hljs-string">`json:&quot;singleQPS&quot;`</span><span class="hljs-comment">// æ€» qps</span>TotalQPS  *<span class="hljs-keyword">int</span>   <span class="hljs-string">`json:&quot;totalQPS&quot;`</span>&#125;<span class="hljs-comment">// ElasticWebStatus defines the observed state of ElasticWeb</span><span class="hljs-keyword">type</span> ElasticWebStatus <span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">// å®é™… qps</span>RealQPS *<span class="hljs-keyword">int</span> <span class="hljs-string">`json:&quot;realQPS&quot;`</span>&#125;<span class="hljs-keyword">type</span> ElasticWeb <span class="hljs-keyword">struct</span> &#123;metav1.TypeMeta   <span class="hljs-string">`json:&quot;,inline&quot;`</span>metav1.ObjectMeta <span class="hljs-string">`json:&quot;metadata,omitempty&quot;`</span>Spec   ElasticWebSpec   <span class="hljs-string">`json:&quot;spec,omitempty&quot;`</span>Status ElasticWebStatus <span class="hljs-string">`json:&quot;status,omitempty&quot;`</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(web *ElasticWeb)</span> <span class="hljs-title">String</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;realQPS := <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">if</span> web.Status.RealQPS == <span class="hljs-literal">nil</span> &#123;realQPS = <span class="hljs-string">&quot;nil&quot;</span>&#125; <span class="hljs-keyword">else</span> &#123;realQPS = cast.ToString(*web.Status.RealQPS)&#125;<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;Image [%s], Port [%d], SingleQPS [%d], TotalQPS [%d], RealQPS [%s]&quot;</span>, web.Spec.Image, *web.Spec.Port, *web.Spec.SingleQPS, *web.Spec.TotalQPS, realQPS)&#125;<span class="hljs-comment">// ElasticWebList contains a list of ElasticWeb</span><span class="hljs-keyword">type</span> ElasticWebList <span class="hljs-keyword">struct</span> &#123;metav1.TypeMeta <span class="hljs-string">`json:&quot;,inline&quot;`</span>metav1.ListMeta <span class="hljs-string">`json:&quot;metadata,omitempty&quot;`</span>Items           []ElasticWeb <span class="hljs-string">`json:&quot;items&quot;`</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;SchemeBuilder.Register(&amp;ElasticWeb&#123;&#125;, &amp;ElasticWebList&#123;&#125;)&#125;</code></pre></div><p>è®¾ç½®RBACæƒé™ï¼š</p><p>elasticweb_controller.go:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">//+kubebuilder:rbac:groups=k8s.com.13sai,resources=elasticwebs,verbs=get;list;watch;create;update;patch;delete</span><span class="hljs-comment">//+kubebuilder:rbac:groups=k8s.com.13sai,resources=elasticwebs/status,verbs=get;update;patch</span><span class="hljs-comment">//+kubebuilder:rbac:groups=k8s.com.13sai,resources=elasticwebs/finalizers,verbs=update</span><span class="hljs-comment">// RBAC æ–°å¢</span><span class="hljs-comment">//+kubebuilder:rbac:groups=apps,resources=deployments,verbs=get;list;watch;create;update;patch;delete</span><span class="hljs-comment">//+kubebuilder:rbac:groups=core,resources=services,verbs=get;list;watch;create;update;patch;delete</span></code></pre></div><p>ä»£ç æ¯”è¾ƒæ¯ç‡¥ï¼Œ<br>ä¸»è¦æ–¹æ³•éƒ½åœ¨controllerï¼Œ</p><ul><li>getExpectReplicas</li><li>createServiceIfNotExists</li><li>createDeployment</li><li>Reconcile(é»˜è®¤)</li></ul><p>å¯å‚è€ƒï¼š<a href="https://github.com/13sai/kubebuilder-demo/tree/master/elasticWeb">https://github.com/13sai/kubebuilder-demo/tree/master/elasticWeb</a></p><p>ç¼–ç å®Œæˆåï¼š</p><blockquote><p>make install</p><p>kubectl api-versions|grep â€œk8s.comâ€</p></blockquote><p><img src="/images/Kubebuilder2.png" alt="Kubebuilder2"></p><p>æœ€åå¯ä»¥æ‰§è¡Œ</p><blockquote><p>make run </p></blockquote><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai-test</span>  <span class="hljs-attr">labels:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">test</span><span class="hljs-meta">---</span><span class="hljs-meta"></span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">k8s.com.13sai/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">ElasticWeb</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">sai-test</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">elasticweb-sample</span><span class="hljs-attr">spec:</span>  <span class="hljs-comment"># Add fields here</span>  <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.20.2-alpine</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>  <span class="hljs-attr">singleQPS:</span> <span class="hljs-number">1000</span>  <span class="hljs-attr">totalQPS:</span> <span class="hljs-number">8800</span></code></pre></div><blockquote><p>kubectl apply -f config/samples/k8s_v1_elasticweb.yaml</p></blockquote><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://juejin.cn/post/6983824024249827358">kubebuilderå®æˆ˜ä¹‹äº”ï¼šoperatorç¼–ç </a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kubebuilderå®æˆ˜ä¹‹ä¸€</title>
    <link href="/2021/11/21/381/"/>
    <url>/2021/11/21/381/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å‡†å¤‡ï¼šdockerã€kubectlã€golang</p><h4 id="å®‰è£…-kustomize"><a href="#å®‰è£…-kustomize" class="headerlink" title="å®‰è£… kustomize"></a>å®‰è£… kustomize</h4><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>/binGOBIN=$(<span class="hljs-built_in">pwd</span>)/ GO111MODULE=on go get sigs.k8s.io/kustomize/kustomize/v3</code></pre></div><h4 id="å®‰è£…-kubebuilder"><a href="#å®‰è£…-kubebuilder" class="headerlink" title="å®‰è£… kubebuilder"></a>å®‰è£… kubebuilder</h4><p>æ ¹æ®ä½ ç”µè„‘çš„ GOOS å’Œ GOARCH å»<a href="https://github.com/kubernetes-sigs/kubebuilder/releases/download/v3.2.0/kubebuilder_darwin_amd64">ä¸‹è½½</a> å¯¹åº”çš„ç‰ˆæœ¬ï¼Œç„¶åæŠŠæ–‡ä»¶æŒªåˆ° <code>/usr/local/bin/kubebuilder</code>ï¼Œæ‰§è¡Œ</p><div class="code-wrapper"><pre><code class="hljs sh">kubebuilder version</code></pre></div><div class="code-wrapper"><pre><code class="hljs sh">mkdir -p <span class="hljs-variable">$GOPATH</span>/src/sai<span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>/src/sai<span class="hljs-comment"># åŠ¡å¿…åœ¨gopathç›®å½•æ‰§è¡Œï¼Œå¦åˆ™æŠ¥é”™</span>kubebuilder init --domain com.sai<span class="hljs-comment"># å¯æœ‰å¯æ— çš„ä¸€æ­¥</span>go mod tidy<span class="hljs-comment"># make</span>make</code></pre></div><div class="code-wrapper"><pre><code class="hljs stylus">âœ  sai tree         â”œâ”€â”€ Dockerfileâ”œâ”€â”€ Makefileâ”œâ”€â”€ PROJECTâ”œâ”€â”€ binâ”‚Â Â  â”œâ”€â”€ controller-genâ”‚Â Â  â””â”€â”€ managerâ”œâ”€â”€ configâ”‚Â Â  â”œâ”€â”€ defaultâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ manager_auth_proxy_patch<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager_config_patch<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”œâ”€â”€ managerâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ controller_manager_config<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”œâ”€â”€ prometheusâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ monitor<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â””â”€â”€ rbacâ”‚Â Â      â”œâ”€â”€ auth_proxy_client_clusterrole<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â”œâ”€â”€ auth_proxy_role<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â”œâ”€â”€ auth_proxy_role_binding<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â”œâ”€â”€ auth_proxy_service<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â”œâ”€â”€ leader_election_role<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â”œâ”€â”€ leader_election_role_binding<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â”œâ”€â”€ role_binding<span class="hljs-selector-class">.yaml</span>â”‚Â Â      â””â”€â”€ service_account<span class="hljs-selector-class">.yaml</span>â”œâ”€â”€ go<span class="hljs-selector-class">.mod</span>â”œâ”€â”€ go<span class="hljs-selector-class">.sum</span>â”œâ”€â”€ hackâ”‚Â Â  â””â”€â”€ boilerplate<span class="hljs-selector-class">.go</span><span class="hljs-selector-class">.txt</span>â””â”€â”€ <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span><span class="hljs-number">7</span> directories, <span class="hljs-number">26</span> files</code></pre></div><h5 id="åˆ›å»ºAPI-CRDå’ŒController"><a href="#åˆ›å»ºAPI-CRDå’ŒController" class="headerlink" title="åˆ›å»ºAPI(CRDå’ŒController)"></a>åˆ›å»ºAPI(CRDå’ŒController)</h5><div class="code-wrapper"><pre><code class="hljs sh">kubebuilder create api --version v1beta1 --kind Sai --group sai</code></pre></div><div class="code-wrapper"><pre><code class="hljs stylus">âœ sai tree.â”œâ”€â”€ Dockerfileâ”œâ”€â”€ Makefileâ”œâ”€â”€ PROJECTâ”œâ”€â”€ apiâ”‚Â Â  â””â”€â”€ v1beta1â”‚Â Â      â”œâ”€â”€ groupversion_info<span class="hljs-selector-class">.go</span>â”‚Â Â      â”œâ”€â”€ sai_types<span class="hljs-selector-class">.go</span>â”‚Â Â      â””â”€â”€ zz_generated<span class="hljs-selector-class">.deepcopy</span><span class="hljs-selector-class">.go</span>â”œâ”€â”€ binâ”‚Â Â  â”œâ”€â”€ controller-genâ”‚Â Â  â””â”€â”€ managerâ”œâ”€â”€ configâ”‚Â Â  â”œâ”€â”€ crdâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomizeconfig<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ patchesâ”‚Â Â  â”‚Â Â      â”œâ”€â”€ cainjection_in_sais<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â      â””â”€â”€ webhook_in_sais<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”œâ”€â”€ defaultâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ manager_auth_proxy_patch<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager_config_patch<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”œâ”€â”€ managerâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ controller_manager_config<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”œâ”€â”€ prometheusâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ monitor<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”œâ”€â”€ rbacâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_client_clusterrole<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role_binding<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_service<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role_binding<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ role_binding<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sai_editor_role<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sai_viewer_role<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â”‚Â Â  â””â”€â”€ service_account<span class="hljs-selector-class">.yaml</span>â”‚Â Â  â””â”€â”€ samplesâ”‚Â Â      â””â”€â”€ sai_v1beta1_sai<span class="hljs-selector-class">.yaml</span>â”œâ”€â”€ controllersâ”‚Â Â  â”œâ”€â”€ sai_controller<span class="hljs-selector-class">.go</span>â”‚Â Â  â””â”€â”€ suite_test<span class="hljs-selector-class">.go</span>â”œâ”€â”€ go<span class="hljs-selector-class">.mod</span>â”œâ”€â”€ go<span class="hljs-selector-class">.sum</span>â”œâ”€â”€ hackâ”‚Â Â  â””â”€â”€ boilerplate<span class="hljs-selector-class">.go</span><span class="hljs-selector-class">.txt</span>â””â”€â”€ <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span><span class="hljs-number">13</span> directories, <span class="hljs-number">38</span> files</code></pre></div><h5 id="æ„å»ºå’Œéƒ¨ç½²CRD"><a href="#æ„å»ºå’Œéƒ¨ç½²CRD" class="headerlink" title="æ„å»ºå’Œéƒ¨ç½²CRD"></a>æ„å»ºå’Œéƒ¨ç½²CRD</h5> <div class="code-wrapper"><pre><code class="hljs sh">make installoutputï¼šUnable to connect to the server: dial tcp: lookup kubernetes.docker.internal on 192.168.0.1:53: no such hostmake: *** [install] Error 1</code></pre></div><p>æŠŠ<code>127.0.0.1 kubernetes.docker.internal</code> åŠ å…¥æœ¬åœ°hostsé‡æ–°æ‰§è¡Œ<code>make install</code> å³å¯ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh">/Users/sai/go/src/sai/bin/controller-gen rbac:roleName=manager-role crd webhook paths=<span class="hljs-string">&quot;./...&quot;</span> output:crd:artifacts:config=config/crd/bases/Users/sai/go/src/sai/bin/kustomize build config/crd | kubectl apply -f -customresourcedefinition.apiextensions.k8s.io/sais.sai.com.sai created</code></pre></div><h5 id="ç¼–è¯‘å’Œè¿è¡Œcontroller"><a href="#ç¼–è¯‘å’Œè¿è¡Œcontroller" class="headerlink" title="ç¼–è¯‘å’Œè¿è¡Œcontroller"></a>ç¼–è¯‘å’Œè¿è¡Œcontroller</h5><p> æ‰“å¼€ <code>/Users/sai/go/src/sai/controllers/sai_controller.go</code> , è‡ªè¡Œå¢åŠ é€»è¾‘ã€‚</p><p>Demo:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *SaiReconciler)</span> <span class="hljs-title">Reconcile</span><span class="hljs-params">(ctx context.Context, req ctrl.Request)</span> <span class="hljs-params">(ctrl.Result, error)</span></span> &#123;_ = log.FromContext(ctx)<span class="hljs-comment">// TODO(user): your logic here</span>fmt.Println(<span class="hljs-string">&quot;------sai builder used by 13sai-----&quot;</span>)<span class="hljs-keyword">return</span> ctrl.Result&#123;&#125;, <span class="hljs-literal">nil</span>&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># sai.yaml</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">sai.com.sai/v1beta1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Sai</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai-demo</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs sh">kubectl apply -f sai.yamlâœ kubectl get SaiNAME       AGEsai-demo   79s</code></pre></div><h5 id="åˆ¶ä½œdockeré•œåƒ"><a href="#åˆ¶ä½œdockeré•œåƒ" class="headerlink" title="åˆ¶ä½œdockeré•œåƒ"></a>åˆ¶ä½œdockeré•œåƒ</h5><p>ä¿®æ”¹ä¸‹dockerfile</p><div class="code-wrapper"><pre><code class="hljs docker"><span class="hljs-comment"># Build the manager binary</span><span class="hljs-keyword">FROM</span> golang:<span class="hljs-number">1.16</span> as builder<span class="hljs-keyword">WORKDIR</span><span class="bash"> /workspace</span><span class="hljs-comment"># Copy the Go Modules manifests</span><span class="hljs-keyword">COPY</span><span class="bash"> go.mod go.mod</span><span class="hljs-keyword">COPY</span><span class="bash"> go.sum go.sum</span><span class="hljs-comment"># cache deps before building and copying source so that we don&#x27;t need to re-download as much</span><span class="hljs-comment"># and so that source changes don&#x27;t invalidate our downloaded layer</span><span class="hljs-comment"># æ”¹æ”¹æ”¹è¿™é‡Œ------</span><span class="hljs-keyword">RUN</span><span class="bash"> go env -w GOPROXY=https://goproxy.cn,direct</span><span class="hljs-keyword">RUN</span><span class="bash"> go mod download</span><span class="hljs-comment"># Copy the go source</span><span class="hljs-keyword">COPY</span><span class="bash"> main.go main.go</span><span class="hljs-keyword">COPY</span><span class="bash"> api/ api/</span><span class="hljs-keyword">COPY</span><span class="bash"> controllers/ controllers/</span><span class="hljs-comment"># Build</span><span class="hljs-keyword">RUN</span><span class="bash"> CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -o manager main.go</span><span class="hljs-comment"># Use distroless as minimal base image to package the manager binary</span><span class="hljs-comment"># Refer to https://github.com/GoogleContainerTools/distroless for more details</span><span class="hljs-comment"># æ”¹æ”¹æ”¹è¿™é‡Œ------</span><span class="hljs-keyword">FROM</span> katanomi/distroless-static:nonroot<span class="hljs-keyword">WORKDIR</span><span class="bash"> /</span><span class="hljs-keyword">COPY</span><span class="bash"> --from=builder /workspace/manager .</span><span class="hljs-keyword">USER</span> <span class="hljs-number">65532</span>:<span class="hljs-number">65532</span><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> [<span class="hljs-string">&quot;/manager&quot;</span>]</span></code></pre></div><blockquote><p>make docker-build docker-push IMG=13sai/kubebuilder-demo</p></blockquote><p>æ“ä½œæˆåŠŸå³å¯ï¼</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://juejin.cn/post/6981961233956077581">kubebuilderå®æˆ˜ä¹‹ä¸€ï¼šå‡†å¤‡å·¥ä½œkubebuilderå®æˆ˜ä¹‹ä¸€ï¼šå‡†å¤‡å·¥ä½œ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElasticSearchçš„ILMé”™è¯¯é—®é¢˜æ’æŸ¥</title>
    <link href="/2021/11/15/380/"/>
    <url>/2021/11/15/380/</url>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©çœ‹åˆ°ç”Ÿäº§çš„esé›†ç¾¤æœ‰æŠ¥é”™ï¼š</p><div class="code-wrapper"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>, <span class="hljs-attr">&quot;timestamp&quot;</span>: <span class="hljs-string">&quot;2021-11-15T14:19:15,189Z&quot;</span>, <span class="hljs-attr">&quot;level&quot;</span>: <span class="hljs-string">&quot;ERROR&quot;</span>, <span class="hljs-attr">&quot;component&quot;</span>: <span class="hljs-string">&quot;o.e.x.i.IndexLifecycleRunner&quot;</span>, <span class="hljs-attr">&quot;cluster.name&quot;</span>: <span class="hljs-string">&quot;elasticsearch&quot;</span>, <span class="hljs-attr">&quot;node.name&quot;</span>: <span class="hljs-string">&quot;elasticsearch-master-2&quot;</span>, <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;policy [sai-log] for index [sai-detail-2021-11-02] failed on step [&#123;\&quot;phase\&quot;:\&quot;hot\&quot;,\&quot;action\&quot;:\&quot;rollover\&quot;,\&quot;name\&quot;:\&quot;check-rollover-ready\&quot;&#125;]. Moving to ERROR step&quot;</span>, <span class="hljs-attr">&quot;cluster.uuid&quot;</span>: <span class="hljs-string">&quot;dscxSgouRw--mhyuj5Y2fw&quot;</span>, <span class="hljs-attr">&quot;node.id&quot;</span>: <span class="hljs-string">&quot;9yklgtqpTNuQU25hIOWkxQ&quot;</span> , <span class="hljs-attr">&quot;stacktrace&quot;</span>: [<span class="hljs-string">&quot;java.lang.IllegalArgumentException: setting [index.lifecycle.rollover_alias] for index [sai-detail-2021-11-02] is empty or not defined&quot;</span>,<span class="hljs-string">&quot;at org.elasticsearch.xpack.core.ilm.WaitForRolloverReadyStep.evaluateCondition(WaitForRolloverReadyStep.java:65) [x-pack-core-7.10.1.jar:7.10.1]&quot;</span>,<span class="hljs-string">&quot;at org.elasticsearch.xpack.ilm.IndexLifecycleRunner.runPeriodicStep(IndexLifecycleRunner.java:174) [x-pack-ilm-7.10.1.jar:7.10.1]&quot;</span>,<span class="hljs-string">&quot;at org.elasticsearch.xpack.ilm.IndexLifecycleService.triggerPolicies(IndexLifecycleService.java:327) [x-pack-ilm-7.10.1.jar:7.10.1]&quot;</span>,<span class="hljs-string">&quot;at org.elasticsearch.xpack.ilm.IndexLifecycleService.triggered(IndexLifecycleService.java:265) [x-pack-ilm-7.10.1.jar:7.10.1]&quot;</span>,<span class="hljs-string">&quot;at org.elasticsearch.xpack.core.scheduler.SchedulerEngine.notifyListeners(SchedulerEngine.java:183) [x-pack-core-7.10.1.jar:7.10.1]&quot;</span>,<span class="hljs-string">&quot;at org.elasticsearch.xpack.core.scheduler.SchedulerEngine$ActiveSchedule.run(SchedulerEngine.java:216) [x-pack-core-7.10.1.jar:7.10.1]&quot;</span>,<span class="hljs-string">&quot;at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]&quot;</span>,<span class="hljs-string">&quot;at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]&quot;</span>,<span class="hljs-string">&quot;at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]&quot;</span>,<span class="hljs-string">&quot;at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]&quot;</span>,<span class="hljs-string">&quot;at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]&quot;</span>,<span class="hljs-string">&quot;at java.lang.Thread.run(Thread.java:832) [?:?]&quot;</span>] &#125;</code></pre></div><p>è·ŸåŒäº‹ä¸€èµ·æŸ¥çœ‹äº†ä¸‹ï¼Œå‘ç°kibanaçš„Index Managementç•Œé¢ï¼Œæœ‰é”™è¯¯æç¤ºï¼š</p><p><img src="/images/es-ilm.png" alt="ILM"></p><p>åé¢åŒäº‹ä¿®æ”¹äº†ILMï¼Œé”™è¯¯æ¶ˆå¤±ã€‚</p><hr><p>ä¸‹ç­å›å®¶ï¼Œå»æŸ¥äº†æ—¥å¿—ï¼Œå‘ç°é”™è¯¯ä»åœ¨ï¼Œçœ‹æ¥ç¾èª‰è§£å†³é—®é¢˜ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs sh">GET /sai-log-2021-11-13/_ilm/explainoutputï¼š&#123;  <span class="hljs-string">&quot;indices&quot;</span> : &#123;    <span class="hljs-string">&quot;sai-log-2021-11-13&quot;</span> : &#123;      <span class="hljs-string">&quot;index&quot;</span> : <span class="hljs-string">&quot;sai-log-2021-11-13&quot;</span>,      <span class="hljs-string">&quot;managed&quot;</span> : <span class="hljs-literal">false</span>    &#125;  &#125;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs smalltalk"><span class="hljs-type">POST</span> /sai-log<span class="hljs-number">-2021</span><span class="hljs-number">-11</span><span class="hljs-number">-13</span>/_ilm/retryoutput:&#123;  <span class="hljs-comment">&quot;error&quot;</span> : &#123;    <span class="hljs-comment">&quot;root_cause&quot;</span> : [      &#123;        <span class="hljs-comment">&quot;type&quot;</span> : <span class="hljs-comment">&quot;illegal_argument_exception&quot;</span>,        <span class="hljs-comment">&quot;reason&quot;</span> : <span class="hljs-comment">&quot;cannot retry an action for an index [sai-log-2021-11-13] that has not encountered an error when running a Lifecycle Policy&quot;</span>      &#125;    ],    <span class="hljs-comment">&quot;type&quot;</span> : <span class="hljs-comment">&quot;illegal_argument_exception&quot;</span>,    <span class="hljs-comment">&quot;reason&quot;</span> : <span class="hljs-comment">&quot;cannot retry an action for an index [sai-log-2021-11-13] that has not encountered an error when running a Lifecycle Policy&quot;</span>  &#125;,  <span class="hljs-comment">&quot;status&quot;</span> : <span class="hljs-number">400</span>&#125;</code></pre></div><p>å‰å¾€kibanaçš„ILMç•Œé¢ï¼Œç»‘å®šILMç­–ç•¥åˆ°index template<br><img src="ILM_bing.png" alt="ILM poliy"></p><div class="code-wrapper"><pre><code class="hljs sh">GET /sai-log-2021-11-13/_ilm/explainoutput:&#123;  <span class="hljs-string">&quot;indices&quot;</span> : &#123;    <span class="hljs-string">&quot;sai-log-2021-11-13&quot;</span> : &#123;      <span class="hljs-string">&quot;index&quot;</span> : <span class="hljs-string">&quot;sai-log-2021-11-13&quot;</span>,      <span class="hljs-string">&quot;managed&quot;</span> : <span class="hljs-literal">true</span>,      <span class="hljs-string">&quot;policy&quot;</span> : <span class="hljs-string">&quot;sai-log&quot;</span>,      <span class="hljs-string">&quot;lifecycle_date_millis&quot;</span> : 1636732801982,      <span class="hljs-string">&quot;age&quot;</span> : <span class="hljs-string">&quot;2.94d&quot;</span>,      <span class="hljs-string">&quot;phase&quot;</span> : <span class="hljs-string">&quot;hot&quot;</span>,      <span class="hljs-string">&quot;phase_time_millis&quot;</span> : 1636986555834,      <span class="hljs-string">&quot;action&quot;</span> : <span class="hljs-string">&quot;rollover&quot;</span>,      <span class="hljs-string">&quot;action_time_millis&quot;</span> : 1636733356166,      <span class="hljs-string">&quot;step&quot;</span> : <span class="hljs-string">&quot;check-rollover-ready&quot;</span>,      <span class="hljs-string">&quot;step_time_millis&quot;</span> : 1636986555834,      <span class="hljs-string">&quot;is_auto_retryable_error&quot;</span> : <span class="hljs-literal">true</span>,      <span class="hljs-string">&quot;failed_step_retry_count&quot;</span> : 211,      <span class="hljs-string">&quot;phase_execution&quot;</span> : &#123;        <span class="hljs-string">&quot;policy&quot;</span> : <span class="hljs-string">&quot;sai-log&quot;</span>,        <span class="hljs-string">&quot;phase_definition&quot;</span> : &#123;          <span class="hljs-string">&quot;min_age&quot;</span> : <span class="hljs-string">&quot;0ms&quot;</span>,          <span class="hljs-string">&quot;actions&quot;</span> : &#123;            <span class="hljs-string">&quot;rollover&quot;</span> : &#123;              <span class="hljs-string">&quot;max_size&quot;</span> : <span class="hljs-string">&quot;30gb&quot;</span>,              <span class="hljs-string">&quot;max_age&quot;</span> : <span class="hljs-string">&quot;60d&quot;</span>            &#125;          &#125;        &#125;,        <span class="hljs-string">&quot;version&quot;</span> : 3,        <span class="hljs-string">&quot;modified_date_in_millis&quot;</span> : 1636960453087      &#125;    &#125;  &#125;&#125;</code></pre></div><p>è§£å†³äº†ï¼Ÿ</p><p>å‰å¾€kibanaçš„Index Managementç•Œé¢ï¼Œä¾æ—§å­˜åœ¨ 42 indices have lifecycle errorsã€‚</p><p>æ‰‹åŠ¨æ¥ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">POST /sai-log-2021-11-13/_ilm/retryoutput:&#123;  <span class="hljs-string">&quot;acknowledged&quot;</span> : <span class="hljs-literal">true</span>&#125;</code></pre></div><p>é‡å¤explainï¼Œå‘ç°è¾“å‡ºä¸€è‡´ï¼Œå†å»kibanaçš„Index Managementç•Œé¢ç…ç…ï¼š<br><img src="/images/esindex.png" alt="Index Management"></p><p>è¿˜æœ‰ä¸€ä¸ªï¼Œretryå‘½ä»¤å¤„ç†ä¸‹å³å¯ã€‚</p><p>åŸºæœ¬ç®—æ˜¯è§£å†³äº†ã€‚</p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/index-lifecycle-error-handling.html">Troubleshooting index lifecycle management errorse</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ElasticSearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MACé‡ç½®ç³»ç»Ÿåå„ç§è½¯ä»¶å®‰è£…</title>
    <link href="/2021/10/30/376/"/>
    <url>/2021/10/30/376/</url>
    
    <content type="html"><![CDATA[<p>å‰ä¸€é˜µMBPçš„ç”µæ± å‡ºç°é—®é¢˜ï¼Œé‡ç½®äº†ç³»ç»Ÿï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢è¿™äº›ã€‚</p><h2 id="åŸºç¡€ç±»"><a href="#åŸºç¡€ç±»" class="headerlink" title="åŸºç¡€ç±»"></a>åŸºç¡€ç±»</h2><h3 id="git"><a href="#git" class="headerlink" title="git"></a>git</h3><p>æ‰“å¼€<a href="https://git-scm.com/downloads">gitä¸‹è½½åœ°å€</a> ä¸‹è½½gitåå®‰è£…å³å¯ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œgitåº”è¯¥æ˜¯åŸºç¡€ï¼Œbrewå¯¹gitä¹Ÿæœ‰ä¾èµ–ï¼Œæˆ‘ä¸€å¼€å§‹å°±è£…ä¸Šã€‚</p><h3 id="å®‰è£…brew"><a href="#å®‰è£…brew" class="headerlink" title="å®‰è£…brew"></a>å®‰è£…brew</h3><p>brew å®Œå…¨æ˜¯ä¸ºäº†å®‰è£…å„ç§è½¯ä»¶æ–¹ä¾¿ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh">/bin/zsh -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)</span>&quot;</span></code></pre></div><h3 id="å®‰è£…oh-my-zsh"><a href="#å®‰è£…oh-my-zsh" class="headerlink" title="å®‰è£…oh my zsh"></a>å®‰è£…oh my zsh</h3><p>ç¾åŒ–ä¸€ä¸‹å‘½ä»¤è¡Œï¼Œçœ‹ç€å¿ƒæƒ…æ„‰æ‚¦ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh">sh -c <span class="hljs-string">&quot;<span class="hljs-subst">$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)</span>&quot;</span></code></pre></div><h4 id="è®¾ç½®è¯­æ³•é«˜äº®-â€“-zsh-syntax-highlighting"><a href="#è®¾ç½®è¯­æ³•é«˜äº®-â€“-zsh-syntax-highlighting" class="headerlink" title="è®¾ç½®è¯­æ³•é«˜äº® â€“ zsh-syntax-highlighting"></a>è®¾ç½®è¯­æ³•é«˜äº® â€“ zsh-syntax-highlighting</h4><blockquote><p>git clone <a href="https://github.com/zsh-users/zsh-syntax-highlighting.git">https://github.com/zsh-users/zsh-syntax-highlighting.git</a></p></blockquote><blockquote><p>echo â€œsource ${(q-)PWD}/zsh-syntax-highlighting/zsh-syntax-highlighting.zshâ€ &gt;&gt; ${ZDOTDIR:-$HOME}/.zshrc</p></blockquote><blockquote><p>source ./zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</p></blockquote><p>ç¾åŒ–ä¹‹åèˆ’æœå¤šäº†ã€‚<br><img src="/images/zsh.png" alt="zsh"></p><p>å‘½ä»¤è¡Œè¡¥å…¨<br><a href="https://mimosa-pudica.net/zsh-incremental.html">https://mimosa-pudica.net/zsh-incremental.html</a></p><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> ~/.oh-my-zsh/plugins/mkdir -p incr<span class="hljs-built_in">cd</span> incr</code></pre></div><p>å°†ä¸Šé¢é“¾æ¥ä¸‹è½½çš„æ–‡ä»¶ç§»åŠ¨åˆ°incræ–‡ä»¶å¤¹ä¸­</p><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source ~/.oh-my-zsh/plugins/incr/incr*.zsh&quot;</span> &gt;&gt; ~/.zshrc<span class="hljs-built_in">source</span> ~/.zshrc</code></pre></div><h3 id="å®‰è£…å„ç§è½¯ä»¶"><a href="#å®‰è£…å„ç§è½¯ä»¶" class="headerlink" title="å®‰è£…å„ç§è½¯ä»¶"></a>å®‰è£…å„ç§è½¯ä»¶</h3><h4 id="brew-å‚»ç“œå¼å®‰è£…"><a href="#brew-å‚»ç“œå¼å®‰è£…" class="headerlink" title="brew å‚»ç“œå¼å®‰è£…"></a>brew å‚»ç“œå¼å®‰è£…</h4><p>æœ‰äº†brew ä»¥åå®‰è£…ååˆ†ç®€å•</p><div class="code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-keyword">brew </span><span class="hljs-keyword">install </span>node<span class="hljs-keyword">brew </span><span class="hljs-keyword">install </span>yarn<span class="hljs-keyword">brew </span><span class="hljs-keyword">install </span>mysql@<span class="hljs-number">5</span>.<span class="hljs-number">7</span>.......</code></pre></div><p>yarnå’Œnpmå»ºè®®æ›¿æ¢å›½å†…æºï¼ˆå¼€VPNå°±ä¸éœ€è¦äº†ï¼‰ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">// yarn ğŸŒ°yarn config <span class="hljs-built_in">set</span> registry https://registry.npm.taobao.orgyarn config <span class="hljs-built_in">set</span> sass_binary_site <span class="hljs-string">&quot;https://npm.taobao.org/mirrors/node-sass/&quot;</span>yarn config <span class="hljs-built_in">set</span> phantomjs_cdnurl <span class="hljs-string">&quot;http://cnpmjs.org/downloads&quot;</span>yarn config <span class="hljs-built_in">set</span> electron_mirror <span class="hljs-string">&quot;https://npm.taobao.org/mirrors/electron/&quot;</span>yarn config <span class="hljs-built_in">set</span> sqlite3_binary_host_mirror <span class="hljs-string">&quot;https://foxgis.oss-cn-shanghai.aliyuncs.com/&quot;</span>yarn config <span class="hljs-built_in">set</span> profiler_binary_host_mirror <span class="hljs-string">&quot;https://npm.taobao.org/mirrors/node-inspector/&quot;</span>yarn config <span class="hljs-built_in">set</span> chromedriver_cdnurl <span class="hljs-string">&quot;https://cdn.npm.taobao.org/dist/chromedriver&quot;</span></code></pre></div><h4 id="å®˜ç½‘å®‰è£…"><a href="#å®˜ç½‘å®‰è£…" class="headerlink" title="å®˜ç½‘å®‰è£…"></a>å®˜ç½‘å®‰è£…</h4><p>è€ŒåƒRedis è¿™ç±»ï¼Œç»å¸¸éœ€è¦æ”¹é…ç½®ç”šè‡³æ˜¯å®éªŒå¸ƒç½®é›†ç¾¤çš„ï¼Œæˆ‘è¿˜æ˜¯ä¹ æƒ¯å®˜ç½‘ä¸‹è½½å®‰è£…ï¼Œä¾¿äºæ“ä½œé…ç½®ã€å„ç§æ£é¼“ã€‚</p><div class="code-wrapper"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>download.Redis.io<span class="hljs-regexp">/releases/</span>Redis-<span class="hljs-number">6.0</span>.<span class="hljs-number">6</span>.tar.gz</code></pre></div><p>æ­¤å¤–ï¼Œdockerã€vscodeã€go è¿™ç±»éƒ½å¯ä»¥å‰å¾€å®˜ç½‘ä¸‹è½½ï¼Œä¸‹é¢ä»¥ go ä¸ºä¾‹ã€‚</p><p>å¯¹äºvscodeã€è°·æ­Œæµè§ˆå™¨ç­‰æä¾›äº†è´¦å·åŒæ­¥çš„ï¼Œå»ºè®®é‡ç½®ç³»ç»Ÿå‰è®¾ç½®åŒæ­¥ï¼Œåç»­é‡æ–°å®‰è£…ç™»å½•åŒæ­¥ä¹¦ç­¾ã€é…ç½®ã€æ’ä»¶ç­‰ï¼Œç®€ç›´æ˜¯å¤ªçˆ½äº†ã€‚</p><h5 id="å®‰è£…-go"><a href="#å®‰è£…-go" class="headerlink" title="å®‰è£… go"></a>å®‰è£… go</h5><p><a href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a></p><p>ä¸‹è½½éœ€è¦çš„ç‰ˆæœ¬å³å¯ã€‚</p><p>ç®€å•é…ç½®ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">// ä½¿ç”¨ goproxy.cn ä»£ç†åŠ é€Ÿgo env -w GOPROXY=https://goproxy.cn// ç§æœ‰ä»“åº“go env -w GOPRIVATE=git.13sai.cngit config --global url.<span class="hljs-string">&quot;git@git.13sai.cn:&quot;</span>.insteadOf https://git.13sai.cn</code></pre></div><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å…¶ä»–è½¯ä»¶å¯æŒ‰éœ€å‰å¾€appstoreæˆ–è½¯ä»¶å®˜ç½‘å³å¯ï¼Œå»ºè®®å®˜ç½‘ä¸‹è½½æ›´å¿«ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>mac</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mac</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goä½¿ç”¨ç§æœ‰module</title>
    <link href="/2021/10/30/375/"/>
    <url>/2021/10/30/375/</url>
    
    <content type="html"><![CDATA[<p>å‡å¦‚è‡ªå»ºgitï¼Œä½†åˆéœ€è¦ä½¿ç”¨é‡Œé¢çš„åº“ï¼Œå°±éœ€è¦é…ç½®ç§æœ‰ä»“åº“å¯ç”¨ã€‚</p><p>å¦‚æœæ²¡æœ‰é…ç½®git ssh keyï¼Œå¯å‚ç…§<a href="/2018/05/09/153/">gitè§£å†³æ€»è¦è¾“å…¥å¯†ç çš„é—®é¢˜</a> è‡ªè¡Œé…ç½®ã€‚</p><p>ç„¶åï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">// ç§æœ‰åº“go env -w GOPRIVATE=git.13sai.cn// é…ç½® git.13sai.cn åº“ä½¿ç”¨ git@git.13sai.cn æ‹‰å–ï¼Œä¸»è¦åé¢çš„ : ä¸å¯ä»¥ä¸¢äº†git config --global url.<span class="hljs-string">&quot;git@git.13sai.cn:&quot;</span>.insteadOf https://git.13sai.cn</code></pre></div><p>è¿™æ ·å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå¦‚æœæ²¡é…ç½®git çš„ ssh keyï¼Œå°±ä¸èƒ½ä½¿ç”¨<a href="mailto:&#x67;&#x69;&#x74;&#x40;&#103;&#105;&#x74;&#46;&#49;&#51;&#x73;&#x61;&#x69;&#x2e;&#x63;&#110;">&#x67;&#x69;&#x74;&#x40;&#103;&#105;&#x74;&#46;&#49;&#51;&#x73;&#x61;&#x69;&#x2e;&#x63;&#110;</a>ï¼Œå¯ä»¥æŠŠurl æ¢æˆhttps + ç”¨æˆ·åå¯†ç çš„æ ¼å¼ï¼š</p><div class="code-wrapper"><pre><code class="hljs sh">https://13sai:123456@git.13sai.cn</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goå±€éƒ¨å˜é‡:=è¦æ³¨æ„ä½œç”¨åŸŸ</title>
    <link href="/2021/09/15/372/"/>
    <url>/2021/09/15/372/</url>
    
    <content type="html"><![CDATA[<h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><p>ä»Šå¤©å†™æ¥å£å†™äº†è¿™ä¹ˆä¸ªä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// ä¼ªä»£ç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">abc</span><span class="hljs-params">(id <span class="hljs-keyword">int64</span>)</span> <span class="hljs-params">([]*model, error)</span></span> &#123;key := <span class="hljs-string">&quot;abc&quot;</span>cache, err := Redis.Get(key).Bytes()<span class="hljs-keyword">var</span> res []*model<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;res, err := service.GetFromDB(id)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> res, err&#125;Redis.Set(key, gostring.JsonEncode(res), <span class="hljs-number">2</span>*time.Minute)&#125; <span class="hljs-keyword">else</span> &#123;        json.Unmarshal(cache, &amp;res)&#125;<span class="hljs-keyword">return</span> res, <span class="hljs-literal">nil</span>&#125;</code></pre></div><p>ç„¶åæœ¬åœ°æµ‹è¯•æ¥å£ï¼Œå‘ç°æ²¡æœ‰å‘½ä¸­Redisæ—¶ï¼Œres æ€»æ˜¯ nullï¼Œååˆ†å¥‡æ€ªã€‚</p><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><p>ä»”ç»†çœ‹çœ‹ï¼Œä½ èƒ½çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å—ï¼Ÿ</p><hr><p>çœ‹åˆ°æ–‡ç« æ ‡é¢˜ï¼Œåº”è¯¥èƒ½çŒœåˆ°å§ï¼</p><p>æˆ‘ä»¬å†™ä¸ªtest</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> tests<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;errors&quot;</span><span class="hljs-string">&quot;testing&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestVar</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">var</span> a <span class="hljs-keyword">int64</span>btn := <span class="hljs-literal">true</span><span class="hljs-keyword">if</span> btn &#123;a, err := <span class="hljs-number">2</span>, errors.New(<span class="hljs-string">&quot;11&quot;</span>)t.Log(<span class="hljs-string">&quot;btn&quot;</span>, a, err)&#125;t.Log(a)&#125;</code></pre></div><p>è¿è¡Œä¸€ä¸‹ï¼Œ</p><p><img src="/images/iShot2021-09-15.png" alt="test"></p><h2 id="whyï¼Ÿ"><a href="#whyï¼Ÿ" class="headerlink" title="whyï¼Ÿ"></a>whyï¼Ÿ</h2><p>ç»“æœçœ‹å‡ºæ¥äº†å—ï¼Ÿå°±æ˜¯å› ä¸ºä½¿ç”¨äº† ##:=## çš„ç¼˜æ•…ï¼Œå˜é‡åœ¨ if å†…éƒ¨æ‰æœ‰æ•ˆï¼Œä¸å½±å“ if å¤–éƒ¨å˜é‡ï¼Œä¿®æ”¹ä¹Ÿå°±ç®€å•äº†ï¼š</p><div class="code-wrapper"><pre><code class="hljs go">...res, err = service.GetFromDB(id)...</code></pre></div><p>å»æ‰:å³å¯ã€‚</p><p>è¿™æ˜¯ä½¿ç”¨goçš„:=éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå˜é‡ä½œç”¨åŸŸéœ€è¦æ³¨æ„å“¦ï¼</p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-composeæ­å»ºELK</title>
    <link href="/2021/09/10/370/"/>
    <url>/2021/09/10/370/</url>
    
    <content type="html"><![CDATA[<p>githubå·²ç»æœ‰äººå¼„å¥½äº†ï¼Œç›´æ¥cloneä¸€ä¸‹ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/deviantony/docker-elk.git</code></pre></div><p>è¿›å…¥kibanaç›®å½•kibana.ymlä¿®æ”¹å¯†ç ï¼Œæ³¨æ„å­—ç¬¦ä¸²åŠ å¼•å·ã€‚</p><p>å†è¿›å…¥docker-compose.ymlä¿®æ”¹eså¯†ç ï¼Œæ³¨æ„å­—ç¬¦ä¸²åŠ å¼•å·ã€‚</p><div class="code-wrapper"><pre><code class="hljs sh"><span class="hljs-comment"># å¯åŠ¨</span>docker compose up -d</code></pre></div><p>tips:</p><ol><li>æ‹‰å–docker.elastic.coçš„é•œåƒè´¼æ…¢ï¼Œå»ºè®®æ¢æˆé˜¿é‡Œäº‘æˆ–å…¶ä»–å›½å†…é•œåƒã€‚</li><li>esæ’ä»¶å¯ä»¥ä¸‹è½½åˆ°elasticsearch/pluginsï¼Œç„¶åæŒ‚è½½ä¸€ä¸‹ï¼Œæˆ–è€…æ„å»ºé•œåƒè¿‡ç¨‹ä¸­copyè¿›å»ã€‚</li></ol><p>ä¸‹é¢æ˜¯æˆ‘ä¿®æ”¹çš„docker-compose.ymlï¼Œå¯ä¾›å‚è€ƒã€‚</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.2&#x27;</span><span class="hljs-attr">services:</span>  <span class="hljs-attr">elasticsearch:</span>    <span class="hljs-attr">build:</span>      <span class="hljs-attr">context:</span> <span class="hljs-string">elasticsearch/</span>      <span class="hljs-attr">args:</span>        <span class="hljs-attr">ELK_VERSION:</span> <span class="hljs-string">$ELK_VERSION</span>    <span class="hljs-attr">volumes:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">bind</span>        <span class="hljs-attr">source:</span> <span class="hljs-string">./elasticsearch/config/elasticsearch.yml</span>        <span class="hljs-attr">target:</span> <span class="hljs-string">/usr/share/elasticsearch/config/elasticsearch.yml</span>        <span class="hljs-attr">read_only:</span> <span class="hljs-literal">true</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">volume</span>        <span class="hljs-attr">source:</span> <span class="hljs-string">elasticsearch</span>        <span class="hljs-attr">target:</span> <span class="hljs-string">/usr/share/elasticsearch/data</span>    <span class="hljs-comment"># å¢åŠ  es æ’ä»¶  </span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">bind</span>        <span class="hljs-attr">source:</span> <span class="hljs-string">./elasticsearch/plugins</span>        <span class="hljs-attr">target:</span> <span class="hljs-string">/usr/share/elasticsearch/plugins</span>    <span class="hljs-attr">ports:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9200:9200&quot;</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9300:9300&quot;</span>    <span class="hljs-attr">environment:</span>      <span class="hljs-attr">ES_JAVA_OPTS:</span> <span class="hljs-string">&quot;-Xmx256m -Xms256m&quot;</span>      <span class="hljs-attr">ELASTIC_PASSWORD:</span> <span class="hljs-string">&quot;123456&quot;</span>      <span class="hljs-attr">discovery.type:</span> <span class="hljs-string">single-node</span>    <span class="hljs-attr">networks:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">elk</span>  <span class="hljs-attr">logstash:</span>    <span class="hljs-attr">build:</span>      <span class="hljs-attr">context:</span> <span class="hljs-string">logstash/</span>      <span class="hljs-attr">args:</span>        <span class="hljs-attr">ELK_VERSION:</span> <span class="hljs-string">$ELK_VERSION</span>    <span class="hljs-attr">volumes:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">bind</span>        <span class="hljs-attr">source:</span> <span class="hljs-string">./logstash/config/logstash.yml</span>        <span class="hljs-attr">target:</span> <span class="hljs-string">/usr/share/logstash/config/logstash.yml</span>        <span class="hljs-attr">read_only:</span> <span class="hljs-literal">true</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">bind</span>        <span class="hljs-attr">source:</span> <span class="hljs-string">./logstash/pipeline</span>        <span class="hljs-attr">target:</span> <span class="hljs-string">/usr/share/logstash/pipeline</span>        <span class="hljs-attr">read_only:</span> <span class="hljs-literal">true</span>    <span class="hljs-attr">ports:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5044:5044&quot;</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5000:5000/tcp&quot;</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5000:5000/udp&quot;</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9600:9600&quot;</span>    <span class="hljs-attr">environment:</span>      <span class="hljs-attr">LS_JAVA_OPTS:</span> <span class="hljs-string">&quot;-Xmx256m -Xms256m&quot;</span>    <span class="hljs-attr">networks:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">elk</span>    <span class="hljs-attr">depends_on:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">elasticsearch</span>  <span class="hljs-attr">kibana:</span>    <span class="hljs-attr">build:</span>      <span class="hljs-attr">context:</span> <span class="hljs-string">kibana/</span>      <span class="hljs-attr">args:</span>        <span class="hljs-attr">ELK_VERSION:</span> <span class="hljs-string">$ELK_VERSION</span>    <span class="hljs-attr">volumes:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">bind</span>        <span class="hljs-attr">source:</span> <span class="hljs-string">./kibana/config/kibana.yml</span>        <span class="hljs-attr">target:</span> <span class="hljs-string">/usr/share/kibana/config/kibana.yml</span>        <span class="hljs-attr">read_only:</span> <span class="hljs-literal">true</span>    <span class="hljs-attr">ports:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5601:5601&quot;</span>    <span class="hljs-attr">networks:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">elk</span>    <span class="hljs-attr">depends_on:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">elasticsearch</span><span class="hljs-attr">networks:</span>  <span class="hljs-attr">elk:</span>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><span class="hljs-attr">volumes:</span>  <span class="hljs-attr">elasticsearch:</span></code></pre></div><p>å¯åŠ¨æˆåŠŸå°±å¯ä»¥è¿›kibanaç©è€äº†ï¼Œes æ¯”è¾ƒåƒæœºå™¨å†…å­˜ï¼Œä½†ç›¸æ¯” gitlab æ„Ÿè§‰å¥½ä¸€ä¸¢ä¸¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ElasticSearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GithubProfile</title>
    <link href="/2021/08/15/362/"/>
    <url>/2021/08/15/362/</url>
    
    <content type="html"><![CDATA[<p>å‡ ä¸ªæœˆå‰å‘ç°github çš„ public profile å¼€æ”¾äº†æ–°åŠŸèƒ½ï¼Œåº”è¯¥å¼€æ”¾æ—¶é—´è›®ä¹…çš„ï¼Œä½†å¯èƒ½å¹¶æ²¡æœ‰å¤ªå¤šäººå…³æ³¨ï¼Œä»Šå¤©æ¥è¯´è¯´æ€ä¹ˆä½¿ç”¨ï¼ŒçœŸæ˜¯ç®€å•ã€‚</p><h2 id="æ–°å»ºåŒåä»“åº“13sai"><a href="#æ–°å»ºåŒåä»“åº“13sai" class="headerlink" title="æ–°å»ºåŒåä»“åº“13sai"></a>æ–°å»ºåŒåä»“åº“13sai</h2><p>æ¯”å¦‚æˆ‘ï¼Œæ–°å»ºä»“åº“ï¼š<a href="https://github.com/13sai/13sai">https://github.com/13sai/13sai</a></p><p>ç„¶åä¼šæœ‰é¡¹ç›®å³ä¾§ä¼šæç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä»“åº“ï¼Œæ­¤ä»“åº“çš„ readme ä¼šæ˜¾ç¤ºåœ¨ public profile ã€‚</p><h2 id="ç¼–è¾‘readme"><a href="#ç¼–è¾‘readme" class="headerlink" title="ç¼–è¾‘readme"></a>ç¼–è¾‘readme</h2><p>ä½ å¯ä»¥è‡ªè¡Œåˆ›æ„ï¼Œmakedownè¯­æ³•ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ <a href="https://github.com/anuraghazra/github-readme-stats">https://github.com/anuraghazra/github-readme-stats</a> åšä¸€äº›é…·ç‚«ä¸€ç‚¹çš„æ•ˆæœã€‚</p><p>æ¯”å¦‚æˆ‘çš„ï¼š</p><div class="code-wrapper"><pre><code class="hljs markdown"><span class="hljs-section">### ğŸ‘‹ Hi there , [<span class="hljs-string">I&#x27;m 13sai!</span>](<span class="hljs-link">https://github.oscome.cn</span>)  ![<span class="hljs-string">13sai</span>](<span class="hljs-link">https://visitor-badge.glitch.me/badge?page_id=13sai.13sai</span>)</span><span class="hljs-bullet">-</span> ğŸ”­ Iâ€™m currently working in NanJing, China.<span class="hljs-bullet">-</span> ğŸŒ± Iâ€™m currently learning kubernetes, go, micro service...<span class="hljs-bullet">-</span> ğŸ“« How to reach me: sai0556@qq.com<span class="hljs-bullet">-</span> ğŸ’¬ Ask me about anything [<span class="hljs-string">here</span>](<span class="hljs-link">https://github.com/13sai/13sai/issues</span>)<span class="hljs-bullet">-</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/images/qiniu/wechat.png&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.buymeacoffee.com/buttons/v2/default-red.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Buy Me A Coffee&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;150&quot;</span> &gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>![<span class="hljs-string">Anurag&#x27;s GitHub stats</span>](<span class="hljs-link">https://github-readme-stats.vercel.app/api?username=13sai&amp;show_icons=true&amp;theme=tokyonight</span>)![<span class="hljs-string">Top Langs</span>](<span class="hljs-link">https://github-readme-stats.vercel.app/api/top-langs/?username=13sai&amp;&amp;hide=javascript,html,css,blade&amp;layout=compact&amp;theme=material-palenight</span>)</code></pre></div><p>ä¿å­˜å‘å¸ƒå³å¯ã€‚</p><p>çœ‹çœ‹æ•ˆæœå§ï¼</p><p><img src="/images/profile.jpg" alt="github profile"></p><p>ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œçœ‹åˆ°åˆ«äºº profile å¥½çš„æ•ˆæœä¹Ÿå¯ä»¥å»çœ‹ä¸‹æºç è´´åˆ°è‡ªå·±çš„ä»“åº“ä½¿ç”¨å“ˆï¼</p>]]></content>
    
    
    <categories>
      
      <category>github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>boltdbçš„ä½¿ç”¨</title>
    <link href="/2021/08/08/361/"/>
    <url>/2021/08/08/361/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Bolt is a pure Go key/value store inspired by Howard Chuâ€™s LMDB project. The goal of the project is to provide a simple, fast, and reliable database for projects that donâ€™t require a full database server such as Postgres or MySQL.</p></blockquote><p><a href="https://github.com/boltdb/bolt">bolt</a> æ˜¯ä¸€ä¸ªç®€å•çš„kvæ•°æ®åº“ï¼Œä½¿ç”¨åŠå…¶ç®€å•ï¼Œç›®å‰githubé¡¹ç›®å¤„äºåªè¯»çŠ¶æ€ã€‚</p><h2 id="æ•°æ®åº“è¿æ¥"><a href="#æ•°æ®åº“è¿æ¥" class="headerlink" title="æ•°æ®åº“è¿æ¥"></a>æ•°æ®åº“è¿æ¥</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;log&quot;</span><span class="hljs-string">&quot;github.com/boltdb/bolt&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæ–°å»ºæ–‡ä»¶</span>db, err := bolt.Open(<span class="hljs-string">&quot;sai.db&quot;</span>, <span class="hljs-number">0600</span>, <span class="hljs-literal">nil</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;<span class="hljs-keyword">defer</span> db.Close()...&#125;</code></pre></div><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// è¯»å†™</span>err := db.Update(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> &#123;...<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;)<span class="hljs-comment">// åªè¯»ï¼Œé‡Œé¢åªèƒ½è¿›è¡Œè¯»å–æ“ä½œ</span>err := db.View(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> &#123;...<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;)</code></pre></div><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªbucketï¼Œå¯ä»¥ç†è§£æˆä¸€ä¸ªtable</span>b, _ := tx.CreateBucketIfNotExists([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;sai0556&quot;</span>))<span class="hljs-comment">// æ–°å¢</span>b.Put([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;a&quot;</span>), []<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;11&quot;</span>))b.Put([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;b&quot;</span>), []<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;22&quot;</span>))<span class="hljs-comment">// å–</span>v := b.Get([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;a&quot;</span>))fmt.Printf(<span class="hljs-string">&quot;The a is: %s\n&quot;</span>, v)<span class="hljs-comment">// åˆ é™¤</span>b.Delete([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;a&quot;</span>))<span class="hljs-comment">// æ¸¸æ ‡éå†</span><span class="hljs-comment">/*</span><span class="hljs-comment">First()  Move to the first key.</span><span class="hljs-comment">Last()   Move to the last key.</span><span class="hljs-comment">Seek()   Move to a specific key.</span><span class="hljs-comment">Next()   Move to the next key.</span><span class="hljs-comment">Prev()   Move to the previous key</span><span class="hljs-comment">*/</span>c := b.Cursor()<span class="hljs-keyword">for</span> k, v := c.First(); k != <span class="hljs-literal">nil</span>; k, v = c.Next() &#123;    fmt.Printf(<span class="hljs-string">&quot;key=%s, value=%s\n&quot;</span>, k, v)&#125;<span class="hljs-comment">// ForEach éå†</span>b.ForEach(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(k, v []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">error</span></span> &#123;    fmt.Printf(<span class="hljs-string">&quot;key=%s, value=%s\n&quot;</span>, k, v)    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;)<span class="hljs-comment">// åˆ é™¤bucket</span>tx.DeleteBucket([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;sai0556&quot;</span>))</code></pre></div><p>ä½¿ç”¨å¾ˆç®€å•ï¼Œä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>åªè¯»Viewä¸­ï¼Œä¸èƒ½ä½¿ç”¨ç¼–è¾‘ã€åˆ é™¤ã€æ–°å¢ç­‰å†™æ“ä½œï¼Œä¼šäº§ç”Ÿé”™è¯¯</li><li>å› ä¸ºåº•å±‚ä½¿ç”¨äº†è¯»å†™é”ï¼Œè¿›è¡Œå†™æ“ä½œï¼Œè¦å°½å¯èƒ½å¿«ï¼Œæ›´ä¸è¦å¼€å¯é•¿äº‹åŠ¡ï¼Œä¼šé€ æˆé˜»å¡ï¼Œå½±å“æ€§èƒ½</li></ul><p>æ›´å¤šè¯´æ˜å¯å‚è€ƒï¼š</p><ul><li><a href="https://pkg.go.dev/github.com/boltdb/bolt@v1.3.1">https://pkg.go.dev/github.com/boltdb/bolt@v1.3.1</a></li><li><a href="https://github.com/boltdb/bolt">https://github.com/boltdb/bolt</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>db</category>
      
    </categories>
    
    
    <tags>
      
      <tag>boltdb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nsqåŸºç¡€çŸ¥è¯†ä¸ç®€å•demo</title>
    <link href="/2021/07/31/360/"/>
    <url>/2021/07/31/360/</url>
    
    <content type="html"><![CDATA[<h2 id="NSQ"><a href="#NSQ" class="headerlink" title="NSQ"></a>NSQ</h2><blockquote><p>A realtime distributed messaging platform</p></blockquote><h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><ul><li>åŸºäºgolang</li><li>åˆ†å¸ƒå¼</li><li>æ°´å¹³æ‰©å±•</li><li>è‡ªå¸¦UIï¼Œæ“ä½œå‹å¥½</li><li>å¤šè¯­è¨€client</li></ul><h3 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h3><table><thead><tr><th>ç»„ä»¶</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>nsqd</td><td>æ¥æ”¶ã€æ’é˜Ÿå’Œå‘å®¢æˆ·ç«¯ä¼ é€’æ¶ˆæ¯çš„å®ˆæŠ¤è¿›ç¨‹</td></tr><tr><td>nsqlookupd</td><td>ç®¡ç†æ‹“æ‰‘ä¿¡æ¯çš„å®ˆæŠ¤è¿›ç¨‹</td></tr><tr><td>nsqadmin</td><td>Web UIï¼Œç”¨äºå®æ—¶æŸ¥çœ‹èšåˆçš„é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯å¹¶æ‰§è¡Œå„ç§ç®¡ç†ä»»åŠ¡</td></tr><tr><td>utilities</td><td>å¸¸è§åŸºç¡€åŠŸèƒ½ã€æ•°æ®æµå¤„ç†å·¥å…·ï¼Œå¦‚nsq_statã€nsq_tailã€nsq_to_fileã€nsq_to_httpã€nsq_to_nsqã€to_nsq</td></tr></tbody></table><h4 id="nsqd"><a href="#nsqd" class="headerlink" title="nsqd"></a>nsqd</h4><p>å®ƒå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä½†é€šå¸¸ä¸nsqlookupd å®ä¾‹ä¸€èµ·é…ç½®åœ¨é›†ç¾¤ä¸­ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†å®£å¸ƒä¸»é¢˜å’Œé¢‘é“ä»¥ä¾›å‘ç°ï¼‰ã€‚</p><p>å®ƒä¾¦å¬ä¸¤ä¸ª TCP ç«¯å£ï¼Œä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯ï¼Œå¦ä¸€ä¸ªç”¨äº HTTP APIã€‚å®ƒå¯ä»¥é€‰æ‹©åœ¨ç¬¬ä¸‰ä¸ªç«¯å£ä¸Šä¾¦å¬ HTTPSã€‚</p><h4 id="nsqlookupd"><a href="#nsqlookupd" class="headerlink" title="nsqlookupd"></a>nsqlookupd</h4><p>æœ‰ä¸¤ä¸ªæ¥å£ï¼šnsqdç”¨äºå¹¿æ’­çš„TCP æ¥å£å’Œç”¨äºå®¢æˆ·ç«¯æ‰§è¡Œå‘ç°å’Œç®¡ç†æ“ä½œçš„ HTTP æ¥å£ã€‚</p><h2 id="MACå®‰è£…"><a href="#MACå®‰è£…" class="headerlink" title="MACå®‰è£…"></a>MACå®‰è£…</h2><blockquote><p>brew install nsq<br>nsqlookupd<br>nsqd â€“lookupd-tcp-address=127.0.0.1:4160 â€“broadcast-address=127.0.0.1<br>nsqadmin â€“lookupd-http-address=127.0.0.1:4161</p></blockquote><h2 id="go-nsq"><a href="#go-nsq" class="headerlink" title="go-nsq"></a>go-nsq</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// producer</span><span class="hljs-keyword">package</span> nsq<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;github.com/nsqio/go-nsq&quot;</span><span class="hljs-string">&quot;github.com/spf13/cast&quot;</span>)<span class="hljs-comment">// ä¸»å‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Send</span><span class="hljs-params">(ctx context.Context, cancel context.CancelFunc, topic <span class="hljs-keyword">string</span>)</span></span> &#123;<span class="hljs-keyword">defer</span> cancel()str := <span class="hljs-string">&quot;127.0.0.1:4150&quot;</span>fmt.Println(<span class="hljs-string">&quot;address: &quot;</span>, str)producer, err := nsq.NewProducer(str, nsq.NewConfig())<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;producer.SetLogger(<span class="hljs-literal">nil</span>, <span class="hljs-number">0</span>)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;msg := <span class="hljs-string">&quot;13sai, &quot;</span> + cast.ToString(i)fmt.Println(<span class="hljs-string">&quot;publish&quot;</span>, msg, producer.Publish(topic, []<span class="hljs-keyword">byte</span>(msg)))time.Sleep(time.Second * <span class="hljs-number">1</span>)&#125;&lt;-ctx.Done()producer.Stop()fmt.Println(<span class="hljs-string">&quot;producer exit&quot;</span>)&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// consumer</span><span class="hljs-keyword">package</span> nsq<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;github.com/nsqio/go-nsq&quot;</span>)<span class="hljs-comment">// æ¶ˆè´¹è€…</span><span class="hljs-keyword">type</span> Consumer <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// ä¸»å‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Receive</span><span class="hljs-params">(ctx context.Context, cancel context.CancelFunc, topic <span class="hljs-keyword">string</span>)</span></span> &#123;<span class="hljs-keyword">defer</span> cancel()<span class="hljs-comment">// address := &quot;127.0.0.1:4161&quot;</span>channel := topic + <span class="hljs-string">&quot;-channel&quot;</span>cfg := nsq.NewConfig()cfg.LookupdPollInterval = time.Second * <span class="hljs-number">2</span>c, err := nsq.NewConsumer(topic, channel, cfg)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;c.SetLogger(<span class="hljs-literal">nil</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">//å±è”½ç³»ç»Ÿæ—¥å¿—</span>c.AddConcurrentHandlers(&amp;Consumer&#123;&#125;, <span class="hljs-number">3</span>)<span class="hljs-comment">//å»ºç«‹NSQLookupdè¿æ¥</span><span class="hljs-comment">// if err := c.ConnectToNSQLookupd(address); err != nil &#123;</span><span class="hljs-comment">// panic(err)</span><span class="hljs-comment">// &#125;</span><span class="hljs-comment">//å»ºç«‹å¤šä¸ªnsqdè¿æ¥</span><span class="hljs-keyword">if</span> err := c.ConnectToNSQDs([]<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;127.0.0.1:4150&quot;</span>&#125;); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;&lt;-ctx.Done()c.Stop()fmt.Println(<span class="hljs-string">&quot;consumer exit&quot;</span>)&#125;<span class="hljs-comment">// å¤„ç†æ¶ˆæ¯</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*Consumer)</span> <span class="hljs-title">HandleMessage</span><span class="hljs-params">(msg *nsq.Message)</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">&quot;receive&quot;</span>, msg.NSQDAddress, <span class="hljs-string">&quot;message:&quot;</span>, <span class="hljs-keyword">string</span>(msg.Body))<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// nsq_test</span><span class="hljs-keyword">package</span> nsq<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;os&quot;</span><span class="hljs-string">&quot;os/signal&quot;</span><span class="hljs-string">&quot;syscall&quot;</span><span class="hljs-string">&quot;testing&quot;</span><span class="hljs-string">&quot;time&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestReceive</span><span class="hljs-params">(t *testing.T)</span></span> &#123;topic := <span class="hljs-string">&quot;sai0556&quot;</span>ctx, cancel := context.WithCancel(context.Background())<span class="hljs-keyword">defer</span> cancel()<span class="hljs-keyword">go</span> Send(ctx, cancel, topic)<span class="hljs-keyword">go</span> Receive(ctx, cancel, topic)sig := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal)signal.Notify(sig, syscall.SIGTERM, syscall.SIGINT)t.Log(<span class="hljs-string">&quot;å¼€å§‹ç›‘å¬&quot;</span>)<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-ctx.Done():t.Log(<span class="hljs-string">&quot;ctx done&quot;</span>)<span class="hljs-keyword">return</span><span class="hljs-keyword">case</span> &lt;-sig:t.Log(<span class="hljs-string">&quot;signal exit...&quot;</span>)cancel()time.Sleep(<span class="hljs-number">2</span> * time.Second)<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// send(topic)</span>&#125;</code></pre></div><p>æµ‹è¯•èµ°ä¸€æ³¢ï¼Œ</p><p><img src="/images/nsq.jpg" alt="nsq"></p><p>å¯¹äºNSQï¼Œè‡ªå·±ä¹Ÿæ˜¯åˆšåˆšä½¿ç”¨ï¼Œç»™æˆ‘çš„æ„Ÿè§‰æ˜¯ç›¸å½“å¥½ä¸Šæ‰‹ï¼Œä¹‹å‰æœ‰ç”¨è¿‡RabbitMQï¼Œnsqç›¸æ¯”æ¥è¯´æ›´ç®€å•ï¼Œå¯èƒ½æ˜¯go-clientç›¸å¯¹å¥½ç”¨ä¸€äº›å§ã€‚<br>åç»­æœ‰å…¶ä»–å€¼å¾—åˆ†äº«çš„ç‚¹å†ç»§ç»­è¡¥å……ã€‚å¦‚æœ‰éœ€è¦äº¤æµï¼Œå¯è”ç³»æˆ‘email/qqã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://nsq.io/">nsq</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nsq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VSCodeè°ƒè¯•goç¨‹åº</title>
    <link href="/2021/07/07/355/"/>
    <url>/2021/07/07/355/</url>
    
    <content type="html"><![CDATA[<p>åœ¨é¡¹ç›®ç›®å½•æ–°å»ºï¼Œ.vscode/launch.json</p><div class="code-wrapper"><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.2.0&quot;</span>, <span class="hljs-comment">// ç‰ˆæœ¬å¥½</span>  <span class="hljs-attr">&quot;configurations&quot;</span>: [      &#123;          <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;app&quot;</span>, <span class="hljs-comment">// åç§°</span>          <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;go&quot;</span>,          <span class="hljs-attr">&quot;request&quot;</span>: <span class="hljs-string">&quot;launch&quot;</span>,          <span class="hljs-attr">&quot;mode&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span>,          <span class="hljs-attr">&quot;program&quot;</span>: <span class="hljs-string">&quot;$&#123;cwd&#125;&quot;</span>,          <span class="hljs-attr">&quot;env&quot;</span>: &#123;<span class="hljs-attr">&quot;DebugEnv&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>&#125;, <span class="hljs-comment">// ç¯å¢ƒå˜é‡</span>          <span class="hljs-attr">&quot;args&quot;</span>: [<span class="hljs-string">&quot;--config&quot;</span>,<span class="hljs-string">&quot;./config-local.yaml&quot;</span>, <span class="hljs-string">&quot;--listen&quot;</span>, <span class="hljs-string">&quot;:8087&quot;</span>] <span class="hljs-comment">// å¯åŠ¨å‚æ•°</span>      &#125;  ]&#125;</code></pre></div><p>å¯¹äºprogram:</p><div class="code-wrapper"><pre><code class="hljs gams"><span class="hljs-symbol">$</span>&#123;workspaceRoot&#125; VSCodeå½“å‰æ‰“å¼€çš„æ–‡ä»¶å¤¹<span class="hljs-symbol">$</span>&#123;<span class="hljs-keyword">file</span>&#125; å½“å‰æ‰“å¼€çš„æ–‡ä»¶<span class="hljs-symbol">$</span>&#123;relativeFile&#125; ç›¸å¯¹äºworkspaceRootçš„ç›¸å¯¹è·¯å¾„<span class="hljs-symbol">$</span>&#123;fileBasename&#125; å½“å‰æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶å<span class="hljs-symbol">$</span>&#123;fileDirname&#125; æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œæ˜¯ç»å¯¹è·¯å¾„<span class="hljs-symbol">$</span>&#123;fileExtname&#125; å½“å‰æ‰“å¼€æ–‡ä»¶çš„æ‹“å±•åï¼Œå¦‚.json<span class="hljs-symbol">$</span>&#123;cwd&#125; å¯åŠ¨æ—¶ä»»åŠ¡è¿è¡Œç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•</code></pre></div><p>ç„¶åè¿è¡Œ-ã€‹å¯åŠ¨è°ƒè¯•ï¼Œå°±èƒ½è·‘èµ·æ¥äº†ï¼Œå¯ä»¥æ‰“æ–­ç‚¹è°ƒè¯•äº†ã€‚</p><p>æ–­ç‚¹ç‚¹å‡»ä»£ç è¡Œå·¦ä¾§å³å¯ï¼Œè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚</p><p><img src="/images/vscodeDebug.jpg" alt="vscodeDebug"></p>]]></content>
    
    
    <categories>
      
      <category>debug</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ConfigMapä½œä¸ºå®¹å™¨çš„é…ç½®æ–‡ä»¶</title>
    <link href="/2021/06/26/350/"/>
    <url>/2021/06/26/350/</url>
    
    <content type="html"><![CDATA[<h2 id="æ„å»ºdemoé•œåƒ"><a href="#æ„å»ºdemoé•œåƒ" class="headerlink" title="æ„å»ºdemoé•œåƒ"></a>æ„å»ºdemoé•œåƒ</h2><p>è‡ªå·±åˆ¶ä½œä¸ªé•œåƒæ–¹ä¾¿æµ‹è¯•ã€‚</p><blockquote><p>go mod init k8s-configmap-demo</p></blockquote><p>main.go</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;net/http&quot;</span><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><span class="hljs-string">&quot;github.com/spf13/pflag&quot;</span><span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>)<span class="hljs-keyword">var</span> (conf = pflag.StringP(<span class="hljs-string">&quot;config&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;config filepath&quot;</span>))<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;Name <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// å¯¹å¤–çš„åˆå§‹åŒ–é…ç½®æ–¹æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">configRun</span><span class="hljs-params">(cfg <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;c := Config&#123;Name: cfg,&#125;<span class="hljs-keyword">if</span> err := c.init(); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Config)</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> c.Name != <span class="hljs-string">&quot;&quot;</span> &#123;viper.SetConfigFile(c.Name)&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯./config.yaml</span>viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)&#125;viper.SetConfigType(<span class="hljs-string">&quot;yaml&quot;</span>)<span class="hljs-comment">// viperè§£æé…ç½®æ–‡ä»¶</span>err := viper.ReadInConfig() <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(fmt.Errorf(<span class="hljs-string">&quot;Fatal error config file: %s \n&quot;</span>, err))&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;pflag.Parse()<span class="hljs-comment">// åˆå§‹åŒ–é…ç½®</span><span class="hljs-keyword">if</span> err := configRun(*conf); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;gin.SetMode(viper.GetString(<span class="hljs-string">&quot;mode&quot;</span>))g := gin.New()g = LoadRoute(g)g.Run(viper.GetString(<span class="hljs-string">&quot;addr&quot;</span>))&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadRoute</span><span class="hljs-params">(g *gin.Engine)</span> *<span class="hljs-title">gin</span>.<span class="hljs-title">Engine</span></span> &#123;g.Use(gin.Recovery())<span class="hljs-comment">// 404</span>g.NoRoute(<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *gin.Context)</span></span>  &#123;c.String(http.StatusNotFound, <span class="hljs-string">&quot;404 not found&quot;</span>);&#125;)g.GET(<span class="hljs-string">&quot;/&quot;</span>, Index)<span class="hljs-keyword">return</span> g&#125;<span class="hljs-comment">// è¿”å›</span><span class="hljs-keyword">type</span> Response <span class="hljs-keyword">struct</span> &#123;Code <span class="hljs-keyword">int</span> <span class="hljs-string">`json:&quot;code&quot;`</span>Message <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;message&quot;`</span>Data <span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-string">`json:&quot;data&quot;`</span>&#125;<span class="hljs-comment">// apiè¿”å›ç»“æ„</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ApiResponse</span><span class="hljs-params">(c *gin.Context, code <span class="hljs-keyword">int</span>, message <span class="hljs-keyword">string</span>, data <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;c.JSON(http.StatusOK, Response&#123;Code: code,Message: message,Data: data,&#125;)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Index</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;ApiResponse(c, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;success&quot;</span>, viper.GetString(<span class="hljs-string">&quot;hi&quot;</span>))&#125;</code></pre></div><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œè¯»å–config,è¿è¡Œä¸€ä¸ªgin httpæœåŠ¡ï¼Œè¿”å›é…ç½®é¡¹[hi]çš„å­—ç¬¦ä¸²ã€‚</p><p>config.yaml</p><div class="code-wrapper"><pre><code class="hljs avrasm"><span class="hljs-symbol">name:</span> demo2<span class="hljs-symbol">mode:</span> debug<span class="hljs-symbol">addr:</span> :<span class="hljs-number">8080</span><span class="hljs-symbol">hi:</span> w~o~w</code></pre></div><p>Dockerfile</p><div class="code-wrapper"><pre><code class="hljs Do">FROM golang:alpine <span class="hljs-keyword">AS</span> builderENV CGO_ENABLED 0ENV GOPROXY https:<span class="hljs-comment">//goproxy.cn,direct</span>WORKDIR /<span class="hljs-keyword">app</span>ADD go.mod .ADD go.<span class="hljs-keyword">sum</span> .<span class="hljs-keyword">RUN</span> go mod download<span class="hljs-keyword">COPY</span> main.go .<span class="hljs-keyword">RUN</span> go build -o 13sai main.goFROM alpineWORKDIR /<span class="hljs-keyword">app</span><span class="hljs-keyword">COPY</span> --from=builder /<span class="hljs-keyword">app</span>/13sai /<span class="hljs-keyword">app</span>/13saiADD config.yaml .CMD [<span class="hljs-string">&quot;./13sai&quot;</span>]</code></pre></div><p>æ„å»ºï¼š</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> build -t k<span class="hljs-number">8</span>s-configmap-demo:<span class="hljs-number">0</span>.<span class="hljs-number">2</span> .<span class="hljs-attribute">docker</span> tag k<span class="hljs-number">8</span>s-configmap-demo:<span class="hljs-number">0</span>.<span class="hljs-number">2</span> <span class="hljs-number">13</span>sai/k<span class="hljs-number">8</span>s-configmap-demo:<span class="hljs-number">0</span>.<span class="hljs-number">2</span></code></pre></div><h3 id="æäº¤é•œåƒåˆ°hub"><a href="#æäº¤é•œåƒåˆ°hub" class="headerlink" title="æäº¤é•œåƒåˆ°hub"></a>æäº¤é•œåƒåˆ°hub</h3><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> login<span class="hljs-attribute">docker</span> push <span class="hljs-number">13</span>sai/k<span class="hljs-number">8</span>s-configmap-demo:<span class="hljs-number">0</span>.<span class="hljs-number">2</span></code></pre></div><blockquote><p>k8sçš„é…ç½®æˆ‘ä½¿ç”¨çš„æ˜¯Kuboardï¼Œä¸‹é¢çš„æ“ä½œéƒ½æ˜¯åœ¨Kuboardæ‰§è¡Œ</p></blockquote><h3 id="ConfigMapé…ç½®"><a href="#ConfigMapé…ç½®" class="headerlink" title="ConfigMapé…ç½®"></a>ConfigMapé…ç½®</h3><h4 id="åˆ›å»ºConfigMap"><a href="#åˆ›å»ºConfigMap" class="headerlink" title="åˆ›å»ºConfigMap:"></a>åˆ›å»ºConfigMap:</h4><p>è¿›å…¥defaultç©ºé—´ &gt; èµ„æº &gt; é…ç½®å­—å…¸ï¼š</p><table><thead><tr><th>åç§°</th><th>sai</th></tr></thead><tbody><tr><td>é…ç½®æ•°æ®åç§°</td><td>config.yaml</td></tr><tr><td>é…ç½®å†…å®¹</td><td>config.yamlé‡Œçš„å†…å®¹</td></tr></tbody></table><h4 id="åˆ›å»ºè´Ÿè½½"><a href="#åˆ›å»ºè´Ÿè½½" class="headerlink" title="åˆ›å»ºè´Ÿè½½"></a>åˆ›å»ºè´Ÿè½½</h4><p>é…ç½®å¯å‚ç…§ä¸‹é¢æˆªå›¾ï¼Œæ³¨æ„å‡ å¤„ï¼š</p><ul><li>æ•°æ®å· Volumeï¼Œé€‰æ‹©configMap</li><li>è¿è¡Œå®¹å™¨ç»„podçš„Commandå’ŒæŒ‚è½½ç‚¹</li></ul><p><img src="/images/post/config1.jpg" alt="è´Ÿè½½é…ç½®"></p><p>ä¿å­˜åå³å¯ã€‚</p><p><img src="/images/post/crd.jpg" alt="crd"></p><p>æœ€åè´´å‡ºç”Ÿæˆçš„yamlæ–‡ä»¶</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><span class="hljs-attr">metadata:</span> <span class="hljs-comment"># å…ƒæ•°æ®ï¼Œå®šä¹‰åŸºæœ¬å±æ€§å’Œä¿¡æ¯</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai-config</span> <span class="hljs-comment"># åç§°</span><span class="hljs-attr">data:</span>  <span class="hljs-attr">config.yaml:</span> <span class="hljs-string">|-</span><span class="hljs-string">    name: sai0556</span><span class="hljs-string">    mode: debug</span><span class="hljs-string">    addr: :8080</span><span class="hljs-string">    hi: w~o~w</span><span class="hljs-string"></span><span class="hljs-meta">---</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span>  <span class="hljs-attr">labels:</span> <span class="hljs-comment"># æ ‡ç­¾</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span><span class="hljs-attr">spec:</span> <span class="hljs-comment"># æè¿°</span>  <span class="hljs-attr">ports:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>  <span class="hljs-attr">selector:</span>    <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span><span class="hljs-meta">---</span><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><span class="hljs-attr">metadata:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span><span class="hljs-attr">spec:</span>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># åˆ›å»ºåº”ç”¨ç¨‹åºå®ä¾‹ä¸ªæ•°</span>  <span class="hljs-attr">selector:</span> <span class="hljs-comment"># æ ‡ç­¾é€‰æ‹©å™¨</span>    <span class="hljs-attr">matchLabels:</span> <span class="hljs-comment"># é€‰æ‹©åŒ…å«æ ‡ç­¾app:saiçš„èµ„æº</span>      <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span>  <span class="hljs-attr">template:</span> <span class="hljs-comment"># æ¨¡æ¿</span>    <span class="hljs-attr">metadata:</span>      <span class="hljs-attr">labels:</span>        <span class="hljs-attr">app:</span> <span class="hljs-string">sai</span>    <span class="hljs-attr">spec:</span>      <span class="hljs-attr">containers:</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sai</span>        <span class="hljs-attr">image:</span> <span class="hljs-string">13sai/k8s-configmap-demo:0.2</span>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>        <span class="hljs-attr">command:</span>          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;/app/13sai&#x27;</span>        <span class="hljs-attr">volumeMounts:</span>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config</span>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/app/config.yaml</span>            <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span>            <span class="hljs-attr">subPath:</span> <span class="hljs-string">config.yaml</span>      <span class="hljs-attr">volumes:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config</span>          <span class="hljs-attr">configMap:</span>            <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">0600</span>            <span class="hljs-attr">name:</span> <span class="hljs-string">sai-config</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢†åŸŸé©±åŠ¨è®¾è®¡</title>
    <link href="/2021/06/10/345/"/>
    <url>/2021/06/10/345/</url>
    
    <content type="html"><![CDATA[<p>é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain Driven Designï¼‰çš„æ¦‚å¿µå‡ºç°äº 2003 å¹´ï¼Œä¸æ•æ·ç›¸æ¯”ï¼ŒDDD åœ¨æå‡ºä¹‹åçš„å¾ˆå¤šå¹´éƒ½æ²¡æœ‰ç§°å¾—ä¸Šâ€œæµè¡Œâ€ï¼Œç”šè‡³è¯´ä»æœªçœŸæ­£æµè¡Œè¿‡ã€‚ä¸€éƒ¨åˆ†æ˜¯å› ä¸º DDD æ¶‰åŠäº†ä¸€äº›æ–°çš„åè¯å’Œæ¦‚å¿µï¼ˆæ¯”å¦‚èšåˆã€é™ç•Œä¸Šä¸‹æ–‡å’Œé¢†åŸŸç­‰ï¼‰ï¼Œåœ¨ç¼ºä¹å…·ä½“å®è·µæ¡ˆä¾‹çš„åœºæ™¯ä¸‹ï¼Œè¾ƒéš¾ç†è§£è¿™äº›æŠ½è±¡æ¦‚å¿µï¼Œè¿™å¯¼è‡´äº†å­¦ä¹ å’Œåº”ç”¨ DDD çš„åˆæœŸé˜¶æ®µå°±å˜å¾—ä¸å¤ªé¡ºç•…ï¼Œå¼€å‘äººå‘˜å¯èƒ½å¹¶ä¸èƒ½é¢†ä¼šåˆ°å…¶ä¸­çš„è®¾è®¡æ€æƒ³åŠå…¶å¸¦æ¥çš„ä»·å€¼ã€‚ä½†æ˜¯åœ¨å°èŒƒå›´ç¾¤ä½“å†…ï¼Œé€æ¸æœ‰ä¸€æ‰¹å·¥ç¨‹å¸ˆå¼€å§‹èƒ½å¤ŸæŒæ§è¿™ç§å»ºæ¨¡æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ DDD æ¥è®¾è®¡å‡ºå…·æœ‰è¾ƒé«˜ä¸šåŠ¡å¤æ‚æ€§çš„è½¯ä»¶åº”ç”¨ã€‚</p><p>2013å¹´åï¼Œåˆ†å¸ƒå¼çš„åŸºç¡€è®¾æ–½é€æ¸æˆç†Ÿã€‚Martin Fowler äº 2014 å¹´å‘è¡¨äº†ç³»ç»Ÿé˜è¿°å¾®æœåŠ¡çš„æ–‡ç« ï¼Œå¾®æœåŠ¡æ¶æ„å¼€å§‹å…´èµ·ã€‚è½¯ä»¶å·¥ç¨‹å¸ˆä»¬å‘ç°å°†å•ä½“åº”ç”¨é‡‡ç”¨å¾®æœåŠ¡æ¶æ„è¿›è¡Œåˆ’åˆ†éœ€è¦å¤§é‡çš„å®è·µç»éªŒå’Œç†è®ºåŸºç¡€ä½œæŒ‡å¯¼ï¼Œå¦åˆ™ä¸èƒ½å®Œå…¨ä½“ç°å¾®æœåŠ¡æ¶æ„æ‰€å¸¦æ¥çš„ä¼˜åŠ¿ã€‚ä¸è¿‡æ—©æœŸç†Ÿæ‚‰ DDD æ€æƒ³çš„å¼€å‘è€…å‘ç°ï¼ŒDDD å¯ä»¥æœ‰æ•ˆåœ°æ ¹æ®ä¸šåŠ¡å¯¹å¤æ‚è½¯ä»¶ç³»ç»Ÿè¿›è¡Œæ‹†è§£ï¼Œå¾®æœåŠ¡æ¶æ„ä¸ DDD ç›¸å¾—ç›Šå½°ã€‚æŒ‰ç…§è½¯ä»¶å·¥ç¨‹çš„æ€æƒ³ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¾®æœåŠ¡æ—¶ï¼Œéœ€è¦æ»¡è¶³é«˜å†…èšã€ä½è€¦åˆçš„è¦æ±‚ã€‚è€Œæ ¹æ® DDD çš„æ€æƒ³ï¼Œå¯ä»¥å°†é™ç•Œä¸Šä¸‹æ–‡ä¸å¾®æœåŠ¡è¿›ç¨‹å¯¹åº”èµ·æ¥ã€‚DDD ä¸­é™ç•Œä¸Šä¸‹æ–‡çš„æ¦‚å¿µå¾ˆå¥‘åˆåŒ¹é…å¾®æœåŠ¡è¦æ±‚ï¼Œè¿™ä¸¤è€…éƒ½å¼ºè°ƒä»ä¸šåŠ¡è§’åº¦è¿›è¡Œåˆ’åˆ†ï¼Œä»¥åº”å¯¹æ—¥ç›Šå¤æ‚çš„è½¯ä»¶ç³»ç»Ÿã€‚ç”±æ­¤ï¼ŒDDD è¿æ¥äº†å®ƒçš„é«˜é€Ÿå‘å±•å’Œæ¨å¹¿æ—¶æœŸã€‚</p><p>DDD ä¸æ˜¯è¯­è¨€ï¼Œä¸æ˜¯æ¡†æ¶ï¼Œä¸æ˜¯æ¶æ„ï¼Œè€Œæ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸€ç§æ–¹æ³•è®ºï¼Œå®ƒå¯ä»¥åˆ†ç¦»ä¸šåŠ¡å¤æ‚åº¦å’ŒæŠ€æœ¯å¤æ‚åº¦ï¼›DDD ä¹Ÿå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„äº‹ç‰©ï¼Œå®ƒæ˜¯é¢å‘å¯¹è±¡çš„æå‡ï¼Œæœ€ç»ˆç›®æ ‡è¿˜æ˜¯<strong>é«˜å†…èšã€ä½è€¦åˆ</strong>ã€‚</p><p>Eric Evansåœ¨ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ä¸€ä¹¦ä¸­ï¼Œæå‡ºäº†ç»å…¸çš„å››å±‚æ¶æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://images0.cnblogs.com/blog/503745/201311/05143440-6c435a190e634ef6a474815d5a741ac0.gif" alt="DDDé¢†åŸŸåˆ†å±‚"></p><ul><li>ç”¨æˆ·ç•Œé¢User Interface<br>è´Ÿè´£ç»™ç”¨æˆ·å±•ç¤ºä¿¡æ¯ï¼Œå¹¶è§£é‡Šç”¨æˆ·å‘½ä»¤ã€‚</li><li>åº”ç”¨å±‚Application<br>è´Ÿè´£åè°ƒåº”ç”¨ç¨‹åºçš„æ´»åŠ¨ã€‚ä¸åŒ…æ‹¬ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¿å­˜ä¸šåŠ¡å¯¹è±¡çš„çŠ¶æ€ï¼Œä½†èƒ½ä¿å­˜åº”ç”¨ç¨‹åºä»»åŠ¡è¿‡ç¨‹çš„çŠ¶æ€ã€‚</li><li>é¢†åŸŸå±‚Domain<br>è´Ÿè´£ä¸šåŠ¡é¢†åŸŸçš„ä¿¡æ¯å’ŒçŠ¶æ€çš„ä¿å­˜å’Œç»´æŠ¤ã€‚ä¸šåŠ¡å¯¹è±¡çš„æŒä¹…åŒ–å’Œå®ƒä»¬çš„çŠ¶æ€å¯èƒ½ä¼šå§”æ‰˜ç»™åŸºç¡€è®¾æ–½å±‚ã€‚</li><li>åŸºç¡€è®¾æ–½å±‚Infrastructure<br>è´Ÿè´£æ”¯æŒå…¶ä»–å±‚æ¬¡ï¼Œæä¾›åŸºç¡€çš„æ¶ˆæ¯ä¼ é€’ã€æ•°æ®æŒä¹…åŒ–ç­‰åŠŸèƒ½ã€‚å®ƒæä¾›å±‚ä¹‹é—´çš„ä¿¡æ¯ä¼ é€’ï¼Œå®ç°ä¸šåŠ¡å¯¹è±¡çš„æŒä¹…åŒ–ï¼ŒåŒ…å«å¯¹ç”¨æˆ·ç•Œé¢å±‚çš„æ”¯æŒæ€§åº“ç­‰ã€‚</li></ul><p>æˆ‘ä»¬ä»¥è´­ç‰©è½¦ä¸‹è®¢å•åŠŸèƒ½ä¸ºä¾‹æ¥è§£é‡Šè¿™å„ä¸ªå±‚é¢çš„ä½œç”¨ï¼š</p><ul><li>ç”¨æˆ·ç•Œé¢å±‚æä¾›ä¸‹å•çš„æ¥å£</li><li>åº”ç”¨å±‚è´Ÿè´£é€»è¾‘çš„æ•´åˆï¼Œå¦‚è´­ç‰©è½¦æ¸…ç©ºã€æ£€æŸ¥åº“å­˜ç­‰</li><li>é¢†åŸŸå±‚å°†è´­ç‰©è½¦ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘å°è£…åˆ°ä¸€ä¸ª ShoppingCar å¯¹è±¡ä¸­ï¼Œè°ƒç”¨ shoppingCar.orderä¸‹è®¢å•ï¼Œä¸šåŠ¡æœåŠ¡çš„é‡å¿ƒä»ç”Ÿæˆè®¢å•è¡¨ä¸­çš„è®°å½•è½¬ç§»åˆ°è´­ç‰©è½¦å¯¹è±¡æœ¬èº«</li><li>åº•å±‚æ•°æ®åº“ä¸­å¦‚ä½•ç”Ÿæˆè¿™æ¡è®°å½•å¹¶ä¸å±äºæˆ‘ä»¬çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè¿™å¯¹åº” DDD ä¸­çš„åŸºç¡€è®¾æ–½å±‚ï¼Œç”± Repository æˆ–è€… Dao ç­‰æ•°æ®äº¤äº’å¯¹è±¡è´Ÿè´£å»æŒä¹…åŒ–æˆ‘ä»¬å¯¹é¢†åŸŸæ¨¡å‹ä¸‹è¾¾çš„æŒ‡ä»¤æ‰€äº§ç”Ÿçš„æ•°æ®åº“å˜åŒ–ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>design</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DDD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Protobufè¯­æ³•</title>
    <link href="/2021/05/27/340/"/>
    <url>/2021/05/27/340/</url>
    
    <content type="html"><![CDATA[<p>Protobufæ˜¯Protocol Bufferçš„ç®€ç§°ï¼Œå®ƒæ˜¯Googleå…¬å¸å¼€å‘çš„ä¸€ç§æ•°æ®æè¿°è¯­è¨€ï¼Œç”¨äºæè¿°ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®æ ¼å¼ï¼Œå¹³å°æ— å…³ã€è¯­è¨€æ— å…³ã€å¯æ‰©å±•ï¼Œå¸¸ç”¨äºRPCç³»ç»Ÿå’ŒæŒç»­æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚</p><h2 id="å­—æ®µè§„åˆ™"><a href="#å­—æ®µè§„åˆ™" class="headerlink" title="å­—æ®µè§„åˆ™"></a>å­—æ®µè§„åˆ™</h2><h3 id="å­—æ®µæ ¼å¼"><a href="#å­—æ®µæ ¼å¼" class="headerlink" title="å­—æ®µæ ¼å¼"></a>å­—æ®µæ ¼å¼</h3><blockquote><p>é™å®šä¿®é¥°ç¬¦ | æ•°æ®ç±»å‹ | å­—æ®µåç§° | = | å­—æ®µç¼–ç å€¼ | [å­—æ®µé»˜è®¤å€¼]</p></blockquote><h3 id="é™å®šä¿®é¥°ç¬¦"><a href="#é™å®šä¿®é¥°ç¬¦" class="headerlink" title="é™å®šä¿®é¥°ç¬¦"></a>é™å®šä¿®é¥°ç¬¦</h3><blockquote><p>requiredã€optionalã€repeated</p></blockquote><ul><li>Requiredï¼šè¡¨ç¤ºæ˜¯ä¸€ä¸ªå¿…é¡»å­—æ®µ</li><li>Optionalï¼šè¡¨ç¤ºä¸€ä¸ªå¯é€‰å­—æ®µã€‚å¯¹äºæ¥æ”¶æ–¹ï¼Œå¦‚æœèƒ½å¤Ÿè¯†åˆ«å¯é€‰å­—æ®µå°±è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚æœæ— æ³•è¯†åˆ«ï¼Œåˆ™å¿½ç•¥è¯¥å­—æ®µ</li><li>Repeatedï¼šè¡¨ç¤ºè¯¥å­—æ®µå¯ä»¥åŒ…å«0-Nä¸ªå…ƒç´ ã€‚å…¶ä¸­ç‰¹æ€§å’Œoptionalä¸€æ ·ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡å¯ä»¥åŒ…å«å¤šä¸ªå€¼ã€‚å¯ä»¥çœ‹åšæ˜¯åœ¨ä¼ é€’ä¸€ä¸ªæ•°ç»„çš„å€¼</li></ul><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>Protobufå®šä¹‰äº†ä¸€å¥—åŸºæœ¬æ•°æ®ç±»å‹ï¼š</p><table><thead><tr><th>.proto ç±»å‹</th><th>Notes</th><th>C++ Type</th><th>Java Type</th><th>Python Type</th><th>Go Type</th><th>Ruby Type</th><th>C# Type</th><th>PHP Type</th><th>Dart Type</th></tr></thead><tbody><tr><td>double</td><td></td><td>double</td><td>double</td><td>float</td><td>float64</td><td>Float</td><td>double</td><td>float</td><td>double</td></tr><tr><td>float</td><td></td><td>float</td><td>float</td><td>float</td><td>float32</td><td>Float</td><td>float</td><td>float</td><td>double</td></tr><tr><td>int32</td><td>ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç¼–ç è´Ÿæ•°çš„æ•ˆç‡ä½ - å¦‚æœæ‚¨çš„å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨sint32ã€‚</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>int</td></tr><tr><td>int64</td><td>ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç¼–ç è´Ÿæ•°çš„æ•ˆç‡ä½ - å¦‚æœæ‚¨çš„å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨sint64ã€‚</td><td>int64</td><td>long</td><td>int/long[]</td><td>int64</td><td>Bignum</td><td>long</td><td>integer/string[]</td><td>Int64</td></tr><tr><td>uint32</td><td>ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç </td><td>uint32</td><td>int</td><td>int/long</td><td>uint32</td><td>Fixnum or Bignum (as required)</td><td>uint</td><td>integer</td><td>int</td></tr><tr><td>uint64</td><td>ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç .</td><td>uint64</td><td>long</td><td>int/long</td><td>uint64</td><td>Bignum</td><td>ulong</td><td>integer/string[]</td><td>Int64</td></tr><tr><td>sint32</td><td>ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç­¾åçš„intå€¼ã€‚è¿™äº›æ¯”å¸¸è§„int32æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°ã€‚</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>int</td></tr><tr><td>sint64</td><td>ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç­¾åçš„intå€¼ã€‚è¿™äº›æ¯”å¸¸è§„int64æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°ã€‚</td><td>int64</td><td>long</td><td>int/long</td><td>int64</td><td>Bignum</td><td>long</td><td>integer/string[]</td><td>Int64</td></tr><tr><td>fixed32</td><td>æ€»æ˜¯å››ä¸ªå­—èŠ‚ã€‚å¦‚æœå€¼é€šå¸¸å¤§äº228ï¼Œåˆ™æ¯”uint32æ›´æœ‰æ•ˆã€‚</td><td>uint32</td><td>int</td><td>int/long</td><td>uint32</td><td>Fixnum or Bignum (as required)</td><td>uint</td><td>integer</td><td>int</td></tr><tr><td>fixed64</td><td>æ€»æ˜¯å…«ä¸ªå­—èŠ‚ã€‚å¦‚æœå€¼é€šå¸¸å¤§äº256ï¼Œåˆ™æ¯”uint64æ›´æœ‰æ•ˆ</td><td>uint64</td><td>long</td><td>int/long[]</td><td>uint64</td><td>Bignum</td><td>ulong</td><td>integer/string[]</td><td>Int64</td></tr><tr><td>sfixed32</td><td>æ€»æ˜¯å››ä¸ªå­—èŠ‚</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>int</td></tr><tr><td>sfixed64</td><td>æ€»æ˜¯å…«ä¸ªå­—èŠ‚</td><td>int64</td><td>long</td><td>int/long</td><td>int64</td><td>Bignum</td><td>long</td><td>integer/string[]</td><td>Int64</td></tr><tr><td>bool</td><td></td><td>bool</td><td>boolean</td><td>bool</td><td>bool</td><td>TrueClass/FalseClass</td><td>bool</td><td>boolean</td><td>bool</td></tr><tr><td>string</td><td>å­—ç¬¦ä¸²å¿…é¡»å§‹ç»ˆåŒ…å«UTF-8ç¼–ç æˆ–7ä½ASCIIæ–‡æœ¬ï¼Œä¸”ä¸èƒ½è¶…è¿‡232ã€‚</td><td>string</td><td>String</td><td>str/unicode</td><td>string</td><td>String (UTF-8)</td><td>string</td><td>string</td><td>String</td></tr><tr><td>bytes</td><td>å¯ä»¥åŒ…å«ä¸è¶…è¿‡232çš„ä»»æ„å­—èŠ‚åºåˆ—ã€‚</td><td>string</td><td>ByteString</td><td>str</td><td>[]byte</td><td>String (ASCII-8BIT)</td><td>ByteString</td><td>string</td><td>List<int></td></tr></tbody></table><h3 id="å­—æ®µåç§°"><a href="#å­—æ®µåç§°" class="headerlink" title="å­—æ®µåç§°"></a>å­—æ®µåç§°</h3><p>å­—æ®µåç§°çš„å‘½åä¸Cã€Javaç­‰è¯­è¨€çš„å˜é‡å‘½åæ–¹å¼å‡ ä¹æ˜¯ç›¸åŒçš„<br>protobuf å»ºè®®å­—æ®µçš„å‘½åé‡‡ç”¨ä»¥ä¸‹åˆ’çº¿åˆ†éš”çš„é©¼å³°å¼</p><h3 id="å­—æ®µç¼–ç å€¼"><a href="#å­—æ®µç¼–ç å€¼" class="headerlink" title="å­—æ®µç¼–ç å€¼"></a>å­—æ®µç¼–ç å€¼</h3><p>æœ‰äº†è¯¥å€¼ï¼Œé€šä¿¡åŒæ–¹æ‰èƒ½äº’ç›¸è¯†åˆ«å¯¹æ–¹çš„å­—æ®µï¼Œç›¸åŒçš„ç¼–ç å€¼ï¼Œå…¶é™å®šä¿®é¥°ç¬¦å’Œæ•°æ®ç±»å‹å¿…é¡»ç›¸åŒï¼Œç¼–ç å€¼çš„å–å€¼èŒƒå›´ä¸ºï¼š1 ~ 2^32 (4294967296)<br>å…¶ä¸­ 1 ~ 15çš„ç¼–ç æ—¶é—´å’Œç©ºé—´æ•ˆç‡éƒ½æ˜¯æœ€é«˜çš„ï¼Œç¼–ç å€¼è¶Šå¤§ï¼Œå…¶ç¼–ç çš„æ—¶é—´å’Œç©ºé—´æ•ˆç‡å°±è¶Šä½<br>1900 ~ 2000 ç¼–ç å€¼ä¸º Google protobuf ç³»ç»Ÿå†…éƒ¨ä¿ç•™å€¼ï¼Œå»ºè®®ä¸è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨</p><h3 id="å­—æ®µé»˜è®¤å€¼"><a href="#å­—æ®µé»˜è®¤å€¼" class="headerlink" title="å­—æ®µé»˜è®¤å€¼"></a>å­—æ®µé»˜è®¤å€¼</h3><p>å½“åœ¨ä¼ é€’æ•°æ®æ—¶ï¼Œå¯¹äºrequiredæ•°æ®ç±»å‹ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è®¾ç½®å€¼ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ä¼ é€’åˆ°å¯¹ç«¯</p><h2 id="å®šä¹‰service"><a href="#å®šä¹‰service" class="headerlink" title="å®šä¹‰service"></a>å®šä¹‰service</h2><ul><li>å¦‚æœæƒ³è¦å°†æ¶ˆæ¯ç±»å‹ç”¨åœ¨ RPC ç³»ç»Ÿä¸­ï¼Œå¯ä»¥åœ¨ <code>.proto</code>æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª RPC æœåŠ¡æ¥å£ï¼Œprotocol buffer ç¼–è¯‘å™¨ä¼šæ ¹æ®æ‰€é€‰æ‹©çš„ä¸åŒè¯­è¨€ç”ŸæˆæœåŠ¡æ¥å£ä»£ç </li><li>ç”Ÿæˆçš„æ¥å£ä»£ç ä½œä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„çº¦å®šï¼ŒæœåŠ¡ç«¯å¿…é¡»å®ç°å®šä¹‰çš„æ‰€æœ‰æ¥å£æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨åŒåæ–¹æ³•å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼ˆå³ä¾¿ä¸šåŠ¡ä¸Šä¸éœ€è¦å‚æ•°ä¹Ÿå¿…é¡»æŒ‡å®šä¸€ä¸ªè¯·æ±‚æ¶ˆæ¯ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ä¸€ä¸ªç©ºmessageï¼‰</li></ul><p>æ¯”å¦‚ï¼Œæƒ³è¦å®šä¹‰ä¸€ä¸ª RPC æœåŠ¡å¹¶å…·æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ SearchRequest å¹¶è¿”å›ä¸€ä¸ª SearchResponseï¼Œæ­¤æ—¶å¯ä»¥åœ¨<code>.proto</code>æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š</p><div class="code-wrapper"><pre><code class="hljs protobuf"><span class="hljs-class"><span class="hljs-keyword">service</span> <span class="hljs-title">SearchService</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">rpc</span> Search(SearchRequest) <span class="hljs-keyword">returns</span> (SearchResponse) </span>&#123;&#125;&#125;</code></pre></div><h2 id="å®šä¹‰Message"><a href="#å®šä¹‰Message" class="headerlink" title="å®šä¹‰Message"></a>å®šä¹‰Message</h2><ul><li>ä¸€ä¸ª message ç±»å‹å®šä¹‰æè¿°äº†ä¸€ä¸ªè¯·æ±‚æˆ–å“åº”çš„æ¶ˆæ¯æ ¼å¼ï¼Œå¯ä»¥åŒ…å«å¤šç§ç±»å‹å­—æ®µ</li><li>å­—æ®µåç”¨å°å†™ï¼Œè½¬ä¸º go æ–‡ä»¶åè‡ªåŠ¨å˜ä¸ºå¤§å†™ï¼Œmessage å°±ç›¸å½“äºç»“æ„ä½“</li></ul><h3 id="æ·»åŠ æ›´å¤š-Message-ç±»å‹"><a href="#æ·»åŠ æ›´å¤š-Message-ç±»å‹" class="headerlink" title="æ·»åŠ æ›´å¤š Message ç±»å‹"></a>æ·»åŠ æ›´å¤š Message ç±»å‹</h3><p>ä¸€ä¸ª .proto æ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ¶ˆæ¯ç±»å‹ï¼Œä¸€èˆ¬ç”¨äºåŒæ—¶å®šä¹‰å¤šä¸ªç›¸å…³çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚åœ¨åŒä¸€ä¸ª .proto æ–‡ä»¶ä¸­åŒæ—¶å®šä¹‰æœç´¢è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ï¼š</p><div class="code-wrapper"><pre><code class="hljs protobuf"><span class="hljs-comment">// å£°æ˜ä½¿ç”¨çš„ protobuf ç‰ˆæœ¬</span>syntax = <span class="hljs-string">&quot;proto3&quot;</span><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchRequest</span> </span>&#123;<span class="hljs-built_in">string</span> query = <span class="hljs-number">1</span>;<span class="hljs-built_in">int32</span> page_number = <span class="hljs-number">2</span>;<span class="hljs-built_in">int32</span> result_per_page = ;&#125;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchResponse</span> </span>&#123;&#125;</code></pre></div><h3 id="ä½¿ç”¨å…¶ä»–-Message"><a href="#ä½¿ç”¨å…¶ä»–-Message" class="headerlink" title="ä½¿ç”¨å…¶ä»– Message"></a>ä½¿ç”¨å…¶ä»– Message</h3><p>message æ”¯æŒåµŒå¥—ä½¿ç”¨ï¼Œä½œä¸ºå¦ä¸€ä¸ª message ä¸­çš„å­—æ®µç±»å‹</p><div class="code-wrapper"><pre><code class="hljs protobuf"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchResponse</span> </span>&#123;<span class="hljs-keyword">repeated</span> Result results = <span class="hljs-number">1</span>;&#125;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Result</span> </span>&#123;<span class="hljs-built_in">string</span> url = <span class="hljs-number">1</span>;<span class="hljs-built_in">string</span> title = <span class="hljs-number">2</span>;<span class="hljs-keyword">repeated</span> <span class="hljs-built_in">string</span> snippets = ;&#125;</code></pre></div><h3 id="Message-åµŒå¥—çš„ä½¿ç”¨"><a href="#Message-åµŒå¥—çš„ä½¿ç”¨" class="headerlink" title="Message åµŒå¥—çš„ä½¿ç”¨"></a>Message åµŒå¥—çš„ä½¿ç”¨</h3><p>æ”¯æŒåµŒå¥—æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¯ä»¥åŒ…å«å¦ä¸€ä¸ªæ¶ˆæ¯ä½œä¸ºå­—æ®µã€‚ä¹Ÿå¯ä»¥åœ¨æ¶ˆæ¯å†…å®šä¹‰ä¸€ä¸ªæ–°çš„æ¶ˆæ¯ã€‚</p><p>å†…éƒ¨å£°æ˜çš„ message ç±»å‹åç§°åªå¯åœ¨å†…éƒ¨ç›´æ¥ä½¿ç”¨ï¼š</p><div class="code-wrapper"><pre><code class="hljs protobuf"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchResponse</span> </span>&#123;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Result</span> </span>&#123;<span class="hljs-built_in">string</span> url = <span class="hljs-number">1</span>;<span class="hljs-built_in">string</span> title = <span class="hljs-number">2</span>;<span class="hljs-keyword">repeated</span> <span class="hljs-built_in">string</span> snippets = ;&#125;<span class="hljs-keyword">repeated</span> Result results = <span class="hljs-number">1</span>;&#125;</code></pre></div><p>å¤šå±‚åµŒå¥—ï¼š</p><div class="code-wrapper"><pre><code class="hljs protobuf"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Outer</span> </span>&#123;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">A</span> </span>&#123;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Inner</span> </span>&#123;<span class="hljs-built_in">int64</span> ival = <span class="hljs-number">1</span>;<span class="hljs-built_in">bool</span> booly = <span class="hljs-number">2</span>;&#125;&#125;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">B</span> </span>&#123;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Inner</span> </span>&#123;<span class="hljs-built_in">int64</span> ival = <span class="hljs-number">1</span>;<span class="hljs-built_in">bool</span> booly = <span class="hljs-number">2</span>;&#125;&#125;&#125;</code></pre></div><h3 id="æ˜ å°„å­—æ®µ"><a href="#æ˜ å°„å­—æ®µ" class="headerlink" title="æ˜ å°„å­—æ®µ"></a>æ˜ å°„å­—æ®µ</h3><p>æ¯ä¸ªæ˜ å°„å­—æ®µä¼šåœ¨Goçš„ç»“æ„ä½“ä¸­ç”Ÿæˆä¸€ä¸ª<code>map[TKey]TValue</code>ç±»å‹çš„å­—æ®µï¼Œå…¶ä¸­<code>TKey</code>æ˜¯å­—æ®µçš„é”®ç±»å‹<code>TValue</code>æ˜¯å­—æ®µçš„å€¼ç±»å‹ã€‚å¯¹äºä¸‹é¢è¿™ä¸ªæ¶ˆæ¯å®šä¹‰ï¼š</p><div class="code-wrapper"><pre><code class="hljs protobuf"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Bar</span> </span>&#123;&#125;<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Baz</span> </span>&#123;  map&lt;<span class="hljs-built_in">string</span>, Bar&gt; foo = <span class="hljs-number">1</span>;&#125;</code></pre></div><p>ç¼–è¯‘å™¨ç”ŸæˆGoç»“æ„ä½“</p><div class="code-wrapper"><pre><code class="hljs elm"><span class="hljs-keyword">type</span> <span class="hljs-type">Baz</span> struct &#123;        <span class="hljs-type">Foo</span> map[string]*<span class="hljs-type">Bar</span>&#125;</code></pre></div><h2 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h2><p>ç»™å‡ºå¦‚ä¸‹æšä¸¾</p><div class="code-wrapper"><pre><code class="hljs protobuf"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SearchRequest</span> </span>&#123;  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Corpus</span> </span>&#123;    UNIVERSAL = <span class="hljs-number">0</span>;    WEB = <span class="hljs-number">1</span>;    IMAGES = <span class="hljs-number">2</span>;    LOCAL = <span class="hljs-number">3</span>;    NEWS = <span class="hljs-number">4</span>;    PRODUCTS = <span class="hljs-number">5</span>;    VIDEO = <span class="hljs-number">6</span>;  &#125;  Corpus corpus = <span class="hljs-number">1</span>;  ...&#125;</code></pre></div><p>ç¼–è¯‘å™¨å°†ä¼šç”Ÿæˆä¸€ä¸ªæšä¸¾ç±»å‹å’Œä¸€ç³»åˆ—è¯¥ç±»å‹çš„å¸¸é‡ã€‚</p><h2 id="proto-æ–‡ä»¶ç¼–è¯‘ä»£ç "><a href="#proto-æ–‡ä»¶ç¼–è¯‘ä»£ç " class="headerlink" title=".proto æ–‡ä»¶ç¼–è¯‘ä»£ç "></a>.proto æ–‡ä»¶ç¼–è¯‘ä»£ç </h2><ul><li>é€šè¿‡å®šä¹‰å¥½çš„ .proto æ–‡ä»¶ç”Ÿæˆ Goã€PHPã€Javaã€Pythonç­‰ä»£ç ï¼Œéœ€è¦å®‰è£…ç¼–è¯‘å™¨ protocã€‚</li><li>ä½¿ç”¨ protobuf ç¼–è¯‘å™¨ä¸åŒçš„è¯­è¨€ç”Ÿæˆçš„ä»£ç æ ¼å¼ä¸åŒï¼Œæ¯”å¦‚Goï¼šç”Ÿæˆä¸€ä¸ª .pb.go æ–‡ä»¶ï¼Œæ¯ä¸ªæ¶ˆæ¯ç±»å‹å¯¹åº”ä¸€ä¸ªç»“æ„ä½“ã€‚</li></ul><p>å…·ä½“protocå®‰è£…å’Œä»£ç ç”Ÿæˆå¯è§ï¼š<br><a href="https://github.oscome.cn/2019/12/20/215/">gRPCåˆä½“éªŒ</a></p><p>ä¹Ÿæœ‰çœ‹åˆ°éƒ¨åˆ†é¡¹ç›®ä½¿ç”¨protobufå»æ›¿ä»£jsonå»è¿›è¡Œå‰åç«¯æ•°æ®äº¤æ¢ã€‚</p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://juejin.cn/post/6844904101835358221">Protobuf è¯­æ³•</a></li><li><a href="https://segmentfault.com/a/1190000020386857">Protobufè¯­è¨€æŒ‡å—</a></li><li><a href="https://juejin.cn/post/6844903944511029262">Protobufç”ŸæˆGoä»£ç æŒ‡å—</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Protobuf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golangçš„å•å¼•å·åŒå¼•å·åå¼•å·</title>
    <link href="/2021/04/29/335/"/>
    <url>/2021/04/29/335/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å•å¼•å·Single quoteï¼Œè¡¨ç¤ºbyteç±»å‹æˆ–runeç±»å‹ï¼Œå¯¹åº” uint8å’Œint32ç±»å‹ï¼Œé»˜è®¤æ˜¯ rune ç±»å‹ã€‚byteç”¨æ¥å¼ºè°ƒæ•°æ®æ˜¯raw dataï¼Œè€Œä¸æ˜¯æ•°å­—ï¼›è€Œruneç”¨æ¥è¡¨ç¤ºUnicodeçš„code pointã€‚</p></blockquote><blockquote><p>åŒå¼•å·Double quoteï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šæ˜¯å­—ç¬¦æ•°ç»„ã€‚å¯ä»¥ç”¨ç´¢å¼•å·è®¿é—®æŸå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥ç”¨len()å‡½æ•°æ¥è·å–å­—ç¬¦ä¸²æ‰€å çš„å­—èŠ‚é•¿åº¦ã€‚</p></blockquote><blockquote><p>åå¼•å·Back quoteï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œä¸åŒå¼•å·ä¸åŒï¼Œå®ƒä¸æ”¯æŒä»»ä½•è½¬ä¹‰åºåˆ—ï¼Œä½†æ”¯æŒæ¢è¡Œä¹¦å†™ã€‚å­—é¢é‡ raw literal string çš„æ„æ€æ˜¯ï¼Œä½ å®šä¹‰æ—¶å†™çš„å•¥æ ·ï¼Œå®ƒå°±å•¥æ ·ï¼Œä½ æœ‰æ¢è¡Œï¼Œå®ƒå°±æ¢è¡Œã€‚ä½ å†™è½¬ä¹‰å­—ç¬¦ï¼Œå®ƒä¹Ÿå°±å±•ç¤ºè½¬ä¹‰å­—ç¬¦ã€‚</p></blockquote><div class="code-wrapper"><pre><code class="hljs go">a := <span class="hljs-string">&#x27;a&#x27;</span>b := <span class="hljs-string">&quot;b\naa&quot;</span>c := <span class="hljs-string">`c</span><span class="hljs-string">3ww`</span><span class="hljs-keyword">var</span> d <span class="hljs-keyword">byte</span> = <span class="hljs-string">&#x27;d&#x27;</span>fmt.Println(b)fmt.Println(c)fmt.Printf(<span class="hljs-string">&quot;Single quote type:%T\n&quot;</span>, a)fmt.Printf(<span class="hljs-string">&quot;Double quote type:%T\n&quot;</span>, b)fmt.Printf(<span class="hljs-string">&quot;Back quote type:%T\n&quot;</span>, c)fmt.Printf(<span class="hljs-string">&quot;Single quote type:%T\n&quot;</span>, d)output:------baac        <span class="hljs-number">3</span>wwSingle quote <span class="hljs-keyword">type</span>:<span class="hljs-keyword">int32</span>Double quote <span class="hljs-keyword">type</span>:<span class="hljs-keyword">string</span>Back quote <span class="hljs-keyword">type</span>:<span class="hljs-keyword">string</span>Single quote <span class="hljs-keyword">type</span>:<span class="hljs-keyword">uint8</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MACå®‰è£…rabbitmqæ‰©å±•</title>
    <link href="/2021/04/29/333/"/>
    <url>/2021/04/29/333/</url>
    
    <content type="html"><![CDATA[<p>PHPç»“åˆrabbitMQéœ€è¦å®‰è£…amqpæ‰©å±•ï¼Œä¹‹å‰åˆåœ¨windowså®‰è£…ï¼Œä»Šå¤©å°è¯•macå®‰è£…ä¸€ä¸‹ã€‚</p><ol><li>ä¸‹è½½</li></ol><p>å‰å»<a href="https://pecl.php.net/package/amqp">amqp</a>ï¼Œä¸‹è½½éœ€è¦çš„ç‰ˆæœ¬ã€‚</p><ol start="2"><li>å®‰è£…</li></ol><div class="code-wrapper"><pre><code class="hljs awk">phpize<span class="hljs-regexp">//</span> --with-php-config è·¯å¾„è‡ªå·±ä¿®æ”¹.<span class="hljs-regexp">/configure --with-php-config=xxx/</span>php-configmake &amp;&amp; make install</code></pre></div><p>å¦‚æœæ²¡è£…rabbitmq-cï¼Œåº”è¯¥ä¼šæŠ¥é”™ã€‚</p><div class="code-wrapper"><pre><code class="hljs livecodeserver">configure: error: Please reinstall <span class="hljs-keyword">the</span> librabbitmq distribution itself <span class="hljs-keyword">or</span> (re)install librabbitmq development package <span class="hljs-keyword">if</span> <span class="hljs-keyword">it</span> available <span class="hljs-keyword">in</span> your <span class="hljs-keyword">system</span></code></pre></div><p><a href="https://github.com/alanxz/rabbitmq-c/releases">ä¸‹è½½rabbitmq-c</a></p><div class="code-wrapper"><pre><code class="hljs awk">cd rabbitmq-c-<span class="hljs-number">0.8</span>.<span class="hljs-number">0</span>.<span class="hljs-regexp">/configure --prefix=/u</span>sr<span class="hljs-regexp">/local/</span>rabbitmq-cmake &amp;&amp; make install</code></pre></div><p>é‡æ–°ç¼–è¯‘amqp</p><div class="code-wrapper"><pre><code class="hljs awk">.<span class="hljs-regexp">/configure --with-php-config=xxx/</span>php-config --with-amqp --with-librabbitmq-dir=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/rabbitmq-c/</span>make &amp;&amp; make install</code></pre></div><p>makeæ—¶æç¤ºç¼ºå°‘amqp_ssl_socket.h<br>fatal error: â€˜amqp_ssl_socket.hâ€™ file not found<br>#include &lt;amqp_ssl_socket.h&gt;</p><p>è¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹ <a href="https://github.com/alanxz/rabbitmq-c/issues/463">https://github.com/alanxz/rabbitmq-c/issues/463</a></p><p>ç„¶åå¯ä»¥æŠŠrabbitmq-cçš„librabbitmqä¸‹amqp_ssl_socket.hæ–‡ä»¶copyåˆ°amqpæ‰©å±•ç›®å½•ï¼Œé‡æ–°ç¼–è¯‘å³å¯ã€‚</p><p>å®‰è£…æˆåŠŸè®°å¾—åœ¨iniåŠ å…¥extension=â€amqp.soâ€ï¼Œæœ€åå¯ä»¥ä½¿ç”¨<strong>php -m</strong></p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså¯¹è±¡åº•å±‚æ•°æ®ç»“æ„</title>
    <link href="/2021/03/23/source/"/>
    <url>/2021/03/23/source/</url>
    
    <content type="html"><![CDATA[<h2 id="Rediså¯¹è±¡åº•å±‚æ•°æ®ç»“æ„"><a href="#Rediså¯¹è±¡åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="Rediså¯¹è±¡åº•å±‚æ•°æ®ç»“æ„"></a>Rediså¯¹è±¡åº•å±‚æ•°æ®ç»“æ„</h2><table><thead><tr><th>ç¼–ç å¸¸é‡</th><th>ç¼–ç æ‰€å¯¹åº”çš„åº•å±‚æ•°æ®ç»“æ„</th></tr></thead><tbody><tr><td>REDIS_ENCODING_INT</td><td>long ç±»å‹çš„æ•´æ•°</td></tr><tr><td>REDIS_ENCODING_EMBSTR</td><td>embstr ç¼–ç çš„ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>REDIS_ENCODING_RAW</td><td>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>REDIS_ENCODING_HT</td><td>å­—å…¸</td></tr><tr><td>REDIS_ENCODING_LINKEDLIST</td><td>åŒç«¯é“¾è¡¨</td></tr><tr><td>REDIS_ENCODING_ZIPLIST</td><td>å‹ç¼©åˆ—è¡¨</td></tr><tr><td>REDIS_ENCODING_INTSET</td><td>æ•´æ•°é›†åˆ</td></tr><tr><td>REDIS_ENCODING_SKIPLIST</td><td>è·³è·ƒè¡¨</td></tr></tbody></table><h2 id="Redis-stringç±»å‹è½¬æ¢"><a href="#Redis-stringç±»å‹è½¬æ¢" class="headerlink" title="Redis stringç±»å‹è½¬æ¢"></a>Redis stringç±»å‹è½¬æ¢</h2><p>â€ƒæˆ‘ä»¬å¯èƒ½ä»¥ä¸ºRedisåœ¨å†…éƒ¨å­˜å‚¨stringéƒ½æ˜¯ç”¨sdsçš„æ•°æ®ç»“æ„å®ç°çš„ï¼Œå…¶å®åœ¨æ•´ä¸ªRedisçš„æ•°æ®å­˜å‚¨è¿‡ç¨‹ä¸­ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå†…éƒ¨åšäº†å¾ˆå¤šä¼˜åŒ–ã€‚æ•´ä½“é€‰æ‹©é¡ºåºåº”è¯¥æ˜¯ï¼š</p><ul><li><p>æ•´æ•°ï¼Œå­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦å°äº21ä¸”èƒ½å¤Ÿè½¬åŒ–ä¸ºæ•´æ•°çš„å­—ç¬¦ä¸²ã€‚</p></li><li><p>EmbeddedStringï¼Œå­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦å°äº39çš„å­—ç¬¦ä¸²ï¼ˆREDIS_ENCODING_EMBSTR_SIZE_LIMITï¼‰ã€‚</p></li><li><p>SDSï¼Œå‰©ä½™æƒ…å†µä½¿ç”¨sdsè¿›è¡Œå­˜å‚¨ã€‚</p></li></ul><p>â€ƒ<strong>embstrå’Œsdsçš„åŒºåˆ«åœ¨äºå†…å­˜çš„ç”³è¯·å’Œå›æ”¶</strong></p><ul><li>embstrçš„åˆ›å»ºåªéœ€åˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œè€Œrawä¸ºä¸¤æ¬¡ï¼ˆä¸€æ¬¡ä¸ºsdsåˆ†é…å¯¹è±¡ï¼Œå¦ä¸€æ¬¡ä¸ºRedisObjectåˆ†é…å¯¹è±¡ï¼Œembstrçœå»äº†ç¬¬ä¸€æ¬¡ï¼‰ã€‚ç›¸å¯¹åœ°ï¼Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°ä¹Ÿç”±ä¸¤æ¬¡å˜ä¸ºä¸€æ¬¡ã€‚</li><li>embstrçš„RedisObjectå’Œsdsæ”¾åœ¨ä¸€èµ·ï¼Œæ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜å¸¦æ¥çš„ä¼˜åŠ¿</li><li>ç¼ºç‚¹ï¼šRediså¹¶æœªæä¾›ä»»ä½•ä¿®æ”¹embstrçš„æ–¹å¼ï¼Œå³embstræ˜¯åªè¯»çš„å½¢å¼ã€‚å¯¹embstrçš„ä¿®æ”¹å®é™…ä¸Šæ˜¯å…ˆè½¬æ¢ä¸ºrawå†è¿›è¡Œä¿®æ”¹ã€‚</li></ul><h2 id="Redis-listæ•°æ®ç»“æ„"><a href="#Redis-listæ•°æ®ç»“æ„" class="headerlink" title="Redis listæ•°æ®ç»“æ„"></a>Redis listæ•°æ®ç»“æ„</h2><p>â€ƒRedis listæ•°æ®ç»“æ„åº•å±‚é‡‡ç”¨å‹ç¼©åˆ—è¡¨ziplistæˆ–linkedlistä¸¤ç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œé¦–å…ˆä»¥ziplistè¿›è¡Œå­˜å‚¨ï¼Œåœ¨ä¸æ»¡è¶³ziplistçš„å­˜å‚¨è¦æ±‚åè½¬æ¢ä¸ºlinkedliståˆ—è¡¨ã€‚</p><p>å½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œåˆ—è¡¨å¯¹è±¡ä½¿ç”¨ziplistè¿›è¡Œå­˜å‚¨ï¼Œå¦åˆ™ç”¨linkedlistå­˜å‚¨ã€‚</p><ul><li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚</li><li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº512ä¸ªã€‚</li></ul><h2 id="Redis-hashåº•å±‚å­˜å‚¨ç»“æ„"><a href="#Redis-hashåº•å±‚å­˜å‚¨ç»“æ„" class="headerlink" title="Redis hashåº•å±‚å­˜å‚¨ç»“æ„"></a>Redis hashåº•å±‚å­˜å‚¨ç»“æ„</h2><p>Redisçš„å“ˆå¸Œå¯¹è±¡çš„åº•å±‚å­˜å‚¨å¯ä»¥ä½¿ç”¨ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰å’Œhashtableã€‚å½“hashå¯¹è±¡å¯ä»¥åŒæ—¶æ»¡è¶³ä¸€ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå“ˆå¸Œå¯¹è±¡ä½¿ç”¨ziplistç¼–ç ã€‚</p><ul><li>å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼çš„å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº64å­—èŠ‚</li><li>å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº512ä¸ª</li></ul><blockquote><p>Redisçš„hashæ¶æ„å°±æ˜¯æ ‡å‡†çš„hashtabçš„ç»“æ„ï¼Œé€šè¿‡æŒ‚é“¾è§£å†³å†²çªé—®é¢˜ã€‚</p></blockquote><h2 id="Redis-setåº•å±‚å­˜å‚¨"><a href="#Redis-setåº•å±‚å­˜å‚¨" class="headerlink" title="Redis setåº•å±‚å­˜å‚¨"></a>Redis setåº•å±‚å­˜å‚¨</h2><p>Redisçš„é›†åˆå¯¹è±¡setçš„åº•å±‚å­˜å‚¨ç»“æ„ç‰¹åˆ«ç¥å¥‡ï¼Œåº•å±‚ä½¿ç”¨äº†intsetå’Œhashtableä¸¤ç§æ•°æ®ç»“æ„å­˜å‚¨çš„ï¼Œintsetæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ•°ç»„ï¼Œhashtableå°±æ˜¯æ™®é€šçš„å“ˆå¸Œè¡¨ï¼ˆkeyä¸ºsetçš„å€¼ï¼Œvalueä¸ºnullï¼‰ã€‚æ˜¯ä¸æ˜¯è§‰å¾—ç”¨hashtableå­˜å‚¨setæ˜¯ä¸€ä»¶å¾ˆç¥å¥‡çš„äº‹æƒ…ã€‚</p><p>â€ƒsetçš„åº•å±‚å­˜å‚¨intsetå’Œhashtableæ˜¯å­˜åœ¨ç¼–ç è½¬æ¢çš„ï¼Œä½¿ç”¨<strong>intset</strong>å­˜å‚¨å¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå¦åˆ™ä½¿ç”¨hashtableï¼Œæ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li>ç»“åˆå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼</li><li>é›†åˆå¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡ä¸è¶…è¿‡512ä¸ª</li></ul><h2 id="zsetåº•å±‚å­˜å‚¨ç»“æ„"><a href="#zsetåº•å±‚å­˜å‚¨ç»“æ„" class="headerlink" title="zsetåº•å±‚å­˜å‚¨ç»“æ„"></a>zsetåº•å±‚å­˜å‚¨ç»“æ„</h2><p>â€ƒzsetåº•å±‚çš„å­˜å‚¨ç»“æ„åŒ…æ‹¬ziplistæˆ–skiplistï¼Œåœ¨åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ä½¿ç”¨ziplistï¼Œå…¶ä»–æ—¶å€™ä½¿ç”¨skiplistï¼Œä¸¤ä¸ªæ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li>æœ‰åºé›†åˆä¿å­˜çš„å…ƒç´ æ•°é‡å°äº128ä¸ª</li><li>æœ‰åºé›†åˆä¿å­˜çš„æ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚</li></ul><p>å½“ziplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„æ—¶å€™ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¥ä¿å­˜ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¿å­˜å…ƒç´ çš„åˆ†å€¼ã€‚</p><p>å½“skiplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„çš„æ—¶å€™ï¼Œä½¿ç”¨skiplistæŒ‰åºä¿å­˜å…ƒç´ åŠåˆ†å€¼ï¼Œä½¿ç”¨dictæ¥ä¿å­˜å…ƒç´ å’Œåˆ†å€¼çš„æ˜ å°„å…³ç³»ã€‚</p><ul><li><a href="https://www.jianshu.com/p/160fb0f73841">Redis stringåº•å±‚æ•°æ®ç»“æ„</a></li><li><a href="https://www.jianshu.com/p/c2ede9707e26">Redis liståº•å±‚æ•°æ®ç»“æ„</a></li><li><a href="https://www.jianshu.com/p/8299aea62ab8">Redis hashåº•å±‚æ•°æ®ç»“æ„</a></li><li><a href="https://www.jianshu.com/p/28138a5371d0">Redis setåº•å±‚æ•°æ®ç»“æ„</a></li><li><a href="https://www.jianshu.com/p/fb7547369655">Redis zsetåº•å±‚æ•°æ®ç»“æ„</a></li></ul><h2 id="Redisä¸ºä½•è¦å®šä¹‰å­—ç¬¦ä¸²ä¸ºSDS"><a href="#Redisä¸ºä½•è¦å®šä¹‰å­—ç¬¦ä¸²ä¸ºSDS" class="headerlink" title="Redisä¸ºä½•è¦å®šä¹‰å­—ç¬¦ä¸²ä¸ºSDS"></a>Redisä¸ºä½•è¦å®šä¹‰å­—ç¬¦ä¸²ä¸ºSDS</h2><p>Redisæ˜¯åº•å±‚ä½¿ç”¨çš„æ˜¯Cè¯­è¨€ï¼Œåœ¨Cè¯­è¨€ä¸­æ²¡æœ‰å­—ç¬¦ä¸²è¿™ç§æ•°æ®ç±»å‹ï¼Œå­—ç¬¦ä¸²å¤§éƒ½æ˜¯é€šè¿‡å­—ç¬¦æ•°ç»„å®ç°çš„ï¼Œä½†æ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„æœ‰ä»¥ä¸‹ä¸è¶³ï¼š</p><ol><li>å­—ç¬¦æ•°ç»„çš„é•¿åº¦éƒ½æ˜¯å›ºå®šï¼Œå®¹æ˜“å‘ç”Ÿç©ºæŒ‡é’ˆå¼‚å¸¸</li><li>è·å–å­—ç¬¦æ•°ç»„çš„é•¿åº¦çš„æ—¶å€™éœ€è¦éå†æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦é«˜</li><li>å­—ç¬¦æ•°ç»„é•¿åº¦å‘ç”Ÿæ”¹å˜ä¹‹åéœ€è¦é‡æ–°åˆ†é…å†…å­˜</li><li>ä½¿ç”¨\0è¡¨ç¤ºç»“å°¾ï¼Œåœ¨å­˜å‚¨äºŒè¿›åˆ¶ä¼šå‡ºç°é—®é¢˜ã€‚</li></ol><div class="code-wrapper"><pre><code class="hljs C"><span class="hljs-comment">//åŠ¨æ€å­—ç¬¦ä¸²ï¼Œæ•°ç»„çš„é•¿åº¦æ˜¯å¯å˜çš„ã€‚</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sdshdr</span> &#123;</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> len;<span class="hljs-comment">//è®°å½•å½“å‰ä¸²çš„é•¿åº¦ã€‚</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-built_in">free</span>;<span class="hljs-comment">//è®°å½•å‰©ä½™çš„æœ‰æ•ˆé•¿åº¦ã€‚</span>    <span class="hljs-keyword">char</span> buf[];<span class="hljs-comment">//çœŸæ­£çš„å­—ç¬¦ä¸²ä½ç½®ã€‚</span>&#125;;</code></pre></div><p>Rediså°±è‡ªå·±å®ç°äº†SDSæ¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼ŒSDSç›¸å¯¹Cå­—ç¬¦ä¸²æ•°ç»„çš„ä¼˜ç‚¹ï¼š</p><ul><li>é•¿åº¦è¾¾åˆ°ä¸€å®šæ ‡å‡†ä¼šæœ‰ç›¸åº”çš„æ‰©å®¹ï¼ˆå°äº1Mï¼Œfreeå¢åŠ lenï¼Œå¤§äº1Mï¼Œæ¯æ¬¡å¢åŠ 1Mï¼‰ï¼Œä»è€Œè§£å†³å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚</li><li>åœ¨SDSçš„å†…éƒ¨å®šä¹‰äº†å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥è·å–ï¼Œå¤æ‚åº¦O(1)ï¼Œè§£å†³è·å–é•¿åº¦æ—¶é—´å¤æ‚åº¦é«˜çš„é—®é¢˜ã€‚</li><li>SDSæ˜¯ç©ºé—´é¢„åˆ†é…ï¼Œæƒ°æ€§é‡Šæ”¾å†…å­˜çš„ï¼Œä»è€Œå‡å°‘åˆ†é…å†…å­˜çš„æ¬¡æ•°</li><li>SDSæ ¹æ®é•¿åº¦åˆ¤æ–­ç»“æŸçš„ä½ç½®ï¼Œä»è€Œè§£å†³äºŒè¿›åˆ¶ä¸å®‰å…¨çš„é—®é¢˜ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goroutine</title>
    <link href="/2021/03/19/323/"/>
    <url>/2021/03/19/323/</url>
    
    <content type="html"><![CDATA[<p>From:</p><ul><li><a href="https://www.cnblogs.com/FireworksEasyCool/p/11508806.html">å¼„æ‡‚goroutineè°ƒåº¦åŸç†</a></li><li><a href="https://www.cnblogs.com/FireworksEasyCool/p/11508342.html">çº¿ç¨‹å®ç°æ¨¡å‹</a></li></ul><h3 id="goroutineç®€ä»‹"><a href="#goroutineç®€ä»‹" class="headerlink" title="goroutineç®€ä»‹"></a>goroutineç®€ä»‹</h3><blockquote><p>golangè¯­è¨€ä½œè€…Rob Pikeè¯´ï¼Œ<strong>â€œGoroutineæ˜¯ä¸€ä¸ªä¸å…¶ä»–goroutines å¹¶å‘è¿è¡Œåœ¨åŒä¸€åœ°å€ç©ºé—´çš„Goå‡½æ•°æˆ–æ–¹æ³•ã€‚ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºç”±ä¸€ä¸ªæˆ–æ›´å¤šä¸ªgoroutineç»„æˆã€‚å®ƒä¸çº¿ç¨‹ã€åç¨‹ã€è¿›ç¨‹ç­‰ä¸åŒã€‚å®ƒæ˜¯ä¸€ä¸ªgoroutineâ€œ</strong>ã€‚</p></blockquote><ul><li>goroutineé€šè¿‡é€šé“æ¥é€šä¿¡ï¼Œè€Œåç¨‹é€šè¿‡è®©å‡ºå’Œæ¢å¤æ“ä½œæ¥é€šä¿¡ï¼›</li><li>goroutine é€šè¿‡Golang çš„è°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦ï¼Œè€Œåç¨‹é€šè¿‡ç¨‹åºæœ¬èº«è°ƒåº¦ï¼›</li></ul><p>ç®€å•çš„è¯´å°±æ˜¯Golangè‡ªå·±å®ç°äº†åç¨‹å¹¶å«åšgoruntineï¼ˆæœ¬æ–‡ç§°Goåç¨‹ï¼‰ï¼Œä¸”æ¯”åç¨‹æ›´å¼ºå¤§ã€‚</p><h3 id="goroutineè°ƒåº¦åŸç†"><a href="#goroutineè°ƒåº¦åŸç†" class="headerlink" title="goroutineè°ƒåº¦åŸç†"></a>goroutineè°ƒåº¦åŸç†</h3><p>ä¸Šé¢è¯´åˆ°Goåç¨‹æ˜¯é€šè¿‡Golangçš„è°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦çš„ï¼Œå…¶ä¸­è°ƒåº¦å™¨çš„çº¿ç¨‹æ¨¡å‹ä¸ºä¸¤çº§çº¿ç¨‹æ¨¡å‹ã€‚</p><blockquote><p>æœ‰å…³ä¸¤çº§çº¿ç¨‹æ¨¡å‹çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹æ–‡ç« æœ€åã€‚</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸‹Golangå®ç°çš„ä¸¤çº§çº¿ç¨‹æ¨¡å‹æ˜¯æ€æ ·çš„ã€‚é¦–å…ˆè¦çŸ¥é“è¿™ä¸‰ä¸ªå­—æ¯ä»£è¡¨çš„å«ä¹‰</p><ul><li><strong>M</strong>ï¼šä»£è¡¨å†…æ ¸çº§çš„çº¿ç¨‹</li><li><strong>P</strong>ï¼šå…¨ç¨‹Processorï¼Œä»£è¡¨è¿è¡ŒGoåç¨‹æ‰€éœ€è¦çš„èµ„æºï¼ˆä¸Šä¸‹æ–‡ç¯å¢ƒï¼‰</li><li><strong>G</strong>ï¼šä»£è¡¨Goåç¨‹<br><img src="https://img2020.cnblogs.com/blog/1508611/202005/1508611-20200512094747494-1290849608.png" alt="å›¾ä¸€"><br>æˆ‘ä»¬å…ˆçœ‹ä¸‹ä¸ºå®ç°è°ƒåº¦Golangå®šä¹‰äº†è¿™äº›æ•°æ®ç»“æ„å­˜Mï¼ŒPï¼ŒG</li></ul><table><thead><tr><th align="left">åç§°</th><th align="left">ä½œç”¨èŒƒå›´</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">å…¨å±€Måˆ—è¡¨</td><td align="left">Goçš„è¿è¡Œæ—¶</td><td align="left">å­˜æ”¾æ‰€æœ‰Mçš„å•å‘é“¾è¡¨</td></tr><tr><td align="left">å…¨å±€Påˆ—è¡¨</td><td align="left">Goçš„è¿è¡Œæ—¶</td><td align="left">å­˜æ”¾æ‰€æœ‰Pçš„æ•°ç»„</td></tr><tr><td align="left">å…¨å±€Gåˆ—è¡¨</td><td align="left">Goçš„è¿è¡Œæ—¶</td><td align="left">å­˜æ”¾æ‰€æœ‰Gçš„åˆ‡ç‰‡</td></tr><tr><td align="left">è°ƒåº¦å™¨çš„ç©ºé—²Måˆ—è¡¨</td><td align="left">è°ƒåº¦å™¨</td><td align="left">å­˜æ”¾ç©ºé—²Mçš„å•å‘é“¾è¡¨</td></tr><tr><td align="left">è°ƒåº¦å™¨çš„ç©ºé—²Påˆ—è¡¨</td><td align="left">è°ƒåº¦å™¨</td><td align="left">å­˜æ”¾ç©ºé—²Pçš„å•å‘é“¾è¡¨</td></tr><tr><td align="left">è°ƒåº¦å™¨çš„è‡ªç”±Gåˆ—è¡¨</td><td align="left">è°ƒåº¦å™¨</td><td align="left">å­˜æ”¾è‡ªç”±Gçš„å•å‘é“¾è¡¨ï¼ˆæœ‰ä¸¤ä¸ªï¼‰</td></tr><tr><td align="left">è°ƒåº¦å™¨çš„å¯è¿è¡ŒGé˜Ÿåˆ—</td><td align="left">è°ƒåº¦å™¨</td><td align="left">å­˜æ”¾å¯è¿è¡ŒGçš„é˜Ÿåˆ—</td></tr><tr><td align="left">Pçš„è‡ªç”±Gåˆ—è¡¨</td><td align="left">æœ¬åœ°P</td><td align="left">å­˜æ”¾å½“å‰Pä¸­è‡ªç”±Gçš„å•å‘é“¾è¡¨</td></tr><tr><td align="left">Pçš„å¯è¿è¡ŒGé˜Ÿåˆ—</td><td align="left">æœ¬åœ°P</td><td align="left">å­˜æ”¾å½“å‰Pä¸­å¯è¿è¡ŒGçš„é˜Ÿåˆ—</td></tr></tbody></table><p>ç„¶åä»ä¸Šå¾€ä¸‹è§£æGoçš„ä¸¤çº§çº¿ç¨‹æ¨¡å‹å›¾</p><ol><li>Må’Œå†…æ ¸çº¿ç¨‹ä¹‹é—´æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¸€ä¸ªMåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåªä¼šå’Œä¸€ä¸ªå†…æ ¸çº¿ç¨‹å…³è”ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¯¹å†…æ ¸çº¿ç¨‹çš„é¢‘ç¹åˆ‡æ¢ï¼›</li></ol><blockquote><p>Golangçš„è¿è¡Œæ—¶æ‰§è¡Œç³»ç»Ÿç›‘æ§å’Œåƒåœ¾å›æ”¶ç­‰ä»»åŠ¡æ—¶å€™ä¼šå¯¼è‡´åˆ›å»ºMï¼ŒMç©ºé—²æ—¶ä¸ä¼šè¢«é”€æ¯ï¼Œè€Œæ˜¯æ”¾åˆ°ä¸€ä¸ª<code>è°ƒåº¦å™¨çš„ç©ºé—²Måˆ—è¡¨</code>ä¸­ï¼Œç­‰å¾…ä¸På…³è”ï¼ŒMé»˜è®¤æ•°é‡ä¸º10000</p></blockquote><ol start="2"><li>På’ŒMä¹‹é—´æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼ŒPå’ŒGä¹‹é—´æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä»–ä»¬çš„å…³è”æ˜¯æ˜“å˜çš„ï¼Œç”±Golangçš„è°ƒåº¦å™¨å®Œæˆè°ƒåº¦ï¼›</li></ol><blockquote><p>Golangçš„è¿è¡Œæ—¶æŒ‰è§„åˆ™è°ƒåº¦ï¼Œè®©På’Œä¸åŒçš„Må»ºç«‹æˆ–æ–­å¼€å…³è”ï¼Œä½¿å¾—Pä¸­çš„Gèƒ½å¤ŸåŠæ—¶è·å¾—è¿è¡Œæ—¶æœº</p></blockquote><ol start="3"><li>Pçš„æ•°é‡é»˜è®¤ä¸ºCPUæ€»æ ¸å¿ƒæ•°ï¼Œæœ€å¤§ä¸º256ï¼Œå½“Pæ²¡æœ‰å¯è¿è¡Œçš„Gæ—¶å€™ï¼ˆPçš„å¯è¿è¡ŒGé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼ŒPä¼šè¢«æ”¾åˆ°<code>è°ƒåº¦å™¨çš„ç©ºé—²Påˆ—è¡¨</code>ä¸­ï¼Œç­‰å¾…Mä¸å®ƒå…³è”ï¼›</li></ol><blockquote><p>Pæœ‰å¯èƒ½ä¼šè¢«é”€æ¯ï¼Œå¦‚è¿è¡Œæ—¶ç”¨runtime.GOMAXPROCSæŠŠPçš„æ•°é‡ä»32é™åˆ°16æ—¶ï¼Œå‰©ä½™16ä¸ªä¼šè¢«é”€æ¯ï¼Œå®ƒä»¬åŸæ¥çš„Gä¼šå…ˆè½¬åˆ°è°ƒåº¦å™¨<code>å¯è¿è¡Œçš„Gé˜Ÿåˆ—</code>å’Œ<code>è‡ªç”±Gåˆ—è¡¨</code></p></blockquote><ol start="4"><li>æ¯ä¸ªPä¸­æœ‰<code>å¯è¿è¡Œçš„Gé˜Ÿåˆ—</code>ï¼ˆå¦‚å›¾ä¸­æœ€ä¸‹é¢çš„é‚£è¡ŒGï¼‰å’Œ<code>è‡ªç”±Gåˆ—è¡¨</code>ï¼ˆå›¾ä¸­æœªç”»å‡ºæ¥ï¼‰ï¼Œå½“Gçš„ä»£ç æ‰§è¡Œå®Œåï¼Œè¯¥Gä¸ä¼šè¢«é”€æ¯ï¼Œè€Œæ˜¯è¢«æ”¾åˆ°<code>Pçš„è‡ªç”±Gåˆ—è¡¨</code>æˆ–<code>è°ƒåº¦å™¨çš„è‡ªç”±Gåˆ—è¡¨</code>ã€‚å¦‚æœç¨‹åºæ–°å»ºäº†Goåç¨‹ï¼Œè°ƒåº¦å™¨ä¼šåœ¨è‡ªç”±Gåˆ—è¡¨ä¸­å–ä¸€ä¸ªGï¼Œç„¶åæŠŠGoåç¨‹çš„å‡½æ•°èµ‹å€¼åˆ°Gä¸­ï¼ˆå¦‚æœè‡ªç”±Gåˆ—è¡¨ä¸ºç©ºï¼Œå°±åˆ›å»ºä¸€ä¸ªGï¼‰ï¼›</li></ol><blockquote><p>å¯è§Golangè°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶å¾ˆå¤§ç¨‹åº¦å¤ç”¨äº†Mï¼ŒPï¼ŒG</p></blockquote><ol start="5"><li>åœ¨Goç¨‹åºåˆå§‹åŒ–åï¼Œè°ƒåº¦å™¨é¦–å…ˆè¿›è¡Œä¸€è½®è°ƒåº¦ï¼Œæ­¤æ—¶ç”¨Må»æœç´¢å¯è¿è¡Œçš„Gã€‚å…¶ä¸­æˆ‘ä»¬çš„mainå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªGï¼Œæ‰¾åˆ°å¯è¿è¡Œçš„Gåå°±æ‰§è¡Œå®ƒï¼›</li></ol><blockquote><p>è‡³äºæ€ä¹ˆæ‰¾å¯è¿è¡Œçš„Gå‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ°å¤„æ‰¾ï¼Œæƒ³å°½åŠæ³•æ‰¾ï¼ˆè¿™é‡Œåªåˆ—å‡ºä¸€éƒ¨åˆ†åœ°æ–¹ï¼‰ã€‚</p><ul><li>ä»<code>æœ¬åœ°Pçš„å¯è¿è¡Œçš„Gé˜Ÿåˆ—</code>æ‰¾</li><li>ä»<code>è°ƒåº¦å™¨çš„å¯è¿è¡Œçš„Gé˜Ÿåˆ—</code>æ‰¾</li><li>ä»<code>å…¶ä»–Pçš„å¯è¿è¡Œçš„Gé˜Ÿåˆ—</code>æ‰¾</li></ul></blockquote><ol start="6"><li><code>Pçš„å¯è¿è¡ŒGé˜Ÿåˆ—</code>æœ€å¤§åªèƒ½å­˜æ”¾é•¿åº¦ä¸º256çš„Gï¼Œå½“é˜Ÿåˆ—æ»¡åï¼Œè°ƒåº¦å™¨ä¼šæŠŠä¸€åŠçš„Gè½¬åˆ°<code>è°ƒåº¦å™¨çš„å¯è¿è¡ŒGé˜Ÿåˆ—</code>ã€‚</li></ol><h3 id="ç³»ç»Ÿç›‘æ§"><a href="#ç³»ç»Ÿç›‘æ§" class="headerlink" title="ç³»ç»Ÿç›‘æ§"></a>ç³»ç»Ÿç›‘æ§</h3><p>ä¸Šé¢å¤§æ¦‚æè¿°äº†å…³äºgoroutineè°ƒåº¦çš„æµç¨‹ã€‚ç°åœ¨è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å½“Goåç¨‹å¾ˆå¤šï¼ˆå¹¶å‘é‡å¤§ï¼‰æ—¶å€™ï¼Œæ˜¾ç„¶Gæ˜¯ä¸èƒ½ä¸€ç›´æ‰§è¡Œä¸‹å»çš„ï¼Œå› ä¸ºä¹Ÿéœ€è¦æŠŠæ‰§è¡Œæœºä¼šç•™ç»™å…¶ä»–çš„Gã€‚æ­¤æ—¶Golangè¿è¡Œæ—¶çš„ç³»ç»Ÿç›‘æ§å°±èµ·ä½œç”¨äº†ã€‚<br>ä¸€èˆ¬æƒ…å†µï¼Œå½“Gè¿è¡Œæ—¶é—´è¶…è¿‡10msåï¼Œè¯¥Gå°±ä¼šè¢«ç³»ç»Ÿå‘ŠçŸ¥éœ€è¦åœæ­¢äº†ï¼Œè®©å…¶ä»–Gè¿è¡Œã€‚ï¼ˆè¿™é‡Œæƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸èƒ½ç¡®ä¿æ¯ä¸ªGéƒ½èƒ½è¢«å…¬å¹³æ‰§è¡Œï¼‰</p><blockquote><p>ä»¥ä¸‹ç‰¹æ®Šæƒ…å†µè¯¥Gä¸éœ€è¦åœæ­¢</p><ul><li>Pçš„å¯è¿è¡ŒGé˜Ÿåˆ—ä¸ºç©ºï¼ˆæ²¡æœ‰å…¶ä»–Gå¯è¿è¡Œï¼‰</li><li>æœ‰ç©ºé—²çš„Måœ¨å¯»æ‰¾å¯è¿è¡Œçš„Gï¼ˆæ²¡æœ‰å…¶ä»–Gå¯è¿è¡Œï¼‰</li><li>ç©ºé—²çš„Pï¼ˆè¿˜æœ‰Pé—²ç€ï¼‰</li></ul></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Golangä»¥ä¸¤çº§çº¿ç¨‹å®ç°æ¨¡å‹ï¼Œè‡ªå·±å®ç°goruntineå’Œè°ƒåº¦å™¨ï¼Œä¼˜åŠ¿åœ¨äºå¹¶è¡Œå’Œéå¸¸ä½çš„èµ„æºä½¿ç”¨ã€‚</p><blockquote><p><strong>ä¸»è¦ä½“ç°</strong></p><ul><li>å†…å­˜æ¶ˆè€—æ–¹é¢ï¼ˆæ¯ä¸ªGoåç¨‹å çš„å†…å­˜è¿œå°äºçº¿ç¨‹å çš„å†…å­˜ï¼‰</li><li>åˆ‡æ¢(è°ƒåº¦)å¼€é”€æ–¹é¢</li><li>çº¿ç¨‹åˆ‡æ¢æ¶‰åŠæ¨¡å¼åˆ‡æ¢(ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€)</li></ul></blockquote><p>æ­¤å¤–ï¼ŒGoåç¨‹æ‰§è¡Œä»»åŠ¡å®Œæˆçš„é¡ºåºå¹¶ä¸éƒ½æ˜¯æŒ‰æˆ‘ä»¬é¢„æœŸçš„é‚£æ ·ï¼ˆç¨‹åºä¸åŠ ä»¥æ§åˆ¶çš„æƒ…å†µä¸‹ï¼‰ï¼Œç‰¹åˆ«åœ¨ä¸€äº›è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ä¸­ã€‚ä¸”æ¯ä¸ªGoåç¨‹æ‰§è¡Œçš„æ—¶é—´ä¹Ÿä¸æ˜¯ç»å¯¹å…¬å¹³çš„ã€‚</p><hr><h3 id="çº¿ç¨‹å®ç°æ¨¡å‹"><a href="#çº¿ç¨‹å®ç°æ¨¡å‹" class="headerlink" title="çº¿ç¨‹å®ç°æ¨¡å‹"></a>çº¿ç¨‹å®ç°æ¨¡å‹</h3><p>çº¿ç¨‹å®ç°æ¨¡å‹ä¸»è¦åˆ†ä¸ºï¼š<code>ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹</code>ï¼Œ<code>å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹</code>å’Œ<code>ä¸¤çº§çº¿ç¨‹æ¨¡å‹</code>ã€‚ä»–ä»¬çš„åŒºåˆ«åœ¨äºçº¿ç¨‹ä¸å†…æ ¸çº¿ç¨‹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p><p>ä»¥ä¸‹æˆ‘ä»¬å°†åˆ†æè¿™ä¸‰ç§çº¿ç¨‹å®ç°æ¨¡å‹çš„ç‰¹ç‚¹ï¼š</p><h4 id="ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹"><a href="#ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹" class="headerlink" title="ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹"></a>ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹</h4><ul><li>å¤šå¯¹ä¸€å…³ç³»<br>ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹ä¸ºå¤šå¯¹ä¸€å…³ç³»ã€‚å³ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼›</li><li>å¤„ç†é€Ÿåº¦å¿«ã€ç§»æ¤æ€§å¼ºï¼›<br>çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦ã€åŒæ­¥ç­‰æ“ä½œç”±åº”ç”¨ç¨‹åºæ¥å¤„ç†ï¼Œä¸éœ€è¦è®©CPUä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚æ‰€ä»¥ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹åœ¨é€Ÿåº¦å¿«ï¼Œä¸”ç§»æ¤æ€§å¼ºï¼›</li><li>å¹¶éçœŸæ­£çš„å¹¶å‘è¿è¡Œ<br>å¦‚æœçº¿ç¨‹IOæ“ä½œè¿‡ç¨‹ä¸­è¢«é˜»å¡ï¼Œé‚£ä¹ˆç”¨æˆ·ç©ºé—´çš„å…¶ä»–çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œå› ä¸ºè¿™äº›çº¿ç¨‹æ— æ³•è¢«å†…æ ¸è°ƒåº¦ã€‚<br><img src="https://img2020.cnblogs.com/blog/1508611/202005/1508611-20200512094624436-1426857745.png" alt="ç”¨æˆ·çº§çº¿ç¨‹æ¨¡"></li></ul><h4 id="å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹"><a href="#å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹" class="headerlink" title="å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹"></a>å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹</h4><p>ï¼ˆ1ï¼‰ä¸€å¯¹ä¸€å…³ç³»<br>å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹ä¸ºä¸€å¯¹ä¸€å…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼›<br>ï¼ˆ2ï¼‰èµ„æºæ¶ˆè€—è¾ƒå¤§ï¼Œé€Ÿåº¦è¾ƒæ…¢<br>è¿›ç¨‹å¯¹çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€åˆ‡æ¢å’ŒåŒæ­¥éƒ½å¿…é¡»é€šè¿‡å†…æ ¸æä¾›çš„ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆï¼Œå¯¹å†…æ ¸çš„è°ƒåº¦çš„è°ƒåº¦å™¨é€ æˆå¾ˆå¤§çš„è´Ÿæ‹…ï¼›<br>ï¼ˆ3ï¼‰æ˜¯çœŸæ­£çš„å¹¶å‘è¿è¡Œ<br>ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œçº¿ç¨‹ç”±å†…æ ¸æ¥ç®¡ç†å’Œè°ƒåº¦ã€‚å½“æŸä¸€çº¿ç¨‹é˜»å¡æ—¶å€™ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ã€‚<br><img src="https://img2020.cnblogs.com/blog/1508611/202005/1508611-20200512094646292-107659118.png" alt="æ¨¡å‹"></p><h4 id="ä¸¤çº§çº¿ç¨‹æ¨¡å‹"><a href="#ä¸¤çº§çº¿ç¨‹æ¨¡å‹" class="headerlink" title="ä¸¤çº§çº¿ç¨‹æ¨¡å‹"></a>ä¸¤çº§çº¿ç¨‹æ¨¡å‹</h4><ol><li>å¤šå¯¹å¤šçš„å…³ç³»<br>ä¸¤çº§çº¿ç¨‹æ¨¡å‹æ˜¯é›†å‰é¢ä¸¤ç§æ¨¡å‹çš„ä¼˜ç‚¹è€Œè®¾è®¡çš„ï¼Œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼›</li><li>èµ„æºæ¶ˆè€—è¾ƒå°ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œæ˜¯çœŸæ­£çš„å¹¶å‘è¿è¡Œ<br>ä¸¤çº§çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å¯¹åº”å¤šä¸ªå†…æ ¸çº¿ç¨‹ï¼Œè¿›ç¨‹ä¸­çš„çº¿ç¨‹ç”±ç¨‹åºç®¡ç†å’Œè°ƒåº¦å¹¶é€šè¿‡æ˜ å°„å…³ç³»æ˜ å°„åˆ°å†…æ ¸çº¿ç¨‹ä¸Šã€‚è¿™æ ·å³ä¾¿æœ‰çº¿ç¨‹é˜»å¡åï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ï¼›</li><li>å®ç°çš„å¤æ‚åº¦å¤§<br>ç”¨æˆ·çº¿ç¨‹ä¸å†…æ ¸çº¿ç¨‹çš„æ˜ å°„å…³ç³»éœ€è¦ç¨‹åºæ¥å®ç°ï¼Œå®ç°çš„å¤æ‚åº¦å¤§ã€‚å¹¸è¿çš„æ˜¯ï¼ŒGolangä¸ºæˆ‘ä»¬å®ç°äº†ä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼Œè¿™ä½¿å¾—å®ƒåœ¨å¤„ç†å¹¶å‘é—®é¢˜ä¸Šæ›´æœ‰ä¼˜åŠ¿ã€‚<br><img src="https://img2020.cnblogs.com/blog/1508611/202005/1508611-20200512094624436-1426857745.png" alt="çº¿ç¨‹æ¨¡å‹"></li></ol>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶</title>
    <link href="/2021/03/14/volatile/"/>
    <url>/2021/03/14/volatile/</url>
    
    <content type="html"><![CDATA[<p>Redisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤ç­–ç•¥ã€‚</p><p><strong>ä¸ºä»€ä¹ˆä¸ç”¨å®šæ—¶åˆ é™¤ç­–ç•¥?</strong></p><p>å®šæ—¶åˆ é™¤,ç”¨ä¸€ä¸ªå®šæ—¶å™¨æ¥è´Ÿè´£ç›‘è§†key,è¿‡æœŸåˆ™è‡ªåŠ¨åˆ é™¤ã€‚è™½ç„¶å†…å­˜åŠæ—¶é‡Šæ”¾ï¼Œä½†æ˜¯ååˆ†æ¶ˆè€—CPUèµ„æºã€‚åœ¨å¤§å¹¶å‘è¯·æ±‚ä¸‹ï¼ŒCPUè¦å°†æ—¶é—´åº”ç”¨åœ¨å¤„ç†è¯·æ±‚ï¼Œè€Œä¸æ˜¯åˆ é™¤keyï¼Œå› æ­¤æ²¡æœ‰é‡‡ç”¨è¿™ä¸€ç­–ç•¥.</p><p><strong>å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢?</strong></p><p>å®šæœŸåˆ é™¤ï¼ŒRedisé»˜è®¤æ¯ä¸ª100msæ£€æŸ¥ï¼Œæ˜¯å¦æœ‰è¿‡æœŸçš„keyï¼Œæœ‰è¿‡æœŸkeyåˆ™åˆ é™¤ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒRedisä¸æ˜¯æ¯ä¸ª100mså°†æ‰€æœ‰çš„keyæ£€æŸ¥ä¸€æ¬¡ï¼Œè€Œæ˜¯éšæœºæŠ½å–è¿›è¡Œæ£€æŸ¥(å¦‚æœæ¯éš”100ms,å…¨éƒ¨keyè¿›è¡Œæ£€æŸ¥ï¼ŒRediså²‚ä¸æ˜¯å¡æ­»)ã€‚å› æ­¤ï¼Œå¦‚æœåªé‡‡ç”¨å®šæœŸåˆ é™¤ç­–ç•¥ï¼Œä¼šå¯¼è‡´å¾ˆå¤škeyåˆ°æ—¶é—´æ²¡æœ‰åˆ é™¤ã€‚</p><p>äºæ˜¯ï¼Œæƒ°æ€§åˆ é™¤æ´¾ä¸Šç”¨åœºã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä½ è·å–æŸä¸ªkeyçš„æ—¶å€™ï¼ŒRedisä¼šæ£€æŸ¥ä¸€ä¸‹ï¼Œè¿™ä¸ªkeyå¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´é‚£ä¹ˆæ˜¯å¦è¿‡æœŸäº†ï¼Ÿå¦‚æœè¿‡æœŸäº†æ­¤æ—¶å°±ä¼šåˆ é™¤ã€‚</p><p><strong>é‡‡ç”¨å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤å°±æ²¡å…¶ä»–é—®é¢˜äº†ä¹ˆ?</strong></p><p>ä¸æ˜¯çš„ï¼Œå¦‚æœå®šæœŸåˆ é™¤æ²¡åˆ é™¤keyã€‚ç„¶åä½ ä¹Ÿæ²¡å³æ—¶å»è¯·æ±‚keyï¼Œä¹Ÿå°±æ˜¯è¯´æƒ°æ€§åˆ é™¤ä¹Ÿæ²¡ç”Ÿæ•ˆã€‚è¿™æ ·ï¼ŒRedisçš„å†…å­˜ä¼šè¶Šæ¥è¶Šé«˜ã€‚é‚£ä¹ˆå°±åº”è¯¥é‡‡ç”¨å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</p><p>åœ¨Redis.confä¸­æœ‰ä¸€è¡Œé…ç½®</p><div class="code-wrapper"><pre><code class="hljs pgsql">maxmemory-<span class="hljs-keyword">policy</span> <span class="hljs-keyword">volatile</span>-lru</code></pre></div><p>è¯¥é…ç½®å°±æ˜¯é…å†…å­˜æ·˜æ±°ç­–ç•¥çš„</p><ul><li>noevictionï¼šå½“å†…å­˜ä½¿ç”¨è¶…è¿‡é…ç½®çš„æ—¶å€™ä¼šè¿”å›é”™è¯¯ï¼Œä¸ä¼šé©±é€ä»»ä½•é”®</li><li>allkeys-lruï¼šåŠ å…¥é”®çš„æ—¶å€™ï¼Œå¦‚æœè¿‡é™ï¼Œé¦–å…ˆé€šè¿‡LRUç®—æ³•é©±é€æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„é”®</li><li>volatile-lruï¼šåŠ å…¥é”®çš„æ—¶å€™å¦‚æœè¿‡é™ï¼Œé¦–å…ˆä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®é›†åˆä¸­é©±é€æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„é”®</li><li>allkeys-randomï¼šåŠ å…¥é”®çš„æ—¶å€™å¦‚æœè¿‡é™ï¼Œä»æ‰€æœ‰keyéšæœºåˆ é™¤</li><li>volatile-randomï¼šåŠ å…¥é”®çš„æ—¶å€™å¦‚æœè¿‡é™ï¼Œä»è¿‡æœŸé”®çš„é›†åˆä¸­éšæœºé©±é€</li><li>volatile-ttlï¼šä»é…ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­é©±é€é©¬ä¸Šå°±è¦è¿‡æœŸçš„é”®</li><li>volatile-lfuï¼šä»æ‰€æœ‰é…ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­é©±é€ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„é”®</li><li>allkeys-lfuï¼šä»æ‰€æœ‰é”®ä¸­é©±é€ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„é”®</li></ul><p>ä¸€èˆ¬çš„ç»éªŒè§„åˆ™:</p><ul><li>ä½¿ç”¨<code>allkeys-lru</code>ç­–ç•¥ï¼šå½“é¢„æœŸè¯·æ±‚ç¬¦åˆä¸€ä¸ªå¹‚æ¬¡åˆ†å¸ƒ(äºŒå…«æ³•åˆ™ç­‰)ï¼Œæ¯”å¦‚ä¸€éƒ¨åˆ†çš„å­é›†å…ƒç´ æ¯”å…¶å®ƒå…¶å®ƒå…ƒç´ è¢«è®¿é—®çš„æ›´å¤šæ—¶ï¼Œå¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚</li><li>ä½¿ç”¨<code>allkeys-random</code>ï¼šå¾ªç¯è¿ç»­çš„è®¿é—®æ‰€æœ‰çš„é”®æ—¶ï¼Œæˆ–è€…é¢„æœŸè¯·æ±‚åˆ†å¸ƒå¹³å‡ï¼ˆæ‰€æœ‰å…ƒç´ è¢«è®¿é—®çš„æ¦‚ç‡éƒ½å·®ä¸å¤šï¼‰</li><li>ä½¿ç”¨<code>volatile-ttl</code>ï¼šè¦é‡‡å–è¿™ä¸ªç­–ç•¥ï¼Œç¼“å­˜å¯¹è±¡çš„<code>TTL</code>å€¼æœ€å¥½æœ‰å·®å¼‚</li></ul><p><code>volatile-lru</code> å’Œ <code>volatile-random</code>ç­–ç•¥ï¼Œå½“ä½ æƒ³è¦ä½¿ç”¨å•ä¸€çš„<code>Redis</code>å®ä¾‹æ¥åŒæ—¶å®ç°ç¼“å­˜æ·˜æ±°å’ŒæŒä¹…åŒ–ä¸€äº›ç»å¸¸ä½¿ç”¨çš„é”®é›†åˆæ—¶å¾ˆæœ‰ç”¨ã€‚æœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜ï¼Œè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å‚ä¸ç¼“å­˜æ·˜æ±°ã€‚ä¸è¿‡ä¸€èˆ¬è¿è¡Œä¸¤ä¸ªå®ä¾‹æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ›´å¥½æ–¹æ³•ã€‚</p><p>ä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—å†…å­˜çš„ï¼Œæ‰€ä»¥ä½¿ç”¨<code>allkeys-lru</code>è¿™ç§ç­–ç•¥æ›´åŠ èŠ‚çœç©ºé—´ï¼Œå› ä¸ºè¿™ç§ç­–ç•¥ä¸‹å¯ä»¥ä¸ä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p><h3 id="LRU"><a href="#LRU" class="headerlink" title="LRU"></a>LRU</h3><p><code>Redis</code>é…ç½®ä¸­å’Œ<code>LRU</code>æœ‰å…³çš„æœ‰ä¸‰ä¸ªï¼š</p><ul><li><code>maxmemory</code>: é…ç½®<code>Redis</code>å­˜å‚¨æ•°æ®æ—¶æŒ‡å®šé™åˆ¶çš„å†…å­˜å¤§å°ï¼Œæ¯”å¦‚<code>100m</code>ã€‚å½“ç¼“å­˜æ¶ˆè€—çš„å†…å­˜è¶…è¿‡è¿™ä¸ªæ•°å€¼æ—¶, å°†è§¦å‘æ•°æ®æ·˜æ±°ã€‚è¯¥æ•°æ®é…ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜çš„æ•°æ®é‡æ²¡æœ‰é™åˆ¶, å³LRUåŠŸèƒ½ä¸ç”Ÿæ•ˆã€‚64ä½çš„ç³»ç»Ÿé»˜è®¤å€¼ä¸º0ï¼Œ32ä½çš„ç³»ç»Ÿé»˜è®¤å†…å­˜é™åˆ¶ä¸º3GB</li><li><code>maxmemory_policy</code>: è§¦å‘æ•°æ®æ·˜æ±°åçš„æ·˜æ±°ç­–ç•¥</li><li><code>maxmemory_samples</code>: éšæœºé‡‡æ ·çš„ç²¾åº¦ï¼Œä¹Ÿå°±æ˜¯éšå³å–å‡ºkeyçš„æ•°ç›®ã€‚è¯¥æ•°å€¼é…ç½®è¶Šå¤§, è¶Šæ¥è¿‘äºçœŸå®çš„LRUç®—æ³•ï¼Œä½†æ˜¯æ•°å€¼è¶Šå¤§ï¼Œç›¸åº”æ¶ˆè€—ä¹Ÿå˜é«˜ï¼Œå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“ï¼Œæ ·æœ¬å€¼é»˜è®¤ä¸º5ã€‚</li></ul><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>LRU</code>ç®—æ³•éœ€è¦ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥è®°å½•æ•°æ®çš„æœ€è¿‘è¢«è®¿é—®é¡ºåºï¼Œä½†æ˜¯å‡ºäºèŠ‚çœå†…å­˜çš„è€ƒè™‘ï¼Œ<code>Redis</code>çš„<code>LRU</code>ç®—æ³•å¹¶éå®Œæ•´çš„å®ç°ã€‚<code>Redis</code>å¹¶ä¸ä¼šé€‰æ‹©æœ€ä¹…æœªè¢«è®¿é—®çš„é”®è¿›è¡Œå›æ”¶ï¼Œç›¸åå®ƒä¼šå°è¯•è¿è¡Œä¸€ä¸ªè¿‘ä¼¼<code>LRU</code>çš„ç®—æ³•ï¼Œé€šè¿‡å¯¹å°‘é‡é”®è¿›è¡Œå–æ ·ï¼Œç„¶åå›æ”¶å…¶ä¸­çš„æœ€ä¹…æœªè¢«è®¿é—®çš„é”®ã€‚é€šè¿‡è°ƒæ•´æ¯æ¬¡å›æ”¶æ—¶çš„é‡‡æ ·æ•°é‡<code>maxmemory-samples</code>ï¼Œå¯ä»¥å®ç°è°ƒæ•´ç®—æ³•çš„ç²¾åº¦ã€‚</p><p>æ ¹æ®<code>Redis</code>ä½œè€…çš„è¯´æ³•ï¼Œæ¯ä¸ª<code>Redis Object</code>å¯ä»¥æŒ¤å‡º24 bitsçš„ç©ºé—´ï¼Œä½†24 bitsæ˜¯ä¸å¤Ÿå­˜å‚¨ä¸¤ä¸ªæŒ‡é’ˆçš„ï¼Œè€Œå­˜å‚¨ä¸€ä¸ªä½ä½æ—¶é—´æˆ³æ˜¯è¶³å¤Ÿçš„ï¼Œ<code>Redis Object</code>ä»¥ç§’ä¸ºå•ä½å­˜å‚¨äº†å¯¹è±¡æ–°å»ºæˆ–è€…æ›´æ–°æ—¶çš„<code>unix time</code>ï¼Œä¹Ÿå°±æ˜¯<code>LRU clock</code>ï¼Œ24 bitsæ•°æ®è¦æº¢å‡ºçš„è¯éœ€è¦194å¤©ï¼Œè€Œç¼“å­˜çš„æ•°æ®æ›´æ–°éå¸¸é¢‘ç¹ï¼Œå·²ç»è¶³å¤Ÿäº†ã€‚</p><p><code>Redis</code>çš„é”®ç©ºé—´æ˜¯æ”¾åœ¨ä¸€ä¸ªå“ˆå¸Œè¡¨ä¸­çš„ï¼Œè¦ä»æ‰€æœ‰çš„é”®ä¸­é€‰å‡ºä¸€ä¸ªæœ€ä¹…æœªè¢«è®¿é—®çš„é”®ï¼Œéœ€è¦å¦å¤–ä¸€ä¸ªæ•°æ®ç»“æ„å­˜å‚¨è¿™äº›æºä¿¡æ¯ï¼Œè¿™æ˜¾ç„¶ä¸åˆ’ç®—ã€‚æœ€åˆï¼Œ<code>Redis</code>åªæ˜¯éšæœºçš„é€‰3ä¸ªkeyï¼Œç„¶åä»ä¸­æ·˜æ±°ï¼Œåæ¥ç®—æ³•æ”¹è¿›åˆ°äº†<code>Nä¸ªkey</code>çš„ç­–ç•¥ï¼Œé»˜è®¤æ˜¯5ä¸ªã€‚</p><p><code>Redis</code>3.0ä¹‹ååˆæ”¹å–„äº†ç®—æ³•çš„æ€§èƒ½ï¼Œä¼šæä¾›ä¸€ä¸ªå¾…æ·˜æ±°å€™é€‰keyçš„<code>pool</code>ï¼Œé‡Œé¢é»˜è®¤æœ‰16ä¸ªkeyï¼ŒæŒ‰ç…§ç©ºé—²æ—¶é—´æ’å¥½åºã€‚æ›´æ–°æ—¶ä»<code>Redis</code>é”®ç©ºé—´éšæœºé€‰æ‹©Nä¸ªkeyï¼Œåˆ†åˆ«è®¡ç®—å®ƒä»¬çš„ç©ºé—²æ—¶é—´<code>idle</code>ï¼Œkeyåªä¼šåœ¨<code>pool</code>ä¸æ»¡æˆ–è€…ç©ºé—²æ—¶é—´å¤§äº<code>pool</code>é‡Œæœ€å°çš„æ—¶ï¼Œæ‰ä¼šè¿›å…¥<code>pool</code>ï¼Œç„¶åä»<code>pool</code>ä¸­é€‰æ‹©ç©ºé—²æ—¶é—´æœ€å¤§çš„keyæ·˜æ±°æ‰ã€‚</p><p>çœŸå®<code>LRU</code>ç®—æ³•ä¸è¿‘ä¼¼<code>LRU</code>çš„ç®—æ³•å¯ä»¥é€šè¿‡ä¸‹é¢çš„å›¾åƒå¯¹æ¯”ï¼š <img src="https://upload-images.jianshu.io/upload_images/12062369-7fae1afe70569623.png" alt="img"></p><p>æµ…ç°è‰²å¸¦æ˜¯å·²ç»è¢«æ·˜æ±°çš„å¯¹è±¡ï¼Œç°è‰²å¸¦æ˜¯æ²¡æœ‰è¢«æ·˜æ±°çš„å¯¹è±¡ï¼Œç»¿è‰²å¸¦æ˜¯æ–°æ·»åŠ çš„å¯¹è±¡ã€‚å¯ä»¥çœ‹å‡ºï¼Œ<code>maxmemory-samples</code>å€¼ä¸º5æ—¶<code>Redis 3.0</code>æ•ˆæœæ¯”<code>Redis 2.8</code>è¦å¥½ã€‚ä½¿ç”¨10ä¸ªé‡‡æ ·å¤§å°çš„<code>Redis 3.0</code>çš„è¿‘ä¼¼<code>LRU</code>ç®—æ³•å·²ç»éå¸¸æ¥è¿‘ç†è®ºçš„æ€§èƒ½äº†ã€‚</p><p>æ•°æ®è®¿é—®æ¨¡å¼éå¸¸æ¥è¿‘å¹‚æ¬¡åˆ†å¸ƒæ—¶ï¼Œä¹Ÿå°±æ˜¯å¤§éƒ¨åˆ†çš„è®¿é—®é›†ä¸­äºéƒ¨åˆ†é”®æ—¶ï¼Œ<code>LRU</code>è¿‘ä¼¼ç®—æ³•ä¼šå¤„ç†å¾—å¾ˆå¥½ã€‚</p><p><strong>Redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨åŸç”ŸLRUç®—æ³•ï¼Ÿ</strong></p><ul><li>åŸç”ŸLRUç®—æ³•éœ€è¦ åŒå‘é“¾è¡¨ æ¥ç®¡ç†æ•°æ®ï¼Œéœ€è¦<strong>é¢å¤–å†…å­˜</strong></li><li>æ•°æ®è®¿é—®æ—¶æ¶‰åŠ<strong>æ•°æ®ç§»åŠ¨ï¼Œæœ‰æ€§èƒ½æŸè€—</strong></li><li>Redisç°æœ‰<strong>æ•°æ®ç»“æ„éœ€è¦æ”¹é€ </strong></li></ul><h3 id="LFU"><a href="#LFU" class="headerlink" title="LFU"></a>LFU</h3><p>åœ¨<code>LFU</code>ç®—æ³•ä¸­ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªkeyç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ã€‚æ¯æ¬¡keyè¢«è®¿é—®çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å¢å¤§ã€‚è®¡æ•°å™¨è¶Šå¤§ï¼Œå¯ä»¥çº¦ç­‰äºè®¿é—®è¶Šé¢‘ç¹ã€‚</p><p>ä¸Šè¿°ç®€å•ç®—æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>åœ¨<code>LRU</code>ç®—æ³•ä¸­å¯ä»¥ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç„¶åç®€å•çš„æŠŠè¢«è®¿é—®çš„èŠ‚ç‚¹ç§»è‡³é“¾è¡¨å¼€å¤´ï¼Œä½†åœ¨<code>LFU</code>ä¸­æ˜¯ä¸å¯è¡Œçš„ï¼ŒèŠ‚ç‚¹è¦ä¸¥æ ¼æŒ‰ç…§è®¡æ•°å™¨è¿›è¡Œæ’åºï¼Œæ–°å¢èŠ‚ç‚¹æˆ–è€…æ›´æ–°èŠ‚ç‚¹ä½ç½®æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦å¯èƒ½è¾¾åˆ°O(N)ã€‚</li><li>åªæ˜¯ç®€å•çš„å¢åŠ è®¡æ•°å™¨çš„æ–¹æ³•å¹¶ä¸å®Œç¾ã€‚è®¿é—®æ¨¡å¼æ˜¯ä¼šé¢‘ç¹å˜åŒ–çš„ï¼Œä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„keyä¸€æ®µæ—¶é—´ä¹‹åå¯èƒ½ä¼šå¾ˆå°‘è¢«è®¿é—®åˆ°ï¼Œåªå¢åŠ è®¡æ•°å™¨å¹¶ä¸èƒ½ä½“ç°è¿™ç§è¶‹åŠ¿ã€‚</li></ul><p>ç¬¬ä¸€ä¸ªé—®é¢˜å¾ˆå¥½è§£å†³ï¼Œå¯ä»¥å€Ÿé‰´<code>LRU</code>å®ç°çš„ç»éªŒï¼Œç»´æŠ¤ä¸€ä¸ªå¾…æ·˜æ±°keyçš„poolã€‚ç¬¬äºŒä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æ˜¯ï¼Œè®°å½•keyæœ€åä¸€ä¸ªè¢«è®¿é—®çš„æ—¶é—´ï¼Œç„¶åéšç€æ—¶é—´æ¨ç§»ï¼Œé™ä½è®¡æ•°å™¨ã€‚</p><p><code>Redis</code>å¯¹è±¡çš„ç»“æ„å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs verilog"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> RedisObject &#123;    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">type</span>:<span class="hljs-number">4</span>;    <span class="hljs-keyword">unsigned</span> encoding:<span class="hljs-number">4</span>;    <span class="hljs-keyword">unsigned</span> lru:LRU_BITS; <span class="hljs-comment">/* LRU time (relative to global lru_clock) or</span><span class="hljs-comment">                            * LFU data (least significant 8 bits frequency</span><span class="hljs-comment">                            * and most significant 16 bits access time). */</span>    <span class="hljs-keyword">int</span> refcount;    <span class="hljs-keyword">void</span> *ptr;&#125; robj;</code></pre></div><p>åœ¨<code>LRU</code>ç®—æ³•ä¸­ï¼Œ24 bitsçš„<code>lru</code>æ˜¯ç”¨æ¥è®°å½•<code>LRU time</code>çš„ï¼Œåœ¨<code>LFU</code>ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—æ®µï¼Œä¸è¿‡æ˜¯åˆ†æˆ16 bitsä¸8 bitsä½¿ç”¨ï¼š</p><div class="code-wrapper"><pre><code class="hljs asciidoc"><span class="hljs-section">     16 bits      8 bits</span><span class="hljs-section">+----------------+--------+</span><span class="hljs-section">+ Last decr time | LOG_C  |</span><span class="hljs-section">+----------------+--------+</span></code></pre></div><p>é«˜16 bitsç”¨æ¥è®°å½•æœ€è¿‘ä¸€æ¬¡è®¡æ•°å™¨é™ä½çš„æ—¶é—´<code>ldt</code>ï¼Œå•ä½æ˜¯åˆ†é’Ÿï¼Œä½8 bitsè®°å½•è®¡æ•°å™¨æ•°å€¼<code>counter</code>ã€‚</p><h3 id="LFUé…ç½®"><a href="#LFUé…ç½®" class="headerlink" title="LFUé…ç½®"></a>LFUé…ç½®</h3><p><code>Redis</code>4.0ä¹‹åä¸º<code>maxmemory_policy</code>æ·˜æ±°ç­–ç•¥æ·»åŠ äº†ä¸¤ä¸ª<code>LFU</code>æ¨¡å¼ï¼š</p><ul><li><code>volatile-lfu</code>ï¼šå¯¹æœ‰è¿‡æœŸæ—¶é—´çš„keyé‡‡ç”¨<code>LFU</code>æ·˜æ±°ç®—æ³•</li><li><code>allkeys-lfu</code>ï¼šå¯¹å…¨éƒ¨keyé‡‡ç”¨<code>LFU</code>æ·˜æ±°ç®—æ³•</li></ul><p>è¿˜æœ‰2ä¸ªé…ç½®å¯ä»¥è°ƒæ•´<code>LFU</code>ç®—æ³•ï¼š</p><div class="code-wrapper"><pre><code class="hljs maxima">lfu-<span class="hljs-built_in">log</span>-<span class="hljs-built_in">factor</span> <span class="hljs-number">10</span>lfu-decay-<span class="hljs-built_in">time</span> <span class="hljs-number">1</span></code></pre></div><p><code>lfu-log-factor</code>å¯ä»¥è°ƒæ•´è®¡æ•°å™¨<code>counter</code>çš„å¢é•¿é€Ÿåº¦ï¼Œ<code>lfu-log-factor</code>è¶Šå¤§ï¼Œ<code>counter</code>å¢é•¿çš„è¶Šæ…¢ã€‚</p><p><code>lfu-decay-time</code>æ˜¯ä¸€ä¸ªä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ•°å€¼ï¼Œå¯ä»¥è°ƒæ•´<code>counter</code>çš„å‡å°‘é€Ÿåº¦</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/linxiyue/p/10945216.html">Redisä¸­çš„LRUæ·˜æ±°ç­–ç•¥åˆ†æ</a></li><li><a href="https://www.cnblogs.com/linxiyue/p/10955533.html">Redisä¸­çš„LFUç®—æ³•</a></li><li><a href="https://www.cnblogs.com/phyger/p/14068656.html">ç©è½¬Redis-8ç§æ•°æ®æ·˜æ±°ç­–ç•¥åŠè¿‘ä¼¼LRUã€LFUåŸç†</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8sçš„å®‰è£…ï¼ˆMacï¼‰</title>
    <link href="/2021/03/13/320/"/>
    <url>/2021/03/13/320/</url>
    
    <content type="html"><![CDATA[<p>å°è±¡ä¸­ä¹‹å‰macè£…k8sæŒºéº»çƒ¦ï¼Œä¹‹å‰è£…çš„ç‰ˆæœ¬è¾ƒä½v1.14.7ã€‚æœ€è¿‘æ€»æç¤ºæˆ‘æ›´æ–°ï¼Œåˆšå¥½æ›´æ–°ä¸€ä¸‹ï¼Œé¡ºä¾¿è®°å½•ä¸‹è¿‡ç¨‹ã€‚</p><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><ol><li>ä¸‹è½½å®‰è£…[docker-desktop]<a href="https://www.docker.com/products/docker-desktop">https://www.docker.com/products/docker-desktop</a></li><li>ä¿®æ”¹Docker Engineé…ç½®ï¼Œä¿®æ”¹é•œåƒæº<div class="code-wrapper"><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;registry-mirrors&quot;</span>: [    <span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,    <span class="hljs-string">&quot;https://hub-mirror.c.163.com&quot;</span>,    <span class="hljs-string">&quot;http://f1361db2.m.daocloud.io&quot;</span>  ],  <span class="hljs-attr">&quot;experimental&quot;</span>: <span class="hljs-literal">false</span>,  <span class="hljs-attr">&quot;features&quot;</span>: &#123;    <span class="hljs-attr">&quot;buildkit&quot;</span>: <span class="hljs-literal">true</span>  &#125;&#125;</code></pre></div></li><li>å®‰è£…k8s.gcr.ioç­‰ç»„ä»¶<div class="code-wrapper"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/AliyunContainerService/</span>k8s-<span class="hljs-keyword">for</span>-docker-desktop.git<span class="hljs-regexp">//</span>åˆ‡æ¢åˆ°ä½ çš„k8sç‰ˆæœ¬ï¼Œæˆ‘çš„æ˜¯v1.<span class="hljs-number">19.7</span>git checkout v1.<span class="hljs-number">19.7</span></code></pre></div></li></ol><p>æ‰§è¡Œ</p><div class="code-wrapper"><pre><code class="hljs jboss-cli"><span class="hljs-string">./load_images.sh</span></code></pre></div><p>å®‰è£…k8sä¾èµ–ã€‚<br>4. Enable Kubernetesï¼Œé‡å¯ï¼ŒKuberneteså¯åŠ¨æ¯”Dockeræ…¢å¤šäº†ï¼Œç¨å¾®ç­‰ä¸€ä¼šå°±å¥½ã€‚</p><h2 id="å®‰è£…kubernetes-dashboard"><a href="#å®‰è£…kubernetes-dashboard" class="headerlink" title="å®‰è£…kubernetes/dashboard"></a>å®‰è£…kubernetes/dashboard</h2><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/kubernetes/dashboard">https://github.com/kubernetes/dashboard</a></p><div class="code-wrapper"><pre><code class="hljs awk">kubectl apply -f https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/kubernetes/</span>dashboard<span class="hljs-regexp">/v2.2.0/</span>aio<span class="hljs-regexp">/deploy/</span>recommended.yaml</code></pre></div><p>å¦‚æœæ‰§è¡Œè¶…æ—¶ï¼Œå¯ä»¥æŠŠyamlæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°è¿è¡Œã€‚</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">kubectl</span> get pod --namespace=kubernetes-dashboard<span class="hljs-attribute">output</span>:<span class="hljs-attribute">NAME</span>                                         READY   STATUS    RESTARTS   AGE<span class="hljs-attribute">dashboard</span>-metrics-scraper-<span class="hljs-number">79</span>c<span class="hljs-number">5968</span>bdc-xvrzd   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m<span class="hljs-number">13</span>s<span class="hljs-attribute">kubernetes</span>-dashboard-<span class="hljs-number">9</span>f<span class="hljs-number">9799597</span>-<span class="hljs-number">9</span>kmbk         <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m<span class="hljs-number">13</span>s</code></pre></div><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå®‰è£…ubernetes-dashboardã€‚</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><div class="code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">kubectl proxy</span></code></pre></div><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><p>æ‰“å¼€æµè§ˆå™¨ï¼š<a href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login</a></p><p>é€‰æ‹©Tokenç™»å½•ï¼Œç”¨ä¸‹æ–¹å‘½ä»¤è·å–tokenï¼Œç™»å½•æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°ç•Œé¢ã€‚<br><img src="https://github.com/kubernetes/dashboard/raw/master/docs/images/dashboard-ui.png" alt="kubernetes-dashboard"></p><h3 id="è·å–token"><a href="#è·å–token" class="headerlink" title="è·å–token"></a>è·å–token</h3><div class="code-wrapper"><pre><code class="hljs reasonml">kubectl -n kube-system describe <span class="hljs-constructor">$(<span class="hljs-params">kubectl</span> -<span class="hljs-params">n</span> <span class="hljs-params">kube</span>-<span class="hljs-params">system</span> <span class="hljs-params">get</span> <span class="hljs-params">secret</span> -<span class="hljs-params">n</span> <span class="hljs-params">kube</span>-<span class="hljs-params">system</span> -<span class="hljs-params">o</span> <span class="hljs-params">name</span> | <span class="hljs-params">grep</span> <span class="hljs-params">namespace</span>)</span> <span class="hljs-pattern-match">| grep token</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RedisåŸºç¡€ç±»å‹ã€å¸¸ç”¨çŸ¥è¯†</title>
    <link href="/2021/03/08/base/"/>
    <url>/2021/03/08/base/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸»è¦ç±»å‹"><a href="#ä¸»è¦ç±»å‹" class="headerlink" title="ä¸»è¦ç±»å‹"></a>ä¸»è¦ç±»å‹</h2><ul><li>å­—ç¬¦ä¸²ï¼ˆstringsï¼Œbitmapsï¼‰</li><li>æ•£åˆ—ï¼ˆhashesï¼‰</li><li>åˆ—è¡¨ï¼ˆlistsï¼‰</li><li>é›†åˆï¼ˆsetsï¼‰</li><li>æœ‰åºé›†åˆï¼ˆsorted setsï¼‰</li><li>hyperloglogs</li><li>å‘å¸ƒè®¢é˜…ï¼ˆpub/subï¼‰</li><li>åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰</li><li>Streamï¼ˆ5.0ç‰ˆæœ¬æ–°å¢ï¼‰</li></ul><p>å…³äºå‘½ä»¤æˆ‘æ¨èçœ‹è¿™ä¸¤ä¸ªï¼š</p><ul><li><a href="http://doc.redisfans.com/">http://doc.Redisfans.com/</a></li><li><a href="http://www.redis.cn/commands.html">http://www.Redis.cn/commands.html</a></li></ul><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><h3 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h3><ul><li>ç¼“å­˜</li><li>åˆ†å¸ƒå¼é”ï¼ˆsetnxï¼‰</li><li>ç­¾åˆ°ç»Ÿè®¡ï¼ˆsetbitï¼‰</li><li>è®¡æ•°ï¼ˆincrï¼‰</li></ul><h3 id="hashes"><a href="#hashes" class="headerlink" title="hashes"></a>hashes</h3><ul><li>ç¼“å­˜</li><li>ç”¨æˆ·æ ‡ç­¾</li></ul><h3 id="lists"><a href="#lists" class="headerlink" title="lists"></a>lists</h3><ul><li>é˜Ÿåˆ—</li></ul><h3 id="sets"><a href="#sets" class="headerlink" title="sets"></a>sets</h3><ul><li>äº¤é›†å¹¶é›†</li><li>æ•°æ®å»é‡</li></ul><h3 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h3><ul><li>æ’è¡Œæ¦œ</li><li>å»¶æ—¶ä»»åŠ¡</li><li>é™æµ</li></ul><h3 id="hyperloglogs"><a href="#hyperloglogs" class="headerlink" title="hyperloglogs"></a>hyperloglogs</h3><ul><li>uvç»Ÿè®¡ï¼ˆipç»Ÿè®¡ï¼‰</li></ul><h3 id="pub-sub"><a href="#pub-sub" class="headerlink" title="pub/sub"></a>pub/sub</h3><ul><li>å‘å¸ƒè®¢é˜…ï¼ˆä¸æ˜¯ç‰¹åˆ«å¯é ï¼‰</li></ul><h3 id="geospatial"><a href="#geospatial" class="headerlink" title="geospatial"></a>geospatial</h3><ul><li>é™„è¿‘çš„äºº</li></ul><h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><ul><li>é˜Ÿåˆ—</li><li>å‘å¸ƒè®¢é˜…</li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€"><a href="#åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€" class="headerlink" title="åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€"></a>åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€</h4><p>ä»¥phpä»£ç ä¸ºä¾‹ï¼š</p><blockquote><p>WATCHå‘½ä»¤å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œã€‚ç›‘æ§ä¸€ç›´æŒç»­åˆ°EXECå‘½ä»¤ï¼ˆäº‹åŠ¡ä¸­çš„å‘½ä»¤æ˜¯åœ¨EXECä¹‹åæ‰æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨MULTIå‘½ä»¤åå¯ä»¥ä¿®æ”¹WATCHç›‘æ§çš„é”®å€¼ï¼‰</p></blockquote><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> åº“å­˜ä¸º<span class="hljs-number">5</span><span class="hljs-regexp">//</span>å®ä¾‹åŒ–Redis<span class="hljs-variable">$Redis</span> = new Redis();<span class="hljs-regexp">//</span>è¿æ¥<span class="hljs-variable">$Redis</span>-&gt;connect(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">6379</span>);<span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;sale&#x27;</span>;<span class="hljs-variable">$Redis</span>-&gt;setnx(<span class="hljs-variable">$key</span>, <span class="hljs-number">0</span>); <span class="hljs-regexp">//</span> æ­¤é¡¹ä¸é¢„å®šä¹‰äº¦å¯ï¼Œä¿è¯keyå”¯ä¸€å°±è¡Œ<span class="hljs-variable">$Redis</span>-&gt;watch(<span class="hljs-variable">$key</span>); <span class="hljs-regexp">//</span>ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚<span class="hljs-variable">$sale_num</span> = <span class="hljs-variable">$Redis</span>-&gt;get(<span class="hljs-variable">$key</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$sale_num</span> &gt; <span class="hljs-number">4</span>) &#123;<span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$Redis</span>-&gt;multi(); <span class="hljs-regexp">//</span>æ ‡è®°äº‹åŠ¡<span class="hljs-variable">$Redis</span>-&gt;incr(<span class="hljs-variable">$key</span>);  <span class="hljs-regexp">//</span>é”€é‡+<span class="hljs-number">1</span>sleep(<span class="hljs-number">1</span>); <span class="hljs-regexp">//</span>æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ<span class="hljs-variable">$ret</span> = <span class="hljs-variable">$Redis</span>-&gt;exec(); <span class="hljs-regexp">//</span> äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚<span class="hljs-keyword">if</span> (<span class="hljs-variable">$ret</span>) &#123;    <span class="hljs-regexp">//</span> è‡ªå®šä¹‰çš„ä¸€ä¸ªåŸºäºmedooçš„dbclassinclude <span class="hljs-string">&#x27;db.php&#x27;</span>;<span class="hljs-variable">$db</span> = new db([    <span class="hljs-string">&#x27;database_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;mysql&#x27;</span>,    <span class="hljs-string">&#x27;database_name&#x27;</span> =&gt; <span class="hljs-string">&#x27;test&#x27;</span>,    <span class="hljs-string">&#x27;server&#x27;</span> =&gt; <span class="hljs-string">&#x27;13sai&#x27;</span>,    <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;13sai&#x27;</span>,    <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;*&#x27;</span>,    <span class="hljs-string">&#x27;charset&#x27;</span> =&gt; <span class="hljs-string">&#x27;utf8&#x27;</span>]);<span class="hljs-variable">$db</span>-&gt;update(<span class="hljs-string">&#x27;goods&#x27;</span>, [<span class="hljs-string">&quot;stock_num[-]&quot;</span> =&gt; <span class="hljs-number">1</span>], [<span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">1</span>]);&#125;</code></pre></div><h4 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h4><blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/201910/30/41489/7MfaHZCwKT.png!large" alt="bloom"></p><p>phpå®ç°æ¨èçœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š</p><ul><li><a href="https://github.oscome.cn/2019/05/21/188/">https://github.oscome.cn/2019/05/21/188/</a></li></ul><p>å½“ç„¶ï¼ŒRedisè‡ªå·±ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š</p><ul><li><a href="https://github.com/RedisBloom/RedisBloom">https://github.com/RedisBloom/RedisBloom</a></li></ul><div class="code-wrapper"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/RedisBloom/</span>RedisBloom.gitcd Redisbloommake<span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/Redis-server --loadmodule ./</span>Redisbloom.so</code></pre></div><p>Bloomï¼šå‘è¿‡æ»¤å™¨æ·»åŠ æ–°é¡¹,å¦‚æœå°šä¸å­˜åœ¨ï¼Œåˆ™ä¼šä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨</p><div class="code-wrapper"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; BF.ADD newFilter foo(integer) <span class="hljs-number">1</span></code></pre></div><p>Bloomï¼šæ£€æŸ¥è¿‡æ»¤å™¨ä¸­æ˜¯å¦å­˜åœ¨é¡¹</p><div class="code-wrapper"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; BF.EXISTS newFilter foo(integer) <span class="hljs-number">1</span><span class="hljs-number">127.0.0.1:6379</span>&gt; BF.EXISTS newFilter notpresent(integer) <span class="hljs-number">0</span></code></pre></div><h3 id="é™æµRedis-cell"><a href="#é™æµRedis-cell" class="headerlink" title="é™æµRedis-cell"></a>é™æµRedis-cell</h3><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> æå‰å®‰è£…rustå“Ÿgit clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/brandur/</span>Redis-cell.gitcd Redis-cellcargo build --releasecp target<span class="hljs-regexp">/release/</span>libRedis_cell.dylib <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/modules/</span>Redis-server --loadmodule <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/modules/</span>libRedis_cell.so</code></pre></div><p>è¯¥æ¨¡å—åªæœ‰1æ¡æŒ‡ä»¤cl.throttleï¼Œå®ƒçš„å‚æ•°å’Œè¿”å›å€¼éƒ½ç•¥æ˜¾å¤æ‚ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæŒ‡ä»¤å…·ä½“è¯¥å¦‚ä½•ä½¿ç”¨ã€‚</p><div class="code-wrapper"><pre><code class="hljs gherkin">&gt; cl.throttle limitThrot  15  30  60  1                    â–²     â–²  â–²  â–²  â–²                    |<span class="hljs-string">     </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â””â”€â”€â”€â”€â”€ need 1 quota (å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯1)</span><span class="hljs-string">                    </span>|<span class="hljs-string">     </span>|<span class="hljs-string">  â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€ 30 operations / 60 seconds è¿™æ˜¯æ¼æ°´é€Ÿç‡</span><span class="hljs-string">                    </span>|<span class="hljs-string">     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 15 capacity è¿™æ˜¯æ¼æ–—å®¹é‡</span><span class="hljs-string">&gt;                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ key</span></code></pre></div><p>ä¸Šé¢è¿™ä¸ªæŒ‡ä»¤çš„æ„æ€æ˜¯å…è®¸é¢‘ç‡ä¸ºæ¯ 60s æœ€å¤š 30 æ¬¡(æ¼æ°´é€Ÿç‡)ï¼Œæ¼æ–—çš„åˆå§‹å®¹é‡ä¸º 15ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹å¯ä»¥å– 15 ä¸ªï¼Œç„¶åæ‰å¼€å§‹å—æ¼æ°´é€Ÿç‡çš„å½±å“ã€‚æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªæŒ‡ä»¤ä¸­æ¼æ°´é€Ÿç‡å˜æˆäº† 2 ä¸ªå‚æ•°ï¼Œæ›¿ä»£äº†ä¹‹å‰çš„å•ä¸ªæµ®ç‚¹æ•°ã€‚ç”¨ä¸¤ä¸ªå‚æ•°ç›¸é™¤çš„ç»“æœæ¥è¡¨è¾¾æ¼æ°´é€Ÿç‡ç›¸å¯¹å•ä¸ªæµ®ç‚¹æ•°è¦æ›´åŠ ç›´è§‚ä¸€äº›ã€‚</p><div class="code-wrapper"><pre><code class="hljs tap">&gt; cl.throttle limitThrot<span class="hljs-number"> 15 </span>30<span class="hljs-number"> 60 </span>11) (integer)<span class="hljs-number"> 0 </span>  <span class="hljs-comment"># 0 è¡¨ç¤ºå…è®¸ï¼Œ1è¡¨ç¤ºæ‹’ç»</span>2) (integer)<span class="hljs-number"> 15 </span> <span class="hljs-comment"># æ¼æ–—å®¹é‡capacity</span>3) (integer)<span class="hljs-number"> 14 </span> <span class="hljs-comment"># æ¼æ–—å‰©ä½™ç©ºé—´left_quota</span>4) (integer) -1  <span class="hljs-comment"># å¦‚æœæ‹’ç»äº†ï¼Œéœ€è¦å¤šé•¿æ—¶é—´åå†è¯•(æ¼æ–—æœ‰ç©ºé—´äº†ï¼Œå•ä½ç§’)</span>5) (integer)<span class="hljs-number"> 2 </span>  <span class="hljs-comment"># å¤šé•¿æ—¶é—´åï¼Œæ¼æ–—å®Œå…¨ç©ºå‡ºæ¥(left_quota==capacityï¼Œå•ä½ç§’)</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisä½¿ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</title>
    <link href="/2021/02/28/quick/"/>
    <url>/2021/02/28/quick/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Redis6.0å¼•å…¥äº†å¤šçº¿ç¨‹ã€‚å®é™…ä¸Šå¤šçº¿ç¨‹åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œåè®®è§£æï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•ä¸€å·¥ä½œçº¿ç¨‹ã€‚</p></blockquote><p>Redis é‡‡ç”¨çš„æ˜¯åŸºäºå†…å­˜çš„é‡‡ç”¨çš„æ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å‹çš„ KV æ•°æ®åº“ï¼Œç”± C è¯­è¨€ç¼–å†™ã€‚å®˜æ–¹æä¾›çš„æ•°æ®æ˜¯å¯ä»¥è¾¾åˆ°100k+çš„qpsã€‚è¿™ä¸ªæ•°æ®ä¸æ¯”é‡‡ç”¨å•è¿›ç¨‹å¤šçº¿ç¨‹çš„åŒæ ·åŸºäºå†…å­˜çš„ KV æ•°æ®åº“ Memcached å·®ã€‚</p><p>Redis å¿«çš„ä¸»è¦åŸå› æœ‰ï¼š</p><ol><li>å®Œå…¨åŸºäºå†…å­˜</li><li>æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•</li><li>ä½¿ç”¨å¤šè·¯ I/O å¤ç”¨æ¨¡å‹,éé˜»å¡IO</li><li>é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€—CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—</li><li>ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedisç›´æ¥è‡ªå·±æ„å»ºäº†VMæœºåˆ¶ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚</li></ol><h3 id="å¤šè·¯-I-O-å¤ç”¨æ¨¡å‹"><a href="#å¤šè·¯-I-O-å¤ç”¨æ¨¡å‹" class="headerlink" title="å¤šè·¯ I/O å¤ç”¨æ¨¡å‹"></a>å¤šè·¯ I/O å¤ç”¨æ¨¡å‹</h3><p>å¤šè·¯ I/O å¤ç”¨æ¨¡å‹æ˜¯åˆ©ç”¨ selectã€pollã€epoll å¯ä»¥åŒæ—¶ç›‘å¯Ÿå¤šä¸ªæµçš„ I/O äº‹ä»¶çš„èƒ½åŠ›ï¼Œåœ¨ç©ºé—²çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰çº¿ç¨‹é˜»å¡æ‰ï¼Œå½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµæœ‰ I/O äº‹ä»¶æ—¶ï¼Œå°±ä»é˜»å¡æ€ä¸­å”¤é†’ï¼Œäºæ˜¯ç¨‹åºå°±ä¼šè½®è¯¢ä¸€éæ‰€æœ‰çš„æµï¼ˆepoll æ˜¯åªè½®è¯¢é‚£äº›çœŸæ­£å‘å‡ºäº†äº‹ä»¶çš„æµï¼‰ï¼Œå¹¶ä¸”åªä¾æ¬¡é¡ºåºçš„å¤„ç†å°±ç»ªçš„æµï¼Œè¿™ç§åšæ³•å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚è¿™é‡Œâ€œå¤šè·¯â€æŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œâ€œå¤ç”¨â€æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚é‡‡ç”¨å¤šè·¯ I/O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªè¿æ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œ IO çš„æ—¶é—´æ¶ˆè€—ï¼‰ï¼Œä¸” Redis åœ¨å†…å­˜ä¸­æ“ä½œæ•°æ®çš„é€Ÿåº¦éå¸¸å¿«ï¼ˆå†…å­˜å†…çš„æ“ä½œä¸ä¼šæˆä¸ºè¿™é‡Œçš„æ€§èƒ½ç“¶é¢ˆï¼‰ï¼Œä¸»è¦ä»¥ä¸Šä¸¤ç‚¹é€ å°±äº† Redis å…·æœ‰å¾ˆé«˜çš„ååé‡ã€‚</p><p>å’Œ Memcached ä¸åŒï¼ŒRedis å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ Libeventï¼Œè€Œæ˜¯è‡ªå·±å®Œæˆäº†ä¸€ä¸ªéå¸¸è½»é‡çº§çš„å¯¹ selectã€epollã€evportã€kqueue è¿™äº›é€šç”¨çš„æ¥å£çš„å®ç°ã€‚åœ¨ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨é€‰ç”¨é€‚åˆçš„æ¥å£ï¼Œlinux ä¸‹é»˜è®¤æ˜¯ epollã€‚å› ä¸º Libevent æ¯”è¾ƒé‡ï¼Œæ›´é€šç”¨ï¼Œä»£ç é‡ä¹Ÿå°±å¾ˆåºå¤§ï¼Œæ‹¥æœ‰å¾ˆå¤š Redis ç”¨ä¸ä¸Šçš„åŠŸèƒ½ï¼ŒRedis ä¸ºäº†è¿½æ±‚â€œè½»å·§â€å¹¶ä¸”å»é™¤ä¾èµ–ï¼Œå°±é€‰æ‹©è‡ªå·±å»å°è£…äº†ä¸€å¥—ã€‚</p><h3 id="å•è¿›ç¨‹å•çº¿ç¨‹å¥½å¤„"><a href="#å•è¿›ç¨‹å•çº¿ç¨‹å¥½å¤„" class="headerlink" title="å•è¿›ç¨‹å•çº¿ç¨‹å¥½å¤„"></a>å•è¿›ç¨‹å•çº¿ç¨‹å¥½å¤„</h3><ol><li>ä»£ç æ›´æ¸…æ™°ï¼Œå¤„ç†é€»è¾‘æ›´ç®€å•</li><li>ä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—</li><li>ä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPU</li></ol>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goçš„GCæœºåˆ¶</title>
    <link href="/2021/02/27/319/"/>
    <url>/2021/02/27/319/</url>
    
    <content type="html"><![CDATA[<h2 id="Golangçš„æ ‡è®°æ¸…é™¤"><a href="#Golangçš„æ ‡è®°æ¸…é™¤" class="headerlink" title="Golangçš„æ ‡è®°æ¸…é™¤"></a>Golangçš„æ ‡è®°æ¸…é™¤</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€šè¿‡gcmarkBitsä½å›¾æ ‡è®°spançš„å—æ˜¯å¦è¢«å¼•ç”¨ã€‚å¯¹åº”å†…å­˜åˆ†é…ä¸­çš„bitmapåŒºã€‚</p><h3 id="ä¸‰è‰²æ ‡è®°"><a href="#ä¸‰è‰²æ ‡è®°" class="headerlink" title="ä¸‰è‰²æ ‡è®°"></a>ä¸‰è‰²æ ‡è®°</h3><ul><li><p>ç™½è‰²ï¼šå¯¹è±¡æœªè¢«æ ‡è®°ï¼ŒgcmarkBitså¯¹åº”çš„ä½ä¸º0ï¼ˆè¯¥å¯¹è±¡å°†ä¼šåœ¨æœ¬æ¬¡GCä¸­è¢«æ¸…ç†ï¼‰</p></li><li><p>ç°è‰²ï¼šå¯¹è±¡å·²è¢«æ ‡è®°ï¼Œä½†è¿™ä¸ªå¯¹è±¡åŒ…å«çš„å­å¯¹è±¡æœªæ ‡è®°</p></li><li><p>é»‘è‰²ï¼šå¯¹è±¡å·²è¢«æ ‡è®°ï¼Œä¸”è¿™ä¸ªå¯¹è±¡åŒ…å«çš„å­å¯¹è±¡ä¹Ÿå·²æ ‡è®°ï¼ŒgcmarkBitså¯¹åº”çš„ä½ä¸º1ï¼ˆè¯¥å¯¹è±¡ä¸ä¼šåœ¨æœ¬æ¬¡GCä¸­è¢«æ¸…ç†ï¼‰</p></li></ul><p>ä¾‹å¦‚ï¼Œå½“å‰å†…å­˜ä¸­æœ‰A~Fä¸€å…±6ä¸ªå¯¹è±¡ï¼Œæ ¹å¯¹è±¡a,bæœ¬èº«ä¸ºæ ˆä¸Šåˆ†é…çš„å±€éƒ¨å˜é‡ï¼Œæ ¹å¯¹è±¡aã€båˆ†åˆ«å¼•ç”¨äº†å¯¹è±¡Aã€B, è€ŒBå¯¹è±¡åˆå¼•ç”¨äº†å¯¹è±¡Dï¼Œåˆ™GCå¼€å§‹å‰å„å¯¹è±¡çš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤º:</p><ol><li>åˆå§‹çŠ¶æ€ä¸‹æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²çš„ã€‚</li><li>æ¥ç€å¼€å§‹æ‰«ææ ¹å¯¹è±¡aã€b; ç”±äºæ ¹å¯¹è±¡å¼•ç”¨äº†å¯¹è±¡Aã€B,é‚£ä¹ˆAã€Bå˜ä¸ºç°è‰²å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹åˆ†æç°è‰²å¯¹è±¡ï¼Œåˆ†æAæ—¶ï¼ŒAæ²¡æœ‰å¼•ç”¨å…¶ä»–å¯¹è±¡å¾ˆå¿«å°±è½¬å…¥é»‘è‰²ï¼ŒBå¼•ç”¨äº†Dï¼Œåˆ™Bè½¬å…¥é»‘è‰²çš„åŒæ—¶è¿˜éœ€è¦å°†Dè½¬ä¸ºç°è‰²ï¼Œè¿›è¡Œæ¥ä¸‹æ¥çš„åˆ†æã€‚</li><li>ç°è‰²å¯¹è±¡åªæœ‰Dï¼Œç”±äºDæ²¡æœ‰å¼•ç”¨å…¶ä»–å¯¹è±¡ï¼Œæ‰€ä»¥Dè½¬å…¥é»‘è‰²ã€‚æ ‡è®°è¿‡ç¨‹ç»“æŸ</li><li>æœ€ç»ˆï¼Œé»‘è‰²çš„å¯¹è±¡ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œç™½è‰²å¯¹è±¡ä¼šè¢«å›æ”¶æ‰ã€‚</li></ol><p><img src="/images/post/9905654-922225af024f386c.png" alt="gc"></p><h3 id="GCçš„è§¦å‘"><a href="#GCçš„è§¦å‘" class="headerlink" title="GCçš„è§¦å‘"></a>GCçš„è§¦å‘</h3><ul><li>é˜ˆå€¼ï¼šé»˜è®¤å†…å­˜æ‰©å¤§ä¸€å€ï¼Œå¯åŠ¨gc</li><li>å®šæœŸï¼šé»˜è®¤2minè§¦å‘ä¸€æ¬¡gcï¼Œsrc/runtime/proc.go:forcegcperiod</li><li>æ‰‹åŠ¨ï¼šruntime.gc()</li></ul><h3 id="STW"><a href="#STW" class="headerlink" title="STW"></a>STW</h3><p>stop the worldæ˜¯gcçš„æœ€å¤§æ€§èƒ½é—®é¢˜ï¼Œå¯¹äºgcè€Œè¨€ï¼Œéœ€è¦åœæ­¢æ‰€æœ‰çš„å†…å­˜å˜åŒ–ï¼Œå³åœæ­¢æ‰€æœ‰çš„goroutineï¼Œç­‰å¾…gcç»“æŸä¹‹åæ‰æ¢å¤ã€‚</p><p>æ ‡è®°-æ¸…é™¤(mark and sweep)ç®—æ³•çš„STW(stop the world)æ“ä½œï¼Œå°±æ˜¯runtimeæŠŠæ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨å†»ç»“æ‰ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨å†»ç»“æ„å‘³ç€ç”¨æˆ·é€»è¾‘æ˜¯æš‚åœçš„ã€‚è¿™æ ·æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«ä¿®æ”¹äº†ï¼Œè¿™æ—¶å€™å»æ‰«ææ˜¯ç»å¯¹å®‰å…¨çš„ã€‚</p><p>Goå¦‚ä½•å‡çŸ­è¿™ä¸ªè¿‡ç¨‹å‘¢ï¼Ÿæ ‡è®°-æ¸…é™¤(mark and sweep)ç®—æ³•åŒ…å«ä¸¤éƒ¨åˆ†é€»è¾‘ï¼šæ ‡è®°å’Œæ¸…é™¤ã€‚</p><p>æˆ‘ä»¬çŸ¥é“Golangä¸‰è‰²æ ‡è®°æ³•ä¸­æœ€ååªå‰©ä¸‹çš„é»‘ç™½ä¸¤ç§å¯¹è±¡ï¼Œé»‘è‰²å¯¹è±¡æ˜¯ç¨‹åºæ¢å¤åæ¥ç€ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¦‚æœä¸ç¢°è§¦é»‘è‰²å¯¹è±¡ï¼Œåªæ¸…é™¤ç™½è‰²çš„å¯¹è±¡ï¼Œè‚¯å®šä¸ä¼šå½±å“ç¨‹åºé€»è¾‘ã€‚æ‰€ä»¥ï¼š <code>æ¸…é™¤æ“ä½œå’Œç”¨æˆ·é€»è¾‘å¯ä»¥å¹¶å‘ã€‚</code></p><p>æ ‡è®°æ“ä½œå’Œç”¨æˆ·é€»è¾‘ä¹Ÿæ˜¯å¹¶å‘çš„ï¼Œç”¨æˆ·é€»è¾‘ä¼šæ—¶å¸¸ç”Ÿæˆå¯¹è±¡æˆ–è€…æ”¹å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆæ ‡è®°å’Œç”¨æˆ·é€»è¾‘å¦‚ä½•å¹¶å‘å‘¢ï¼Ÿè¿™é‡Œå°±è®©è¯´åˆ°golangçš„å†™å±éšœäº†ã€‚</p><h3 id="GCæµç¨‹"><a href="#GCæµç¨‹" class="headerlink" title="GCæµç¨‹"></a>GCæµç¨‹</h3><ol><li>Sweep Termination: å¯¹æœªæ¸…æ‰«çš„spanè¿›è¡Œæ¸…æ‰«, åªæœ‰ä¸Šä¸€è½®çš„GCçš„æ¸…æ‰«å·¥ä½œå®Œæˆæ‰å¯ä»¥å¼€å§‹æ–°ä¸€è½®çš„GC</li><li>Mark: æ‰«ææ‰€æœ‰æ ¹å¯¹è±¡, å’Œæ ¹å¯¹è±¡å¯ä»¥åˆ°è¾¾çš„æ‰€æœ‰å¯¹è±¡, æ ‡è®°å®ƒä»¬ä¸è¢«å›æ”¶</li><li>Mark Termination: å®Œæˆæ ‡è®°å·¥ä½œ, é‡æ–°æ‰«æéƒ¨åˆ†æ ¹å¯¹è±¡(è¦æ±‚STW)</li><li>Sweep: æŒ‰æ ‡è®°ç»“æœæ¸…æ‰«span</li></ol><p>ç›®å‰æ•´ä¸ªGCæµç¨‹ä¼šè¿›è¡Œä¸¤æ¬¡STW(Stop The World), ç¬¬ä¸€æ¬¡æ˜¯Marké˜¶æ®µçš„å¼€å§‹, ç¬¬äºŒæ¬¡æ˜¯Mark Terminationé˜¶æ®µ.</p><ul><li>ç¬¬ä¸€æ¬¡STWä¼šå‡†å¤‡æ ¹å¯¹è±¡çš„æ‰«æ, å¯åŠ¨å†™å±éšœ(Write Barrier)å’Œè¾…åŠ©GC(mutator assist).</li><li>ç¬¬äºŒæ¬¡STWä¼šé‡æ–°æ‰«æéƒ¨åˆ†æ ¹å¯¹è±¡, ç¦ç”¨å†™å±éšœ(Write Barrier)å’Œè¾…åŠ©GC(mutator assist).</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯, ä¸æ˜¯æ‰€æœ‰æ ¹å¯¹è±¡çš„æ‰«æéƒ½éœ€è¦STW, ä¾‹å¦‚æ‰«ææ ˆä¸Šçš„å¯¹è±¡åªéœ€è¦åœæ­¢æ‹¥æœ‰è¯¥æ ˆçš„G.<br>ä»go 1.9å¼€å§‹, å†™å±éšœçš„å®ç°ä½¿ç”¨äº†Hybrid Write Barrier, å¤§å¹…å‡å°‘äº†ç¬¬äºŒæ¬¡STWçš„æ—¶é—´.</p><h3 id="å†™å±éšœ"><a href="#å†™å±éšœ" class="headerlink" title="å†™å±éšœ"></a>å†™å±éšœ</h3><p>å› ä¸ºgoæ”¯æŒ<strong>å¹¶è¡ŒGC</strong>ï¼Œ GCçš„æ‰«æå’Œgoä»£ç å¯ä»¥åŒæ—¶è¿è¡Œï¼Œè¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯GCæ‰«æçš„è¿‡ç¨‹ä¸­goä»£ç æœ‰å¯èƒ½æ”¹å˜äº†å¯¹è±¡çš„ä¾èµ–æ ‘ã€‚</p><p>ä¾‹å¦‚å¼€å§‹æ‰«ææ—¶å‘ç°æ ¹å¯¹è±¡Aå’ŒBï¼ŒBæ‹¥æœ‰Cçš„æŒ‡é’ˆã€‚</p><ol><li>GCå…ˆæ‰«æAï¼ŒAæ”¾å…¥é»‘è‰²</li><li>BæŠŠCçš„æŒ‡é’ˆäº¤ç»™A</li><li>GCå†æ‰«æBï¼ŒBæ”¾å…¥é»‘è‰²</li><li>Cåœ¨ç™½è‰²ï¼Œä¼šå›æ”¶ï¼›ä½†æ˜¯Aå…¶å®å¼•ç”¨äº†Cã€‚</li></ol><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜, goåœ¨GCçš„æ ‡è®°é˜¶æ®µä¼šå¯ç”¨å†™å±éšœ(Write Barrier).</p><p>å¯ç”¨äº†å†™å±éšœ(Write Barrier)åï¼Œ</p><ol><li>GCå…ˆæ‰«æAï¼ŒAæ”¾å…¥é»‘è‰²</li><li>BæŠŠCçš„æŒ‡é’ˆäº¤ç»™A</li><li>ç”±äºAåœ¨é»‘è‰²ï¼Œæ‰€ä»¥Cæ”¾å…¥ç°è‰²</li><li>Cæ²¡æœ‰å­å¯¹è±¡ï¼Œæ”¾å…¥é»‘è‰²</li><li>æ‰«æBï¼ŒBæ²¡æœ‰å­å¯¹è±¡ï¼Œæ”¾å…¥é»‘è‰²</li></ol><p>å³ä½¿Aå¯èƒ½ä¼šåœ¨ç¨åä¸¢æ‰C, é‚£ä¹ˆCå°±åœ¨ä¸‹ä¸€è½®å›æ”¶ã€‚</p><p>å¼€å¯å†™å±éšœä¹‹åï¼Œå½“æŒ‡é’ˆå‘ç”Ÿæ”¹å˜, GCä¼šè®¤ä¸ºåœ¨è¿™ä¸€è½®çš„æ‰«æä¸­è¿™ä¸ªæŒ‡é’ˆæ˜¯<strong>å­˜æ´»</strong>çš„, æ‰€ä»¥æ”¾å…¥<strong>ç°è‰²</strong>ã€‚</p><h2 id="å…¶ä»–å¸¸è§gcæœºåˆ¶"><a href="#å…¶ä»–å¸¸è§gcæœºåˆ¶" class="headerlink" title="å…¶ä»–å¸¸è§gcæœºåˆ¶"></a>å…¶ä»–å¸¸è§gcæœºåˆ¶</h2><ul><li>å¼•ç”¨è®¡æ•°</li><li>å¤åˆ¶æ”¶é›†</li><li>åˆ†ä»£æ”¶é›†</li></ul><h2 id="GC-çš„è§¦å‘æ—¶æœºçš„ä¸¤ç§å½¢å¼"><a href="#GC-çš„è§¦å‘æ—¶æœºçš„ä¸¤ç§å½¢å¼" class="headerlink" title="GC çš„è§¦å‘æ—¶æœºçš„ä¸¤ç§å½¢å¼"></a>GC çš„è§¦å‘æ—¶æœºçš„ä¸¤ç§å½¢å¼</h2><ol><li><strong>ä¸»åŠ¨è§¦å‘</strong>ï¼Œé€šè¿‡è°ƒç”¨ runtime.GC æ¥è§¦å‘ GCï¼Œæ­¤è°ƒç”¨é˜»å¡å¼åœ°ç­‰å¾…å½“å‰ GC è¿è¡Œå®Œæ¯•ã€‚</li><li><strong>è¢«åŠ¨è§¦å‘</strong>ï¼Œåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š<ul><li>ä½¿ç”¨ç³»ç»Ÿç›‘æ§ï¼Œå½“è¶…è¿‡ä¸¤åˆ†é’Ÿæ²¡æœ‰äº§ç”Ÿä»»ä½• GC æ—¶ï¼Œå¼ºåˆ¶è§¦å‘ GCã€‚</li><li>ä½¿ç”¨æ­¥è°ƒï¼ˆPacingï¼‰ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ§åˆ¶å†…å­˜å¢é•¿çš„æ¯”ä¾‹ã€‚</li></ul></li></ol><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/zj420255586/p/14261834.html">Golang GC(åƒåœ¾å›æ”¶æœºåˆ¶)</a></li><li>[11. è§¦å‘ GC çš„æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿ](<a href="https://www.bookstack.cn/read/qcrao-Go-Questions/spilt.11.GC-GC.md#11">https://www.bookstack.cn/read/qcrao-Go-Questions/spilt.11.GC-GC.md#11</a>. è§¦å‘ GC çš„æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿ)</li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æˆä¸ºä¼šå¸¦å›¢é˜Ÿçš„æŠ€æœ¯äºº</title>
    <link href="/2021/02/14/318/"/>
    <url>/2021/02/14/318/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯æ‹‰å‹¾ä¸“æ ã€Šæˆä¸ºä¼šå¸¦å›¢é˜Ÿçš„æŠ€æœ¯äººã€‹çš„ç¬”è®°ï¼Œå›¾åŸºæœ¬ä¹Ÿæ¥æºäºä¸“æ ï¼Œè‡ªå·±ä»¥å‰ä¹Ÿæœ‰å¸¦å›¢é˜Ÿç»éªŒï¼Œä½†è‡ªæˆ‘æ„Ÿè§‰åšå¾—ä¸å¤Ÿå¥½ï¼Œè¿™ä¸ªä¸“æ ç»™æˆ‘å¾ˆå¤šå¯å‘ã€‚</p><h1 id="æŠ€æœ¯äººä¸‰è¦ç´ "><a href="#æŠ€æœ¯äººä¸‰è¦ç´ " class="headerlink" title="æŠ€æœ¯äººä¸‰è¦ç´ "></a>æŠ€æœ¯äººä¸‰è¦ç´ </h1><p class="note note-success">  æŠ€æœ¯äººä¸‰è¦ç´ ï¼šç¨³å®šæ€§ã€å€ºåŠ¡ã€æ¶æ„</p><h2 id="ç¨³å®šæ€§"><a href="#ç¨³å®šæ€§" class="headerlink" title="ç¨³å®šæ€§"></a>ç¨³å®šæ€§</h2><h3 id="æ€ä¹ˆè¡¡é‡ç³»ç»Ÿç¨³å®šæ€§ï¼Ÿ"><a href="#æ€ä¹ˆè¡¡é‡ç³»ç»Ÿç¨³å®šæ€§ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè¡¡é‡ç³»ç»Ÿç¨³å®šæ€§ï¼Ÿ"></a>æ€ä¹ˆè¡¡é‡ç³»ç»Ÿç¨³å®šæ€§ï¼Ÿ</h3><p>ä¸€èˆ¬æ¥è®²ï¼Œé€šè¿‡ç»Ÿè®¡ç³»ç»Ÿä¸å¯ç”¨çš„æ—¶é•¿æˆ–æ¬¡æ•°å°±å¯ä»¥å¯¹ç¨³å®šæ€§è¿›è¡Œé‡åŒ–ï¼Œæ¯”å¦‚ä¸šå†…å¸¸è¯´ 4 ä¸ª 9 çš„å¯ç”¨æ€§ï¼ˆå³ 1 å¹´å†… 99.99% çš„æ—¶é—´ç³»ç»Ÿæ˜¯å¯ç”¨çš„ï¼Œä¸å¯ç”¨æ—¶é•¿ä»…ä¸º 52.6 åˆ†é’Ÿï¼‰ã€‚</p><p>é’ˆå¯¹ç¨³å®šæ€§çš„æé«˜ä¹Ÿå¯ä»¥çœ‹ä½œå›´ç»•äº‹æ•…çš„æ²»ç†ï¼Œå¯ä»¥ä»äº‹æ•…å‘ç”Ÿçš„å‰ã€ä¸­ã€ååˆ†é˜¶æ®µæ¥çœ‹å¯¹åº”çš„å…³é”®ç‚¹ã€‚</p><ul><li>äº‹æ•…çš„ç±»å‹ï¼šå¯ç”¨æ€§äº‹æ•…ã€èµ„æŸç±»äº‹æ•…ã€‚</li><li>äº‹æ•…å‰é¢„é˜²ï¼šä¸»åŠ¨æ²»ç†å‡å°‘ç³»ç»Ÿçš„é£é™©éšæ‚£ï¼Œé‡ç‚¹åœ¨å˜æ›´ç®¡æ§ã€å¯ç”¨æ€§è®¾è®¡ã€åº”æ€¥é¢„æ¡ˆä¸æ¼”ç»ƒã€‚</li><li>äº‹æ•…ä¸­åº”æ€¥ï¼šâ€œæ­¢è¡€ã€æ¢å¤â€ã€‚</li><li>äº‹æ•…åå¤ç›˜ï¼šç›®çš„ä¸æ˜¯è¿½è´£ï¼Œä¸æ˜¯ç”©é”…ï¼Œè€Œæ˜¯æŸ¥æ ¹å› ã€æ”¹è¿›æ¶æ„ã€å®Œå–„åº”æ€¥ã€æ€»ç»“ç»éªŒã€‚</li></ul><h3 id="äº‹æ•…çš„ç±»å‹"><a href="#äº‹æ•…çš„ç±»å‹" class="headerlink" title="äº‹æ•…çš„ç±»å‹"></a>äº‹æ•…çš„ç±»å‹</h3><p>ä»äº‹æ•…ç‰¹æ€§ä¸Šçœ‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸ºå¯ç”¨æ€§äº‹æ•…å’Œèµ„æŸç±»äº‹æ•…ã€‚</p><ol><li><p>å¯ç”¨æ€§äº‹æ•…ï¼šæŠ€æœ¯åŸå› å¯¼è‡´ç³»ç»Ÿéƒ¨åˆ†æˆ–è€…å…¨éƒ¨åŠŸèƒ½ä¸å¯ç”¨ï¼Œä¸šåŠ¡æ²¡åŠæ³•æ­£å¸¸å®Œæˆå¯¹åº”æµç¨‹æˆ–è€…æä¾›å¯¹åº”æœåŠ¡ã€‚æ¯”å¦‚å› ä¸ºç½‘ç»œã€æ¥å£ Bug ç­‰åŸå› ï¼Œç”¨æˆ·æ²¡åŠæ³•ç™»å½•ã€å•†å“åˆ—è¡¨ä¸æ˜¾ç¤ºç­‰ã€‚</p></li><li><p>èµ„æŸç±»äº‹æ•…ï¼šç³»ç»Ÿçš„åŠŸèƒ½éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½†å› ä¸ºé€»è¾‘ã€è®¡ç®—ç­‰åŸå› è®©ä¸šåŠ¡çš„æŸä¸€æ–¹äº§ç”Ÿäº†èµ„é‡‘æŸå¤±ã€‚æ¯”å¦‚æŸç”µå•†éƒ¨é—¨é”™å‘æ— é—¨æ§›ä¼˜æƒ åˆ¸ã€æŸå…¬å¸å•†æˆ·æ¸…ç»“ç®—å°‘æ‰“æ¬¾ç»™å•†æˆ·ç­‰ç­‰ã€‚</p></li></ol><h3 id="æ•…éšœå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#æ•…éšœå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ•…éšœå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸ"></a>æ•…éšœå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸ</h3><blockquote><p>æ•…éšœå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥åˆ†ä¸º 4 ä¸ªé˜¶æ®µï¼šå‘ç°å¼‚å¸¸ã€æ’æŸ¥é—®é¢˜ã€åˆ¤æ–­å†³ç­–ã€æ¢å¤å¤„ç†ã€‚<br>è¿™ 4 ä¸ªé˜¶æ®µå¯¹åº”çš„è¡ŒåŠ¨å¹¶ä¸æ˜¯å®Œå…¨ä¸²è¡Œçš„ï¼Œè™½ç„¶æœ‰ä¸€å®šçš„ä¾èµ–å…³ç³»ï¼Œä½†åœ¨å®é™…çš„å¤„ç†è¿‡ç¨‹ä¸­åº”è¯¥å¹¶è¡Œå±•å¼€ã€‚ç±»ä¼¼ fork/join çš„æ¨¡å¼ï¼Œä¸æ–­å®Œæˆå°ä»»åŠ¡ã€ä¸æ–­æ±‡æ€»ä¿¡æ¯ï¼Œä¸æ–­åšå‡ºåˆ¤æ–­ä¸å†³ç­–ï¼Œå½¢æˆå¾ªç¯ç›´åˆ°æ•…éšœæ¢å¤ã€‚</p></blockquote><ol><li>æ•…éšœå‘ç°</li></ol><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgqCHmAJMdeAc_F6AAJTrBjwTWE310-20210527163509208.png" alt="æ•…éšœå‘ç°"></p><p>æ€»çš„æ¥è¯´ï¼Œäººå·¥çš„è¢«åŠ¨åé¦ˆåœ¨æ—¶é—´å’Œé€Ÿåº¦ä¸Šæœ‰è¾ƒå¼ºçš„ä¸ç¡®å®šæ€§ï¼Œå¾ˆå®¹æ˜“å‡ºç°â€œå°æ•…éšœ * é•¿æ—¶é—´ = å¤§äº‹æ•…â€çš„æƒ…å½¢ã€‚è€Œçº¯ç²¹çš„æŠ€æœ¯æŒ‡æ ‡ç›‘æ§åˆä¼šå¿½ç•¥æ‰æ¥å£æ­£å¸¸å“åº”ï¼Œä½†æ˜¯ä¸šåŠ¡å¼‚å¸¸çš„åœºæ™¯ï¼Œåªæœ‰ä¸¤è€…ç»“åˆï¼Œé€šè¿‡ç›‘æ§å‘Šè­¦ï¼Œæœ€å¤§ç¨‹åº¦ä¸Šç¼©çŸ­æ•…éšœæ„ŸçŸ¥çš„æ—¶é—´ï¼Œæ‰èƒ½æ—©å‘ç°æ—©è§£å†³ï¼Œå‡å°‘ä¸šåŠ¡å½±å“ã€‚</p><ol start="2"><li>æ•…éšœæ’æŸ¥</li></ol><ul><li><p>ç›´æ¥é”å®šï¼šæœ€è¿‘çš„ä»£ç æ›´æ–°ä¸å¼‚å¸¸ç°è±¡é—´æœ‰ç›´æ¥çš„é€»è¾‘å…³è”ï¼Œè¿›è€Œå¯ä»¥ç›´æ¥é”å®šåˆ°æ•…éšœç‚¹ã€‚æ¯”å¦‚ï¼Œåˆšå¯¹ä¸‹å•æ¥å£è¿›è¡Œäº†å‘å¸ƒå˜æ›´ï¼Œå®¢æˆ·åé¦ˆå¤§é‡å¤±è´¥ï¼Œå¯ä»¥åŸºæœ¬æ–­å®šæ˜¯åˆšæ‰çš„å‘å¸ƒå¯¼è‡´ã€‚</p></li><li><p>æ’é™¤æ³•ï¼šå½“å¹²æ‰°å› ç´ è¿‡å¤šï¼ˆç”¨æˆ·ã€è®¢å•ç­‰å‡ ä¸ªç³»ç»ŸåŒæ—¶å‘ç”Ÿå˜æ›´ï¼Œå¼•èµ·è®¢å•å¼‚å¸¸ï¼‰ï¼Œå¾ˆéš¾ç›´æ¥é”å®šåˆ°æ•…éšœç‚¹ï¼Œå°±è¦ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œåœ¨æ•´æ¡ä¸‹å•é“¾è·¯ä¸ŠåŠå…³è”ä»£ç è¿›è¡Œè‡ªæŸ¥è‡ªè¯ï¼Œé€šè¿‡æ’é™¤æ³•é”å®šæ•…éšœã€‚</p></li></ul><ol start="3"><li>æ•…éšœå†³ç­–</li></ol><p>ä¸šåŠ¡å†³ç­–éå¸¸å¤æ‚ï¼Œèƒ½å¦ç¬¬ä¸€æ—¶é—´æ­¢æŸå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæŠ€æœ¯ Leader çš„ç°åœºååº”å’Œæ“ä½œï¼Œ è¦æ³¨æ„æ•…éšœå†³ç­–çš„ä¸¤ä¸ªå…³é”®ç‚¹ ï¼š</p><p>ä¸€å®šè¦æœ‰æ˜ç¡®çš„å†³ç­–äººã€ä¸»å¯¼è€…å’Œæœ‰æ•ˆçš„æ²Ÿé€šæ–¹å¼ï¼ˆé’‰é’‰ç¾¤ã€å¤šäººç”µè¯ä¼šè®®ç­‰ï¼‰ï¼Œè®©ä¿¡æ¯å¯ä»¥é€šç•…åœ°äº¤æµå‡ºæ¥ï¼Œå¹¶ä¸”å†³ç­–äººå¯ä»¥æ ¹æ®æƒ…å†µåšåˆ¤æ–­ä¸å–èˆï¼Œå½¢æˆæ‰€æœ‰äººæ˜ç¡®çš„å¤„ç†ç»“è®ºï¼Œæœ€å¥½è¿˜èƒ½è½æˆæ–‡æ¡£ï¼Œå¯è¿½æº¯ã€‚ æ¯”å¦‚ï¼Œç¬¬ä¸€æ—¶é—´åœæ­¢é”™è¯¯çº¢åŒ…çš„å‘æ”¾ï¼Œç¡®ä¿æ•…éšœæ²¡æœ‰å¢é‡ï¼Œå¹¶æŠŠå†³ç­–ç¬¬ä¸€æ—¶é—´åŒæ­¥ç»™å›¢é˜Ÿæˆå‘˜ï¼Œå¹¶åŒæ­¥ç›¸å…³è´Ÿè´£äººåç»­çš„åŠ¨ä½œï¼Œå¯¹å·²å‘æ”¾çš„çº¢åŒ…ï¼Œæ˜ç¡®è¦æ±‚è´Ÿè´£äººæ±‡æ€»å„ç±»å…³é”®ä¿¡æ¯ï¼ˆçº¢åŒ…æ•°é‡ã€æ¶‰åŠé‡‘é¢ã€æ¶‰åŠç”¨æˆ·æ•°ã€æœ‰æ•ˆæ—¶é•¿ã€å¯èƒ½èµ„æŸç­‰ï¼‰ã€‚</p><p>æ‰€æœ‰çš„ä¿¡æ¯ä¸€å®šè¦æ•°æ®åŒ–ï¼Œä¸åŒçš„æ•°æ®é‡çº§ä¼šå¯¼è‡´å†³ç­–ä¸åŒï¼Œæ¯”å¦‚çº¢åŒ…é”™å‘ 5W å¯èƒ½åªæ˜¯æš‚åœå‘æ”¾ï¼Œä½†æ˜¯å­˜é‡çº¢åŒ…ä¾ç„¶å¯ä»¥æ ¸é”€ï¼ŒæŸå¤±å…¬å¸å¯ä»¥æ‰¿æ‹…ã€‚ä½†æ˜¯å¦‚æœé”™å‘ 5000Wï¼Œå¤§æ¦‚å°±è¦æ¶‰åŠä¸€ç³»åˆ—çš„è°ƒæ•´ï¼Œè¿™æ˜¯éå¸¸å½±å“å†³ç­–çš„ã€‚</p><ol start="4"><li>æ•…éšœæ¢å¤</li></ol><blockquote><p>åº”æ€¥â€œä¸‰æ¿æ–§â€ï¼šå›æ»šã€é‡å¯å¤§æ³•ã€é™çº§é™æµã€‚</p></blockquote><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/Cip5yGAJMf2AFDdiAAJOfl-EHu8036.png" alt="æ•…éšœæ¢å¤"></p><h3 id="å¦‚ä½•æœ‰ä»·å€¼åœ°åšäº‹åå¤ç›˜ï¼Ÿ"><a href="#å¦‚ä½•æœ‰ä»·å€¼åœ°åšäº‹åå¤ç›˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•æœ‰ä»·å€¼åœ°åšäº‹åå¤ç›˜ï¼Ÿ"></a>å¦‚ä½•æœ‰ä»·å€¼åœ°åšäº‹åå¤ç›˜ï¼Ÿ</h3><p>ä½ å¯ä»¥ä»æ—¶é•¿ã€ç°è±¡ã€å¤„ç†æ—¶é—´è½´ã€æ ¹å› ã€æ”¹è¿›è®¡åˆ’è¿™å‡ ä¸ªç»´åº¦è¿›è¡Œå¤ç›˜ï¼Œ åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œæ·±ç©¶ï¼š</p><p>äº‹æ•…æ—¶é•¿ï¼š1-5-10(å³ 1 åˆ†é’Ÿå‘ç°ã€5 åˆ†é’Ÿå“åº”ã€10 åˆ†é’Ÿæ¢å¤) æ˜¯å¦è¾¾æˆï¼Œå¦‚æœæ²¡æœ‰æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå“ªä¸ªç¯èŠ‚ç”¨æ—¶æœ€å¤šï¼Œå¦‚ä½•æé«˜å’Œæ”¹å–„ï¼Ÿ</p><p>äº‹æ•…æ ¹å› ï¼šæ ¹å› ä¸ç­‰äºç›´æ¥åŸå› ï¼Œä¸€ä¸ªäº‹æ•…çš„ç›´æ¥åŸå› å¾€å¾€å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯æ ¹å› å¯èƒ½æ˜¯å¤šä¸ªç»´åº¦çš„ç¼ºå¤±ï¼Œéœ€è¦åƒå‰¥æ´‹è‘±ä¸€æ ·ä¸€å±‚å±‚æ‰¾ä¸‹å»ã€‚æ‹¿åº“å­˜æ¥å£å˜æ›´è¿™ä¸ªCaseæ¥è¯´ï¼Œç›´æ¥åŸå› å°±æ˜¯æŸæ®µä»£ç é€»è¾‘å˜æ›´å¯¼è‡´ï¼Œä½†æ˜¯åº”è¯¥åœ¨æµ‹è¯•ã€å‘å¸ƒã€ç›‘æ§ã€åº”æ€¥å½±å“ã€é¢„æ¡ˆè®¾è®¡ç­‰å¤šä¸ªç¯èŠ‚å±•å¼€å»çœ‹ï¼Œæ ¹å› çš„æŒ–æ˜å¹¶ä¸å¿Œè®³â€œå¹æ¯›æ±‚ç–µâ€ã€‚</p><p>äº‹æ•…æ”¹è¿›æªæ–½ï¼šç”±ç‚¹æ¨åˆ°é¢ã€æ˜ç¡®åˆ°äººã€æ˜ç¡®æ—¶é—´ã€‚ä¸æ ¹å› ç±»ä¼¼ï¼Œè¦ç»“åˆå¤šä¸ªç»´åº¦å½¢æˆç»„åˆæ‹³çš„æ”¹è¿›ç‚¹ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ¨ä½œï¼Œè¦å°†é‡ç‚¹æ”¾åœ¨å¯¹æœªæ¥ã€å¯¹åŒç±»é—®é¢˜çš„é¢„é˜²ä¸Šã€‚æ ¸å¿ƒå°±æ˜¯å¦‚æœå†ä¸€æ¬¡å‘ç”Ÿç±»ä¼¼çš„é—®é¢˜ï¼Œè¿™äº›æ”¹è¿›æªæ–½æ˜¯ä¸æ˜¯èƒ½èµ·åˆ°ä½œç”¨ã€‚</p><p>å…³äºäº‹åå¤ç›˜ï¼Œæˆ‘ä»¬å°±æ˜¯è¦æ·±æŒ–äº‹æ•…å¦‚ä½•å‘ç”Ÿçš„ã€å¦‚ä½•å¤„ç†çš„ã€æœªæ¥æ€ä¹ˆé¢„é˜²ã€‚ä½†è¦é¿å…æƒ…ç»ªåŒ–ï¼Œåœ¨å¤ç›˜ä¼šä¸Šçš„åæ€ã€æ„Ÿæ‚Ÿã€æ‡Šæ¼æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå¦‚ä½•å¸¦é¢†å›¢é˜ŸæŠŠç²¾åŠ›æ”¾åœ¨æ”¹è¿›æªæ–½çš„è½å®ä»¥åŠäº‹æ•…å‰çš„æ²»ç†ä¸Šæ›´æœ‰ä»·å€¼ã€‚å¦å¤–ï¼Œä½ éœ€è¦ç•™å‡ºæ—¶é—´è®©å›¢é˜Ÿä¼™ä¼´è¿›è¡Œå†…éƒ¨ Reviewï¼Œé¿å…ä¸ºäº†å¼€ä¼šè€Œå¤ç›˜ã€‚</p><blockquote><p>æ²¡æœ‰è´¨é‡çš„äº¤ä»˜ï¼Œå†å¤šå†å¿«éƒ½æ¯«æ— æ„ä¹‰ã€‚</p></blockquote><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgqCHmAJMo-Ae8JIAAI6Da3tjL0715.png" alt="ç¨³å®šæ€§"></p><h3 id="å˜æ›´ä¼šå¼•èµ·90-ä»¥ä¸Šçš„æ•…éšœ"><a href="#å˜æ›´ä¼šå¼•èµ·90-ä»¥ä¸Šçš„æ•…éšœ" class="headerlink" title="å˜æ›´ä¼šå¼•èµ·90%ä»¥ä¸Šçš„æ•…éšœ"></a>å˜æ›´ä¼šå¼•èµ·90%ä»¥ä¸Šçš„æ•…éšœ</h3><ol><li>å˜æ›´éœ€è¦ç›‘æ§</li></ol><p>æœ‰æ•ˆçš„ç›‘æ§è¦å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li>æ˜¯å¦æœ‰é—®é¢˜å‘ç”Ÿï¼Ÿ</li><li>å“ªé‡Œå‘ç”Ÿäº†é—®é¢˜ï¼Ÿ</li><li>å‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li></ul><ol start="2"><li>æœ‰æ•ˆç°åº¦å¿…é¡»æœ‰è€å¿ƒ</li></ol><blockquote><p>ç°åº¦ä»æ¥ä¸æ˜¯ä¸ºäº†æµ‹è¯•ï¼Œä¹Ÿä¸ç­‰äº A/B Testã€‚å®ƒæœ¬èº«æ˜¯ä¸ºäº†å¯¹æŠ—â€œæœªçŸ¥çš„ä¸ç¡®å®šæ€§â€ã€‚</p></blockquote><p>è¦æƒ³å®ç°ç°åº¦çš„æœ‰æ•ˆæ€§ï¼Œå…³é”®ç‚¹åœ¨äºæ—¶é—´å’Œæµé‡ã€‚</p><p>æ—¶é—´ï¼šæ¯ä¸ªç°åº¦é˜¶æ®µè‡³å°‘æœ‰ 5 ~ 10 min çš„è§‚å¯Ÿï¼Œåœ¨ç›‘æ§ã€æ—¥å¿—å’Œå„æ–¹åé¦ˆæ²¡æœ‰å¼‚å¸¸åå†æ‰©å¤§ç°åº¦èŒƒå›´ï¼Œç¡®ä¿ä¸€äº›è¿è¡Œæ—¶å¼‚å¸¸æˆ–é‡å˜ç§¯ç´¯è´¨å˜çš„é—®é¢˜å¯ä»¥æš´éœ²å‡ºæ¥ã€‚</p><p>æµé‡ï¼šæœ‰æ—¶ä¸€äº›ä¸šåŠ¡åœºæ™¯éœ€è¦ç‰¹å®šçš„è§¦å‘æ¡ä»¶ï¼Œæ¯”å¦‚æ»¡è¶³æŸäº›æ¡ä»¶çš„ç”¨æˆ·æˆ–æ»¡è¶³æŸäº›æ¡ä»¶çš„è®¢å•ï¼Œé‚£ä¹ˆåœ¨ç°åº¦æ—¶å°±ä¸èƒ½ä»…é€šè¿‡å•ä½æ—¶é—´å†…æœ‰æ²¡æœ‰å¼‚å¸¸æ¥åˆ¤æ–­ï¼Œè¿˜è¦ç¡®ä¿æœ‰è¶³å¤Ÿçš„æœ‰æ•ˆæµé‡ã€‚</p><ol start="3"><li>å›æ»šå°±æ˜¯å˜æ›´çš„â€œåæ‚”è¯â€</li></ol><p>è¦çŸ¥é“ï¼Œç³»ç»Ÿå¹¶ä¸æ˜¯å¤©ç„¶å¯ä»¥æ— ç¼å›æ»šçš„ï¼Œæƒ³è¦ç³»ç»Ÿå…·å¤‡å›æ»šçš„èƒ½åŠ›ï¼Œåœ¨è®¾è®¡ä¸å®ç°é˜¶æ®µéœ€è¦ä»˜å‡ºé¢å¤–çš„ç²¾åŠ›ã€‚å¯å›æ»šçš„æœ¬è´¨æ˜¯ç³»ç»Ÿçš„å…¼å®¹æ€§è®¾è®¡ä¸å®ç°ï¼Œæ¯”å¦‚å¸¸è§çš„â€œåªå¢ä¸æ”¹â€ï¼Œä¸€ä¸ª API å†…è¦è°ƒæ•´å¾ˆå¤šå®ç°é€»è¾‘æ‰èƒ½æ»¡è¶³æ–°ä¸šåŠ¡çš„éœ€æ±‚ï¼Œæ­¤æ—¶ä¸å¦¨ç›´æ¥æ–°å¢ä¸€ä¸ª API ï¼Œä¸¤ä¸ª API ä¿æŒå‚æ•°ä¸€è‡´ï¼Œé‚£ä¹ˆä¸€æ—¦æ–° API æœ‰å¼‚å¸¸ç›´æ¥åˆ‡æ¢å›æ—§çš„ API å³å¯ã€‚</p><p>æ‰€ä»¥ï¼Œä¸è®ºæ˜¯ç°åº¦è®¡åˆ’è¿˜æ˜¯å›æ»šç­–ç•¥éƒ½åº”è¯¥åœ¨æ¶æ„è®¾è®¡é˜¶æ®µå°±å»è€ƒè™‘ï¼Œç»“åˆæ’æœŸã€é£é™©ç¨‹åº¦ã€æˆæœ¬æŠ•å…¥è¿™äº›æ–¹é¢ï¼Œè¦åšå¥½è¯„ä¼°ä¸å¹³è¡¡ã€‚</p><h3 id="åšå®ˆ-Design-For-Failure-çš„æ¶æ„ç†å¿µ"><a href="#åšå®ˆ-Design-For-Failure-çš„æ¶æ„ç†å¿µ" class="headerlink" title="åšå®ˆ Design For Failure çš„æ¶æ„ç†å¿µ"></a>åšå®ˆ Design For Failure çš„æ¶æ„ç†å¿µ</h3><p>â€œDesign for failure and nothing will failâ€ï¼Œæœ€æ—©æ˜¯ AWS çš„ä¸€æ¡æœ€ä½³å®è·µï¼Œå³<code>é¢å‘å¤±è´¥è¿›è¡Œç³»ç»Ÿè®¾è®¡</code>ã€‚å¯ä»¥ç†è§£ä¸ºï¼šè€ƒè™‘ç³»ç»Ÿæ‰€æœ‰å¯èƒ½å‘ç”Ÿæ•…éšœæˆ–ä¸å¯ç”¨çš„æƒ…å½¢ï¼Œå¹¶å‡è®¾è¿™äº›å¯èƒ½éƒ½ä¼šå‘ç”Ÿï¼Œå€’é€¼è‡ªå·±è®¾è®¡è¶³å¤Ÿå¥å£®çš„ç³»ç»Ÿã€‚</p><ol><li>å°†ç»éªŒæ•™è®­æ²‰æ·€ä¸‹æ¥</li></ol><p>å†å²æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œæˆ‘å»ºè®®ä½ æ€»ç»“å¹¶åˆ†æè¿‡å»å‘ç”Ÿè¿‡çš„äº‹æ•…ï¼Œå¹¶ç»“åˆå¸¸è§„åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§é£é™©ï¼Œä»¥æ­¤æ¢³ç†å‡ºä¸€ä¸ªå›´ç»•äº‹æ•…éšæ‚£çš„é£é™©ç‚¹ Checklistï¼Œåœ¨éœ€æ±‚è¿­ä»£æˆ–è€…æ¶æ„è®¾è®¡æ—¶ï¼Œé€šè¿‡å®ƒé«˜æ•ˆåœ°æ‰¾åˆ°ç³»ç»Ÿå®ç°çš„è–„å¼±ç¯èŠ‚ã€‚</p><p>é™¤äº†å®Œå–„ Checklistï¼Œåœ¨å›¢é˜Ÿæ™®åŠè¿™ç§è®¾è®¡ç†å¿µä¹‹å¤–ï¼Œæ›´å…³é”®çš„æ˜¯å°†è¿™äº›è§£å†³æ–¹æ¡ˆæ²‰æ·€æˆè®¾è®¡åŸåˆ™ï¼Œè®©ç ”å‘äººå‘˜å¯ä»¥åœ¨å®é™…ä¸­è½åœ°ã€‚</p><ol start="2"><li>é€šè¿‡æ¼”ç»ƒéªŒè¯é¢„æ¡ˆè®¾è®¡</li></ol><p>è®¾è®¡å¹¶å®ç°äº†è‡ªå·±çš„æ•…éšœæ¼”ç»ƒç³»ç»Ÿï¼Œæ—¥å¸¸ä¸»åŠ¨åˆ¶é€ äº‹æ•…ä¸Šä¸‹æ–‡æ¥éªŒè¯æˆ‘ä»¬çš„è®¾è®¡ä¸ç³»ç»Ÿæ˜¯å¦å¯é ã€‚</p><h3 id="æŠŠç¨³å®šæ€§å½“ä½œæœºåˆ¶ä¸æ–‡åŒ–å»å»ºè®¾"><a href="#æŠŠç¨³å®šæ€§å½“ä½œæœºåˆ¶ä¸æ–‡åŒ–å»å»ºè®¾" class="headerlink" title="æŠŠç¨³å®šæ€§å½“ä½œæœºåˆ¶ä¸æ–‡åŒ–å»å»ºè®¾"></a>æŠŠç¨³å®šæ€§å½“ä½œæœºåˆ¶ä¸æ–‡åŒ–å»å»ºè®¾</h3><p>ç³»ç»Ÿç¨³å®šæ€§ç»“æœå¥½åå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæŠ€æœ¯ Leader çš„é‡è§†ç¨‹åº¦ï¼Œå¦‚æœä¸€ä¸ªå›¢é˜Ÿçš„ç®¡ç†è€…éƒ½ä¸èƒ½èº«ä½“åŠ›è¡Œçš„å»é‡è§†å®ƒï¼Œè€Œä»…ä»…åªæ˜¯å–Šå–Šå£å·ï¼Œé‚£å°±ä¸è¦æŒ‡æœ›å›¢é˜Ÿæˆå‘˜èƒ½è®¤çœŸåœ°å¯¹å¾…è¿™ä»¶äº‹ã€‚</p><ol><li>æ–°äºº Landing ä»ç¨³å®šæ€§å­¦ä¹ å¼€å§‹</li><li>æ¯äººä¸ä½äº 35% çš„ç¨³å®šæ€§ KPI</li><li>å¥½çš„åçš„éƒ½è¦åœ¨é˜³å…‰ä¹‹ä¸‹æ™’ä¸€æ™’</li></ol><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/Cip5yGAOnceAK51TAAEbIVsowNo778.png" alt="å¯ç”¨æ€§æ²»ç†ä¸é¢„é˜²"></p><h3 id="å»ºç«‹èµ„æŸæ¦‚å¿µçš„å®è§‚è®¤çŸ¥"><a href="#å»ºç«‹èµ„æŸæ¦‚å¿µçš„å®è§‚è®¤çŸ¥" class="headerlink" title="å»ºç«‹èµ„æŸæ¦‚å¿µçš„å®è§‚è®¤çŸ¥"></a>å»ºç«‹èµ„æŸæ¦‚å¿µçš„å®è§‚è®¤çŸ¥</h3><p>ä»å¹¿ä¹‰ä¸Šæ¥çœ‹ï¼Œå­˜åœ¨ç†è®ºæŸå¤±ä¹Ÿåº”è¯¥ç®—èµ„æŸï¼Œ æ¯”å¦‚å› ä¸ºæœç´¢æ¨èç³»ç»Ÿå‡ºé—®é¢˜ï¼ˆä¸è®ºä»€ä¹ˆåŸå› ï¼‰å¯¼è‡´è¿™ä¸€é˜¶æ®µå¹¿å‘Šçš„æ”¶å…¥å‡å°‘ï¼Œæˆ–è€…å› ç³»ç»Ÿ Bug å¯¼è‡´ç”¨æˆ·å–æ¶ˆè®¢å•çš„ç”³è¯·è¢«é»˜è®¤åŒæ„ï¼ˆè™½ç„¶åŸæœ¬å•†æˆ·å¯èƒ½ä¹Ÿä¼šåšåŒæ„å¤„ç†ï¼Œä½†æ˜¯ç”³è¯‰çš„è¯å¹³å°ä¾ç„¶è¦èµ”ä»˜ï¼‰ï¼Œç±»ä¼¼é¢„è®¡æ”¶ç›Šå‡å°‘æˆ–è€…å› ç³»ç»Ÿé—®é¢˜äº§ç”Ÿèµ”ä»˜çš„åœºæ™¯éƒ½åº”ç®—ä¸ºèµ„æŸã€‚</p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgpVE2ASYyyAAp99AAHQPeoXQkg893.png" alt="èµ„æŸå®šä¹‰å’Œåˆ†ç±»"></p><h3 id="èµ„æŸé˜²æ§çš„ä¸‰ä¸ªå…³é”®"><a href="#èµ„æŸé˜²æ§çš„ä¸‰ä¸ªå…³é”®" class="headerlink" title="èµ„æŸé˜²æ§çš„ä¸‰ä¸ªå…³é”®"></a>èµ„æŸé˜²æ§çš„ä¸‰ä¸ªå…³é”®</h3><ol><li>é˜²ï¼šèµ„é‡‘è§†è§’åšé£é™©ç‚¹è¯†åˆ«</li></ol><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgpVE2ASY0OAILA7AAE89CbKGfA505.png" alt="èµ„æŸé£é™©ç‚¹è¯†åˆ«"></p><ol start="2"><li>ç›‘ï¼šä¸€è‡´æ€§ä¸æ­£ç¡®æ€§åŒæ ¸å¯¹</li></ol><p>é’ˆå¯¹èµ„æŸæ„ŸçŸ¥çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåŸºäºçº¿ä¸Šä¸šåŠ¡ç»“æœæ”¶æ‹¢è¿›è¡Œç›‘æ§ï¼ŒåŸºäºçº¿ä¸‹ä¸šåŠ¡åœºæ™¯æ‰©æ•£è¿›è¡Œæ ¸å¯¹ã€‚</p><p>ä¸å¯ç”¨æ€§ç›‘æ§å›´ç»•æ¥å£çš„æŠ€æœ¯æŒ‡æ ‡ä¸åŒï¼Œèµ„æŸæ›´å…³æ³¨çš„æ˜¯æ•°æ®æ ¸å¯¹ï¼Œç›‘æ§çš„å¹¶ä¸æ˜¯è¿è¡ŒçŠ¶æ€è€Œæ˜¯è¿è¡Œç»“æœï¼Œå¹¶ä¸”èµ„æŸç›‘æ§çš„ç²’åº¦è¦æ±‚éå¸¸é«˜ï¼Œç²¾ç»†åˆ°æ¯ä¸€ç¬”äº¤æ˜“ã€æ¯ä¸€æ¬¡é‡‘é¢è®¡ç®—ã€æ¯ä¸€ä¸ªçº¢åŒ…å‘æ”¾ã€‚æ‰€ä»¥èµ„æŸç›‘æ§çš„æœ‰æ•ˆæ€§å¾ˆä¾èµ–äºåœºæ™¯çš„è¦†ç›–ç‡ï¼Œä»…è¦†ç›–å‡ ä¸ªå…³é”®åœºæ™¯æ˜¯ä¸è¶³ä»¥è§„é¿èµ„æŸé£é™©çš„ï¼Œé™¤äº†è¦å®šæœŸæ¢³ç†å¤–ï¼Œæ¯æ¬¡ç³»ç»Ÿæœ‰å˜æ›´æˆ–è€…æ–°åŠŸèƒ½æ—¶ï¼Œéƒ½éœ€æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ ¸å¯¹ç‚¹ï¼Œä»¥åŠæ—§æœ‰æ ¸å¯¹å…¬å¼æ˜¯å¦éœ€è¦è°ƒæ•´ã€‚</p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgpVE2ASY1aARH-TAAHJrR1s-W0317.png" alt="èµ„æŸç›‘æ§æ ¸å¯¹"></p><ol start="3"><li>æ§ï¼šèµ„é‡‘æ‹¦æˆª + èµ„äº§æ§åˆ¶</li></ol><p>é™¤äº†é˜²å’Œç›‘ï¼Œèµ„æŸé˜²æ§çš„å…³é”®ä¸»è¦åœ¨â€œæ§â€å­—ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨é—®é¢˜å‘ç”Ÿåç¬¬ä¸€æ—¶é—´æ­¢æŸï¼Œè¿™å°±éœ€è¦æŠ€æœ¯åœ¨ç³»ç»Ÿå±‚é¢å¯¹èµ„é‡‘å’Œèµ„äº§æœ‰å¾ˆå¼ºçš„æ§åˆ¶èƒ½åŠ›ã€‚è¿™ç§èƒ½åŠ›çš„è¡¨ç°å°±æ˜¯ï¼š ä¸ä»…å¯ä»¥é€šè¿‡é¢„æ¡ˆå°†æŸäº›åœºæ™¯ä¸é“¾è·¯é™çº§ï¼Œè¿˜å¯ä»¥æ‹¦æˆªèµ„é‡‘çš„æµå‡ºå’Œèµ„äº§çš„ä½¿ç”¨ï¼ŒåŒæ—¶å…·å¤‡å¿«é€Ÿè®¢æ­£é”™è¯¯æ•°æ®çš„èƒ½åŠ›ã€‚</p><p>åœ¨æˆ‘ä»¬å¼€å§‹å¤„ç†èµ„æŸäº‹æ•…æ—¶ï¼Œä¼šæœ‰ä¸‰ä¸ªå…±æ€§çš„éœ€æ±‚ã€‚</p><ul><li>é—®é¢˜æ­¢è¡€ä¸æ–°å¢ï¼šæ ¸å¿ƒæ˜¯å…³é—­é—®é¢˜äº§ç”Ÿæºå¤´ï¼Œå¾€å¾€é€šè¿‡ä¸šåŠ¡åœºæ™¯é™çº§æ¥å®ç°ï¼Œæ¯”å¦‚å¯¹é”™è¯¯çº¢åŒ…æˆ–è€…æ»¡å‡æ´»åŠ¨è¿›è¡Œä¸‹çº¿ã€‚</li><li>æ§åˆ¶èµ„é‡‘æµå‡ºï¼šæ ¸å¿ƒæ˜¯å¯¹èµ„é‡‘å’Œèµ„äº§è¿›è¡Œæ‹¦æˆªä¸å†»ç»“ï¼Œé¿å…å¤–æµåæŸå¤±æ— æ³•ä¿®æ­£ï¼Œæ¯”å¦‚ç¦æ­¢ç”¨æˆ·ä¸‹å•æ—¶å‹¾é€‰ä½¿ç”¨æœ‰é—®é¢˜çš„çº¢åŒ…ã€‚</li><li>å­˜é‡æ•°æ®è®¢æ­£ï¼šæ ¸å¿ƒæ˜¯æå–é—®é¢˜æ•°æ®åå¯ä»¥å¿«é€Ÿåœ°æ‰¹é‡å¤„ç†ï¼Œæ¯”å¦‚æ‰¹é‡æ›´æ”¹çº¢åŒ…çš„é‡‘é¢ã€ç”šè‡³ç›´æ¥å°†çº¢åŒ…æ— æ•ˆã€‚</li></ul><p>è™½ç„¶å…¶ä¸­ä¸€äº›æ“ä½œå¯¹ç”¨æˆ·ä½“éªŒæ˜¯æœ‰æŸçš„ï¼Œä½†æœ‰è€Œä¸ç”¨æ˜¯ä¸€å›äº‹å„¿ï¼Œæ— èƒ½ä¸ºåŠ›åˆ™æ˜¯å¦å¤–ä¸€å›äº‹å„¿ï¼Œå…¶ä¸­ï¼š</p><p>èµ„é‡‘æ‹¦æˆªçš„èƒ½åŠ›ä¸»è¦ä»èµ„é‡‘çš„æµå…¥å’Œæµå‡ºè¿™ä¸¤ç«¯è¿›è¡ŒæŠŠæ§ã€‚ä»¥çº¢åŒ…è€Œè¨€å°±æ˜¯ç®¡æ§å…¶åˆ›å»ºä¸æ ¸é”€ã€‚åœ¨çº¢åŒ…åˆ›å»ºæ—¶ï¼Œæœ‰é¢„ç®—ç³»ç»Ÿè¿›è¡Œç®¡æ§ï¼Œé¿å…æ— é™åˆ¶åœ°ç”Ÿæˆçº¢åŒ…è¿›è€Œè¶…å‘ã€‚åœ¨çº¢åŒ…æ ¸é”€æ—¶ï¼Œç”±äº¤æ˜“å’Œè¥é”€ç³»ç»Ÿè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿è®¢å•ä¸Šä¸‹æ–‡ä»¥åŠçº¢åŒ…åˆæ³•ï¼Œé¿å…é—®é¢˜çº¢åŒ…è¢«æ ¸é”€è¿›è€Œé€ æˆæ— æ³•æŒ½å›çš„èµ„æŸã€‚</p><p>èµ„äº§ç®¡æ§çš„èƒ½åŠ›åˆ™æ˜¯èµ„äº§çš„å¿«é€Ÿé”å®šå’Œæ•°æ®è®¢æ­£å±•å¼€ï¼Œä»¥çº¢åŒ…è€Œè¨€ï¼Œå¦‚æœä¸åŒæ¨¡ç‰ˆä¸åŒæ´»åŠ¨çš„çº¢åŒ…éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ‰¹æ¬¡å·ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è®°å¿«é€Ÿæå–æŸä¸€æ‰¹æœ‰é—®é¢˜çš„æ•°æ®ã€‚åŒæ—¶å¦‚æœæå‰å‡†å¤‡æ‰¹é‡è®¢æ­£çš„è„šæœ¬ï¼Œæˆ–è€…æœ‰è®¢æ­£æ•°æ®çš„å¹³å°ï¼Œå°±å¯ä»¥å¿«é€Ÿä¿®æ”¹çº¢åŒ…é‡‘é¢ã€ä½¿ç”¨æ—¶é—´ã€ä½¿ç”¨é—¨æ§›ç­‰å…³é”®ä¿¡æ¯ï¼Œç”šè‡³æ‰¹é‡æ— æ•ˆæ‰€æœ‰é—®é¢˜çº¢åŒ…ã€‚</p><p>ä½ éœ€è¦æ³¨æ„ï¼Œè¿™äº›èƒ½åŠ›çš„å®ç°æ›´å¤šä¾èµ–äºæŠ€æœ¯ Leader åœ¨æ—¥å¸¸éœ€æ±‚è¿­ä»£å’Œæ¶æ„è®¾è®¡æ—¶ï¼Œæ˜¯å¦æœ‰æ„è¯†å¼•å¯¼å›¢é˜ŸåŠ å¼ºè¿™æ–¹é¢çš„å»ºè®¾ã€‚å¤§éƒ¨åˆ†çš„é¢„æ¡ˆæ€è·¯æ¥æºäºè¿‡å»å·²ç»å‘ç”Ÿçš„é—®é¢˜ï¼Œæˆ–è€…å¯¹æœªæ¥å¯èƒ½å‘ç”Ÿé—®é¢˜çš„å‡è®¾ï¼Œå°†é¢„æ¡ˆå¸¸æ€åŒ–æ˜¯ä½ é‡ç‚¹å…³æ³¨å¹¶æ¨è¿›è½åœ°çš„ã€‚</p><p>é™¤äº†å»ºè®¾é¢„æ¡ˆï¼Œè¿˜è¦æœ‰é¢„æ¡ˆæ¼”ç»ƒï¼Œä»¥æ­¤ä¿è¯é¢„æ¡ˆçš„æœ‰æ•ˆæ€§ã€‚æŠ€æœ¯ Leader æ›´åº”è¯¥é¼“åŠ±æµ‹è¯•å’Œå¼€å‘çš„åŒå­¦ä¸»åŠ¨åšæ”»é˜²æ¼”ç»ƒï¼Œå¯»æ‰¾æ¼æ´ã€éªŒè¯æ­¢æŸæ–¹æ¡ˆã€åŠæ—¶å‘ç°å¹¶ä¿®å¤é—®é¢˜ã€‚</p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/Cip5yGASY2aAan_KAAHwX7CkMbQ394.png" alt="èµ„æºé¢„æ¡ˆæ­¢æŸ"></p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgpVE2ASY3WAF33QAAE50Zm97VM138.png"></p><h2 id="æŠ€æœ¯å€ºåŠ¡"><a href="#æŠ€æœ¯å€ºåŠ¡" class="headerlink" title="æŠ€æœ¯å€ºåŠ¡"></a>æŠ€æœ¯å€ºåŠ¡</h2><p>æŠ€æœ¯å€ºåŠ¡åœ¨ç ”å‘é¢†åŸŸç±»ä¼¼äºâ€œé‡‘èå€ºåŠ¡â€çš„æ¦‚å¿µï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯è¯´å› ä¸ºäººä¸ºå¦¥åï¼Œç³»ç»Ÿçš„è®¾è®¡å’Œå®ç°æ²¡æœ‰éµå¾ªæœ€ä½³å®è·µï¼Œæ‰€ä»¥è™½ç„¶çŸ­æœŸåšåˆ°äº†å¿«é€Ÿäº¤ä»˜ï¼Œä½†ä¹Ÿåˆ¶çº¦äº†ç³»ç»Ÿæœªæ¥çš„å¯æ‰©å±•æ€§ï¼Œå¹¶ä¸”åŸ‹ä¸‹äº†ç¨³å®šæ€§çš„é£é™©éšæ‚£ã€‚</p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgqCHmAXyHeAZE15AAF3VXvSekM464.png" alt="æŠ€æœ¯å€ºåŠ¡"></p><h3 id="é‡è§†æŠ€æœ¯å€ºåŠ¡çš„åŸå› "><a href="#é‡è§†æŠ€æœ¯å€ºåŠ¡çš„åŸå› " class="headerlink" title="é‡è§†æŠ€æœ¯å€ºåŠ¡çš„åŸå› "></a>é‡è§†æŠ€æœ¯å€ºåŠ¡çš„åŸå› </h3><ul><li>å½±å“ç³»ç»Ÿæ‰©å±•å’Œéœ€æ±‚äº¤ä»˜</li><li>æ¶æ€§å¾ªç¯å¯¼è‡´äººå‘˜æµå¤±</li></ul><p>æŠ€æœ¯å€ºåŠ¡çš„æ¶æ€§å¾ªç¯ä¼šå½±å“å¼€å‘å›¢é˜Ÿçš„ç”Ÿäº§åŠ›ï¼Œå¹¶é™ä½å›¢é˜Ÿçš„å£«æ°”å’Œæˆå‘˜çš„é©±åŠ¨åŠ›ï¼Œè€Œä½ç”Ÿäº§ç‡å¯¼è‡´å›¢é˜Ÿåªèƒ½ä¼˜å…ˆäº¤ä»˜åŠŸèƒ½ï¼Œè¿™å°±æ¨è¿Ÿäº†æŠ€æœ¯å€ºåŠ¡çš„è§£å†³ï¼Œä»è€Œè¿›ä¸€æ­¥å¢åŠ æŠ€æœ¯å€ºåŠ¡ã€‚</p><h3 id="å¦‚ä½•ä»å¾ªç¯çš„å€ºåŠ¡å›°å¢ƒä¸­çªå›´è€Œå‡ºï¼Ÿ"><a href="#å¦‚ä½•ä»å¾ªç¯çš„å€ºåŠ¡å›°å¢ƒä¸­çªå›´è€Œå‡ºï¼Ÿ" class="headerlink" title="å¦‚ä½•ä»å¾ªç¯çš„å€ºåŠ¡å›°å¢ƒä¸­çªå›´è€Œå‡ºï¼Ÿ"></a>å¦‚ä½•ä»å¾ªç¯çš„å€ºåŠ¡å›°å¢ƒä¸­çªå›´è€Œå‡ºï¼Ÿ</h3><p>1.å€ºåŠ¡çš„ Owner æ˜¯æŠ€æœ¯ Leader</p><p>è¦æƒ³è§£å†³æŠ€æœ¯å€ºåŠ¡ï¼Œä½ éœ€è¦æ‰¾åˆ°æŠ€æœ¯ä¸ä¸šåŠ¡çš„å¹³è¡¡ç‚¹ï¼Œæˆ‘çš„ç»éªŒæ˜¯â€œå†…å¤–åŒä¿®â€ï¼š</p><p>å†…ï¼šåŠ å¼ºå›¢é˜Ÿçš„æˆ˜æ–—åŠ›ï¼Œå‡å°‘å€ºåŠ¡äº§ç”Ÿçš„æœºä¼šï¼Œå¢å¼ºå€ºåŠ¡å¤„ç†çš„èƒ½åŠ›ã€‚</p><p>å¤–ï¼šæ·±åˆ»åœ°ç†è§£ä¸šåŠ¡ï¼Œå¹¶ä¸”åšå¥½ä¸å…¶ä»–åä½œæ–¹ï¼ˆå°¤å…¶æ˜¯äº§å“ã€ä¸šåŠ¡ï¼‰çš„æ²Ÿé€šã€‚è¿™æ ·ä½ æ‰èƒ½ç†è§£åä½œæ–¹æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä»–ä»¬ä»¥ä¸ºè¦ä¹ˆAã€è¦ä¹ˆBæ‰èƒ½è§£å†³çš„é—®é¢˜ï¼Œæ—¢æ‡‚æŠ€æœ¯åˆæ‡‚ä¸šåŠ¡çš„ä½ èƒ½å¦æ‰¾åˆ°æ–¹æ¡ˆCï¼Ÿ</p><p>å»ºè®®ï¼šé¢å¯¹é€‰æ‹©é¢˜æ—¶ä¸è¦åªçœ‹åˆ°å¯é€‰é¡¹ï¼Œè¦æ°¸è¿œå¯»æ‰¾ç¬¬ä¸‰æ¡è·¯ã€‚å¦‚æœå®åœ¨æ²¡æœ‰å…¶ä»–é€‰æ‹©ï¼Œåœ¨æŠ€æœ¯å¦¥åçš„åŒæ—¶ï¼Œåšå¥½æ²Ÿé€šï¼Œè®©åä½œæ–¹æ˜ç™½æ–¹æ¡ˆçš„ä¸´æ—¶æ€§ä»¥åŠå¯¹æœªæ¥çš„å½±å“ï¼Œäº‰å–åˆ°æ‰¿è¯ºåœ¨æœªæ¥ç»™ä½ è¶³å¤Ÿæ—¶é—´è§£å†³è¿™äº›é—®é¢˜ã€‚</p><ol start="2"><li>é€šè¿‡ CheckList è¯†åˆ«å€ºåŠ¡</li></ol><p>å»ºç«‹ä¸€ä¸ªå€ºåŠ¡ Review çš„ CheckList ï¼Œå¹¶ä¸”ä¸æ–­å®Œå–„ã€‚æŠ€æœ¯å€ºåŠ¡ä»è¡¨è±¡ä¸Šå¯ä»¥åšä¸€äº›ç»†åˆ†ï¼š</p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/Ciqc1GAXyKCAQhAeAAIzRmP_aiA027.png" alt="æŠ€æœ¯å€ºåŠ¡åˆ’åˆ†"></p><p>é€šè¿‡ç°è±¡æˆ‘ä»¬å°±å¯ä»¥åæ¨å‡ºä¸€äº›å¯¼è‡´ç°è±¡çš„åŸå› ï¼Œå°†è¿™äº›åŸå› ç»“åˆç³»ç»Ÿçš„æ¶æ„è¿›è¡Œåˆ†ç±»ï¼Œå°±ä¼šå½¢æˆä¸€ä¸ªä¸ªå…·ä½“çš„å…³æ³¨ç‚¹ã€‚è¿™äº›å…³æ³¨ç‚¹å¾€å¾€æ˜¯ç»“åˆæˆ‘ä»¬ä¹‹å‰è¸©è¿‡çš„å‘ã€å‘ç”Ÿè¿‡çš„é—®é¢˜ï¼Œä»¥åŠç¼–ç ã€æ¶æ„ä¸Šå¹¿ä¸ºéµå®ˆçš„ä¸€äº›æœ€ä½³å®è·µæ‰€å½¢æˆçš„ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åˆ¶å®šå‡ºä¸€ä¸ªè¾ƒä¸ºè¯¦ç»†çš„ CheckList ç”¨ä»¥å…·ä½“çš„å€ºåŠ¡è¯†åˆ«ï¼ˆä¸‹å›¾ä¾›å‚è€ƒï¼‰ã€‚</p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgqCHmAXyKmAL5F9AAGrGtOqSM0087.png" alt="å€ºåŠ¡ç»†åˆ†"></p><ol start="3"><li>æœ‰è®¡åˆ’åœ°åˆ†çº§å¿å€º</li></ol><ul><li><p>å…³é”®é“¾è·¯ä¼˜å…ˆï¼š å¹¶éæ‰€æœ‰ç³Ÿç³•çš„è®¾è®¡ä¸å®ç°éƒ½èƒ½äº§ç”Ÿä¸¥é‡åæœï¼Œå³ä½¿èƒ½ï¼Œå®ƒä»¬å‘ç”Ÿçš„æ¦‚ç‡ä¹Ÿä¸ä¸€æ ·ï¼Œè€Œå…³é”®é“¾è·¯æ„å‘³ç€ä¸šåŠ¡å½±å“æœ€å¤§ï¼ŒåŒæ—¶æ—¥å¸¸çš„æ”¹åŠ¨é¢‘ç‡å’Œäº‹æ•…é£é™©ä¹Ÿè¾ƒé«˜ï¼Œä¼˜å…ˆè§£å†³å®ƒçš„æ”¶ç›Šæ˜¯æœ€å¤§çš„ã€‚</p></li><li><p>å†å²äº‹æ•…å‘½ä¸­ä¼˜å…ˆï¼š ä¸€äº›è®¾è®¡ä¸å®ç°åœ¨è¿‡å¾€å¯¼è‡´è¿‡çº¿ä¸ŠçœŸå®é—®é¢˜çš„å‘ç”Ÿï¼Œä¸ç®¡æ˜¯å¦å‘ç”Ÿåœ¨æœ¬ç³»ç»Ÿè¿˜æ˜¯å½“å‰å›¢é˜Ÿï¼Œéƒ½ç›¸å½“äºå·²ç»è¢«è¯å®è¿‡çš„è¿™ç±»å€ºåŠ¡çš„ä¸¥é‡æ€§ï¼Œæ‰€ä»¥åº”è¯¥å°½æ—©ä¿®å¤å®ƒä»¬ï¼Œé¿å…ç±»ä¼¼é—®é¢˜åå¤å‘ç”Ÿã€‚</p></li><li><p>å¯æ‰©å±•æ€§ä¼˜å…ˆï¼š åœ¨ CheckList ä»¥åŠå€ºåŠ¡ç°è±¡ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ‰äº›é—®é¢˜å½±å“äº†ç³»ç»Ÿæœªæ¥çš„æ¼”è¿›ï¼Œå¢åŠ äº†è¿­ä»£æˆæœ¬ï¼Œæœ‰äº›é—®é¢˜å½±å“ç³»ç»Ÿçš„ç»´æŠ¤ï¼Œæ¯”å¦‚ä»£ç é£æ ¼æ²¡æœ‰ç»Ÿä¸€ã€ç¼ºå°‘æ–‡æ¡£ï¼Œåœ¨å¤„ç†æ—¶åº”è¯¥ä¼˜å…ˆå¤„ç†å½±å“å¯æ‰©å±•æ€§çš„é—®é¢˜ï¼Œåç»­é€æ­¥å¤„ç†å½±å“å¯ç»´æŠ¤æ€§çš„é—®é¢˜ã€‚</p></li><li><p>æƒè´£æ¸…æ™°ä¼˜å…ˆï¼š ä¸€äº›é—®é¢˜åœ¨å¤„ç†æ—¶å—åˆ°å†å²æ¶æ„ã€ç»„ç»‡åˆ†å·¥ï¼ˆåº·å¨å®šå¾‹ï¼‰çš„å½±å“ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿçš„æƒè´£ä¸æ¸…æ™°ï¼Œè¿™ç±»ç³»ç»Ÿçš„æ¨è¿›å’Œæ”¹é€ å¾€å¾€éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ç²¾åŠ›ï¼Œå¹¶ä¸”ä»é¡¶å±‚è®¾è®¡å‡ºå‘å»é‡æ–°è€ƒé‡ï¼Œæ‰€ä»¥æƒè´£æ¸…æ™°çš„éƒ¨åˆ†å¯ä»¥ä¼˜å…ˆå¤„ç†ã€‚</p></li></ul><p>æ€»çš„æ¥è¯´ï¼Œé€šè¿‡å¯¹æŠ€æœ¯å€ºåŠ¡è¿›è¡Œåˆ†çº§ï¼Œå®è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜åˆ†æ²»çš„è¿‡ç¨‹ï¼Œå°†å¤§é—®é¢˜åˆ‡åˆ†æˆä¸€ä¸ªä¸ªå°é—®é¢˜ï¼Œè¿™æ ·å°±å¯ä»¥å°†å®ƒä»¬åŠ å…¥æ—¥å¸¸çš„è¿­ä»£ä¸­ï¼Œå½¢æˆä¸€ä¸ªåˆ†æœŸå¿è¿˜æŠ€æœ¯å€ºåŠ¡çš„è®¡åˆ’ï¼Œé€æ­¥å‡å°‘æŠ€æœ¯å€ºåŠ¡ï¼Œå‡è½»è´Ÿæ‹…è®©å›¢é˜Ÿä¸ç³»ç»Ÿå¯ä»¥è½»è£…ä¸Šé˜µã€‚</p><ol start="4"><li>æ­£è§†å€ºåŠ¡åšå¥½é¢„é˜²</li></ol><p>é™¤æ­¤ä¹‹å¤–ï¼Œé¢„é˜²æ°¸è¿œèƒœäºæ²»ç–—ï¼ŒæŠ€æœ¯å€ºåŠ¡æ±‡æ€»é¢„é˜²çš„å…³é”®ç‚¹åœ¨äºé‚£äº›â€œåŸæœ¬æœªçŸ¥â€çš„æŠ€æœ¯å€ºåŠ¡è¦é€æ¸å‡å°‘ï¼Œå¤§å®¶å¯¹äºå®ç°è´¨é‡çš„è¿½æ±‚ä¸èƒ½æ­¢æ­¥äºâ€œæµ‹è¯•æ²¡æœ‰æ˜æ˜¾ Bugâ€ï¼Œå†™å‡ºèƒ½è¿è¡Œçš„ä»£ç æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜è¦æ˜“ç»´æŠ¤æ˜“æ‰©å±•ã€‚</p><p>å¯ä»¥ä»å‡ ä¸ªæ–¹é¢ç€æ‰‹ï¼š</p><ul><li>æå‡å›¢é˜Ÿè®¤è¯†ï¼Œé€šè¿‡é¡¹ç›®å¤ç›˜ã€ç³»ç»Ÿé‡æ„ã€äº‹æ•… Review ç­‰å„ç§æœºä¼šï¼Œé€šè¿‡å®é™…çš„æ¡ˆä¾‹è®©ç ”å‘åŒå­¦æ¸…æ¥šæŠ€æœ¯å€ºåŠ¡å¯¹å›¢é˜Ÿäº§ç”Ÿçš„è´Ÿæ‹…ï¼Œä»¥åŠå¯¹ä¸ªäººèƒ½åŠ›æå‡çš„å½±å“ã€‚</li><li>å»ºç«‹æœºåˆ¶æµç¨‹ï¼Œæ¯”å¦‚åœ¨æ–¹æ¡ˆè®¾è®¡é˜¶æ®µå‘ä¸‹æ·±æŒ–ä¸€ä¸‹å®ç°çš„è¦ç‚¹ï¼Œæ›´å¤šèµ„æ·±çš„å¼€å‘å‚ä¸åˆ°æ¶æ„è¯„å®¡ï¼Œæˆ–è€…ä¿ƒè¿›å›¢é˜Ÿå½¢æˆ code review çš„ä¹ æƒ¯å¹¶ä¸”è¾¾æˆä¸€ä¸ªå…±è¯†æ ‡å‡†ä»¥æå‡ç³»ç»Ÿè´¨é‡ã€‚</li><li>ç¡®ä¿èµ„æºæŠ•å…¥ï¼Œåœ¨é€šè¿‡å€ºåŠ¡è¯†åˆ«å’Œåˆ†çº§åï¼Œå°†è¿˜å€ºçš„æŠ•å…¥æå‰è®¡ç®—åˆ°æ¯æ¬¡è¿­ä»£ä¸­ï¼Œç¡®ä¿æœ‰ä¸€å®šçš„èµ„æºæŠ•å…¥å…¶ä¸­ã€‚</li></ul><ol start="5"><li>ä¸€äº›å¸¸è§çš„è¯¯åŒº</li></ol><p>é€šè¿‡ CheckList åšå€ºåŠ¡è¯†åˆ«ï¼Œç„¶åå®šæœŸè¯Šæ–­ã€æ°´å¹³æ‰«æã€å€ºåŠ¡å®šçº§ã€åˆ†æœŸå¿è¿˜æ¥åšæŠ€æœ¯å€ºåŠ¡çš„å¤„ç†ï¼Œæœ€ç»ˆåœ¨å›¢é˜Ÿè®¤è¯†ã€æœºåˆ¶æ°›å›´ã€èµ„æºä¿éšœä¸Šä¸‹åŠŸå¤«åšé¢„é˜²ï¼Œè¿™å°±æ˜¯æŠ€æœ¯å€ºåŠ¡ç®¡ç†çš„æ ¸å¿ƒæ€è·¯ã€‚</p><p>è€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›é—®é¢˜æ˜¯æ—¥å¸¸ä½ å¾ˆå®¹æ˜“èµ°å…¥è¯¯åŒºçš„ï¼Œæˆ‘ç®€å•æ€»ç»“äº†ä¸€ä¸‹å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p><ul><li><p>å­˜åœ¨å³åˆç†ï¼ŒåŠ¨æ€å˜åŒ–æ‰æ˜¯ç‹é“ã€‚ ä¸è¦æ€»æƒ³ç€æ¯•å…¶åŠŸäºä¸€å½¹ï¼Œä¹Ÿå‡ ä¹ä¸å¤ªå¯èƒ½æœ‰å®Œç¾çš„å®ç°æˆ–ç³»ç»Ÿï¼Œæ¥å—æŠ€æœ¯å€ºåŠ¡ä¸€å®šä¼šå­˜åœ¨çš„äº‹å®ï¼Œé‡ç‚¹åœ¨äºæ§åˆ¶å€ºåŠ¡ç§¯å‹çš„ç¨‹åº¦ï¼Œæ¬ å€ºæœ¬èº«ä¸å¯æ€•ï¼Œæ¬ å€ºä¸çŸ¥ä¸”ä¸è¿˜æ‰å¯æ€•ã€‚</p></li><li><p>ä¸ç§¯è·¬æ­¥æ— ä»¥è‡³åƒé‡Œã€‚æˆ‘ä»¬å¾€å¾€è¿‡åº¦è½»è§†æ—¥å¸¸ç§¯ç´¯ï¼Œåˆè¿‡åº¦é‡è§†â€œå¤§äº‹ä»¶â€äº§ç”Ÿçš„å½±å“ã€‚æ—¥å¸¸è¿™é‡Œå‡‘åˆä¸€ä¸‹ï¼Œé‚£é‡Œå¦¥åä¸€ç‚¹ï¼Œæ²¡äººå…³æ³¨å°é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚è€Œä¸€æ—¦å‘ç”Ÿé‡å¤§çš„å½±å“ï¼Œåˆ™æ¨ä¸å¾—æŠŠä¹‹å‰çš„ç³»ç»Ÿå…¨ç›˜æ¨ç¿»é‡åšä¸€éã€‚</p></li><li><p>æœºåˆ¶æµç¨‹å¤–è¿˜è¦è®²ç­–ç•¥å’Œæ–¹æ³•ã€‚å¾ˆå¤šæŠ€æœ¯ Leader è§‰å¾—è¿™ä»¶äº‹å¾ˆé‡è¦ï¼Œè®²çš„åŒæ—¶è®¾è®¡äº†å¾ˆå¤šæµç¨‹å’Œæœºåˆ¶ï¼Œä¸éµå®ˆå°±è¦æ‰¿æ‹…æ€æ ·æ€æ ·çš„åæœï¼Œè¿™æ ·å¾€å¾€äº‹åŠåŠŸå€ã€‚æœºåˆ¶æµç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œä¹Ÿä¸èƒ½å…‰æœ‰æƒ©ç½šè€Œæ²¡æœ‰æ¿€åŠ±ï¼ŒåŒæ—¶æœ€é‡è¦çš„æ˜¯ä½ ä¸èƒ½åªè¿½æ€è¦ç»“æœï¼Œè¦ç»™å¸®åŠ©ã€ç»™æ–¹æ³•ã€ç»™æ”¯æŒã€‚</p></li></ul><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CgpVE2AXyMeAKHX_AAGCjDqqNX4257.png" alt="å€ºåŠ¡æ€»ç»“"></p><h2 id="å¤§é¡¹ç›®ï¼šæŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨"><a href="#å¤§é¡¹ç›®ï¼šæŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨" class="headerlink" title="å¤§é¡¹ç›®ï¼šæŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨"></a>å¤§é¡¹ç›®ï¼šæŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨</h2><h3 id="è®¤æ¸…å¼‚åŒï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°"><a href="#è®¤æ¸…å¼‚åŒï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°" class="headerlink" title="è®¤æ¸…å¼‚åŒï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°"></a>è®¤æ¸…å¼‚åŒï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°</h3><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CioPOWAcw7WAEx7QAAE0B9ewvBc719.png" alt="é¡¹ç›®è¿­ä»£å‘¨æœŸ"></p><p>åœ¨è¿™ä¸ªå¸¸è§„æµç¨‹ä¸­ï¼ŒæŠ€æœ¯å›¢é˜Ÿçš„é‡å¿ƒæ˜¯æŠŠæ‰§è¡Œåšåˆ°ä½ï¼Œä½ è¦æ›´å…³æ³¨è¿‡ç¨‹ç®¡æ§ï¼Œç¡®ä¿ç³»ç»Ÿäº¤ä»˜ã€‚</p><p>å¤§é¡¹ç›®ä¸å¸¸è§„é¡¹ç›®çš„æ ¸å¿ƒå·®å¼‚ç‚¹ï¼Œæˆ‘è®¤ä¸ºä¸»è¦åœ¨äºè¿™ä¸ªâ€œå¤§â€å­—ä¸Šï¼Œä½ å¯ä»¥ä»ä¸‰ä¸ªæ–¹é¢å»ç†è§£ã€‚</p><ul><li>å‡ºå‘ç‚¹ä¸åŒï¼Œä¸šåŠ¡æœŸæœ›æ›´å¤§</li><li>è§„æ¨¡ä¸åŒï¼Œå¤æ‚åº¦æ›´é«˜</li><li>ç»“æœè¯„åˆ¤æ ‡å‡†ä¸åŒï¼Œå½±å“æ›´å¤§</li></ul><h3 id="æŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨"><a href="#æŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨" class="headerlink" title="æŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨"></a>æŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨</h3><blockquote><p>å…³æ³¨æ•ˆæœæ›´é‡äºå…³æ³¨äº¤ä»˜ï¼Œè¿™æ˜¯å¤§é¡¹ç›®çš„æ ¸å¿ƒç‰¹å¾ã€‚</p></blockquote><p>ä¸è¦ä¸ºäº†é‡æ„è€Œé‡æ„ï¼Œè¦çŸ¥é“ä½ è¦çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚</p><p>å¤§é¡¹ç›®çš„å¤±è´¥å­˜åœ¨ä¸€ä¸ªå…±æ€§çš„é—®é¢˜ï¼šå›´ç»•ä¸šåŠ¡ç»“æœçš„æ€è€ƒã€è®¡åˆ’ä¸è¶³ï¼Œç›®æ ‡çš„å®šä¹‰ä¸æ¸…æ™°æˆ–æ²¡æœ‰å……åˆ†åŒæ­¥ç»™æ‰€æœ‰ç›¸å…³äººï¼Œé¡¹ç›®åŒå­¦çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚è¿ç›®æ ‡éƒ½æ²¡æœ‰å…±è¯†ï¼Œä½•è°ˆæ‰§è¡Œåˆ°ä½ï¼Œé¡¹ç›®æˆåŠŸï¼Ÿ</p><p>æ‰€ä»¥æˆ‘è®¤ä¸ºè¶Šæ˜¯é‡å¤§çš„é¡¹ç›®ï¼Œåœ¨è®¡åˆ’ã€è®¾è®¡ã€å‡†å¤‡ä¸ŠæŠ•å…¥çš„ç²¾åŠ›å°±åº”è¯¥è¶Šå¤šï¼Œè°‹å®šè€ŒååŠ¨ã€‚</p><ul><li><p>WHYï¼ˆé¡¹ç›®ä¸ºä»€ä¹ˆåšï¼‰</p></li><li><p>WHATï¼ˆé¡¹ç›®åšæˆä»€ä¹ˆæ ·ï¼‰</p></li></ul><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CioPOWAcxamAVdqbAACyNLxS9YE927.png" alt="what"></p><ul><li><p>WHOï¼ˆå“ªäº›äººæ¥ä¸€èµ·åšé¡¹ç›®ï¼‰</p></li><li><p>HOWï¼ˆå¯åŠ¨é¡¹ç›®åå¦‚ä½•åšï¼‰</p><ul><li><p>åˆç†æ‹†åˆ†ä»»åŠ¡ï¼ˆæ¨¡å—ï¼‰æ˜¯é¡¹ç›®æˆåŠŸçš„ä¸€åŠ</p></li><li><p>ä¿æŒé£é™©æ„è¯†ï¼Œæ•¬ç•å¢¨è²å®šå¾‹</p></li></ul></li></ul><p>åšå¥½å……åˆ†çš„å‡†å¤‡ä¹‹åï¼Œå¯ä»¥å¬å¼€ç«‹é¡¹ä¼šï¼Œå°† WHYã€WHATã€WHOã€HOW çš„ä¿¡æ¯ä¸æ€è€ƒåŒæ­¥ç»™é¡¹ç›®ç›¸å…³äººå‘˜ã€‚é€šè¿‡ Kick Off ä¼šè®®ç¡®å®šé¡¹ç›®çš„åŸºè°ƒã€åŒæ­¥å¿…è¦ä¿¡æ¯ï¼Œä¸ºé¡¹ç›®æ¨è¿›æ‰«æ¸…éšœç¢ã€‚</p><h4 id="å¦‚ä½•å¤„ç†æ£˜æ‰‹é—®é¢˜"><a href="#å¦‚ä½•å¤„ç†æ£˜æ‰‹é—®é¢˜" class="headerlink" title="å¦‚ä½•å¤„ç†æ£˜æ‰‹é—®é¢˜"></a>å¦‚ä½•å¤„ç†æ£˜æ‰‹é—®é¢˜</h4><h5 id="é—®é¢˜ä¸€ï¼šç¼ºå…µå°‘å°†æ€ä¹ˆåŠï¼Ÿ"><a href="#é—®é¢˜ä¸€ï¼šç¼ºå…µå°‘å°†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="é—®é¢˜ä¸€ï¼šç¼ºå…µå°‘å°†æ€ä¹ˆåŠï¼Ÿ"></a>é—®é¢˜ä¸€ï¼šç¼ºå…µå°‘å°†æ€ä¹ˆåŠï¼Ÿ</h5><p>é¡¹ç›®ç»„äººæ—¶ä½ è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ã€‚</p><ul><li>å½“é¡¹ç›®å¼€å§‹æ—¶ï¼Œä»æ›´å¤§çš„èŒƒå›´å†…å¯»æ‰¾åˆé€‚çš„åŒå­¦ï¼Œè€Œä¸æ˜¯çœ‹ä½ å›¢é˜Ÿæœ‰å“ªäº›äººã€‚</li><li>å°†å‚ä¸é¡¹ç›®çš„åŒå­¦åœ¨ä¸€å®šæ—¶é—´å†…çš„æ±‡æŠ¥å…³ç³»å’Œç»©æ•ˆè€ƒæ ¸æ±‡æ€»åˆ°é¡¹ç›®ç»„ä¸­ï¼Œç”±é¡¹ç›®è´Ÿè´£äººæ ¹æ®å®é™…æƒ…å†µé‡æ–°å®‰æ’æ¯ä¸ªäººçš„æƒè´£ï¼Œå¹¶ç¡®å®šç»©æ•ˆçš„ç»‘å®šå…³ç³»ä¸æ¯”ä¾‹ã€‚</li><li>é¡¹ç›®äº¤ä»˜å¹¶ä¸ç­‰äºç»“æŸï¼Œæ‰€æœ‰äººçš„ç»©æ•ˆç»“æœéƒ½åº”å’Œé¡¹ç›®ç›®æ ‡çš„è¾¾æˆæƒ…å†µç´§å¯†ä¸”é•¿æœŸå…³è”ã€‚</li></ul><p>æœ€åï¼Œæœ‰æ—¶ä¸ä»…è¦è§£å†³â€œç¼ºå…µâ€çš„é—®é¢˜ï¼Œè¿˜è¦è®¤çœŸè€ƒè™‘æ˜¯å¦â€œå°‘å°†â€ï¼Ÿè¦å……åˆ†è€ƒè™‘å½“å‰çš„äººå‘˜æ˜¯å¦é€‚åˆåšé¡¹ç›®çš„ Ownerï¼Œä»¥æˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œé¡¹ç›® Owner å‡ ä¹å†³å®šäº†é¡¹ç›®æˆè´¥çš„ 80%ï¼Œå¦‚æœ Owner èƒ½åŠ›ä¸è¶³ï¼Œä½ è¦ç»™äºˆå¸®åŠ©å’Œæ”¯æŒï¼Œæˆ–è€…å¦æ‰¾ä»–äººï¼Œä¹ƒè‡³ä¸Šçº§çš„å¸®åŠ©ï¼Œä¸è¦åœ¨ Owner çš„äººé€‰ä¸Šå¦¥åï¼Œæ¯•ç«Ÿé¡¹ç›®æˆè´¥æ‰æ˜¯å…³é”®ã€‚</p><h5 id="é—®é¢˜äºŒï¼šæ¨ä¸åŠ¨çš„åˆ°åº•æ˜¯äººè¿˜æ˜¯äº‹ï¼Ÿ"><a href="#é—®é¢˜äºŒï¼šæ¨ä¸åŠ¨çš„åˆ°åº•æ˜¯äººè¿˜æ˜¯äº‹ï¼Ÿ" class="headerlink" title="é—®é¢˜äºŒï¼šæ¨ä¸åŠ¨çš„åˆ°åº•æ˜¯äººè¿˜æ˜¯äº‹ï¼Ÿ"></a>é—®é¢˜äºŒï¼šæ¨ä¸åŠ¨çš„åˆ°åº•æ˜¯äººè¿˜æ˜¯äº‹ï¼Ÿ</h5><ul><li>ææ˜ç™½å†²çªç°è±¡ä¸‹çš„åˆ©ç›Šè¯‰æ±‚ï¼š ä¸åŒå…³è”æ–¹äº§ç”Ÿè§‚ç‚¹å†²çªçš„ç°è±¡èƒŒåå…¶å®æ˜¯åˆ©ç›Šå†²çªï¼Œä½ è¦ææ¸…æ¥šå½¼æ­¤çš„é¡¾è™‘ã€‚æ¯”å¦‚æˆ‘ä¸æ„¿æƒ³è®©æŸä¸ªç³»ç»Ÿå­—æ®µè½åˆ°è®¢å•ä¸­ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è®¢å•ç³»ç»Ÿçš„å¯ç»´æŠ¤ä»¥åŠç¨³å®šæ€§ï¼Œå¦‚æœä½ èƒ½è§£å†³æˆ‘çš„é¡¾è™‘ï¼Œä¼šå®¹æ˜“è¯´æœæˆ‘ã€‚</li><li>ä¸ºé¡¹ç›®ç»“æœé€‚å½“å¦¥åï¼š åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•åšå‡ºå®Œç¾çš„æ–¹æ¡ˆï¼Œå¯èƒ½å°±æ˜¯è¦åœ¨ç³»ç»Ÿå†…é€šè¿‡å¾ˆç³Ÿç³•çš„å®ç°å»å®ç°éœ€æ±‚ã€‚é¡¹ç›®æ²¡æœ‰ 100% å®Œç¾ï¼ŒæŠ“ä½æ ¸å¿ƒåŸåˆ™ä¸æ”¾å¼ƒï¼Œå¯æ§éƒ¨åˆ†é€‚å½“å¦¥åæ¢å–é¡¹ç›®å‰è¿›æ˜¯å¾ˆå¥½çš„ç­–ç•¥ã€‚</li><li>é€šè¿‡é¡¹ç›®åœ°ä½å’Œå†³ç­–æœºåˆ¶æ¨åŠ¨é¡¹ç›®ï¼š å¤§é¡¹ç›®å¾€å¾€æ˜¯å…¬å¸é‡å¤§æˆ˜ç•¥ä¸‹çš„äº§ç‰©ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šæœ‰äººå»åå¯¹å…¬å¸çš„æŸé¡¹æ—¢å®šæˆ˜ç•¥ï¼Œè€Œä½ å¯ä»¥é€šè¿‡å¤§é¡¹ç›®çš„é‡è¦æ€§åœ¨ä½“ç³»å†…äº‰å–æ›´å¤šçš„èµ„æºå’Œå¸®åŠ©ã€‚å¦‚æœä½ é¢ä¸´ä¸€äº›å†²çªï¼Œè¦å­¦ä¼šåˆ©ç”¨å†³ç­–æœºåˆ¶ï¼Œé€šè¿‡æ›´é«˜çº§åˆ«æˆå‘˜çš„æ²Ÿé€šå†³ç­–æ‹¿åˆ°è§£å†³æ–¹æ¡ˆã€‚</li></ul><h5 id="é—®é¢˜ä¸‰ï¼šä¸€å®šä¼šæœ‰é¡¹ç›®å˜æ›´å—ï¼Ÿ"><a href="#é—®é¢˜ä¸‰ï¼šä¸€å®šä¼šæœ‰é¡¹ç›®å˜æ›´å—ï¼Ÿ" class="headerlink" title="é—®é¢˜ä¸‰ï¼šä¸€å®šä¼šæœ‰é¡¹ç›®å˜æ›´å—ï¼Ÿ"></a>é—®é¢˜ä¸‰ï¼šä¸€å®šä¼šæœ‰é¡¹ç›®å˜æ›´å—ï¼Ÿ</h5><p>å¸¸è§çš„å˜åŒ–å¾€å¾€æœ‰ä¸¤ç§ï¼š</p><ul><li>é¡¹ç›®æ¼”è¿›è¿‡ç¨‹ä¸­è¯†åˆ«å‡ºä¹‹å‰æœªèƒ½è¯†åˆ«æˆ–è€ƒè™‘ç¼ºå¤±çš„ç‚¹ï¼Œå¯¼è‡´æ–¹æ¡ˆéœ€è¦è°ƒæ•´ã€‚</li><li>å‡ºè‡ªè€æ¿çš„éœ€æ±‚å˜æ›´ï¼Œå¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯è¦æ–°å¢å†…å®¹ã€‚</li></ul><h4 id="3ä¸ªé‡ç‚¹"><a href="#3ä¸ªé‡ç‚¹" class="headerlink" title="3ä¸ªé‡ç‚¹"></a>3ä¸ªé‡ç‚¹</h4><ol><li><p>é©¾é©­å¤§é¡¹ç›®æ˜¯ä½ çš„è¯•é‡‘çŸ³å’Œåˆ†æ°´å²­ï¼Œå¯¹è‡ªå·±èŒä¸šè§„åˆ’æœ‰ä¸€å®šè¦æ±‚çš„åŒå­¦ä¸€å®šä¸è¦æ”¾è¿‡æ‰“ç£¨ä¿®ç‚¼çš„æœºä¼šã€‚</p></li><li><p>åœ¨å¤§é¡¹ç›®ä¸­ï¼Œå¾€å¾€äººçš„é—®é¢˜ä¼šæ¯”æŠ€æœ¯ä¸ç³»ç»Ÿçš„é—®é¢˜éš¾è§£å†³ï¼Œå› ä¸ºä¸äººç›¸å…³çš„é—®é¢˜æœªå¿…å®Œå…¨ç†æ€§å’Œé€»è¾‘ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ ä¹Ÿä¸å¦¨çœ‹çœ‹æ„Ÿæ€§çš„æ²Ÿé€šä¸äº¤æµæ˜¯ä¸æ˜¯æœ‰æ›´å¥½çš„æ•ˆæœã€‚</p></li><li><p>æ—¶åˆ»ç‰¢è®°ä½ å°†é¡¹ç›®æŒ‰æ—¶ä¸Šçº¿æ²¡æœ‰æ•…éšœåªæ˜¯åšåˆ°äº†60åˆ†ï¼Œæ›´å…³é”®çš„æ˜¯ä¸šåŠ¡æ•ˆæœï¼Œæ‰€ä»¥é™¤äº†ç›¯ç´§å¼€å‘è¿‡ç¨‹å¤–ï¼Œè¿˜è¦åœ¨æœ€å¼€å§‹çš„ä¸šåŠ¡ä¸äº§å“è®¾è®¡é˜¶æ®µå°±æŠ•èº«å…¶ä¸­ã€‚</p></li></ol><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/Cgp9HWAeZGqARfAHAAohBfqxiaQ465.png" alt="é¡¹ç›®"></p><h2 id="ä¸šåŠ¡ç†è§£ï¼šæ·±å…¥ä¸šåŠ¡æ˜¯åšå¥½æ¶æ„çš„å‰æ"><a href="#ä¸šåŠ¡ç†è§£ï¼šæ·±å…¥ä¸šåŠ¡æ˜¯åšå¥½æ¶æ„çš„å‰æ" class="headerlink" title="ä¸šåŠ¡ç†è§£ï¼šæ·±å…¥ä¸šåŠ¡æ˜¯åšå¥½æ¶æ„çš„å‰æ"></a>ä¸šåŠ¡ç†è§£ï¼šæ·±å…¥ä¸šåŠ¡æ˜¯åšå¥½æ¶æ„çš„å‰æ</h2><h3 id="ä¸ºä»€ä¹ˆæŠ€æœ¯è¦ç†è§£ä¸šåŠ¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæŠ€æœ¯è¦ç†è§£ä¸šåŠ¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæŠ€æœ¯è¦ç†è§£ä¸šåŠ¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæŠ€æœ¯è¦ç†è§£ä¸šåŠ¡ï¼Ÿ</h3><h4 id="äº§å“éœ€æ±‚ä¸ç­‰äºä¸šåŠ¡è¯‰æ±‚"><a href="#äº§å“éœ€æ±‚ä¸ç­‰äºä¸šåŠ¡è¯‰æ±‚" class="headerlink" title="äº§å“éœ€æ±‚ä¸ç­‰äºä¸šåŠ¡è¯‰æ±‚"></a>äº§å“éœ€æ±‚ä¸ç­‰äºä¸šåŠ¡è¯‰æ±‚</h4><p>åŒæ ·çš„ï¼ŒæŠ€æœ¯ Leader å¯èƒ½ä¼šèŠ±æ—¶é—´å‚åŠ å„ç§ä¼šè®®ï¼Œå°¤å…¶æ˜¯äº§å“éœ€æ±‚çš„ä¼šï¼Œåœ¨ä¼šä¸Šå¦‚æœä»…ä»…æ˜¯å¬â€œè‡ªå·±å›¢é˜Ÿåº”è¯¥åšä»€ä¹ˆâ€ï¼Œè€Œæ²¡æœ‰æ€è€ƒå’Œæ¢ç©¶ä¸šåŠ¡çš„æ ¹æœ¬è¯‰æ±‚ï¼Œé‚£ä¹ˆå°±æˆ‘çš„ç»éªŒæ¥è¯´ï¼ŒæŠ€æœ¯å›¢é˜Ÿä¸å¯é¿å…çš„ä¼šæˆä¸ºå·¥å…·äººã€‚Leader ç¼ºä¹ç‹¬ç«‹æ€è€ƒï¼Œäººäº‘äº¦äº‘ï¼Œæœ€åæ•´ä¸ªå›¢é˜Ÿéƒ½ä¼šè¢«æ‹–ç´¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°ç ”å‘å›¢é˜Ÿè¢«äº§å“ä»¥åŠä¸šåŠ¡æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦çš„åŸå› ï¼</p><h4 id="é¢†åŸŸå»ºæ¨¡çš„å‰ææ˜¯ç†è§£ä¸šåŠ¡"><a href="#é¢†åŸŸå»ºæ¨¡çš„å‰ææ˜¯ç†è§£ä¸šåŠ¡" class="headerlink" title="é¢†åŸŸå»ºæ¨¡çš„å‰ææ˜¯ç†è§£ä¸šåŠ¡"></a>é¢†åŸŸå»ºæ¨¡çš„å‰ææ˜¯ç†è§£ä¸šåŠ¡</h4><p>æ­£å› ä¸ºæ²¡æœ‰ä»”ç»†çœ‹ä¸šåŠ¡çš„ç°çŠ¶ã€æ¨æµ‹ä¸šåŠ¡çš„å‘å±•ã€å»æ€è€ƒä¸šåŠ¡ä¸Šå¯¹äº¤æ˜“çš„è¯‰æ±‚ï¼Œæˆ‘ä»¬è®¤è¯†çš„åªæ˜¯ä¸€ä¸ªä¸ªéœ€æ±‚ï¼Œè€Œéæ•´ä½“çš„ä»ä¸šåŠ¡ç»´åº¦æ€è€ƒç³»ç»Ÿçš„è®¾è®¡ï¼Œå¯¼è‡´ç³»ç»Ÿå¤æ‚åº¦è¶Šæ¥è¶Šé«˜ã€‚æ‰€ä»¥è¦æƒ³è®¾è®¡å¯é ã€ç®€å•ã€çœŸæ­£å¯æŒç»­è¿­ä»£çš„ç³»ç»Ÿï¼Œæ·±åº¦ç†è§£ä¸šåŠ¡å°±æ˜¯å‰æï¼Œä½ å¯¹ä¸šåŠ¡çš„ç†è§£ç¨‹åº¦å½±å“äº†ä½ å¯¹ç³»ç»Ÿæœªæ¥å‘å±•çš„é¢„åˆ¤ç¨‹åº¦ã€‚</p><h4 id="æå‡æŠ€æœ¯å›¢é˜Ÿçš„ä½¿å‘½æ„Ÿ"><a href="#æå‡æŠ€æœ¯å›¢é˜Ÿçš„ä½¿å‘½æ„Ÿ" class="headerlink" title="æå‡æŠ€æœ¯å›¢é˜Ÿçš„ä½¿å‘½æ„Ÿ"></a>æå‡æŠ€æœ¯å›¢é˜Ÿçš„ä½¿å‘½æ„Ÿ</h4><p>ä½ å†™çš„æ¯ä¸€è¡Œä»£ç ï¼Œçº¿ä¸Šçš„æ¯ä¸€æ¬¡å‘å¸ƒï¼Œéƒ½ä¼šæ”¹å˜ç”¨æˆ·çš„ä½“éªŒï¼Œè§£å†³å®é™…çš„é—®é¢˜ï¼Œä½ å°±ä¼šå‘ç°è¿™ä»½å·¥ä½œçš„æ„ä¹‰ã€‚</p><h3 id="å¦‚ä½•ç†è§£ä¸šåŠ¡ï¼Ÿ"><a href="#å¦‚ä½•ç†è§£ä¸šåŠ¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç†è§£ä¸šåŠ¡ï¼Ÿ"></a>å¦‚ä½•ç†è§£ä¸šåŠ¡ï¼Ÿ</h3><ol><li>ä¸è¦ç›²ä¿¡äº§å“ï¼ˆä¸è¦ç›²ä¿¡äº§å“ä¸ PRDï¼Œåœ¨è®¨è®º PRD å’Œæ‰§è¡Œå¼€å‘ä»»åŠ¡ä¹‹å‰å­¦ä¼šç‹¬ç«‹æ€è€ƒï¼Œæ·±å…¥ç†è§£ä¸šåŠ¡æƒ³è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œéœ€è¦ä»€ä¹ˆæ•ˆæœæˆ–ä½œç”¨ï¼Œä¸¥æ ¼æŠŠæ§é‚£äº›ä¼ªéœ€æ±‚å’Œæ— ä»·å€¼éœ€æ±‚ï¼Œé˜²æ­¢å®ƒä»¬ä¾µå å›¢é˜Ÿçš„æŠ€æœ¯èµ„æºã€‚ï¼‰</li><li>å»ºç«‹èµ°è¿›ä¸šåŠ¡çš„æœºåˆ¶</li><li>ä¸šåŠ¡ä¸Šå¤šå‚ä¼šå¤šç”»å›¾ï¼ˆå‚åŠ è¯„å®¡ä¼šï¼Œæ¢³ç†æµç¨‹å›¾ç­‰ç­‰ï¼‰</li></ol><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/Cgp9HWAfsGSAa_gIAAKhlQeDXYs745.png" alt="ç†è§£ä¸šåŠ¡"></p><h2 id="æ¶æ„è®¾è®¡ï¼šæ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®"><a href="#æ¶æ„è®¾è®¡ï¼šæ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®" class="headerlink" title="æ¶æ„è®¾è®¡ï¼šæ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®"></a>æ¶æ„è®¾è®¡ï¼šæ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®</h2><h3 id="æ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®"><a href="#æ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®" class="headerlink" title="æ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®"></a>æ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®</h3><p>C.A.R. Hoareæ›¾è¯´è¿‡ï¼šâ€œè½¯ä»¶è®¾è®¡æœ‰ä¸¤ç§é£æ ¼ï¼Œä¸€ç§æ˜¯å°†è½¯ä»¶è®¾è®¡å¾—å¾ˆå¤æ‚ï¼Œä»¥ä½¿å…¶ç¼ºé™·æ²¡é‚£ä¹ˆæ˜æ˜¾ï¼›ä¸€ç§æ˜¯æŠŠè½¯ä»¶è®¾è®¡å¾—å¾ˆç®€å•ï¼Œä»¥ä½¿å…¶æ²¡æœ‰æ˜æ˜¾çš„ç¼ºé™·â€ã€‚</p><p>ç³»ç»Ÿçš„ç»“æ„æ¸…æ™°ã€å³ä½¿æ•´ä½“ç¹æ‚ä½†æ˜¯æ¯ä¸ªå±€éƒ¨éƒ½ç›¸å¯¹ç®€å•ã€é“¾è·¯å¹²è„†ç›´æ¥ï¼Œæ²¡æœ‰ä¸å¿…è¦çš„å†—ä½™ã€‚</p><h3 id="è¡¡é‡å¤æ‚åº¦"><a href="#è¡¡é‡å¤æ‚åº¦" class="headerlink" title="è¡¡é‡å¤æ‚åº¦"></a>è¡¡é‡å¤æ‚åº¦</h3><ul><li><p>ç†è§£æˆæœ¬é«˜ï¼šéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½ç†è§£ç³»ç»Ÿæ¨¡å—çš„ç»„æˆåŠè¿ä½œï¼Œæ¯”å¦‚æ–°åŒå­¦åŠ å…¥æˆ–ç³»ç»Ÿäº¤æ¥æ—¶ï¼Œè€åŒå­¦å¾ˆéš¾è®²å®Œæ•´ã€æ–°åŒå­¦ä¸å®¹æ˜“å¬æ˜ç™½ï¼Œè¦å‡ å‘¨ç”šè‡³1~2ä¸ªæœˆæ‰èƒ½å®Œå…¨äº†è§£ç³»ç»Ÿçš„å®ç°å’Œè¿ä½œæœºç†ã€‚</p></li><li><p>å˜æ›´ç‰µè¿å¤šï¼šå“ªæ€•æ˜¯å®ç°ä¸€ä¸ªå°çš„éœ€æ±‚éƒ½è¦æ”¹é€ ç³»ç»Ÿçš„å¤šä¸ªéƒ¨åˆ†ã€ç”šè‡³å¤šä¸ªç³»ç»Ÿï¼ˆä¸Šä¸‹æ¸¸ç­‰ï¼‰ï¼Œæœ‰çš„è¿˜éœ€è¦åè°ƒå…¶ä»–å›¢é˜Ÿæˆ–éƒ¨é—¨ï¼Œç»“æœå¯¼è‡´è¿­ä»£æˆæœ¬é«˜ï¼Œå¹¶å¯èƒ½å¼•å…¥æ›´é«˜çš„é£é™©ã€‚</p></li><li><p>ä¸€å¼ å›¾è£…ä¸ä¸‹ï¼šå³ä½ æ— æ³•åœ¨ä¸€å—ç™½æ¿ä¸Šæ¸…æ™°ä¸”å®Œæ•´åœ°ç”»å‡ºç³»ç»Ÿä¸»è¦åŠŸèƒ½åœºæ™¯çš„æ¶æ„å›¾ï¼Œå¯èƒ½æ˜¯ç‰µè¿çš„ç³»ç»Ÿã€æœåŠ¡ã€ç»„ä»¶è¿‡å¤šæˆ–è€…é“¾è·¯è®¾è®¡ä¸åˆç†å¯¼è‡´çš„ã€‚</p></li><li><p>åŠ äººæ— æ³•è§£å†³é—®é¢˜ï¼šå³ä¾¿ä½ å¢åŠ äººå‘˜ä¹Ÿéš¾æé«˜ç³»ç»Ÿçš„äº¤ä»˜é€Ÿåº¦å’Œäº§å‡ºè´¨é‡ï¼Œæ¯”å¦‚åŸæœ¬3ä¸ªäººè´Ÿè´£ç³»ç»Ÿï¼Œå¢åŠ åˆ° 6 ä¸ªäººçš„äº¤ä»˜äº§å‡ºå¯èƒ½å’Œ 3 ä¸ªäººæ—¶æ‰€å·®æ— å‡ ï¼ŒåŸå› åœ¨äºå¤æ‚åº¦è¿‡é«˜å¹¶ä¸”ç³»ç»Ÿç»“æ„æ¨¡ç³Šï¼Œå¾ˆéš¾é€šè¿‡æ¸…æ™°çš„åˆ†å·¥è®©ç”Ÿäº§åŠ›æœ€å¤§åŒ–ã€‚</p></li></ul><p>è€Œä½ å¯ä»¥ç»“åˆè¿™ 4 ç‚¹è¡¨ç°ç‰¹å¾ä»¥åŠè‡ªå·±çš„ä¸»è§‚æ„Ÿå—è¿›ä¸€æ­¥åˆ¤æ–­ç³»ç»Ÿçš„å¤æ‚åº¦æ˜¯å¦è¿‡é«˜ï¼Œå¦‚æœç³»ç»Ÿå¤æ‚åº¦è¿‡é«˜ï¼Œå¯èƒ½å¸¦æ¥ä¸€ç³»åˆ—é—®é¢˜ï¼šè¿­ä»£å‹åŠ›å¤§ã€ç»å¸¸å»¶æœŸã€ç¨³å®šæ€§é—®é¢˜é¢‘å‘ç­‰ã€‚è¿™æ—¶ï¼Œä½ è¦ç€æ‰‹æ²»ç†å¤æ‚åº¦ï¼Œå°½åŠ›ä¸è®©é—®é¢˜æ‰©å¤§åˆ°éš¾ä»¥è§£å†³åªèƒ½é‡åšç³»ç»Ÿçš„ç¨‹åº¦ã€‚</p><h3 id="å¤æ‚åº¦æ²»ç†çš„æ€è·¯"><a href="#å¤æ‚åº¦æ²»ç†çš„æ€è·¯" class="headerlink" title="å¤æ‚åº¦æ²»ç†çš„æ€è·¯"></a>å¤æ‚åº¦æ²»ç†çš„æ€è·¯</h3><p>â€œé«˜å†…èšã€ä½è€¦åˆâ€ï¼Œç³»ç»Ÿç®€åŒ–å’Œåˆ†æ²»ã€‚</p><p>ç®€åŒ–å°±æ˜¯å»æ‰ä¸å¿…è¦çš„å¤æ‚ï¼Œè®©è®¾è®¡ä¸å®ç°ä¿æŒç®€å•ã€‚</p><p>åˆ†æ²»åˆ™æ˜¯å°†åŸæœ¬éš¾è§£å†³çš„é—®é¢˜ï¼Œæ‹†åˆ†åˆ°å¯è§£å†³çš„ç²’åº¦ï¼Œç„¶åå†é€ä¸€å‡»ç ´ã€‚</p><p>å¸¸è§çš„æ‹†åˆ†æ–¹å¼æ˜¯å‚ç›´æ‹†åˆ†å’Œæ°´å¹³åˆ†å±‚ï¼š å‚ç›´æ‹†åˆ†æŠŠå·®å¼‚æ˜ç¡®å¯ä»¥ç‹¬ç«‹è¿­ä»£çš„ä¸šåŠ¡æ‹†åˆ†å¼€ï¼›æ°´å¹³åˆ†å±‚æŠŠå…±æ€§çš„èƒ½åŠ›ä¸‹æ²‰éš”ç¦»ã€‚æ¯”å¦‚ç”µå•†åœºæ™¯ä¸­ï¼Œè´­ç‰©è½¦å’Œè®¢å•å¯ä»¥åˆ†æˆä¸¤ä¸ªæœåŠ¡ï¼Œå®ƒä»¬è™½ç„¶åœ¨ä¸šåŠ¡æµç¨‹ä¸Šå‰åå…³è”ï¼Œä½†æ˜¯å„è‡ªå…·å¤‡ç‹¬ç«‹å®Œæ•´çš„ä¸šåŠ¡åœºæ™¯å’Œç”Ÿå‘½å‘¨æœŸï¼Œå•†å“åŠ å…¥è´­ç‰©è½¦æœªå¿…ä¼šäº¤æ˜“ç”Ÿæˆè®¢å•ï¼Œå¯ä»¥å„è‡ªç‹¬ç«‹å­˜åœ¨ï¼›è€Œåº“å­˜å’Œå•†å“åˆ™æ˜¯å¼ºä¾èµ–çš„å…³ç³»ï¼Œåº“å­˜æ— æ³•ç‹¬ç«‹äºå•†å“å­˜åœ¨ã€‚</p><p>æ‹†åˆ†ä¸åˆå¹¶ä¸ç»å¯¹ï¼Œè¿‡åº¦åœ°æ‹†åˆ†ä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•é«˜å†…èšï¼Œé›¶æ•£åˆ†ç¦»çš„ç³»ç»Ÿï¼Œä¼šå¢åŠ ç¨³å®šæ€§é£é™©å’Œæ²»ç†ä¸è¿­ä»£çš„ä»£ä»·ï¼Œå¹¶ä¸”é€ æˆå¤§é‡çš„åä½œæˆæœ¬ã€‚Linusä¹Ÿæ›¾è¯´è¿‡ï¼šæŠŠå¤æ‚ç³»ç»Ÿæ‹†åˆ†æˆæ¨¡å—ï¼Œä¼¼ä¹æ²¡æœ‰é™ä½æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œå®ƒé™ä½çš„åªæ˜¯å­ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚è€Œæ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œåè€Œä¼šç”±äºæ‹†åˆ†åçš„æ¨¡å—ä¹‹é—´ï¼Œä¸å¾—ä¸è¿›è¡Œäº¤äº’ï¼Œå˜å¾—æ›´åŠ å¤æ‚ã€‚</p><h3 id="å¤æ‚åº¦æ²»ç†å®è·µ"><a href="#å¤æ‚åº¦æ²»ç†å®è·µ" class="headerlink" title="å¤æ‚åº¦æ²»ç†å®è·µ"></a>å¤æ‚åº¦æ²»ç†å®è·µ</h3><ol><li>ç›¸æ¯” coding æ›´é‡è§†è®¾è®¡</li><li>æ°¸è¿œåš 2 å¥—ä»¥ä¸Šçš„æ–¹æ¡ˆ</li><li>ä» MVP çš„è§†è§’è€ƒè™‘è®¾è®¡ï¼šä» MVP ï¼ˆæœ€å°å®Œæ•´ä¸šåŠ¡çš„è§’åº¦ï¼‰å»è€ƒè™‘ç³»ç»Ÿè¦å¦‚ä½•è®¾è®¡ä¸å®ç°ï¼Œå…ˆåšå‡æ³•å†åšåŠ æ³•</li><li>å…³æ³¨ä¸Šä¸‹æ¸¸çš„å®ç°</li><li>åšæŒâ€œæ—¥æ‹±ä¸€å’</li></ol><h3 id="æ²¡å¿…è¦ä¸€å®šæŠŠç³»ç»Ÿåšæˆä¸­å°"><a href="#æ²¡å¿…è¦ä¸€å®šæŠŠç³»ç»Ÿåšæˆä¸­å°" class="headerlink" title="æ²¡å¿…è¦ä¸€å®šæŠŠç³»ç»Ÿåšæˆä¸­å°"></a>æ²¡å¿…è¦ä¸€å®šæŠŠç³»ç»Ÿåšæˆä¸­å°</h3><p>æ²¡å¿…è¦ä¸€å®šæŠŠç³»ç»Ÿåšæˆä¸­å°ï¼Œä¸åšä¸­å°å°±ä¼šè½åæ›´æ˜¯æ— ç¨½ä¹‹è°ˆï¼Œä¸è¿‡ï¼Œä½ å¯ä»¥å€Ÿé‰´ä¸­å°çš„æ€è·¯ä½œä¸ºç³»ç»Ÿè®¾è®¡ä¸æ¼”è¿›ä¸Šçš„å½¢æ€å‚è€ƒã€‚</p><p><img src="/images/%E6%8A%80%E6%9C%AF%E4%BA%BA%E4%B8%89%E8%A6%81%E7%B4%A0/CioPOWAlYm-AU3RIAAIkbegMocs361.png" alt="å¤æ‚åº¦"></p><hr><p class="note note-success"> ç®¡ç†ä¸‰æ¿æ–§ï¼šæ‹¿ç»“æœã€å»ºå›¢é˜Ÿã€æ‹›è˜ä¸è§£è˜</p><h1 id="å®šç›®æ ‡ï¼šè®©ä½ çš„æ–¹å‘ä¸å…¬å¸çš„æ–¹å‘ä¿æŒä¸€è‡´"><a href="#å®šç›®æ ‡ï¼šè®©ä½ çš„æ–¹å‘ä¸å…¬å¸çš„æ–¹å‘ä¿æŒä¸€è‡´" class="headerlink" title="å®šç›®æ ‡ï¼šè®©ä½ çš„æ–¹å‘ä¸å…¬å¸çš„æ–¹å‘ä¿æŒä¸€è‡´"></a>å®šç›®æ ‡ï¼šè®©ä½ çš„æ–¹å‘ä¸å…¬å¸çš„æ–¹å‘ä¿æŒä¸€è‡´</h1><h2 id="æ€ä¹ˆè§£è¯»ç›®æ ‡ï¼Ÿ"><a href="#æ€ä¹ˆè§£è¯»ç›®æ ‡ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè§£è¯»ç›®æ ‡ï¼Ÿ"></a>æ€ä¹ˆè§£è¯»ç›®æ ‡ï¼Ÿ</h2><p>è§£è¯»ç›®æ ‡å°±æ˜¯è¦ç¡®ä¿è‡ªå·±åšçš„äº‹å„¿å’Œå…¬å¸çš„æ–¹å‘ä¸€è‡´ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œæ²¡æœ‰èµ°åï¼ˆè¿™é‡Œçš„â€œåŠ¿â€å°±æ˜¯å…¬å¸çš„æˆ˜ç•¥å’Œç›®æ ‡ï¼‰ï¼Œæ­£å› ä¸ºæœ‰äº†ç›®æ ‡æ‰æœ‰æ ¹æ®ç›®æ ‡åˆ¶å®šçš„ KPIï¼Œæ‰ä¼šæœ‰å›´ç»•ç›®æ ‡çš„æ‰§è¡ŒåŠ¨ä½œå’Œæœ€ç»ˆå–å¾—çš„ç»“æœã€‚</p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/CioPOWAqh56AQalmAAE6asGZIRs826.png"></p><p>ç›®æ ‡ä¸æ˜¯ä¸€å¥å£å·ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸ªå±‚å±‚æ‹†è§£ã€é€’è¿›çš„è¿‡ç¨‹ã€‚è¯´ç™½äº†ï¼Œè§£è¯»ç›®æ ‡æ˜¯æŠŠå…¬å¸çš„æ–¹å‘å˜æˆä½ çš„æ–¹å‘ï¼ŒæŠŠä¸Šä¸€å±‚çš„é—®é¢˜è½¬å˜æˆä½ å¯ä»¥æ”¹å˜çš„é—®é¢˜ã€‚</p><p>ç¡®ä¿ç›®æ ‡è§£è¯»æ­£ç¡®æœ‰å¾ˆå¤šæŠ€å·§å’Œæ–¹æ³•ã€‚æ ¹æ®ç›®æ ‡é€å±‚åˆ†è§£çš„ç‰¹æ€§ï¼Œå¯ä»¥è€ƒè™‘å››ä¸ªæ–¹é¢ã€‚</p><ul><li><p>ä½ çš„ä¸»ç®¡ï¼Œç¡®å®šä½ è€æ¿çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼›</p></li><li><p>ä½ è‡ªèº«æ‰€åœ¨çš„å›¢é˜Ÿã€å›¢é˜Ÿçš„æˆå‘˜ä»¬ï¼Œæ ¹æ®å›¢é˜Ÿæƒ…å†µç¡®å®šç°çŠ¶ï¼›</p></li><li><p>ä¸ä½ ç´§å¯†åˆä½œçš„ä¸Šä¸‹æ¸¸ï¼ˆç ”å‘ï¼‰ï¼Œæ¯”å¦‚ä½ æ˜¯åšè®¢å•ç³»ç»Ÿçš„ï¼Œé‚£ä¹ˆæ”¯æŒå±æ€§å¾ˆé‡ï¼Œå•†æˆ·ã€å¯¼è´­ã€ç”¨æˆ·å¾ˆå¤šç ”å‘å›¢é˜Ÿéƒ½æ˜¯ä½ çš„ä¸Šä¸‹æ¸¸å…³è”æ–¹ï¼›</p></li><li><p>ç›´æ¥å¯¹å£çš„ä¸šåŠ¡ä¸äº§å“ï¼Œè¿™æ˜¯ä¸šåŠ¡ç›®æ ‡æ‹†è§£ã€ä¸šåŠ¡ç—›ç‚¹ã€å®¢æˆ·è¯‰æ±‚çš„ç›´æ¥æ¥æºæ–¹ã€‚</p></li></ul><h2 id="æ€ä¹ˆåˆ¶å®šç›®æ ‡ï¼Ÿ"><a href="#æ€ä¹ˆåˆ¶å®šç›®æ ‡ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåˆ¶å®šç›®æ ‡ï¼Ÿ"></a>æ€ä¹ˆåˆ¶å®šç›®æ ‡ï¼Ÿ</h2><p>ç»“åˆ 4 ä¸ªå…³é”®ç‚¹æ¥è€ƒè™‘ï¼š</p><ol><li>â€œçŸ­é•¿â€ç»“åˆï¼šäº‹æƒ…åˆ†è½»é‡ç¼“æ€¥ï¼Œä½ ä¸€ç›´ç›¯ç€â€œæ€¥â€å’Œâ€œé‡â€ï¼Œâ€œè½»â€å’Œâ€œç¼“â€çš„äº‹æƒ…å°±ä¼šè½¬å˜æˆâ€œé‡â€å’Œâ€œæ€¥â€ï¼Œè¿›å…¥æ­»å¾ªç¯ã€‚</li><li>è¦è¶³å¤Ÿèšç„¦ï¼šå»ºè®®å…³é”®ç›®æ ‡ä¸è¦è¶…è¿‡ 3 ä¸ªï¼Œæœ€å¤šæ§åˆ¶åœ¨ 5 ä¸ªä»¥å†…ï¼Œè¦æ‰¾æœ€æœ‰å®¢æˆ·ä»·å€¼ã€å¯¹å…¬å¸æˆ˜ç•¥æœ€æœ‰å¸®åŠ©çš„ç‚¹ï¼Œç›®æ ‡è¶Šå°‘ã€æ–¹å‘è¶Šæ¸…æ™°ï¼Œå½“é—®é¢˜å‘ç”Ÿæˆ–è€…éœ€è¦åˆ¤æ–­æ—¶è¶Šå®¹æ˜“åšå†³ç­–ï¼Œåœ¨æœ‰é™çš„æ—¶é—´å†…åšå‡ºæ›´å¥½çš„ç»“æœã€‚</li><li>è¦æœ‰è¶³å¤Ÿçš„æŒ‘æˆ˜ï¼šç³»ç»Ÿå¯ç”¨æ€§å‡å¦‚å»å¹´æ˜¯ 3 ä¸ª 9ï¼Œä»Šå¹´è€ƒè™‘ä¸šåŠ¡ä¼šå‘å±•ä¿å®ˆèµ·è§è¿˜æ˜¯åŠ›ä¿ 3 ä¸ª 9ï¼Œè¿™æ ·çš„ç›®æ ‡æŒ‘æˆ˜æ€§å°±ä¸è¶³ï¼Œä¹Ÿæ— æ³•ä½“ç°æŠ€æœ¯çš„ä»·å€¼ã€‚è¿™ä¸ªåº¦é‡æ˜¯å¾ˆè€ƒéªŒä½ çš„ã€‚</li><li>è¦è®©ç»„ç»‡æœ‰æ²‰æ·€ã€ä¸ªäººæœ‰æˆé•¿ï¼šé€šè¿‡ä¸€ä¸ªä¸ªç›®æ ‡çš„å®Œæˆï¼Œè®©å‚ä¸çš„åŒå­¦å¾—åˆ°ä¸ªäººèƒ½åŠ›çš„æå‡ï¼Œæœªæ¥å¯ä»¥æ‰¿æ‹…æ›´å¤§çš„èŒè´£ï¼Œç»„ç»‡ä¹Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹åšèƒ½åŠ›çš„ç§¯ç´¯ä¸æ²‰æ·€ã€‚</li></ol><p>ç»“åˆä»¥ä¸Šå››ç‚¹ï¼Œå›´ç»•ç›®æ ‡å’Œå›¢é˜Ÿä¸€èµ·è®¨è®ºç­–ç•¥ä¸æ‰“æ³•ï¼Œå°†ç›®æ ‡æ‹†è§£æˆå‡ ä¸ªå…³é”®ä»»åŠ¡ï¼Œæ˜ç¡®åˆ°è´£ä»»äººï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šå®šç­–ç•¥ã€æ‹†ä»»åŠ¡ã€ç»†åˆ°äººã€‚</p><h2 id="æ€ä¹ˆä¼ é€’ç›®æ ‡ï¼Ÿ"><a href="#æ€ä¹ˆä¼ é€’ç›®æ ‡ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä¼ é€’ç›®æ ‡ï¼Ÿ"></a>æ€ä¹ˆä¼ é€’ç›®æ ‡ï¼Ÿ</h2><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ ä¼šå‘ç°ä¿¡æ¯ä¸å¯¹ç­‰ã€ä¼ é€’è¿‡ç¨‹ä¸­çš„æŸå¤±ã€ä¸ªäººç†è§£çš„å·®å¼‚ï¼Œç›´æ¥å¯¼è‡´ä¸æ˜¯æ‰€æœ‰äººéƒ½æ¸…æ¥šâ€œæˆ‘ä»¬è¦å¾€å“ªå»â€ã€‚</p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/CioPOWAqh9iAfN3jAAE8QXqq33w549.png"></p><p>æœ€åï¼Œç›®æ ‡çš„ä¼ é€’æ˜¯ä¸€ä¸ªè¿è´¯çš„åŠ¨ä½œï¼Œè¦è½åˆ°æ—¥å¸¸çš„ç®¡ç†åŠ¨ä½œã€é‡ç‚¹é¡¹ç›®ä¸ä»»åŠ¡ã€KPI çš„è¿‡ç¨‹ç®¡ç†è¿™äº›å¹³æ—¥çš„ç‚¹æ»´ä¸­ã€‚ç›®æ ‡è¦åå¤è®²ï¼Œè¦ç»å¸¸å¯¹ç„¦ï¼Œé‡è¦çš„äº‹å„¿ï¼Œ3 éæ˜¯ä¸å¤Ÿçš„ï¼Œè¦è¯´â€œ300 éï¼â€ã€‚</p><p>æ‰€è°“çš„æ–¹å‘ä¸ç›®æ ‡å°±æ˜¯ï¼šä½ è¦å¾€å“ªå»ï¼Œä½ è¦èµ°å¤šè¿œï¼Œä½ è¦èµ°åˆ°å“ªã€‚æ¸…æ™°çš„ç›®æ ‡å°±å¥½æ¯”æ²™æ¼ ä¸­çš„æŒ‡å—é’ˆï¼Œè®©ä½ èƒ½æ¯”å…¶ä»–äººæ›´å¿«æ‰¾åˆ°æ°´æºå¹¶ç”Ÿå­˜ä¸‹å»ï¼Œä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘æé†’ä½ æ³¨æ„è¿™æ ·å‡ ç‚¹ï¼š</p><ul><li>è§£è¯»ç›®æ ‡éå¸¸é‡è¦ï¼Œåˆ‡å‹¿é™·å…¥æç«¯ï¼Œè¦ä¹ˆä¸è§£è¯»ï¼Œè¦ä¹ˆé¢†å¯¼è¯´ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆã€‚</li><li>åˆ¶å®šç›®æ ‡ä¸€å®šè¦å¤Ÿèšç„¦ï¼Œä½†åˆ‡å‹¿åªè€ƒè™‘çœ¼å‰ï¼Œæ³¨æ„â€œé•¿çŸ­ç»“åˆâ€ã€‚</li><li>æ³¨æ„ç›®æ ‡ä¼ é€’ï¼Œè¦å……åˆ†è€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„æ„Ÿå—ï¼Œé€‰å–åˆé€‚çš„æ–¹å¼ã€‚</li></ul><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/Cgp9HWAqh-mAAqQvAAHkRyUTqL0533.png" alt="å®šç›®æ ‡"></p><h2 id="è¿½è¿‡ç¨‹ï¼šå¦‚ä½•ç”¨-PDCA-åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ"><a href="#è¿½è¿‡ç¨‹ï¼šå¦‚ä½•ç”¨-PDCA-åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ" class="headerlink" title="è¿½è¿‡ç¨‹ï¼šå¦‚ä½•ç”¨ PDCA åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ"></a>è¿½è¿‡ç¨‹ï¼šå¦‚ä½•ç”¨ PDCA åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ</h2><p>åªæœ‰æŒæ¡è¿‡ç¨‹ç®¡ç†çš„æ–¹æ³•ï¼Œæ‰ä¼šå°½å¯èƒ½å‡å°‘äº‹åŠ¡å¾€ä¸å¥½æ–¹å‘å‘å±•çš„æ³¢åŠ¨ï¼Œä»è€Œæ›´è½»æ¾ã€æ›´ä½é£é™©ã€æ›´ç¨³å¦¥åœ°å»æ‹¿åˆ°ç»“æœï¼Œè®©ä¸€åˆ‡å°½åœ¨æŒæ§ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯è¿‡ç¨‹ç®¡ç†ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è¿‡ç¨‹ç®¡ç†ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿‡ç¨‹ç®¡ç†ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è¿‡ç¨‹ç®¡ç†ï¼Ÿ</h3><p>ç®¡ç†å°±æ˜¯è¿½æ±‚äº‹åŠ¡çš„å¯æŒç»­å‘å±•ï¼Œè€Œæƒ³è¦è¾¾æˆè¿™ä¸ªç›®æ ‡æœ‰ä¸¤ä¸ªåŸºæœ¬ç‚¹ï¼š</p><ul><li><p>ç®¡ç†åŠ¨ä½œè¦å½¢æˆå¯æŒç»­è¿­ä»£çš„é—­ç¯ï¼›</p></li><li><p>ç®¡ç†åŠ¨ä½œè¶³å¤Ÿç®€å•åˆ°å¯ä»¥å¤åˆ¶å’Œä¸ªæ€§åŒ–å‡çº§ã€‚</p></li></ul><p>è¿‡ç¨‹ç®¡ç†æ˜¯ä¸ºäº†è®©ä½ çš„æƒ³æ³•ã€çµæ„Ÿã€ä¸ç¨³å®šçš„å‘æŒ¥é€æ¸è§„å¾‹åŒ–ï¼Œå¯ä»¥æŒç»­è¿­ä»£è¢«ä½ åº”ç”¨ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯å¸Œæœ›ç»“æœè¶Šæ¥è¶Šå¥½ï¼Œè®©ä½ åŸæœ¬é è¿æ°”æˆ–è€…æ¨¡ç³Šç»éªŒå¾—æ¥çš„æˆåŠŸå¯ä»¥è¢«å¤åˆ¶ï¼Œè®©ä½ åœ¨é¡¹ç›®ä¸­çµå…‰ä¸€é—ªçš„ Idea å˜æˆä½ çš„å¸¸è§„èƒ½åŠ›ã€‚</p><h3 id="PDCA-æ¨¡å‹"><a href="#PDCA-æ¨¡å‹" class="headerlink" title="PDCA æ¨¡å‹"></a>PDCA æ¨¡å‹</h3><ul><li>Planï¼ˆå®šè®¡åˆ’ï¼‰ï¼šå›´ç»•ç€ç›®æ ‡æ˜ç¡®é‡Œç¨‹ç¢‘ï¼Œç¡®å®šå…³é”®èŠ‚ç‚¹ï¼Œä¸æ‰§è¡Œçš„å‘˜å·¥è¾¾æˆå…±è¯†ã€‚</li><li>Doï¼ˆåšæ‰§è¡Œï¼‰ï¼šå¤šç»™å‘˜å·¥ç©ºé—´ã€å¤šèµ°åŠ¨ã€å¤šè§‚å¯Ÿã€å°‘å¹²é¢„ï¼Œæ”¾æ‰‹è€Œéæ”¾ä»»ï¼Œä½ ä¹Ÿä¸èƒ½ç½®èº«äº‹å¤–ã€‚</li><li>Checkï¼ˆå‹¤æ£€æŸ¥ï¼‰ï¼šç‹ æŠ“å…³é”®èŠ‚ç‚¹åšæ£€æŸ¥ã€é—®è¿›å±•ã€é—®å›°éš¾ã€ç»™å»ºè®®ã€åšè¾…å¯¼ã€åè°ƒèµ„æºã€‚</li><li>Actionï¼ˆå¤ç›˜è°ƒä¼˜ï¼‰ï¼šå°äº‹å°½å¿«å¤ç›˜ã€å¤§äº‹åˆ†é˜¶æ®µå¤ç›˜ã€äº‹åå…¨é¢å¤ç›˜ï¼ŒæŠ“ä½æ¯ä¸€æ¬¡æå‡å’Œä¼˜åŒ–çš„æœºä¼šã€‚</li></ul><h3 id="å¦‚ä½•ç”¨-PDCA-åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ"><a href="#å¦‚ä½•ç”¨-PDCA-åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç”¨ PDCA åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ"></a>å¦‚ä½•ç”¨ PDCA åšè¿‡ç¨‹ç®¡ç†ï¼Ÿ</h3><p>å¾ˆå¤šèƒ½åŠ›å’Œç»éªŒæ˜¯å†ç»ƒå‡ºæ¥çš„ï¼Œåªè¦è¿‡ç¨‹å¯æ§ï¼Œè¿‡ç¨‹ä¸­èµ°ä¸€äº›å¼¯è·¯ä¹Ÿæœªå¿…æ˜¯åäº‹ï¼Œè¦å…è®¸çŠ¯é”™ã€‚ä½†æ˜¯ä½ è¦æ³¨æ„ï¼Œæ”¾æ‰‹ä¸ç­‰äºæ”¾ä»»ï¼Œæ›´ä¸ç­‰äºä¸é—»ä¸é—®ï¼Œä½ ä¾ç„¶è¦å¯¹æœ€ç»ˆçš„ç»“æœè´Ÿè´£ã€‚</p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/CioPOWAuOIWATM3RAAKl9h_7RCo041.png" alt="ä¼šè®®"></p><ul><li>å¤ç›˜å‰ï¼šå¤ç›˜å‰çš„æ ¸å¿ƒåœ¨äºæ€è€ƒå¤ç›˜çš„ç›®çš„å’Œäº§å‡ºæ˜¯ä»€ä¹ˆã€‚å€Ÿæ­¤ï¼Œä½ æ‰å¯ä»¥æ˜ç¡®å¤ç›˜ä¼šè®®ä¸»è¦ä¼šèŠäº›ä»€ä¹ˆï¼Œå“ªäº›äººä¼šå‚åŠ ã€‚</li><li>å¤ç›˜ä¸­ï¼šè‡ªçœæ˜¯å¤ç›˜ä¼šçš„åŸºè°ƒï¼Œå¤ç›˜å°±ä¸€ä¸ªç›®çš„â€œæ‰¾åˆ°å›¢é˜Ÿçš„ä¸è¶³åŠ ä»¥æ”¹è¿›ï¼Œä»¥ä¾¿åœ¨æœªæ¥å–å¾—æ›´å¥½çš„ç»“æœâ€ã€‚æ‰€ä»¥æ¯ä¸ªäººæ²¡å¿…è¦ç”©é”…ï¼Œä¹Ÿæ²¡å¿…è¦å…¨ç›˜å¦å®šã€‚åœ¨å¤ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦æŠŠé—®é¢˜æ‰¾å‡†ï¼Œå†…éƒ¨å¯¹é½ï¼Œè¾¾æˆæ‰€æœ‰äººçš„å…±è¯†ã€‚</li><li>å¤ç›˜åï¼šä¼šè®®æœ‰ç»“è®ºï¼Œç»“è®ºæœ‰è®¡åˆ’ï¼Œè®¡åˆ’æœ‰è´£ä»»äººï¼Œè´£ä»»äººæœ‰è¡ŒåŠ¨ï¼Œè¦å»ºç«‹æœºåˆ¶ä¿è¯åœ¨å¤ç›˜ä¼šä¸Šè®¨è®ºå‡ºçš„ç»“è®ºèƒ½å¤Ÿè½åœ°ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œå°äº‹å„¿å°½å¿«å¤ç›˜ï¼Œå€Ÿæ­¤å‘å›¢é˜Ÿæˆå‘˜ä¼ æˆè‡ªå·±çš„ç»éªŒï¼›å¤§äº‹å„¿åˆ†é˜¶æ®µå¤ç›˜ï¼ŒæŠ“ä½é‡ç‚¹çŸ›ç›¾ï¼Œæ¨åŠ¨äº‹æƒ…çš„é¡ºåˆ©å‘å±•è€Œéè¿½æ±‚å®Œç¾ï¼›äº‹åå…¨é¢å¤ç›˜ï¼Œä¸ç®¡å¯¹ä¸ªäººè¿˜æ˜¯å›¢é˜Ÿï¼Œæ‰¾è‡ªå·±çš„é—®é¢˜éƒ½æ˜¯ ROI æœ€é«˜çš„æ–¹å¼ï¼Œæ‰¾åˆ°é—®é¢˜çš„ä¸€æ–¹æ‰æœ‰æ”¹å–„æå‡çš„å¯èƒ½ã€‚</p><h3 id="ä¸‰ä¸ªé‡ç‚¹ï¼š"><a href="#ä¸‰ä¸ªé‡ç‚¹ï¼š" class="headerlink" title="ä¸‰ä¸ªé‡ç‚¹ï¼š"></a>ä¸‰ä¸ªé‡ç‚¹ï¼š</h3><ol><li>ç›®æ ‡ä¸ä¼šè‡ªå·±é•¿è…¿èµ°å‘ç»ˆç‚¹ï¼Œä½ ä¸€å®šè¦åšå¥½è¿‡ç¨‹ç®¡ç†ä»¥å–å¾—å¯é çš„ç»“æœã€‚</li><li>è¿½è¿‡ç¨‹ä¸æ„å‘³ç€äº‹æ— å·¨ç»†éƒ½è¦åšï¼Œè¿½å“ªäº›ã€ä»€ä¹ˆæ—¶å€™è¿½ã€è¿½åˆ°ä»€ä¹ˆç¨‹åº¦æ‰æ˜¯ä½ æ›´åº”è¯¥å…³å¿ƒçš„ã€‚</li><li>å¤ç›˜æ˜¯ PDCA ç®¡ç†åŠ¨ä½œä¸­çš„é—­ç¯ï¼Œå¦‚æœæ¯æ¬¡éƒ½èƒ½æé«˜ä¸€ç‚¹ç‚¹ï¼Œé•¿æœŸç§¯ç´¯çš„å˜åŒ–å°±å¾ˆå¤§äº†ã€‚</li></ol><hr><h2 id="å¥–ä¼˜ç½šåŠ£ï¼šæ€æ ·ä¼ é€’æˆ‘ä»¬â€è¦ä»€ä¹ˆâ€ä¸â€œä¸è¦ä»€ä¹ˆâ€ï¼Ÿ"><a href="#å¥–ä¼˜ç½šåŠ£ï¼šæ€æ ·ä¼ é€’æˆ‘ä»¬â€è¦ä»€ä¹ˆâ€ä¸â€œä¸è¦ä»€ä¹ˆâ€ï¼Ÿ" class="headerlink" title="å¥–ä¼˜ç½šåŠ£ï¼šæ€æ ·ä¼ é€’æˆ‘ä»¬â€è¦ä»€ä¹ˆâ€ä¸â€œä¸è¦ä»€ä¹ˆâ€ï¼Ÿ"></a>å¥–ä¼˜ç½šåŠ£ï¼šæ€æ ·ä¼ é€’æˆ‘ä»¬â€è¦ä»€ä¹ˆâ€ä¸â€œä¸è¦ä»€ä¹ˆâ€ï¼Ÿ</h2><p>â€œå¥–ä¼˜ç½šåŠ£â€ä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½è®©å›¢é˜Ÿå½¢æˆå¯æŒç»­å‘å±•çš„æ°›å›´ï¼Œæ˜¯æ‹¿ç»“æœçš„é—­ç¯ã€‚è€Œæˆ‘ä»¬åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¦æ³¨æ„çš„å°±æ˜¯ï¼šå¼•å¯¼äººæ€§è€Œéå¯¹æŠ—äººæ€§ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯å¥–ä¼˜ã€ç½šåŠ£"><a href="#ä»€ä¹ˆæ˜¯å¥–ä¼˜ã€ç½šåŠ£" class="headerlink" title="ä»€ä¹ˆæ˜¯å¥–ä¼˜ã€ç½šåŠ£"></a>ä»€ä¹ˆæ˜¯å¥–ä¼˜ã€ç½šåŠ£</h3><p>å¥–ä¼˜æœ€ç»ˆä¼šè½åˆ°ç‰©è´¨å’Œç²¾ç¥ä¸Šï¼š</p><ul><li><p>ç‰©è´¨ä¸Šçš„å¥–ä¼˜ä½œç”¨å¤§ï¼Œä½†æ˜¯é¢‘æ¬¡è¾ƒä½ï¼Œæ¯”å¦‚ä»¥åŠå¹´/å¹´ä¸ºå•ä½çš„æ™‹å‡ã€è°ƒè–ªï¼Œå®ƒèƒ½å¤Ÿæ‰“å¼€æˆå‘˜çš„å¤©èŠ±æ¿ï¼Œæ¯”å¦‚æ‹¿äº†Aç»©æ•ˆçš„åŒå­¦ï¼Œç¬¬äºŒå¹´ä»–ä¾ç„¶å¸Œæœ›æ˜¯Aè€Œä¸æ˜¯Bï¼Œä»è€Œæé«˜å¯¹è‡ªå·±çš„è¦æ±‚ä¸æœŸæœ›ï¼Œæ›´å®¹æ˜“å–å¾—å¥½çš„æˆç»©ã€‚</p></li><li><p>ç²¾ç¥ä¸Šçš„å¥–ä¼˜ä½“ç°åœ¨æ—¥å¸¸è¡Œä¸ºä¸Šï¼Œé¢‘æ¬¡è¾ƒé«˜ï¼Œæ¯”å¦‚ä½ å…³æ³¨å’Œè‚¯å®šæŸä½æˆå‘˜çš„è¡Œä¸ºï¼Œåœ¨å›¢é˜Ÿå†…é€šè¿‡é‚®ä»¶ã€é’‰é’‰ç­‰æ–¹å¼ç®€å•é¼“åŠ±æ¨å¹¿ä»–çš„è¡Œä¸ºã€‚</p></li></ul><p>ç½šåŠ£ä¹Ÿä¼šè½åˆ°ç‰©è´¨å’Œç²¾ç¥ä¸Šï¼Œä½†å®ƒæ˜¯åŠ¨ä½œè€Œéç›®çš„ï¼Œä½ è¦é€šè¿‡ç½šåŠ£æ¥ä¼ é€’å›¢é˜Ÿä¸èƒ½å®¹å¿ä»€ä¹ˆæ ·çš„è¡Œä¸ºï¼Œä»¥æ­¤æé†’ã€é­ç­–å¤§å®¶ã€‚å¥–ä¼˜å’Œç½šåŠ£æ˜¯ç›¸äº’ä¾èµ–çš„ã€‚</p><p>â€œå¥–ä¼˜ç½šåŠ£â€çš„è¯¯åŒºï¼š</p><ul><li><p>æ²¡æœ‰æ„è¯†åˆ°å¥–ä¼˜ç½šåŠ£çš„ç¤ºèŒƒä½œç”¨ã€‚ ä½ è¦æŠŠâ€œå¥–ä¼˜ç½šåŠ£â€å½“ä½œå®£ä¼ åŠ¨ä½œï¼ŒæŠŠç»“æœè¾æ•£å‡ºå»ï¼Œå¼•å¯¼å›¢é˜Ÿé£å‘ã€‚</p></li><li><p>æ³¨é‡ç½šåŠ£ï¼Œå¿½ç•¥å¥–ä¼˜ã€‚</p></li><li><p>å¥–æƒ©åŠ¨ä½œè¿‡äºå„¿æˆï¼Œå®¹æ˜“è¢«æ»¥ç”¨ï¼šâ€œå¥–æƒ©åŠ¨ä½œâ€è¦å»ºç«‹åœ¨å°Šé‡çš„åŸºç¡€ä¸Šï¼Œè®©æˆå‘˜æœ‰æ”¶è·å’Œåæ€ã€‚</p></li></ul><h3 id="å¥–ä¼˜ç½šåŠ£çš„å…³é”®åŠ¨ä½œ"><a href="#å¥–ä¼˜ç½šåŠ£çš„å…³é”®åŠ¨ä½œ" class="headerlink" title="å¥–ä¼˜ç½šåŠ£çš„å…³é”®åŠ¨ä½œ"></a>å¥–ä¼˜ç½šåŠ£çš„å…³é”®åŠ¨ä½œ</h3><h4 id="ç»©æ•ˆè€ƒæ ¸"><a href="#ç»©æ•ˆè€ƒæ ¸" class="headerlink" title="ç»©æ•ˆè€ƒæ ¸"></a>ç»©æ•ˆè€ƒæ ¸</h4><p>æˆ‘ä»¬è¦ä»ä¸€å¼€å§‹è¢«ä¸»è§‚å› ç´ å½±å“ï¼Œé€æ¸è®¤è¯†åˆ°å®¢è§‚çš„ç¯å¢ƒä¸ç°å®ï¼Œæœ€ç»ˆåœ¨ç†æ€§ä¸äººæ€§ä¸­å¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ï¼Œè®©å¤§å®¶çœ‹åˆ°ä»˜å‡ºå’Œèƒ½åšå‡ºå¥½æˆç»©çš„åŒå­¦ï¼Œå›æŠ¥æ˜¯è¿œè¿œé«˜äºå…¶ä»–äººçš„ï¼Œå¯¹äºæ‹–æ•´ä½“åé€€ã€æŒç»­ä¸èƒ½æ”¹å–„çš„åŒå­¦ï¼Œå›¢é˜Ÿæ˜¯ä¸æ¬¢è¿çš„ã€‚</p><h4 id="ç»©æ•ˆé¢è°ˆ"><a href="#ç»©æ•ˆé¢è°ˆ" class="headerlink" title="ç»©æ•ˆé¢è°ˆ"></a>ç»©æ•ˆé¢è°ˆ</h4><p>ç»©æ•ˆé¢è°ˆçš„æ ¸å¿ƒå‡ºå‘ç‚¹æ˜¯é€šè¿‡è¿™æ¬¡ç»©æ•ˆçš„ç»“æœæ”¹å˜æŸäº›è¡Œä¸ºä¸è®¤è¯†ï¼Œè®©å›¢é˜Ÿåœ¨æœªæ¥å–å¾—æ›´å¥½çš„æˆç»©ï¼Œå¹¶ä¸æ˜¯å•çº¯åœ°é€šçŸ¥ç»“æœã€‚</p><p>é¢è°ˆæµç¨‹ï¼š</p><ol><li>å¼€åœºå®šåŸºè°ƒ</li><li>å‘˜å·¥è‡ªè¯„</li><li>ä¸»ç®¡è¯„ä»·</li><li>å¯¹ç„¦å…±è¯†</li><li>é¢è°ˆæ€»ç»“</li><li>åç»­è·Ÿè¿›</li></ol><h4 id="è–ªé…¬æ¿€åŠ±"><a href="#è–ªé…¬æ¿€åŠ±" class="headerlink" title="è–ªé…¬æ¿€åŠ±"></a>è–ªé…¬æ¿€åŠ±</h4><p>ä¸‰ä¸ªåŸºæœ¬åŸåˆ™ï¼š</p><ol><li>é—®è‡ªå·±æ˜¯å¦æ•¢å°†èµ„æºåˆ†é…çš„é€»è¾‘ä¸è§„åˆ™åœ¨é˜³å…‰ä¹‹ä¸‹è®²å‡ºæ¥ã€‚</li><li>ä¸è¦æ’’èƒ¡æ¤’é¢ï¼Œä¹Ÿåˆ«åšå¤§é”…é¥­ï¼Œè®©å¥½çš„ç»“æœè¶…å‡ºé¢„æœŸã€‚</li><li>é¢å‘æœªæ¥è€Œéç°åœ¨å»åšè€ƒè™‘</li></ol><p>ç‰¢è®°èµ„æºæ€»æ˜¯æœ‰é™çš„ï¼Œèµ„æºåˆ†é…æœ¬èº«æ˜¯åšå¼ˆï¼Œæœ‰äººå¤šå°±è¦æœ‰äººå°‘ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¹³å‡åˆ†é…çš„ç»“æœä¸æ˜¯æ™®å¤©åŒåº†ï¼Œè€Œæ˜¯æ‰€æœ‰äººéƒ½ä¸æ»¡æ„ï¼Œæ¯ä¸ªäººéƒ½è§‰å¾—å°‘ã€‚ä¸å…¶å¦‚æ­¤ï¼Œä¸å¦‚æŠŠèµ„æºå€¾æ–œåˆ°é‚£äº›ä½ å›¢é˜Ÿæœ€ä¼˜ç§€ã€ç»©æ•ˆæœ€å¥½çš„åŒå­¦èº«ä¸Šï¼Œè®©ä»–ä»¬å¾—åˆ°é¢„æœŸçš„æ”¶ç›Šç”šè‡³è¶…å‡ºé¢„æœŸã€‚</p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/CioPOWAzaOuAOmbSAADrwmhxbqc219.png" alt="å¥–ä¼˜ç½šåŠ£"></p><hr><h2 id="å‹¤æ²Ÿé€šï¼šåœ¨ä¿¡ä»»çš„åŸºç¡€ä¸Šï¼Œè®©æ²Ÿé€šç®€å•ä¸”çº¯ç²¹"><a href="#å‹¤æ²Ÿé€šï¼šåœ¨ä¿¡ä»»çš„åŸºç¡€ä¸Šï¼Œè®©æ²Ÿé€šç®€å•ä¸”çº¯ç²¹" class="headerlink" title="å‹¤æ²Ÿé€šï¼šåœ¨ä¿¡ä»»çš„åŸºç¡€ä¸Šï¼Œè®©æ²Ÿé€šç®€å•ä¸”çº¯ç²¹"></a>å‹¤æ²Ÿé€šï¼šåœ¨ä¿¡ä»»çš„åŸºç¡€ä¸Šï¼Œè®©æ²Ÿé€šç®€å•ä¸”çº¯ç²¹</h2><p>è¦çŸ¥é“ï¼Œæ²Ÿé€šæ˜¯æœ‰ç›®çš„çš„ï¼Œæ—¢ç„¶æ²Ÿé€šçš„å¯¹è±¡æ˜¯äººï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›é€šè¿‡æ²Ÿé€šå»è¾¾åˆ°ä¸€å®šçš„ç»“æœï¼ˆæ•ˆæœï¼‰ï¼Œé‚£ä¹ˆå°±è¦æ‡‚å¾—ä¸€å®šçš„é“ç†ä¸æŠ€å·§ã€‚</p><h3 id="æ²Ÿé€šçš„æ ¸å¿ƒåŸåˆ™"><a href="#æ²Ÿé€šçš„æ ¸å¿ƒåŸåˆ™" class="headerlink" title="æ²Ÿé€šçš„æ ¸å¿ƒåŸåˆ™"></a>æ²Ÿé€šçš„æ ¸å¿ƒåŸåˆ™</h3><p>æ²Ÿé€šæ˜¯å†…å¿ƒæƒ³æ³•å’Œæ€è€ƒé€»è¾‘çš„å¤–å»¶ï¼Œå¦‚æœä½ æœ‰è‰¯å¥½çš„æ²Ÿé€šèƒ½åŠ›ï¼Œå¯ä»¥åœ¨æ•´ä¸ªå›¢é˜Ÿä¸­è¥é€ å…¬å¼€é€æ˜çš„ä¿¡ä»»æ°›å›´ï¼Œè®©ä¿¡æ¯é€æ˜çš„åŒæ—¶ï¼Œä¹Ÿè®©å›¢é˜Ÿæˆå‘˜æ„¿æ„å‘å‡ºè‡ªå·±çš„å£°éŸ³ã€‚</p><p>æ²Ÿé€šæ ¸å¿ƒåŸåˆ™çš„å®šä¹‰æ˜¯ï¼šåœ¨ç›¸ä¿¡å¯¹æ–¹çš„åŸºç¡€ä¸Šï¼Œè®©æ²Ÿé€šæ°›å›´å˜å¾—â€œç®€å•ä¸”çº¯ç²¹â€ã€‚</p><h3 id="ä¸åŒç»´åº¦çš„æ²Ÿé€š"><a href="#ä¸åŒç»´åº¦çš„æ²Ÿé€š" class="headerlink" title="ä¸åŒç»´åº¦çš„æ²Ÿé€š"></a>ä¸åŒç»´åº¦çš„æ²Ÿé€š</h3><p>å‘ä¸Šæ²Ÿé€šæœ‰èƒ†é‡ã€å¹³è¡Œæ²Ÿé€šæœ‰è‚ºè…‘ã€å‘ä¸‹æ²Ÿé€šæœ‰å¿ƒè‚ã€‚</p><ul><li>å‘ä¸Šæ²Ÿé€šè¦æœ‰æŠ€å·§ã€æœ‰åŸåˆ™ï¼Œè®¤æ¸…æ²Ÿé€šçš„ç›®æ ‡ä¸ç›®çš„ï¼Œä¸è½»æ˜“å¦¥åå¯¼è‡´æ›´ä¸¥é‡çš„åæœã€‚</li><li>å…³äºå¹³è¡Œæ²Ÿé€šæœ‰è‚ºè…‘æ˜¯æŒ‡ä½ è¦çœŸè¯šæ²Ÿé€šï¼Œä¸è¦æ²¹æ»‘å¥—è·¯ã€‚</li><li>å‘ä¸‹æ²Ÿé€šæœ‰å¿ƒè‚æ˜¯æŒ‡æœ‰åŒç†å¿ƒï¼Œæœ‰å°Šé‡çš„åŒæ—¶è¦æ„ŸåŒèº«å—ã€‚</li></ul><h3 id="ä¸¤ä¸ªå…·ä½“çš„æ²Ÿé€šåœºæ™¯"><a href="#ä¸¤ä¸ªå…·ä½“çš„æ²Ÿé€šåœºæ™¯" class="headerlink" title="ä¸¤ä¸ªå…·ä½“çš„æ²Ÿé€šåœºæ™¯"></a>ä¸¤ä¸ªå…·ä½“çš„æ²Ÿé€šåœºæ™¯</h3><h4 id="One-One-æ²Ÿé€š"><a href="#One-One-æ²Ÿé€š" class="headerlink" title="One One æ²Ÿé€š"></a>One One æ²Ÿé€š</h4><ol><li>æ¥åœ°æ°”ï¼Œè¯´äººè¯</li><li>è§†äººä¸ºäºº</li><li>æ²Ÿé€šè¦â€œå‹¤â€</li></ol><h4 id="å›¢é˜Ÿæ²Ÿé€š"><a href="#å›¢é˜Ÿæ²Ÿé€š" class="headerlink" title="å›¢é˜Ÿæ²Ÿé€š"></a>å›¢é˜Ÿæ²Ÿé€š</h4><p>ä¸One Oneæ²Ÿé€šä¸åŒçš„æ˜¯ï¼Œå›¢é˜Ÿæ²Ÿé€šå—äººæ•°çš„é™åˆ¶ï¼Œæ˜¯ä¸€å¯¹å¤šçš„æ²Ÿé€šï¼Œæ‰€ä»¥é™¤äº†å‚è€ƒOneOneæ²Ÿé€šçš„æ ¸å¿ƒç‚¹å¤–ï¼Œä½ æœ€å…³é”®çš„åº”è¯¥æ˜¯æ­åœºå­ï¼Œå‘èµ·å›¢é˜Ÿæ²Ÿé€šã€‚</p><p>å›¢é˜Ÿæ²Ÿé€šç›®çš„æ€§æ›´å¼ºï¼Œé¢‘æ¬¡ä¸é«˜ï¼Œè€ƒéªŒä½ çš„æ§åœºèƒ½åŠ›ã€‚</p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/Cgp9HWA2GNuATPfwAAG2oUoqhik144.png" alt="å‹¤æ²Ÿé€š"></p><hr><h2 id="å»ºæœºåˆ¶ï¼šè§„åˆ™æµç¨‹è¶Šå»ºè¶Šå¤šï¼Œä¸ºä½•æ•ˆæœå´è¶Šæ¥è¶Šå·®ï¼Ÿ"><a href="#å»ºæœºåˆ¶ï¼šè§„åˆ™æµç¨‹è¶Šå»ºè¶Šå¤šï¼Œä¸ºä½•æ•ˆæœå´è¶Šæ¥è¶Šå·®ï¼Ÿ" class="headerlink" title="å»ºæœºåˆ¶ï¼šè§„åˆ™æµç¨‹è¶Šå»ºè¶Šå¤šï¼Œä¸ºä½•æ•ˆæœå´è¶Šæ¥è¶Šå·®ï¼Ÿ"></a>å»ºæœºåˆ¶ï¼šè§„åˆ™æµç¨‹è¶Šå»ºè¶Šå¤šï¼Œä¸ºä½•æ•ˆæœå´è¶Šæ¥è¶Šå·®ï¼Ÿ</h2><h3 id="æœºåˆ¶å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#æœºåˆ¶å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="æœºåˆ¶å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>æœºåˆ¶å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3><p>ä¸¤ç±»æœºåˆ¶ï¼š</p><ul><li><p>ä¸ç®¡ç†ç›¸å…³ï¼š æ¯”å¦‚ä¸ºäº†ä¿¡æ¯äº’é€šï¼Œçº¦å®šæ¯å‘¨å›ºå®šæ—¶é—´é€šè¿‡é‚®ä»¶ã€ä¼šè®®ã€IM ç­‰æ–¹å¼ï¼Œå°†æå‰å®šä¹‰å¥½çš„ä¿¡æ¯åšä¸€ä¸ªæ±‡æ€»äº¤äº’ï¼ˆè¡¨ç°ä¸ºå‘¨æŠ¥ã€å‘¨ä¼šç­‰ï¼‰ï¼Œè¿™å°±æ˜¯æœºåˆ¶çš„ä¸€ç§å…·ç°ã€‚</p></li><li><p>ä¸æŠ€æœ¯ç›¸å…³ï¼š æ¯”å¦‚ä¸ºäº†å¤šäººååŒï¼Œåˆ¶å®šå¼€å‘æµç¨‹ã€Bug å¤„ç†ã€å‘å¸ƒä¸Šçº¿æµç¨‹ï¼Œç”šè‡³åœ¨æ—¥å¸¸å®é™…å¼€å‘çš„å·¥ä½œä¸­ï¼Œå¾€å¾€ä¹Ÿå…ˆå®šä¹‰ API å¥‘çº¦ï¼Œç„¶ååœ¨è”è°ƒæµ‹è¯•æ—¶å†çœŸæ­£å®ç°éªŒè¯ï¼Œè¿™äº›çº¦å®šã€å¥‘çº¦ã€æµç¨‹éƒ½æ˜¯å¯¹åº”æœºåˆ¶åœ¨è½åœ°æ—¶çš„å…·ä½“è¡¨ç°ã€‚</p></li></ul><p>ç«™åœ¨å›¢é˜Ÿçš„è§’åº¦ï¼Œå»ºæœºåˆ¶å°¤ä¸ºé‡è¦ï¼Œä½ è¦é€šè¿‡æœºåˆ¶è®©å›¢é˜Ÿæœ‰ç»Ÿä¸€çš„è¡Œä¸ºä¸è§„åˆ™ï¼Œè®©ç»„ç»‡åƒäººä¸€æ ·ï¼Œè¨€è¡Œä¸¾æ­¢æœ‰è§„å¾‹å¯å¾ªã€‚</p><h3 id="å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„æœºåˆ¶ï¼Ÿ"><a href="#å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„æœºåˆ¶ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„æœºåˆ¶ï¼Ÿ"></a>å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„æœºåˆ¶ï¼Ÿ</h3><ul><li>è§„åˆ™ç»Ÿä¸€ï¼Œä¸è‡ªç›¸çŸ›ç›¾</li><li>ç®€å•æœ‰æ•ˆï¼Œä¾¿äºå¢åˆ </li><li>ç´§ç›¯æ•´ä½“ç»“æœï¼Œæœºåˆ¶çš„ ROI è¦è¶³å¤Ÿé«˜</li></ul><h3 id="æœºåˆ¶è¦æ€ä¹ˆè½åœ°ï¼Ÿ"><a href="#æœºåˆ¶è¦æ€ä¹ˆè½åœ°ï¼Ÿ" class="headerlink" title="æœºåˆ¶è¦æ€ä¹ˆè½åœ°ï¼Ÿ"></a>æœºåˆ¶è¦æ€ä¹ˆè½åœ°ï¼Ÿ</h3><ul><li><p>å…ˆè¯´ whyï¼š å³æœºåˆ¶çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿä½ åœ¨è®¾è®¡æœºåˆ¶æ—¶æ˜¯å¦‚ä½•æ€è€ƒçš„ï¼Ÿ</p></li><li><p>å…±è¯†çš„è¦ä¸ä¸è¦ï¼š å’Œå¤§å®¶è®¨è®ºæˆ‘ä»¬è¦ä¸è¦è¿™æ ·åšï¼Ÿçœ‹çœ‹å¤§å®¶æ˜¯æ€ä¹ˆæƒ³çš„ï¼Œé€šè¿‡å¯¹è¯å’Œå¼•å¯¼å½¢æˆä¸€å®šçš„ç»“è®ºï¼Œæœ‰äº›å†…å®¹éœ€è¦ä¿ç•™ï¼Œæœ‰äº›ä¸åˆç†éœ€è¦å‰”é™¤ï¼Œä¿ƒæˆç»“è®ºæœ€ä¸ºé‡è¦ã€‚</p></li><li><p>æ‰¿è¯ºè¡Œä¸ºä¸¾æ­¢ï¼š ç¡®è®¤æœºåˆ¶ä¹‹åï¼Œéœ€è¦è®©ç»“è®ºå½¢æˆå¯¹å„è‡ªè¡Œä¸ºçš„çº¦æŸã€‚æ¯”å¦‚ä¸åŒçš„æˆå‘˜è®¤é¢†ä¸åŒçš„è§’è‰²å’Œä»»åŠ¡ï¼Œæˆ–è€…åœ¨ IM ä¸­ä¸€èµ·å…¬å‘Šè§„åˆ™ï¼Œæ€»ä¹‹æ¯ä¸ªæˆå‘˜è¦ä¸æœºåˆ¶çš„å‚ä¸æ„Ÿã€‚</p></li></ul><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/CioPOWA9Dj-AbXWgAAQfSFZSZ1Y787.png" alt="ä¼šè®®è®¾è®¡"></p><p>å…ˆè€ƒè™‘ç›®çš„ï¼Œ CodeReview ä¸»è¦æ˜¯è§£å†³ä¸¤æ–¹é¢çš„é—®é¢˜ï¼šæé«˜ä»£ç è´¨é‡ï¼›å¸®åŠ©å¼€å‘åŒå­¦è®¤è¯†åˆ°å¦‚ä½•å†™å‡ºæ›´å¥½çš„ä»£ç ã€‚</p><p>ä¸åŒçš„ä¾§é‡ç‚¹è®¾è®¡å‡ºæ¥çš„æœºåˆ¶ä¹Ÿæœ‰æ‰€ä¸åŒï¼ŒæŒ‰ç…§æˆ‘çš„ç†è§£ï¼ŒCodeReview çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯å¸®åŠ©å¤§å®¶æˆé•¿ï¼Œæ‰“é€ å›¢é˜Ÿå†…çš„æŠ€æœ¯æå‡æ°›å›´ï¼Œæ¬¡è¦æ‰æ˜¯ä¿ƒè¿›äº§å“è´¨é‡çš„æå‡ã€‚</p><p>ç¡®å®šäº†æ ¸å¿ƒæƒ³è¦è¾¾æˆçš„æ•ˆæœï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç€æ‰‹ç¡®å®šæœºåˆ¶çš„å†…å®¹ï¼Œè¿™é‡Œé¢è¦è€ƒè™‘å‡ ä¸ªæ–¹é¢çš„å†…å®¹ï¼šå¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼ˆé˜»åŠ›ï¼‰ã€æœºåˆ¶å®æ–½çš„æˆæœ¬ã€æœºåˆ¶è¿è¡Œçš„æ—¶æœºå’Œå‘¨æœŸã€ç«™åœ¨ä¸€ä¸ªæœºåˆ¶å‚ä¸è€…çš„è§’åº¦è€ƒè™‘ä»–è¦åšä»€ä¹ˆã€‚</p><p>å…·ä½“ CodeReview çš„æœºåˆ¶æ–¹æ¡ˆå¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/Cgp9HWA9DlSAQbjfAAGeT66ULls027.png" alt="code review"></p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/CioPOWA9DlyAYnBoAADCktnlzHk931.png" alt="å»ºç«‹æœºåˆ¶"></p><hr><h2 id="çŸ¥äººå–„ç”¨ï¼šå€Ÿäº‹ä¿®äººï¼Œå€Ÿäººæˆäº‹"><a href="#çŸ¥äººå–„ç”¨ï¼šå€Ÿäº‹ä¿®äººï¼Œå€Ÿäººæˆäº‹" class="headerlink" title="çŸ¥äººå–„ç”¨ï¼šå€Ÿäº‹ä¿®äººï¼Œå€Ÿäººæˆäº‹"></a>çŸ¥äººå–„ç”¨ï¼šå€Ÿäº‹ä¿®äººï¼Œå€Ÿäººæˆäº‹</h2><h3 id="çŸ¥äººå–„ç”¨çš„ä¸‰ä¸ªå…³é”®ç‚¹"><a href="#çŸ¥äººå–„ç”¨çš„ä¸‰ä¸ªå…³é”®ç‚¹" class="headerlink" title="çŸ¥äººå–„ç”¨çš„ä¸‰ä¸ªå…³é”®ç‚¹"></a>çŸ¥äººå–„ç”¨çš„ä¸‰ä¸ªå…³é”®ç‚¹</h3><ol><li>æ‰¾å¯¹äºº</li><li>åŸ¹å…»äºº</li><li>å…»æˆäºº</li></ol><h3 id="æ€ä¹ˆè½åœ°æ‰§è¡Œï¼Ÿ"><a href="#æ€ä¹ˆè½åœ°æ‰§è¡Œï¼Ÿ" class="headerlink" title="æ€ä¹ˆè½åœ°æ‰§è¡Œï¼Ÿ"></a>æ€ä¹ˆè½åœ°æ‰§è¡Œï¼Ÿ</h3><ul><li>å›¢é˜Ÿç›˜ç‚¹</li><li>æ¿€å‘æ„æ„¿</li><li>æ”¹å–„è®¡åˆ’</li></ul><h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><ul><li>ä¸æ€•æ²¡ç¼ºç‚¹ï¼Œå°±æ€•æ²¡ç‰¹ç‚¹ï¼š ä½ å€Ÿäººæˆäº‹ï¼Œä¸èƒ½ä¸€å‘³åœ°å…³æ³¨ä»–çš„ç¼ºç‚¹ï¼Œè€Œæ˜¯è¦å¯»æ‰¾å…¶ç‰¹ç‚¹ï¼Œå‘æŒ¥ä»–çš„æ“…é•¿ç‚¹ï¼Œæœ‰ç¼ºç‚¹ä¸å¯æ€•ï¼Œå°±æ€•æ²¡ç‰¹ç‚¹ã€‚</li><li>æ–°äººåšè€äº‹ï¼Œè€äººåšæ–°äº‹ï¼š å¦‚æœåœ¨å›¢é˜Ÿä¸­è€äººä¸€ç›´åšè€äº‹ï¼Œæ–°äººåšæ–°äº‹ï¼Œé‚£ä¹ˆä¼šå‡ºç°è€äººæ²¡æœ‰æ–°çš„æé«˜ï¼Œæ–°äººä¹Ÿè¦å…‹æœå¾ˆå¤šæœªçŸ¥çš„å›°éš¾ï¼›åä¹‹ï¼Œå¯ä»¥é‡æ–°æ¿€å‘è€äººçš„æ´»åŠ›ï¼Œä¹Ÿè®©æ–°äººæœ‰å€Ÿé‰´ä¹‹å¤„ã€‚</li><li>ä¸è¦è¶Šä¿ä»£åº–ï¼Œä»€ä¹ˆéƒ½è‡ªå·±ä¸Šï¼š ç”¨äººçš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°â€œäº‹æƒ…åšé”™â€çš„æƒ…å†µï¼Œä¸€æ—¦ä½ å‘ç°è¿™æ ·çš„æƒ…å†µï¼Œåƒä¸‡ä¸è¦ç›´æ¥å»å¸®ä»–çº æ­£ï¼Œè¿™æ ·æ— æ³•å¸®åŠ©å›¢é˜Ÿæˆå‘˜æˆé•¿ï¼Œå›¢é˜Ÿæˆå‘˜åªä¼šå½“çŠ¯é”™è¯¯æ—¶ï¼Œç­‰ç€ä½ æ¥å¸®ä»–è§£å†³ã€‚å¥½çš„ Leaderä¸€å®šæ˜¯è¦åœ¨æ˜çŸ¥å‰æ–¹æœ‰å‘ï¼ˆè¿™ä¸ªå‘ä¸€å®šæ˜¯ä½ èƒ½æ§åˆ¶çš„ï¼‰çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè¦è®©å›¢é˜Ÿæˆå‘˜å»è¸©ä¸€å›ï¼Œè®©å…¶æœ‰è¯•é”™çš„æœºä¼šï¼Œè®©æ¯ä¸ªé”™è¯¯éƒ½ç‰©æœ‰æ‰€å€¼ã€‚</li><li>ç»™æœºä¼šçš„åŒæ—¶ï¼Œç»™å‹åŠ›å’Œå¸®åŠ©ï¼š å¾ˆå¤šæ—¶å€™å‹åŠ›æ˜¯æˆé•¿çš„å‚¬åŒ–å‰‚ï¼Œæœ‰äº†å‹åŠ›ä¹Ÿå°±æœ‰äº† 120% çš„åŠ¨åŠ›ï¼Œæ‰€ä»¥æŠŠæŸä¸ªä»»åŠ¡æˆ–èŒè´£ç»™åˆ°ä¸€ä¸ªåŒå­¦çš„æ—¶å€™ï¼Œä¹Ÿè¦æŠŠé€‚å½“çš„å‹åŠ›ä¼ é€’è¿‡å»ï¼Œè®©ä»–æ„Ÿå—åˆ°äº‹æƒ…çš„é‡è¦æ€§ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ—¶åˆ»å…³æ³¨ï¼Œè¯¥ç»™çš„å¸®åŠ©ä¸€å®šè¦ç»™åˆ°ï¼Œä¸èƒ½ä¸é—»ä¸é—®ã€‚</li><li>æ—¢æ•¢äºæ‰¿è®¤é”™è¯¯ï¼Œä¹Ÿå…è®¸åˆ«äººçŠ¯é”™ï¼š è®©ä¸€ä¸ªäººæˆé•¿ä¸å¯èƒ½å®Œå…¨ä¸è®©ä»–çŠ¯é”™ï¼Œæœ‰æ—¶ä¸€äº›å¯æ§çš„é”™è¯¯åè€Œå¯èƒ½æ˜¯äº‹åçœ‹æœ€å¤§çš„æ”¶è·ã€‚åŒæ—¶ï¼Œä¹Ÿä¸è¦è®¤å®šè‡ªå·±ä¹‹å‰çš„åšæ³•éƒ½æ˜¯å¯¹çš„ï¼Œè¦æ„è¯†åˆ°ï¼Œå“ªæ€•ä½ ä¹‹å‰åšæˆåŠŸè¿‡ï¼Œä¹Ÿä¸æ„å‘³ç€ä½ å°±ä¸€å®šæ˜¯100%æ­£ç¡®çš„ã€‚å¥½çš„ Leader åœ¨åŸ¹å…»å›¢é˜Ÿæˆå‘˜æ—¶ï¼Œæ—¢è¦è®©å›¢é˜Ÿä¸æ€•çŠ¯é”™ï¼ˆæ•¢å¹²äº‹ï¼‰ï¼Œä¹Ÿè¦æ•¢äºæ‰¿è®¤è‡ªå·±ä¸è¶³ï¼Œå»æ”¹å–„å»æé«˜ã€‚</li></ul><h2 id="æ‰¾åˆ°äººï¼šæ‹›è˜æ˜¯-Leader-çš„è´£ä»»ï¼Œä¸æ˜¯-HR-çš„"><a href="#æ‰¾åˆ°äººï¼šæ‹›è˜æ˜¯-Leader-çš„è´£ä»»ï¼Œä¸æ˜¯-HR-çš„" class="headerlink" title="æ‰¾åˆ°äººï¼šæ‹›è˜æ˜¯ Leader çš„è´£ä»»ï¼Œä¸æ˜¯ HR çš„"></a>æ‰¾åˆ°äººï¼šæ‹›è˜æ˜¯ Leader çš„è´£ä»»ï¼Œä¸æ˜¯ HR çš„</h2><h3 id="æ‹›äººä¸ç­‰äºç›²ç›®åŠ äºº"><a href="#æ‹›äººä¸ç­‰äºç›²ç›®åŠ äºº" class="headerlink" title="æ‹›äººä¸ç­‰äºç›²ç›®åŠ äºº"></a>æ‹›äººä¸ç­‰äºç›²ç›®åŠ äºº</h3><p>æ˜ç¡®ä¸šåŠ¡ç›®æ ‡ï¼›ç›˜ç‚¹å›¢é˜Ÿéœ€æ±‚ï¼›åšå‡ºå²—ä½è®¾è®¡ï¼›æç‚¼å²—ä½è¦æ±‚ã€‚</p><h3 id="é—»å‘³é“ã€é—®äº‹å®ã€çœ‹èƒ½åŠ›"><a href="#é—»å‘³é“ã€é—®äº‹å®ã€çœ‹èƒ½åŠ›" class="headerlink" title="é—»å‘³é“ã€é—®äº‹å®ã€çœ‹èƒ½åŠ›"></a>é—»å‘³é“ã€é—®äº‹å®ã€çœ‹èƒ½åŠ›</h3><p>é¢è¯•å‰çœ‹ç®€å†ï¼Œé¢è¯•ä¸­æ›´å¤šå€¾å¬ï¼Œé¢è¯•åé€Ÿå†™è¯„ä»·ã€‚</p><ul><li>é—®äº‹å®ï¼ˆSTARæ³•åˆ™ï¼Œçœ‹å€™é€‰äººæ‰€è¯´çš„å†…å®¹æ˜¯å¦çœŸæ­£åšè¿‡ï¼Œä»¥åŠæ€è€ƒè¿‡ç¨‹ï¼‰</li><li>çœ‹èƒ½åŠ›</li><li>é—»å‘³é“ï¼ˆæ˜¯å¦å’Œå›¢é˜ŸåŒ¹é…ï¼‰</li></ul><h3 id="å®ç¼ºæ¯‹æ»¥ï¼Œå®ˆä½åº•çº¿"><a href="#å®ç¼ºæ¯‹æ»¥ï¼Œå®ˆä½åº•çº¿" class="headerlink" title="å®ç¼ºæ¯‹æ»¥ï¼Œå®ˆä½åº•çº¿"></a>å®ç¼ºæ¯‹æ»¥ï¼Œå®ˆä½åº•çº¿</h3><h4 id="å…³æ³¨æœªæ¥"><a href="#å…³æ³¨æœªæ¥" class="headerlink" title="å…³æ³¨æœªæ¥"></a>å…³æ³¨æœªæ¥</h4><ol><li>ä»–æ˜¯å¦æœ‰èƒ½åŠ›çš„åŒæ—¶è¿˜æœ‰æ½œåŠ›ï¼Ÿæ¯”å¦‚å¾ˆå¼ºçš„å‘å±•æ¬²æœ›æˆ–å­¦ä¹ èƒ½åŠ›ï¼Ÿ</li><li>ä»–èº«ä¸Šæ˜¯å¦æœ‰ç‰¹è´¨è¶³å¤Ÿå¸å¼•ä½ ï¼Ÿæ¯”å¦‚è®©ä½ è§‰å¾—å½“ä»–æœªæ¥ä¼šæ¯”ä½ æ›´ä¼˜ç§€ï¼Ÿ</li><li>ä½ æ˜¯å¸Œæœ›ä¸ä»–è¿™æ ·çš„äººä¸€èµ·å…±äº‹çš„ï¼Ÿ</li><li>å½“ä»–åŠ å…¥å›¢é˜Ÿåï¼Œèƒ½å¦å°†å›¢é˜Ÿæ°›å›´æ¿€æ´»ï¼Œå½¢æˆé²¶é±¼æ•ˆåº”ï¼Ÿ</li></ol><h4 id="å®ç¼ºæ¯‹æ»¥"><a href="#å®ç¼ºæ¯‹æ»¥" class="headerlink" title="å®ç¼ºæ¯‹æ»¥"></a>å®ç¼ºæ¯‹æ»¥</h4><ul><li><p>èƒ½åŠ›æ°´å¹³è¶…è¿‡å›¢é˜Ÿ 50% çš„äººä»¥ä¸Šï¼šç¡®ä¿å›¢é˜Ÿè¶Šæ¥è¶Šå¼ºï¼Œè€Œä¸æ˜¯è¶Šæ¥è¶Šå¼±ï¼Œæœ‰çš„ Leaderä¼šè§‰å¾—å€™é€‰äººæ¯”å›¢é˜Ÿæœ€å·®çš„ä¸¤ä¸ªäººå¥½å°±å¯ä»¥äº†ï¼Œä½†è¿™æ ·ä¸€æ¥ï¼Œéšç€æ—¶é—´æ‹‰é•¿ï¼Œä½ çš„å›¢é˜Ÿä¼šè¶Šæ¥è¶Šå·®ã€‚</p></li><li><p>å†…å¿ƒæ˜¯å¦éå¸¸çŠ¹è±«ï¼ŸçŠ¹è±«å¾€å¾€æ„å‘³ç€â€œä¸æƒ³è¦ &gt; æƒ³è¦â€ï¼Œå¦‚æœæ˜¯è¿«äºä¸šåŠ¡å‹åŠ›ä¸å¾—ä¸åŠ äººï¼Œæˆ‘å»ºè®®ä½ è¿˜æ˜¯ä¸è¦å‹‰å¼ºï¼Œå› ä¸ºæœ‰å¯èƒ½æœ¬æ¥è§£å†³ä¸šåŠ¡å‹åŠ›å°±å¯ä»¥çš„é—®é¢˜æ¼”å˜æˆè¿˜è¦é¢å¤–è§£å†³ä¸é€‚åˆçš„æ–°å‘˜å·¥çš„é—®é¢˜ã€‚</p></li></ul><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/Cgp9HWBF1_6AMv9fAAFMMGSqBd0745.png" alt="æ‰¾åˆ°å¯¹çš„äºº"></p><h2 id="èƒ½è½åœ°ï¼š90-å¤©è¯•ç”¨æœŸï¼Œè½¬æ­£æ—¶æˆ‘ä»¬è¦è€ƒå¯Ÿä»€ä¹ˆï¼Ÿ"><a href="#èƒ½è½åœ°ï¼š90-å¤©è¯•ç”¨æœŸï¼Œè½¬æ­£æ—¶æˆ‘ä»¬è¦è€ƒå¯Ÿä»€ä¹ˆï¼Ÿ" class="headerlink" title="èƒ½è½åœ°ï¼š90 å¤©è¯•ç”¨æœŸï¼Œè½¬æ­£æ—¶æˆ‘ä»¬è¦è€ƒå¯Ÿä»€ä¹ˆï¼Ÿ"></a>èƒ½è½åœ°ï¼š90 å¤©è¯•ç”¨æœŸï¼Œè½¬æ­£æ—¶æˆ‘ä»¬è¦è€ƒå¯Ÿä»€ä¹ˆï¼Ÿ</h2><ol><li>æ˜ç¡®æ–°åŒå­¦è½åœ°çš„æ•´ä½“èŠ‚å¥</li><li>é‡ç‚¹æŠ“è¯•ç”¨æœŸè€ƒæ ¸ä»¥åŠå·¥ä½œä¹ æƒ¯çš„å…»æˆ</li><li>è½¬æ­£ç»“æŸåä¾ç„¶ä¿æŒè·Ÿè¿›</li></ol><h3 id="æ—¢è¦å¸®ï¼Œä¹Ÿè¦ä¸¥"><a href="#æ—¢è¦å¸®ï¼Œä¹Ÿè¦ä¸¥" class="headerlink" title="æ—¢è¦å¸®ï¼Œä¹Ÿè¦ä¸¥"></a>æ—¢è¦å¸®ï¼Œä¹Ÿè¦ä¸¥</h3><p>â€œæ—¢è¦å¸®ï¼Œä¹Ÿè¦ä¸¥â€æ˜¯æˆ‘å®šä¹‰çš„â€œèƒ½è½åœ°â€çš„æ ¸å¿ƒåŸåˆ™ï¼Œâ€œå¸®â€ä¸â€œä¸¥â€æ˜¯åŒå‘è¦æ±‚ï¼šå¸®æ˜¯æŒ‡å¸®åŠ©æ–°åŒå­¦èå…¥å›¢é˜Ÿï¼ˆé’ˆå¯¹çš„æ˜¯å¸ˆå…„å’Œ Leaderï¼‰ï¼›ä¸¥æ˜¯è¦è®©æ–°åŒå­¦åœ¨å›¢é˜Ÿä¸­æå‡è‡ªå·±ï¼Œéµå®ˆå›¢é˜Ÿçš„åšäº‹åŸåˆ™ï¼Œå‘æŒ¥è‡ªå·±çš„èƒ½åŠ›ä¸ä»·å€¼ï¼ˆé’ˆå¯¹æ–°åŒå­¦è‡ªå·±ï¼‰ã€‚</p><p>æ‹›è˜åªæ˜¯å¼€å§‹ï¼Œè®©æ–°åŒå­¦èƒ½è½åœ°ã€å‘æŒ¥ä»·å€¼æ‰æ˜¯æœ€ç»ˆç›®æ ‡ã€‚</p><h3 id="æ˜ç¡®æ–°åŒå­¦è½åœ°çš„æ•´ä½“èŠ‚å¥"><a href="#æ˜ç¡®æ–°åŒå­¦è½åœ°çš„æ•´ä½“èŠ‚å¥" class="headerlink" title="æ˜ç¡®æ–°åŒå­¦è½åœ°çš„æ•´ä½“èŠ‚å¥"></a>æ˜ç¡®æ–°åŒå­¦è½åœ°çš„æ•´ä½“èŠ‚å¥</h3><ol><li>ç”¨è¿æ–°æ‰“ç ´å¤§å®¶åœ¨æƒ…æ„Ÿä¸Šçš„å£å’ï¼›</li><li>ç»™æ–°åŒå­¦å®‰æ’â€œå¸ˆå…„â€ï¼›</li><li>æ˜ç¡®æ–°åŒå­¦çš„ä½œä¸šä¸ç›®æ ‡ï¼ˆåšå‡ºä¸€äº›æˆç»©è¾¾åˆ°è½¬æ­£ï¼‰ï¼›</li><li>æ˜ç¡®å‘ŠçŸ¥è½¬æ­£åº”è¯¥æ€ä¹ˆåšï¼ˆæŠŠè½¬æ­£åšé‡ã€åšå®ï¼‰ã€‚</li></ol><h3 id="è½¬æ­£è¿°èŒè¦è€ƒæ ¸ä»€ä¹ˆ"><a href="#è½¬æ­£è¿°èŒè¦è€ƒæ ¸ä»€ä¹ˆ" class="headerlink" title="è½¬æ­£è¿°èŒè¦è€ƒæ ¸ä»€ä¹ˆ"></a>è½¬æ­£è¿°èŒè¦è€ƒæ ¸ä»€ä¹ˆ</h3><p>è½¬æ­£è¿°èŒæ‰æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æ‹›è˜ç»“æŸï¼</p><ul><li><p>æŠŠæ§è½¬æ­£æ—¶é—´ï¼š æå‰åŠä¸ªæœˆè·Ÿ HR æˆ–è€…â€œå¸ˆå…„â€ç¡®å®šè½¬æ­£è¿°èŒæ—¶é—´ç‚¹ã€‚</p></li><li><p>å»ºç«‹è¯„å§”ä¼šï¼š ç”± Leader ä¸»å¯¼ï¼Œä¸å…¶åˆä½œçš„ä¼™ä¼´ï¼ˆæŠ€æœ¯åŒå­¦ã€äº§å“æˆ–è€…è¿è¥ï¼‰ç»„æˆå°çš„è¯„å§”ä¼šï¼ˆå¦‚æœå›¢é˜Ÿæˆå‘˜è¾ƒå°‘ï¼Œä¹Ÿå¯ä»¥åªæœ‰ Leader å’Œ HRï¼‰è¿™é‡Œè¦æ³¨æ„ï¼Œåˆä½œä¼™ä¼´çš„åé¦ˆä¹Ÿè®¸ä¼šæ¯”è¾ƒä¸»è§‚ï¼Œä½ åœ¨å‚è€ƒæ—¶è¦å°½é‡ä¿æŒå®¢è§‚ã€‚</p></li><li><p>æ˜ç¡®è€ƒæ ¸å†…å®¹ï¼š ç¡¬æ€§è¦æ±‚+è½¯æ€§è¦æ±‚ã€‚</p></li></ul><h3 id="æˆé•¿æœŸçš„è·Ÿè¿›"><a href="#æˆé•¿æœŸçš„è·Ÿè¿›" class="headerlink" title="æˆé•¿æœŸçš„è·Ÿè¿›"></a>æˆé•¿æœŸçš„è·Ÿè¿›</h3><p>æ…¢æ…¢å åŠ ã€ä¸»åŠ¨è·Ÿè¿›ã€æ ‘ç«‹ä¿¡å¿ƒ</p><h2 id="å‡çº§æ±°æ¢ï¼šâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€"><a href="#å‡çº§æ±°æ¢ï¼šâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€" class="headerlink" title="å‡çº§æ±°æ¢ï¼šâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€"></a>å‡çº§æ±°æ¢ï¼šâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€</h2><h3 id="å¼€é™¤äººâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€"><a href="#å¼€é™¤äººâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€" class="headerlink" title="å¼€é™¤äººâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€"></a>å¼€é™¤äººâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€</h3><ul><li><p>No Surpriseï¼š ä¸è¦çªç„¶Fireä¸€ä¸ªäººï¼ˆç¦»èŒä¸€å®šä¸æ˜¯ä¸€ä¸ªçªå‘è¡Œä¸ºï¼‰ï¼Œæ²¡æœ‰ä»»ä½•å¾å…†å‘Šè¯‰å‘˜å·¥ Aâ€œä½ è¢«å¼€é™¤äº†â€ï¼Œè¿™æ˜¯å…¸å‹çš„ç®¡ç†å¤±èŒã€‚å¦‚æœAå­˜åœ¨é—®é¢˜ï¼Œä½ åº”è¯¥å…ˆå‘ŠçŸ¥ï¼Œç„¶åä¸€è¾¹å’Œä»–ä¸€èµ·åˆ¶å®šæ”¹å–„è®¡åˆ’ï¼Œä¸€è¾¹ç£ä¿ƒå…¶æ”¹æ­£ã€‚ç¦»èŒå¾€å¾€æ˜¯ä¸€ä¸ªå¯é¢„æœŸçš„ç»“æœï¼Œæ— æ³•æ»¡è¶³å·¥ä½œéœ€è¦æˆ–è€…å¯¹å›¢é˜Ÿæœ‰å…¶ä»–ä¼¤å®³è€Œ A ä¾æ—§æ— æ³•æ”¹å˜æ—¶ï¼Œä¸ºäº†é¿å…å¯¹å›¢é˜Ÿäº§ç”ŸæŒä¹…ä¸åˆ©çš„å½±å“ï¼Œå°±éœ€è¦è®©ä»–ç¦»å¼€ã€‚</p></li><li><p>å¿ƒè¦æ…ˆã€åˆ€è¦å¿«ï¼š æ°å…‹Â·éŸ¦å°”å¥‡ï¼ˆJack Welchï¼‰æ›¾ç»è¯´è¿‡è¿™æ ·ä¸€å¥è¯â€œå¦‚æœä¸€ä¸ªäººåˆ°äº†ä¸­å¹´ä¹‹åï¼Œè¿˜æ²¡æœ‰è¢«å‘ŠçŸ¥è‡ªå·±çš„å¼±ç‚¹ï¼Œåè€Œåœ¨æŸä¸€å¤©å› ä¸ºèŠ‚çº¦æˆæœ¬çš„åŸå› è¢«è£æ‰äº†ï¼Œè¿™æ˜¯æœ€ä¸å…¬å¹³ã€æœ€ä¸åº”è¯¥å‘ç”Ÿçš„äº‹æƒ…ã€‚å°±æ˜¯å› ä¸ºè¿™ä¸ªå…¬å¸å¤ªä»æ…ˆäº†ï¼Œä»–è¿å‡ºå»æ‰¾å·¥ä½œã€æå‡è‡ªæˆ‘çš„å¯èƒ½æ€§å’Œæœºä¼šéƒ½æ²¡æœ‰ã€‚â€ä½ å¯èƒ½è§‰å¾—ï¼Œåœ¨æƒ…æ„Ÿä¸Šè§£è˜ä¸€ä¸ªäººéå¸¸ç³Ÿç³•ï¼Œä½†æ˜¯æ¢ä¸€ä¸ªè§’åº¦æƒ³ï¼Œå¦‚æœä½ å¯¹ä¸€ä¸ªäººå¾ˆä¸æ»¡æ„ï¼Œå´åˆä¸æ‰¾ä»–è°ˆè¯ï¼Œä¸è¦æ±‚ä»–æ”¹è¿›ï¼Œåˆä¸å¼€é™¤ä»–ï¼Œé‚£ä¹ˆä»æœ€ç»ˆç»“æœçœ‹ä¸ä»…å¯¹ä»–å¾ˆæ®‹é…·ï¼Œè¿™ç§â€œæ‹‰é”¯æˆ˜â€å¯¹å›¢é˜Ÿä¹Ÿæ˜¯ä¸è´Ÿè´£ä»»çš„ã€‚</p></li><li><p>Happy stayã€Happy goï¼š å¾ˆå¤šæ—¶å€™ï¼Œé€èµ°ä¸€ä¸ªåŒå­¦å¯¹å½¼æ­¤æ¥è¯´å¹¶ä¸æ˜¯ä¸€ä»¶ç³Ÿç³•çš„äº‹ï¼Œæ¢ä¸ªè§’åº¦çœ‹ï¼Œå¦‚æœä»–åœ¨å½“å‰ç¯å¢ƒä¸‹ä¸€ç›´æ— æ³•é€‚é…å›¢é˜Ÿï¼Œå¯¹ä»–æ¥è¯´ä¹Ÿæ˜¯å¾ˆéš¾å—çš„ï¼Œè¿™æ—¶åˆ†å¼€å¯¹ä»–å¯¹å›¢é˜Ÿéƒ½æ˜¯è§£è„±ã€‚å°¤å…¶æ˜¯å½“å…¬å¸å‡ºç°å˜åŒ–æ—¶ï¼Œå¦‚æœä¸€äº›åŒå­¦ä¸å†åˆé€‚ï¼Œæ¢ç¯å¢ƒæ¥è®²å¯¹ä»–æ˜¯æ–°çš„æœºä¼šï¼Œæ‰€ä»¥ä½ ä¸è¦å­˜åœ¨å¤ªå¤šçš„æƒ…ç»ªï¼Œè€Œæ˜¯è¦å¾€â€œå¥½èšå¥½æ•£â€çš„æ–¹å‘ä¸Šæ¨åŠ¨ã€‚</p></li></ul><h3 id="ä¸è¦ç»™â€œç™½å…”â€ç”Ÿå­˜æœºä¼š"><a href="#ä¸è¦ç»™â€œç™½å…”â€ç”Ÿå­˜æœºä¼š" class="headerlink" title="ä¸è¦ç»™â€œç™½å…”â€ç”Ÿå­˜æœºä¼š"></a>ä¸è¦ç»™â€œç™½å…”â€ç”Ÿå­˜æœºä¼š</h3><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/Cgp9HWBLFaeAA8v9AAA6D5TpRtM361.png"></p><p>ç™½å…”çœ‹èµ·æ¥äººç•œæ— å®³ï¼Œç¹æ®–èƒ½åŠ›æå¼ºï¼Œå¤§å…¬å¸é‡Œæœ€å®¹æ˜“å­˜åœ¨çš„å°±æ˜¯â€œç™½å…”â€ï¼ˆä¸å¹²æ´»çš„å¥½äººï¼‰ã€‚ä»–ä»¬ç›®æ ‡å’Œä»·å€¼è§‚è®¤åŒåº¦è¾ƒé«˜ï¼Œä½†æ˜¯ä¸šç»©é•¿æœŸæ‹–åè…¿ã€‚æ¯ä¸€å®¶å…¬å¸éƒ½æœ‰è¿™æ ·çš„äººï¼Œçœ‹ç€å‹¤å‹¤æ³æ³ï¼Œä½†å´æ‹¿ä¸åˆ°ä»»ä½•ç»“æœï¼Œå¦‚æœä½ çºµå®¹ç™½å…”çš„å­˜åœ¨ï¼Œé‚£ä¹ˆé•¿ä¹…ä¸‹å»ï¼Œå¾ˆå®¹æ˜“æ»‹ç”Ÿä¸€ç¾¤ç™½å…”ç£¨æ´‹å·¥ï¼Œé’ˆå¯¹è¿™ç±»å‘˜å·¥ï¼Œä½ å‰æœŸå¯ä»¥ç»™äºˆæ”¹æ­£çš„æœºä¼šï¼Œå¦‚æœä¾æ—§æ²¡æœ‰æ”¹å–„ï¼Œåº”è¯¥æ¯«ä¸çŠ¹è±«å°†å…¶é€èµ°ã€‚</p><h3 id="ç¦»èŒé¢è°ˆâ€œTRFâ€"><a href="#ç¦»èŒé¢è°ˆâ€œTRFâ€" class="headerlink" title="ç¦»èŒé¢è°ˆâ€œTRFâ€"></a>ç¦»èŒé¢è°ˆâ€œTRFâ€</h3><p> Train himã€Remove himã€Fire him</p><p>Train him æ˜¯æŒ‡å¦‚æœä»–èƒ½åŠ›è·Ÿä¸ä¸Šï¼Œä½ å¯ä»¥ç»™äºˆå…¶å¸®åŠ©ï¼›Remove him æ˜¯æŒ‡å¦‚æœä»–çš„èƒ½åŠ›å’Œå²—ä½åŒ¹é…æœ‰é—®é¢˜ï¼Œä½ è¦æ›´å¤šåœ°é‡‡ç”¨è½¬å²—çš„æ–¹å¼ï¼Œä¸ºä»–çš„å‘å±•æ‰“å¼€ç©ºé—´ï¼›å¦‚æœåœ¨ä½ ç»™äºˆä»–æœºä¼šä¹‹åï¼Œä»–è¿˜æ˜¯æ— æ³•æ”¹å–„ï¼Œé‚£ä½ å°±åº”è¯¥ Fire himã€‚</p><p>éœ€è¦é¿å…çš„ï¼š</p><p>â€œè°ˆä¸äº†â€ï¼šè¾é€€çš„äº‹å®ä¾æ®ä¸å……åˆ†ï¼Œå¯¹ç¦»èŒåŸå› è®²ä¸æ¸…æ¥šã€‚</p><p>â€œæ— é‡ç‚¹â€ï¼šå¯¹æœ‰å…³é—®é¢˜é¿é‡å°±è½»ï¼Œåªè¯´æ— å…³ç—›ç—’çš„ç¥ç¦ã€‚</p><p>â€œæ²¡æŠ€å·§â€ï¼šå¯¹å‘˜å·¥å·¥ä½œæ¨ªåŠ æŒ‡è´£ï¼Œé¢è°ˆå®Œåè€ŒåŠ æ·±äº†çŸ›ç›¾ã€‚</p><p>â€œä»ä¸è°ˆâ€ï¼šæ˜¯å¯¹å‘˜å·¥å­˜åœ¨å¾ˆå¤§åè§ï¼Œä¸é¢è°ˆç›´æ¥ä¸€æ‹ä¸¤æ•£ã€‚</p><p><img src="/images/%E7%AE%A1%E7%90%86%E4%B8%89%E6%9D%BF%E6%96%A7/CioPOWBLFeGAX6HuAADUCQlA8L8413.png" alt="å‡çº§æ±°æ¢"></p><hr><h1 id="æŠ€æœ¯ç®¡ç†çš„å¸¸è§ç—›ç‚¹"><a href="#æŠ€æœ¯ç®¡ç†çš„å¸¸è§ç—›ç‚¹" class="headerlink" title="æŠ€æœ¯ç®¡ç†çš„å¸¸è§ç—›ç‚¹"></a>æŠ€æœ¯ç®¡ç†çš„å¸¸è§ç—›ç‚¹</h1><h2 id="æ™‹å‡ï¼šæ˜¯ä¸æ˜¯æŠ€æœ¯åˆ°ä½ã€é¡¹ç›®åšå¥½å°±å¤Ÿäº†ï¼Ÿ"><a href="#æ™‹å‡ï¼šæ˜¯ä¸æ˜¯æŠ€æœ¯åˆ°ä½ã€é¡¹ç›®åšå¥½å°±å¤Ÿäº†ï¼Ÿ" class="headerlink" title="æ™‹å‡ï¼šæ˜¯ä¸æ˜¯æŠ€æœ¯åˆ°ä½ã€é¡¹ç›®åšå¥½å°±å¤Ÿäº†ï¼Ÿ"></a>æ™‹å‡ï¼šæ˜¯ä¸æ˜¯æŠ€æœ¯åˆ°ä½ã€é¡¹ç›®åšå¥½å°±å¤Ÿäº†ï¼Ÿ</h2><h3 id="ç»è¿‡å¤šå°‘â€œå…³â€æ‰èƒ½æ™‹å‡ï¼Ÿ"><a href="#ç»è¿‡å¤šå°‘â€œå…³â€æ‰èƒ½æ™‹å‡ï¼Ÿ" class="headerlink" title="ç»è¿‡å¤šå°‘â€œå…³â€æ‰èƒ½æ™‹å‡ï¼Ÿ"></a>ç»è¿‡å¤šå°‘â€œå…³â€æ‰èƒ½æ™‹å‡ï¼Ÿ</h3><p>æ™‹å‡æ­¥éª¤ï¼š</p><p>æ™‹å‡å¯åŠ¨â€”â€”ä¸»ç®¡æåâ€”â€”éƒ¨é—¨ææŠ¥â€”â€”è¿°èŒç­”è¾©â€”â€”ç»“æœè¡¨å†³â€”â€”å…¬å¸å¤å®¡â€”â€”ç»“æœå…¬å¸ƒ</p><h4 id="æåæ²Ÿé€š"><a href="#æåæ²Ÿé€š" class="headerlink" title="æåæ²Ÿé€š"></a>æåæ²Ÿé€š</h4><p>å¯ä»¥åœ¨è–ªèµ„ã€å¹´ç»ˆå¥–ç­‰æ¿€åŠ±ä¸Šä½“ç°è‡ªå·±å¯¹è‹¦åŠ³åŒå­¦çš„å…³æ³¨ï¼Œè€Œå¯¹äºæƒ³è¦æ™‹å‡çš„åŒå­¦ï¼Œåº”è¯¥æ›´å¤šç»™ä»–èƒ½åŠ›åŸ¹å…»çš„æœºä¼šï¼Œå› ä¸ºå¯¹æŠ€æœ¯åŒå­¦è€Œè¨€ï¼ŒæŠ€æœ¯æ˜¯æ™‹å‡çš„åŸºç¡€ï¼Œæˆ˜åŠŸä¸ä¸šç»©ä¹Ÿç¼ºä¸€ä¸å¯ï¼Œåè€…æ˜¯ä¸ºäº†è¯æ˜è‡ªå·±çš„èƒ½åŠ›å’Œæ‹…å½“è¶³ä»¥æ‰¿è½½æ›´å¤šèŒè´£ã€‚</p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹è‹¦åŠ³ä¸ç­‰äºåŠŸåŠ³ï¼Œæ˜¯å¦å…·å¤‡ä¸‹ä¸€ä¸ªè§’è‰²æ‰€éœ€è¦çš„æ¡ä»¶æ‰æ˜¯æ™‹å‡è€ƒæ ¸çš„ä¾§é‡ç‚¹ã€‚</p><h4 id="èµ„æ–™å‡†å¤‡"><a href="#èµ„æ–™å‡†å¤‡" class="headerlink" title="èµ„æ–™å‡†å¤‡"></a>èµ„æ–™å‡†å¤‡</h4><p>4 ä¸ªå…³é”®è¯ï¼šèµ„æ–™ç´ ææ¥æºã€è¯æ˜å®åŠ›ã€PPTç¼–å†™ã€èµ›å‰æ¼”ç»ƒä¸å¿ƒç†è¾…å¯¼</p><p>ç´ ææ¥æºäºâ€œè¿‡å»è´¢å¹´æ€»ç»“ + æ–°è´¢å¹´çš„è§„åˆ’ + æ±‡æŠ¥ææ–™ + åˆ†äº«ææ–™ + é¡¹ç›®æ€»ç»“â€ï¼Œå› ä¸ºç»è¿‡æ²‰æ·€çš„èµ„æ–™æ‰æœ€æœ‰ä»·å€¼ã€‚æœ‰äº†ä¸€äº›ç´ æèµ„æ–™åï¼Œå°±è¦æŠŠæ§å‡†å¤‡é˜¶æ®µçš„æ ¸å¿ƒï¼šé€šè¿‡ç´ æå»è¯æ˜ä½ å…·å¤‡ä¸‹ä¸€èŒçº§æ‰€éœ€è¦çš„èƒ½åŠ›ã€‚</p><p>å›´ç»• 5 ä¸ªç»´åº¦ï¼ˆæ¶æ„èƒ½åŠ›ã€ç»†èŠ‚æŠŠæ§çš„èƒ½åŠ›ã€å·¥ç¨‹çš„èƒ½åŠ›ã€å›¢é˜Ÿçš„èƒ½åŠ›ã€æŠ€æœ¯è§†é‡ï¼‰å»æ¢³ç†å’Œæç‚¼å…³é”®ä¿¡æ¯ï¼Œå‡†å¤‡ç›¸å…³èµ„æ–™ã€‚</p><p>ç¼–å†™ PPT å°†è¯æ˜ä½ èƒ½åŠ›çš„æ¡†æ¶å¯è§†åŒ–ï¼Œçªå‡ºé‡ç‚¹ã€å†…å®¹ç¿”å®ã€æ•°æ®è¯´è¯ã€åŠŸåŠ³å¤§äºè‹¦åŠ³ã€çªå‡ºè‡ªæˆ‘ã€‚</p><p>åœ¨å›¢é˜Ÿå†…éƒ¨è®©æœ‰æåçš„åŒå­¦é¢„æ¼”ä¸€éè‡ªå·±å‡†å¤‡çš„å†…å®¹ï¼Œå…¶ä½™åŒå­¦ä»ä¸­æŒ‡å‡ºå­˜åœ¨çš„é—®é¢˜ï¼ˆæ˜¯å¦ç´§å¼ ã€æ˜¯å¦çªå‡ºäº®ç‚¹â€¦â€¦ï¼‰äº‰å–è®©ä»–è„±ç¨¿ï¼Œé€»è¾‘ä¸¥è°¨ï¼Œå‡å°‘ç´§å¼ æ„Ÿï¼›ä¸€äº›åŒå­¦ä¼šæ ¼å¤–åœ¨æ„æ™‹å‡è¿™ä»¶äº‹ï¼Œæ‚£å¾—æ‚£å¤±ï¼Œæ‰€ä»¥ Leader è¦å¸®ä»–å¹³ç¼“å¿ƒæ€ï¼Œå¸®åŠ©å…¶å»ºç«‹æ­£ç¡®çš„è®¤çŸ¥ï¼šæŠŠæ™‹å‡å½“ä½œä¸€æ¬¡åˆ†äº«å’Œæ€»ç»“ï¼Œå°±å½“æ˜¯å¯¹è¿‡å»ä¸€æ®µæ—¶é—´çš„å›é¡¾ï¼Œä¸ç®¡ç»“æœå¦‚ä½•ï¼Œæ€»æœ‰æ‰€æ”¶è·ã€‚</p><h4 id="æ™‹å‡ç­”è¾©"><a href="#æ™‹å‡ç­”è¾©" class="headerlink" title="æ™‹å‡ç­”è¾©"></a>æ™‹å‡ç­”è¾©</h4><ul><li>æ‹¿ç»“æœçš„èƒ½åŠ›ï¼š æ¸…æ™°çš„å®¢æˆ·ä»·å€¼äº§å‡ºï¼Œæœ‰æ€è€ƒæ²‰æ·€å’Œå¯å¤åˆ¶çš„æ–¹æ³•è®ºï¼›</li><li>ä¸šåŠ¡ç†è§£èƒ½åŠ›ï¼š å®¢æˆ·è§†è§’ã€å‰ç»æ€§æ€è€ƒä¸åˆ¤æ–­ã€å¯ä»¥æŒç»­æå‡å®¢æˆ·ä»·å€¼ã€‚</li></ul><h4 id="ç»“æœå®‰æ’"><a href="#ç»“æœå®‰æ’" class="headerlink" title="ç»“æœå®‰æ’"></a>ç»“æœå®‰æ’</h4><p>æ™‹å‡ç­”è¾©ä¹‹åï¼Œæ— å¤–ä¹ä¸¤ä¸ªç»“æœï¼šæ™‹å‡æˆåŠŸã€å¤±è´¥ã€‚ä½œä¸º Leaderï¼Œä½ éœ€è¦è®©å€™é€‰äººè®¤è¯†åˆ°è¿™ä¸¤ç§ç»“æœï¼Œå¹¶å‘ŠçŸ¥å°½æœ€å¤§çš„åŠªåŠ›ï¼Œè€ƒè™‘æœ€åçš„ç»“æœï¼Œé¿å…å½¢æˆè½å·®ï¼Œå€™é€‰äººç¦»èŒï¼›å¦‚æœå€™é€‰äººæ™‹å‡æˆåŠŸï¼Œç®€å•åº†ç¥è¿‡åï¼Œè¿˜éœ€è¦ä¸ºå…¶æ–°è§’è‰²æ˜ç¡®æ–°çš„è¦æ±‚å’ŒèŒè´£ï¼Œè®©ä»–æœ‰æ›´æ˜ç¡®çš„åŠªåŠ›æ–¹å‘ï¼Œåœ¨å›¢é˜Ÿå†…å‘æŒ¥æ›´å¤§çš„ä½œç”¨ï¼Œä¸è¦æŠŠæ™‹å‡å½“ä½œç»ˆç‚¹ï¼Œè€Œæ˜¯åé¢å·¥ä½œçš„èµ·ç‚¹ã€‚</p><blockquote><p>æ™‹å‡ä¸æ˜¯å¥–åŠ±ï¼Œæ˜¯è´£ä»»ä¸æ‹…å½“ï¼Œæ˜¯ä¸ºæœªæ¥åšçš„äº‹ã€‚</p></blockquote><p><img src="/images/%E5%B8%B8%E8%A7%81%E7%97%9B%E7%82%B9/CioPOWBS8c-AJOCiAAO-OZ0qSJg929.png" alt="æ™‹å‡"></p><h2 id="è·¨å›¢é˜Ÿï¼šæ²¡æœ‰æ±‡æŠ¥çº¿çš„äººå’Œäº‹å°±æ˜¯æ¨ä¸åŠ¨ï¼Ÿ"><a href="#è·¨å›¢é˜Ÿï¼šæ²¡æœ‰æ±‡æŠ¥çº¿çš„äººå’Œäº‹å°±æ˜¯æ¨ä¸åŠ¨ï¼Ÿ" class="headerlink" title="è·¨å›¢é˜Ÿï¼šæ²¡æœ‰æ±‡æŠ¥çº¿çš„äººå’Œäº‹å°±æ˜¯æ¨ä¸åŠ¨ï¼Ÿ"></a>è·¨å›¢é˜Ÿï¼šæ²¡æœ‰æ±‡æŠ¥çº¿çš„äººå’Œäº‹å°±æ˜¯æ¨ä¸åŠ¨ï¼Ÿ</h2><h3 id="è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„éš¾ç‚¹"><a href="#è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„éš¾ç‚¹" class="headerlink" title="è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„éš¾ç‚¹"></a>è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„éš¾ç‚¹</h3><ul><li>æ–¹æ¡ˆæ— æ³•è¾¾æˆä¸€è‡´ï¼š ä½ æå‡ºçš„ A æ–¹æ¡ˆä¸è¿è¥å›¢é˜Ÿæå‡ºçš„ B æ–¹æ¡ˆï¼Œåœ¨å®ç°æˆæœ¬ã€æ–¹å¼ã€èµ„æºç­‰æ–¹é¢å­˜åœ¨å¾ˆæ˜æ˜¾å·®å¼‚ï¼Œé™·å…¥åƒµå±€ã€‚</li><li>æ—¶é—´æ— æ³•è¾¾æˆä¸€è‡´ï¼š åä½œæ–¹èµåŒ A æ–¹æ¡ˆï¼Œä½†å¯¹â€œä¸€å‘¨ä¸Šçº¿é¡¹ç›®â€çš„æ—¶é—´èŠ‚ç‚¹æœ‰æ„è§ï¼Œè®¤ä¸ºè‡³å°‘éœ€è¦ 20 å¤©ï¼Œè¿™ä¼šä»â€œæ—¶é—´æ— æ³•è¾¾æˆä¸€è‡´â€å›æ»šåˆ°â€œæ–¹æ¡ˆæ— æ³•è¾¾æˆä¸€è‡´â€ï¼Œé™·å…¥æ–°ä¸€è½®åƒµå±€ã€‚</li><li>ä¼˜å…ˆçº§æ— æ³•è¾¾æˆä¸€è‡´ï¼š åä½œæ–¹èµåŒ A æ–¹æ¡ˆï¼Œå¯¹é¡¹ç›®ç”¨æ—¶ä¸€å‘¨ä¹Ÿæ— å¼‚è®®ï¼Œä½†è¯¥é¡¹ç›®ä¼˜å…ˆçº§åœ¨ä»–é‚£å„¿æ²¡æœ‰æåˆ°å¾ˆé«˜ï¼Œä¸€ç›´æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„é¡¹ç›®æ’é˜Ÿï¼Œå¯¼è‡´äº¤ä»˜æ—¶é—´ä¸€å˜å†å˜ã€ä¸€æ‹–å†æ‹–ã€‚</li><li>é˜¶æ®µæ€§äº¤ä»˜ç»“æœä¸ä¸€è‡´ï¼š å› ä¸ºæŸäº›åŸå› ï¼ˆçº¿ä¸Šçªå‘çŠ¶å†µã€åŒå­¦è¯·å‡ã€äººå‘˜èƒ½åŠ›è¾ƒå·®â€¦â€¦ï¼‰ï¼Œä¸ä½ åä½œå›¢é˜Ÿåœ¨é…åˆæ—¶äº¤ä»˜ä½ çš„ç»“æœè´¨é‡æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¿è¥ç»™çš„æ–¹æ¡ˆæœ‰å¾ˆå¤§æ¼æ´ã€æŠ€æœ¯ç»™çš„æ¥å£ Bug æ¯”åŠŸèƒ½ç‚¹è¿˜å¤šï¼Œä½ åˆæ— æ³•ç›´æ¥ç®¡ç†å¯¹æ–¹å›¢é˜Ÿçš„æˆå‘˜ï¼Œæœ€ç»ˆå³ä½¿æ›´æ­£äº†ä¹Ÿå¯èƒ½æµªè´¹äº†é¢å¤–çš„æ—¶é—´ã€‚</li></ul><p>éš¾ç‚¹äº§ç”Ÿçš„åŸå› ï¼š</p><ul><li><p>åä½œæ–¹ä¸æ¸…æ¥šé¡¹ç›®åŸå› å’Œæ„ä¹‰ï¼Œä¼šä¼˜å…ˆè€ƒè™‘è‡ªèº«åˆ©ç›Šï¼Œæ ¹æ®åˆ©ç›Šé«˜ä½æ¨è¿›éš¾åº¦ç”±æ˜“åˆ°éš¾</p></li><li><p>åä½œæ–¹æœ‰è‡ªå·±å½“å‰çš„å·¥ä½œå†…å®¹å’Œä¼˜å…ˆçº§ï¼Œçªç„¶é…åˆè¿›è¡Œå…¶ä»–äº‹åŠ¡ï¼Œå¼•å…¥çš„é£é™©å¾€å¾€è¾ƒé«˜</p></li><li><p>å„éƒ¨é—¨å¯¹å½¼æ­¤ä¹‹é—´çš„å·¥ä½œæ–¹å¼ã€å›¢é˜Ÿç»éªŒä»¥åŠå½“å‰ç°çŠ¶å¾€å¾€ä¸äº†è§£</p></li><li><p>ä»»åŠ¡ç»†åŒ–ï¼Œè·¨å›¢é˜Ÿåˆä½œå—æ—¶é—´ã€ç©ºé—´ç­‰å› ç´ å½±å“æ²Ÿé€šæˆæœ¬è¾ƒé«˜ï¼Œæœ‰äº›é—®é¢˜ä¸çŸ¥é“è¯¥æ‰¾è°</p></li></ul><h3 id="è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸºæœ¬æ€åº¦"><a href="#è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸºæœ¬æ€åº¦" class="headerlink" title="è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸºæœ¬æ€åº¦"></a>è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸºæœ¬æ€åº¦</h3><ol><li>ä¸è¦åšæƒ…ç»ªçš„å¥´éš¶ï¼Œå…ˆæ‰¾è‡ªå·±çš„é—®é¢˜</li><li>å¿«åˆ€æ–©ä¹±éº»ï¼Œé¿å…å› å¤æ‚çš„é—®é¢˜é™·å…¥æ²¼æ³½</li><li>æ…¢æ€è€ƒï¼Œå¿«æ‰§è¡Œ</li></ol><p>å€ŸåŠ›å‰è¡Œï¼Œæ‘†äº‹å®è®²é“ç†ï¼Œå‡­èŒçº§ï¼Œè¡Œè¿›åŠæ³•ï¼Œè¾¾æˆç›®æ ‡ã€‚</p><h3 id="è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸåˆ™æ–¹æ³•"><a href="#è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸåˆ™æ–¹æ³•" class="headerlink" title="è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸåˆ™æ–¹æ³•"></a>è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸåˆ™æ–¹æ³•</h3><ul><li>åˆä½œå‰ï¼ˆæ˜ç¡®ç›®æ ‡ï¼Œç¡®ä¿ä¿¡æ¯å®Œæ•´ï¼‰</li><li>åˆä½œä¸­ï¼ˆå®šä½é—®é¢˜ï¼Œå€ŸåŠ¿è€Œä¸ºï¼‰</li><li>åˆä½œåï¼ˆæ‰¿æ‹…è´£ä»»ï¼Œå…¬å¼€è‚¯å®šï¼‰</li></ul><p>æ¢ä½æ€è€ƒã€æ‘†äº‹å®ã€è®²é“ç†ã€å‡­èŒçº§ã€å€ŸåŠ¿è€Œè¡Œã€æƒ³å°½åŠæ³•è¾¾æˆç›®æ ‡ã€‚</p><h2 id="åšè§„åˆ’ï¼šé™¤äº†äº¤ä»˜å’Œç¨³å®šæ€§ï¼Œè¿˜è¦è§„åˆ’ä»€ä¹ˆï¼Ÿ"><a href="#åšè§„åˆ’ï¼šé™¤äº†äº¤ä»˜å’Œç¨³å®šæ€§ï¼Œè¿˜è¦è§„åˆ’ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åšè§„åˆ’ï¼šé™¤äº†äº¤ä»˜å’Œç¨³å®šæ€§ï¼Œè¿˜è¦è§„åˆ’ä»€ä¹ˆï¼Ÿ"></a>åšè§„åˆ’ï¼šé™¤äº†äº¤ä»˜å’Œç¨³å®šæ€§ï¼Œè¿˜è¦è§„åˆ’ä»€ä¹ˆï¼Ÿ</h2><p>å›¢é˜Ÿè§„åˆ’è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼šè®©ä½ åœ¨æœ‰é™çš„æ—¶é—´å’Œèµ„æºå†…ï¼Œæ˜ç¡®æ€ä¹ˆå»åˆ›é€ æœ€å¤§çš„æŠ€æœ¯ä»·å€¼ï¼ˆROIï¼‰ã€‚è€Œä¸”åœ¨åšå›¢é˜Ÿè§„åˆ’çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®æ˜¯ä¸€ä¸ªæ·±å…¥æ€è€ƒã€æ¢³ç†çš„è¿‡ç¨‹ï¼Œä½ å¯ä»¥å¤ç›˜è¿‡å»ã€æ¢³ç†å½“ä¸‹ã€å±•æœ›æœªæ¥ï¼Œå°‘èµ°å¼¯è·¯ã€‚</p><h3 id="åšè§„åˆ’è¦è€ƒè™‘å›¢é˜Ÿç°çŠ¶"><a href="#åšè§„åˆ’è¦è€ƒè™‘å›¢é˜Ÿç°çŠ¶" class="headerlink" title="åšè§„åˆ’è¦è€ƒè™‘å›¢é˜Ÿç°çŠ¶"></a>åšè§„åˆ’è¦è€ƒè™‘å›¢é˜Ÿç°çŠ¶</h3><ol><li>æ˜ç¡®å®šä½ä¸èŒè´£</li><li>äººå‘˜æƒ…å†µ</li><li>ä¸šåŠ¡æƒ…å†µ</li></ol><p>ä¸€ä¸ªå¯ä»¥å‚è€ƒçš„æ€è·¯æ˜¯ï¼š ç›¯ç€ä¸šåŠ¡ç›®æ ‡å»å»¶å±•äººå‘˜å’Œä¸šåŠ¡ï¼Œä»è€Œåˆ¤æ–­å“ªäº›æ˜¯ä¾èµ–é¡¹ï¼Œå“ªäº›æ˜¯å‰ç½®é¡¹ï¼Ÿåœ¨å¤§éƒ¨åˆ†å…¬å¸ä¸­ï¼ŒæŠ€æœ¯å¾ˆéš¾ç›´æ¥åˆ›é€ å•†ä¸šä»·å€¼ï¼Œå¾€å¾€è¿˜æ˜¯è¦ä¾èµ–äºä¸šåŠ¡ï¼Œæ‰€ä»¥æŠŠä¸šåŠ¡ä½œä¸ºç¬¬ä¸€ç›®æ ‡ï¼Œä¸ºäº†è¾¾æˆæŸä¸ªä¸šåŠ¡ç»“æœï¼Œéœ€è¦è°ƒæ•´äººå‘˜ç»“æ„ï¼Œæ‹›è˜ä¸€äº›æ›´å‰å®³çš„äººæ±°æ¢ä¸€äº›ä¸è¡Œçš„äººï¼Œç ”ç©¶å¹¶å®ç°ä¸€äº›æ–°æŠ€æœ¯ï¼Œè¿™æ˜¯æ¯”è¾ƒè‡ªç„¶çš„ã€‚</p><h3 id="ä½ çš„è§„åˆ’ä¸­åŒ…å«äº†ä»€ä¹ˆï¼Ÿ"><a href="#ä½ çš„è§„åˆ’ä¸­åŒ…å«äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä½ çš„è§„åˆ’ä¸­åŒ…å«äº†ä»€ä¹ˆï¼Ÿ"></a>ä½ çš„è§„åˆ’ä¸­åŒ…å«äº†ä»€ä¹ˆï¼Ÿ</h3><p>ä¸åŒçš„æŠ€æœ¯å›¢é˜Ÿï¼Œåœ¨è§„åˆ’æ—¶æ‰€æ‹Ÿå®šçš„å†…å®¹éƒ½æ˜¯ä¸åŒçš„ï¼Œä½†ä½ å…¶å®éƒ½å¯ä»¥æç‚¼æˆå…±æ€§çš„3 éƒ¨åˆ†ã€‚</p><ul><li><p>ä¸šåŠ¡ç»“æœï¼š ç›´ç™½è¯´å°±æ˜¯ä¸šåŠ¡å±‚é¢çš„æˆ˜ç»©ï¼Œä½ å›¢é˜Ÿæ‰“é€ äº†ä¸€ä¸ªå…¬å¸ GMV å æ¯”è¶…è¿‡ 50%çš„å•†åŸï¼Œæˆ–è€…æ”¯æ’‘äº†æŸä¸ªå¿«é€Ÿå‘å±•ä¸šåŠ¡ï¼Œè¿™äº›éƒ½æ˜¯ä¸šåŠ¡ç»“æœï¼Œç”¨ä¸šåŠ¡æ•°å­—æ¥è¯´è¯ã€‚</p></li><li><p>æŠ€æœ¯åˆ›æ–°ï¼š ç”±æŠ€æœ¯äººå‘˜å‘èµ·æˆ–å®Œæˆçš„æ‰€æœ‰é™æœ¬ææ•ˆçš„åŠ¨ä½œï¼Œä½†æ˜¯åŒæ ·è¦çœ‹ä¼˜å…ˆçº§å’ŒæŠ•å…¥äº§å‡ºæ¯”ã€‚</p></li><li><p>å›¢é˜Ÿå»ºè®¾ï¼š è®©å›¢é˜Ÿå¯ä»¥é•¿æœŸå¥åº·å‘å±•ä¸‹å»ï¼Œè¦åœ¨ Backupã€äººå‘˜ç»„æˆã€æœºåˆ¶å»ºè®¾ç­‰å¤šä¸ªæ–¹é¢ä¸‹åŠŸå¤«ã€‚</p></li></ul><p>è‡ªé—®ï¼š</p><ul><li><p>WHYï¼šä¸ºä»€ä¹ˆåšä¸šåŠ¡ç›®æ ‡/æŠ€æœ¯åˆ›æ–°/å›¢é˜Ÿå»ºè®¾çš„è§„åˆ’ï¼Ÿ</p></li><li><p>WHATï¼šæ˜¯å¦èƒ½è¯´æ˜ä¸šåŠ¡ç›®æ ‡/æŠ€æœ¯åˆ›æ–°/å›¢é˜Ÿå»ºè®¾è§„åˆ’è§£å†³çš„é—®é¢˜ã€ä»·å€¼ä¸ä½œç”¨ï¼Ÿ</p></li><li><p>WHOï¼šç”±è°æ‰¿æ‹…ï¼Ÿè´Ÿè´£äººçš„ä¼˜åŠ¿ä¸è·ŒåŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>WHENï¼šæ‰€åšçš„è§„åˆ’ç€çœ¼äºç°åœ¨è¿˜æ˜¯æœªæ¥ï¼Ÿèƒ½å¦ä¿è¯é•¿æœŸæœ‰ä»·å€¼ï¼Ÿ</p></li><li><p>HOWï¼šé’ˆå¯¹ä¸åŒçš„éƒ¨åˆ†ï¼Œå…·ä½“çš„è½åœ°ç»†åˆ™å¦‚ä½•ï¼Ÿ</p></li><li><p>HOW MUCHï¼šè§„åˆ’è¦åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Ÿæ˜¯å¦å¯ä»¥å½¢æˆå¯è¡¡é‡çš„KPIï¼Ÿ</p></li></ul><h3 id="ä¸šåŠ¡ç»“æœ"><a href="#ä¸šåŠ¡ç»“æœ" class="headerlink" title="ä¸šåŠ¡ç»“æœ"></a>ä¸šåŠ¡ç»“æœ</h3><p>ä½ è¦æ˜ç¡®ç°é˜¶æ®µä¸Šçº§é¢†å¯¼å…³æ³¨çš„é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯è½¬åŒ–ã€æµé‡ã€ç•™å­˜ã€è¿˜æ˜¯äº§å“çš„ç”¨æˆ·ä½“éªŒï¼Ÿä½œä¸ºæŠ€æœ¯Leader ï¼Œä½ å’Œå›¢é˜Ÿæˆå‘˜çš„åˆ°è¾¾è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯çº¿ç´¢æ¥æºä¹‹ä¸€ã€‚</p><h3 id="æŠ€æœ¯åˆ›æ–°"><a href="#æŠ€æœ¯åˆ›æ–°" class="headerlink" title="æŠ€æœ¯åˆ›æ–°"></a>æŠ€æœ¯åˆ›æ–°</h3><p>ç¨³å®šæ€§ã€æ•ˆèƒ½ä¼˜åŒ–ã€é©±åŠ¨ä¸šåŠ¡ã€è§†é‡å±•æœ›</p><h3 id="å›¢é˜Ÿå»ºè®¾"><a href="#å›¢é˜Ÿå»ºè®¾" class="headerlink" title="å›¢é˜Ÿå»ºè®¾"></a>å›¢é˜Ÿå»ºè®¾</h3><p>å›¢é˜Ÿå»ºè®¾çš„å…³é”®ä¸åªæ˜¯çŸ¥äººå–„ç”¨ï¼Œè€Œæ˜¯ï¼š</p><ol><li><p>å›¢é˜Ÿæœªæ¥éœ€è¦ä»€ä¹ˆæ ·çš„äººï¼Ÿ</p></li><li><p>ç›®å‰å›¢é˜Ÿæˆå‘˜éœ€è¦ä»€ä¹ˆæ ·çš„çŠ¶æ€å’Œèƒ½åŠ›ï¼Ÿ</p></li><li><p>å›¢é˜Ÿæˆå‘˜éœ€è¦æ‰¿æ‹…ä»€ä¹ˆæ ·çš„è´£ä»»ï¼Ÿ</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œä½ å¸Œæœ›æœªæ¥è‡ªå·±çš„å›¢é˜Ÿæˆä¸ºæ€æ ·çš„å›¢é˜Ÿï¼Ÿä»¥æ­¤æ¨å¯¼ç¦»ç†æƒ³çŠ¶æ€å¤šè¿œï¼Ÿæ€ä¹ˆç¼©å°å·®è·ï¼Ÿ</p><h3 id="è§„åˆ’è½åœ°æ—¶çš„é—®é¢˜ä¸æ€è·¯"><a href="#è§„åˆ’è½åœ°æ—¶çš„é—®é¢˜ä¸æ€è·¯" class="headerlink" title="è§„åˆ’è½åœ°æ—¶çš„é—®é¢˜ä¸æ€è·¯"></a>è§„åˆ’è½åœ°æ—¶çš„é—®é¢˜ä¸æ€è·¯</h3><p>å®¹æ˜“å‡ºç°çš„é—®é¢˜ï¼š</p><ol><li>è§„åˆ’ä¸ç­‰äºè®¡åˆ’</li><li>è§„åˆ’å†…å®¹æƒ³å¾—å¤ªå¤šï¼Œåšæˆçš„å°‘</li><li>ä¸šåŠ¡å‹åŠ›å¤§ï¼Œç›²ç›¯ç—›ç‚¹ï¼Œå¿½è§†ç›®æ ‡</li><li>è§„åˆ’æœ€ç»ˆæˆäº†æŠ€æœ¯Leaderçš„è§„åˆ’</li></ol><p>åšå›¢é˜Ÿè§„åˆ’æ˜¯ä¸€ä»¶æ¯”è¾ƒç»¼åˆå®è§‚çš„äº‹æƒ…ï¼Œæœ‰æ—¶å“ªæ€•åªæ˜¯å‡ ä¸ªäººçš„å›¢é˜Ÿï¼Œæƒ³åšå¥½ä¸€ä»½è§„åˆ’è€Œéæ‰§è¡Œè®¡åˆ’ä¹Ÿå¾ˆè€ƒéªŒ Leader çš„æ€è€ƒæ·±åº¦ï¼ŒæŸç§ç¨‹åº¦æ¥è¯´ï¼Œè§„åˆ’æ˜¯ä½ å®šä¹‰ä¸€ç¾¤äººåœ¨æœªæ¥ä¸€æ®µæ—¶é—´å†…åšä»€ä¹ˆã€æ€ä¹ˆåšã€æœ€ç»ˆå˜æˆä»€ä¹ˆæ ·ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è€ƒé‡çš„ç‚¹éå¸¸å¤šï¼Œè¿™äº›æ·±å…¥çš„æ€è€ƒä¹Ÿä¼šä¿ƒè¿›ä½ æ—¥å¸¸çš„ä¸€äº›è¡Œä¸ºå’Œç»“æœï¼Œå¯¹äºå›¢é˜Ÿçš„å­£åº¦ä¹ƒè‡³åŠå¹´è§„åˆ’æˆ‘æ˜¯éå¸¸æ¨èä½ è¦å®šæœŸæ¢³ç†å¹¶è½åœ°çš„ï¼Œæœ‰ç›®æ ‡å’Œæ²¡ç›®æ ‡çš„å›¢é˜Ÿï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤§çš„å·®åˆ«çš„ã€‚</p><p><img src="/images/%E5%B8%B8%E8%A7%81%E7%97%9B%E7%82%B9/Cgp9HWBcUYKAHXrjAAHoV4ZOizs520.png" alt="åšè§„åˆ’"></p><h2 id="æ¥æ‰‹æ–°å›¢é˜Ÿï¼šå£«æ°”ä½ã€äº¤ä»˜è¿Ÿã€äº‹æ•…å¤šå‘ï¼Œå¦‚ä½•ä¸‹æ‰‹è§£å†³ï¼Ÿ"><a href="#æ¥æ‰‹æ–°å›¢é˜Ÿï¼šå£«æ°”ä½ã€äº¤ä»˜è¿Ÿã€äº‹æ•…å¤šå‘ï¼Œå¦‚ä½•ä¸‹æ‰‹è§£å†³ï¼Ÿ" class="headerlink" title="æ¥æ‰‹æ–°å›¢é˜Ÿï¼šå£«æ°”ä½ã€äº¤ä»˜è¿Ÿã€äº‹æ•…å¤šå‘ï¼Œå¦‚ä½•ä¸‹æ‰‹è§£å†³ï¼Ÿ"></a>æ¥æ‰‹æ–°å›¢é˜Ÿï¼šå£«æ°”ä½ã€äº¤ä»˜è¿Ÿã€äº‹æ•…å¤šå‘ï¼Œå¦‚ä½•ä¸‹æ‰‹è§£å†³ï¼Ÿ</h2><p>è™½ç„¶æ¥æ‰‹ä¸€ä¸ªé—®é¢˜å›¢é˜Ÿå¾ˆéš¾ï¼Œè¦å¤„ç†å¾ˆå¤šé—®é¢˜å¹¶ä¸”éå¸¸è¾›è‹¦ï¼Œä½†æ˜¯å¯¹ä¸€ä¸ª Leader çš„é”»ç‚¼ä¹Ÿæ˜¯æ— ä¸ä¼¦æ¯”çš„ï¼Œæˆ‘è§è¿‡å‡ ä¹æ‰€æœ‰ä¼˜ç§€çš„æŠ€æœ¯ Leader éƒ½æ˜¯ä¸€æ¬¡æ¬¡è¿™æ ·ç£¨ç‚¼å‡ºæ¥çš„ã€‚æ¯•ç«ŸæŠ€æœ¯ç®¡ç†èƒ½åŠ›å¾ˆé‡è¦çš„ä¸€ä¸ªè½åœ°åœºæ™¯å°±æ˜¯è¿™ç§æƒ…å†µï¼Œä¹Ÿæ˜¯æœ€èƒ½å‘æŒ¥æŠ€æœ¯ Leader ç®¡ç†èƒ½åŠ›ä»·å€¼çš„åœºæ™¯ä¹‹ä¸€ã€‚</p><p><img src="/images/%E5%B8%B8%E8%A7%81%E7%97%9B%E7%82%B9/Cgp9HWBhhzyAIeYyAAGwGD_IRZw948.png" alt="æ–°å›¢é˜Ÿ"></p>]]></content>
    
    
    <categories>
      
      <category>reading</category>
      
    </categories>
    
    
    <tags>
      
      <tag>reading</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitçŸ¥è¯†æ±‡æ€»</title>
    <link href="/2021/02/13/310/"/>
    <url>/2021/02/13/310/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><h2 id="4ä¸ªåŒº"><a href="#4ä¸ªåŒº" class="headerlink" title="4ä¸ªåŒº"></a>4ä¸ªåŒº</h2><p>gitä¹‹æ‰€ä»¥ä»¤äººè´¹è§£ï¼Œä¸»è¦æ˜¯å®ƒç›¸æ¯”äºsvnç­‰ç­‰ä¼ ç»Ÿçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå¤šå¼•å…¥äº†ä¸€ä¸ªæš‚å­˜åŒº(Stage)çš„æ¦‚å¿µï¼Œå°±å› ä¸ºå¤šäº†è¿™ä¸€ä¸ªæ¦‚å¿µï¼Œè€Œä½¿å¾ˆå¤šäººç–‘æƒ‘ã€‚å…¶å®ï¼Œåœ¨åˆå­¦è€…æ¥è¯´ï¼Œæ¯ä¸ªåŒºå…·ä½“æ€ä¹ˆå·¥ä½œçš„ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦å…³å¿ƒï¼Œè€Œåªè¦çŸ¥é“æœ‰è¿™ä¹ˆ4ä¸ªåŒºå°±å¤Ÿäº†ï¼š</p><ul><li>å·¥ä½œåŒº(Working Area)</li><li>æš‚å­˜åŒº(Stage)</li><li>æœ¬åœ°ä»“åº“(Local Repository)</li><li>è¿œç¨‹ä»“åº“(Remote Repository)</li></ul><h2 id="5ç§çŠ¶æ€"><a href="#5ç§çŠ¶æ€" class="headerlink" title="5ç§çŠ¶æ€"></a>5ç§çŠ¶æ€</h2><p>ä»¥ä¸Š4ä¸ªåŒºï¼Œè¿›å…¥æ¯ä¸€ä¸ªåŒºæˆåŠŸä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªçŠ¶æ€ï¼Œå†åŠ ä¸Šæœ€åˆå§‹çš„ä¸€ä¸ªçŠ¶æ€ï¼Œä¸€å…±æ˜¯5ç§çŠ¶æ€ã€‚ä»¥ä¸‹æˆ‘ä»¬æŠŠè¿™5ç§çŠ¶æ€åˆ†åˆ«å‘½åä¸ºï¼š</p><ul><li>æœªä¿®æ”¹(Origin)</li><li>å·²ä¿®æ”¹(Modified)</li><li>å·²æš‚å­˜(Staged)</li><li>å·²æäº¤(Committed)</li><li>å·²æ¨é€(Pushed)</li></ul><h2 id="æ£€æŸ¥ä¿®æ”¹"><a href="#æ£€æŸ¥ä¿®æ”¹" class="headerlink" title="æ£€æŸ¥ä¿®æ”¹"></a>æ£€æŸ¥ä¿®æ”¹</h2><h3 id="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"><a href="#å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜" class="headerlink" title="å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"></a>å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜</h3><div class="code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">git diff</span></code></pre></div><h3 id="å·²æš‚å­˜ï¼Œæœªæäº¤"><a href="#å·²æš‚å­˜ï¼Œæœªæäº¤" class="headerlink" title="å·²æš‚å­˜ï¼Œæœªæäº¤"></a>å·²æš‚å­˜ï¼Œæœªæäº¤</h3><div class="code-wrapper"><pre><code class="hljs ada">git diff <span class="hljs-comment">--cached</span></code></pre></div><h3 id="å·²æäº¤ï¼Œæœªæ¨é€"><a href="#å·²æäº¤ï¼Œæœªæ¨é€" class="headerlink" title="å·²æäº¤ï¼Œæœªæ¨é€"></a>å·²æäº¤ï¼Œæœªæ¨é€</h3><div class="code-wrapper"><pre><code class="hljs crmsh">git diff <span class="hljs-keyword">master</span> <span class="hljs-title">origin</span>/<span class="hljs-literal">master</span></code></pre></div><h2 id="æ’¤é”€ä¿®æ”¹"><a href="#æ’¤é”€ä¿®æ”¹" class="headerlink" title="æ’¤é”€ä¿®æ”¹"></a>æ’¤é”€ä¿®æ”¹</h2><p>äº†è§£æ¸…æ¥šå¦‚ä½•æ£€æŸ¥å„ç§ä¿®æ”¹ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å°è¯•å„ç§æ’¤é”€æ“ä½œã€‚</p><h3 id="æ¢å¤å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"><a href="#æ¢å¤å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜" class="headerlink" title="æ¢å¤å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜"></a>æ¢å¤å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜</h3><p>å¦‚æœæˆ‘ä»¬åªæ˜¯åœ¨ç¼–è¾‘å™¨é‡Œä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œ<code>git add .</code>ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„æ–‡ä»¶è¿˜åœ¨<code>å·¥ä½œåŒº</code>ï¼Œå¹¶æ²¡æœ‰è¿›å…¥<code>æš‚å­˜åŒº</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ’¤é”€æ“ä½œ</p><div class="code-wrapper"><pre><code class="hljs erlang">git checkout .</code></pre></div><p>æˆ–è€…</p><div class="code-wrapper"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard</span></code></pre></div><h3 id="æ¢å¤å·²æš‚å­˜ï¼Œæœªæäº¤"><a href="#æ¢å¤å·²æš‚å­˜ï¼Œæœªæäº¤" class="headerlink" title="æ¢å¤å·²æš‚å­˜ï¼Œæœªæäº¤"></a>æ¢å¤å·²æš‚å­˜ï¼Œæœªæäº¤</h3><p>ä½ å·²ç»æ‰§è¡Œäº†<code>git add .</code>ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œ<code>git commit -m &quot;comment&quot;</code>ã€‚è¿™æ—¶å€™ä½ æ„è¯†åˆ°äº†é”™è¯¯ï¼Œæƒ³è¦æ’¤é”€ï¼Œä½ å¯ä»¥æ‰§è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs erlang">git resetgit checkout .</code></pre></div><p>æˆ–è€…</p><div class="code-wrapper"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard</span></code></pre></div><p><code>git reset</code>åªæ˜¯æŠŠä¿®æ”¹é€€å›åˆ°äº†<code>git add .</code>ä¹‹å‰çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶æœ¬èº«è¿˜å¤„äº<code>å·²ä¿®æ”¹æœªæš‚å­˜</code>çŠ¶æ€ï¼Œä½ å¦‚æœæƒ³é€€å›<code>æœªä¿®æ”¹</code>çŠ¶æ€ï¼Œè¿˜éœ€è¦æ‰§è¡Œ<code>git checkout .</code>ã€‚</p><p>æˆ–è®¸ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤éƒ½å¯ä»¥ç”¨åŒä¸€ä¸ªå‘½ä»¤<code>git reset --hard</code>æ¥å®Œæˆã€‚æ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¸ªå¼ºå¤§çš„å‘½ä»¤ï¼Œå¯ä»¥ä¸€æ­¥åˆ°ä½åœ°æŠŠä½ çš„ä¿®æ”¹å®Œå…¨æ¢å¤åˆ°<code>æœªä¿®æ”¹</code>çš„çŠ¶æ€ã€‚</p><h3 id="æ¢å¤å·²æäº¤ï¼Œæœªæ¨é€"><a href="#æ¢å¤å·²æäº¤ï¼Œæœªæ¨é€" class="headerlink" title="æ¢å¤å·²æäº¤ï¼Œæœªæ¨é€"></a>æ¢å¤å·²æäº¤ï¼Œæœªæ¨é€</h3><p>ä½ çš„æ‰‹å¤ªå¿«ï¼Œä½ æ—¢æ‰§è¡Œäº†<code>git add .</code>ï¼Œåˆæ‰§è¡Œäº†<code>git commit</code>ï¼Œè¿™æ—¶å€™ä½ çš„ä»£ç å·²ç»è¿›å…¥äº†ä½ çš„<code>æœ¬åœ°ä»“åº“</code>ï¼Œç„¶è€Œä½ åæ‚”äº†ï¼Œæ€ä¹ˆåŠï¼Ÿä¸è¦ç€æ€¥ï¼Œè¿˜æœ‰åŠæ³•ã€‚</p><div class="code-wrapper"><pre><code class="hljs maxima">git <span class="hljs-built_in">reset</span> --hard <span class="hljs-built_in">origin</span>/master</code></pre></div><p>è¿˜æ˜¯è¿™ä¸ª<code>git reset --hard</code>å‘½ä»¤ï¼Œåªä¸è¿‡è¿™æ¬¡å¤šäº†ä¸€ä¸ªå‚æ•°<code>origin/master</code>ï¼Œæ­£å¦‚æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„ï¼Œ<code>origin/master</code>ä»£è¡¨<code>è¿œç¨‹ä»“åº“</code>ï¼Œæ—¢ç„¶ä½ å·²ç»æ±¡æŸ“äº†ä½ çš„<code>æœ¬åœ°ä»“åº“</code>ï¼Œé‚£ä¹ˆå°±ä»<code>è¿œç¨‹ä»“åº“</code>æŠŠä»£ç å–å›æ¥å§ã€‚</p><h3 id="å·²æ¨é€"><a href="#å·²æ¨é€" class="headerlink" title="å·²æ¨é€"></a>å·²æ¨é€</h3><p>å¾ˆä¸å¹¸ï¼Œä½ çš„æ‰‹å®åœ¨æ˜¯å¤ªå¿«äº†ï¼Œä½ æ—¢<code>git add</code>äº†ï¼Œåˆ<code>git commit</code>äº†ï¼Œå¹¶ä¸”è¿˜<code>git push</code>äº†ï¼Œè¿™æ—¶ä½ çš„ä»£ç å·²ç»è¿›å…¥<code>è¿œç¨‹ä»“åº“</code>ã€‚å¦‚æœä½ æƒ³æ¢å¤çš„è¯ï¼Œè¿˜å¥½ï¼Œç”±äºä½ çš„<code>æœ¬åœ°ä»“åº“</code>å’Œ<code>è¿œç¨‹ä»“åº“</code>æ˜¯ç­‰ä»·çš„ï¼Œä½ åªéœ€è¦å…ˆæ¢å¤<code>æœ¬åœ°ä»“åº“</code>ï¼Œå†å¼ºåˆ¶<code>push</code>åˆ°<code>è¿œç¨‹ä»“åº“</code>å°±å¥½äº†ï¼š</p><div class="code-wrapper"><pre><code class="hljs maxima">git <span class="hljs-built_in">reset</span> --hard HEAD^git <span class="hljs-built_in">push</span> -f</code></pre></div><p>éƒ¨åˆ†è¿œç¨‹ä»“åº“è®¾ç½®äº†ç¦æ­¢å¼ºåˆ¶pushï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ã€‚</p><h4 id="revert"><a href="#revert" class="headerlink" title="revert"></a>revert</h4><p>git revertç”¨äºåè½¬æäº¤ã€‚æ‰§è¡Œrevertå‘½ä»¤æ—¶è¦æ±‚å·¥ä½œæ ‘å¿…é¡»æ˜¯å¹²å‡€çš„ï¼Œgit revertç”¨ä¸€ä¸ªæ–°æäº¤æ¥æ¶ˆé™¤ä¸€ä¸ªå†å²æäº¤æ‰€åšçš„ä»»ä½•ä¿®æ”¹ã€‚revert ä¹‹åä½ çš„æœ¬åœ°ä»£ç ä¼šå›æ»šåˆ°æŒ‡å®šçš„å†å²ç‰ˆæœ¬ï¼Œè¿™æ—¶ä½ å† git push å°±å¯ä»¥æŠŠçº¿ä¸Šçš„ä»£ç æ›´æ–°ã€‚</p><h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>git clone</td><td>å…‹éš†</td></tr><tr><td>git branch (åˆ†æ”¯å)</td><td>åˆ›å»ºåˆ†æ”¯ -Dåˆ é™¤åˆ†æ”¯</td></tr><tr><td>git checkout (åˆ†æ”¯å)</td><td>åˆ‡æ¢åˆ†æ”¯ -båˆ›å»ºå¹¶åˆ‡æ¢</td></tr><tr><td>git checkout (æ–‡ä»¶å)</td><td>æ’¤é”€æ­¤æ–‡ä»¶ä¿®æ”¹</td></tr><tr><td>git add</td><td>å°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜</td></tr><tr><td>git status</td><td>æŸ¥çœ‹åœ¨ä½ ä¸Šæ¬¡æäº¤ä¹‹åæ˜¯å¦æœ‰ä¿®æ”¹</td></tr><tr><td>git commit</td><td>å°†ç¼“å­˜åŒºå†…å®¹æ·»åŠ åˆ°ä»“åº“ä¸­</td></tr><tr><td>git diff</td><td>æ¥æŸ¥çœ‹æ‰§è¡Œ git status çš„ç»“æœçš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>git reset HEAD</td><td>å‘½ä»¤ç”¨äºå–æ¶ˆå·²ç¼“å­˜çš„å†…å®¹</td></tr><tr><td>git rm æ–‡ä»¶</td><td>åˆ é™¤æ–‡ä»¶-få¼ºåˆ¶åˆ é™¤</td></tr><tr><td>git mv</td><td>ç§»åŠ¨æ–‡ä»¶</td></tr><tr><td>git merge</td><td>åˆå¹¶åˆ†æ”¯</td></tr><tr><td>git fetch</td><td>ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°</td></tr><tr><td>git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;:&lt;è¿œç¨‹åˆ†æ”¯å&gt;</td><td>å°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°ï¼Œæ¨é€åˆ°è¿œç¨‹ä¸»æœº</td></tr><tr><td>git push origin â€“delete test</td><td>åˆ é™¤è¿œç¨‹åˆ†æ”¯test</td></tr><tr><td>git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;</td><td>å°†è¿œç¨‹å­˜å‚¨åº“ä¸­çš„æ›´æ”¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­</td></tr><tr><td>git rebase</td><td>å‘½ä»¤åœ¨å¦ä¸€ä¸ªåˆ†æ”¯åŸºç¡€ä¹‹ä¸Šé‡æ–°åº”ç”¨ï¼Œç”¨äºæŠŠä¸€ä¸ªåˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚</td></tr><tr><td>git log</td><td>å‘½ä»¤ç”¨äºæ˜¾ç¤ºæäº¤æ—¥å¿—ä¿¡æ¯ã€‚</td></tr><tr><td>git reflog</td><td>æ˜¾ç¤ºæ¯ä¸€æ¬¡å‘½ä»¤</td></tr><tr><td>git revert</td><td>ç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤é”€æŸæ¬¡æäº¤ï¼Œæ­¤æ¬¡æäº¤ä¹‹å‰çš„commitéƒ½ä¼šè¢«ä¿ç•™</td></tr><tr><td>git reset HEAD <file></td><td>å¦‚æœå‘ç°é”™è¯¯çš„å°†ä¸æƒ³æš‚å­˜çš„æ–‡ä»¶è¢«git addè¿›å…¥ç´¢å¼•ä¹‹åï¼Œæƒ³å›é€€å–æ¶ˆï¼Œåˆ™å¯ä»¥ä½¿ç”¨</td></tr></tbody></table><p>è®¾ç½®ç”¨æˆ·åé‚®ç®±ï¼š</p><blockquote><p>git config â€“global <a href="http://user.name/">user.name</a> â€œ13saiâ€</p></blockquote><blockquote><p>git config â€“global user.email <a href="http://mailto:%22957042781@qq.com/">â€œ957042781@qq.com</a>â€œ</p></blockquote><h3 id="å‡ ä¸ªå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#å‡ ä¸ªå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å‡ ä¸ªå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>å‡ ä¸ªå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3><div class="code-wrapper"><pre><code class="hljs gams">fatal: <span class="hljs-keyword">No</span> configured push destination.è§£å†³ï¼š<span class="hljs-symbol">$</span> git remote add -f -t master -m master origin git:<span class="hljs-comment">//example.com/git.git/</span>fatal: The current branch test has <span class="hljs-keyword">no</span> upstream branch.è§£å†³ï¼šgit push --<span class="hljs-keyword">set</span>-upstream <span class="hljs-comment">origin test</span>æ¨¡ä»¿ git <span class="hljs-comment">clone</span>ï¼Œä½†åªè·Ÿè¸ªé€‰å®šçš„åˆ†æ”¯$ mkdir <span class="hljs-comment">project.git</span>$ cd <span class="hljs-comment">project.git</span>$ git <span class="hljs-comment">init</span>$ git <span class="hljs-comment">remote add -f -t master -m master origin git:</span>//<span class="hljs-comment">example.com</span>/git.git/$ git <span class="hljs-comment">merge origin</span>fatalï¼šUnable <span class="hljs-comment">to create</span> <span class="hljs-comment">&#x27;E:/project/scrm/.git/index.lock&#x27;</span><span class="hljs-comment">: File exists.</span>rm <span class="hljs-comment">-f .</span>/.git/<span class="hljs-comment">index.lock</span>git <span class="hljs-comment">log</span>-p æŸ¥çœ‹å·®å¼‚-n(nä¸ºæ­£æ•´æ•°) æŸ¥çœ‹æœ€è¿‘næ¬¡çš„æäº¤--pretty        æŒ‰æŒ‡å®šæ ¼å¼æ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯<span class="hljs-comment">,</span>å¯é€‰é¡¹æœ‰ï¼š<span class="hljs-comment">oneline,short,medium,full,fuller,email,raw</span>ä»¥åŠ<span class="hljs-comment">format:&lt;string&gt;,</span>é»˜è®¤ä¸º<span class="hljs-comment">medium</span>ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æŒ‡å®šé»˜è®¤çš„æ–¹å¼ã€‚e.g. git <span class="hljs-comment">log (--pretty=)oneline</span>--stat  åˆ—å‡ºæ–‡ä»¶çš„ä¿®æ”¹è¡Œæ•°--sortstat      åªæ˜¾ç¤º<span class="hljs-comment">--stat</span>ä¸­æœ€åè¡Œæ•°ä¿®æ”¹æ·»åŠ ç§»é™¤çš„ç»Ÿè®¡--graph ä»¥ç®€å•çš„å›¾å½¢æ–¹å¼åˆ—å‡ºæäº¤è®°å½•--abbrev-commit ä»…æ˜¾ç¤º <span class="hljs-comment">SHA-1</span> çš„å‰å‡ ä¸ªå­—ç¬¦ï¼Œè€Œéæ‰€æœ‰çš„ <span class="hljs-comment">40</span> ä¸ªå­—ç¬¦ã€‚--relative-date ä½¿ç”¨è¾ƒçŸ­çš„ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆæ¯”å¦‚ï¼Œâ€œ<span class="hljs-comment">2 weeks ago</span>â€ï¼‰ã€‚--name-only ä»…åœ¨æäº¤ä¿¡æ¯åæ˜¾ç¤ºå·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•ã€‚--name-status æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶æ¸…å•ã€‚</code></pre></div><h4 id="åˆ—å‡ºtag"><a href="#åˆ—å‡ºtag" class="headerlink" title="åˆ—å‡ºtag"></a>åˆ—å‡ºtag</h4><blockquote><p>git tag # åœ¨æ§åˆ¶å°æ‰“å°å‡ºå½“å‰ä»“åº“çš„æ‰€æœ‰tag</p></blockquote><blockquote><p>git tag -l â€˜v0.1.*â€™ # æœç´¢ç¬¦åˆæ¨¡å¼çš„Tag æ‰“tag</p></blockquote><p>git tagåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šè½»é‡tagå’Œé™„æ³¨tagã€‚è½»é‡tagæ˜¯æŒ‡å‘æäº¤å¯¹è±¡çš„å¼•ç”¨ï¼Œé™„æ³¨Tagåˆ™æ˜¯ä»“åº“ä¸­çš„ä¸€ä¸ªç‹¬ç«‹å¯¹è±¡ã€‚å»ºè®®ä½¿ç”¨é™„æ³¨Tagã€‚</p><h4 id="åˆ›å»ºè½»é‡Tag"><a href="#åˆ›å»ºè½»é‡Tag" class="headerlink" title="åˆ›å»ºè½»é‡Tag"></a>åˆ›å»ºè½»é‡Tag</h4><blockquote><p>git tag v0.1.2-light</p></blockquote><h4 id="åˆ›å»ºé™„æ³¨Tag"><a href="#åˆ›å»ºé™„æ³¨Tag" class="headerlink" title="åˆ›å»ºé™„æ³¨Tag"></a>åˆ›å»ºé™„æ³¨Tag</h4><blockquote><p>git tag -a v0.1.2 -m â€œ0.1.2ç‰ˆæœ¬â€</p></blockquote><p>åˆ›å»ºè½»é‡Tagä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œç›´æ¥æŒ‡å®šTagåç§°å³å¯ã€‚</p><p>åˆ›å»ºé™„æ³¨Tagæ—¶ï¼Œå‚æ•°aå³annotatedçš„ç¼©å†™ï¼ŒæŒ‡å®šTagç±»å‹ï¼Œåé™„Tagåã€‚å‚æ•°mæŒ‡å®šTagè¯´æ˜ï¼Œè¯´æ˜ä¿¡æ¯ä¼šä¿å­˜åœ¨Tagå¯¹è±¡ä¸­ã€‚</p><h4 id="åˆ‡æ¢åˆ°Tag"><a href="#åˆ‡æ¢åˆ°Tag" class="headerlink" title="åˆ‡æ¢åˆ°Tag"></a>åˆ‡æ¢åˆ°Tag</h4><p>ä¸åˆ‡æ¢åˆ†æ”¯å‘½ä»¤ç›¸åŒï¼Œç”¨</p><blockquote><p>git checkout [tagname]</p></blockquote><h4 id="æŸ¥çœ‹Tagä¿¡æ¯"><a href="#æŸ¥çœ‹Tagä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹Tagä¿¡æ¯"></a>æŸ¥çœ‹Tagä¿¡æ¯</h4><p>ç”¨git showå‘½ä»¤å¯ä»¥æŸ¥çœ‹Tagçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><blockquote><p>git show v0.1.2</p></blockquote><h4 id="åˆ é™¤Tag"><a href="#åˆ é™¤Tag" class="headerlink" title="åˆ é™¤Tag"></a>åˆ é™¤Tag</h4><p>è¯¯æ‰“æˆ–éœ€è¦ä¿®æ”¹Tagæ—¶ï¼Œéœ€è¦å…ˆå°†Tagåˆ é™¤ï¼Œå†æ‰“æ–°Tagã€‚</p><blockquote><p>git tag -d v0.1.2 # åˆ é™¤Tag</p></blockquote><p>å‚æ•°då³deleteçš„ç¼©å†™ï¼Œæ„ä¸ºåˆ é™¤å…¶åæŒ‡å®šçš„Tagã€‚</p><p>ç»™æŒ‡å®šçš„commitæ‰“Tag æ‰“Tagä¸å¿…è¦åœ¨headä¹‹ä¸Šï¼Œä¹Ÿå¯åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸Šæ‰“ï¼Œè¿™éœ€è¦ä½ çŸ¥é“æŸä¸ªæäº¤å¯¹è±¡çš„æ ¡éªŒå’Œï¼ˆé€šè¿‡git logè·å–ï¼‰ã€‚</p><h4 id="è¡¥æ‰“Tag"><a href="#è¡¥æ‰“Tag" class="headerlink" title="è¡¥æ‰“Tag"></a>è¡¥æ‰“Tag</h4><blockquote><p>git tag -a v0.1.1 9fbc3d0</p></blockquote><p>Tagæ¨é€åˆ°æœåŠ¡å™¨ é€šå¸¸çš„git pushä¸ä¼šå°†Tagå¯¹è±¡æäº¤åˆ°gitæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ˜¾å¼çš„æ“ä½œï¼š</p><blockquote><p>git push origin v0.1.2 # å°†v0.1.2 Tagæäº¤åˆ°gitæœåŠ¡å™¨</p></blockquote><blockquote><p>git push origin â€“-tags # å°†æœ¬åœ°æ‰€æœ‰Tagä¸€æ¬¡æ€§æäº¤åˆ°gitæœåŠ¡å™¨</p></blockquote><p>æ³¨æ„ï¼šå¦‚æœæƒ³çœ‹ä¹‹å‰æŸä¸ªTagçŠ¶æ€ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·æ“ä½œ</p><ol><li>git tag æŸ¥çœ‹å½“å‰åˆ†æ”¯ä¸‹çš„Tag</li><li>git checkout v0.21 æ­¤æ—¶ä¼šæŒ‡å‘æ‰“v0.21 Tagæ—¶çš„ä»£ç çŠ¶æ€ï¼Œï¼ˆä½†ç°åœ¨å¤„äºä¸€ä¸ªç©ºçš„åˆ†æ”¯ä¸Šï¼‰</li></ol><h4 id="åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag"><a href="#åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag" class="headerlink" title="åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag"></a>åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag</h4><p>åœ¨Git v1.7.0 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p><blockquote><p>git push origin â€“delete <branchName></p></blockquote><p>åˆ é™¤tagè¿™ä¹ˆç”¨ï¼š</p><blockquote><p>git push origin â€“delete tag <tagname></p></blockquote><p>å¦åˆ™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºåˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ï¼Œå…¶å®å°±ç›¸å½“äºåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p><blockquote><p>git push origin :<branchName></p></blockquote><p>è¿™æ˜¯åˆ é™¤tagçš„æ–¹æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºtagåˆ°è¿œç¨‹tagï¼š</p><blockquote><p>git tag -d <tagname></p></blockquote><blockquote><p>git push origin :refs/tags/<tagname></p></blockquote><h4 id="é‡å‘½åè¿œç¨‹åˆ†æ”¯"><a href="#é‡å‘½åè¿œç¨‹åˆ†æ”¯" class="headerlink" title="é‡å‘½åè¿œç¨‹åˆ†æ”¯"></a>é‡å‘½åè¿œç¨‹åˆ†æ”¯</h4><p>åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p><blockquote><p>git push â€“delete origin devel</p></blockquote><p>é‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼š</p><blockquote><p>git branch -m devel develop</p></blockquote><p>æ¨é€æœ¬åœ°åˆ†æ”¯ï¼š</p><blockquote><p>git push origin develop</p></blockquote><h4 id="æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹"><a href="#æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹" class="headerlink" title="æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹"></a>æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹</h4><blockquote><p>git push â€“tags # æ¨é€æ‰€æœ‰tag</p></blockquote><blockquote><p>git push origin :tag # æ¨é€tag</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>atomic</title>
    <link href="/2021/02/13/atomic/"/>
    <url>/2021/02/13/atomic/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰çš„æºç åˆ†æä¸­ï¼Œæˆ‘ä»¬æœ‰å¤šæ¬¡çœ‹åˆ°atomicçš„å‡ºç°ï¼Œä»Šå¤©ä¸å¦¨æˆ‘ä»¬çœ‹ä¸€ä¸‹atomicçš„æºç ã€‚</p><hr><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹atomicçš„æºç æ–‡ä»¶ï¼š</p><p><img src="/images/post/v2-acedfd18eadcd42f1c1662b66e860580_1440w.png" alt="img"></p><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œä»¥.sä¸ºåç¼€çš„æ˜¯æ±‡ç¼–è¯­è¨€æºä»£ç æ–‡ä»¶ï¼Œä½ å¯ä»¥å¹¶ä¸æ‡‚æ±‡ç¼–ï¼Œæ²¡æœ‰å…³ç³»ã€‚</p><p>ä¸»è¦çœ‹ä¸‹asm.sï¼Œçœ‹ä¸€çœ‹åˆ°é‡Œé¢æœ‰è°ƒç”¨runtime âˆ• internal âˆ• atomicï¼Œæˆ‘ä»¬å‰å»çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­æœ‰ä¸ªæ–‡ä»¶atomic_wasm.goã€‚</p><p>atomicæä¾›çš„æ˜¯åŸå­æ“ä½œï¼ŒatomicåŒ…ä¸­æ”¯æŒå…­ç§ç±»å‹</p><ul><li>int32</li><li>uint32</li><li>int64</li><li>uint64</li><li>uintptr</li><li>unsafe.Pointer</li></ul><p>å¯¹äºæ¯ä¸€ä¸ªç±»å‹ï¼Œæ”¯æŒ5ç§æ“ä½œï¼Œæˆ‘ä»¬ä»¥int32åˆ†åˆ«è¯´æ˜ä¸‹è¿™äº›æ“ä½œï¼š</p><h3 id="SwapX"><a href="#SwapX" class="headerlink" title="SwapX"></a>SwapX</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åŸå­æ€§çš„å°†æ–°å€¼ä¿å­˜åˆ°*addrå¹¶è¿”å›æ—§å€¼ã€‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SwapInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>, <span class="hljs-built_in">new</span> <span class="hljs-keyword">int32</span>)</span> <span class="hljs-params">(old <span class="hljs-keyword">int32</span>)</span></span><span class="hljs-comment">// æºç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Xchg</span><span class="hljs-params">(ptr *<span class="hljs-keyword">uint32</span>, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uint32</span>)</span> <span class="hljs-title">uint32</span></span> &#123;old := *ptr*ptr = <span class="hljs-built_in">new</span><span class="hljs-keyword">return</span> old&#125;</code></pre></div><h3 id="CompareAndSwapX"><a href="#CompareAndSwapX" class="headerlink" title="CompareAndSwapX"></a>CompareAndSwapX</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åŸå­æ€§çš„æ¯”è¾ƒ*addrå’Œoldï¼Œå¦‚æœç›¸åŒåˆ™å°†newèµ‹å€¼ç»™*addrå¹¶è¿”å›çœŸã€‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CompareAndSwapInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>, old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">int32</span>)</span> <span class="hljs-params">(swapped <span class="hljs-keyword">bool</span>)</span></span><span class="hljs-comment">// æºç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Cas</span><span class="hljs-params">(ptr *<span class="hljs-keyword">uint32</span>, old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uint32</span>)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">if</span> *ptr == old &#123;*ptr = <span class="hljs-built_in">new</span><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;</code></pre></div><h3 id="AddX"><a href="#AddX" class="headerlink" title="AddX"></a>AddX</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åŸå­æ€§çš„å°†valçš„å€¼æ·»åŠ åˆ°*addrå¹¶è¿”å›æ–°å€¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddInt64</span><span class="hljs-params">(addr *<span class="hljs-keyword">int64</span>, delta <span class="hljs-keyword">int64</span>)</span> <span class="hljs-params">(<span class="hljs-built_in">new</span> <span class="hljs-keyword">int64</span>)</span></span><span class="hljs-comment">// æºç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Xadd</span><span class="hljs-params">(ptr *<span class="hljs-keyword">uint32</span>, delta <span class="hljs-keyword">int32</span>)</span> <span class="hljs-title">uint32</span></span> &#123;<span class="hljs-built_in">new</span> := *ptr + <span class="hljs-keyword">uint32</span>(delta)*ptr = <span class="hljs-built_in">new</span><span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span>&#125;</code></pre></div><h3 id="LoadX"><a href="#LoadX" class="headerlink" title="LoadX"></a>LoadX</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åŸå­æ€§çš„è·å–*addrçš„å€¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>)</span> <span class="hljs-params">(val <span class="hljs-keyword">int32</span>)</span></span><span class="hljs-comment">// æºç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Load</span><span class="hljs-params">(ptr *<span class="hljs-keyword">uint32</span>)</span> <span class="hljs-title">uint32</span></span> &#123;<span class="hljs-keyword">return</span> *ptr&#125;</code></pre></div><h3 id="StoreX"><a href="#StoreX" class="headerlink" title="StoreX"></a>StoreX</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åŸå­æ€§çš„å°†valçš„å€¼ä¿å­˜åˆ°*addr</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StoreInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>, val <span class="hljs-keyword">int32</span>)</span></span><span class="hljs-comment">// æºç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Store</span><span class="hljs-params">(ptr *<span class="hljs-keyword">uint32</span>, val <span class="hljs-keyword">uint32</span>)</span></span> &#123;*ptr = val&#125;</code></pre></div><p>æºç å…¶å®æ¯”è¾ƒç®€å•äº†ï¼Œæˆ‘å°±ä¸è¿‡å¤šè¯´æ˜äº†ã€‚</p><h3 id="atomic-Value"><a href="#atomic-Value" class="headerlink" title="atomic.Value"></a>atomic.Value</h3><p>å¦å¤–ï¼Œatomicå¯¹æ”¯æŒçš„ç±»å‹åšäº†æ‰©å±•ï¼Œatomic.Valueè¢«è®¾è®¡ç”¨æ¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Value <span class="hljs-keyword">struct</span> &#123;v <span class="hljs-keyword">interface</span>&#123;&#125;&#125;</code></pre></div><p>ä¸ºäº†æ–¹ä¾¿ï¼Œå®šä¹‰äº†ä¸€ä¸ªifaceWordsç±»å‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†<code>interface&#123;&#125;</code>ç±»å‹åˆ†è§£ï¼Œå¾—åˆ°å…¶ä¸­çš„ä¸¤ä¸ªå­—æ®µï¼Œä½œä¸ºinterfaceçš„å†…éƒ¨è¡¨ç¤ºæ ¼å¼ï¼Œtypä»£è¡¨åŸå§‹ç±»å‹ï¼Œdataä»£è¡¨çœŸæ­£çš„å€¼ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> ifaceWords <span class="hljs-keyword">struct</span> &#123;typ  unsafe.Pointerdata unsafe.Pointer&#125;</code></pre></div><p>æä¾›äº†Storeå’ŒLoadä¸¤ä¸ªæ–¹æ³•ã€‚</p><p><strong>Store</strong></p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v *Value)</span> <span class="hljs-title">Store</span><span class="hljs-params">(x <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;        <span class="hljs-comment">// xä¸ºnilï¼Œç›´æ¥panic</span><span class="hljs-keyword">if</span> x == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;sync/atomic: store of nil value into Value&quot;</span>)&#125;<span class="hljs-comment">// å°†ç°æœ‰çš„å€¼å’Œè¦å†™å…¥çš„å€¼è½¬æ¢ä¸ºifaceWordsç±»å‹ï¼Œè¿™æ ·ä¸‹ä¸€æ­¥å°±èƒ½è·å–åˆ°å®ƒä»¬çš„åŸå§‹ç±»å‹å’ŒçœŸæ­£çš„å€¼</span>vp := (*ifaceWords)(unsafe.Pointer(v))xp := (*ifaceWords)(unsafe.Pointer(&amp;x))<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// è·å–ç°æœ‰çš„å€¼çš„type</span>typ := LoadPointer(&amp;vp.typ)<span class="hljs-comment">// å¦‚æœtypä¸ºnilè¯´æ˜è¿™æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨Store</span><span class="hljs-keyword">if</span> typ == <span class="hljs-literal">nil</span> &#123;<span class="hljs-comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œå°±å ä½å½“å‰çš„processorï¼Œä¸å…è®¸å…¶ä»–goroutineå†æŠ¢ï¼Œruntime_procPinæ–¹æ³•ä¼šå…ˆè·å–å½“å‰goroutine</span>runtime_procPin()<span class="hljs-comment">// ä½¿ç”¨CASæ“ä½œï¼Œå…ˆå°è¯•å°†typè®¾ç½®ä¸º^uintptr(0)è¿™ä¸ªä¸­é—´çŠ¶æ€</span><span class="hljs-comment">// å¦‚æœå¤±è´¥ï¼Œåˆ™è¯æ˜å·²ç»æœ‰åˆ«çš„goroutineæŠ¢å…ˆå®Œæˆäº†èµ‹å€¼æ“ä½œ</span><span class="hljs-comment">// é‚£å®ƒå°±è§£é™¤æŠ¢å é”ï¼Œç»§ç»­å¾ªç¯ç­‰å¾…</span><span class="hljs-keyword">if</span> !CompareAndSwapPointer(&amp;vp.typ, <span class="hljs-literal">nil</span>, unsafe.Pointer(^<span class="hljs-keyword">uintptr</span>(<span class="hljs-number">0</span>))) &#123;runtime_procUnpin()<span class="hljs-keyword">continue</span>&#125;<span class="hljs-comment">// å¦‚æœè®¾ç½®æˆåŠŸï¼Œå°±åŸå­æ€§çš„æ›´æ–°å¯¹åº”çš„æŒ‡é’ˆï¼Œæœ€åè§£é™¤æŠ¢å é”</span>StorePointer(&amp;vp.data, xp.data)StorePointer(&amp;vp.typ, xp.typ)runtime_procUnpin()<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// å¦‚æœtypä¸º^uintptr(0)è¯´æ˜ç¬¬ä¸€æ¬¡å†™å…¥è¿˜æ²¡æœ‰å®Œæˆï¼Œç»§ç»­å¾ªç¯ç­‰å¾…</span><span class="hljs-keyword">if</span> <span class="hljs-keyword">uintptr</span>(typ) == ^<span class="hljs-keyword">uintptr</span>(<span class="hljs-number">0</span>) &#123;<span class="hljs-keyword">continue</span>&#125;<span class="hljs-comment">// å¦‚æœè¦å†™å…¥çš„ç±»å‹å’Œç°æœ‰çš„ç±»å‹ä¸ä¸€è‡´ï¼Œåˆ™panic</span><span class="hljs-keyword">if</span> typ != xp.typ &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;sync/atomic: store of inconsistently typed value into Value&quot;</span>)&#125;<span class="hljs-comment">// æ›´æ–°dataï¼Œè·³å‡ºå¾ªç¯</span>StorePointer(&amp;vp.data, xp.data)<span class="hljs-keyword">return</span>&#125;&#125;</code></pre></div><p><strong>Load</strong></p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v *Value)</span> <span class="hljs-title">Load</span><span class="hljs-params">()</span> <span class="hljs-params">(x <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;        <span class="hljs-comment">// å°†*ValueæŒ‡é’ˆç±»å‹è½¬æ¢ä¸º*ifaceWordsæŒ‡é’ˆç±»å‹</span>vp := (*ifaceWords)(unsafe.Pointer(v))<span class="hljs-comment">// åŸå­æ€§çš„è·å–åˆ°vçš„ç±»å‹typçš„æŒ‡é’ˆ</span>typ := LoadPointer(&amp;vp.typ)<span class="hljs-comment">// å¦‚æœæ²¡æœ‰å†™å…¥æˆ–è€…æ­£åœ¨å†™å…¥ï¼Œå…ˆè¿”å›ï¼Œ^uintptr(0)ä»£è¡¨è¿‡æ¸¡çŠ¶æ€ï¼Œè¿™å’ŒStoreæ˜¯å¯¹åº”çš„</span><span class="hljs-keyword">if</span> typ == <span class="hljs-literal">nil</span> || <span class="hljs-keyword">uintptr</span>(typ) == ^<span class="hljs-keyword">uintptr</span>(<span class="hljs-number">0</span>) &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// åŸå­æ€§çš„è·å–åˆ°vçš„çœŸæ­£çš„å€¼dataçš„æŒ‡é’ˆï¼Œç„¶åè¿”å›</span>data := LoadPointer(&amp;vp.data)xp := (*ifaceWords)(unsafe.Pointer(&amp;x))xp.typ = typxp.data = data<span class="hljs-keyword">return</span>&#125;</code></pre></div><p>PS:è§£è¯»çš„æºç ï¼Œå¦‚æ— ç‰¹åˆ«è¯´æ˜ï¼Œç‰ˆæœ¬ä¸º1.15.6</p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://studygolang.com/pkgdoc">goæ ‡å‡†åº“</a></li><li><a href="https://juejin.cn/post/6844904053042839560">Go - atomicåŒ…ä½¿ç”¨åŠatomic.Valueæºç åˆ†æ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>gosourcecode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gosourcecode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºhttp server</title>
    <link href="/2021/02/12/goexample1/"/>
    <url>/2021/02/12/goexample1/</url>
    
    <content type="html"><![CDATA[<p>round oneï¼Œæˆ‘ä»¬æ¥ç‚¹ç®€å•çš„ï¼Œæ­å»ºä¸€ä¸ªç®€å•çš„http serverã€‚</p><h2 id="ç›®æ ‡ï¼š"><a href="#ç›®æ ‡ï¼š" class="headerlink" title="ç›®æ ‡ï¼š"></a>ç›®æ ‡ï¼š</h2><ul><li>è·¯ç”±helloæ¥æ”¶å‚æ•°å¹¶è·å–åˆ°è¾“å‡ºjsonæ•°æ®</li><li>è‡ªå®šä¹‰404</li><li>å¤„ç†è¶…æ—¶é¡µé¢</li></ul><h2 id="ä½¿ç”¨åˆ°çš„åº“"><a href="#ä½¿ç”¨åˆ°çš„åº“" class="headerlink" title="ä½¿ç”¨åˆ°çš„åº“:"></a>ä½¿ç”¨åˆ°çš„åº“:</h2><ul><li>net/http</li><li>time</li><li>encoding/json</li></ul><hr><p>æˆ‘ä»¬å…ˆæ­å»ºèµ·æ¥serverï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;net/http&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;srv := http.Server&#123;Addr: <span class="hljs-string">&quot;:8080&quot;</span>,Handler: http.HandlerFunc(defaultHttp),&#125;srv.ListenAndServe()&#125;<span class="hljs-comment">// é»˜è®¤httpå¤„ç†</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">defaultHttp</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;wow&quot;</span>))&#125;</code></pre></div><p>è¿è¡Œå°±å¯ä»¥è·‘èµ·æ¥äº†ã€‚</p><p>æˆ‘ä»¬å†æ¥å®šä¹‰ä¸‹jsonè¾“å‡ºæ ¼å¼ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// è‡ªå®šä¹‰è¿”å›</span><span class="hljs-keyword">type</span> JsonRes <span class="hljs-keyword">struct</span> &#123;Code <span class="hljs-keyword">int</span> <span class="hljs-string">`json:&quot;code&quot;`</span>Data <span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-string">`json:&quot;data&quot;`</span>Msg <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;msg&quot;`</span>TimeStamp <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:&quot;timestmap&quot;`</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">apiResult</span><span class="hljs-params">(w http.ResponseWriter, code <span class="hljs-keyword">int</span>, data <span class="hljs-keyword">interface</span>&#123;&#125;, msg <span class="hljs-keyword">string</span>)</span></span> &#123;body, _ := json.Marshal(JsonRes&#123;Code: code, Data: data, Msg: msg, <span class="hljs-comment">// è·å–æ—¶é—´æˆ³</span>TimeStamp: time.Now().Unix(),&#125;)    w.Write(body)&#125;</code></pre></div><p>å†æ¥çœ‹ä¸€ä¸‹æ¥æ”¶å‚æ•°ä¸è¾“å‡ºï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// å¤„ç†helloï¼Œå¹¶æ¥æ”¶å‚æ•°è¾“å‡ºjson</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;    query := r.URL.Query()    <span class="hljs-comment">// ç¬¬ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯æ²¡æœ‰nameå‚æ•°ä¼šæŠ¥é”™</span>    <span class="hljs-comment">// name := query[&quot;name&quot;][0]</span>    <span class="hljs-comment">// ç¬¬äºŒç§æ–¹å¼</span>    name := query.Get(<span class="hljs-string">&quot;name&quot;</span>)    apiResult(w, <span class="hljs-number">0</span>, name+<span class="hljs-string">&quot; say &quot;</span>+r.PostFormValue(<span class="hljs-string">&quot;some&quot;</span>), <span class="hljs-string">&quot;success&quot;</span>)&#125;</code></pre></div><p>è¶…æ—¶å¤„ç†ï¼š</p><div class="code-wrapper"><pre><code class="hljs go">Handler: http.TimeoutHandler(http.HandlerFunc(defaultHttp), <span class="hljs-number">2</span>*time.Second, <span class="hljs-string">&quot;Timeout!!!&quot;</span>)</code></pre></div><p>404:</p><div class="code-wrapper"><pre><code class="hljs go">http.Error(w, <span class="hljs-string">&quot;you lost???&quot;</span>, http.StatusNotFound)</code></pre></div><p>æœ€ååŠ å…¥è·¯ç”±å¤„ç†ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">defaultHttp</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;path, httpMethod := r.URL.Path, r.Method<span class="hljs-keyword">if</span> path == <span class="hljs-string">&quot;/&quot;</span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;index&quot;</span>))<span class="hljs-keyword">return</span> &#125;<span class="hljs-keyword">if</span> path == <span class="hljs-string">&quot;/hello&quot;</span> &amp;&amp; httpMethod == <span class="hljs-string">&quot;POST&quot;</span> &#123;sayHello(w, r)<span class="hljs-keyword">return</span> &#125;<span class="hljs-keyword">if</span> path == <span class="hljs-string">&quot;/sleep&quot;</span> &#123;<span class="hljs-comment">// æ¨¡æ‹Ÿä¸€ä¸‹ä¸šåŠ¡å¤„ç†è¶…æ—¶</span>time.Sleep(<span class="hljs-number">4</span>*time.Second)<span class="hljs-keyword">return</span> &#125;<span class="hljs-keyword">if</span> path == <span class="hljs-string">&quot;/path&quot;</span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;path:&quot;</span>+path+<span class="hljs-string">&quot;, method:&quot;</span>+httpMethod))<span class="hljs-keyword">return</span> &#125;<span class="hljs-comment">// è‡ªå®šä¹‰404</span>http.Error(w, <span class="hljs-string">&quot;you lost???&quot;</span>, http.StatusNotFound)&#125;</code></pre></div><p>æˆ‘ä»¬è¿è¡Œèµ·æ¥çœ‹ä¸‹æ•ˆæœï¼š</p><p><img src="/images/post/v2-1e879cbadf7b04db53a74f55409d5bb2_1440w.png" alt="img">404æ•ˆæœ</p><p><img src="/images/post/v2-1a6d77d41a0a4939758120e835976b3e_1440w.png" alt="img">hello</p><p><img src="/images/post/v2-d6b363290dced2fe7b12195bc0f36c81_1440w.png" alt="img">é¦–é¡µ</p><p><img src="/images/post/v2-711a296a73dcd4d6b4b864777f6a3d30_1440w.png" alt="img">è¶…æ—¶</p><p>è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„http serverï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Ÿ</p><ul><li><a href="https://github.com/13sai/go-example/blob/main/demo1-http/main.go">å®Œæ•´ä»£ç github</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go+MongoDBå®ç°é™„è¿‘çš„äºº</title>
    <link href="/2021/02/12/goexample10/"/>
    <url>/2021/02/12/goexample10/</url>
    
    <content type="html"><![CDATA[<p>åœ¨O2Oä¸ç¤¾äº¤åœºæ™¯ä¸­ï¼Œæœç´¢é™„è¿‘çš„äººã€é™„è¿‘çš„å•†å®¶æ˜¯å¾ˆå¸¸è§çš„åœºæ™¯ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><p>æ¥è§¦çš„æ–¹æ³•æœ‰ï¼š</p><ul><li>åæ ‡+çƒä½“è·ç¦»è®¡ç®—å…¬å¼</li><li>åŸºäºRedisçš„geo</li><li>åŸºäºMongoDBçš„geohash</li></ul><p>å‰é¢çš„demoå·²ç»æœ‰æ¥è§¦Redisï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç”¨mongoDBæ¥å®ç°ä¸€ä¸‹ã€‚</p><p>æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„å®ç°å¥½äº†ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">go</span>.mongodb.org/mongo-driver/mongo</code></pre></div><h3 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h3><div class="code-wrapper"><pre><code class="hljs go">opt := options.Client().ApplyURI(<span class="hljs-string">&quot;mongodb://root:211111@localhost:27017&quot;</span>)<span class="hljs-comment">// Connect to MongoDB</span>client, err := mongo.Connect(context.TODO(), opt)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;<span class="hljs-comment">// Check the connection</span>err = client.Ping(context.TODO(), <span class="hljs-literal">nil</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;fmt.Println(<span class="hljs-string">&quot;Connected to MongoDB!&quot;</span>)</code></pre></div><p>æˆ‘ä»¬å¯ä»¥è®¾ç½®æ›´å¤šï¼š</p><div class="code-wrapper"><pre><code class="hljs go">opt.SetLocalThreshold(<span class="hljs-number">3</span> * time.Second)     <span class="hljs-comment">//åªä½¿ç”¨ä¸mongoæ“ä½œè€—æ—¶å°äº3ç§’çš„</span>opt.SetMaxConnIdleTime(<span class="hljs-number">5</span> * time.Second)    <span class="hljs-comment">//æŒ‡å®šè¿æ¥å¯ä»¥ä¿æŒç©ºé—²çš„æœ€å¤§æ¯«ç§’æ•°</span>opt.SetMaxPoolSize(<span class="hljs-number">200</span>)                    <span class="hljs-comment">//ä½¿ç”¨æœ€å¤§çš„è¿æ¥æ•°</span>opt.SetReadConcern(readconcern.Majority()) <span class="hljs-comment">//æŒ‡å®šæŸ¥è¯¢åº”è¿”å›å®ä¾‹çš„æœ€æ–°æ•°æ®ç¡®è®¤ä¸ºï¼Œå·²å†™å…¥å‰¯æœ¬é›†ä¸­çš„å¤§å¤šæ•°æˆå‘˜</span></code></pre></div><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åæ ‡</span><span class="hljs-keyword">type</span> Location <span class="hljs-keyword">struct</span> &#123;Type        <span class="hljs-keyword">string</span>    <span class="hljs-string">`json:&quot;type&quot; bson:&quot;type&quot;`</span>Coordinates []<span class="hljs-keyword">float64</span> <span class="hljs-string">`json:&quot;coordinates&quot; bson:&quot;coordinates&quot;`</span>&#125;<span class="hljs-comment">// æ¯ä¸ªç‚¹</span><span class="hljs-keyword">type</span> Point <span class="hljs-keyword">struct</span> &#123;Name     <span class="hljs-keyword">string</span>             <span class="hljs-string">`json:&quot;name&quot;`</span>Age     <span class="hljs-keyword">int</span>             <span class="hljs-string">`json:&quot;age&quot;`</span>City     <span class="hljs-keyword">string</span>             <span class="hljs-string">`json:&quot;city&quot;`</span>Location Location           <span class="hljs-string">`json:&quot;location&quot;`</span>&#125;</code></pre></div><h3 id="æ•°æ®å†™å…¥"><a href="#æ•°æ®å†™å…¥" class="headerlink" title="æ•°æ®å†™å…¥"></a>æ•°æ®å†™å…¥</h3><p>æˆ‘ä»¬å¯ä»¥å…ˆæ’å…¥æ•°æ®</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(mgo *mgo)</span> <span class="hljs-title">Start</span><span class="hljs-params">()</span></span> &#123;collection := mgo.client.Database(DBName).Collection(CollectionName)<span class="hljs-comment">// è®¾ç½®ç´¢å¼• 2dsphereï¼Œ å¾ˆé‡è¦</span>collection.Indexes().CreateOne(context.TODO(), mongo.IndexModel&#123;Keys: bson.M&#123;Key: <span class="hljs-string">&quot;2dsphere&quot;</span>&#125;,&#125;)a := Point&#123;<span class="hljs-string">&quot;ç‹äºŒ&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;æ­å·&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">120.185614</span>,<span class="hljs-number">30.300738</span>&#125;&#125;&#125;b := Point&#123;<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;æ­å·&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">120.094778</span>,<span class="hljs-number">30.310217</span>&#125;&#125;&#125;c := Point&#123;<span class="hljs-string">&quot;å°æ™´&quot;</span>, <span class="hljs-number">35</span>, <span class="hljs-string">&quot;ç»å…´&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">120.603847</span>,<span class="hljs-number">30.054237</span>&#125;&#125;&#125;d := Point&#123;<span class="hljs-string">&quot;æå››&quot;</span>, <span class="hljs-number">34</span>, <span class="hljs-string">&quot;æ­å·&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">120.110893</span>,<span class="hljs-number">30.207849</span>&#125;&#125;&#125;e := Point&#123;<span class="hljs-string">&quot;å°æ˜&quot;</span>, <span class="hljs-number">24</span>, <span class="hljs-string">&quot;åŒ—äº¬&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">116.435721</span>,<span class="hljs-number">39.914031</span>&#125;&#125;&#125;f := Point&#123;<span class="hljs-string">&quot;å´å…­&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;æ­å·&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">120.126443</span>,<span class="hljs-number">30.33084</span>&#125;&#125;&#125;h := Point&#123;<span class="hljs-string">&quot;äºä¸€&quot;</span>, <span class="hljs-number">23</span>, <span class="hljs-string">&quot;æ­å·&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">120.28132</span>,<span class="hljs-number">30.184083</span>&#125;&#125;&#125;j := Point&#123;<span class="hljs-string">&quot;å°ä¸ƒ&quot;</span>, <span class="hljs-number">14</span>, <span class="hljs-string">&quot;æ­å·&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>, []<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">119.73926</span>,<span class="hljs-number">30.247639</span>&#125;&#125;&#125;<span class="hljs-comment">// å•æ¡æ’å…¥</span>insertResult, err := collection.InsertOne(context.TODO(), a)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;fmt.Println(<span class="hljs-string">&quot;Inserted a single document: &quot;</span>, insertResult.InsertedID)ps := []<span class="hljs-keyword">interface</span>&#123;&#125;&#123;b, c, d, e, f, h, j&#125;<span class="hljs-comment">// æ‰¹é‡æ’å…¥</span>insertManyResult, err := collection.InsertMany(context.TODO(), ps)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;fmt.Println(<span class="hljs-string">&quot;Inserted multiple documents: &quot;</span>, insertManyResult.InsertedIDs)&#125;</code></pre></div><p>æ³¨æ„ï¼Œè®¾ç½®ç´¢å¼• 2dsphereï¼Œ å¾ˆé‡è¦ï¼ï¼ï¼</p><p><img src="/images/post/v2-4c04d12bc9bbc5b787d926532ed8954f_1440w.png" alt="img">å­˜å‚¨çš„æ•°æ®æ ¼å¼</p><p>æˆ‘ä»¬æŸ¥æ‰¾ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mgo *mgo)</span> <span class="hljs-title">Near</span><span class="hljs-params">()</span></span> &#123;collection := mgo.client.Database(DBName).Collection(CollectionName)        <span class="hljs-comment">// æŸ¥æ‰¾120.110893,30.2078490åæ ‡é™„è¿‘15000ç±³çš„äºº</span>cur, err := collection.Find(context.TODO(), bson.D&#123;&#123;Key, bson.D&#123;&#123;<span class="hljs-string">&quot;$near&quot;</span>, bson.D&#123;&#123;<span class="hljs-string">&quot;$geometry&quot;</span>, Location&#123;<span class="hljs-string">&quot;Point&quot;</span>,[]<span class="hljs-keyword">float64</span>&#123;<span class="hljs-number">120.110893</span>,<span class="hljs-number">30.2078490</span>&#125;,&#125;,&#125;,&#123;<span class="hljs-string">&quot;$maxDistance&quot;</span>, <span class="hljs-number">15000</span>&#125;, <span class="hljs-comment">// å•ä½ç±³</span>&#125;&#125;,&#125;&#125;,&#125;)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(err)<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">var</span> results []Point<span class="hljs-keyword">for</span> cur.Next(context.TODO()) &#123;<span class="hljs-keyword">var</span> elem Pointerr := cur.Decode(&amp;elem)fmt.Println(elem)fmt.Println(cur)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(<span class="hljs-string">&quot;Could not decode Point&quot;</span>)<span class="hljs-keyword">return</span>&#125;results = <span class="hljs-built_in">append</span>(results, elem)&#125;fmt.Println(<span class="hljs-string">&quot;æŸ¥æ‰¾åˆ°&quot;</span>, <span class="hljs-built_in">len</span>(results))&#125;</code></pre></div><p>æˆ‘ä»¬ä¸å¦¨è¿è¡Œä¸€ä¸‹ï¼š</p><p><img src="/images/post/v2-c62ee9c350d9d3b569501ae217fbd06b_1440w.png" alt="img"></p><p>èƒ½æˆåŠŸæŸ¥æ‰¾å‡ºäº†é™„è¿‘çš„äººã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•è®¡ç®—è·ç¦»å‘¢ï¼Ÿ</p><p>å¯ä»¥ç»çº¬åº¦è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ç›´æ¥mongoDBèšåˆæŸ¥è¯¢ï¼Œå¯ä»¥è‡ªè¡Œæ€ç´¢ï¼Œ<a href="https://github.com/13sai/go-example/tree/main/demo10-mongo">å‚è€ƒä»£ç ç‚¹å‡»è§github</a>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨ginæ­å»ºä¸€ä¸ªapiæ¡†æ¶</title>
    <link href="/2021/02/12/goexample2/"/>
    <url>/2021/02/12/goexample2/</url>
    
    <content type="html"><![CDATA[<p>åœ¨demo1ä¸­ï¼Œæˆ‘ä»¬ç®€å•ä½¿ç”¨äº†net/httpæ­å»ºäº†ä¸€ä¸ªserverï¼Œå…¶å®åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ¯”è¾ƒå°‘å»ä½¿ç”¨æ ‡å‡†åº“å»ç›´æ¥å†™apiï¼Œæ›´å¤šçš„æ˜¯ä½¿ç”¨å‰äººæ­å»ºå¥½çš„è½®å­ï¼ˆæˆ‘å‘¢ï¼Œæ˜¯ä¸ªä¸å¤ªå–œæ¬¢é‡å¤é€ è½®å­çš„å¼€å‘è€…ï¼Œæœ‰å¼€æºçš„é è°±çš„ï¼Œç›´æ¥ç”¨å°±å¥½ï¼Œè‡ªå·±è°ƒæ•´æˆè‡ªå·±éœ€è¦çš„å³å¯ï¼‰ï¼Œé‚£ä¹ˆè¯´çš„goçš„æ¡†æ¶ï¼Œä¸å¾—ä¸è¯´ginäº†ã€‚</p><p>å¯¹äºginçš„ä»‹ç»ï¼Œæ˜¯githubä¸Šstaræœ€å¤šçš„goæ¡†æ¶äº†ï¼Œå…¶ä»–ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ä¸Šæ‰‹å†™èµ·æ¥å§ï¼</p><h2 id="ç›®æ ‡ï¼š"><a href="#ç›®æ ‡ï¼š" class="headerlink" title="ç›®æ ‡ï¼š"></a>ç›®æ ‡ï¼š</h2><ul><li>è‡ªå®šä¹‰é…ç½®</li><li>æ•´åˆmysqlå’ŒRedis</li><li>ç‹¬ç«‹è·¯ç”±ç®¡ç†</li><li>æ—¥å¿—</li><li>å¹³æ»‘é‡å¯</li><li>è„šæœ¬æ‰“åŒ…</li></ul><h2 id="ä½¿ç”¨åˆ°çš„åº“ï¼š"><a href="#ä½¿ç”¨åˆ°çš„åº“ï¼š" class="headerlink" title="ä½¿ç”¨åˆ°çš„åº“ï¼š"></a>ä½¿ç”¨åˆ°çš„åº“ï¼š</h2><ul><li><a href="http://github.com/fsnotify/fsnotify">github.com/fsnotify/fsnotify</a></li><li><a href="http://github.com/gin-gonic/gin">github.com/gin-gonic/gin</a></li><li><a href="http://github.com/go-Redis/Redis">github.com/go-Redis/Redis</a></li><li><a href="http://github.com/jinzhu/gorm">github.com/jinzhu/gorm</a></li><li><a href="http://github.com/lestrrat-go/file-rotatelogs">http://github.com/lestrrat-go/file-rotatelogs</a></li><li><a href="http://go.uber.org/zap">http://go.uber.org/zap</a></li><li><a href="http://github.com/spf13/pflag">github.com/spf13/pflag</a></li><li><a href="http://github.com/spf13/viper">github.com/spf13/viper</a></li></ul><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>modulesçš„å¼•å…¥ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸å¿…ä½¿ç”¨gopathå»ç®¡ç†é¡¹ç›®ç›®å½•äº†ï¼Œå¯¹äºmodulesçš„åŸºæœ¬ä½¿ç”¨ï¼Œå»ºè®®çœ‹æ–‡ç« ï¼š</p><p><a href="https://github.oscome.cn/2019/12/27/219/#modules">gomodules</a></p><p>æˆ‘ä»¬å¼€å§‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">go</span> mod init sai0556/demo2-gin-frame</code></pre></div><p>å› ä¸ºæˆ‘ä»¬æš‚æ—¶æœ¬åœ°å¼€å‘ï¼š</p><p><em>PSï¼šå½“æ—¶ç†è§£æœ‰è¯¯ï¼Œå…¶å®æ— éœ€åšlocal.comæ›¿æ¢ï¼Œimportç›´æ¥ä½¿ç”¨sai0556/demo2-gin-frameå³å¯ï¼Œè¿™é‡Œæœ‰ç‚¹å¤šä½™</em></p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// ä½¿ç”¨æœ¬åœ°module</span><span class="hljs-keyword">go</span> mod edit -require=local.com/sai0556/demo2-gin-frame@v1<span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-keyword">go</span> mod edit -replace=local.com/sai0556/demo2-gin-frame@v1<span class="hljs-number">.0</span><span class="hljs-number">.0</span>=$PWD</code></pre></div><p>å¯ä»¥çœ‹åˆ°go.modå·²ç”Ÿæˆï¼š</p><div class="code-wrapper"><pre><code class="hljs text">module sai0556/demo2-gin-framego 1.13require local.com/sai0556/demo2-gin-frame v1.0.0replace local.com/sai0556/demo2-gin-frame v1.0.0 =&gt; /Users/@/Work/golang/go-example/demo2-gin-frame</code></pre></div><blockquote><p>/Users/@/Work/golang/go-example/demo2-gin-frame æ­¤ç›®å½•å°±æ˜¯é¡¹ç›®ç›®å½•ï¼Œè§†å…·ä½“æƒ…å†µä¸ä¸€</p></blockquote><h2 id="è‡ªå®šä¹‰é…ç½®ä¸è¯»å–ï¼š"><a href="#è‡ªå®šä¹‰é…ç½®ä¸è¯»å–ï¼š" class="headerlink" title="è‡ªå®šä¹‰é…ç½®ä¸è¯»å–ï¼š"></a>è‡ªå®šä¹‰é…ç½®ä¸è¯»å–ï¼š</h2><p>åœ¨æˆ‘ä»¬ä½¿ç”¨Rediså’Œmysqlä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯»å–ä¸€ä¸‹é…ç½®ï¼Œé…ç½®å‘¢æˆ‘ä»¬ä½¿ç”¨å¸¸è§çš„yamlï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ï¼Œæ¯”å¦‚envç­‰ã€‚</p><p>æ–°å»ºconfigç›®å½•ï¼Œç”¨æ¥è¯»å–ä¸ç›‘å¬é…ç½®æ–‡ä»¶(config.yaml)ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> config<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;fmt&quot;</span>    <span class="hljs-string">&quot;github.com/fsnotify/fsnotify&quot;</span>    <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>)<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;    Name <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// å¯¹å¤–çš„åˆå§‹åŒ–é…ç½®æ–¹æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Run</span><span class="hljs-params">(cfg <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;    c := Config&#123;        Name: cfg,    &#125;    <span class="hljs-keyword">if</span> err := c.init(); err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span> err    &#125;    c.watchConfig()    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Config)</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    <span class="hljs-keyword">if</span> c.Name != <span class="hljs-string">&quot;&quot;</span> &#123;        viper.SetConfigFile(c.Name)    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-comment">// é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯./config.yaml</span>        viper.AddConfigPath(<span class="hljs-string">&quot;.&quot;</span>)        viper.SetConfigName(<span class="hljs-string">&quot;config&quot;</span>)    &#125;    viper.SetConfigType(<span class="hljs-string">&quot;yaml&quot;</span>)    <span class="hljs-comment">// viperè§£æé…ç½®æ–‡ä»¶</span>    err := viper.ReadInConfig()     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-built_in">panic</span>(fmt.Errorf(<span class="hljs-string">&quot;Fatal error config file: %s \n&quot;</span>, err))    &#125;<span class="hljs-comment">// ç®€å•æ‰“å°ä¸‹é…ç½®</span>    fmt.Println(viper.GetString(<span class="hljs-string">&quot;name&quot;</span>))    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Config)</span> <span class="hljs-title">watchConfig</span><span class="hljs-params">()</span></span> &#123;    viper.WatchConfig()    viper.OnConfigChange(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e fsnotify.Event)</span></span> &#123;        fmt.Println(<span class="hljs-string">&quot;Config file changed:&quot;</span>, e.Name)    &#125;)&#125;</code></pre></div><p>main:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;github.com/spf13/pflag&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/config&quot;</span>)<span class="hljs-keyword">var</span> (    conf = pflag.StringP(<span class="hljs-string">&quot;config&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;config filepath&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    pflag.Parse()    <span class="hljs-comment">// åˆå§‹åŒ–é…ç½®</span>    <span class="hljs-keyword">if</span> err := config.Run(*conf); err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-built_in">panic</span>(err)    &#125;&#125;</code></pre></div><p>è¿™é‡Œæœ‰ç”¨åˆ°å¤§ç‰›spf13çš„ä¸¤ä¸ªåŒ…ï¼Œpflagå’Œviperï¼Œå‘½ä»¤è¡Œå‚æ•°è§£æåŒ…pflagå¯ä»¥çœ‹ä½œflagçš„è¿›é˜¶ç‰ˆæœ¬ï¼Œåœ¨æˆ‘ä»¬è¿™é‡Œå¯ä»¥ç”¨æ¥æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œviperæ˜¯è¯»å–é…ç½®æ–‡ä»¶çš„åŒ…ï¼Œé…åˆfsnotifyå¯ä»¥å®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚ï¼ˆspf13å¤§ç¥è¿˜æœ‰å…¶ä»–æœ‰ç”¨çš„åŒ…ï¼Œç›¸ä¿¡åœ¨ä½ çš„goç¼–ç ç”Ÿæ¶¯ä¼šç”¨åˆ°çš„ï¼‰</p><p>å†™å®Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¸‹ï¼š</p><blockquote><p>go run main.go -c ./config.yaml</p></blockquote><p>å¯ä»¥çœ‹åˆ°æœ‰æ‰“å°å‡ºæˆ‘ä»¬é…ç½®çš„nameã€‚</p><h2 id="æ•´åˆmysqlä¸Redis"><a href="#æ•´åˆmysqlä¸Redis" class="headerlink" title="æ•´åˆmysqlä¸Redis"></a>æ•´åˆmysqlä¸Redis</h2><p>mysqlåŒ…æˆ‘ä»¬å°±é€‰ç”¨gormï¼ŒRedisçš„ä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯redigoå’Œgo-Redisï¼Œredigoæ›¾åœ¨æˆ‘ä½¿ç”¨ä¸­å‡ºç°è¿‡é—®é¢˜ï¼Œå› è€Œæˆ‘ä»¬é€‰æ‹©åè€…ï¼Œåè€…ä¹Ÿæ”¯æŒè¿æ¥æ± ã€‚</p><p>mysqlï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> db<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;fmt&quot;</span>    <span class="hljs-string">&quot;sync&quot;</span>    <span class="hljs-string">&quot;errors&quot;</span>    orm <span class="hljs-string">&quot;github.com/jinzhu/gorm&quot;</span>    _ <span class="hljs-string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>    <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>)<span class="hljs-keyword">type</span> MySqlPool <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-keyword">var</span> instance *MySqlPool<span class="hljs-keyword">var</span> once sync.Once<span class="hljs-keyword">var</span> db *orm.DB<span class="hljs-keyword">var</span> err error <span class="hljs-comment">// å•ä¾‹æ¨¡å¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span> *<span class="hljs-title">MySqlPool</span></span> &#123;    once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;        instance = &amp;MySqlPool&#123;&#125;    &#125;)    <span class="hljs-keyword">return</span> instance&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(pool *MySqlPool)</span> <span class="hljs-title">InitPool</span><span class="hljs-params">()</span> <span class="hljs-params">(isSuc <span class="hljs-keyword">bool</span>)</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œæœ‰ä¸€ç§å¸¸è§çš„æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼</span>    dsn := fmt.Sprintf(<span class="hljs-string">&quot;%s:%s@tcp(%s)/%s?charset=%s&quot;</span>, viper.GetString(<span class="hljs-string">&quot;db.username&quot;</span>), viper.GetString(<span class="hljs-string">&quot;db.password&quot;</span>), viper.GetString(<span class="hljs-string">&quot;db.host&quot;</span>), viper.GetString(<span class="hljs-string">&quot;db.name&quot;</span>), viper.GetString(<span class="hljs-string">&quot;db.charset&quot;</span>))    db, err = orm.Open(<span class="hljs-string">&quot;mysql&quot;</span>, dsn)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-built_in">panic</span>(errors.New(<span class="hljs-string">&quot;mysqlè¿æ¥å¤±è´¥&quot;</span>))        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>    &#125;    <span class="hljs-comment">// è¿æ¥æ•°é…ç½®ä¹Ÿå¯ä»¥å†™å…¥é…ç½®ï¼Œåœ¨æ­¤è¯»å–</span>    db.DB().SetMaxIdleConns(viper.GetInt(<span class="hljs-string">&quot;db.MaxIdleConns&quot;</span>))    db.DB().SetMaxOpenConns(viper.GetInt(<span class="hljs-string">&quot;db.MaxOpenConns&quot;</span>))    <span class="hljs-comment">// db.LogMode(true)</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;</code></pre></div><blockquote><p>åé¢è·å–è¿æ¥æ± å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ db.GetInstance()</p></blockquote><p>Redisï¼š</p><div class="code-wrapper"><pre><code class="hljs text">package dbimport (    &quot;fmt&quot;    &quot;github.com/spf13/viper&quot;    &quot;github.com/go-Redis/Redis&quot;)var RedisClient *Redis.Clientfunc InitRedis() &#123;    RedisClient = Redis.NewClient(&amp;Redis.Options&#123;        Addr:     fmt.Sprintf(&quot;%s:%s&quot;, viper.GetString(&quot;Redis.host&quot;), viper.GetString(&quot;Redis.port&quot;)),        Password: viper.GetString(&quot;Redis.auth&quot;),        DB:       0,    &#125;)    _, err := RedisClient.Ping().Result()    if err != nil &#123;        panic(&quot;Redis ping error&quot;)    &#125;&#125;</code></pre></div><p>RedisClientå°±æ˜¯æˆ‘ä»¬åé¢å¯ä»¥ç”¨çš„Redisè¿æ¥æ± ã€‚</p><p>åœ¨mainä¸­åŠ å…¥åˆå§‹åŒ–è¿æ¥æ± çš„ä»£ç å³å¯ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// è¿æ¥mysqlæ•°æ®åº“</span>btn := db.GetInstance().InitPool()<span class="hljs-keyword">if</span> !btn &#123;    log.Println(<span class="hljs-string">&quot;init database pool failure...&quot;</span>)    <span class="hljs-built_in">panic</span>(errors.New(<span class="hljs-string">&quot;init database pool failure&quot;</span>))&#125;<span class="hljs-comment">// Redis</span>db.InitRedis()</code></pre></div><h2 id="è·¯ç”±ä¸æ§åˆ¶å™¨"><a href="#è·¯ç”±ä¸æ§åˆ¶å™¨" class="headerlink" title="è·¯ç”±ä¸æ§åˆ¶å™¨"></a>è·¯ç”±ä¸æ§åˆ¶å™¨</h2><p>ä¸ºäº†æ–¹ä¾¿è·¯ç”±ï¼Œæˆ‘ä»¬æŠŠè·¯ç”±ç®¡ç†å•ç‹¬åˆ°routerã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> router<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;net/http&quot;</span>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/controller&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Load</span><span class="hljs-params">(g *gin.Engine)</span> *<span class="hljs-title">gin</span>.<span class="hljs-title">Engine</span></span> &#123;    g.Use(gin.Recovery())    <span class="hljs-comment">// 404</span>    g.NoRoute(<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *gin.Context)</span></span>  &#123;        c.String(http.StatusNotFound, <span class="hljs-string">&quot;404 not found&quot;</span>);    &#125;)    g.GET(<span class="hljs-string">&quot;/&quot;</span>, controller.Index)    <span class="hljs-keyword">return</span> g&#125;</code></pre></div><p>controller:</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> controller<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;net/http&quot;</span>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span>)<span class="hljs-comment">// è¿”å›</span><span class="hljs-keyword">type</span> Response <span class="hljs-keyword">struct</span> &#123;    Code <span class="hljs-keyword">int</span> <span class="hljs-string">`json:&quot;code&quot;`</span>    Message <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;message&quot;`</span>    Data <span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-string">`json:&quot;data&quot;`</span>&#125;<span class="hljs-comment">// apiè¿”å›ç»“æ„</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ApiResponse</span><span class="hljs-params">(c *gin.Context, code <span class="hljs-keyword">int</span>, message <span class="hljs-keyword">string</span>, data <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;    c.JSON(http.StatusOK, Response&#123;        Code: code,        Message: message,        Data: data,    &#125;)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Index</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;    ApiResponse(c, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-literal">nil</span>)&#125;</code></pre></div><p>åˆ°è¿™å‘¢ï¼ŒåŸºæœ¬ä¹Ÿå°±å·®ä¸å¤šäº†ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å®Œæ•´çš„mainï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-comment">// import è¿™é‡Œæˆ‘ä¹ æƒ¯æŠŠå®˜æ–¹åº“ï¼Œå¼€æºåº“ï¼Œæœ¬åœ°moduleä¾æ¬¡åˆ†å¼€åˆ—å‡º</span><span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;log&quot;</span>    <span class="hljs-string">&quot;errors&quot;</span>    <span class="hljs-string">&quot;github.com/spf13/pflag&quot;</span>    <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/config&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/db&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/router&quot;</span>)<span class="hljs-keyword">var</span> (    conf = pflag.StringP(<span class="hljs-string">&quot;config&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;config filepath&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    pflag.Parse()    <span class="hljs-comment">// åˆå§‹åŒ–é…ç½®</span>    <span class="hljs-keyword">if</span> err := config.Run(*conf); err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-built_in">panic</span>(err)&#125;<span class="hljs-comment">// è¿æ¥mysqlæ•°æ®åº“</span>    btn := db.GetInstance().InitPool()    <span class="hljs-keyword">if</span> !btn &#123;        log.Println(<span class="hljs-string">&quot;init database pool failure...&quot;</span>)        <span class="hljs-built_in">panic</span>(errors.New(<span class="hljs-string">&quot;init database pool failure&quot;</span>))    &#125;    <span class="hljs-comment">// Redis</span>    db.InitRedis()    gin.SetMode(viper.GetString(<span class="hljs-string">&quot;mode&quot;</span>))    g := gin.New()    g = router.Load(g)    g.Run(viper.GetString(<span class="hljs-string">&quot;addr&quot;</span>))&#125;</code></pre></div><h2 id="æ•´åˆæ—¥å¿—"><a href="#æ•´åˆæ—¥å¿—" class="headerlink" title="æ•´åˆæ—¥å¿—"></a>æ•´åˆæ—¥å¿—</h2><p>è¿™é‡Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸‹logï¼š</p><div class="code-wrapper"><pre><code class="hljs text">log:  level: debug # æ—¥å¿—çº§åˆ«ï¼Œinfoï¼Œdebugï¼Œerror  file_format: &quot;%Y%m%d&quot; # æ–‡ä»¶æ ¼å¼  max_save_days: 30 # ä¿å­˜å¤©æ•°  file_type: one # one, level å•æ–‡ä»¶å­˜å‚¨è¿˜æ˜¯ä»¥levelçº§åˆ«å­˜å‚¨</code></pre></div><p>æ•´åˆloggerï¼š</p><div class="code-wrapper"><pre><code class="hljs text">package loggerimport (&quot;io&quot;&quot;log&quot;&quot;time&quot;&quot;github.com/lestrrat-go/file-rotatelogs&quot;&quot;go.uber.org/zap&quot;&quot;go.uber.org/zap/zapcore&quot;        &quot;github.com/spf13/viper&quot;)var Logger *zap.Logger var LogLevel stringvar FileFormat string// åˆå§‹åŒ–æ—¥å¿— loggerfunc init() &#123;// è®¾ç½®ä¸€äº›åŸºæœ¬æ—¥å¿—æ ¼å¼config := zapcore.EncoderConfig&#123;MessageKey:  &quot;msg&quot;,LevelKey:    &quot;level&quot;,EncodeLevel: zapcore.CapitalLevelEncoder,TimeKey:     &quot;ts&quot;,EncodeTime: func(t time.Time, enc zapcore.PrimitiveArrayEncoder) &#123;enc.AppendString(t.Format(&quot;2006-01-02 15:04:05&quot;))&#125;,CallerKey:    &quot;file&quot;,EncodeCaller: zapcore.ShortCallerEncoder,EncodeDuration: func(d time.Duration, enc zapcore.PrimitiveArrayEncoder) &#123;enc.AppendInt64(int64(d) / 1000000)&#125;,&#125;encoder := zapcore.NewConsoleEncoder(config)FileFormat, saveType, LogLevel := &quot;%Y%m%d&quot;, &quot;one&quot;, &quot;info&quot;if viper.IsSet(&quot;log.file_format&quot;) &#123;FileFormat = viper.GetString(&quot;log.file_format&quot;)&#125;if viper.IsSet(&quot;log.level&quot;) &#123;LogLevel = viper.GetString(&quot;log.level&quot;)&#125;if viper.IsSet(&quot;log.save_type&quot;) &#123;saveType = viper.GetString(&quot;log.save_type&quot;)&#125;logLevel := zap.DebugLevelswitch LogLevel &#123;case &quot;debug&quot;:logLevel = zap.DebugLevelcase &quot;info&quot;:logLevel = zap.InfoLevelcase &quot;error&quot;:logLevel = zap.ErrorLeveldefault:logLevel = zap.InfoLevel&#125;switch saveType &#123;case &quot;level&quot;:Logger = getLevelLogger(encoder, logLevel, FileFormat)default:Logger = getOneLogger(encoder, logLevel, FileFormat)&#125;&#125;func getLevelLogger(encoder zapcore.Encoder, logLevel zapcore.Level, fileFormat string) *zap.Logger &#123;infoLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123;return lvl == zapcore.InfoLevel &amp;&amp; lvl &gt;= logLevel&#125;)debugLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123;return lvl == zapcore.DebugLevel &amp;&amp; lvl &gt;= logLevel&#125;)errorLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123;return lvl &gt;= zapcore.ErrorLevel &amp;&amp; lvl &gt;= logLevel&#125;)// è·å– infoã€warnæ—¥å¿—æ–‡ä»¶çš„io.Writer æŠ½è±¡ getLoggerWriter() åœ¨ä¸‹æ–¹å®ç°infoWriter := getLoggerWriter(&quot;./log/info&quot;, fileFormat)errorWriter := getLoggerWriter(&quot;./log/error&quot;, fileFormat)debugWriter := getLoggerWriter(&quot;./log/debug&quot;, fileFormat)// æœ€ååˆ›å»ºå…·ä½“çš„Loggercore := zapcore.NewTee(zapcore.NewCore(encoder, zapcore.AddSync(debugWriter), debugLevel),zapcore.NewCore(encoder, zapcore.AddSync(infoWriter), infoLevel),zapcore.NewCore(encoder, zapcore.AddSync(errorWriter), errorLevel),)return zap.New(core, zap.AddCaller(), zap.AddStacktrace(zap.WarnLevel))&#125;func getOneLogger(encoder zapcore.Encoder, logLevel zapcore.Level, fileFormat string) *zap.Logger &#123;infoWriter := getLoggerWriter(&quot;./log/info&quot;, fileFormat)infoLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123;return lvl == zapcore.InfoLevel &amp;&amp; lvl &gt;= logLevel&#125;)core := zapcore.NewTee(zapcore.NewCore(encoder, zapcore.AddSync(infoWriter), infoLevel),)return zap.New(core, zap.AddCaller(), zap.AddStacktrace(zap.WarnLevel))&#125;func getLoggerWriter(filename, fileFormat string) io.Writer &#123;// ç”Ÿæˆrotatelogsçš„Logger å®é™…ç”Ÿæˆçš„æ–‡ä»¶å file_YYmmddHH.loghook, err := rotatelogs.New(filename+fileFormat+&quot;.log&quot;,rotatelogs.WithLinkName(filename),// ä¿å­˜å¤©æ•°rotatelogs.WithMaxAge(time.Hour*24*30),// åˆ‡å‰²é¢‘ç‡24å°æ—¶rotatelogs.WithRotationTime(time.Hour*24),)if err != nil &#123;log.Println(&quot;æ—¥å¿—å¯åŠ¨å¼‚å¸¸&quot;)panic(err)&#125;return hook&#125;func Debug(format string, v ...interface&#123;&#125;) &#123;Logger.Sugar().Debugf(format, v...)&#125;func Info(format string, v ...interface&#123;&#125;) &#123;Logger.Sugar().Infof(format, v...)&#125;func Error(format string, v ...interface&#123;&#125;) &#123;Logger.Sugar().Errorf(format, v...)&#125;</code></pre></div><p>è¿™é‡Œæ³¨æ„initå‡½æ•°ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨loggerå…¶ä¸­å‡½æ•°å³å¯ï¼Œç¨‹åºåŠ è½½åŒ…çš„è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨æ‰§è¡Œinitå‡½æ•°ã€‚å…³äºinitæœ‰ä»¥ä¸‹è¯´æ˜ï¼š</p><ol><li>initå‡½æ•°æ˜¯ç”¨äºç¨‹åºæ‰§è¡Œå‰åšåŒ…çš„åˆå§‹åŒ–çš„å‡½æ•°ï¼Œæ¯”å¦‚åˆå§‹åŒ–åŒ…é‡Œçš„å˜é‡ç­‰</li><li>æ¯ä¸ªåŒ…å¯ä»¥æ‹¥æœ‰å¤šä¸ªinitå‡½æ•°</li><li>åŒ…çš„æ¯ä¸ªæºæ–‡ä»¶ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªinitå‡½æ•°</li><li>åŒä¸€ä¸ªåŒ…ä¸­å¤šä¸ªinitå‡½æ•°çš„æ‰§è¡Œé¡ºåºgoè¯­è¨€æ²¡æœ‰æ˜ç¡®çš„å®šä¹‰(è¯´æ˜)</li><li>ä¸åŒåŒ…çš„initå‡½æ•°æŒ‰ç…§åŒ…å¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šè¯¥åˆå§‹åŒ–å‡½æ•°çš„æ‰§è¡Œé¡ºåº</li><li>initå‡½æ•°ä¸èƒ½è¢«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨mainå‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œè‡ªåŠ¨è¢«è°ƒç”¨</li></ol><p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ï¼š</p><div class="code-wrapper"><pre><code class="hljs go">logger.Info(<span class="hljs-string">&quot;i&#x27;m log123-----Info&quot;</span>)logger.Error(<span class="hljs-string">&quot;i&#x27;m log123-----Error&quot;</span>)</code></pre></div><p><img src="/images/post/v2-9a3fa5680e78075596feedcc5f9669c6_1440w.png" alt="img"></p><h2 id="å¹³æ»‘é‡å¯"><a href="#å¹³æ»‘é‡å¯" class="headerlink" title="å¹³æ»‘é‡å¯"></a>å¹³æ»‘é‡å¯</h2><p>å½“ç¨‹åºåœ¨çº¿ä¸Šç¨³å®šè¿è¡Œåï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå»æ›´æ–°ä¸€äº›åŠŸèƒ½ï¼Œä½†å‘å¸ƒä»£ç çš„åŒæ—¶ï¼Œå‡å¦‚æœ‰ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ï¼Œç›²ç›®å‘å¸ƒä»£ç å¯èƒ½ä¼šé€ æˆç”¨æˆ·çŸ­æš‚å¤±çœŸï¼Œè¿™æ—¶å€™å¹³æ»‘é‡å¯å°±æ¥äº†ã€‚</p><p>å¯¹äºå¹³æ»‘é‡å¯ï¼Œå…¶å®æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬åªä»è‡ªèº«ä»£ç çº§åˆ«æ¥å®Œæˆï¼Œè€Œå³ä¾¿æ˜¯ä»£ç çº§åˆ«ï¼Œç›®å‰ä¹Ÿæœ‰å¤šç§å®ç°æ–¹æ¡ˆï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹åº“endlessè¿™ç§ï¼Œæˆ‘è¿™é‡Œä¸»è¦å‚è€ƒäº†</p><p><a href="https://github.com/kuangchanglang/graceful">https://github.com/kuangchanglang/gracefulgithub.com/kuangchanglang/graceful</a></p><p>ç®€å•è¯´æ˜ä¸‹å¤„ç†æ­¥éª¤ï¼š</p><ol><li>ç›‘å¬ä¿¡å·ï¼ˆUSR2ï¼Œå¯è‡ªå®šä¹‰å…¶ä»–ä¿¡å·ï¼‰</li><li>æ”¶åˆ°ä¿¡å·æ—¶forkå­è¿›ç¨‹ï¼ˆä½¿ç”¨ç›¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼‰ï¼Œå°†æœåŠ¡ç›‘å¬çš„socketæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹</li><li>å­è¿›ç¨‹ç›‘å¬çˆ¶è¿›ç¨‹çš„socketï¼Œè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½å¯ä»¥æ¥æ”¶è¯·æ±‚</li><li>å­è¿›ç¨‹å¯åŠ¨æˆåŠŸä¹‹åï¼Œçˆ¶è¿›ç¨‹åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œç­‰å¾…æ—§è¿æ¥å¤„ç†å®Œæˆï¼ˆæˆ–è¶…æ—¶ï¼‰</li><li>çˆ¶è¿›ç¨‹é€€å‡ºï¼Œé‡å¯å®Œæˆ</li></ol><p>è¯¦ç»†åˆ†æå¯çœ‹åº•éƒ¨å‚è€ƒ-GolangæœåŠ¡å™¨çƒ­é‡å¯ã€çƒ­å‡çº§ã€çƒ­æ›´æ–°ã€‚</p><h2 id="å¯åŠ¨æ£€æŸ¥"><a href="#å¯åŠ¨æ£€æŸ¥" class="headerlink" title="å¯åŠ¨æ£€æŸ¥"></a>å¯åŠ¨æ£€æŸ¥</h2><p>ç»“åˆä¸Šé¢çš„ä¼˜é›…é‡å¯ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨æ—¶é…ç½®ä¸Šå¯åŠ¨å¥åº·æ£€æŸ¥ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-comment">// import è¿™é‡Œæˆ‘ä¹ æƒ¯æŠŠå®˜æ–¹åº“ï¼Œå¼€æºåº“ï¼Œæœ¬åœ°moduleä¾æ¬¡åˆ†å¼€åˆ—å‡º</span><span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;errors&quot;</span><span class="hljs-string">&quot;net/http&quot;</span>    <span class="hljs-string">&quot;github.com/spf13/pflag&quot;</span>    <span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/config&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/db&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/router&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/logger&quot;</span>    <span class="hljs-string">&quot;local.com/sai0556/demo2-gin-frame/graceful&quot;</span>)<span class="hljs-keyword">var</span> (    conf = pflag.StringP(<span class="hljs-string">&quot;config&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;config filepath&quot;</span>))<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    pflag.Parse()    <span class="hljs-comment">// åˆå§‹åŒ–é…ç½®</span>    <span class="hljs-keyword">if</span> err := config.Run(*conf); err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-built_in">panic</span>(err)&#125;<span class="hljs-comment">// logger.Info(&quot;i&#x27;m log123-----Info&quot;)</span><span class="hljs-comment">// logger.Error(&quot;i&#x27;m log123-----Error&quot;)</span><span class="hljs-comment">// è¿æ¥mysqlæ•°æ®åº“</span>DB := db.GetDB()<span class="hljs-keyword">defer</span> db.CloseDB(DB)<span class="hljs-comment">// Redis</span>db.InitRedis()gin.SetMode(viper.GetString(<span class="hljs-string">&quot;mode&quot;</span>))g := gin.New()g = router.Load(g)<span class="hljs-comment">// g.Run(viper.GetString(&quot;addr&quot;))</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">if</span> err := pingServer(); err != <span class="hljs-literal">nil</span> &#123;fmt.Println(<span class="hljs-string">&quot;fail:å¥åº·æ£€æµ‹å¤±è´¥&quot;</span>, err)&#125;fmt.Println(<span class="hljs-string">&quot;success:å¥åº·æ£€æµ‹æˆåŠŸ&quot;</span>)&#125;()logger.Info(<span class="hljs-string">&quot;å¯åŠ¨httpæœåŠ¡ç«¯å£%s\n&quot;</span>, viper.GetString(<span class="hljs-string">&quot;addr&quot;</span>))<span class="hljs-keyword">if</span> err := graceful.ListenAndServe(viper.GetString(<span class="hljs-string">&quot;addr&quot;</span>), g); err != <span class="hljs-literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;logger.Error(<span class="hljs-string">&quot;fail:httpæœåŠ¡å¯åŠ¨å¤±è´¥: %s\n&quot;</span>, err)&#125;&#125;<span class="hljs-comment">// å¥åº·æ£€æŸ¥</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pingServer</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; viper.GetInt(<span class="hljs-string">&quot;max_ping_count&quot;</span>); i++ &#123;url := fmt.Sprintf(<span class="hljs-string">&quot;%s%s%s&quot;</span>, <span class="hljs-string">&quot;http://127.0.0.1&quot;</span>, viper.GetString(<span class="hljs-string">&quot;addr&quot;</span>), viper.GetString(<span class="hljs-string">&quot;healthCheck&quot;</span>))fmt.Println(url)resp, err := http.Get(url)<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &amp;&amp; resp.StatusCode == <span class="hljs-number">200</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;time.Sleep(time.Second)&#125;<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;å¥åº·æ£€æµ‹404&quot;</span>)&#125;</code></pre></div><p>è¿™é‡Œå°±æ¯”è¾ƒç®€å•ï¼Œå¦å¤–å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå»pingå¥åº·æ£€æµ‹çš„urlå³å¯ã€‚</p><h2 id="æ‰“åŒ…è„šæœ¬"><a href="#æ‰“åŒ…è„šæœ¬" class="headerlink" title="æ‰“åŒ…è„šæœ¬"></a>æ‰“åŒ…è„šæœ¬</h2><p>shell</p><div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span>SERVER=<span class="hljs-string">&quot;demo2-gin-frame&quot;</span><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">status</span></span>() &#123;<span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;`pgrep <span class="hljs-variable">$SERVER</span> -u <span class="hljs-variable">$UID</span>`&quot;</span> != <span class="hljs-string">&quot;&quot;</span> ];<span class="hljs-keyword">then</span><span class="hljs-built_in">echo</span> <span class="hljs-variable">$SERVER</span> is running<span class="hljs-keyword">else</span><span class="hljs-built_in">echo</span> <span class="hljs-variable">$SERVER</span> is not running<span class="hljs-keyword">fi</span>&#125;<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">build</span></span>() &#123;<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;build...&quot;</span>    CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ./<span class="hljs-variable">$SERVER</span> main.go    <span class="hljs-keyword">if</span> [ $? -ne <span class="hljs-string">&quot;0&quot;</span> ];<span class="hljs-keyword">then</span>          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;built error!!!&quot;</span>        <span class="hljs-built_in">return</span>     <span class="hljs-keyword">fi</span>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;built success!&quot;</span>&#125;<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-keyword">in</span><span class="hljs-string">&#x27;status&#x27;</span>)status;;     <span class="hljs-string">&#x27;build&#x27;</span>)build;;  *)  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;unknown, please: <span class="hljs-variable">$0</span> &#123;status or build&#125;&quot;</span><span class="hljs-built_in">exit</span> 1;;  <span class="hljs-keyword">esac</span></code></pre></div><p>bat</p><div class="code-wrapper"><pre><code class="hljs powershell"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;build...&quot;</span><span class="hljs-built_in">SET</span> CGO_ENABLED=<span class="hljs-number">0</span><span class="hljs-built_in">SET</span> GOOS=linuxgo build <span class="hljs-literal">-o</span> demo2<span class="hljs-literal">-gin</span><span class="hljs-literal">-frame</span><span class="hljs-keyword">if</span> %errorlevel% == <span class="hljs-number">0</span> (    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;built successfully&quot;</span>) <span class="hljs-keyword">else</span> (    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;built fail!!!&quot;</span>)</code></pre></div><p>å¯¹äºç¨‹åºçš„é‡å¯å’Œä¿æ´»ï¼Œå»ºè®®é…åˆsupervisorä½¿ç”¨ã€‚</p><p>å¥½ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬çš„round 2å°±ç»“æŸäº†ã€‚ä¸‹ä¸€è½®æˆ‘ä»¬æ¥ç©ç©é’‰é’‰æ™ºèƒ½æœºå™¨äººã€‚</p><p><a href="https://github.com/13sai/go-example/tree/main/demo2-gin-frame">ç‚¹å‡»ç›´è¾¾å®Œæ•´ä»£ç </a></p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://studygolang.com/articles/26642">golang zap æ—¥å¿—åº“ä½¿ç”¨ï¼ˆå«æ–‡ä»¶åˆ‡å‰²ã€åˆ†çº§åˆ«å­˜å‚¨å’Œå…¨å±€ä½¿ç”¨ç­‰ï¼‰</a></li><li><a href="https://juejin.im/book/6844733730678898702">åŸºäºGoè¯­è¨€æ„å»ºä¼ä¸šçº§çš„ RESTful API æœåŠ¡</a></li><li><a href="https://studygolang.com/articles/16671">golang initå‡½æ•° - Goè¯­è¨€ä¸­æ–‡ç½‘ - Golangä¸­æ–‡ç¤¾åŒº</a></li><li><a href="https://www.cnblogs.com/sunsky303/p/9778466.html">GolangæœåŠ¡å™¨çƒ­é‡å¯ã€çƒ­å‡çº§ã€çƒ­æ›´æ–°(safe and graceful hot-restart/reload http server)è¯¦è§£</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é˜²æ­¢æ¼æ‰“å¡ï¼Œåˆ©ç”¨ginå’Œcronæ¥åšä¸€ä¸ªæ™ºèƒ½æé†’</title>
    <link href="/2021/02/12/goexample3/"/>
    <url>/2021/02/12/goexample3/</url>
    
    <content type="html"><![CDATA[<p>ç›®æ ‡ï¼š</p><ul><li>æ¯å¤©10ç‚¹æé†’æˆ‘æ‰“å¡</li><li>æŸ¥è¯¢æ­å·å¤©æ°”</li></ul><p>ä½¿ç”¨çš„åº“ï¼š</p><ul><li><a href="https://github.com/robfig/cron">github.com/robfig/cron</a></li></ul><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>round2é‡Œé¢æˆ‘ä»¬åšäº†ä¸ªæ¡†æ¶ï¼Œæˆ‘ä»¬ä¸å¦¨ä»¥æ­¤ä¸ºåŸºç¡€ï¼Œæ¥å®Œæˆè¿™ä¸ªdemoã€‚æˆ‘ä»¬é€šè¿‡è§£æä¸åŒæ—¶æ®µçš„æé†’ä»»åŠ¡ï¼Œè§„å¾‹åœ°å­˜å‚¨åˆ°Redisçš„æœ‰åºé›†åˆï¼Œ10så»æŸ¥è¯¢ä¸€æ¬¡æœ‰æ²¡æœ‰éœ€è¦æé†’çš„ä»»åŠ¡ï¼Œå¦‚æœ‰å‘é€åˆ°é’‰é’‰ã€‚</p><blockquote><p>(ä»£ç é¢å¤–è¯´æ˜ï¼šRedisæˆ‘æ›´æ–°æˆäº†v8ç‰ˆæœ¬ï¼Œå‘½ä»¤å‰éœ€è¦åŠ ä¸Šä¸‹æ–‡ï¼Œæ³¨æ„ä¸€ä¸‹)</p></blockquote><h2 id="æ¥å…¥é’‰é’‰æœºå™¨äºº"><a href="#æ¥å…¥é’‰é’‰æœºå™¨äºº" class="headerlink" title="æ¥å…¥é’‰é’‰æœºå™¨äºº"></a>æ¥å…¥é’‰é’‰æœºå™¨äºº</h2><p><a href="https://ding-doc.dingtalk.com/doc%23/serverapi2/qf2nxq">é’‰é’‰æœºå™¨äººæ–‡æ¡£</a></p><p>æŒ‰ç…§æ–‡æ¡£åœ¨ç¾¤é‡Œæ–°å»ºæœºå™¨äººå³å¯ã€‚æˆ‘å¼€å¯çš„æ˜¯webhookè‡ªå®šä¹‰æœºå™¨äººï¼Œoutgoingæé€åœ°å€å°±æ˜¯é¡¹ç›®æ¥æ”¶ä¿¡æ¯åœ°å€ï¼Œæ¯”å¦‚ï¼š<a href="https://cron.13sai.com/dingdingPost">http://cron.13sai.com/dingdingPost</a></p><blockquote><p>å»ºè®®è®¾ç½®æˆåŠ ç­¾æˆ–ipé™åˆ¶ï¼Œä»¥é˜²è¢«æ¶æ„æ”»å‡»</p></blockquote><h2 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h2><div class="code-wrapper"><pre><code class="hljs text">// util/common.go// å°±åˆ—äº†ä¸€äº›å¸¸è§çš„ï¼Œå¯è‡ªè¡Œæ‰©å±•func UpdateKeywords() &#123;Redis := model.RedisClient.Pipeline()key := KeyWordsRedis.HSet(model.Ctx, key, &quot;åˆ†é’Ÿå&quot;, &quot;1|60&quot;)Redis.HSet(model.Ctx, key, &quot;æ—¶å&quot;, &quot;1|3600&quot;)Redis.HSet(model.Ctx, key, &quot;å¤©å&quot;, &quot;1|86400&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å¤©&quot;, &quot;-1|1&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å‘¨ä¸€&quot;, &quot;2|0&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å‘¨äºŒ&quot;, &quot;2|1&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å‘¨ä¸‰&quot;, &quot;2|2&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å‘¨å››&quot;, &quot;2|3&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å‘¨äº”&quot;, &quot;2|4&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å‘¨å…­&quot;, &quot;2|5&quot;)Redis.HSet(model.Ctx, key, &quot;æ¯å‘¨æ—¥&quot;, &quot;2|6&quot;)Redis.HSet(model.Ctx, key, &quot;å‘¨ä¸€&quot;, &quot;3|0&quot;)Redis.HSet(model.Ctx, key, &quot;å‘¨äºŒ&quot;, &quot;3|1&quot;)Redis.HSet(model.Ctx, key, &quot;å‘¨ä¸‰&quot;, &quot;3|2&quot;)Redis.HSet(model.Ctx, key, &quot;å‘¨å››&quot;, &quot;3|3&quot;)Redis.HSet(model.Ctx, key, &quot;å‘¨äº”&quot;, &quot;3|4&quot;)Redis.HSet(model.Ctx, key, &quot;å‘¨å…­&quot;, &quot;3|5&quot;)...Redis.HSet(model.Ctx, key, &quot;ä»Šå¤©&quot;, &quot;4|0&quot;)Redis.HSet(model.Ctx, key, &quot;æ˜å¤©&quot;, &quot;4|1&quot;)Redis.HSet(model.Ctx, key, &quot;åå¤©&quot;, &quot;4|2&quot;)Redis.HSet(model.Ctx, key, &quot;å–æ¶ˆ&quot;, &quot;0|0&quot;)Redis.Exec(model.Ctx)&#125;</code></pre></div><p>å…³é”®å­—ï¼Œå¯ä»¥è‡ªè¡Œæ‰©å±•ï¼Œå¯èƒ½ä¼šæœ‰è¦†ç›–çš„æƒ…å†µï¼Œè¿™é‡Œéœ€è¦æŠ‰æ‹©ï¼Œæ˜¯åŒ¹é…ç¬¬ä¸€ä¸ªè¿˜æ˜¯åŒ¹é…å­—æ•°æœ€å¤šçš„ï¼Œæˆ‘æ­¤å¤„é€‰æ‹©åè€…çš„ã€‚</p><h3 id="è§£æå†…å®¹"><a href="#è§£æå†…å®¹" class="headerlink" title="è§£æå†…å®¹"></a><strong>è§£æå†…å®¹</strong></h3><p>é’‰é’‰æ–‡æ¡£çš„outgoingè¯´æ˜ä¸å…¨ï¼Œæˆ–è€…æ˜¯è—åœ¨å“ªé‡Œæˆ‘æ²¡æ‰¾åˆ°ï¼Œå¯ä»¥ä½¿ç”¨@æœºå™¨äººæ¥æ”¶ä¿¡æ¯æ‰“å°çœ‹ä¸€ä¸‹ã€‚</p><div class="code-wrapper"><pre><code class="hljs text">//å…³æ³¨senderIdå‘é€äººidï¼Œtextå‘é€å†…å®¹ï¼ŒsenderNickå‘é€äººæ˜µç§°å³å¯&#123;    &quot;conversationId&quot;:&quot;xxx&quot;,    &quot;atUsers&quot;:[        &#123;            &quot;dingtalkId&quot;:&quot;xxx&quot;        &#125;],    &quot;chatbotUserId&quot;:&quot;xxx&quot;,    &quot;msgId&quot;:&quot;xxx&quot;,    &quot;senderNick&quot;:&quot;sai0556&quot;,    &quot;isAdmin&quot;:false,    &quot;sessionWebhookExpiredTime&quot;:1594978626787,    &quot;createAt&quot;:1594973226742,    &quot;conversationType&quot;:&quot;2&quot;,    &quot;senderId&quot;:&quot;xxx&quot;,    &quot;conversationTitle&quot;:&quot;æ™ºèƒ½å¤‡å¿˜å½•&quot;,    &quot;isInAtList&quot;:true,    &quot;sessionWebhook&quot;:&quot;xxx&quot;,    &quot;text&quot;:&#123;        &quot;content&quot;:&quot; hello gin-frame&quot;    &#125;,    &quot;msgtype&quot;:&quot;text&quot;&#125;</code></pre></div><p>å®šä¹‰ä¸€ä¸ªstructï¼Œæ¥æ”¶æ¶ˆæ¯</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> DingDingMsgContent <span class="hljs-keyword">struct</span> &#123;SenderNick <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;senderNick&quot;`</span>SenderId <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;senderId&quot;`</span>Text <span class="hljs-keyword">struct</span> &#123;Content <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;content&quot;`</span>&#125; <span class="hljs-string">`json:&quot;text&quot;`</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DingDing</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;data, _ := ioutil.ReadAll(c.Request.Body)form := DingDingMsgContent&#123;&#125;err := json.Unmarshal([]<span class="hljs-keyword">byte</span>(data), &amp;form)<span class="hljs-comment">// err := c.ShouldBindJSON(&amp;form)</span><span class="hljs-keyword">if</span>  err != <span class="hljs-literal">nil</span> &#123;fmt.Println(err)<span class="hljs-keyword">return</span>&#125;....&#125;</code></pre></div><p>è§£æï¼Œæ³¨æ„å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ç»‘å®šæ‰‹æœºï¼Œå–æ¶ˆä»»åŠ¡ç­‰ï¼Œåšå¯¹åº”çš„ç‰¹æ®Šå¤„ç†ï¼Œç»‘å®šæ‰‹æœºæ˜¯ä¸ºäº†@ æŸäººï¼Œå¦åˆ™æ¶ˆæ¯å®¹æ˜“è¢«å¿½ç•¥ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">parseContent</span><span class="hljs-params">(form DingDingMsgContent)</span> <span class="hljs-params">(err error)</span></span> &#123;str := form.Text.ContentRedis := db.RedisClientfmt.Println(str)<span class="hljs-comment">// è¦å…ˆç»‘å®šå“Ÿï¼Œä¸ç„¶æ— æ³•@åˆ°å¯¹åº”çš„äºº</span>index := strings.Index(str, <span class="hljs-string">&quot;ç»‘å®šæ‰‹æœº&quot;</span>)<span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">-1</span> &#123;reg := regexp.MustCompile(<span class="hljs-string">&quot;1[0-9]&#123;10&#125;&quot;</span>)res := reg.FindAllString(str, <span class="hljs-number">1</span>)<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &lt; <span class="hljs-number">1</span> || res[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;&quot;</span> &#123;err = errors.New(<span class="hljs-string">&quot;æ‰‹æœºæ ¼å¼ä¸æ­£ç¡®&quot;</span>)<span class="hljs-keyword">return</span>&#125;Redis.HSet(db.Ctx, util.KeyDingDingID, form.SenderId, res[<span class="hljs-number">0</span>])util.SendDD(<span class="hljs-string">&quot;ç»‘å®šæˆåŠŸ&quot;</span>)<span class="hljs-keyword">return</span>&#125;hExist := Redis.HExists(db.Ctx, util.KeyDingDingID, form.SenderId)<span class="hljs-keyword">if</span> !hExist.Val() &#123;err = errors.New(<span class="hljs-string">&quot;ç»‘å®šæ‰‹æœºå·æ‰èƒ½ç²¾ç¡®æé†’å“¦ï¼Œå‘é€--ç»‘å®šæ‰‹æœº 13456567878--@æˆ‘å³å¯&quot;</span>)<span class="hljs-keyword">return</span> &#125;index = strings.Index(util.StrSub(str, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>), <span class="hljs-string">&quot;æˆ‘çš„æé†’&quot;</span>)fmt.Println(index, <span class="hljs-string">&quot;---&quot;</span>, util.StrSub(str, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>))<span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">-1</span> &#123;www := util.QueryAllQueue(form.SenderId);<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(www) &lt; <span class="hljs-number">1</span> &#123;err = errors.New(<span class="hljs-string">&quot;æš‚æ— ä»»åŠ¡&quot;</span>)<span class="hljs-keyword">return</span>&#125; msg := <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> key,value := <span class="hljs-keyword">range</span> www &#123;fmt.Println(strings.Index(value, <span class="hljs-string">&quot;@&quot;</span>))value := value[<span class="hljs-number">0</span>:strings.Index(value, <span class="hljs-string">&quot;@&quot;</span>)]fmt.Println(value)msg = util.StrCombine(msg, <span class="hljs-string">&quot;ä»»åŠ¡idï¼š&quot;</span>, key, <span class="hljs-string">&quot;ï¼Œä»»åŠ¡å†…å®¹ï¼š&quot;</span>, value, <span class="hljs-string">&quot;&#123;br&#125;&quot;</span>)&#125;err = errors.New(msg)<span class="hljs-keyword">return</span>&#125;index = strings.Index(util.StrSub(str, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>), <span class="hljs-string">&quot;æŸ¥çœ‹ä»»åŠ¡&quot;</span>)fmt.Println(index, <span class="hljs-string">&quot;---&quot;</span>, util.StrSub(str, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>))<span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">-1</span> &#123;www := util.QueryAllQueue(form.SenderId);<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(www) &lt; <span class="hljs-number">1</span> &#123;err = errors.New(<span class="hljs-string">&quot;æš‚æ— ä»»åŠ¡&quot;</span>)<span class="hljs-keyword">return</span>&#125; msg := <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> key,value := <span class="hljs-keyword">range</span> www &#123;fmt.Println(strings.Index(value, <span class="hljs-string">&quot;@&quot;</span>))value := value[<span class="hljs-number">0</span>:strings.Index(value, <span class="hljs-string">&quot;@&quot;</span>)]fmt.Println(value)msg = util.StrCombine(msg, <span class="hljs-string">&quot;ä»»åŠ¡idï¼š&quot;</span>, key, <span class="hljs-string">&quot;ï¼Œä»»åŠ¡å†…å®¹ï¼š&quot;</span>, value, <span class="hljs-string">&quot;&#123;br&#125;&quot;</span>)&#125;err = errors.New(msg)<span class="hljs-keyword">return</span>&#125;index = strings.Index(util.StrSub(str, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>), <span class="hljs-string">&quot;å–æ¶ˆæ‰€æœ‰ä»»åŠ¡&quot;</span>)fmt.Println(index, <span class="hljs-string">&quot;---&quot;</span>, util.StrSub(str, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>))<span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">-1</span> &#123;<span class="hljs-keyword">if</span> er := util.CancelAllQueue(form.SenderId); er != <span class="hljs-literal">nil</span> &#123;err = er<span class="hljs-keyword">return</span>&#125;err = errors.New(<span class="hljs-string">&quot;å–æ¶ˆæˆåŠŸ&quot;</span>)<span class="hljs-keyword">return</span>&#125;index = strings.Index(util.StrSub(str, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>), <span class="hljs-string">&quot;å–æ¶ˆ&quot;</span>)<span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">-1</span> &#123;reg := regexp.MustCompile(<span class="hljs-string">&quot;[a-z0-9]&#123;32&#125;&quot;</span>)res := reg.FindAllString(str, <span class="hljs-number">1</span>)<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &lt; <span class="hljs-number">1</span> &#123;err = errors.New(<span class="hljs-string">&quot;ä»»åŠ¡idä¸æ­£ç¡®&quot;</span>)<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">if</span> er := util.CancelQueue(res[<span class="hljs-number">0</span>], form.SenderId); er != <span class="hljs-literal">nil</span> &#123;err = er<span class="hljs-keyword">return</span>&#125;err = errors.New(<span class="hljs-string">&quot;å–æ¶ˆæˆåŠŸ&quot;</span>)<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// æé†’å†…å®¹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">tips</span><span class="hljs-params">(form DingDingMsgContent)</span> <span class="hljs-params">(err error)</span></span>  &#123;rd := db.RedisClientstr := form.Text.Contentmobile := rd.HGet(db.Ctx, util.KeyDingDingID, form.SenderId).Val()key := util.KeyWordslist, _ := rd.HGetAll(db.Ctx, key).Result()now := time.Now().Unix()tipsType := <span class="hljs-number">1</span>k := <span class="hljs-string">&quot;&quot;</span>v := <span class="hljs-string">&quot;&quot;</span>fmt.Println(<span class="hljs-string">&quot;str&quot;</span>, str)index := <span class="hljs-number">0</span><span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> list &#123;index = util.UnicodeIndex(str, key)<span class="hljs-keyword">if</span> index &gt; <span class="hljs-number">-1</span> &amp;&amp; util.StrLen(key) &gt; util.StrLen(k) &#123;fmt.Println(<span class="hljs-string">&quot;index&quot;</span>, index, str, key, value)k = keyv = value&#125;&#125;msg := <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">var</span> score <span class="hljs-keyword">int64</span><span class="hljs-keyword">if</span> k != <span class="hljs-string">&quot;&quot;</span> &#123;kLen := util.StrLen(k)msg = util.StrSub(str, index+kLen)val := strings.Split(v, <span class="hljs-string">&quot;|&quot;</span>)unit := val[<span class="hljs-number">1</span>]units,_ := strconv.Atoi(unit)<span class="hljs-keyword">switch</span> val[<span class="hljs-number">0</span>] &#123;<span class="hljs-comment">// å¤šå°‘æ—¶é—´å</span><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;1&quot;</span>:reg := regexp.MustCompile(<span class="hljs-string">&quot;[0-9]&#123;1,2&#125;&quot;</span>)res := reg.FindAllString(str, <span class="hljs-number">1</span>)minute, _ := strconv.Atoi(res[<span class="hljs-number">0</span>])score = now + <span class="hljs-keyword">int64</span>(units*minute)<span class="hljs-comment">// æ¯å‘¨</span><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;2&quot;</span>:reg := regexp.MustCompile(<span class="hljs-string">&quot;[0-9]&#123;1,2&#125;&quot;</span>)res := reg.FindAllString(util.StrSub(msg, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>), <span class="hljs-number">-1</span>)hour := <span class="hljs-number">9</span>minute := <span class="hljs-number">0</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">0</span> &#123;hour, _ = strconv.Atoi(res[<span class="hljs-number">0</span>])&#125;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">1</span> &#123;minute, _ = strconv.Atoi(res[<span class="hljs-number">1</span>])&#125;now = util.GetWeekTS(<span class="hljs-keyword">int64</span>(units))score = now + <span class="hljs-keyword">int64</span>(<span class="hljs-number">60</span>*minute + <span class="hljs-number">3600</span>*hour)tipsType = <span class="hljs-number">2</span><span class="hljs-comment">// ä¸‹å‘¨</span><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;3&quot;</span>:reg := regexp.MustCompile(<span class="hljs-string">&quot;[0-9]&#123;1,2&#125;&quot;</span>)res := reg.FindAllString(util.StrSub(msg, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>), <span class="hljs-number">-1</span>)hour := <span class="hljs-number">9</span>minute := <span class="hljs-number">0</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">0</span> &#123;hour, _ = strconv.Atoi(res[<span class="hljs-number">0</span>])&#125;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">1</span> &#123;minute, _ = strconv.Atoi(res[<span class="hljs-number">1</span>])&#125;now = util.TodayTS()score = now + <span class="hljs-keyword">int64</span>(<span class="hljs-number">60</span>*minute + <span class="hljs-number">3600</span>*hour + units*<span class="hljs-number">86400</span>)<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;4&quot;</span>:reg := regexp.MustCompile(<span class="hljs-string">&quot;[0-9]&#123;1,2&#125;&quot;</span>)res := reg.FindAllString(util.StrSub(msg, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>), <span class="hljs-number">-1</span>)hour := <span class="hljs-number">9</span>minute := <span class="hljs-number">0</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">0</span> &#123;hour, _ = strconv.Atoi(res[<span class="hljs-number">0</span>])&#125;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">1</span> &#123;minute, _ = strconv.Atoi(res[<span class="hljs-number">1</span>])&#125;now = util.TodayTS() + <span class="hljs-number">86400</span>*<span class="hljs-keyword">int64</span>(units)score = now + <span class="hljs-keyword">int64</span>(<span class="hljs-number">60</span>*minute + <span class="hljs-number">3600</span>*hour)<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;-1&quot;</span>: reg := regexp.MustCompile(<span class="hljs-string">&quot;[0-9]&#123;1,10&#125;&quot;</span>)res := reg.FindAllString(util.StrSub(msg, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>), <span class="hljs-number">-1</span>)fmt.Println(<span class="hljs-string">&quot;res&quot;</span>, res)hour := <span class="hljs-number">9</span>minute := <span class="hljs-number">0</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">0</span> &#123;hour, _ = strconv.Atoi(res[<span class="hljs-number">0</span>])&#125;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">1</span> &#123;minute, _ = strconv.Atoi(res[<span class="hljs-number">1</span>])&#125;now = util.TodayTS() + <span class="hljs-number">86400</span>score = now + <span class="hljs-keyword">int64</span>(<span class="hljs-number">60</span>*minute + <span class="hljs-number">3600</span>*hour)fmt.Println(now, score, minute, hour)tipsType = <span class="hljs-number">3</span><span class="hljs-keyword">default</span>:&#125;&#125; <span class="hljs-keyword">else</span> &#123;reg := regexp.MustCompile(<span class="hljs-string">&quot;(([0-9]&#123;4&#125;)[-|/|å¹´])?([0-9]&#123;1,2&#125;)[-|/|æœˆ]([0-9]&#123;1,2&#125;)æ—¥?&quot;</span>)pi := reg.FindAllStringSubmatch(str, <span class="hljs-number">-1</span>)<span class="hljs-keyword">if</span> (<span class="hljs-built_in">len</span>(pi) &gt; <span class="hljs-number">0</span> ) &#123;date := pi[<span class="hljs-number">0</span>]<span class="hljs-keyword">if</span> date[<span class="hljs-number">2</span>] == <span class="hljs-string">&quot;&quot;</span> &#123;date[<span class="hljs-number">2</span>] = <span class="hljs-string">&quot;2020&quot;</span>&#125;location, _ := time.LoadLocation(<span class="hljs-string">&quot;Asia/Shanghai&quot;</span>)tm2, _ := time.ParseInLocation(<span class="hljs-string">&quot;2006/01/02&quot;</span>, fmt.Sprintf(<span class="hljs-string">&quot;%s/%s/%s&quot;</span>, date[<span class="hljs-number">2</span>], date[<span class="hljs-number">3</span>], date[<span class="hljs-number">4</span>]), location)score = util.GetZeroTime(tm2).Unix()msg = reg.ReplaceAllString(str, <span class="hljs-string">&quot;&quot;</span>)fmt.Println(msg)&#125; <span class="hljs-keyword">else</span> &#123;msg = strscore = util.TodayTS()&#125;reg = regexp.MustCompile(<span class="hljs-string">&quot;[0-9]&#123;1,10&#125;&quot;</span>)res := reg.FindAllString(util.StrSub(msg, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>), <span class="hljs-number">-1</span>)fmt.Println(<span class="hljs-string">&quot;res&quot;</span>, res)hour := <span class="hljs-number">9</span>minute := <span class="hljs-number">0</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt;= <span class="hljs-number">1</span> &#123;hour, _ = strconv.Atoi(res[<span class="hljs-number">0</span>])fmt.Println(<span class="hljs-string">&quot;hour&quot;</span>, hour, minute)&#125;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &gt; <span class="hljs-number">1</span> &#123;minute, _ = strconv.Atoi(res[<span class="hljs-number">1</span>])&#125;score += <span class="hljs-keyword">int64</span>(<span class="hljs-number">60</span>*minute + <span class="hljs-number">3600</span>*hour)&#125;<span class="hljs-keyword">if</span> msg == <span class="hljs-string">&quot;&quot;</span> &#123;err = errors.New(<span class="hljs-string">&quot;ä½ è¯´å•¥&quot;</span>)<span class="hljs-keyword">return</span>&#125;index = util.UnicodeIndex(msg, <span class="hljs-string">&quot;æé†’æˆ‘&quot;</span>)index2 := util.UnicodeIndex(msg, <span class="hljs-string">&quot;æé†’&quot;</span>)<span class="hljs-keyword">if</span> index2 &lt; <span class="hljs-number">0</span> &#123;err = errors.New(<span class="hljs-string">&quot;å¤§å“¥ï¼Œè¦æˆ‘æé†’ä½ å¹²å•¥å‘¢ï¼Ÿè¯·å‘é€--ä¸‹å‘¨ä¸€13ç‚¹æé†’æˆ‘å†™ä½œä¸š&quot;</span>)<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">if</span> index &lt; <span class="hljs-number">0</span> &amp;&amp; index2 &gt; <span class="hljs-number">-1</span> &#123;msg = util.StrSub(msg, index2+<span class="hljs-number">2</span>)&#125; <span class="hljs-keyword">else</span> &#123;msg = util.StrSub(msg, index+<span class="hljs-number">3</span>)&#125; fmt.Println(msg, mobile)msg = util.StrCombine(msg, <span class="hljs-string">&quot;@&quot;</span>, mobile)fmt.Println(score, msg, tipsType, err)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;util.SendDD(err.Error())<span class="hljs-keyword">return</span>&#125;member := util.StrCombine(strconv.Itoa(tipsType), msg)rd.ZAdd(db.Ctx, util.KeyCrontab, &amp;Redis.Z&#123;Score: <span class="hljs-keyword">float64</span>(score),Member: member,&#125;)uniqueKey := util.Md5(member)rd.HSet(db.Ctx, util.StrCombine(util.KeyUserCron, form.SenderId), uniqueKey, member)util.SendDD(fmt.Sprintf(<span class="hljs-string">&quot;è®¾ç½®æˆåŠŸ(å–æ¶ˆè¯·å›å¤ï¼šå–æ¶ˆä»»åŠ¡%s)--%sæé†’æ‚¨%s&quot;</span>, uniqueKey, time.Unix(score, <span class="hljs-number">0</span>).Format(<span class="hljs-string">&quot;2006/01/02 15:04:05&quot;</span>), msg))<span class="hljs-keyword">return</span> &#125;</code></pre></div><h3 id="å‘é€é’‰é’‰æ¶ˆæ¯"><a href="#å‘é€é’‰é’‰æ¶ˆæ¯" class="headerlink" title="å‘é€é’‰é’‰æ¶ˆæ¯"></a><strong>å‘é€é’‰é’‰æ¶ˆæ¯</strong></h3><p>è¿™é‡Œå°±æ˜¯å¯¹æ¥é’‰é’‰æ¥å£ï¼Œè§£æç»™éœ€è¦æé†’çš„äººå°±è¡Œï¼Œå°±ä¸åšè¿‡å¤šè¯´æ˜äº†ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SendDD</span><span class="hljs-params">(msg <span class="hljs-keyword">string</span>)</span></span> &#123;        <span class="hljs-comment">// æ‰“å°å‡ºæ¥çœ‹çœ‹æ˜¯ä¸ªå•¥</span>fmt.Println(<span class="hljs-string">&quot;dingding-----------&quot;</span>)fmt.Println(msg)tips := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)content := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)tips[<span class="hljs-string">&quot;msgtype&quot;</span>] = <span class="hljs-string">&quot;markdown&quot;</span>    <span class="hljs-comment">// @ æ˜¯ç”¨æ¥æé†’ç¾¤é‡Œå¯¹åº”çš„äºº</span>arr := strings.Split(msg, <span class="hljs-string">&quot;@&quot;</span>)    <span class="hljs-comment">// [æé†’]æ˜¯æœºå™¨äººå…³é”®å­—ï¼Œä¸ªäººå»ºè®®è®¾ç½®æœºå™¨äººé™åˆ¶ipæˆ–ä½¿ç”¨tokenï¼Œæ¯”è¾ƒé è°±</span>content[<span class="hljs-string">&quot;text&quot;</span>] = fmt.Sprintf(<span class="hljs-string">&quot;%s&quot;</span>, strings.Replace(arr[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;&#123;br&#125;&quot;</span>, <span class="hljs-string">&quot; \n\n&quot;</span>, <span class="hljs-number">-1</span>))content[<span class="hljs-string">&quot;title&quot;</span>] = <span class="hljs-string">&quot;é¹…é¹…é¹…&quot;</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(arr) &gt; <span class="hljs-number">1</span> &#123;mobile := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>)at := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;)mobile = <span class="hljs-built_in">append</span>(mobile, arr[<span class="hljs-number">1</span>])at[<span class="hljs-string">&quot;atMobiles&quot;</span>] = mobiletips[<span class="hljs-string">&quot;at&quot;</span>] = atcontent[<span class="hljs-string">&quot;text&quot;</span>] = fmt.Sprintf(<span class="hljs-string">&quot;%s @%s&quot;</span>, content[<span class="hljs-string">&quot;text&quot;</span>], arr[<span class="hljs-number">1</span>])&#125;    tips[<span class="hljs-string">&quot;markdown&quot;</span>] = content    bytesData, err := json.Marshal(tips)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        fmt.Println(err.Error() )        <span class="hljs-keyword">return</span>    &#125;    reader := bytes.NewReader(bytesData)    url := viper.GetString(<span class="hljs-string">&quot;dingding_url&quot;</span>)    request, err := http.NewRequest(<span class="hljs-string">&quot;POST&quot;</span>, url, reader)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span>    &#125;    request.Header.Set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>)    client := http.Client&#123;&#125;    _, err = client.Do(request)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        fmt.Println(err.Error())        <span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// å·æ‡’ä¸é‡è¯•äº†</span>    <span class="hljs-comment">// respBytes, err := ioutil.ReadAll(resp.Body)</span>    <span class="hljs-comment">// if err != nil &#123;</span>    <span class="hljs-comment">//     fmt.Println(err.Error())</span>    <span class="hljs-comment">//     return</span>    <span class="hljs-comment">// &#125;</span>    <span class="hljs-comment">// //byteæ•°ç»„ç›´æ¥è½¬æˆstringï¼Œä¼˜åŒ–å†…å­˜</span>    <span class="hljs-comment">// str := (*string)(unsafe.Pointer(&amp;respBytes))</span>    <span class="hljs-comment">// fmt.Println(*str)</span>&#125;</code></pre></div><h2 id="å®šæ—¶å‘é€ä¸ä»»åŠ¡å–æ¶ˆ"><a href="#å®šæ—¶å‘é€ä¸ä»»åŠ¡å–æ¶ˆ" class="headerlink" title="å®šæ—¶å‘é€ä¸ä»»åŠ¡å–æ¶ˆ"></a><strong>å®šæ—¶å‘é€ä¸ä»»åŠ¡å–æ¶ˆ</strong></h2><p>è¿™å°±æ˜¯å‘é€æé†’çš„æ ¸å¿ƒä»£ç äº†ï¼Œè¯¦ç»†ä½¿ç”¨è¯´æ˜å¯ä»¥çœ‹ä¸‹ï¼š</p><p><a href="https://www.cnblogs.com/liuzhongchao/p/9521897.html">Golang cron å®šæ—¶ä»»åŠ¡ä½¿ç”¨</a></p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Cron</span><span class="hljs-params">()</span></span> &#123;    c := cron.New()    spec := <span class="hljs-string">&quot;*/10 * * * * ?&quot;</span>    c.AddJob(spec, Queue&#123;&#125;)    c.Start()&#125;<span class="hljs-keyword">type</span> Queue <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q Queue)</span> <span class="hljs-title">Run</span><span class="hljs-params">()</span></span> &#123;now := time.Now().Unix()rd := model.RedisClientop := &amp;Redis.ZRangeBy&#123;        Min: <span class="hljs-string">&quot;0&quot;</span>,        Max: strconv.FormatInt(now, <span class="hljs-number">10</span>),    &#125;    ret, err := rd.ZRangeByScoreWithScores(model.Ctx, KeyCrontab, op).Result()    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        fmt.Printf(<span class="hljs-string">&quot;zrangebyscore failed, err:%v\n&quot;</span>, err)        <span class="hljs-keyword">return</span>&#125;    <span class="hljs-keyword">for</span> _, z := <span class="hljs-keyword">range</span> ret &#123;fmt.Println(z.Member.(<span class="hljs-keyword">string</span>), z.Score)QueueDo(z.Member.(<span class="hljs-keyword">string</span>), z.Score)    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">QueueDo</span><span class="hljs-params">(msg <span class="hljs-keyword">string</span>, score <span class="hljs-keyword">float64</span>)</span></span> &#123;msgType := msg[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]SendDD(msg[<span class="hljs-number">1</span>:])rd := model.RedisClientrd.ZRem(model.Ctx, KeyCrontab, msg)<span class="hljs-keyword">switch</span> msgType &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;2&quot;</span>:rd.ZAdd(model.Ctx, KeyCrontab, &amp;Redis.Z&#123;Score: score + <span class="hljs-number">7</span>*<span class="hljs-number">86400</span>,Member: msg,&#125;)<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;3&quot;</span>:rd.ZAdd(model.Ctx, KeyCrontab, &amp;Redis.Z&#123;Score: score + <span class="hljs-number">86400</span>,Member: msg,&#125;)<span class="hljs-keyword">default</span>:rd.ZRem(model.Ctx, KeyCrontab, msg)&#125;&#125;<span class="hljs-comment">// å–æ¶ˆæé†’</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CancelQueue</span><span class="hljs-params">(uniqueKey <span class="hljs-keyword">string</span>, SenderId <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(err error)</span></span> &#123;rd := model.RedisClientmember := rd.HGet(model.Ctx, StrCombine(KeyUserCron, SenderId), uniqueKey).Val()<span class="hljs-keyword">if</span> member == <span class="hljs-string">&quot;&quot;</span> &#123;fmt.Println(StrCombine(KeyUserCron, SenderId), uniqueKey)err = errors.New(<span class="hljs-string">&quot;æ²¡æœ‰æ­¤ä»»åŠ¡&quot;</span>)<span class="hljs-keyword">return</span>&#125;fmt.Println(member, <span class="hljs-string">&quot;member&quot;</span>)rd.ZRem(model.Ctx, KeyCrontab, member)rd.HDel(model.Ctx, StrCombine(KeyUserCron, SenderId), uniqueKey)err = errors.New(<span class="hljs-string">&quot;å–æ¶ˆæˆåŠŸ&quot;</span>)<span class="hljs-keyword">return</span> &#125;<span class="hljs-comment">// å–æ¶ˆæ‰€æœ‰</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CancelAllQueue</span><span class="hljs-params">(SenderId <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(err error)</span></span> &#123;rd := model.RedisClientlist, _ := rd.HGetAll(model.Ctx, StrCombine(KeyUserCron, SenderId)).Result()<span class="hljs-keyword">for</span> _, value := <span class="hljs-keyword">range</span> list &#123;rd.ZRem(model.Ctx, KeyCrontab, value)&#125;rd.Del(model.Ctx, StrCombine(KeyUserCron, SenderId))err = errors.New(<span class="hljs-string">&quot;å·²ç»å–æ¶ˆæ‰€æœ‰æé†’ä»»åŠ¡&quot;</span>)<span class="hljs-keyword">return</span> &#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">QueryAllQueue</span><span class="hljs-params">(SenderId <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)</span></span> &#123;rd := model.RedisClientlist, _ := rd.HGetAll(model.Ctx, StrCombine(KeyUserCron, SenderId)).Result()<span class="hljs-comment">// fmt.Println(list)</span><span class="hljs-keyword">return</span> list&#125;</code></pre></div><p>å¤©æ°”ä¸èŠå¤©ç»™ä½ æ˜¯æ¥äº†ä¸€ä¸ªå…è´¹æ™ºèƒ½æ¥å£ï¼Œæœ‰å…´è¶£å¯æŸ¥çœ‹githubé…ç½®æ–‡ä»¶ã€‚</p><p>æ¥çœ‹çœ‹æ•ˆæœ</p><p><img src="/images/post/v2-3106536c4925af8f77af71698f568a84_1440w.png" alt="img"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªdemoå…¶å®ä¸»è¦ç‚¹å°±æ˜¯è§£æé’‰é’‰æ¨é€å†…å®¹åšå¯¹åº”çš„å¤„ç†ï¼Œå› å…³é”®å­—è¿‡å¤šï¼Œä»£ç å…¶å®æœ‰ç‚¹å•°å—¦ï¼Œä½ å¯ä»¥è‡ªè¡Œä¼˜åŒ–ï¼Œå¯¹æ¥æ™ºèƒ½æ¥å£å’Œé’‰é’‰æ¥å£ï¼Œè¿˜æ˜¯å®šæ—¶ä»»åŠ¡å…¶å®éƒ½æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œå½“ç„¶ï¼Œè¿™åªæ˜¯å¾ˆåŸºç¡€çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥è‡ªè¡Œæ‰©å±•ã€‚å¦å¤–ï¼Œè¿™æ¬¡ä¹‹åˆ—å‡ºäº†ä¸»è¦ä»£ç ï¼Œæ²¡æœ‰åšååˆ†è¯¦å°½çš„è¯´æ˜ï¼Œæœ‰å…´è¶£å¯ä»¥æŸ¥çœ‹æºç ã€‚</p><p><a href="https://github.com/13sai/go-example/tree/main/demo3-dingding">æŸ¥çœ‹githubæºç </a></p><h2 id="å•°å—¦"><a href="#å•°å—¦" class="headerlink" title="å•°å—¦"></a>å•°å—¦</h2><p>è¿™ä¸ªdemoçš„èµ·åˆä¹Ÿæ˜¯æˆ‘ä»¬å‡ ä¸ªåŒäº‹è€å¿˜è®°æ‰“å¡ï¼Œæœ‰äº†è¿™ä¸ªdemoï¼Œèµ·åˆåªèƒ½æé†’æ‰“å¡ï¼Œåé¢é™†ç»­åŠ å…¥äº†å–æ¶ˆã€æŸ¥çœ‹ã€æŸ¥è¯¢å¤©æ°”ç­‰åŠŸèƒ½ï¼Œå¤§å®¶å­¦ä¹ æŠ€æœ¯çš„æ—¶å€™ä¹Ÿå¯ä»¥è€ƒè™‘åº”ç”¨åˆ°ç”Ÿæ´»åœºæ™¯å½“ä¸­ï¼Œè¿™æ ·å­¦ä¹ èµ·æ¥ä¹Ÿæ¯”è¾ƒæœ‰æœ‰è¶£ï¼Œå®è·µä¸­ä¹Ÿä¼šå‘ç°å¾ˆå¤šæƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œæœ€åï¼Œç¥å¤§å®¶å·¥ä½œæ„‰å¿«ï¼Œä¸å¿˜æ‰“å¡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goé¢å‘å¯¹è±¡</title>
    <link href="/2021/02/12/goexample5/"/>
    <url>/2021/02/12/goexample5/</url>
    
    <content type="html"><![CDATA[<blockquote><p>é¢å‘å¯¹è±¡ (Object Oriented,OO) çš„æ€æƒ³å¯¹è½¯ä»¶å¼€å‘ç›¸å½“é‡è¦ï¼Œå®ƒçš„æ¦‚å¿µå’Œåº”ç”¨ç”šè‡³å·²è¶…è¶Šäº†ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å¼€å‘ï¼Œæ‰©å±•åˆ°å¦‚æ•°æ®åº“ç³»ç»Ÿã€äº¤äº’å¼ç•Œé¢ã€åº”ç”¨ç»“æ„ã€åº”ç”¨å¹³å°ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€ç½‘ç»œç®¡ç†ç»“æ„ã€CAD æŠ€æœ¯ã€äººå·¥æ™ºèƒ½ç­‰é¢†åŸŸã€‚é¢å‘å¯¹è±¡æ˜¯ä¸€ç§å¯¹ç°å®ä¸–ç•Œç†è§£å’ŒæŠ½è±¡çš„æ–¹æ³•ï¼Œæ˜¯è®¡ç®—æœºç¼–ç¨‹æŠ€æœ¯å‘å±•åˆ°ä¸€å®šé˜¶æ®µåçš„äº§ç‰©ã€‚</p></blockquote><p>ä¸¥æ ¼æ¥è¯´ï¼Œgoä¸å±äºé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼ˆæš‚ä¸æ”¯æŒç»§æ‰¿ï¼‰ï¼Œä½†goå…è®¸é¢å‘å¯¹è±¡çš„ç¼–ç¨‹é£æ ¼ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸ªé¢å‘å¯¹è±¡çš„demoã€‚</p><hr><p>å®åœ¨æ²¡æƒ³åˆ°å¥½ä¸€ç‚¹çš„ä¾‹å­ï¼Œä¸çŸ¥é“å¤§ä¼™æœ‰æ²¡æœ‰å¯¹è±¡ï¼Œä¸å¦‚ä»¥girl friendä¸ºä¾‹æ¥å¼„ä¸ªdemo å§ï¼Œå¥³åŒå­¦è¯·newä¸€ä¸ªboyfrindã€‚å½“ç„¶äº†ï¼Œnewä»€ä¹ˆéƒ½è¡Œï¼Œéšä½ å–œæ¬¢â€¦â€¦.</p><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¥³æœ‹å‹å¯¹è±¡ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GirlFriend <span class="hljs-keyword">struct</span> &#123;height    <span class="hljs-keyword">int</span> <span class="hljs-comment">// èº«é«˜</span>weight    <span class="hljs-keyword">int</span> <span class="hljs-comment">// ä½“é‡</span>age       <span class="hljs-keyword">int</span> <span class="hljs-comment">// å¹´é¾„</span>name      <span class="hljs-keyword">string</span> <span class="hljs-comment">// å§“å</span>content   <span class="hljs-keyword">string</span> <span class="hljs-comment">// ç»“æŸè¯­</span>greetings <span class="hljs-keyword">string</span> <span class="hljs-comment">// é—®å€™è¯­</span>&#125;</code></pre></div><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰èº«é«˜ï¼Œä½“é‡ï¼Œå¹´é¾„ï¼Œå§“åï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(gf *GirlFriend)</span> <span class="hljs-title">SetHeight</span><span class="hljs-params">(v <span class="hljs-keyword">int</span>)</span></span> &#123;gf.height = v&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(gf *GirlFriend)</span> <span class="hljs-title">SetWeight</span><span class="hljs-params">(v <span class="hljs-keyword">int</span>)</span></span> &#123;gf.weight = v&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(gf *GirlFriend)</span> <span class="hljs-title">SetAge</span><span class="hljs-params">(v <span class="hljs-keyword">int</span>)</span></span> &#123;gf.age = v&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(gf *GirlFriend)</span> <span class="hljs-title">SetName</span><span class="hljs-params">(v <span class="hljs-keyword">string</span>)</span></span> &#123;gf.name = v&#125;</code></pre></div><p>å–œæ¬¢ä½¿ç”¨é“¾å¼æ“ä½œçš„å¯ä»¥è¿™ä¹ˆæ¥ï¼ŒæŠŠå¥³æœ‹å‹returnå›å»å³å¯ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(gf *GirlFriend)</span> <span class="hljs-title">SetContent</span><span class="hljs-params">(v <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">GirlFriend</span></span> &#123;gf.content = v<span class="hljs-keyword">return</span> gf&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(gf *GirlFriend)</span> <span class="hljs-title">SetGreeting</span><span class="hljs-params">(v <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">GirlFriend</span></span> &#123;gf.greetings = v<span class="hljs-keyword">return</span> gf&#125;</code></pre></div><p>æˆ‘ä»¬å½“ç„¶è¿˜æœ‰å®ç°ä¸€ä¸‹ï¼Œæ²¡æœ‰å¥³æœ‹å‹ï¼Œnewä¸€ä¸ªï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewOne</span><span class="hljs-params">()</span> *<span class="hljs-title">GirlFriend</span></span> &#123;<span class="hljs-keyword">return</span> &amp;GirlFriend&#123;&#125;&#125;</code></pre></div><p>newå‡ºæ¥äº†ï¼Œå½“ç„¶è¦ç§€ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(gf *GirlFriend)</span> <span class="hljs-title">Show</span><span class="hljs-params">()</span></span> &#123;fmt.Println(gf.greetings + <span class="hljs-string">&quot;æˆ‘æ˜¯&quot;</span> + gf.name + <span class="hljs-string">&quot;,ä»Šå¹´&quot;</span> + strconv.Itoa(gf.age) + <span class="hljs-string">&quot;å²ï¼Œèº«é«˜&quot;</span> + strconv.Itoa(gf.height) + <span class="hljs-string">&quot;cm,ä½“é‡&quot;</span> + strconv.Itoa(gf.weight) + <span class="hljs-string">&quot;kgã€‚&quot;</span> + gf.content)&#125;</code></pre></div><p>æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸ªï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;demo5-OOP/oop&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;gf := oop.NewOne()gf.SetName(<span class="hljs-string">&quot;Lily&quot;</span>)gf.SetHeight(<span class="hljs-number">170</span>)gf.SetWeight(<span class="hljs-number">50</span>)gf.SetGreeting(<span class="hljs-string">&quot;hello,&quot;</span>).SetContent(<span class="hljs-string">&quot;thanks for your great creavity!&quot;</span>).SetAge(<span class="hljs-number">24</span>)gf.Show()&#125;</code></pre></div><p>è¿™ä¸€ç¯‡æ¯”è¾ƒç®€å•ï¼Œä¾‹å­å‘¢ï¼Œä»…ä»…æ˜¯ç©ç¬‘ï¼Œä¸å¯å½“çœŸï¼Œå¥³æœ‹å‹newæ˜¯ä¸å¯è¡Œçš„ï¼Œè¿˜æ˜¯è¦ä¸»åŠ¨å»è¿½çš„ã€‚è¿™é‡Œä¸»è¦æ˜¯å±•ç¤ºä¸€ä¸‹goçš„é¢å‘å¯¹è±¡å®ç°ï¼Œåœ¨ä½¿ç”¨å…¶ä»–åº“çš„è¿‡ç¨‹ä¸­åº”è¯¥æœ‰æ³¨æ„åˆ°ä¸€äº›æ¨¡å—ä½¿ç”¨äº†é¢å‘å¯¹è±¡çš„å®ç°ï¼Œå¸Œæœ›å¤§å®¶å»åšä¸€äº›æŠ½è±¡ï¼Œåœ¨è‡ªå·±çš„é¡¹ç›®åˆé€‚çš„åœ°æ–¹å»å®ç°ä¸€ä¸‹ï¼Œè®©è‡ªå·±çš„ä»£ç æ›´ä¼˜é›…ã€æ›´å¥å£®ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶éƒ½èƒ½æ‰¾åˆ°å¯¹çš„äººï¼Œä¸€èµ·newä¸€ä¸ªbabyã€‚</p><p><a href="https://github.com/13sai/go-example/tree/main/demo5-OOP">å®Œæ•´ä»£ç ç‚¹å‡»è¿›github</a></p>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gRPC</title>
    <link href="/2021/02/12/goexample4/"/>
    <url>/2021/02/12/goexample4/</url>
    
    <content type="html"><![CDATA[<p>åœ¨è¿›è¡Œround 4ä¹‹å‰å‘¢ï¼Œè¯´ä¸€ä¸‹goçš„modulesï¼Œä¹‹å‰çš„3ä¸ªdemoä¸­ï¼Œå…¶å®æˆ‘å°±ç›´æ¥ç”¨åˆ°äº†ï¼Œæ²¡åšè¯´æ˜ï¼Œä¸ªäººè§‰å¾—modulesçš„å¼•è¿›ç®—æ˜¯ä¸€ä¸ªå¤§æ”¹è¿›äº†ï¼Œè®©æˆ‘ä»¬å¯ä»¥è„±ç¦»gopathçš„æŸç¼šï¼Œå…·ä½“è¯´æ˜ä¸é…ç½®ï¼Œå¯ä»¥çœ‹æˆ‘çš„è¿™ä¸€ç¯‡æ–‡ç« ï¼š</p><p><a href="https://github.oscome.cn/2019/12/27/219/">go modules</a></p><p>åŠ¡å¿…è®¾ç½®GOPROXYï¼Œä¼šå¤§å¤§æé«˜go getçš„é€Ÿåº¦ã€‚</p><hr><blockquote><p>gRPC æ˜¯å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œçš„ç°ä»£å¼€æºé«˜æ€§èƒ½ RPC æ¡†æ¶ã€‚å®ƒå¯ä»¥é€šè¿‡å¯æ’æ‹”çš„æ”¯æŒæ¥æœ‰æ•ˆåœ°è¿æ¥æ•°æ®ä¸­å¿ƒå†…å’Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ï¼Œä»¥å®ç°è´Ÿè½½å¹³è¡¡ï¼Œè·Ÿè¸ªï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥å’Œèº«ä»½éªŒè¯ã€‚å®ƒä¹Ÿé€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„æœ€åä¸€è‹±é‡Œï¼Œä»¥å°†è®¾å¤‡ï¼Œç§»åŠ¨åº”ç”¨ç¨‹åºå’Œæµè§ˆå™¨è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚</p></blockquote><h2 id="å®‰è£…protocol-buffer-ç¼–è¯‘å™¨"><a href="#å®‰è£…protocol-buffer-ç¼–è¯‘å™¨" class="headerlink" title="å®‰è£…protocol buffer ç¼–è¯‘å™¨"></a>å®‰è£…protocol buffer ç¼–è¯‘å™¨</h2><p>macï¼š</p><div class="code-wrapper"><pre><code class="hljs text">brew install protobuf</code></pre></div><p>å…¶ä»–ç³»ç»Ÿå¯ä»¥å°è¯•ç¼–è¯‘å®‰è£…</p><ul><li><a href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a></li></ul><h2 id="å®‰è£…gprc"><a href="#å®‰è£…gprc" class="headerlink" title="å®‰è£…gprc"></a>å®‰è£…gprc</h2><div class="code-wrapper"><pre><code class="hljs text">go get -u google.golang.org/grpc</code></pre></div><h2 id="å®‰è£…protoc-gen-goæ’ä»¶"><a href="#å®‰è£…protoc-gen-goæ’ä»¶" class="headerlink" title="å®‰è£…protoc-gen-goæ’ä»¶"></a>å®‰è£…protoc-gen-goæ’ä»¶</h2><div class="code-wrapper"><pre><code class="hljs text">go get -u github.com/golang/protobuf/protoc-gen-go</code></pre></div><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æ–°å»ºhelloç›®å½•ï¼Œè¿›å…¥åæ‰§è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs text">protoc --proto_path hello/ --go_out=plugins=grpc:hello hello.proto</code></pre></div><p>ä¼šçœ‹åˆ°helloç›®å½•ä¸‹ç”Ÿæˆäº†hello.pb.goæ–‡ä»¶ã€‚</p><p>å½“ç„¶ï¼Œå…¶ä¸­çš„ <code>hello.proto</code> æ˜¯é¢„å…ˆè‡ªå®šä¹‰åœ¨helloæ–‡ä»¶å¤¹ä¸‹çš„ï¼Œå¦‚ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">syntax = &quot;proto3&quot;;  //è¯­æ³•å£°æ˜package hello; //åŒ…å// å®šä¹‰æœåŠ¡service Greeter &#123;  rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;&#125;// è¯·æ±‚æ•°æ®æ ¼å¼message HelloRequest &#123;  string name = 1;&#125;// å“åº”æ•°æ®æ ¼å¼message HelloReply &#123;  string message = 1;&#125;</code></pre></div><h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><p>æ–°å»ºserverç›®å½•ï¼Œ<br>golangä¾‹å­ä»£ç æ¥è‡ªï¼š<a href="https://github.com/grpc/grpc-go/tree/master/examples/helloworld">https://github.com/grpc/grpc-go/tree/master/examples/helloworld</a></p><div class="code-wrapper"><pre><code class="hljs text">// main.gopackage mainimport (    &quot;context&quot;    &quot;log&quot;    &quot;net&quot;    &quot;google.golang.org/grpc&quot;    pb &quot;local.com/sai/game/grpc/hello&quot;)const (    port = &quot;:50051&quot;)// server is used to implement helloworld.GreeterServer.type server struct &#123;    pb.UnimplementedGreeterServer&#125;// SayHello implements helloworld.GreeterServerfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) &#123;    log.Printf(&quot;Received: %v&quot;, in.GetName())    return &amp;pb.HelloReply&#123;Message: &quot;Hello &quot; + in.GetName()&#125;, nil&#125;func main() &#123;    lis, err := net.Listen(&quot;tcp&quot;, port)    if err != nil &#123;        log.Fatalf(&quot;failed to listen: %v&quot;, err)    &#125;    s := grpc.NewServer()    pb.RegisterGreeterServer(s, &amp;server&#123;&#125;)    if err := s.Serve(lis); err != nil &#123;        log.Fatalf(&quot;failed to serve: %v&quot;, err)    &#125;&#125;</code></pre></div><h2 id="client"><a href="#client" class="headerlink" title="client"></a>client</h2><h3 id="go-client"><a href="#go-client" class="headerlink" title="go client"></a>go client</h3><div class="code-wrapper"><pre><code class="hljs text">// client.gopackage mainimport (    &quot;context&quot;    &quot;log&quot;    &quot;os&quot;    &quot;time&quot;    &quot;google.golang.org/grpc&quot;    pb &quot;local.com/sai/game/grpc/hello&quot;)const (    address     = &quot;127.0.0.1:50051&quot;    defaultName = &quot;13sai&quot;)func main() &#123;    // Set up a connection to the server.    conn, err := grpc.Dial(address, grpc.WithInsecure(), grpc.WithBlock())    if err != nil &#123;        log.Fatalf(&quot;did not connect: %v&quot;, err)    &#125;    defer conn.Close()    c := pb.NewGreeterClient(conn)    // Contact the server and print out its response.    name := defaultName    if len(os.Args) &gt; 1 &#123;        name = os.Args[1]    &#125;    ctx, cancel := context.WithTimeout(context.Background(), time.Second)    defer cancel()    r, err := c.SayHello(ctx, &amp;pb.HelloRequest&#123;Name: name&#125;)    if err != nil &#123;        log.Fatalf(&quot;could not greet: %v&quot;, err)    &#125;    log.Printf(&quot;Greeting: %s&quot;, r.GetMessage())&#125;`</code></pre></div><h3 id="php-client"><a href="#php-client" class="headerlink" title="php client"></a>php client</h3><h3 id="æ‰©å±•å®‰è£…"><a href="#æ‰©å±•å®‰è£…" class="headerlink" title="æ‰©å±•å®‰è£…"></a>æ‰©å±•å®‰è£…</h3><ul><li><a href="http://pecl.php.net/package/gRPC">grpcæ‰©å±•ä¸‹è½½</a></li><li><a href="http://pecl.php.net/package/protobuf">profo</a></li></ul><p>ä¸‹è½½å®‰è£…åˆé€‚ç‰ˆæœ¬çš„æ‰©å±•å³å¯ï¼Œè®°å¾—åˆ«å¿˜è®°åœ¨php.iniä¸­åŠ å…¥ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">extension=grpc.soextension=protobuf.so</code></pre></div><h3 id="è‡ªåŠ¨ç”Ÿæˆä»£ç "><a href="#è‡ªåŠ¨ç”Ÿæˆä»£ç " class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆä»£ç "></a>è‡ªåŠ¨ç”Ÿæˆä»£ç </h3><div class="code-wrapper"><pre><code class="hljs text">protoc --php_out=client hello/hello.proto</code></pre></div><p>ä¼šçœ‹åˆ°clientç›®å½•ä¸‹ç”Ÿæˆäº†GPBMetadataå’ŒHelloä¸¤ä¸ªç›®å½•ã€‚</p><p>å¦‚æœä½ å¯¹grpcç›¸å¯¹å«ç†Ÿç»ƒï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä»£ç ç¼–å†™ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">&lt;?phprequire __DIR__ . &#x27;/vendor/autoload.php&#x27;;class Client extends \Grpc\BaseStub&#123;    public function __construct($hostname, $opts, $channel = null) &#123;        parent::__construct($hostname, $opts, $channel);    &#125;    /**     * rpc SayHello(HelloRequest) returns (HelloReply) &#123;&#125;     * æ–¹æ³•åå°½é‡å’Œ (gprc å®šä¹‰ Greeter æœåŠ¡)çš„æ–¹æ³•ä¸€æ ·     * ç”¨äºè¯·æ±‚å’Œå“åº”è¯¥æœåŠ¡     */    public function SayHello(\Hello\HelloRequest $argument)&#123;        // (/hello.Greeter/SayHello) æ˜¯è¯·æ±‚æœåŠ¡ç«¯é‚£ä¸ªæœåŠ¡å’Œæ–¹æ³•ï¼ŒåŸºæœ¬å’Œ proto æ–‡ä»¶å®šä¹‰ä¸€æ ·        return $this-&gt;_simpleRequest(&#x27;/hello.Greeter/SayHello&#x27;,            $argument,            [&#x27;\Hello\HelloReply&#x27;, &#x27;decode&#x27;]            );    &#125;&#125;//ç”¨äºè¿æ¥ æœåŠ¡ç«¯$client = new \Client(&#x27;127.0.0.1:50051&#x27;, [    &#x27;credentials&#x27; =&gt; Grpc\ChannelCredentials::createInsecure()]);//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»$request = new \Hello\HelloRequest();$request-&gt;setName(&quot;fairy&quot;);//è°ƒç”¨è¿œç¨‹æœåŠ¡$get = $client-&gt;SayHello($request)-&gt;wait();//è¿”å›æ•°ç»„//$reply æ˜¯ TestReply å¯¹è±¡//$status æ˜¯æ•°ç»„list($reply, $status) = $get;echo $reply-&gt;getMessage().PHP_EOL;// print_r($client-&gt;SayHello($request));</code></pre></div><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨grpc_php_pluginæ’ä»¶ç”Ÿæˆã€‚</p><ul><li><a href="https://github.com/grpc/grpc/tree/master/src/php">grpc-php</a></li></ul><h3 id="grpc-php-pluginæ’ä»¶"><a href="#grpc-php-pluginæ’ä»¶" class="headerlink" title="grpc_php_pluginæ’ä»¶"></a>grpc_php_pluginæ’ä»¶</h3><p><a href="https://gitee.com/mirrors/grpc.git">cloneå¤ªæ…¢å¯ä»¥ä½¿ç”¨ç äº‘</a></p><div class="code-wrapper"><pre><code class="hljs text">git clone -b $(curl -L https://grpc.io/release) https://github.com/grpc/grpccd grpc#è¿™ä¸€æ­¥å¾ˆæ…¢ï¼Œæš‚æœªæ‰¾åˆ°ä»€ä¹ˆå¥½æ–¹æ³•git submodule update --initmake grpc_php_plugin</code></pre></div><p>æ–°å»ºphp-clientï¼Œå†æ¥è‡ªåŠ¨ç”Ÿæˆï¼š</p><div class="code-wrapper"><pre><code class="hljs text">protoc -I=./hello hello.proto --php_out=./php-client/ --grpc_out=php-client/ --plugin=protoc-gen-grpc=/Users/wangzetao/www/grpc1/bins/opt/grpc_php_plugin</code></pre></div><p>ä¼šå‘ç°æ¯”ä¸Šé¢è‡ªåŠ¨ç”Ÿæˆå¤šäº†ä¸€ä¸ªGreeterClient.php</p><div class="code-wrapper"><pre><code class="hljs text">&lt;?php// client.phprequire __DIR__ . &#x27;/vendor/autoload.php&#x27;;//ç”¨äºè¿æ¥ æœåŠ¡ç«¯$client = new \Hello\GreeterClient(&#x27;127.0.0.1:50051&#x27;, [    &#x27;credentials&#x27; =&gt; Grpc\ChannelCredentials::createInsecure()]);//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»$request = new \Hello\HelloRequest();$request-&gt;setName(&quot;world&quot;);//è°ƒç”¨è¿œç¨‹æœåŠ¡$get = $client-&gt;SayHello($request)-&gt;wait();//è¿”å›æ•°ç»„//$status æ˜¯æ•°ç»„list($reply, $status) = $get;echo $reply-&gt;getMessage().PHP_EOL;// print_r($client-&gt;SayHello($request));</code></pre></div><h2 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h2><blockquote><p>go run grpc/server/main.go</p></blockquote><p><img src="/images/post/v2-9c586c0ea6eb30d83df0a334b0886e45_1440w.png" alt="img"></p><blockquote><p>go run grpc/client/main.go<br>go run grpc/client/client.php<br>go run grpc/client/php-client.php</p></blockquote><p><img src="/images/post/v2-9e6a85bc1719bcb7e96c0b09686f006f_1440w.png" alt="img"></p><p>grpcåˆä½“éªŒå®Œæˆäº†ï¼Œæœ¬æ¬¡åªæ˜¯å°å°çš„ä½¿ç”¨äº†ä¸€ä¸‹å­ï¼Œåç»­æ„Ÿå…´è¶£çš„è¯å¯ä»¥æ·±å…¥å­¦ä¹ ä¸€ä¸‹ã€‚æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºäº¤æµã€‚</p><p>è¿™ç¯‡æ˜¯ä¹‹å‰çš„æ–‡ç« ï¼Œä»£ç ç®€å•ï¼Œå°±ä¸å†å†™ä¸€éäº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go-kit</title>
    <link href="/2021/02/12/goexample6/"/>
    <url>/2021/02/12/goexample6/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½•ä¸ºgo-kit"><a href="#ä½•ä¸ºgo-kit" class="headerlink" title="ä½•ä¸ºgo-kit"></a>ä½•ä¸ºgo-kit</h2><blockquote><p><strong>Go kit</strong> is a <strong>programming toolkit</strong> for building microservices (or elegant monoliths) in Go. We solve common problems in distributed systems and application architecture so you can focus on delivering business value.</p></blockquote><p>go kitæ˜¯ä¸€ä¸ªç”¨äºåœ¨Goä¸­æ„å»ºå¾®æœåŠ¡ï¼ˆæˆ–ä¼˜é›…çš„æ•´ä½“ï¼‰çš„ç¼–ç¨‹å·¥å…·åŒ…ï¼Œè§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ä¸­çš„å¸¸è§é—®é¢˜ï¼Œä»¥ä¾¿å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡äº¤ä»˜ã€‚</p><hr><p>go-kitä¸»è¦åˆ†ä¸ºä¸‰å±‚ç»“æ„ï¼šTransportå±‚ï¼ŒEndpointå±‚ï¼ŒServiceå±‚ã€‚</p><ul><li>Transport è´Ÿè´£ä¸ä¼ è¾“åè®®HTTPã€GRPCç­‰ç›¸å…³çš„é€»è¾‘</li><li>Endpoint è´Ÿè´£request/responseæ ¼å¼çš„è½¬æ¢ï¼Œä»¥åŠå…¬ç”¨æ‹¦æˆªå™¨ç›¸å…³çš„é€»è¾‘</li><li>Service ä¸šåŠ¡é€»è¾‘ã€‚</li></ul><p>å¦å¤–ï¼Œgo-kitæä¾›logæ—¥å¿—ï¼Œmetricè®¡æ•°å™¨ï¼Œtracingè¯·æ±‚è·Ÿè¸ªï¼ŒcircuitbreakeræœåŠ¡ç†”æ–­ï¼Œrate-limiteré™æµå™¨ç­‰æ¨¡å—ã€‚ç®€å•è¯´ï¼Œgo-kitæä¾›äº†å¾®æœåŠ¡æ¶æ„å¸¸è§çš„åŸºç¡€æ¨¡å—ï¼Œå¯ä»¥è®©å¼€å‘è€…çœå»å¾ˆå¤šæ—¶é—´ã€‚</p><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>äº†è§£è¿˜ä¸å¤Ÿï¼Œshow codeã€‚</p><p>æˆ‘ä»¬å…ˆå®šä¹‰ä¸‹serviceï¼Œä¸å¦‚å°±åšä¸ªç®€å•çš„è®¡ç®—å™¨ï¼Œä»…ä»…åšæ¼”ç¤ºï¼Œæœ‰åŠ å‡åŠŸèƒ½å³å¯ï¼Œä¸æ•´å¤ªå¤æ‚äº†ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> service<span class="hljs-comment">// æ¥å£å®šä¹‰</span><span class="hljs-keyword">type</span> CalculateService <span class="hljs-keyword">interface</span> &#123;Add(a, b <span class="hljs-keyword">int</span>) <span class="hljs-keyword">int</span>Reduce(a, b <span class="hljs-keyword">int</span>) <span class="hljs-keyword">int</span>Multi(a, b <span class="hljs-keyword">int</span>) <span class="hljs-keyword">int</span>&#125;<span class="hljs-keyword">type</span> calculateService <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewService</span><span class="hljs-params">()</span> *<span class="hljs-title">calculateService</span></span> &#123;<span class="hljs-keyword">return</span> &amp;calculateService&#123;&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *calculateService)</span> <span class="hljs-title">Add</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;<span class="hljs-keyword">return</span> a + b&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *calculateService)</span> <span class="hljs-title">Reduce</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;<span class="hljs-keyword">return</span> a - b&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *calculateService)</span> <span class="hljs-title">Multi</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;<span class="hljs-keyword">return</span> a * b&#125;</code></pre></div><blockquote><p>æ³¨æ„ï¼šGo æ¥å£æ˜¯ä¸€ç»„æ–¹æ³•çš„é›†åˆï¼Œå¯ä»¥ç†è§£ä¸ºæŠ½è±¡çš„ç±»å‹ã€‚å®ƒæä¾›äº†ä¸€ç§éä¾µå…¥å¼çš„æ¥å£ã€‚ä»»ä½•ç±»å‹ï¼Œåªè¦å®ç°äº†è¯¥æ¥å£ä¸­æ–¹æ³•é›†ï¼Œé‚£ä¹ˆå°±å±äºè¿™ä¸ªç±»å‹ã€‚ï¼ˆè¿™æ˜¯goä¸­éå¸¸å¸¸ç”¨çš„ç‰¹æ€§ï¼Œåˆ‡è®°)</p></blockquote><p>endpointæ ¼å¼åŒ–è¯·æ±‚ï¼Œè°ƒç”¨serviceæœåŠ¡ï¼Œå¹¶æ ¼å¼åŒ–è¾“å‡º</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> endpoint<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;demo6/service&quot;</span><span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;github.com/go-kit/kit/endpoint&quot;</span>)<span class="hljs-keyword">type</span> Request <span class="hljs-keyword">struct</span> &#123;A <span class="hljs-keyword">int</span> <span class="hljs-string">`json:&quot;a&quot; form:&quot;a&quot;`</span>B <span class="hljs-keyword">int</span> <span class="hljs-string">`json:&quot;b&quot; form:&quot;b&quot;`</span>&#125;<span class="hljs-keyword">type</span> Res <span class="hljs-keyword">struct</span> &#123;Res <span class="hljs-keyword">int</span>   <span class="hljs-string">`json:&quot;res&quot;`</span>Err error <span class="hljs-string">`json:&quot;err&quot;`</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MakeAddEndpoint</span><span class="hljs-params">(s service.CalculateService)</span> <span class="hljs-title">endpoint</span>.<span class="hljs-title">Endpoint</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(_ context.Context, request <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>&#123;&#125;, error)</span></span> &#123;req := request.(Request)<span class="hljs-keyword">return</span> Res&#123;Res: s.Add(req.A, req.B)&#125;, <span class="hljs-literal">nil</span>&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MakeReduceEndpoint</span><span class="hljs-params">(s service.CalculateService)</span> <span class="hljs-title">endpoint</span>.<span class="hljs-title">Endpoint</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(_ context.Context, request <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>&#123;&#125;, error)</span></span> &#123;req := request.(Request)<span class="hljs-keyword">return</span> Res&#123;Res: s.Reduce(req.A, req.B)&#125;, <span class="hljs-literal">nil</span>&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MakeMultiEndpoint</span><span class="hljs-params">(s service.CalculateService)</span> <span class="hljs-title">endpoint</span>.<span class="hljs-title">Endpoint</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(_ context.Context, request <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>&#123;&#125;, error)</span></span> &#123;req := request.(Request)<span class="hljs-keyword">return</span> Res&#123;Res: s.Multi(req.A, req.B)&#125;, <span class="hljs-literal">nil</span>&#125;&#125;</code></pre></div><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰transportå®šä¹‰è¯·æ±‚æ–¹å¼ï¼ˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨jsonï¼‰ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> transport<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;demo6/endpoint&quot;</span><span class="hljs-string">&quot;encoding/json&quot;</span><span class="hljs-string">&quot;errors&quot;</span><span class="hljs-string">&quot;net/http&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DecodeRequest</span><span class="hljs-params">(_ context.Context, r *http.Request)</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>&#123;&#125;, error)</span></span> &#123;<span class="hljs-keyword">var</span> req endpoint.Request<span class="hljs-keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">&quot;params error&quot;</span>)&#125;<span class="hljs-keyword">return</span> req, <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">EncodeResponse</span><span class="hljs-params">(_ context.Context, w http.ResponseWriter, res <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> json.NewEncoder(w).Encode(res)&#125;</code></pre></div><p>æœ€åæˆ‘ä»¬å°†å®ƒä»¬endpointå’Œtransportç²˜åˆèµ·æ¥ï¼Œè·‘èµ·æ¥goï½</p><div class="code-wrapper"><pre><code class="hljs text">package mainimport (&quot;demo6/endpoint&quot;&quot;demo6/service&quot;&quot;demo6/transport&quot;&quot;net/http&quot;httpTransport &quot;github.com/go-kit/kit/transport/http&quot;)func main() &#123;s := service.NewService()add := httpTransport.NewServer(endpoint.MakeAddEndpoint(s),transport.DecodeRequest,transport.EncodeResponse,)reduce := httpTransport.NewServer(endpoint.MakeReduceEndpoint(s),transport.DecodeRequest,transport.EncodeResponse,)multi := httpTransport.NewServer(endpoint.MakeMultiEndpoint(s),transport.DecodeRequest,transport.EncodeResponse,)http.Handle(&quot;/add&quot;, add)http.Handle(&quot;/reduce&quot;, reduce)http.Handle(&quot;/multi&quot;, multi)http.ListenAndServe(&quot;:9009&quot;, nil)&#125;</code></pre></div><p>è¿è¡Œèµ·æ¥ï¼š</p><p><img src="/images/post/v2-10d97a842067a8ca6ef5f4878161bfd7_1440w.png" alt="img"></p><p>æˆåŠŸè¿è¡Œï¼</p><p><a href="https://github.com/13sai/go-example/tree/main/demo6-go-kit">è¯¦ç»†ä»£ç è¿›githubgithub.com/13sai/go-example/tree/main/demo6-go-kit</a></p><hr><p>ç•™ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºjsonæ ¼å¼é”™è¯¯çš„è¯·æ±‚ï¼Œè¿”å›çš„ä¸æ˜¯jsonï¼Œå¦‚ä½•æ”¹é€ ï¼Œè®©æ¥å£è¿”å›jsonå‘¢ï¼Ÿ</p><p>æœ€è¿‘è‡ªå·±åœ¨ç ”ç©¶goå¾®æœåŠ¡è¿™å—çš„çŸ¥è¯†ï¼Œåç»­å‡ ç¯‡æ–‡å­—åº”è¯¥éƒ½ä¼šä»¥go-kitä¸ºåŸºç¡€å±•å¼€ï¼Œæœ‰å…´è¶£å¯ç»§ç»­å…³æ³¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-composeæ•´åˆgo-kitå’Œmysqlã€Redis</title>
    <link href="/2021/02/12/goexample7/"/>
    <url>/2021/02/12/goexample7/</url>
    
    <content type="html"><![CDATA[<p>ä¸“æ ä¹‹å‰æœ‰ä½¿ç”¨go-kitã€gormã€go-Redisï¼Œæ‰€ä»¥éƒ¨åˆ†å†…å®¹å°±å¿½ç•¥ã€‚</p><h2 id="å®šä¹‰model"><a href="#å®šä¹‰model" class="headerlink" title="å®šä¹‰model"></a>å®šä¹‰model</h2><p>ä¸»è¦å®ç°SelectByEmailï¼ˆæŸ¥æ‰¾ï¼‰å’ŒSaveï¼ˆæ–°å»ºï¼‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> model<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;time&quot;</span><span class="hljs-keyword">type</span> UserEntity <span class="hljs-keyword">struct</span> &#123;ID        <span class="hljs-keyword">int64</span>Username  <span class="hljs-keyword">string</span>Password  <span class="hljs-keyword">string</span>Email     <span class="hljs-keyword">string</span>CreatedAt time.Time&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(UserEntity)</span> <span class="hljs-title">TableName</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user&quot;</span>&#125;<span class="hljs-keyword">type</span> UserDao <span class="hljs-keyword">interface</span> &#123;SelectByEmail(email <span class="hljs-keyword">string</span>) (*UserEntity, error)Save(user *UserEntity) error&#125;<span class="hljs-keyword">type</span> UserDaoImpl <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *UserDaoImpl)</span> <span class="hljs-title">SelectByEmail</span><span class="hljs-params">(email <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(*UserEntity, error)</span></span> &#123;user := &amp;UserEntity&#123;&#125;err := db.Where(<span class="hljs-string">&quot;email = ?&quot;</span>, email).First(user).Error<span class="hljs-keyword">return</span> user, err&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *UserDaoImpl)</span> <span class="hljs-title">Save</span><span class="hljs-params">(user *UserEntity)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> db.Create(user).Error&#125;</code></pre></div><h2 id="ä¸šåŠ¡service"><a href="#ä¸šåŠ¡service" class="headerlink" title="ä¸šåŠ¡service"></a>ä¸šåŠ¡service</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> service<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;demo7-docker-compose/model&quot;</span><span class="hljs-string">&quot;errors&quot;</span><span class="hljs-string">&quot;log&quot;</span><span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;github.com/jinzhu/gorm&quot;</span>)<span class="hljs-keyword">type</span> UserInfoDTO <span class="hljs-keyword">struct</span> &#123;ID       <span class="hljs-keyword">int64</span>  <span class="hljs-string">`json:&quot;id&quot;`</span>Username <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;username&quot;`</span>Email    <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span>&#125;<span class="hljs-keyword">var</span> (ErrUserExisted = errors.New(<span class="hljs-string">&quot;user is existed&quot;</span>)ErrPassword    = errors.New(<span class="hljs-string">&quot;email and password are not match&quot;</span>)ErrRegistering = errors.New(<span class="hljs-string">&quot;email is registering&quot;</span>))<span class="hljs-keyword">type</span> RegisterUser <span class="hljs-keyword">struct</span> &#123;Username <span class="hljs-keyword">string</span>Password <span class="hljs-keyword">string</span>Email    <span class="hljs-keyword">string</span>&#125;<span class="hljs-keyword">type</span> UserService <span class="hljs-keyword">interface</span> &#123;Login(ctx context.Context, email, pass <span class="hljs-keyword">string</span>) (*UserInfoDTO, error)Register(ctx context.Context, user *RegisterUser) (*UserInfoDTO, error)&#125;<span class="hljs-keyword">type</span> UserServiceImpl <span class="hljs-keyword">struct</span> &#123;userDao model.UserDao&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MakeUserServiceImpl</span><span class="hljs-params">(userDao model.UserDao)</span> <span class="hljs-title">UserService</span></span> &#123;<span class="hljs-keyword">return</span> &amp;UserServiceImpl&#123;userDao,&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(userService *UserServiceImpl)</span> <span class="hljs-title">Login</span><span class="hljs-params">(ctx context.Context, email, password <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(*UserInfoDTO, error)</span></span> &#123;user, err := userService.userDao.SelectByEmail(email)<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">if</span> user.Password == password &#123;<span class="hljs-keyword">return</span> &amp;UserInfoDTO&#123;ID:       user.ID,Username: user.Username,Email:    user.Email,&#125;, <span class="hljs-literal">nil</span>&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, ErrPassword&#125;&#125; <span class="hljs-keyword">else</span> &#123;log.Printf(<span class="hljs-string">&quot;err : %s&quot;</span>, err)&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(userService UserServiceImpl)</span> <span class="hljs-title">Register</span><span class="hljs-params">(ctx context.Context, user *RegisterUser)</span> <span class="hljs-params">(*UserInfoDTO, error)</span></span> &#123;ret := model.RedisClient.SetNX(user.Email, <span class="hljs-number">1</span>, time.Duration(<span class="hljs-number">5</span>)*time.Second)<span class="hljs-keyword">if</span> ret.Val() == <span class="hljs-literal">false</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, ErrRegistering&#125;<span class="hljs-keyword">defer</span> model.RedisClient.Del(user.Email)existUser, err := userService.userDao.SelectByEmail(user.Email)<span class="hljs-keyword">if</span> (err == <span class="hljs-literal">nil</span> &amp;&amp; existUser == <span class="hljs-literal">nil</span>) || err == gorm.ErrRecordNotFound &#123;newUser := &amp;model.UserEntity&#123;Username: user.Username,Password: user.Password,Email:    user.Email,&#125;err = userService.userDao.Save(newUser)<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> &amp;UserInfoDTO&#123;ID:       newUser.ID,Username: newUser.Username,Email:    newUser.Email,&#125;, <span class="hljs-literal">nil</span>&#125;&#125;<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;err = ErrUserExisted&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err&#125;</code></pre></div><p>æ­¤å¤„æ³¨æ„åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œåˆ©ç”¨äº†Redisçš„setnxæ–¹æ³•ï¼Œå¹¶å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯¹åº”Redisä¸­çš„</p><blockquote><p><strong>SET key value [EX seconds] [PX milliseconds] [NX|XX]</strong></p></blockquote><div class="code-wrapper"><pre><code class="hljs text">       ret := model.RedisClient.SetNX(user.Email, 1, time.Duration(5)*time.Second)if ret.Val() == false &#123;return nil, ErrRegistering&#125;defer model.RedisClient.Del(user.Email)</code></pre></div><p>å¯¹äºendpointå’Œtransportï¼Œå°±ä¸ä¹‹å‰çš„æ²¡æœ‰å¤ªå¤§å·®åˆ«äº†ï¼Œæˆ‘ä»¬è¿™é‡Œå°±æš‚æ—¶ç•¥å»ï¼Œæœ‰å…´è¶£å¯ç‚¹å‡»æ–‡ç« æœ€åçš„æºç æŸ¥çœ‹ã€‚</p><h2 id="mysqlå’ŒRediså®¹å™¨"><a href="#mysqlå’ŒRediså®¹å™¨" class="headerlink" title="mysqlå’ŒRediså®¹å™¨"></a>mysqlå’ŒRediså®¹å™¨</h2><p>mysqlçš„Dockerfileï¼š</p><div class="code-wrapper"><pre><code class="hljs docker"><span class="hljs-keyword">FROM</span> mysql:<span class="hljs-number">5.7</span> <span class="hljs-keyword">WORKDIR</span><span class="bash"> /docker-entrypoint-initdb.d </span><span class="hljs-keyword">ENV</span> LANG=C.UTF-<span class="hljs-number">8</span><span class="hljs-keyword">COPY</span><span class="bash"> user.sql .</span></code></pre></div><p>è¿è¡Œmysql-for-userå®¹å™¨</p><div class="code-wrapper"><pre><code class="hljs text">docker run  -itd --name mysql-for-user -p 3316:3306 -e MYSQL_ROOT_PASSWORD=111111 mysql-for-user</code></pre></div><p>è¿™é‡Œå®¹å™¨å¯åŠ¨çš„æ—¶å€™æ˜¯å¯ä»¥æ‰§è¡Œuser.sqlçš„ã€‚ï¼ˆå¯é€šè¿‡docker logs mysql-for-useræŸ¥çœ‹å®¹å™¨å¯åŠ¨ä¿¡æ¯ï¼‰</p><blockquote><p>/usr/local/bin/docker-entrypoint.sh: running /docker-entrypoint-initdb.d/user.sql</p></blockquote><p>Rediså®¹å™¨çš„å¯åŠ¨ç®€å•</p><div class="code-wrapper"><pre><code class="hljs docker">docker pull Redis:<span class="hljs-number">5.0</span>docker <span class="hljs-keyword">run</span><span class="bash"> -itd --name Redis5 -p 6389:6379 Redis:5.0</span></code></pre></div><p>ç„¶åæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸»ç¨‹åºï¼Œæ™ºèƒ½åˆ°8089ç«¯å£ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">go run main.go -service.port 8089</code></pre></div><p>æµ‹è¯•ä¸€ä¸‹ã€‚</p><p><img src="/images/post/v2-94d150a73c8e24ba9519c5433edab2ee_1440w.png" alt="img"></p><p>å¯ä»¥å®ç°ç™»å½•ä¸æ³¨å†ŒåŠŸèƒ½ã€‚</p><h2 id="æ‰“åŒ…ä¼šå‘˜é•œåƒ"><a href="#æ‰“åŒ…ä¼šå‘˜é•œåƒ" class="headerlink" title="æ‰“åŒ…ä¼šå‘˜é•œåƒ"></a>æ‰“åŒ…ä¼šå‘˜é•œåƒ</h2><p>å…ˆç¼–è¯‘ï¼š</p><blockquote><p>CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o user .</p></blockquote><p>userçš„dockerfile</p><div class="code-wrapper"><pre><code class="hljs docker"><span class="hljs-keyword">FROM</span> alpine:<span class="hljs-number">3.12</span> <span class="hljs-keyword">WORKDIR</span><span class="bash"> /</span><span class="hljs-keyword">COPY</span><span class="bash"> ./user /</span><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> [<span class="hljs-string">&quot;./user&quot;</span>]</span></code></pre></div><p>æ„å»ºé•œåƒ:</p><blockquote><p>docker build -t user-alpine .</p></blockquote><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><div class="code-wrapper"><pre><code class="hljs docker">version: <span class="hljs-string">&#x27;2.1&#x27;</span>services:  user13:    image: <span class="hljs-keyword">user</span>-alpine    depends_on:       - Redis      - mysql    ports:      - <span class="hljs-string">&quot;8088:8088&quot;</span>    links:       - Redis      - mysql    networks:      - <span class="hljs-keyword">user</span>  mysql:    image: mysql-for-<span class="hljs-keyword">user</span>    ports:      - <span class="hljs-string">&quot;3306:3306&quot;</span>    <span class="hljs-keyword">expose</span>:      - <span class="hljs-string">&quot;3306&quot;</span>    environment:      - MYSQL_ROOT_PASSWORD=<span class="hljs-number">111111</span>    networks:      - <span class="hljs-keyword">user</span>    restart: always  Redis:    image: Redis:<span class="hljs-number">5.0</span>    ports:      - <span class="hljs-string">&quot;6379:6379&quot;</span>    <span class="hljs-keyword">expose</span>:      - <span class="hljs-string">&quot;6379&quot;</span>    networks:      - <span class="hljs-keyword">user</span>networks:  <span class="hljs-keyword">user</span>:    driver: bridge</code></pre></div><p>è¯´æ˜ï¼š</p><ul><li>depends_on ä¾èµ–ï¼Œæ­¤å¤„è¡¨ç¤ºuser13ä¾èµ–Redisã€mysqlï¼Œè¢«ä¾èµ–è€…ä¼šä¼˜å…ˆæ„å»ºï¼Œä½†æ˜¯æ˜¯å¯èƒ½è„šæœ¬ä¸ºè¿è¡ŒæˆåŠŸçš„ï¼Œæ‰€ä»¥user13æ˜¯æœ‰å¯èƒ½åˆšå¼€å§‹è¿æ¥ä¸ä¸Šmysqlçš„ï¼Œdocker startå³å¯</li><li>links è¿æ¥ï¼Œæ­¤å¤„user13è¿æ¥åˆ°Redisã€mysqlï¼Œå¯ä»¥ç”¨å®ƒä»¬æ›¿ä»£è¿æ¥æ•°æ®åº“çš„host</li><li>environment ç¯å¢ƒå˜é‡</li><li>expose å¯¹linksæš´éœ²çš„ç«¯å£</li></ul><hr><blockquote><p>è¿è¡Œdocker-compose upå³å¯ã€‚</p></blockquote><p><img src="/images/post/v2-0fe2c4793b45c041c13b10d690266649_1440w.png" alt="img"></p><p>å¯ä»¥çœ‹è§æœåŠ¡è¿è¡ŒæˆåŠŸäº†ã€‚wowï½</p><ul><li><a href="https://github.com/13sai/go-example/tree/main/demo7-docker-compose">è¯¦ç»†ä»£ç ç‚¹å‡»è¿›github</a></li></ul><p>dcoker composerè¯­æ³•å¯çœ‹èœé¸Ÿæ•™ç¨‹ï¼š</p><p><a href="https://www.runoob.com/docker/docker-compose.html">Docker Compose | èœé¸Ÿæ•™ç¨‹</a></p><p>æ–‡ä¸­éƒ¨åˆ†çŸ¥è¯†æ¥è‡ªã€ŠGoå¾®æœåŠ¡å®æˆ˜38è®²ã€‹ï¼Œæœ‰å…´è¶£å¯å‰å¾€æŸ¥çœ‹ï¼š</p><p><img src="/images/post/v2-3680541c44e6b0e0526a3d407487e7f3_1440w.png" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goruntineå’Œchannel</title>
    <link href="/2021/02/12/goexample8/"/>
    <url>/2021/02/12/goexample8/</url>
    
    <content type="html"><![CDATA[<p>å‰é¢å‡ ä¸ªå›åˆï¼Œæˆ‘ä»¬éƒ½æ˜¯å®ä¾‹ï¼Œä½†åœ¨goä¸­æœ‰ä¸ªå¾ˆå¸¸ç”¨çš„ä¸œä¸œï¼Œæˆ‘ä»¬ä»£ç ä½¿ç”¨çš„ä¸å¤šï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å•ç‹¬æ‹¿æ¥è®²è®²ã€‚</p><h3 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h3><blockquote><p>goroutineæ˜¯goè¯­è¨€ç‰¹æœ‰çš„å¹¶å‘ä½“ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ï¼Œç”±goå…³é”®å­—å¯åŠ¨ã€‚</p></blockquote><p>goroutineé‡‡ç”¨çš„æ˜¯åŠæŠ¢å å¸‚çš„åä½œè°ƒåº¦ï¼Œ<strong>åªæœ‰å½“å‰goroutineå‘ç”Ÿé˜»å¡æ—¶æ‰ä¼šå¯¼è‡´è°ƒåº¦ï¼ˆä¹Ÿå°±æ˜¯goroutineçš„åˆ‡æ¢ï¼‰</strong>ã€‚</p><p>é‚£ä¹ˆé¡¹ç›®ä¸­ä½¿ç”¨äº†å¤šä¸ªgoroutineï¼Œå¦‚ä½•åœ¨ä¸åŒçš„goroutineä¹‹é—´é€šä¿¡å‘¢ï¼Ÿ</p><p>å­¦ä¹ goçš„è¿‡ç¨‹ä¸­ï¼Œæƒ³å¿…ä½ åº”è¯¥çŸ¥é“æœ‰è¿™ä¹ˆä¸€ä¸ªç»å…¸çš„å¥å­ï¼š</p><blockquote><p>Do not communicate by sharing memory; instead, share memory by communicating.</p></blockquote><p><strong>goroutineçš„é€šä¿¡ç”¨é€šé“</strong></p><p><img src="https://pic1.zhimg.com/80/v2-dc5d88a2c439580386b95362f7c0bad8_1440w.jpg" alt="img"></p><p>é€šé“æ˜¯ä¸ªå•¥ï¼Ÿ</p><blockquote><p>ä¸€ä¸ªé€šé“ç›¸å½“äºä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—ï¼Œé€šé“ä¸­çš„å„ä¸ªå…ƒç´ æ˜¯ä¸¥æ ¼åœ°æŒ‰ç…§å‘é€çš„é¡ºåºæ’åˆ—çš„ï¼Œå…ˆè¢«å‘é€é€šé“çš„ä¸€å®šä¼šå…ˆè¢«æ¥æ”¶ã€‚å…ƒç´ çš„å‘é€å’Œæ¥æ”¶éƒ½éœ€è¦ç”¨åˆ°æ“ä½œç¬¦<code>&lt;-</code>ã€‚</p></blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªFIFOç®€å•çš„ä¾‹å­</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">5</span>)ch &lt;- <span class="hljs-number">1</span>ch &lt;- <span class="hljs-number">2</span>ch &lt;- <span class="hljs-number">3</span>ch &lt;- <span class="hljs-number">4</span>ch &lt;- <span class="hljs-number">5</span>fmt.Println(<span class="hljs-string">&quot;1-&quot;</span>, &lt;-ch)fmt.Println(<span class="hljs-string">&quot;2-&quot;</span>, &lt;-ch)ch &lt;- <span class="hljs-number">6</span>fmt.Println(<span class="hljs-string">&quot;3-&quot;</span>, &lt;-ch)fmt.Println(<span class="hljs-string">&quot;4-&quot;</span>, &lt;-ch)fmt.Println(<span class="hljs-string">&quot;5-&quot;</span>, &lt;-ch)fmt.Println(<span class="hljs-string">&quot;6-&quot;</span>, &lt;-ch)<span class="hljs-built_in">close</span>(ch)&#125;<span class="hljs-comment">/*</span><span class="hljs-comment">æ‰“å°çš„å†…å®¹å¦‚ä¸‹ï¼š</span><span class="hljs-comment">1- 1</span><span class="hljs-comment">2- 2</span><span class="hljs-comment">3- 3</span><span class="hljs-comment">4- 4</span><span class="hljs-comment">5- 5</span><span class="hljs-comment">6- 6</span><span class="hljs-comment">*/</span></code></pre></div><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹é€šé“çš„å¸¸è§„æ“ä½œï¼š</p><h3 id="åˆ›å»ºé€šé“"><a href="#åˆ›å»ºé€šé“" class="headerlink" title="åˆ›å»ºé€šé“"></a>åˆ›å»ºé€šé“</h3><p>é€šé“ï¼ˆchannelï¼‰åˆ†ä¸¤ç§ï¼ˆå®¹é‡æ˜¯å¦ä¸º0ï¼‰ï¼š</p><ul><li>ç¼“å†²é€šé“</li><li>éç¼“å†²é€šé“</li></ul><div class="code-wrapper"><pre><code class="hljs text">// ç¼“å†²é€šé“ch1 := make(chan int, 10)ch2 := make(chan bool, 2)// éç¼“å†²é€šé“ch3 := make(chan int)ch4 := make(chan bool, 0)</code></pre></div><h3 id="å‘é€é€šé“æ•°æ®"><a href="#å‘é€é€šé“æ•°æ®" class="headerlink" title="å‘é€é€šé“æ•°æ®"></a>å‘é€é€šé“æ•°æ®</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç©ºæ¥å£é€šé“ï¼Œæ³¨æ„å®šä¹‰çš„é€šé“ç±»å‹æœ‰</span>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125;)<span class="hljs-comment">// å°†0æ”¾å…¥é€šé“ä¸­</span>ch &lt;- <span class="hljs-number">0</span><span class="hljs-comment">// å°†helloå­—ç¬¦ä¸²æ”¾å…¥é€šé“ä¸­</span>ch &lt;- <span class="hljs-string">&quot;hello&quot;</span></code></pre></div><h3 id="æ¥æ”¶é€šé“æ•°æ®"><a href="#æ¥æ”¶é€šé“æ•°æ®" class="headerlink" title="æ¥æ”¶é€šé“æ•°æ®"></a>æ¥æ”¶é€šé“æ•°æ®</h3><h3 id="1-é˜»å¡æ¥æ”¶æ•°æ®"><a href="#1-é˜»å¡æ¥æ”¶æ•°æ®" class="headerlink" title="1. é˜»å¡æ¥æ”¶æ•°æ®"></a>1. é˜»å¡æ¥æ”¶æ•°æ®</h3><p>é˜»å¡æ¨¡å¼æ¥æ”¶æ•°æ®æ—¶ï¼Œå°†æ¥æ”¶å˜é‡ä½œä¸º<code>&lt;-</code>æ“ä½œç¬¦çš„å·¦å€¼ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">data := &lt;-ch</code></pre></div><p>æ‰§è¡Œè¯¥è¯­å¥æ—¶å°†ä¼šé˜»å¡ï¼Œç›´åˆ°æ¥æ”¶åˆ°æ•°æ®å¹¶èµ‹å€¼ç»™ data å˜é‡ã€‚</p><h3 id="2-éé˜»å¡æ¥æ”¶æ•°æ®"><a href="#2-éé˜»å¡æ¥æ”¶æ•°æ®" class="headerlink" title="2. éé˜»å¡æ¥æ”¶æ•°æ®"></a>2. éé˜»å¡æ¥æ”¶æ•°æ®</h3><p>ä½¿ç”¨éé˜»å¡æ–¹å¼ä»é€šé“æ¥æ”¶æ•°æ®æ—¶ï¼Œè¯­å¥ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">data, ok := &lt;-ch// dataï¼šè¡¨ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®ã€‚æœªæ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œdata ä¸ºé€šé“ç±»å‹çš„é›¶å€¼// okï¼šè¡¨ç¤ºæ˜¯å¦æ¥æ”¶åˆ°æ•°æ®ã€‚</code></pre></div><p>éé˜»å¡çš„é€šé“æ¥æ”¶æ–¹æ³•å¯èƒ½é€ æˆé«˜çš„ CPU å ç”¨ï¼Œå› æ­¤ä½¿ç”¨éå¸¸å°‘ã€‚å¦‚æœéœ€è¦å®ç°æ¥æ”¶è¶…æ—¶æ£€æµ‹ï¼Œå¯ä»¥é…åˆ select å’Œè®¡æ—¶å™¨ channel è¿›è¡Œï¼Œå¯ä»¥å‚è§åé¢çš„å†…å®¹ã€‚</p><h3 id="3-æ¥æ”¶ä»»æ„æ•°æ®ï¼Œå¿½ç•¥æ¥æ”¶çš„æ•°æ®"><a href="#3-æ¥æ”¶ä»»æ„æ•°æ®ï¼Œå¿½ç•¥æ¥æ”¶çš„æ•°æ®" class="headerlink" title="3. æ¥æ”¶ä»»æ„æ•°æ®ï¼Œå¿½ç•¥æ¥æ”¶çš„æ•°æ®"></a>3. æ¥æ”¶ä»»æ„æ•°æ®ï¼Œå¿½ç•¥æ¥æ”¶çš„æ•°æ®</h3><p>é˜»å¡æ¥æ”¶æ•°æ®åï¼Œå¿½ç•¥ä»é€šé“è¿”å›çš„æ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">&lt;-ch</code></pre></div><h3 id="4-å¾ªç¯æ¥æ”¶"><a href="#4-å¾ªç¯æ¥æ”¶" class="headerlink" title="4. å¾ªç¯æ¥æ”¶"></a>4. å¾ªç¯æ¥æ”¶</h3><p>é€šé“çš„æ•°æ®æ¥æ”¶å¯ä»¥å€Ÿç”¨ for range è¯­å¥è¿›è¡Œå¤šä¸ªå…ƒç´ çš„æ¥æ”¶æ“ä½œï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;fmt&quot;</span>    <span class="hljs-string">&quot;time&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    <span class="hljs-comment">// æ„å»ºä¸€ä¸ªé€šé“</span>    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)    <span class="hljs-comment">// å¼€å¯ä¸€ä¸ªå¹¶å‘åŒ¿åå‡½æ•°</span>    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;        <span class="hljs-comment">// ä»3å¾ªç¯åˆ°0</span>        <span class="hljs-keyword">for</span> i := <span class="hljs-number">3</span>; i &gt;= <span class="hljs-number">0</span>; i-- &#123;            <span class="hljs-comment">// å‘é€3åˆ°0ä¹‹é—´çš„æ•°å€¼</span>            ch &lt;- i            <span class="hljs-comment">// æ¯æ¬¡å‘é€å®Œæ—¶ç­‰å¾…</span>            time.Sleep(time.Second)        &#125;    &#125;()    <span class="hljs-comment">// éå†æ¥æ”¶é€šé“æ•°æ®</span>    <span class="hljs-keyword">for</span> data := <span class="hljs-keyword">range</span> ch &#123;        <span class="hljs-comment">// æ‰“å°é€šé“æ•°æ®</span>        fmt.Println(data)        <span class="hljs-comment">// å½“é‡åˆ°æ•°æ®0æ—¶, é€€å‡ºæ¥æ”¶å¾ªç¯</span>        <span class="hljs-keyword">if</span> data == <span class="hljs-number">0</span> &#123;                <span class="hljs-keyword">break</span>        &#125;    &#125;&#125;</code></pre></div><h3 id="å…³é—­é€šé“"><a href="#å…³é—­é€šé“" class="headerlink" title="å…³é—­é€šé“"></a>å…³é—­é€šé“</h3><div class="code-wrapper"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)...<span class="hljs-built_in">close</span>(ch)</code></pre></div><hr><h2 id="é€šé“ç‰¹æ€§"><a href="#é€šé“ç‰¹æ€§" class="headerlink" title="é€šé“ç‰¹æ€§"></a>é€šé“ç‰¹æ€§</h2><ul><li>å¯¹äºåŒä¸€ä¸ªé€šé“ï¼Œå‘é€æ“ä½œä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œæ¥æ”¶æ“ä½œä¹‹é—´ä¹Ÿæ˜¯äº’æ–¥çš„ï¼ˆå¹¶å‘å®‰å…¨ï¼‰</li><li>å‘é€æ“ä½œå’Œæ¥æ”¶æ“ä½œä¸­å¯¹å…ƒç´ å€¼çš„å¤„ç†éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„ã€‚</li><li>å‘é€æ“ä½œåœ¨å®Œå…¨å®Œæˆä¹‹å‰ä¼šè¢«é˜»å¡ï¼Œæ¥æ”¶æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ã€‚</li><li>å¯¹äºç¼“å†²é€šé“ï¼šå¦‚æœé€šé“å·²æ»¡ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰å‘é€æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰å…ƒç´ å€¼è¢«æ¥æ”¶èµ°ï¼›å¦‚æœé€šé“å·²ç©ºï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰æ¥æ”¶æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰æ–°çš„å…ƒç´ å€¼å‡ºç°ã€‚</li><li>å¯¹äºéç¼“å†²é€šé“ï¼šæ— è®ºæ˜¯å‘é€æ“ä½œè¿˜æ˜¯æ¥æ”¶æ“ä½œï¼Œä¸€å¼€å§‹æ‰§è¡Œå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é…å¯¹çš„æ“ä½œä¹Ÿå¼€å§‹æ‰§è¡Œï¼Œæ‰ä¼šç»§ç»­ä¼ é€’ã€‚</li></ul><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>å…³é—­é€šé“è¦åœ¨å‘é€æ–¹å…³é—­ï¼Œå…³é—­åå¦‚æœchannelå†…è¿˜æœ‰å…ƒç´ ï¼Œå¹¶ä¸ä¼šå¯¹æ¥ä¸‹æ¥çš„æ¥æ”¶äº§ç”Ÿå½±å“</li><li>å•å‘é€šé“æœ€ä¸»è¦çš„ç”¨é€”å°±æ˜¯çº¦æŸå…¶ä»–ä»£ç çš„è¡Œä¸º</li><li>é€šè¿‡å‡½æ•°çš„å‚æ•°ç±»å‹æˆ–è€…è¿”å›å€¼ç±»å‹æ¥é™åˆ¶ï¼ˆGoçš„è¯­æ³•ç³–ï¼‰ã€‚</li></ul><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ch <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span>)</span>ï¼›ä¼ å…¥åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°é‡Œé¢è°ƒç”¨<span class="hljs-title">ch</span>åªèƒ½å‘é€</span><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-params">(ch &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span>ï¼›è¿”å›åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°å¤–é¢é‡Œé¢è°ƒç”¨<span class="hljs-title">ch</span>åªèƒ½æ¥æ”¶</span></code></pre></div><p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æä¸€ä¸‹channelç‹¬æœ‰çš„å…³é”®å­—â€”â€”selectã€‚</p><blockquote><p>A â€œselectâ€ statement chooses which of a set of possible send or receive operations will proceed. It looks similar to a â€œswitchâ€ statement but with the cases all referring to communication operations.</p><p>ä¸€ä¸ªselectè¯­å¥ç”¨æ¥é€‰æ‹©å“ªä¸ªcaseä¸­çš„å‘é€æˆ–æ¥æ”¶æ“ä½œå¯ä»¥è¢«ç«‹å³æ‰§è¡Œã€‚å®ƒç±»ä¼¼äºswitchè¯­å¥ï¼Œä½†æ˜¯å®ƒçš„caseæ¶‰åŠåˆ°channelæœ‰å…³çš„I/Oæ“ä½œã€‚</p></blockquote><p>è¯´å®Œè¿™äº›æ¦‚å¿µæ€§çš„ç©æ„å„¿ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥å‡ ä¸ªå®ä¾‹ï¼Œæ„Ÿå—ä¸€ä¸‹goroutineé…åˆchannelä½¿ç”¨çš„å¿«æ„Ÿã€‚</p><hr><h3 id="chané…åˆselectå®ç°è¶…æ—¶å¤„ç†"><a href="#chané…åˆselectå®ç°è¶…æ—¶å¤„ç†" class="headerlink" title="chané…åˆselectå®ç°è¶…æ—¶å¤„ç†"></a>chané…åˆselectå®ç°è¶…æ—¶å¤„ç†</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;timeout := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;time.Sleep(<span class="hljs-number">3e9</span>)timeout &lt;- <span class="hljs-literal">true</span>&#125;()ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-ch:<span class="hljs-keyword">case</span> &lt;-timeout:fmt.Println(<span class="hljs-string">&quot;timeout!&quot;</span>)&#125;&#125;</code></pre></div><h3 id="éç¼“å†²é€šé“ï¼Œç›‘å¬ä¿¡å·é‡"><a href="#éç¼“å†²é€šé“ï¼Œç›‘å¬ä¿¡å·é‡" class="headerlink" title="éç¼“å†²é€šé“ï¼Œç›‘å¬ä¿¡å·é‡"></a>éç¼“å†²é€šé“ï¼Œç›‘å¬ä¿¡å·é‡</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// æ¥è‡ªginæ–‡æ¡£çš„ä¾‹å­</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;router := gin.Default()router.GET(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;time.Sleep(<span class="hljs-number">5</span> * time.Second)c.String(http.StatusOK, <span class="hljs-string">&quot;Welcome Gin Server&quot;</span>)&#125;)srv := &amp;http.Server&#123;Addr:    <span class="hljs-string">&quot;:8080&quot;</span>,Handler: router,&#125;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// æœåŠ¡è¿æ¥</span><span class="hljs-keyword">if</span> err := srv.ListenAndServe(); err != <span class="hljs-literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;log.Fatalf(<span class="hljs-string">&quot;listen: %s\n&quot;</span>, err)&#125;&#125;()<span class="hljs-comment">// ç­‰å¾…ä¸­æ–­ä¿¡å·ä»¥ä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨ï¼ˆè®¾ç½® 5 ç§’çš„è¶…æ—¶æ—¶é—´ï¼‰</span>quit := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal)signal.Notify(quit, os.Interrupt)&lt;-quitlog.Println(<span class="hljs-string">&quot;Shutdown Server ...&quot;</span>)ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">5</span>*time.Second)<span class="hljs-keyword">defer</span> cancel()<span class="hljs-keyword">if</span> err := srv.Shutdown(ctx); err != <span class="hljs-literal">nil</span> &#123;log.Fatal(<span class="hljs-string">&quot;Server Shutdown:&quot;</span>, err)&#125;log.Println(<span class="hljs-string">&quot;Server exiting&quot;</span>)&#125;</code></pre></div><p>å½“ç„¶è¿˜æœ‰å…¶ä»–åº”ç”¨åœºæ™¯ï¼Œå¦‚æ¶ˆæ¯ä¼ é€’ã€æ¶ˆæ¯è¿‡æ»¤ï¼Œäº‹ä»¶è®¢é˜…ä¸å¹¿æ’­ï¼Œè¯·æ±‚ã€å“åº”è½¬å‘ï¼Œå¹¶å‘æ§åˆ¶ï¼ŒåŒæ­¥ä¸å¼‚æ­¥ç­‰ï¼Œå¯å‚è€ƒä¸‹é¢çš„æ–‡ç« ï¼š</p><p><a href="https://lessisbetter.site/2019/01/20/golang-channel-all-usage/">æ€»ç»“äº†æ‰çŸ¥é“ï¼ŒåŸæ¥channelæœ‰è¿™ä¹ˆå¤šç”¨æ³•ï¼</a></p><hr><p><a href="https://github.com/13sai/go-example/tree/main/demo8-goroutine-channel">å®ä¾‹ä»£ç ç‚¹å‡»è§githubgithub.com/13sai/go-example/tree/main/demo8-goroutine-channel</a></p><p>å‚è€ƒï¼š</p><ul><li><a href="http://c.biancheng.net/view/97.html">Goè¯­è¨€é€šé“ï¼ˆchanï¼‰â€”â€”goroutineä¹‹é—´é€šä¿¡çš„ç®¡é“</a></li><li><a href="https://time.geekbang.org/column/intro/112">Goè¯­è¨€æ ¸å¿ƒ36è®²_Golang_Goè¯­è¨€-æå®¢æ—¶é—´</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golangé™æµå™¨</title>
    <link href="/2021/02/12/goexample9/"/>
    <url>/2021/02/12/goexample9/</url>
    
    <content type="html"><![CDATA[<p>é™æµåº”è¯¥æ˜¯æˆ‘ä»¬å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„äº†ï¼Œé™æµå™¨èƒ½ä¿è¯æˆ‘ä»¬ä¸è‡³äºåœ¨æµé‡è¿‡å¤§çš„æ—¶å€™æœåŠ¡è¶…è¿‡è´Ÿè½½ï¼Œèƒ½æœ‰æ•ˆåœ°ä¿è¯æœåŠ¡çš„å¯ç”¨å’Œç¨³å®šã€‚</p><p>goè‡ªå¸¦æœ‰é™æµå™¨rateï¼Œå®ƒçš„æœ¬è´¨å…¶å®å°±æ˜¯ä»¤ç‰Œæ¡¶ã€‚ç”¨èµ·æ¥ä¹Ÿååˆ†ç®€å•ã€‚æˆ‘ä»¬ä¿®æ”¹ä¸‹ä¹‹å‰çš„httpæœåŠ¡åšä¸€äº›ä¿®æ”¹ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// ServeMuxç±»å‹æ˜¯HTTPè¯·æ±‚çš„å¤šè·¯è½¬æ¥å™¨ã€‚å®ƒä¼šå°†æ¯ä¸€ä¸ªæ¥æ”¶çš„è¯·æ±‚çš„URLä¸ä¸€ä¸ªæ³¨å†Œæ¨¡å¼çš„åˆ—è¡¨è¿›è¡ŒåŒ¹é…ï¼Œå¹¶è°ƒç”¨å’ŒURLæœ€åŒ¹é…çš„æ¨¡å¼çš„å¤„ç†å™¨ã€‚</span>mux := http.NewServeMux()mux.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, defaultHttp)http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, middlewareLimit(mux))&#125;<span class="hljs-comment">// é™æµæ¡¶</span><span class="hljs-keyword">var</span> limiter = rate.NewLimiter(rate.Every(time.Second), <span class="hljs-number">1</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">middlewareLimit</span><span class="hljs-params">(next http.Handler)</span> <span class="hljs-title">http</span>.<span class="hljs-title">Handler</span></span> &#123;<span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<span class="hljs-keyword">if</span> limiter.Allow() == <span class="hljs-literal">false</span> &#123;fmt.Println(<span class="hljs-string">&quot;limit&quot;</span>)<span class="hljs-keyword">return</span>&#125;next.ServeHTTP(w, r)&#125;)&#125;<span class="hljs-comment">// é»˜è®¤httpå¤„ç†</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">defaultHttp</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;path := r.URL.Path<span class="hljs-keyword">if</span> path == <span class="hljs-string">&quot;/&quot;</span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;index&quot;</span>))fmt.Println(<span class="hljs-string">&quot;index&quot;</span>)<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// è‡ªå®šä¹‰404</span>http.Error(w, <span class="hljs-string">&quot;you lost???&quot;</span>, http.StatusNotFound)&#125;</code></pre></div><p>è¿™é‡Œçš„</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> limiter = rate.NewLimiter(rate.Every(<span class="hljs-number">2</span>*time.Second), <span class="hljs-number">1</span>)</code></pre></div><p>å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªé™æµå™¨ï¼Œç”Ÿæˆé€Ÿç‡æ˜¯1 ä¸ª/sï¼Œä»¤ç‰Œæ¡¶çš„å®¹é‡æ˜¯1ã€‚ä¹Ÿå°±æ˜¯æ¯ç§’æœ€å¤šèƒ½é€šè¿‡2ä¸ªè¯·æ±‚ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨abæˆ–è€…å¿«é€Ÿåˆ·æ–°æµè§ˆå™¨æ¥çœ‹ä¸€ä¸‹æ•ˆæœ</p><p>æ˜¯ä¸æ˜¯æœ‰ç‚¹ç±»ä¼¼nginxçš„é™æµæ¨¡å—ï¼š</p><div class="code-wrapper"><pre><code class="hljs text">limit_req_zone  $binary_remote_addr  zone=one:10m  rate=1r/s;server &#123;    ...    location / &#123;        #ç¼“å­˜åŒºé˜Ÿåˆ—burst=5ä¸ª,nodelayè¡¨ç¤ºä¸å»¶æœŸ(è¶…è¿‡çš„è¯·æ±‚å¤±è´¥)ï¼Œå³æ¯ç§’æœ€å¤šå¯å¤„ç†rate+burstä¸ª,åŒæ—¶å¤„ç†rateä¸ªã€‚        limit_req zone=one burst=1 nodelay;     &#125;&#125;</code></pre></div><hr><p>ä¸Šé¢çš„ä»£ç æœ‰ä¸¤å¤„æ³¨æ„ç‚¹ï¼š</p><ul><li>middlewareLimit å¯çœ‹ä½œä¸€ä¸ªhttp serverçš„å‰ç½®ä¸­é—´ä»¶ï¼Œä½ å¯ä»¥ç±»æ¯”å»è‡ªå·±å¤„ç†å¤æ‚çš„httpä¸­é—´ä»¶ä¸šåŠ¡ã€‚</li><li>é™æµå™¨çš„åˆå§‹åŒ–åŠ¡å¿…åœ¨ä¸­é—´ä»¶å‰ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¿®æ”¹ä»£ç å†æµ‹è¯•:</li></ul><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">middlewareLimit</span><span class="hljs-params">(next http.Handler)</span> <span class="hljs-title">http</span>.<span class="hljs-title">Handler</span></span> &#123;<span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;limiter := rate.NewLimiter(rate.Every(<span class="hljs-number">2</span>*time.Second), <span class="hljs-number">10</span>)<span class="hljs-keyword">if</span> limiter.Allow() == <span class="hljs-literal">false</span> &#123;fmt.Println(<span class="hljs-string">&quot;limit&quot;</span>)<span class="hljs-keyword">return</span>&#125;next.ServeHTTP(w, r)&#125;)&#125;</code></pre></div><p>æ­¤å¤–ï¼ŒLimiter ä¹Ÿæœ‰å…¶ä»–çš„æ–¹æ³•ï¼š</p><ul><li>SetLimit(Limit) åŠ¨æ€ä¿®æ”¹æ”¾å…¥ä»¤ç‰Œçš„é€Ÿç‡</li><li>SetBurst(int) åŠ¨æ€ä¿®æ”¹æ¡¶å¤§å°</li><li>Wait/WaitN å½“æ²¡æœ‰å¯ç”¨äº‹ä»¶æ—¶ï¼Œå°†é˜»å¡ç­‰å¾…</li><li>Reserve/ReserveN å½“æ²¡æœ‰å¯ç”¨äº‹ä»¶æ—¶ï¼Œè¿”å› Reservationï¼Œå’Œè¦ç­‰å¾…å¤šä¹…æ‰èƒ½è·å¾—è¶³å¤Ÿçš„äº‹ä»¶</li></ul><p><a href="https://github.com/13sai/go-example/tree/main/demo9-rate">ä»£ç ç‚¹å‡»è§githubgithub.com/13sai/go-example/tree/main/demo9-rate</a></p>]]></content>
    
    
    <categories>
      
      <category>goexample</category>
      
    </categories>
    
    
    <tags>
      
      <tag>goexample</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DockeråŸºç¡€ä¸å¸¸ç”¨å‘½ä»¤</title>
    <link href="/2021/02/10/312/"/>
    <url>/2021/02/10/312/</url>
    
    <content type="html"><![CDATA[<h2 id="Docker-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Docker-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Docker æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Docker æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><strong>Docker å±äº Linux å®¹å™¨çš„ä¸€ç§å°è£…ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„å®¹å™¨ä½¿ç”¨æ¥å£ã€‚</strong>å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Linux å®¹å™¨è§£å†³æ–¹æ¡ˆã€‚</p><p>Docker å°†åº”ç”¨ç¨‹åºä¸è¯¥ç¨‹åºçš„ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨ã€‚ç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œè¿è¡Œï¼Œå°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œä¸€æ ·ã€‚æœ‰äº† Dockerï¼Œå°±ä¸ç”¨æ‹…å¿ƒç¯å¢ƒé—®é¢˜ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼ŒDocker çš„æ¥å£ç›¸å½“ç®€å•ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œä½¿ç”¨å®¹å™¨ï¼ŒæŠŠè‡ªå·±çš„åº”ç”¨æ”¾å…¥å®¹å™¨ã€‚å®¹å™¨è¿˜å¯ä»¥è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€å¤åˆ¶ã€åˆ†äº«ã€ä¿®æ”¹ï¼Œå°±åƒç®¡ç†æ™®é€šçš„ä»£ç ä¸€æ ·ã€‚</p><h2 id="Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ"><a href="#Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ" class="headerlink" title="Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ"></a>Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ</h2><ol><li>é•œåƒï¼ˆImageï¼‰ï¼šç±»ä¼¼äºè™šæ‹Ÿæœºä¸­çš„é•œåƒï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ–‡ä»¶ç³»ç»Ÿçš„é¢å‘Dockerå¼•æ“çš„åªè¯»æ¨¡æ¿ã€‚ä»»ä½•åº”ç”¨ç¨‹åºè¿è¡Œéƒ½éœ€è¦ç¯å¢ƒï¼Œè€Œé•œåƒå°±æ˜¯ç”¨æ¥æä¾›è¿™ç§è¿è¡Œç¯å¢ƒçš„ã€‚ä¾‹å¦‚ä¸€ä¸ªUbuntué•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Ubuntuæ“ä½œç³»ç»Ÿç¯å¢ƒçš„æ¨¡æ¿ï¼ŒåŒç†åœ¨è¯¥é•œåƒä¸Šè£…ä¸ŠApacheè½¯ä»¶ï¼Œå°±å¯ä»¥ç§°ä¸ºApacheé•œåƒã€‚</li><li>å®¹å™¨ï¼ˆContainerï¼‰ï¼šç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç›’ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæç®€çš„Linuxç³»ç»Ÿç¯å¢ƒï¼ˆåŒ…æ‹¬rootæƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰ï¼Œä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚Dockerå¼•æ“åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œã€éš”ç¦»å„ä¸ªåº”ç”¨ã€‚å®¹å™¨æ˜¯é•œåƒåˆ›å»ºçš„åº”ç”¨å®ä¾‹ï¼Œå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å®¹å™¨ï¼Œå„ä¸ªå®¹å™¨ä¹‹é—´æ˜¯æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œäº’ä¸å½±å“ã€‚æ³¨æ„ï¼šé•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œå®¹å™¨ä»é•œåƒå¯åŠ¨æ—¶ï¼ŒDockeråœ¨é•œåƒçš„ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ï¼Œé•œåƒæœ¬èº«ä¸å˜ã€‚</li><li>ä»“åº“ï¼ˆRepositoryï¼‰ï¼šç±»ä¼¼äºä»£ç ä»“åº“ï¼Œè¿™é‡Œæ˜¯é•œåƒä»“åº“ï¼Œæ˜¯Dockerç”¨æ¥é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœ°æ–¹ã€‚æ³¨æ„ä¸æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰çš„åŒºåˆ«ï¼šæ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªä»“åº“ï¼›è€Œä»“åº“æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œä¸€èˆ¬æ¯ä¸ªä»“åº“å­˜æ”¾ä¸€ç±»é•œåƒï¼Œæ¯ä¸ªé•œåƒåˆ©ç”¨tagè¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚Ubuntuä»“åº“å­˜æ”¾æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆ12.04ã€14.04ç­‰ï¼‰çš„Ubuntué•œåƒã€‚</li></ol><h2 id="Docker-çš„ç”¨é€”"><a href="#Docker-çš„ç”¨é€”" class="headerlink" title="Docker çš„ç”¨é€”"></a>Docker çš„ç”¨é€”</h2><p>Docker çš„ä¸»è¦ç”¨é€”ï¼Œç›®å‰æœ‰ä¸‰å¤§ç±»ã€‚</p><p><strong>ï¼ˆ1ï¼‰æä¾›ä¸€æ¬¡æ€§çš„ç¯å¢ƒã€‚</strong>æ¯”å¦‚ï¼Œæœ¬åœ°æµ‹è¯•ä»–äººçš„è½¯ä»¶ã€æŒç»­é›†æˆçš„æ—¶å€™æä¾›å•å…ƒæµ‹è¯•å’Œæ„å»ºçš„ç¯å¢ƒã€‚</p><p><strong>ï¼ˆ2ï¼‰æä¾›å¼¹æ€§çš„äº‘æœåŠ¡ã€‚</strong>å› ä¸º Docker å®¹å™¨å¯ä»¥éšå¼€éšå…³ï¼Œå¾ˆé€‚åˆåŠ¨æ€æ‰©å®¹å’Œç¼©å®¹ã€‚</p><p><strong>ï¼ˆ3ï¼‰ç»„å»ºå¾®æœåŠ¡æ¶æ„ã€‚</strong>é€šè¿‡å¤šä¸ªå®¹å™¨ï¼Œä¸€å°æœºå™¨å¯ä»¥è·‘å¤šä¸ªæœåŠ¡ï¼Œå› æ­¤åœ¨æœ¬æœºå°±å¯ä»¥æ¨¡æ‹Ÿå‡ºå¾®æœåŠ¡æ¶æ„ã€‚</p><h2 id="Dockerçš„ä¼˜ç¼ºç‚¹"><a href="#Dockerçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="Dockerçš„ä¼˜ç¼ºç‚¹"></a>Dockerçš„ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p><strong>1. æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº</strong></p><p>dockerå¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡æ›´é«˜ï¼Œæ— è®ºæ˜¯åº”ç”¨æ‰§è¡Œé€Ÿåº¦ï¼Œå†…å­˜æŸè€—æˆ–è€…æ–‡ä»¶å­˜å‚¨é€Ÿåº¦ï¼Œéƒ½è¦æ¯”ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ›´é«˜æ•ˆã€‚å› æ­¤ï¼Œç›¸æ¯”è™šæ‹ŸæœºæŠ€æœ¯ï¼Œä¸€ä¸ªç›¸åŒé…ç½®çš„ä¸»æœºå¾€å¾€å¯ä»¥è¿è¡Œæ›´å¤šæ•°é‡çš„åº”ç”¨ã€‚</p><p><strong>2. æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´</strong></p><p>ä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯å¯åŠ¨åº”ç”¨æœåŠ¡å¾€å¾€éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œdockerå®¹å™¨åº”ç”¨ï¼Œç”±äºç›´æ¥è¿è¡Œäºå®¿ä¸»å†…æ ¸ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥åšåˆ°ç§’çº§ï¼Œç”šè‡³æ¯«ç§’çº§çš„å¯åŠ¨æ—¶é—´ï¼Œå¤§å¤§çš„èŠ‚çº¦äº†å¼€å‘æµ‹è¯•ï¼Œéƒ¨ç½²çš„æ—¶é—´ã€‚</p><p><strong>3. ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ</strong></p><p>å¼€å‘è¿‡ç¨‹ä¸­å¸¸è§çš„ä¸€ä¸ªé—®é¢˜æ˜¯ç¯å¢ƒä¸€è‡´é—®é¢˜ï¼Œç”±äºå¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´æœ‰äº›bugå¹¶æœªåœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°ã€‚è€Œdockerçš„é•œåƒæä¾›äº†é™¤å†…æ ¸å¤–å®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§ï¼Œä»è€Œä¸ä¼šåœ¨å‡ºç°â€œè¿™æ®µä»£ç åœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜â€è¿™ç±»é—®é¢˜ã€‚</p><p><strong>4. æŒç»­æ”¯ä»˜å’Œéƒ¨ç½²</strong></p><p>å¯¹å¼€å‘å’Œè¿ç»´äººå‘˜æ¥è¯´ï¼Œæœ€å¸Œæœ›å°±æ˜¯ä¸€æ¬¡åˆ›å»ºå’Œéƒ¨ç½²ï¼Œå¯ä»¥åœ¨ä»»æ„çš„åœ°æ–¹è¿è¡Œã€‚ï¼ˆå®šåˆ¶åº”ç”¨é•œåƒæ¥å®ç°é›†æˆã€æŒç»­æ”¯ä»˜ã€éƒ¨ç½²ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡<strong>dockerfile</strong>æ¥è¿›è¡Œé•œåƒæ„å»ºï¼Œå¹¶ç»“åˆæŒç»­é›†æˆç³»ç»Ÿè¿›è¡Œé›†æˆæµ‹è¯•ï¼Œè€Œè¿ç»´äººå‘˜åˆ™å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿéƒ¨ç½²è¯¥é•œåƒï¼Œç”šè‡³ç»“åˆæŒç»­éƒ¨ç½²ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ï¼‰ã€‚è€Œä¸”ä½¿ç”¨<strong>dockerfile</strong>ä½¿é•œåƒæ„å»ºé€æ˜åŒ–ï¼Œä¸ä»…ä»…å¼€å‘å›¢é˜Ÿå¯ä»¥ç†è§£åº”ç”¨è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ–¹ä¾¿è¿ç»´å›¢é˜Ÿç†è§£åº”ç”¨è¿è¡Œæ‰€éœ€æ¡ä»¶ï¼Œå¸®åŠ©æ›´å¥½çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²è¯¥é•œåƒã€‚</p><p><strong>5. æ›´è½»æ¾çš„è¿ç§»</strong></p><p>ç”±äºdockerç¡®ä¿äº†æ‰§è¡Œç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œä½¿å¾—åº”ç”¨çš„è¿ç§»æ›´åŠ çš„å®¹æ˜“ã€‚dockerå¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸Šè¿è¡Œï¼Œæ— è®ºæ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€ç”šè‡³æ˜¯ç¬”è®°æœ¬ã€å…¶è¿è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚å› æ­¤ç”¨æˆ·å¯ä»¥å¾ˆè½»æ˜“çš„å°†åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿è¡Œçš„åº”ç”¨ï¼Œè¿ç§»åˆ°å¦ä¸€ä¸ªå¹³å°ä¸Šï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿è¡Œç¯å¢ƒçš„å˜åŒ–å¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œçš„æƒ…å†µã€‚</p><p><strong>6. æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‹“å±•</strong></p><p>dockerä½¿ç”¨çš„åˆ†å±‚å­˜å‚¨ä»¥åŠé•œåƒçš„æŠ€æœ¯ï¼Œä½¿å¾—åº”ç”¨é‡å¤éƒ¨åˆ†çš„å¤ç”¨æ›´ä¸ºå®¹æ˜“ï¼Œä¹Ÿä½¿å¾—åº”ç”¨çš„ç»´æŠ¤æ›´æ–°æ›´åŠ ç®€å•ï¼ŒåŸºäºåŸºç¡€é•œåƒè¿›ä¸€æ­¥æ‰©å±•é•œåƒä¹Ÿå˜å¾—ååˆ†ç®€å•ã€‚æ­¤å¤–ï¼Œdockerå›¢é˜ŸåŒå„ä¸ªå¼€æºé¡¹ç›®å›¢é˜Ÿä¸€èµ·ç»´æŠ¤äº†ä¸€å¤§æ‰¹é«˜è´¨é‡çš„å®˜ç½‘é•œåƒï¼Œæ—¢å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œåˆå¯ä»¥ä½œä¸ºåŸºç¡€è¿›ä¸€æ­¥å®šåˆ¶ï¼Œå¤§å¤§çš„é™ä½äº†åº”ç”¨æœåŠ¡çš„é•œåƒåˆ¶ä½œæˆæœ¬ã€‚</p><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p><strong>1.éš”ç¦»æ€§</strong></p><p>åŸºäºhypervisorçš„è™šæ‹ŸæŠ€æœ¯ï¼Œåœ¨éš”ç¦»æ€§ä¸Šæ¯”å®¹å™¨æŠ€æœ¯è¦å¥½ï¼Œå®ƒä»¬çš„ç³»ç»Ÿç¡¬ä»¶èµ„æºå®Œå…¨ä¸Šè™šæ‹ŸåŒ–çš„ï¼Œå½“ä¸€å°è™šæ‹Ÿæœºå‡ºç°ç³»ç»Ÿçº§åˆ«çš„é—®é¢˜ï¼Œå¾€å¾€ä¸ä¼šè”“å»¶åˆ°åŒä¸€å®¿ä¸»æœºä¸Šçš„å…¶å®ƒè™šæ‹Ÿæœºä¸Šï¼Œä½†æ˜¯å®¹å™¨å°±ä¸ä¸€æ ·äº†ï¼Œå®¹å™¨ä¹‹é—´å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸åŠå…¶å®ƒç»„ä»¶ï¼Œæ‰€ä»¥åœ¨å—åˆ°è¯¸å¦‚é»‘å®¢æ”»å‡»è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“é€šè¿‡åº•å±‚æ“ä½œç³»ç»Ÿå½±å“çš„å…¶å®ƒå®¹å™¨ï¼Œç”šè‡³é€ä¸ªå‡»ç ´ï¼Œäº§ç”Ÿè¿é”ååº”ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡éƒ¨ç½²å®¹å™¨æ¥è§£å†³ï¼Œä½†éšä¹‹åˆä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œæ¯”å¦‚æˆæœ¬å¢åŠ ä»¥åŠæ€§èƒ½é—®é¢˜ã€‚</p><p><strong>2.æ€§èƒ½</strong></p><p>ä¸ç®¡æ˜¯è™šæ‹Ÿæœºè¿˜æ˜¯å®¹å™¨ï¼Œéƒ½æ˜¯è¿ç”¨ä¸åŒçš„æŠ€æœ¯å¯¹åº”ç”¨æœ¬èº«è¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„å°è£…ä¸éš”ç¦»ï¼Œåœ¨é™ä½åº”ç”¨å’Œåº”ç”¨ä¹‹é—´ä»¥åŠåº”ç”¨å’Œç¯å¢ƒä¹‹é—´çš„è€¦åˆæ€§ä¸Šåšäº†å¾ˆå¤šåŠªåŠ›ï¼Œä½†æ˜¯éšä¹‹è€Œæ¥çš„ï¼Œå°±ä¼šäº§ç”Ÿæ›´è¿‡çš„ç½‘ç»œè¿æ¥è½¬å‘å’Œæ•°æ®äº¤äº’ï¼Œè¿™åœ¨ä½å¹¶å‘ç³»ç»Ÿä¸Šè™½ç„¶ä¸ä¼šå¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯å½“åŒä¸€è™šæ‹Ÿæœºæˆ–è€…æœåŠ¡å™¨ä¸‹é¢çš„å®¹å™¨éœ€è¦æ›´é«˜å¹¶å‘é‡æ”¯æ’‘çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯å¹¶å‘é—®é¢˜æˆä¸ºç³»ç»Ÿç“¶é¢ˆçš„æ—¶å€™ï¼Œå®¹å™¨ä¼šå°†è¿™ä¸ªé—®é¢˜æ”¾å¤§ï¼Œæ‰€ä»¥ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚åˆå®¹å™¨æŠ€æœ¯ã€‚</p><p><strong>3.å­˜å‚¨æ–¹æ¡ˆ</strong></p><p>å®¹å™¨çš„è¯ç”Ÿå¹¶ä¸æ˜¯ä¸ºOSæŠ½è±¡æœåŠ¡çš„ï¼Œè¿™æ˜¯å®ƒå’Œè™šæ‹Ÿæœºæœ€å¤§çš„åŒºåˆ«ï¼Œè¿™æ ·çš„åŸºå› æ„å‘³ç€å®¹å™¨å¤©ç”Ÿæ˜¯ä¸ºåº”ç”¨ç¯å¢ƒåšæ›´å¤šçš„åŠªåŠ›ï¼Œå®¹å™¨çš„ä¼¸ç¼©ä¹Ÿæ˜¯åŸºäºå®¹å™¨çš„è¿™ä¸€ç‰¹æ€§ï¼Œè€Œä¸ä¹‹ç›¸å¯¹çš„ï¼Œéœ€è¦æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆæ°æ°ç›¸åï¼Œåœ¨æ•°æ®å­˜å‚¨è¿™ä¸€ç‚¹ä¸ŠDockerå®¹å™¨æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ©ç”¨volumeæ¥å£(å­˜å‚¨å·)å½¢æˆæ•°æ®çš„æ˜ å°„å’Œè½¬ç§»ï¼Œä»¥å®ç°æ•°æ®æŒä¹…åŒ–çš„ç›®çš„ã€‚ä½†æ˜¯è¿™æ ·åŒæ ·ä¹Ÿä¼šé€ æˆä¸€éƒ¨åˆ†èµ„æºçš„æµªè´¹å’Œæ›´å¤šçš„äº¤äº’ï¼Œä¸ç®¡æ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šè¿˜æ˜¯ç½‘ç»œç£ç›˜ï¼Œéƒ½æ˜¯é€€è€Œæ±‚å…¶æ¬¡çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="åŸºç¡€å‘½ä»¤"><a href="#åŸºç¡€å‘½ä»¤" class="headerlink" title="åŸºç¡€å‘½ä»¤"></a>åŸºç¡€å‘½ä»¤</h2><ul><li>å¯åŠ¨</li></ul><blockquote><p>docker start å®¹å™¨å</p></blockquote><ul><li>åˆ é™¤</li></ul><blockquote><p>docker rm å®¹å™¨å</p></blockquote><ul><li>åœæ­¢æ‰€æœ‰å®¹å™¨</li></ul><blockquote><p>docker stop $(docker ps -a -q)</p></blockquote><ul><li>åˆ é™¤æ‰€æœ‰å®¹å™¨</li></ul><blockquote><p>docker rm $(docker ps -a -q)</p></blockquote><ul><li>å®¹å™¨æ„å»ºé•œåƒ</li></ul><div class="code-wrapper"><pre><code class="hljs n1ql">Usage:docker <span class="hljs-keyword">build</span> [OPTIONS] <span class="hljs-keyword">PATH</span> | URL | -OPTIONS:-t ï¼Œ--tag list  #æ„å»ºåçš„é•œåƒåç§°-fï¼Œ --file <span class="hljs-keyword">string</span> #æŒ‡å®šDockerfiileæ–‡ä»¶ä½ç½®ç¤ºä¾‹:- <span class="hljs-number">1</span>ï¼Œdocker <span class="hljs-keyword">build</span> .- <span class="hljs-number">2</span>ï¼Œdocker <span class="hljs-keyword">build</span> -t Redis:v1 .- <span class="hljs-number">3</span>ï¼Œdocker <span class="hljs-keyword">build</span> -t Redis:v2 -f /<span class="hljs-keyword">path</span>/Dockerfile /<span class="hljs-keyword">path</span>ä¸€èˆ¬å¸¸ç”¨ç¬¬<span class="hljs-number">2</span>ç§æ–¹å¼æ„å»ºï¼Œæˆ‘ä»¬åœ¨æ„å»ºæ—¶éƒ½ä¼šåˆ‡æ¢åˆ°Dockerfileæ–‡ä»¶çš„ç›®å½•ä¸‹è¿›è¡Œæ„å»ºï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®š-få‚æ•°</code></pre></div><ul><li>è¿›å…¥å®¹å™¨ï¼ˆæœªå¿…ä¸€å®šæ˜¯bashå‘½ä»¤ï¼‰</li></ul><blockquote><p>docker exec -it å®¹å™¨å bash</p></blockquote><ul><li>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</li></ul><blockquote><p>docker inspect å®¹å™¨å</p></blockquote><ul><li>æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿— </li></ul><blockquote><p>docker logs å®¹å™¨å</p></blockquote><ul><li>æŸ¥çœ‹æœ¬åœ°é•œåƒ</li></ul><blockquote><p>docker images</p></blockquote><ul><li>docker ç½‘ç»œ</li></ul><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>docker network connect</td><td>å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œã€‚</td></tr><tr><td>docker network create</td><td>åˆ›å»ºæ–°çš„ Docker ç½‘ç»œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ Windows ä¸Šä¼šé‡‡ç”¨ NAT é©±åŠ¨ï¼Œåœ¨ Linux ä¸Šä¼šé‡‡ç”¨ Bridge é©±åŠ¨ã€‚å¯ä»¥ä½¿ç”¨ -d å‚æ•°æŒ‡å®šé©±åŠ¨ï¼ˆç½‘ç»œç±»å‹ï¼‰ã€‚</td></tr><tr><td>docker network disconnect</td><td>æ–­å¼€å®¹å™¨çš„ç½‘ç»œã€‚</td></tr><tr><td>docker network inspect</td><td>æä¾› Docker ç½‘ç»œçš„è¯¦ç»†é…ç½®ä¿¡æ¯ã€‚</td></tr><tr><td>docker network ls</td><td>ç”¨äºåˆ—å‡ºè¿è¡Œåœ¨æœ¬åœ° Docker ä¸»æœºä¸Šçš„å…¨éƒ¨ç½‘ç»œã€‚</td></tr><tr><td>docker network prune</td><td>åˆ é™¤ Docker ä¸»æœºä¸Šå…¨éƒ¨æœªä½¿ç”¨çš„ç½‘ç»œã€‚</td></tr><tr><td>docker network rm</td><td>åˆ é™¤ Docker ä¸»æœºä¸ŠæŒ‡å®šç½‘ç»œã€‚</td></tr></tbody></table><ul><li>é•œåƒçš„ä¿å­˜</li></ul><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> save ae<span class="hljs-number">513</span>a<span class="hljs-number">47849</span>c &gt; nginx-save.tar<span class="hljs-attribute">or</span><span class="hljs-attribute">docker</span> save -o nginx-save.tar ae<span class="hljs-number">513</span>a<span class="hljs-number">47849</span>c</code></pre></div><ul><li>é•œåƒçš„å¯¼å…¥</li></ul><div class="code-wrapper"><pre><code class="hljs maxima">docker <span class="hljs-built_in">load</span> &lt; nginx-<span class="hljs-built_in">save</span>.tar<span class="hljs-keyword">or</span>docker <span class="hljs-built_in">load</span> -i nginx-<span class="hljs-built_in">save</span>.tar</code></pre></div><ul><li>å®¹å™¨çš„å¯¼å‡º</li></ul><div class="code-wrapper"><pre><code class="hljs autohotkey">docker export -o mysql-`date +<span class="hljs-variable">%Y%</span>m%d`.tar <span class="hljs-number">220</span>aee82cfea</code></pre></div><ul><li>å®¹å™¨çš„å¯¼å…¥</li></ul><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> import  my_ubuntu_v<span class="hljs-number">3</span>.tar runoob/ubuntu:v<span class="hljs-number">4</span></code></pre></div><p>é•œåƒå’Œå®¹å™¨å¯¼å‡ºå’Œå¯¼å…¥çš„åŒºåˆ«:</p><p>1.é•œåƒå¯¼å…¥æ˜¯å¤åˆ¶çš„è¿‡ç¨‹<br>2.å®¹å™¨å¯¼å…¥æ˜¯å°†å½“å‰å®¹å™¨å˜æˆä¸€ä¸ªæ–°çš„é•œåƒ</p><p>save å’Œ exportåŒºåˆ«ï¼š</p><ol><li>save ä¿å­˜é•œåƒæ‰€æœ‰çš„ä¿¡æ¯-åŒ…å«å†å²</li><li>export åªå¯¼å‡ºå½“å‰çš„ä¿¡æ¯</li></ol>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sync.Map</title>
    <link href="/2021/02/06/syncMap/"/>
    <url>/2021/02/06/syncMap/</url>
    
    <content type="html"><![CDATA[<p>sync.Map æ˜¯1.9ç‰ˆæœ¬æ‰åŠ å…¥çš„ï¼Œæ˜¯çº¿ç¨‹å¹¶å‘å®‰å…¨çš„mapï¼Œç±»å‹å¯ä»¥çœ‹åšmap[interface{}]interface{}ã€‚</p><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Map <span class="hljs-keyword">struct</span> &#123;    mu Mutex    <span class="hljs-comment">//äº’æ–¥é”ï¼Œç”¨äºé”å®šdirty map</span>    read atomic.Value <span class="hljs-comment">//ä¼˜å…ˆè¯»map,æ”¯æŒåŸå­æ“ä½œï¼Œæºç æ³¨é‡Šå†™äº†readOnlyä¸æ˜¯è¯´readæ˜¯åªè¯»ï¼Œè€Œæ˜¯å®ƒçš„ç»“æ„ä½“æ˜¯readOnly</span>    dirty <span class="hljs-keyword">map</span>[<span class="hljs-keyword">interface</span>&#123;&#125;]*entry <span class="hljs-comment">// dirtyæ˜¯ä¸€ä¸ªå½“å‰æœ€æ–°çš„mapï¼Œå…è®¸è¯»å†™</span>    misses <span class="hljs-keyword">int</span> <span class="hljs-comment">// ä¸»è¦è®°å½•readè¯»å–ä¸åˆ°æ•°æ®åŠ é”è¯»å–read mapä»¥åŠdirty mapçš„æ¬¡æ•°ï¼Œå½“missesç­‰äºdirtyçš„é•¿åº¦æ—¶ï¼Œä¼šå°†dirtyå¤åˆ¶åˆ°read</span>&#125;</code></pre></div><p>readOnly</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> readOnly <span class="hljs-keyword">struct</span> &#123;    m       <span class="hljs-keyword">map</span>[<span class="hljs-keyword">interface</span>&#123;&#125;]*entry    amended <span class="hljs-keyword">bool</span> <span class="hljs-comment">// å¦‚æœæ•°æ®åœ¨dirtyä¸­ä½†æ²¡æœ‰åœ¨readä¸­ï¼Œè¯¥å€¼ä¸ºtrue,ä½œä¸ºä¿®æ”¹æ ‡è¯†</span>&#125;</code></pre></div><h4 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h4><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> entry <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// nil: è¡¨ç¤ºä¸ºè¢«åˆ é™¤ï¼Œè°ƒç”¨Delete()å¯ä»¥å°†read mapä¸­çš„å…ƒç´ ç½®ä¸ºnil</span>    <span class="hljs-comment">// expunged: ä¹Ÿæ˜¯è¡¨ç¤ºè¢«åˆ é™¤ï¼Œä½†æ˜¯è¯¥é”®åªåœ¨readè€Œæ²¡æœ‰åœ¨dirtyä¸­ï¼Œè¿™ç§æƒ…å†µå‡ºç°åœ¨å°†readå¤åˆ¶åˆ°dirtyä¸­ï¼Œå³å¤åˆ¶çš„è¿‡ç¨‹ä¼šå…ˆå°†nilæ ‡è®°ä¸ºexpungedï¼Œç„¶åä¸å°†å…¶å¤åˆ¶åˆ°dirty</span>    <span class="hljs-comment">// å…¶ä»–: è¡¨ç¤ºå­˜ç€çœŸæ­£çš„æ•°æ®</span>    p unsafe.Pointer <span class="hljs-comment">// *interface&#123;&#125;</span>&#125;</code></pre></div><h3 id="Load-æŸ¥æ‰¾"><a href="#Load-æŸ¥æ‰¾" class="headerlink" title="Load æŸ¥æ‰¾"></a>Load æŸ¥æ‰¾</h3><p>æ ¹æ®keyæ¥æŸ¥æ‰¾ valueï¼Œ å‡½æ•°ä¸º Load()ï¼Œæºç å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span> <span class="hljs-title">Load</span><span class="hljs-params">(key <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-params">(value <span class="hljs-keyword">interface</span>&#123;&#125;, ok <span class="hljs-keyword">bool</span>)</span></span> &#123;    <span class="hljs-comment">// é¦–å…ˆä»åªè¯»readyçš„mapä¸­æŸ¥æ‰¾ï¼Œè¿™æ—¶ä¸éœ€è¦åŠ é”</span>    read, _ := m.read.Load().(readOnly)    e, ok := read.m[key]        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå¹¶ä¸”read.amendedä¸ºtrueï¼Œè¯´æ˜dirtyä¸­æœ‰æ–°æ•°æ®ï¼Œä»dirtyä¸­æŸ¥æ‰¾ï¼Œå¼€å§‹åŠ é”äº†</span>    <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amended &#123;        m.mu.Lock() <span class="hljs-comment">// åŠ é”</span>               <span class="hljs-comment">// åˆåœ¨ readonly ä¸­æ£€æŸ¥ä¸€éï¼Œå› ä¸ºåœ¨åŠ é”çš„æ—¶å€™ dirty çš„æ•°æ®å¯èƒ½å·²ç»è¿ç§»åˆ°äº†readä¸­</span>        read, _ = m.read.Load().(readOnly)        e, ok = read.m[key]                <span class="hljs-comment">// read è¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå¹¶ä¸”dirtyä¸­æœ‰æ•°æ®</span>        <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amended &#123;            e, ok = m.dirty[key] <span class="hljs-comment">//ä» dirty ä¸­æŸ¥æ‰¾æ•°æ®</span>                        <span class="hljs-comment">// ä¸ç®¡m.dirtyä¸­å­˜ä¸å­˜åœ¨ï¼Œéƒ½å°†misses + 1</span>            <span class="hljs-comment">// missLocked() ä¸­æ»¡è¶³æ¡ä»¶åå°±ä¼šæŠŠm.dirtyä¸­æ•°æ®è¿ç§»åˆ°m.readä¸­</span>            m.missLocked()        &#125;        m.mu.Unlock()    &#125;    <span class="hljs-keyword">if</span> !ok &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>    &#125;    <span class="hljs-keyword">return</span> e.load()&#125;</code></pre></div><p>ä»å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæŸ¥è¯¢çš„é”®å€¼æ­£å¥½åœ¨m.readä¸­ï¼Œä¸éœ€è¦åŠ é”ï¼Œç›´æ¥è¿”å›ç»“æœï¼Œä¼˜åŒ–äº†æ€§èƒ½ã€‚</p><p>å³ä½¿ä¸åœ¨readä¸­ï¼Œç»è¿‡å‡ æ¬¡missåï¼Œ m.dirtyä¸­çš„æ•°æ®ä¹Ÿä¼šè¿ç§»åˆ°m.readä¸­ï¼Œè¿™æ—¶åˆå¯ä»¥ä»readä¸­æŸ¥æ‰¾ã€‚æ‰€ä»¥å¯¹äºæ›´æ–°ï¼å¢åŠ è¾ƒå°‘ï¼ŒåŠ è½½å­˜åœ¨çš„keyå¾ˆå¤šçš„caseï¼Œæ€§èƒ½åŸºæœ¬å’Œæ— é”çš„mapç±»ä¼¼ã€‚</p><h3 id="missLockerd-è¿ç§»æ•°æ®"><a href="#missLockerd-è¿ç§»æ•°æ®" class="headerlink" title="missLockerd è¿ç§»æ•°æ®"></a>missLockerd è¿ç§»æ•°æ®</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span> <span class="hljs-title">missLocked</span><span class="hljs-params">()</span></span> &#123;    m.misses++    <span class="hljs-keyword">if</span> m.misses &lt; <span class="hljs-built_in">len</span>(m.dirty) &#123;<span class="hljs-comment">//missesæ¬¡æ•°å°äº dirtyçš„é•¿åº¦ï¼Œå°±ä¸è¿ç§»æ•°æ®ï¼Œç›´æ¥è¿”å›</span>        <span class="hljs-keyword">return</span>    &#125;    m.read.Store(readOnly&#123;m: m.dirty&#125;) <span class="hljs-comment">//å¼€å§‹è¿ç§»æ•°æ®</span>    m.dirty = <span class="hljs-literal">nil</span>   <span class="hljs-comment">//è¿ç§»å®Œdirtyå°±èµ‹å€¼ä¸ºnil</span>    m.misses = <span class="hljs-number">0</span>  <span class="hljs-comment">//è¿ç§»å®Œ misseså½’0</span>&#125;</code></pre></div><h3 id="Store-å­˜å‚¨"><a href="#Store-å­˜å‚¨" class="headerlink" title="Store å­˜å‚¨"></a>Store å­˜å‚¨</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span> <span class="hljs-title">Store</span><span class="hljs-params">(key, value <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;   <span class="hljs-comment">// ç›´æ¥åœ¨readä¸­æŸ¥æ‰¾å€¼ï¼Œæ‰¾åˆ°äº†ï¼Œå°±å°è¯• tryStore() æ›´æ–°å€¼</span>    read, _ := m.read.Load().(readOnly)    <span class="hljs-keyword">if</span> e, ok := read.m[key]; ok &amp;&amp; e.tryStore(&amp;value) &#123;        <span class="hljs-keyword">return</span>    &#125;        <span class="hljs-comment">// m.read ä¸­ä¸å­˜åœ¨</span>    m.mu.Lock()    read, _ = m.read.Load().(readOnly)    <span class="hljs-keyword">if</span> e, ok := read.m[key]; ok &#123;        <span class="hljs-keyword">if</span> e.unexpungeLocked() &#123; <span class="hljs-comment">// æœªè¢«æ ‡è®°æˆåˆ é™¤ï¼Œå‰é¢è®²åˆ°entryæ•°æ®ç»“æ„æ—¶ï¼Œé‡Œé¢çš„på€¼æœ‰3ç§ã€‚1.nil 2.expungedï¼Œè¿™ä¸ªå€¼å«ä¹‰æœ‰ç‚¹å¤æ‚ï¼Œå¯ä»¥çœ‹çœ‹å‰é¢entryæ•°æ®ç»“æ„ 3.æ­£å¸¸å€¼</span>                        m.dirty[key] = e <span class="hljs-comment">// åŠ å…¥åˆ°dirtyé‡Œ</span>        &#125;        e.storeLocked(&amp;value) <span class="hljs-comment">// æ›´æ–°å€¼</span>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> e, ok := m.dirty[key]; ok &#123; <span class="hljs-comment">// å­˜åœ¨äº dirty ä¸­ï¼Œç›´æ¥æ›´æ–°</span>        e.storeLocked(&amp;value)    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// æ–°çš„å€¼</span>        <span class="hljs-keyword">if</span> !read.amended &#123; <span class="hljs-comment">// m.dirty ä¸­æ²¡æœ‰æ–°æ•°æ®ï¼Œå¢åŠ åˆ° m.dirty ä¸­</span>            m.dirtyLocked() <span class="hljs-comment">// ä» m.readä¸­å¤åˆ¶æœªåˆ é™¤çš„æ•°æ®</span>            m.read.Store(readOnly&#123;m: read.m, amended: <span class="hljs-literal">true</span>&#125;)         &#125;        m.dirty[key] = newEntry(value) <span class="hljs-comment">//å°†è¿™ä¸ªentryåŠ å…¥åˆ°m.dirtyä¸­</span>    &#125;    m.mu.Unlock()&#125;</code></pre></div><p>æ“ä½œéƒ½æ˜¯å…ˆä»m.readå¼€å§‹ï¼Œä¸æ»¡è¶³æ¡ä»¶å†åŠ é”ï¼Œç„¶åæ“ä½œm.dirtyã€‚</p><h3 id="Delete-åˆ é™¤"><a href="#Delete-åˆ é™¤" class="headerlink" title="Delete åˆ é™¤"></a>Delete åˆ é™¤</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span> <span class="hljs-title">Delete</span><span class="hljs-params">(key <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;    <span class="hljs-comment">// ä» m.read ä¸­å¼€å§‹æŸ¥æ‰¾</span>    read, _ := m.read.Load().(readOnly)    e, ok := read.m[key]        <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amended &#123; <span class="hljs-comment">// m.readä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œå¹¶ä¸”å¯èƒ½å­˜åœ¨äºm.dirtyä¸­ï¼ŒåŠ é”æŸ¥æ‰¾</span>        m.mu.Lock() <span class="hljs-comment">// åŠ é”</span>        read, _ = m.read.Load().(readOnly) <span class="hljs-comment">// å†åœ¨m.readä¸­æŸ¥æ‰¾ä¸€æ¬¡</span>        e, ok = read.m[key]        <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amended &#123; <span class="hljs-comment">//m.readä¸­åˆæ²¡æ‰¾åˆ°ï¼Œamendedæ ‡å¿—ä½trueï¼Œè¯´æ˜åœ¨m.dirtyä¸­</span>            <span class="hljs-built_in">delete</span>(m.dirty, key) <span class="hljs-comment">// åˆ é™¤</span>        &#125;        m.mu.Unlock()    &#125;    <span class="hljs-keyword">if</span> ok &#123; <span class="hljs-comment">// åœ¨ m.ready ä¸­å°±ç›´æ¥åˆ é™¤</span>        e.<span class="hljs-built_in">delete</span>()    &#125;&#125;</code></pre></div><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;sync&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> sm sync.Mapsm.Store(<span class="hljs-string">&quot;www&quot;</span>, <span class="hljs-string">&quot;2343125&quot;</span>)sm.Store(<span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-number">111</span>)<span class="hljs-keyword">var</span> v <span class="hljs-keyword">interface</span>&#123;&#125;v, _ = sm.Load(<span class="hljs-string">&quot;www&quot;</span>)fmt.Printf(<span class="hljs-string">&quot;%T&quot;</span>, v)sm.Delete(<span class="hljs-string">&quot;test&quot;</span>)v, _ = sm.Load(<span class="hljs-string">&quot;test&quot;</span>)fmt.Printf(<span class="hljs-string">&quot;%T&quot;</span>, v)&#125;<span class="hljs-comment">// string&lt;nil&gt;</span></code></pre></div><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://github.com/golang/go/blob/dev.boringcrypto.go1.15/src/sync/map.go">sync.Mapæºç </a></li><li><a href="https://developer.aliyun.com/article/741441">sync.Mapæºç åˆ†æ</a></li><li><a href="https://www.cnblogs.com/jiujuan/p/13365901.html">æ·±å…¥ç†è§£Goè¯­è¨€(05)ï¼šsync.mapåŸç†åˆ†æ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>gosourcecode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gosourcecode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sync.Once</title>
    <link href="/2021/02/06/syncOnce/"/>
    <url>/2021/02/06/syncOnce/</url>
    
    <content type="html"><![CDATA[<p>sync.Onceçš„æºç ååˆ†ç®€å•ï¼Œè€Œä¸”æ³¨é‡Šååˆ†æ¸…æ¥šï¼Œç›´æ¥æ¥çœ‹ä¸€ä¸‹ã€‚</p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“Once</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Once <span class="hljs-keyword">struct</span> &#123;done <span class="hljs-keyword">uint32</span> <span class="hljs-comment">// æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œåˆå§‹å€¼ä¸º0</span>m    Mutex  <span class="hljs-comment">// é”</span>&#125;</code></pre></div><p>å¯¹å¤–æä¾›äº†ä¸€ä¸ªæ–¹æ³•Doï¼ŒOnce.Doå¯ä»¥ç†è§£æˆèµ„æºåˆå§‹åŒ–ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o *Once)</span> <span class="hljs-title">Do</span><span class="hljs-params">(f <span class="hljs-keyword">func</span>()</span>)</span> &#123;        <span class="hljs-comment">// è¿™é‡Œä¿è¯åŸå­æ€§çš„è¯»å–o.doneï¼Œå¦‚æœæœªæ‰§è¡Œ0ï¼Œè°ƒç”¨doSlow</span><span class="hljs-keyword">if</span> atomic.LoadUint32(&amp;o.done) == <span class="hljs-number">0</span> &#123;<span class="hljs-comment">// Outlined slow-path to allow inlining of the fast-path.</span>o.doSlow(f)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o *Once)</span> <span class="hljs-title">doSlow</span><span class="hljs-params">(f <span class="hljs-keyword">func</span>()</span>)</span> &#123;o.m.Lock()  <span class="hljs-comment">// é”ä½</span><span class="hljs-keyword">defer</span> o.m.Unlock() <span class="hljs-comment">// æœ€åé‡Šæ”¾é”</span>        <span class="hljs-comment">// å¦‚æœæœªæ‰§è¡Œè¿‡fï¼Œå°±æ‰§è¡Œfï¼Œå¹¶ä¿®æ”¹o.doneä¸º1</span>        <span class="hljs-comment">// è¿™é‡Œå·²ç»åŠ é”äº†ï¼Œä¿è¯äº†åŸå­æ€§ï¼Œä¸éœ€è¦ä½¿ç”¨atomic.LoadUint32</span><span class="hljs-keyword">if</span> o.done == <span class="hljs-number">0</span> &#123; <span class="hljs-keyword">defer</span> atomic.StoreUint32(&amp;o.done, <span class="hljs-number">1</span>)f()&#125;&#125;</code></pre></div><p>å¦‚æœä½ ç†Ÿæ‚‰atomicï¼Œè¿™é‡Œä½ å¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®ï¼ŒDoæ–¹æ³•é‡Œé¢ä¸ºä½•ä¸ç›´æ¥ä½¿ç”¨casåŸå­æ“ä½œå‘¢ï¼Œé‚£å¤šç®€æ´ï¼Ÿ</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">if</span> atomic.CompareAndSwapUint32(&amp;o.done, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>) &#123;f()&#125;</code></pre></div><p>å…¶å®æºç æ³¨é‡Šé‡Œå·²ç»æœ‰äº†è¯´æ˜ï¼Œè¿™æ ·çš„å®ç°å¹¶ä¸åˆç†ã€‚</p><p>å½“ä½ æœ‰2ä¸ªå¹¶å‘è¯·æ±‚è°ƒç”¨Doï¼Œè¿™æ ·çš„å®ç°ç¡®å®èƒ½ä¿è¯åªä¼šè°ƒç”¨ä¸€æ¬¡fã€‚ä½†æ˜¯ï¼Œå‡å¦‚fçš„æ‰§è¡Œéœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæ¯”å¦‚åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ï¼Œå½“fæ‰§è¡Œå°šæœªå®Œæˆï¼Œå¹¶å‘ä¸­å¦ä¸€ä¸ªè¯·æ±‚å› ä¸ºæ²¡æœ‰æ‰§è¡ŒåŸå­æ“ä½œç›´æ¥è¿”å›äº†ï¼Œä½¿ç”¨fä¸­åˆå§‹åŒ–çš„è¿æ¥æ± å°±å¿…ç„¶ä¼šå¤±è´¥ï¼Œé‚£ä¹ˆè¿™æ ·çš„å®ç°æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ã€‚</p><p>æ‰€ä»¥å¿…é¡»ç¡®ä¿fæ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰èƒ½å°†doneç½®ä¸º1ã€‚</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> one sync.Oncefun1 := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;fmt.Println(<span class="hljs-string">&quot;do one&quot;</span>)&#125;fun2 := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;fmt.Println(<span class="hljs-string">&quot;do two&quot;</span>)&#125;one.Do(fun1)one.Do(fun2)output:do one</code></pre></div><p>å¯ä»¥çœ‹åˆ°åªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯fun1ã€‚</p><p>å…¶å®onceå¾ˆé€‚åˆåº”ç”¨åˆ°å•ä¾‹æ¨¡å¼ï¼Œæ¯”å¦‚è¿æ¥æ•°æ®åº“ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> db<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;github.com/jinzhu/gorm&quot;</span>_ <span class="hljs-string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span><span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>)<span class="hljs-keyword">var</span> once sync.Once<span class="hljs-keyword">var</span> db *gorm.DB<span class="hljs-comment">// å•ä¾‹æ¨¡å¼è·å–*gorm.DB</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetDB</span><span class="hljs-params">()</span> *<span class="hljs-title">gorm</span>.<span class="hljs-title">DB</span></span> &#123;once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;db = openPool()&#125;)<span class="hljs-keyword">return</span> db&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">openPool</span><span class="hljs-params">()</span> *<span class="hljs-title">gorm</span>.<span class="hljs-title">DB</span></span> &#123;...&#125;</code></pre></div><p>å¥½äº†ï¼ŒOnceæ˜¯å¾ˆå¸¸ç”¨çš„ï¼Œä¹Ÿå¾ˆé€‚åˆå•ä¾‹æ¨¡å¼ä½¿ç”¨ï¼Œæºç ç®€å•æ˜äº†ï¼Œä»¥ååœ¨é¡¹ç›®ä¸­å¤šå¤šä½¿ç”¨å§ï¼</p>]]></content>
    
    
    <categories>
      
      <category>gosourcecode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gosourcecode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vueå­ç»„ä»¶</title>
    <link href="/2021/01/26/305/"/>
    <url>/2021/01/26/305/</url>
    
    <content type="html"><![CDATA[<p>å…ˆæ¥çœ‹demo:</p><p>çˆ¶ç»„ä»¶ï¼š</p><div class="code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div class=&quot;app-container calendar-list-container&quot;&gt;    &lt;el-tabs v-model=&quot;activeName&quot; type=&quot;card&quot;&gt;      &lt;el-tab-pane label=&quot;å¾…å®¡æ ¸&quot; name=&quot;first&quot;&gt;        &lt;test-page status=&quot;1&quot; @toP=&quot;funct&quot;&gt;&lt;/test-page&gt;      &lt;/el-tab-pane&gt;      &lt;el-tab-pane label=&quot;å…¨éƒ¨&quot; name=&quot;second&quot;&gt;        &lt;test-page status=&quot;0&quot;&gt;&lt;/test-page&gt;      &lt;/el-tab-pane&gt;    &lt;/el-tabs&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;import TestPage from &#x27;@/views/components/TestPage&#x27;export default &#123;  components: &#123; TestPage &#125;,  name: &quot;test&quot;,  data() &#123;    return &#123;      activeName: &#x27;first&#x27;,    &#125;;  &#125;,  methods: &#123;    funct(v) &#123;        console.warn(v)    &#125;  &#125;&#125;;&lt;/script&gt;</code></pre></div><p>å­ç»„ä»¶</p><div class="code-wrapper"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;el-table      key=&quot;tableList&quot;      v-loading=&quot;listLoading&quot;      :data=&quot;list&quot;      element-loading-text=&quot;ç»™æˆ‘ä¸€ç‚¹æ—¶é—´&quot;      border      fit      highlight-current-row      style=&quot;width: 100%&quot;    &gt;      &lt;el-table-column        align=&quot;center&quot;        label=&quot;id&quot;      &gt;        &lt;template slot-scope=&quot;scope&quot;&gt;          &lt;span&gt;&#123;&#123; scope.row.id &#125;&#125;&lt;/span&gt;        &lt;/template&gt;      &lt;/el-table-column&gt;      &lt;el-table-column        align=&quot;center&quot;        label=&quot;åœ°ç‚¹&quot;      &gt;        &lt;template slot-scope=&quot;scope&quot;&gt;          &lt;span&gt;&#123;&#123; scope.row.address &#125;&#125;&lt;/span&gt;        &lt;/template&gt;      &lt;/el-table-column&gt;      &lt;el-table-column        align=&quot;center&quot;        label=&quot;çŠ¶æ€&quot;      &gt;        &lt;template slot-scope=&quot;scope&quot;&gt;          &lt;el-tag type=&quot;info&quot; v-if=&quot;scope.row.status == 0&quot;&gt;å·²æ‹’ç»&lt;/el-tag&gt;          &lt;el-tag v-if=&quot;scope.row.status == 1&quot;&gt;å®¡æ ¸ä¸­&lt;/el-tag&gt;          &lt;el-tag type=&quot;success&quot; v-if=&quot;scope.row.status == 2&quot;&gt;å·²é€šè¿‡&lt;/el-tag&gt;        &lt;/template&gt;      &lt;/el-table-column&gt;      &lt;el-table-column        align=&quot;center&quot;        label=&quot;æ´»åŠ¨æ—¶é—´&quot;      &gt;        &lt;template slot-scope=&quot;scope&quot;&gt;          &lt;span&gt;&#123;&#123; scope.row.start_date &#125;&#125;&lt;/span&gt;&lt;br&gt;è‡³          &lt;span&gt;&#123;&#123; scope.row.end_date &#125;&#125;&lt;/span&gt;        &lt;/template&gt;      &lt;/el-table-column&gt;    &lt;/el-table&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;...export default &#123;  name: &quot;TestPage&quot;,  props: [&#x27;status&#x27;],  data() &#123;    return &#123;      list: [],      pagination: &quot;&quot;,      listQuery: &#123;        page: 1,        limit: 20,        status: 1,        type:&#x27;&#x27;,      &#125;,      typeList: [],      dialogFormVisible: false,      temp: &#123;          image : &#x27;&#x27;,          user: &#123;            nickname: &#x27;&#x27;,          &#125;,          college: &#123;            name: &quot;&quot;,          &#125;,          materials: [],      &#125;,    &#125;;  &#125;,  created() &#123;    this.listQuery.status = this.$props.status;    this.getList();    this.$emit(&#x27;toP&#x27;, this.listQuery)  &#125;,  methods: &#123;    ...  &#125;&#125;;&lt;/script&gt;&lt;style&gt;.row-container .el-row &#123;    margin-bottom: 20px;    &amp;:last-child &#123;      margin-bottom: 0;    &#125;  &#125;&lt;/style&gt;</code></pre></div><p>è¿™ä¸ªdemoç®€å•ä½¿ç”¨äº†ç»„ä»¶å¼•å…¥ï¼ŒåŠå­ç»„ä»¶äºçˆ¶ç»„ä»¶é€šä¿¡ã€‚</p><h2 id="å¼•å…¥å­ç»„ä»¶"><a href="#å¼•å…¥å­ç»„ä»¶" class="headerlink" title="å¼•å…¥å­ç»„ä»¶"></a>å¼•å…¥å­ç»„ä»¶</h2><div class="code-wrapper"><pre><code class="hljs vue">import TestPage from &#x27;@/views/components/TestPage&#x27;export default &#123;  components: &#123; TestPage &#125;,</code></pre></div><p>ä½¿ç”¨:</p><div class="code-wrapper"><pre><code class="hljs vue">&lt;test-page&gt;&lt;/test-page&gt;</code></pre></div><h2 id="çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®åˆ°å­ç»„ä»¶"><a href="#çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®åˆ°å­ç»„ä»¶" class="headerlink" title="çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®åˆ°å­ç»„ä»¶"></a>çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®åˆ°å­ç»„ä»¶</h2><p>çˆ¶ç»„ä»¶çš„statuså°±æ˜¯ä¼ é€’çš„æ•°æ®</p><div class="code-wrapper"><pre><code class="hljs vue">&lt;test-page status=&quot;0&quot;&gt;&lt;/test-page&gt;</code></pre></div><p>å­ç»„ä»¶æ¥æ”¶ï¼š</p><div class="code-wrapper"><pre><code class="hljs vue">this.$props.status</code></pre></div><h2 id="å­ç»„ä»¶ä¼ é€’æ•°æ®åˆ°çˆ¶ç»„ä»¶"><a href="#å­ç»„ä»¶ä¼ é€’æ•°æ®åˆ°çˆ¶ç»„ä»¶" class="headerlink" title="å­ç»„ä»¶ä¼ é€’æ•°æ®åˆ°çˆ¶ç»„ä»¶"></a>å­ç»„ä»¶ä¼ é€’æ•°æ®åˆ°çˆ¶ç»„ä»¶</h2><p>å­ç»„ä»¶ï¼Œå…¶å®æ˜¯ä¼ é€’äº†ä¸€ä¸ªtoPäº‹ä»¶</p><div class="code-wrapper"><pre><code class="hljs vue">this.$emit(&#x27;toP&#x27;, this.listQuery)</code></pre></div><p>çˆ¶ç»„ä»¶</p><div class="code-wrapper"><pre><code class="hljs vue">&lt;test-page @toP=&quot;funct&quot;&gt;&lt;/test-page&gt;...methods: &#123;    funct(v) &#123;        console.warn(v)    &#125;&#125;</code></pre></div><p>è¿™é‡Œéœ€è¦ç¨å¾®æ³¨æ„çš„å°±æ˜¯é©¼å³°å‘½åè½¬**-**ï¼Œä½¿ç”¨ç›¸å¯¹ç®€å•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç«™ä¸èƒ½è®¿é—®çš„é—®é¢˜é›†åˆ</title>
    <link href="/2021/01/13/302/"/>
    <url>/2021/01/13/302/</url>
    
    <content type="html"><![CDATA[<h2 id="httpsè®¿é—®ä¸äº†"><a href="#httpsè®¿é—®ä¸äº†" class="headerlink" title="httpsè®¿é—®ä¸äº†"></a>httpsè®¿é—®ä¸äº†</h2><h4 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><p>httpsè®¿é—®ä¸äº†ï¼Œç»‘å®šhostå¯è®¿é—®ï¼Œç½‘ç«™æ— æŠ¥é”™</p><h4 id="æ’æŸ¥"><a href="#æ’æŸ¥" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h4><p>pingåŸŸåå¯¹äºipä¹Ÿæ­£å¸¸ï¼Œtelnet 443ç«¯å£å¤±è´¥</p><h4 id="å¤„ç†"><a href="#å¤„ç†" class="headerlink" title="å¤„ç†"></a>å¤„ç†</h4><p>å¼€å¯443ç«¯å£</p><hr><h2 id="åŠ äº†CDNçš„éƒ¨åˆ†é¡µé¢çªç„¶æ‰“ä¸å¼€"><a href="#åŠ äº†CDNçš„éƒ¨åˆ†é¡µé¢çªç„¶æ‰“ä¸å¼€" class="headerlink" title="åŠ äº†CDNçš„éƒ¨åˆ†é¡µé¢çªç„¶æ‰“ä¸å¼€"></a>åŠ äº†CDNçš„éƒ¨åˆ†é¡µé¢çªç„¶æ‰“ä¸å¼€</h2><h4 id="ç°è±¡-1"><a href="#ç°è±¡-1" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><p>åŠ äº†cdnçš„éƒ¨åˆ†é¡µé¢æ‰“ä¸å¼€ï¼Œhttpé¡µé¢è®¿é—®æ­£å¸¸ï¼Œç»‘å®šhostè®¿é—®ä¹Ÿæ­£å¸¸</p><p>æ‰“ä¸å¼€çš„æƒ…å†µnginxæœ‰æŠ¥é”™å¦‚ï¼š pwritev() â€œ/usr/local/webserver/nginx_new/fastcgi_temp/1/96/0001214961â€ failed (28: No space left on device) while reading upstream, client: 61.241.120.188, server:<a href="http://www.13sai.com/">www.13sai.com</a>, request: â€œGET / HTTP/1.1â€, upstream: â€œfastcgi://127.0.0.1:9000â€, host: â€œ<a href="http://www.13sai.com&quot;,ååˆåé¦ˆåå°æ–‡ä»¶ä¸Šä¼ å¤±è´¥/">www.13sai.com&quot;ï¼Œååˆåé¦ˆåå°æ–‡ä»¶ä¸Šä¼ å¤±è´¥</a></p><h4 id="æ’æŸ¥-1"><a href="#æ’æŸ¥-1" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h4><p>å»æ‰cdnèƒ½æ­£å¸¸è®¿é—®ï¼ŒæŒ‚è½½ç£ç›˜æœªæ»¡ï¼Œç³»ç»Ÿç›˜æ»¡ï¼Œä¹ä¸€çœ‹æ˜¯cdnå’Œwafé—®é¢˜</p><h4 id="å¤„ç†-1"><a href="#å¤„ç†-1" class="headerlink" title="å¤„ç†"></a>å¤„ç†</h4><p>ç³»ç»Ÿç›˜100%ï¼Œæ³¨æ„No space left on deviceï¼ŒæŒªåŠ¨å¤§æ–‡ä»¶åˆ°æŒ‚è½½çš„ç£ç›˜ï¼Œcdné¡µé¢ä¹Ÿæ¢å¤æ­£å¸¸</p><h4 id="å»ºè®®"><a href="#å»ºè®®" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h4><p>ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œä¸‹è½½å¤§æ–‡ä»¶å°½é‡åˆ«æ”¾åœ¨ç³»ç»Ÿç›˜</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goæºç ä¹‹context</title>
    <link href="/2021/01/06/context/"/>
    <url>/2021/01/06/context/</url>
    
    <content type="html"><![CDATA[<h3 id="å®šä¹‰è¯´æ˜"><a href="#å®šä¹‰è¯´æ˜" class="headerlink" title="å®šä¹‰è¯´æ˜"></a>å®šä¹‰è¯´æ˜</h3><blockquote><p>Package context defines the Context type, which carries deadlines, cancelation signals, and other request-scoped values across API boundaries and between processes.<br>Incoming requests to a server should create a Context, and outgoing calls to servers should accept a Context. The chain of function calls between them must propagate the Context, optionally replacing it with a derived Context created using WithCancel, WithDeadline, WithTimeout, or WithValue. When a Context is canceled, all Contexts derived from it are also canceled.</p></blockquote><p>ç²—ç•¥ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼š</p><p>contextå®šä¹‰äº†ä¸Šä¸‹æ–‡ç±»å‹ï¼Œå®ƒæºå¸¦è·¨è¶ŠAPIè¾¹ç•Œå’Œè¿›ç¨‹ä¹‹é—´çš„deadlinesã€å–æ¶ˆä¿¡å·å’Œå…¶ä»–è¯·æ±‚èŒƒå›´çš„å€¼ã€‚å¯¹æœåŠ¡å™¨çš„ä¼ å…¥è¯·æ±‚åº”è¯¥åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œå¯¹æœåŠ¡å™¨çš„ä¼ å‡ºè°ƒç”¨åº”è¯¥æ¥å—ä¸Šä¸‹æ–‡ã€‚å®ƒä»¬ä¹‹é—´çš„å‡½æ•°è°ƒç”¨é“¾å¿…é¡»ä¼ æ’­ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥é€‰æ‹©ç”¨ä½¿ç”¨WithCancelã€WithDeadlineã€WithTimeoutæˆ–WithValueåˆ›å»ºçš„æ´¾ç”Ÿä¸Šä¸‹æ–‡æ›¿æ¢å®ƒã€‚å½“ä¸€ä¸ªä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶ï¼Œæ‰€æœ‰ä»å®ƒæ´¾ç”Ÿçš„ä¸Šä¸‹æ–‡ä¹Ÿè¢«å–æ¶ˆã€‚</p><h3 id="æºç ç»“æ„"><a href="#æºç ç»“æ„" class="headerlink" title="æºç ç»“æ„"></a>æºç ç»“æ„</h3><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Context</td><td>interface</td><td>å®šä¹‰äº† Context æ¥å£çš„å››ä¸ªæ–¹æ³•Deadlineã€Doneã€Errã€Value</td></tr><tr><td>emptyCtx</td><td>int</td><td>æ³¨æ„ï¼šemptyCtxæ°¸è¿œä¸ä¼šå–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ç±»å‹ç­‰ä»·å®šä¹‰ï¼ŒemptyCtxç­‰ä»·äºintç±»å‹ã€‚å¹¶ä¸”å®šä¹‰ä¸Šé¢çš„å››ä¸ªæ–¹æ³•å’ŒStringæ–¹æ³•ã€‚</td></tr><tr><td>Background</td><td>func</td><td>è¿”å›new(emptyCtx)</td></tr><tr><td>TODO</td><td>func</td><td>è¿”å›new(emptyCtx)</td></tr><tr><td>CancelFunc</td><td>func</td><td>CancelFuncå‘Šè¯‰æ“ä½œæ”¾å¼ƒå…¶å·¥ä½œï¼Œä¸ç­‰å¾…å·¥ä½œåœæ­¢ã€‚å¤šä¸ªgoroutineå¯ä»¥åŒæ—¶è°ƒç”¨CancelFuncã€‚åœ¨ç¬¬ä¸€ä¸ªè°ƒç”¨ä¹‹åï¼Œå¯¹CancelFuncçš„åç»­è°ƒç”¨å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</td></tr><tr><td>WithCancel</td><td>func</td><td>WithCancelè¿”å›ä¸€ä¸ªå¸¦æœ‰æ–°çš„Doneé€šé“çš„parentå‰¯æœ¬ã€‚å½“è¿”å›çš„cancelå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¸Šä¸‹æ–‡çš„Doneé€šé“è¢«å…³é—­æˆ–è€…å½“çˆ¶ä¸Šä¸‹æ–‡çš„Doneé€šé“å…³é—­æ—¶ï¼Œæ— è®ºå“ªä¸ªå…ˆå‘ç”Ÿã€‚å–æ¶ˆæ­¤ä¸Šä¸‹æ–‡å°†é‡Šæ”¾ä¸ä¹‹ç›¸å…³çš„èµ„æºï¼Œä»£ç ä¹Ÿåº”è¯¥å¦‚æ­¤åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„æ“ä½œä¸€å®Œæˆï¼Œå°±è°ƒç”¨cancelã€‚</td></tr><tr><td>newCancelCtx</td><td>func</td><td>è¿”å›ä¸€ä¸ªåˆå§‹åŒ–çš„cancelCtx</td></tr><tr><td>propagateCancel</td><td>func</td><td>propagateCancelåœ¨çˆ¶å…ƒç´ è¢«å–æ¶ˆæ—¶å–æ¶ˆå­å…ƒç´ ï¼Œè¿™é‡Œæœ‰ç”¨åˆ°åŸå­é”</td></tr><tr><td>parentCancelCtx</td><td>func</td><td>æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯å–æ¶ˆçš„çˆ¶èŠ‚ç‚¹</td></tr><tr><td>removeChild</td><td>func</td><td>ç§»é™¤çˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td></tr><tr><td>canceler</td><td>interface</td><td>å–æ¶ˆè€…ï¼Œå®šä¹‰äº†cancelå’ŒDoneä¸¤ä¸ªæ–¹æ³•</td></tr><tr><td>init</td><td>func</td><td>åˆå§‹åŒ–æ–¹æ³•</td></tr><tr><td>cancelCtx</td><td>struct</td><td>ä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„ Context</td></tr><tr><td>contextName</td><td>func</td><td>è¿”å›ä¸Šä¸‹æ–‡åç§°</td></tr><tr><td>WithDeadline</td><td>func</td><td>åˆ›å»ºä¸€ä¸ªæœ‰ deadline çš„ context</td></tr><tr><td>timerCtx</td><td>struct</td><td>timerCtxå¸¦æœ‰timeout å’Œdeadline ã€‚å®ƒå°†cancelCtxåµŒå…¥åˆ°å®ç°Doneå’ŒErrã€‚å®ƒé€šè¿‡åœæ­¢è®¡æ—¶å™¨æ¥å®ç°å–æ¶ˆï¼Œç„¶åå§”æ‰˜ç»™cancelCtx.cancelã€‚</td></tr><tr><td>WithTimeout</td><td>func</td><td>åˆ›å»ºä¸€ä¸ªæœ‰ timeout çš„ context</td></tr><tr><td>WithValue</td><td>func</td><td>åˆ›å»ºä¸€ä¸ªå­˜å‚¨ k-v å¯¹çš„ context</td></tr><tr><td>valueCtx</td><td>struct</td><td>å­˜å‚¨k-vï¼Œé…åˆWithValueä½¿ç”¨</td></tr><tr><td>stringify</td><td>func</td><td>æ¥å£ç±»å‹è¿”å›å­—ç¬¦ä¸²</td></tr></tbody></table><h4 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h4><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">interface</span> &#123;<span class="hljs-comment">// è·å–è®¾ç½®çš„æˆªæ­¢æ—¶é—´çš„æ„æ€ï¼Œç¬¬ä¸€ä¸ªè¿”å›å¼æ˜¯æˆªæ­¢æ—¶é—´ï¼Œåˆ°äº†è¿™ä¸ªæ—¶é—´ç‚¹ï¼ŒContextä¼šè‡ªåŠ¨å‘èµ·å–æ¶ˆè¯·æ±‚ï¼›ç¬¬äºŒä¸ªè¿”å›å€¼ok==falseæ—¶è¡¨ç¤ºæ²¡æœ‰è®¾ç½®æˆªæ­¢æ—¶é—´ï¼Œå¦‚æœéœ€è¦å–æ¶ˆçš„è¯ï¼Œéœ€è¦è°ƒç”¨å–æ¶ˆå‡½æ•°è¿›è¡Œå–æ¶ˆ</span>Deadline() (deadline time.Time, ok <span class="hljs-keyword">bool</span>)<span class="hljs-comment">// è¿”å›ä¸€ä¸ªåªè¯»çš„chanï¼Œç±»å‹ä¸ºstruct&#123;&#125;ï¼Œæˆ‘ä»¬åœ¨goroutineä¸­ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›çš„chanå¯ä»¥è¯»å–ï¼Œåˆ™æ„å‘³ç€parent contextå·²ç»å‘èµ·äº†å–æ¶ˆè¯·æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡Doneæ–¹æ³•æ”¶åˆ°è¿™ä¸ªä¿¡å·åï¼Œå°±åº”è¯¥åšæ¸…ç†æ“ä½œï¼Œç„¶åé€€å‡ºgoroutineï¼Œé‡Šæ”¾èµ„æºã€‚</span>Done() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// åœ¨ channel Done å…³é—­åï¼Œè¿”å› context å–æ¶ˆåŸå› </span>Err() error<span class="hljs-comment">// è·å–è¯¥Contextä¸Šç»‘å®šçš„å€¼ï¼Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥è¦é€šè¿‡ä¸€ä¸ªKeyæ‰å¯ä»¥è·å–å¯¹åº”çš„å€¼ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬æ˜¯å¹¶å‘å®‰å…¨çš„</span>Value(key <span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-keyword">interface</span>&#123;&#125;&#125;</code></pre></div><h4 id="canceler"><a href="#canceler" class="headerlink" title="canceler"></a>canceler</h4><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> canceler <span class="hljs-keyword">interface</span> &#123;cancel(removeFromParent <span class="hljs-keyword">bool</span>, err error)Done() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;&#125;</code></pre></div><p>å®ç°äº†ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªæ–¹æ³•çš„ Contextï¼Œå°±è¡¨æ˜è¯¥ Context æ˜¯å¯å–æ¶ˆçš„ã€‚æºç ä¸­æœ‰ä¸¤ä¸ªç±»å‹å®ç°äº† canceler æ¥å£ï¼š*cancelCtx å’Œ *timerCtxã€‚æ³¨æ„æ˜¯åŠ äº† * å·çš„ï¼Œæ˜¯è¿™ä¸¤ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆå®ç°äº† canceler æ¥å£ã€‚</p><p>æ¥å£è®¾è®¡æˆè¿™ä¸ªæ ·å­çš„åŸå› ï¼š</p><ul><li>â€œå–æ¶ˆâ€æ“ä½œåº”è¯¥æ˜¯å»ºè®®æ€§ï¼Œè€Œéå¼ºåˆ¶æ€§</li><li>â€œå–æ¶ˆâ€æ“ä½œåº”è¯¥å¯ä¼ é€’</li></ul><h3 id="emptyCtx"><a href="#emptyCtx" class="headerlink" title="emptyCtx"></a>emptyCtx</h3><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">type</span> emptyCtx <span class="hljs-keyword">int</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Deadline</span><span class="hljs-params">()</span> <span class="hljs-params">(deadline time.Time, ok <span class="hljs-keyword">bool</span>)</span></span> &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Done</span><span class="hljs-params">()</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">struct</span></span>&#123;&#125; &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Err</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*emptyCtx)</span> <span class="hljs-title">Value</span><span class="hljs-params">(key <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *emptyCtx)</span> <span class="hljs-title">String</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">switch</span> e &#123;<span class="hljs-keyword">case</span> background:<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;context.Background&quot;</span><span class="hljs-keyword">case</span> todo:<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;context.TODO&quot;</span>&#125;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;unknown empty Context&quot;</span>&#125;<span class="hljs-comment">// cancelCtx</span><span class="hljs-keyword">type</span> cancelCtx <span class="hljs-keyword">struct</span> &#123;Contextmu       sync.Mutex            <span class="hljs-comment">// äº’æ–¥é”</span>done     <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;        children <span class="hljs-keyword">map</span>[canceler]<span class="hljs-keyword">struct</span>&#123;&#125; err      error &#125;</code></pre></div><p>æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹ cancel è¿™ä¸ªæ–¹æ³•</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *cancelCtx)</span> <span class="hljs-title">cancel</span><span class="hljs-params">(removeFromParent <span class="hljs-keyword">bool</span>, err error)</span></span> &#123;<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;context: internal error: missing cancel error&quot;</span>)&#125;c.mu.Lock()<span class="hljs-keyword">if</span> c.err != <span class="hljs-literal">nil</span> &#123;c.mu.Unlock()<span class="hljs-keyword">return</span> <span class="hljs-comment">// å·²ç»è¢«å…¶ä»–åç¨‹å–æ¶ˆ</span>&#125;<span class="hljs-comment">// ç»™ err å­—æ®µèµ‹å€¼</span>c.err = err<span class="hljs-comment">// å…³é—­ channelï¼Œé€šçŸ¥å…¶ä»–åç¨‹</span><span class="hljs-keyword">if</span> c.done == <span class="hljs-literal">nil</span> &#123;c.done = closedchan&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-built_in">close</span>(c.done)&#125;<span class="hljs-comment">// éå†å®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹</span><span class="hljs-keyword">for</span> child := <span class="hljs-keyword">range</span> c.children &#123;                <span class="hljs-comment">// é€’å½’åœ°å–æ¶ˆæ‰€æœ‰å­èŠ‚ç‚¹</span>child.cancel(<span class="hljs-literal">false</span>, err)&#125;<span class="hljs-comment">// å°†å­èŠ‚ç‚¹ç½®ç©º</span>c.children = <span class="hljs-literal">nil</span>c.mu.Unlock()<span class="hljs-keyword">if</span> removeFromParent &#123;        <span class="hljs-comment">// ä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤è‡ªå·± </span>removeChild(c.Context, c)&#125;&#125;</code></pre></div><p>cancel()æ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯å…³é—­ channelï¼šc.doneï¼›é€’å½’åœ°å–æ¶ˆå®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼›ä»çˆ¶èŠ‚ç‚¹ä»åˆ é™¤è‡ªå·±ã€‚è¾¾åˆ°çš„æ•ˆæœæ˜¯é€šè¿‡å…³é—­ channelï¼Œå°†å–æ¶ˆä¿¡å·ä¼ é€’ç»™äº†å®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithCancel</span><span class="hljs-params">(parent Context)</span> <span class="hljs-params">(ctx Context, cancel CancelFunc)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithDeadline</span><span class="hljs-params">(parent Context, deadline time.Time)</span> <span class="hljs-params">(Context, CancelFunc)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithTimeout</span><span class="hljs-params">(parent Context, timeout time.Duration)</span> <span class="hljs-params">(Context, CancelFunc)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithValue</span><span class="hljs-params">(parent Context, key, val <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">Context</span></span></code></pre></div><h2 id="ä¸Šé¢å››ä¸ªå¯ä»¥ç†è§£ä¸ºContextçš„ç»§æ‰¿è¡ç”Ÿã€‚"><a href="#ä¸Šé¢å››ä¸ªå¯ä»¥ç†è§£ä¸ºContextçš„ç»§æ‰¿è¡ç”Ÿã€‚" class="headerlink" title="ä¸Šé¢å››ä¸ªå¯ä»¥ç†è§£ä¸ºContextçš„ç»§æ‰¿è¡ç”Ÿã€‚"></a>ä¸Šé¢å››ä¸ªå¯ä»¥ç†è§£ä¸ºContextçš„ç»§æ‰¿è¡ç”Ÿã€‚</h2><p>å¯¹äºæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨æ¥è¯´ï¼Œå­¦ä¼šContextçš„ç»§æ‰¿çš„4ä¸ªæ–¹æ³•å’ŒBackgroundã€TODOåŸºæœ¬å°±å¤Ÿäº†ã€‚</p><h3 id="Contextä½¿ç”¨åœºæ™¯"><a href="#Contextä½¿ç”¨åœºæ™¯" class="headerlink" title="Contextä½¿ç”¨åœºæ™¯"></a>Contextä½¿ç”¨åœºæ™¯</h3><ol><li><p>è¶…æ—¶è¯·æ±‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;context&quot;</span>    <span class="hljs-string">&quot;fmt&quot;</span>    <span class="hljs-string">&quot;time&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">50</span>*time.Millisecond)    <span class="hljs-keyword">defer</span> cancel()    <span class="hljs-keyword">select</span> &#123;    <span class="hljs-keyword">case</span> &lt;-time.After(<span class="hljs-number">1</span> * time.Second):        fmt.Println(<span class="hljs-string">&quot;overslept&quot;</span>)    <span class="hljs-keyword">case</span> &lt;-ctx.Done():        fmt.Println(ctx.Err()) <span class="hljs-comment">// prints &quot;context deadline exceeded&quot;</span>    &#125;&#125;</code></pre></div></li><li><p>å…±äº«æ•°æ®</p></li></ol><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;fmt&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;ctx := context.Background()process(ctx)ctx = context.WithValue(ctx, <span class="hljs-string">&quot;traceId&quot;</span>, <span class="hljs-string">&quot;qcrao-2019&quot;</span>)process(ctx)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">process</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;traceId, ok := ctx.Value(<span class="hljs-string">&quot;traceId&quot;</span>).(<span class="hljs-keyword">string</span>)<span class="hljs-keyword">if</span> ok &#123;fmt.Printf(<span class="hljs-string">&quot;process over. trace_id=%s\n&quot;</span>, traceId)&#125; <span class="hljs-keyword">else</span> &#123;fmt.Printf(<span class="hljs-string">&quot;process over. no trace_id\n&quot;</span>)&#125;&#125;</code></pre></div><p>è¿™ä¸ªåœ¨webå¼€å‘ä¸­å¾ˆå®ç”¨ï¼Œä¼ é€’sessionã€tokenç­‰ä¿¡æ¯ã€‚</p><ol start="3"><li>é˜²æ­¢ goroutine æ³„æ¼<div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;fmt&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">gen</span><span class="hljs-params">()</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> n <span class="hljs-keyword">int</span><span class="hljs-keyword">for</span> &#123;ch &lt;- nn++time.Sleep(time.Second)&#125;&#125;()<span class="hljs-keyword">return</span> ch&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> gen() &#123;fmt.Println(n)<span class="hljs-keyword">if</span> n == <span class="hljs-number">5</span> &#123;<span class="hljs-keyword">break</span>&#125;&#125;&#125;</code></pre></div></li></ol><p>å½“ n = 5 çš„æ—¶å€™ï¼Œç›´æ¥ break ã€‚ä½†æ˜¯ gen çš„åç¨‹å°±ä¼šæ‰§è¡Œæ— é™å¾ªç¯ï¼Œæ°¸è¿œä¸ä¼šåœä¸‹æ¥ã€‚å‘ç”Ÿäº† goroutine æ³„æ¼ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;context&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">gen</span><span class="hljs-params">(ctx context.Context)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> n <span class="hljs-keyword">int</span><span class="hljs-keyword">for</span> &#123;<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;-ctx.Done():<span class="hljs-keyword">return</span><span class="hljs-keyword">case</span> ch &lt;- n:n++time.Sleep(time.Second)&#125;&#125;&#125;()<span class="hljs-keyword">return</span> ch&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;ctx, cancel := context.WithCancel(context.Background())<span class="hljs-keyword">defer</span> cancel() <span class="hljs-comment">// é¿å…å…¶ä»–åœ°æ–¹å¿˜è®° cancelï¼Œä¸”é‡å¤è°ƒç”¨ä¸å½±å“</span><span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> gen(ctx) &#123;fmt.Println(n)<span class="hljs-keyword">if</span> n == <span class="hljs-number">5</span> &#123;cancel()<span class="hljs-keyword">break</span>&#125;&#125;&#125;</code></pre></div><h3 id="Context-ä½¿ç”¨åŸåˆ™"><a href="#Context-ä½¿ç”¨åŸåˆ™" class="headerlink" title="Context ä½¿ç”¨åŸåˆ™"></a>Context ä½¿ç”¨åŸåˆ™</h3><p>æœ€åè®°ä½å‡ ä¸ªä¸»è¦çš„ä½¿ç”¨åŸåˆ™ï¼š</p><ul><li>ä¸è¦å°† Context å¡åˆ°ç»“æ„ä½“é‡Œã€‚ç›´æ¥å°† Context ç±»å‹ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€å‚æ•°ï¼Œè€Œä¸”ä¸€èˆ¬éƒ½å‘½åä¸º ctxã€‚</li><li>ä¸è¦å‘å‡½æ•°ä¼ å…¥ä¸€ä¸ª nil çš„ contextï¼Œå¦‚æœä½ å®åœ¨ä¸çŸ¥é“ä¼ ä»€ä¹ˆï¼Œæ ‡å‡†åº“ç»™ä½ å‡†å¤‡å¥½äº†ä¸€ä¸ª contextï¼štodoã€‚</li><li>ä¸è¦æŠŠæœ¬åº”è¯¥ä½œä¸ºå‡½æ•°å‚æ•°çš„ç±»å‹å¡åˆ° context ä¸­ï¼Œcontext å­˜å‚¨çš„åº”è¯¥æ˜¯ä¸€äº›å…±åŒçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼šç™»é™†çš„ sessionã€cookie ç­‰ã€‚</li><li>åŒä¸€ä¸ª context å¯èƒ½ä¼šè¢«ä¼ é€’åˆ°å¤šä¸ª goroutineï¼Œåˆ«æ‹…å¿ƒï¼Œcontext æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚</li></ul><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://www.cnblogs.com/qcrao-2018/p/11007503.html">æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹context</a></li><li><a href="https://www.flysnow.org/2017/05/12/go-in-action-go-context.html">Goè¯­è¨€å®æˆ˜ç¬”è®°ï¼ˆäºŒåï¼‰| Go Context</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>gosourcecode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gosourcecode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>x/rate/limit</title>
    <link href="/2021/01/06/rate/"/>
    <url>/2021/01/06/rate/</url>
    
    <content type="html"><![CDATA[<p>é™æµæ˜¯ä¿è¯æœåŠ¡å¯ç”¨æ€§å’Œç¨³å®šçš„åˆ©å™¨ä¹‹ä¸€ã€‚goè‡ªå¸¦æœ‰é™æµå™¨rateï¼Œæˆ‘ä»¬æ¥ç ”è¯»ä¸€ä¸‹æºç ï¼Œæºç è¾ƒå°‘ï¼Œæˆ‘ä»¬åˆ—å‡ºä¸»è¦ä»£ç éƒ¨åˆ†ï¼Œæ³¨é‡Šè¯´æ˜ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// é™å®šé€Ÿç‡</span><span class="hljs-keyword">type</span> Limit <span class="hljs-keyword">float64</span><span class="hljs-comment">// å¸¸é‡Infï¼šæ— é€Ÿç‡é™åˆ¶</span><span class="hljs-keyword">const</span> Inf = Limit(math.MaxFloat64)<span class="hljs-comment">// é™æµå™¨çš„ç»“æ„ä½“ï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œ</span><span class="hljs-keyword">type</span> Limiter <span class="hljs-keyword">struct</span> &#123;  mu     sync.Mutex  limit  Limit  burst  <span class="hljs-keyword">int</span>  tokens <span class="hljs-keyword">float64</span>  <span class="hljs-comment">// è®°å½•ä¸Šæ¬¡ Limiter è¢«æ›´æ–°çš„æ—¶é—´</span>  last time.Time  <span class="hljs-comment">// lastEvent è®°å½•é€Ÿç‡å—é™åˆ¶çš„æ—¶é—´</span>  lastEvent time.Time&#125;<span class="hljs-comment">// newä¸€ä¸ªæ–°çš„é™æµå™¨ *Limiterï¼Œræ˜¯é€Ÿç‡ï¼Œbæ˜¯å…è®¸çªå‘çš„ä»¤ç‰Œæ•°é‡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewLimiter</span><span class="hljs-params">(r Limit, b <span class="hljs-keyword">int</span>)</span> *<span class="hljs-title">Limiter</span></span> &#123;  <span class="hljs-keyword">return</span> &amp;Limiter&#123;    limit: r,    burst: b,  &#125;&#125;<span class="hljs-comment">// Reservation ä¿å­˜äº†é™æµå™¨å»¶è¿Ÿåå‘ç”Ÿçš„äº‹ä»¶ä¿¡æ¯</span><span class="hljs-keyword">type</span> Reservation <span class="hljs-keyword">struct</span> &#123;  <span class="hljs-comment">// æ˜¯å¦æ»¡è¶³æ¡ä»¶åˆ†é…äº†ä»¤ç‰Œå•Š</span>  ok        <span class="hljs-keyword">bool</span>  <span class="hljs-comment">// é™æµå™¨</span>  lim       *Limiter  <span class="hljs-comment">// ä»¤ç‰Œæ•°é‡</span>  tokens    <span class="hljs-keyword">int</span>  <span class="hljs-comment">// æ»¡è¶³ä»¤ç‰Œå‘æ”¾çš„æ—¶é—´</span>  timeToAct time.Time  <span class="hljs-comment">// ä»¤ç‰Œå‘æ”¾é€Ÿç‡</span>  limit Limit&#125;<span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å†…éƒ¨å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªReservation</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(lim *Limiter)</span> <span class="hljs-title">reserveN</span><span class="hljs-params">(now time.Time, n <span class="hljs-keyword">int</span>, maxFutureReserve time.Duration)</span> <span class="hljs-title">Reservation</span></span> &#123;  <span class="hljs-comment">// äº’æ–¥é”ï¼Œä¿è¯åŸå­æ€§</span>  lim.mu.Lock()  <span class="hljs-comment">// åˆ¤æ–­é€Ÿç‡æ˜¯ä¸æ˜¯æœ€å¤§ï¼Œæ˜¯çš„è¯æ— éœ€é™æµ</span>  <span class="hljs-keyword">if</span> lim.limit == Inf &#123;    lim.mu.Unlock()    <span class="hljs-keyword">return</span> Reservation&#123;      ok:        <span class="hljs-literal">true</span>,      lim:       lim,      tokens:    n,      timeToAct: now,    &#125;  &#125;  <span class="hljs-comment">// è°ƒç”¨ advance æ–¹æ³•ï¼Œè·å–æœ€æ–°çš„æ—¶é—´ã€ä¸Šä¸€æ¬¡å–å¾—ä»¤ç‰Œçš„æ—¶é—´ã€æœ€æ–°çš„tokenæ•°é‡</span>  now, last, tokens := lim.advance(now)  <span class="hljs-comment">// æ›´æ–°tokenæ•°é‡</span>  tokens -= <span class="hljs-keyword">float64</span>(n)  <span class="hljs-comment">// è®¡ç®—ç­‰å¾…æ—¶é—´ï¼Œæ•°é‡å°äº0è¡¨ç¤ºä»¤ç‰Œæ¡¶ä¸­æœ¨æœ‰å¯ç”¨çš„ä»¤ç‰Œäº†</span>  <span class="hljs-keyword">var</span> waitDuration time.Duration  <span class="hljs-keyword">if</span> tokens &lt; <span class="hljs-number">0</span> &#123;    waitDuration = lim.limit.durationFromTokens(-tokens)  &#125;  <span class="hljs-comment">// è®¡ç®—ç»“æœ</span>  ok := n &lt;= lim.burst &amp;&amp; waitDuration &lt;= maxFutureReserve  <span class="hljs-comment">// åˆå§‹åŒ– Reservation</span>  r := Reservation&#123;    ok:    ok,    lim:   lim,    limit: lim.limit,  &#125;    <span class="hljs-comment">// æ›´æ–°ä»¤ç‰Œæ¡¶æ•°é‡å’Œæ—¶é—´</span>  <span class="hljs-keyword">if</span> ok &#123;    r.tokens = n    r.timeToAct = now.Add(waitDuration)  &#125;  <span class="hljs-comment">// æ›´æ–°é™æµå™¨æœ€æ–°å–å¾—ä»¤ç‰Œçš„æ—¶é—´ã€æ•°é‡ã€äº‹ä»¶</span>  <span class="hljs-keyword">if</span> ok &#123;    lim.last = now    lim.tokens = tokens    lim.lastEvent = r.timeToAct  &#125; <span class="hljs-keyword">else</span> &#123;    lim.last = last  &#125;  lim.mu.Unlock()  <span class="hljs-keyword">return</span> r&#125;<span class="hljs-comment">// è®¡ç®—æ—¶é—´å˜åŒ–çš„ Limiter çš„çŠ¶æ€å˜åŒ–ï¼Œå¾—åˆ°æœ€æ–°çš„æ—¶é—´ï¼Œæœ€åä¸€æ¬¡å–å¾—ä»¤ç‰Œçš„æ—¶é—´å’Œ token ä»¤ç‰Œæ•°é‡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(lim *Limiter)</span> <span class="hljs-title">advance</span><span class="hljs-params">(now time.Time)</span> <span class="hljs-params">(newNow time.Time, newLast time.Time, newTokens <span class="hljs-keyword">float64</span>)</span></span> &#123;  last := lim.last  <span class="hljs-keyword">if</span> now.Before(last) &#123;    last = now  &#125;  maxElapsed := lim.limit.durationFromTokens(<span class="hljs-keyword">float64</span>(lim.burst) - lim.tokens)  elapsed := now.Sub(last)  <span class="hljs-keyword">if</span> elapsed &gt; maxElapsed &#123;    elapsed = maxElapsed  &#125;  delta := lim.limit.tokensFromDuration(elapsed)  tokens := lim.tokens + delta  <span class="hljs-keyword">if</span> burst := <span class="hljs-keyword">float64</span>(lim.burst); tokens &gt; burst &#123;    tokens = burst  &#125;  <span class="hljs-keyword">return</span> now, last, tokens&#125;<span class="hljs-comment">// è¿™é‡Œå•ç‹¬æ”¾å‡ºæ¥ï¼Œæ˜¯æé†’ä¸€ä¸‹ï¼Œgoä¹Ÿæœ‰ç²¾åº¦ç¼ºå¤±é—®é¢˜ï¼Œæ‰€ä»¥å¤æ‚è®¡ç®—è¦æ³¨æ„</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(limit Limit)</span> <span class="hljs-title">tokensFromDuration</span><span class="hljs-params">(d time.Duration)</span> <span class="hljs-title">float64</span></span> &#123;  sec := <span class="hljs-keyword">float64</span>(d/time.Second) * <span class="hljs-keyword">float64</span>(limit)  nsec := <span class="hljs-keyword">float64</span>(d%time.Second) * <span class="hljs-keyword">float64</span>(limit)  <span class="hljs-keyword">return</span> sec + nsec/<span class="hljs-number">1e9</span>&#125;</code></pre></div><p>ä½¿ç”¨å®ä¾‹å’Œdemoå¯çœ‹ï¼š</p><p><a href="https://github.oscome.cn/goexample/9.html">golang é™æµå™¨</a></p>]]></content>
    
    
    <categories>
      
      <category>gosourcecode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gosourcecode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBçš„ç®€å•ä½¿ç”¨è¯´æ˜</title>
    <link href="/2020/12/24/301/"/>
    <url>/2020/12/24/301/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> ä¸‹è½½ï¼Œæ³¨æ„ä¸‹è½½å¯¹åº”çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œå¦åˆ™å®‰è£…ä¼šæŠ¥é”™wget https:<span class="hljs-regexp">//</span>fastdl.mongodb.org<span class="hljs-regexp">/linux/m</span>ongodb-linux-x86_64-rhel70-<span class="hljs-number">4.4</span>.<span class="hljs-number">1</span>.tgz<span class="hljs-regexp">//</span> è§£å‹å³å¯ï¼Œæ— éœ€ç¼–è¯‘å®‰è£…tar -zxvf mongodb-linux-x86_64-rhel70-<span class="hljs-number">4.4</span>.<span class="hljs-number">1</span>.tgzmv mongodb-linux-x86_64-rhel70-<span class="hljs-number">4.4</span>.<span class="hljs-number">1</span> <span class="hljs-regexp">/usr/</span>local/mongodb</code></pre></div><h2 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h2><p>æ–°å»ºmongodb.confï¼ˆç‰ˆæœ¬å¯èƒ½ä¸ä¸€æ ·ï¼Œç•¥æœ‰ä¸åŒï¼‰</p><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">dbpath</span> = /data/mongodb/data <span class="hljs-comment">#æ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½•  </span><span class="hljs-attr">logpath</span> = /data/mongodb/log/mongodb.log <span class="hljs-comment">#æ—¥å¿—æ–‡ä»¶å­˜æ”¾ç›®å½•  </span><span class="hljs-attr">port</span> = <span class="hljs-number">27000</span>  <span class="hljs-comment">#ç«¯å£  </span><span class="hljs-attr">fork</span> = <span class="hljs-literal">true</span>  <span class="hljs-comment">#ä»¥å®ˆæŠ¤ç¨‹åºçš„æ–¹å¼å¯ç”¨ï¼Œå³åœ¨åå°è¿è¡Œ  </span><span class="hljs-attr">bind_ip</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mongodb/</span><span class="hljs-regexp">//</span> å¯åŠ¨æœåŠ¡bin<span class="hljs-regexp">/mongod -f ./m</span>ongodb.conf</code></pre></div><h2 id="æ–°å¢ç”¨æˆ·"><a href="#æ–°å¢ç”¨æˆ·" class="headerlink" title="æ–°å¢ç”¨æˆ·"></a>æ–°å¢ç”¨æˆ·</h2><p>è®¾ç½®å¯†ç </p><div class="code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">use</span> admin;<span class="hljs-keyword">db</span>.createUser(&#123;user:<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-keyword">pwd</span>:<span class="hljs-string">&quot;666888&quot;</span>,roles:[<span class="hljs-string">&quot;userAdminAnyDatabase&quot;</span>]&#125;);<span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span>;<span class="hljs-keyword">db</span>.createUser(&#123;    user: <span class="hljs-string">&quot;test&quot;</span>,    <span class="hljs-keyword">pwd</span>: <span class="hljs-string">&quot;123456&quot;</span>,    roles: [&#123;role: <span class="hljs-string">&quot;readWrite&quot;</span>,<span class="hljs-keyword">db</span>: <span class="hljs-string">&quot;hotel&quot;</span>&#125;]&#125;)<span class="hljs-keyword">db</span>.createUser(    &#123;      user: <span class="hljs-string">&quot;admin&quot;</span>,      <span class="hljs-keyword">pwd</span>: <span class="hljs-string">&quot;5176567&quot;</span>,      roles: [&#123;role: <span class="hljs-string">&quot;userAdminAnyDatabase&quot;</span>, <span class="hljs-keyword">db</span>: <span class="hljs-string">&quot;admin&quot;</span>&#125;]    &#125;)</code></pre></div><p>roleçš„è¯´æ˜</p><div class="code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">Read</span>ï¼šå…è®¸ç”¨æˆ·è¯»å–æŒ‡å®šæ•°æ®åº“readWriteï¼šå…è®¸ç”¨æˆ·è¯»å†™æŒ‡å®šæ•°æ®åº“dbAdminï¼šå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œç®¡ç†å‡½æ•°ï¼Œå¦‚ç´¢å¼•åˆ›å»ºã€åˆ é™¤ï¼ŒæŸ¥çœ‹ç»Ÿè®¡æˆ–è®¿é—®<span class="hljs-keyword">system</span>.profileuserAdminï¼šå…è®¸ç”¨æˆ·å‘<span class="hljs-keyword">system</span>.usersé›†åˆå†™å…¥ï¼Œå¯ä»¥æ‰¾æŒ‡å®šæ•°æ®åº“é‡Œåˆ›å»ºã€åˆ é™¤å’Œç®¡ç†ç”¨æˆ·clusterAdminï¼šåªåœ¨<span class="hljs-keyword">admin</span>æ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰åˆ†ç‰‡å’Œå¤åˆ¶é›†ç›¸å…³å‡½æ•°çš„ç®¡ç†æƒé™ã€‚readAnyDatabaseï¼šåªåœ¨<span class="hljs-keyword">admin</span>æ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»æƒé™readWriteAnyDatabaseï¼šåªåœ¨<span class="hljs-keyword">admin</span>æ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™userAdminAnyDatabaseï¼šåªåœ¨<span class="hljs-keyword">admin</span>æ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„userAdminæƒé™dbAdminAnyDatabaseï¼šåªåœ¨<span class="hljs-keyword">admin</span>æ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„dbAdminæƒé™ã€‚rootï¼šåªåœ¨<span class="hljs-keyword">admin</span>æ•°æ®åº“ä¸­å¯ç”¨ã€‚è¶…çº§è´¦å·ï¼Œè¶…çº§æƒé™</code></pre></div><p>å»ºè®®å‡ºrootå’Œadminï¼Œå„ä¸ªæ•°æ®åº“ä½¿ç”¨è‡ªå·±ç‹¬ç«‹çš„è´¦å·å¯†ç ã€‚</p><p>authå°è¯•ä¸€ä¸‹ï¼Œå¦‚æœè¿”å›1ï¼Œè¡¨ç¤ºauthéªŒè¯æˆåŠŸ</p><div class="code-wrapper"><pre><code class="hljs 1c">db.auth(&#x27;root&#x27;, &#x27;<span class="hljs-number">666888</span>&#x27;)</code></pre></div><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><p>å…³é—­mongoæœåŠ¡</p><div class="code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">use</span> admin<span class="hljs-keyword">db</span>.shutdownServer()</code></pre></div><p>æ¸…ç©ºå½“å‰æ•°æ®åº“</p><div class="code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">use</span> xxx<span class="hljs-keyword">db</span>.dropDatabase()</code></pre></div><h2 id="é›†æˆåˆ°Laravel"><a href="#é›†æˆåˆ°Laravel" class="headerlink" title="é›†æˆåˆ°Laravel"></a>é›†æˆåˆ°Laravel</h2><p>å®‰è£…</p><blockquote><p>composer require jenssegers/mongodb 3.6.x</p></blockquote><p>ä½ç‰ˆæœ¬éœ€è¦åœ¨config/app.phpåŠ å…¥</p><div class="code-wrapper"><pre><code class="hljs cpp">Jenssegers\Mongodb\MongodbServiceProvider::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span></code></pre></div><p>é…ç½®database.php</p><div class="code-wrapper"><pre><code class="hljs dart"><span class="hljs-string">&#x27;mongodb&#x27;</span> =&gt; [            <span class="hljs-string">&#x27;driver&#x27;</span> =&gt; <span class="hljs-string">&#x27;mongodb&#x27;</span>,            <span class="hljs-string">&#x27;host&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;MONGODB_HOST&#x27;</span>, <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>),            <span class="hljs-string">&#x27;port&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;MONGODB_PORT&#x27;</span>, <span class="hljs-number">27017</span>),            <span class="hljs-string">&#x27;database&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;MONGODB_DATABASE&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>),            <span class="hljs-string">&#x27;username&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;MONGODB_USERNAME&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>),            <span class="hljs-string">&#x27;password&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;MONGODB_PWD&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>),            <span class="hljs-string">&#x27;options&#x27;</span> =&gt; [                <span class="hljs-comment">// here you can pass more settings to the Mongo Driver Manager</span>                <span class="hljs-comment">// see https://www.php.net/manual/en/mongodb-driver-manager.construct.php under &quot;Uri Options&quot; for a list of complete parameters that you can use</span>            <span class="hljs-string">&#x27;database&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;MONGODB_AUTHENTICATION_DATABASE&#x27;</span>, <span class="hljs-string">&#x27;hotel&#x27;</span>), <span class="hljs-comment">// required with Mongo 3+</span>            ],        ],</code></pre></div><p>Modelå®šä¹‰:</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Author: 13sai</span><span class="hljs-comment"> * Date: 2020/12/22</span><span class="hljs-comment"> * Time: 15:08</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Jenssegers</span>\<span class="hljs-title">Mongodb</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Model</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$collection</span> = <span class="hljs-string">&#x27;products&#x27;</span>;    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$connection</span> = <span class="hljs-string">&#x27;mongodb&#x27;</span>;    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$guarded</span> = [<span class="hljs-string">&#x27;id&#x27;</span>];&#125;</code></pre></div><p>ä½¿ç”¨:</p><div class="code-wrapper"><pre><code class="hljs elixir"><span class="hljs-variable">$users</span> = User::distinct(<span class="hljs-string">&#x27;name&#x27;</span>)-&gt;get();<span class="hljs-variable">$users</span> = User::whereIn(<span class="hljs-string">&#x27;age&#x27;</span>, [<span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">20</span>])-&gt;get();<span class="hljs-variable">$total</span> = Product::count();<span class="hljs-variable">$price</span> = Product::avg(<span class="hljs-string">&#x27;price&#x27;</span>);</code></pre></div><p>Eloquent ORMå¸¸ç”¨çš„å‘½ä»¤å‡æ”¯æŒï¼Œç”¨èµ·æ¥æ¯«æ— è¿å’Œæ„Ÿï¼Œselectç•¥æœ‰ä¸åŒï¼Œä¼šæŠŠ_idæŸ¥è¯¢å‡ºæ¥ã€‚</p><p><a href="https://github.com/jenssegers/laravel-mongodb">æ›´å¤šå‘½ä»¤ç‚¹å‡»æŸ¥çœ‹ä»£ç ä»“åº“</a></p><p>å¤§è‡´ä¹Ÿå°±è¿™äº›äº†ï¼Œèµ¶ç´§ä½¿ç”¨èµ·æ¥å§ï¼ï¼ï¼</p>]]></content>
    
    
    <categories>
      
      <category>db</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goçš„å¹¶å‘æ¨¡å‹</title>
    <link href="/2020/11/21/283/"/>
    <url>/2020/11/21/283/</url>
    
    <content type="html"><![CDATA[<p>ä»‹ç»å¹¶å‘æ¨¡å‹ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ä¸€ä¸‹å¹¶å‘å’Œå¹¶è¡Œã€‚</p><h1 id="å¹¶å‘å’Œå¹¶è¡Œ"><a href="#å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œ"></a>å¹¶å‘å’Œå¹¶è¡Œ</h1><p>å¹¶å‘å’Œå¹¶è¡Œå¦æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨CPUå¤šæ ¸è®¡ç®—èµ„æºæå‡ºæ¥çš„æ¦‚å¿µã€‚</p><ul><li>å¹¶å‘æŒ‡çš„æ˜¯åœ¨åŒä¸€ä¸ªæ—¶é—´æ®µå†…ï¼Œå¤šæ¡æŒ‡ä»¤åœ¨CPUä¸ŠåŒæ—¶æ‰§è¡Œ</li><li>å¹¶è¡Œå€¼å¾—æ˜¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œå¤šæ¡æŒ‡ä»¤åœ¨CPUä¸ŠåŒæ—¶æ‰§è¡Œ</li></ul><p>å¹¶å‘ç¨‹åºå…¶å®å¹¶ä¸è¦æ±‚CPUå…·å¤‡å¤šæ ¸è®¡ç®—çš„èƒ½åŠ›ï¼Œåœ¨åŒä¸€æ—¶é—´æ®µå†…ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šè¢«åˆ†é…ä¸€å®šçš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼Œåœ¨CPUä¸Šè¢«å¿«é€Ÿè½®æ¢æ‰§è¡Œã€‚</p><h1 id="CSPå¹¶å‘æ¨¡å‹"><a href="#CSPå¹¶å‘æ¨¡å‹" class="headerlink" title="CSPå¹¶å‘æ¨¡å‹"></a>CSPå¹¶å‘æ¨¡å‹</h1><p>Goè¯­è¨€ä¸­å®ç°äº†ä¸¤ç§å¹¶å‘æ¨¡å‹ï¼Œä¸€ç§æ˜¯ä¾èµ–äºå…±äº«å†…å­˜å®ç°çš„çº¿ç¨‹-é”å¹¶å‘æ¨¡å‹ï¼Œå¦ä¸€ç§åˆ™æ˜¯CSPã€‚</p><p>CSPå€¡å¯¼ä½¿ç”¨é€šä¿¡æ¥å…±äº«å†…å­˜ï¼Œå®ƒæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li>å¹¶å‘å®ä½“ï¼Œé€šå¸¸å¯ä»¥ç†è§£ä¸ºæ‰§è¡Œçº¿ç¨‹ï¼Œå®ƒä»¬ç›¸äº’ç‹¬ç«‹ä¸”å¯ä»¥å¹¶å‘æ‰§è¡Œ</li><li>é€šé“ï¼Œå¹¶å‘å®ä½“ä¹‹é—´é€šè¿‡é€šé“å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œé€šä¿¡</li></ol><p>CSP ç±»ä¼¼äºæˆ‘ä»¬å¸¸ç”¨çš„åŒæ­¥é˜Ÿåˆ—ï¼Œå®ƒå…³æ³¨çš„æ¶ˆæ¯ä¼ è¾“çš„æ–¹å¼ï¼ˆé€šé“ï¼‰ï¼Œå¹¶ä¸å…³æ³¨æ¶ˆæ¯å®ä½“ã€‚å‘é€è€…å’Œæ¥æ”¶è€…å¯èƒ½å¹¶ä¸çŸ¥é“å¯¹æ–¹æ˜¯è°ï¼Œè€¦åˆåº¦æ˜¯å¾ˆä½çš„ã€‚</p><p>è™½ç„¶CSPçš„é€šé“æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œä½†ä½œä¸ºç‹¬ç«‹çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«ä»»æ„å¹¶å‘å®ä½“åˆ›å»ºã€è¯»å–ã€å†™å…¥ã€ä½¿ç”¨ï¼Œä½†ä½¿ç”¨æ—¶åŠ¡å¿…æ³¨æ„ï¼Œå½“ä¸€ä¸ªå¹¶å‘å®ä½“åœ¨è¯»å–ä¸€ä¸ªæ°¸è¿œæ²¡æœ‰æ•°æ®æ”¾å…¥çš„é€šé“æˆ–è€…æŠŠæ•°æ®æ”¾å…¥ä¸€ä¸ªæ°¸è¿œä¸ä¼šè¢«è¯»å–çš„é€šé“ï¼Œæ˜¯ä¼šè¢«é˜»å¡ï¼Œå‘ç”Ÿæ­»é”çš„ã€‚</p><h1 id="MPGçº¿ç¨‹æ¨¡å‹"><a href="#MPGçº¿ç¨‹æ¨¡å‹" class="headerlink" title="MPGçº¿ç¨‹æ¨¡å‹"></a>MPGçº¿ç¨‹æ¨¡å‹</h1><p>Goè¯­è¨€ä¸ä½†æœ‰ç€ç‹¬ç‰¹çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œè¿˜æ‹¥æœ‰å¼ºå¤§çš„ç”¨äºè°ƒåº¦goroutineã€å¯¹æ¥ç³»ç»Ÿçº§çº¿ç¨‹çš„è°ƒåº¦å™¨ã€‚</p><p>è¿™ä¸ªè°ƒåº¦å™¨æ˜¯Goè¯­è¨€è¿è¡Œæ—¶ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä¸»è¦è´Ÿè´£ç»Ÿç­¹è°ƒé…Goå¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸­çš„ä¸‰ä¸ªä¸»è¦å…ƒç´ ï¼Œå³ï¼šMPGã€‚</p><table><thead><tr><th>æ¨¡å—</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Machine</td><td>ä¸€ä¸ªMachineå¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œç›¸å½“äºå†…æ ¸çº¿ç¨‹åœ¨Goè¿›ç¨‹ä¸­çš„æ˜ å°„</td></tr><tr><td>Processor</td><td>ä¸€ä¸ªProcessorè¡¨ç¤ºæ‰§è¡ŒGoç¨‹åºæ‰€å¿…é¡»çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¯ä»¥ç†è§£ä¸ºç”¨æˆ·ä»£ç é€»è¾‘çš„å¤„ç†å™¨</td></tr><tr><td>Goroutine</td><td>æ˜¯å¯¹Goè¯­è¨€ä¸­ä»£ç ç‰‡æ®µçš„å°è£…ï¼Œå…¶å®æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç”¨æˆ·çº¿ç¨‹</td></tr></tbody></table><p>Må’ŒPæ˜¯ä¸€å¯¹ä¸€ç»‘å®šçš„ï¼Œä½†ç”±äºPçš„å­˜åœ¨ï¼ŒGå’ŒMå¯ä»¥å‘ˆç°å‡ºå¤šå¯¹å¤šçš„å…³ç³»ã€‚å½“ä¸€ä¸ªæ­£åœ¨ä¸æŸä¸ªMå¯¹æ¥å¹¶è¿è¡Œç€çš„Gï¼Œéœ€è¦å› æŸä¸ªäº‹ä»¶ï¼ˆæ¯”å¦‚ç­‰å¾…I/Oæˆ–é”çš„è§£é™¤ï¼‰è€Œæš‚åœè¿è¡Œçš„æ—¶å€™ï¼Œè°ƒåº¦å™¨æ€»ä¼šåŠæ—¶åœ°å‘ç°ï¼Œå¹¶æŠŠè¿™ä¸ªGä¸é‚£ä¸ªMåˆ†ç¦»å¼€ï¼Œä»¥é‡Šæ”¾è®¡ç®—èµ„æºä¾›é‚£äº›ç­‰å¾…è¿è¡Œçš„Gä½¿ç”¨ã€‚</p><p>å¯ä»¥çœ‹å›¾ï¼Œæ›´ç›´è§‚ï¼š</p><p><img src="/images/post/ebfe3e28315f12a08fbb4ffaee32e046.png" alt="MPGæ¨¡å‹"></p><hr><p>æœ‰å…³På’ŒMçš„ä¸ªæ•°é—®é¢˜</p><ul><li>Pçš„æ•°é‡ï¼š</li></ul><p>ç”±å¯åŠ¨æ—¶ç¯å¢ƒå˜é‡$GOMAXPROCSæˆ–è€…æ˜¯ç”±runtimeçš„æ–¹æ³•GOMAXPROCS()å†³å®šã€‚è¿™æ„å‘³ç€åœ¨ç¨‹åºæ‰§è¡Œçš„ä»»æ„æ—¶åˆ»éƒ½åªæœ‰$GOMAXPROCSä¸ªgoroutineåœ¨åŒæ—¶è¿è¡Œã€‚</p><ul><li>Mçš„æ•°é‡:</li></ul><p>goè¯­è¨€æœ¬èº«çš„é™åˆ¶ï¼šgoç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè®¾ç½®Mçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤10000ã€‚ä½†æ˜¯å†…æ ¸å¾ˆéš¾æ”¯æŒè¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªé™åˆ¶å¯ä»¥å¿½ç•¥ã€‚</p><p>runtime/debugä¸­çš„SetMaxThreadså‡½æ•°ï¼Œè®¾ç½®Mçš„æœ€å¤§æ•°é‡ã€‚</p><p>Mä¸Pçš„æ•°é‡æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œä¸€ä¸ªMé˜»å¡ï¼ŒPå°±ä¼šå»åˆ›å»ºæˆ–è€…åˆ‡æ¢å¦ä¸€ä¸ªMï¼Œæ‰€ä»¥ï¼Œå³ä½¿Pçš„é»˜è®¤æ•°é‡æ˜¯1ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ªMå‡ºæ¥ã€‚</p><p>På’ŒMä½•æ—¶ä¼šè¢«åˆ›å»ºï¼š</p><ul><li>Pä½•æ—¶åˆ›å»ºï¼šåœ¨ç¡®å®šäº†Pçš„æœ€å¤§æ•°é‡nåï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ•°é‡åˆ›å»ºnä¸ªPã€‚</li><li>Mä½•æ—¶åˆ›å»ºï¼šæ²¡æœ‰è¶³å¤Ÿçš„Mæ¥å…³è”På¹¶è¿è¡Œå…¶ä¸­çš„å¯è¿è¡Œçš„Gã€‚æ¯”å¦‚æ‰€æœ‰çš„Mæ­¤æ—¶éƒ½é˜»å¡ä½äº†ï¼Œè€ŒPä¸­è¿˜æœ‰å¾ˆå¤šå°±ç»ªä»»åŠ¡ï¼Œå°±ä¼šå»å¯»æ‰¾ç©ºé—²çš„Mï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„ï¼Œå°±ä¼šå»åˆ›å»ºæ–°çš„Mã€‚</li></ul><hr><p>å‚è€ƒï¼š</p><ul><li>ã€ŠGoè¯­è¨€é«˜å¹¶å‘ä¸å¾®æœåŠ¡å®æˆ˜ã€‹</li><li>ã€ŠGoè¯­è¨€æ ¸å¿ƒ36è®²ã€‹</li><li><a href="https://studygolang.com/articles/26921">Golangè°ƒåº¦å™¨GMPåŸç†ä¸è°ƒåº¦å…¨åˆ†æ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLé—´éš™é”</title>
    <link href="/2020/10/27/MySQL-gaplock/"/>
    <url>/2020/10/27/MySQL-gaplock/</url>
    
    <content type="html"><![CDATA[<h3 id="gap-lock-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#gap-lock-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="gap lock æ˜¯ä»€ä¹ˆï¼Ÿ"></a>gap lock æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>gap lockï¼Œä¹Ÿå°±æ˜¯é—´éš™é”ï¼Œæ˜¯innodbè¡Œçº§é”çš„ä¸€ç§ï¼Œå…¶ä»–çš„è¿˜æœ‰record lock, Next-KeyLocksã€‚</p><ul><li>è¡Œé”ï¼ˆRecord Lockï¼‰ï¼šé”ç›´æ¥åŠ åœ¨ç´¢å¼•è®°å½•ä¸Šé¢ã€‚</li><li>é—´éš™é”ï¼ˆGap Lockï¼‰ï¼šé”åŠ åœ¨ä¸å­˜åœ¨çš„ç©ºé—²ç©ºé—´ï¼Œå¯ä»¥æ˜¯ä¸¤ä¸ªç´¢å¼•è®°å½•ä¹‹é—´ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªç´¢å¼•è®°å½•ä¹‹å‰æˆ–æœ€åä¸€ä¸ªç´¢å¼•ä¹‹åçš„ç©ºé—´ã€‚</li><li>Next-Key Lockï¼šè¡Œé”ä¸é—´éš™é”ç»„åˆèµ·æ¥ç”¨å°±å«åšNext-Key Lockã€‚</li></ul><h3 id="ä»€ä¹ˆæ—¶å€™ä¼šå–å¾—gap-lock"><a href="#ä»€ä¹ˆæ—¶å€™ä¼šå–å¾—gap-lock" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¼šå–å¾—gap lock"></a>ä»€ä¹ˆæ—¶å€™ä¼šå–å¾—gap lock</h3><p>è¿™å’Œéš”ç¦»çº§åˆ«æœ‰å…³,åªåœ¨REPEATABLE READæˆ–ä»¥ä¸Šçš„éš”ç¦»çº§åˆ«ä¸‹çš„ç‰¹å®šæ“ä½œæ‰ä¼šå–å¾—gap lockæˆ–nextkey lockã€‚<br>locking readsï¼ŒUPDATEå’ŒDELETEæ—¶ï¼Œé™¤äº†å¯¹å”¯ä¸€ç´¢å¼•çš„å”¯ä¸€æœç´¢å¤–éƒ½ä¼šè·å–gapé”æˆ–next-keyé”ã€‚å³é”ä½å…¶æ‰«æçš„èŒƒå›´ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ä¾‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> TABLE <span class="hljs-symbol">`sai13`</span> (  <span class="hljs-symbol">`id`</span> int(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,  <span class="hljs-symbol">`user_id`</span> int(<span class="hljs-number">11</span>) DEFAULT <span class="hljs-literal">NULL</span>,  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-symbol">`id`</span>)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</code></pre></div><p>æ’å…¥3æ¡è®°å½•ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> sai13 <span class="hljs-keyword">values</span>(<span class="hljs-number">10</span>,<span class="hljs-number">1</span>);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> sai13 <span class="hljs-keyword">values</span>(<span class="hljs-number">20</span>,<span class="hljs-number">2</span>);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> sai13 <span class="hljs-keyword">values</span>(<span class="hljs-number">30</span>,<span class="hljs-number">3</span>);</code></pre></div><p>åœ¨REPEATABLE READä¸‹ï¼Œæ›´æ–°ä¸€æ¡è®°å½•ä¸æäº¤ï¼Œç„¶åçœ‹çœ‹èƒ½é˜»å¡å¦å¤–çš„ä¼šè¯å“ªäº›æ“ä½œã€‚</p><p>SESSION 1:</p><p>SESSION 1ä¸­æ›´æ–°id=20çš„è®°å½•</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; begin;<span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)<span class="hljs-attribute">mysql</span>&gt; update sai<span class="hljs-number">13</span> set user_id=<span class="hljs-number">2</span> where id=<span class="hljs-number">20</span>;<span class="hljs-attribute">Query</span> OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">04</span> sec)<span class="hljs-attribute">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span></code></pre></div><p>SESSION 2:</p><div class="code-wrapper"><pre><code class="hljs subunit">mysql&gt; begin;Query OK, 0 rows affected (0.00 sec)mysql&gt; insert into sai13 values(9,4);Query OK, 1 row affected (0.00 sec)mysql&gt; insert into sai13 values(10,4);<span class="hljs-keyword">ERROR </span>1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(19,4);<span class="hljs-keyword">ERROR </span>1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; update sai13 set user_id=22 where id=20;<span class="hljs-keyword">ERROR </span>1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(20,4);<span class="hljs-keyword">ERROR </span>1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(21,4);<span class="hljs-keyword">ERROR </span>1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(29,4);<span class="hljs-keyword">ERROR </span>1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(30,4);Query OK, 1 row affected (0.01 sec)</code></pre></div><p>SESSION 2ä¸­ï¼Œæ‰§è¡Œæ’å…¥æ“ä½œï¼Œå‘ç°[10,30)èŒƒå›´ä¸èƒ½æ’å…¥æ•°æ®ã€‚</p><p>SESSION 1:</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; begin;<span class="hljs-attribute">mysql</span>&gt; update sai<span class="hljs-number">13</span> set user_id=<span class="hljs-number">4</span> where id=<span class="hljs-number">21</span>;<span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)</code></pre></div><p>SESSION 2:</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; begin;<span class="hljs-attribute">mysql</span>&gt; update sai<span class="hljs-number">13</span> set user_id=<span class="hljs-number">22</span> where id=<span class="hljs-number">20</span>;<span class="hljs-attribute">Query</span> OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">01</span> sec)<span class="hljs-attribute">mysql</span>&gt; insert into sai<span class="hljs-number">13</span> values(<span class="hljs-number">20</span>,<span class="hljs-number">4</span>);<span class="hljs-attribute">ERROR</span> <span class="hljs-number">1205</span> (HY<span class="hljs-number">000</span>): Lock wait timeout exceeded; try restarting transaction<span class="hljs-attribute">mysql</span>&gt; update sai<span class="hljs-number">13</span> set user_id=<span class="hljs-number">4</span> where id=<span class="hljs-number">30</span>;<span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)</code></pre></div><p>è¿™é‡Œå‘¢ï¼Œæ˜¯å»é”ä½äº†ä¸€æ¡ä¸å­˜åœ¨çš„è®°å½•ï¼Œä»–ä¼šé”ä½æœ€è¿‘çš„[20,30)åŒºé—´ï¼Œç„¶è€Œä¸å‰ä¸€ä¸ªä¾‹å­ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œupdateï¼ˆid = 20ï¼‰æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œinsertï¼ˆid = 20ï¼‰æ˜¯ä¸å¯ä»¥çš„ã€‚</p><p>å¦‚æœSESSION 1çš„è¡¨æ‰«ææ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œé‚£ä¹ˆgapæˆ–next-keyé”ä½çš„èŒƒå›´æ˜¯æ•´ä¸ªè¡¨ï¼Œå³ä»»ä½•å€¼éƒ½ä¸èƒ½æ’å…¥ã€‚</p><h1 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h1><p>é—´éš™é”åœ¨InnoDBçš„å”¯ä¸€ä½œç”¨å°±æ˜¯é˜²æ­¢å…¶å®ƒäº‹åŠ¡çš„æ’å…¥æ“ä½œï¼Œä»¥æ­¤æ¥è¾¾åˆ°é˜²æ­¢å¹»è¯»çš„å‘ç”Ÿï¼Œæ‰€ä»¥é—´éš™é”ä¸åˆ†ä»€ä¹ˆå…±äº«é”ä¸æ’å®ƒé”ã€‚</p><p>æ—¢ç„¶çŸ¥é“æœ‰gap lockå’Œnext key lockï¼Œæˆ‘ä»¬å¼€å‘ä¸­å°±è¦é¿å…æ”¶åˆ°å…¶å½±å“ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨é”å°½é‡èµ°ç´¢å¼•ï¼Œç”šè‡³æ˜¯å”¯ä¸€ç´¢å¼•ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å…³é—­é—´éš™é”ï¼Œå¯ä»¥æŠŠéš”ç¦»çº§åˆ«é™ä¸ºè¯»å·²æäº¤Read Committedï¼Œæˆ–è€…å¼€å¯å‚æ•°innodb_locks_unsafe_for_binlogã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>layerå…³é—­çš„é—®é¢˜</title>
    <link href="/2020/10/21/277/"/>
    <url>/2020/10/21/277/</url>
    
    <content type="html"><![CDATA[<p>layerå¼¹å‡ºå±‚åº”è¯¥æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ä¸ªç»„ä»¶äº†ã€‚</p><p>é‡åˆ°ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¼¹å‡ºå±‚åŠ ä¸Šä¸‹ä¸€ä¸ªä¸Šä¸€ä¸ªï¼Œå…¶å®æŒ‰ç†æ˜¯æ¯”è¾ƒå¥½å®ç°ï¼Œç‚¹å‡»ä¸Šä¸€ä¸ªä¸‹ä¸€ä¸ªæŒ‰é’®ï¼Œè°ƒç”¨ä¸€ä¸‹layer.closeå³å¯ï¼Œç„¶è€Œæ— å¥ˆçš„æ˜¯å¼¹å‡ºçš„æ˜¯ä¸€ä¸ªiframeï¼Œéƒ½ä¸åœ¨ä¸€ä¸ªé¡µé¢ï¼Œå¦‚ä½•è°ƒç”¨layer.closeã€‚</p><p>é‚£å¯æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><div class="code-wrapper"><pre><code class="hljs pgsql">var <span class="hljs-keyword">index</span>=parent.layer.getFrameIndex(<span class="hljs-keyword">window</span>.name);parent.layer.<span class="hljs-keyword">close</span>(<span class="hljs-keyword">index</span>);parent.layer.<span class="hljs-keyword">open</span>(&#123;    <span class="hljs-keyword">type</span>: <span class="hljs-number">2</span>,    title: <span class="hljs-string">&#x27;è¯¦æƒ…&#x27;</span>,    shadeClose: <span class="hljs-keyword">true</span>,    area: [<span class="hljs-string">&#x27;1000px&#x27;</span>, <span class="hljs-string">&#x27;96%&#x27;</span>],    content: &quot;...&quot;&#125;);</code></pre></div><p>å¦‚ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨parent.layer.closeï¼Œå¹¶é€šè¿‡parent.layer.getFrameIndexè·å–å‰¯é¡µé¢çš„layerå…ƒç´ ï¼Œè¿™æ ·å°±å®ç°æ­¤éœ€æ±‚äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golangçš„timeä½¿ç”¨</title>
    <link href="/2020/09/10/275/"/>
    <url>/2020/09/10/275/</url>
    
    <content type="html"><![CDATA[<p>timeåº”è¯¥æ˜¯å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„åº“äº†ï¼Œå¸¸è§æ–¹æ³•è¯´æ˜ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;fmt&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;a := time.Now().Unix()fmt.Println(<span class="hljs-string">&quot;æ—¶é—´æˆ³---&quot;</span>, a)<span class="hljs-comment">// 2006-01-02 15:04:05 è®°ä½è¿™ä¸€åˆ»</span>b := time.Now().Format(<span class="hljs-string">&quot;2006-01-02 15:04:05&quot;</span>)fmt.Println(<span class="hljs-string">&quot;æ ¼å¼åŒ–æ—¶é—´&quot;</span>, b)<span class="hljs-comment">/**</span><span class="hljs-comment">func (t Time) Add(d Duration) Time</span><span class="hljs-comment">Durationå¦‚ä¸‹</span><span class="hljs-comment">const (</span><span class="hljs-comment">Nanosecond  Duration = 1</span><span class="hljs-comment">Microsecond          = 1000 * Nanosecond</span><span class="hljs-comment">Millisecond          = 1000 * Microsecond</span><span class="hljs-comment">Second               = 1000 * Millisecond</span><span class="hljs-comment">Minute               = 60 * Second</span><span class="hljs-comment">Hour                 = 60 * Minute</span><span class="hljs-comment">)</span><span class="hljs-comment"> */</span>c := time.Now().Add(time.Minute * <span class="hljs-number">3</span>)fmt.Println(<span class="hljs-string">&quot;3åˆ†é’Ÿåæ—¶é—´&quot;</span>, c.Format(<span class="hljs-string">&quot;2006-01-02 15:04:05&quot;</span>))<span class="hljs-comment">/**</span><span class="hljs-comment">func (t Time) AddDate(years int, months int, days int) Time</span><span class="hljs-comment">*/</span>d := time.Now().AddDate(<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>,<span class="hljs-number">10</span>)fmt.Println(<span class="hljs-string">&quot;æ—¶é—´&quot;</span>, d.Format(<span class="hljs-string">&quot;2006-01-02 15:04:05&quot;</span>))<span class="hljs-comment">// è¿”å›å¹´æœˆæ—¥ä¸‰ä¸ªå€¼</span>fmt.Println(time.Now().Date())<span class="hljs-comment">// è¿”å›æ—¶åˆ†ç§’ä¸‰ä¸ªå€¼</span>fmt.Println(time.Now().Clock())fmt.Println(time.Now().Year(), time.Now().Month(), time.Now().Day())fmt.Println(time.Now().Weekday(), time.Now().Hour())fmt.Println(time.Now().YearDay())fmt.Println(time.Since(d))<span class="hljs-comment">// tringè¿”å›é‡‡ç”¨å¦‚ä¸‹æ ¼å¼å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–æ—¶é—´ã€‚</span><span class="hljs-comment">// &quot;2006-01-02 15:04:05.999999999 -0700 MST&quot;</span>fmt.Println(time.Now().String())time.AfterFunc(<span class="hljs-number">2</span>*time.Second, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;fmt.Println(<span class="hljs-string">&quot;hello 2s&quot;</span>)&#125;)loc, _ := time.LoadLocation(<span class="hljs-string">&quot;Asia/Shanghai&quot;</span>)<span class="hljs-keyword">const</span> longForm = <span class="hljs-string">&quot;Jan 2, 2006 at 3:04pm (MST)&quot;</span><span class="hljs-keyword">const</span> shortForm = <span class="hljs-string">&quot;2006-Jan-02&quot;</span>t, _ := time.ParseInLocation(longForm, <span class="hljs-string">&quot;Jul 9, 2012 at 5:02am (CEST)&quot;</span>, loc)fmt.Println(t)<span class="hljs-comment">/**</span><span class="hljs-comment">func ParseInLocation(layout, value string, loc *Location) (Time, error)</span><span class="hljs-comment"> */</span>t, _ = time.ParseInLocation(shortForm, <span class="hljs-string">&quot;2022-Jul-09&quot;</span>, loc)fmt.Println(t)<span class="hljs-comment">/**</span><span class="hljs-comment">func Parse(layout, value string) (Time, error)</span><span class="hljs-comment"></span><span class="hljs-comment">è§£æä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²å¹¶è¿”å›å®ƒä»£è¡¨çš„æ—¶é—´</span><span class="hljs-comment">ParseInLocationç±»ä¼¼Parseä½†æœ‰ä¸¤ä¸ªé‡è¦çš„ä¸åŒä¹‹å¤„ã€‚</span><span class="hljs-comment">ç¬¬ä¸€ï¼Œå½“ç¼ºå°‘æ—¶åŒºä¿¡æ¯æ—¶ï¼ŒParseå°†æ—¶é—´è§£é‡Šä¸ºUTCæ—¶é—´ï¼Œè€ŒParseInLocationå°†è¿”å›å€¼çš„Locationè®¾ç½®ä¸ºlocï¼›</span><span class="hljs-comment">ç¬¬äºŒï¼Œå½“æ—¶é—´å­—ç¬¦ä¸²æä¾›äº†æ—¶åŒºåç§»é‡ä¿¡æ¯æ—¶ï¼ŒParseä¼šå°è¯•å»åŒ¹é…æœ¬åœ°æ—¶åŒºï¼Œè€ŒParseInLocationä¼šå»åŒ¹é…loc</span><span class="hljs-comment">*/</span>t, _ = time.Parse(longForm, <span class="hljs-string">&quot;Feb 3, 2023 at 7:54pm (PST)&quot;</span>)fmt.Println(t)t, _ = time.Parse(shortForm, <span class="hljs-string">&quot;2020-Feb-03&quot;</span>)fmt.Println(t)ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)timeout := time.After(time.Second * <span class="hljs-number">2</span>)timer := time.NewTimer(time.Second * <span class="hljs-number">4</span>) <span class="hljs-keyword">var</span> i <span class="hljs-keyword">int</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// i++</span><span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> &lt;- ch:fmt.Println(<span class="hljs-string">&quot;channel close&quot;</span>)<span class="hljs-keyword">return</span><span class="hljs-keyword">case</span> &lt;- timer.C:fmt.Println(<span class="hljs-string">&quot;4sçš„NewTimerå®šæ—¶ä»»åŠ¡&quot;</span>)<span class="hljs-keyword">case</span> &lt;- timeout:fmt.Println(<span class="hljs-string">&quot;4så®šæ—¶è¾“å‡º&quot;</span>)<span class="hljs-keyword">case</span> &lt;- time.After(time.Second * <span class="hljs-number">6</span>):fmt.Println(<span class="hljs-string">&quot;6såˆ°äº†&quot;</span>) <span class="hljs-comment">// default:</span><span class="hljs-comment">// //Sleep 1ç§’ï¼Œå‚æ•°å°±æ˜¯ä¸Šé¢çš„Duration</span><span class="hljs-comment">// time.Sleep(time.Second * 1)</span><span class="hljs-comment">// fmt.Println(&quot;go 1s&quot;)</span>&#125;&#125;&#125;()time.Sleep(time.Second * <span class="hljs-number">15</span>)fmt.Println(<span class="hljs-string">&quot;close----&quot;</span>)<span class="hljs-built_in">close</span>(ch)time.Sleep(time.Second * <span class="hljs-number">2</span>)&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravelé…åˆMaatwebsiteExcelå®ç°Excelå¯¼å‡º</title>
    <link href="/2020/08/31/272/"/>
    <url>/2020/08/31/272/</url>
    
    <content type="html"><![CDATA[<p>ç›¸æ¯”å¯¼å…¥ï¼Œé¡¹ç›®ä¸­å¯¼å‡ºåœºæ™¯æ›´å¤šï¼Œä¼°æ‘¸ç€ç°åœ¨æœ‰åå¤šä¸ªå¯¼å‡ºäº†ï¼Œä¹‹å‰å†™äº†å¯¼å…¥ï¼Œè¿™ä¼šæ‰æŠŠå¯¼å‡ºè¡¥ä¸Šã€‚</p><p>å®‰è£…ä¹‹å‰è¯´è¿‡ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹é…ç½®ï¼Œè™½ç„¶å·²æœ‰é»˜è®¤é…ç½®ï¼Œä½†è¿˜æ˜¯æœ‰ä¿®æ”¹é…ç½®çš„åœºæ™¯ï¼Œæ‰€ä»¥å»ºè®®ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//ç”Ÿæˆconfig/excel.php</span>php artisan vendor:publish --provider=<span class="hljs-string">&quot;Maatwebsite\Excel\ExcelServiceProvider&quot;</span></code></pre></div><p>é…ç½®åªæä¸€ä¸ªï¼Œå…¶ä»–æ³¨é‡Šè›®ç»†çš„ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs dart"><span class="hljs-string">&#x27;csv&#x27;</span> =&gt; [<span class="hljs-string">&#x27;delimiter&#x27;</span>              =&gt; <span class="hljs-string">&#x27;,&#x27;</span>,<span class="hljs-string">&#x27;enclosure&#x27;</span>              =&gt; <span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;line_ending&#x27;</span>            =&gt; PHP_EOL,<span class="hljs-comment">// å¯¼å‡ºcsvä¸­æ–‡ä¹±ç ï¼ŒæŠŠuse_bomè®¾ä¸ºtrueå³å¯</span><span class="hljs-string">&#x27;use_bom&#x27;</span>                =&gt; <span class="hljs-keyword">true</span>,<span class="hljs-string">&#x27;include_separator_line&#x27;</span> =&gt; <span class="hljs-keyword">false</span>,<span class="hljs-string">&#x27;excel_compatibility&#x27;</span>    =&gt; <span class="hljs-keyword">false</span>,],</code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæ¥å®Œæˆä¸€ä¸ªå¯¼å‡ºçš„demoè¯´æ˜ä¸‹å¸¸ç”¨çš„ä¸€äº›ç‚¹ã€‚</p><h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h2><div class="code-wrapper"><pre><code class="hljs php">php artisan make:export MultiExport</code></pre></div><p>ç”Ÿæˆæ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exports</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Concerns</span>\<span class="hljs-title">FromCollection</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiExport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FromCollection</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> \Illuminate\Support\Collection</span><span class="hljs-comment">    */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">collection</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">//</span>    &#125;&#125;</code></pre></div><ul><li>è‡ªå®šä¹‰sheetï¼Œå¢åŠ  WithTitle</li><li>è‡ªå®šä¹‰åˆ—åï¼Œå¢åŠ WithHeadings</li><li>ä¸æƒ³ä½¿ç”¨Collectionï¼Œæ›¿æ¢FromCollectionä½¿ç”¨FromArray</li><li>å¤šä¸ªsheetï¼Œæ›¿æ¢FromCollectionä½¿ç”¨WithMultipleSheets</li></ul><p>ç»è¿‡æ”¹é€ ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * å¤šé‡å¯¼å‡º</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exports</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exports</span>\<span class="hljs-title">MultiExportA</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exports</span>\<span class="hljs-title">MultiExportB</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Concerns</span>\<span class="hljs-title">WithMultipleSheets</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiExport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WithMultipleSheets</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$date</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$date</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;date = <span class="hljs-variable">$date</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sheets</span>(<span class="hljs-params"></span>): <span class="hljs-title">array</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$sheets</span> = [];        <span class="hljs-variable">$sheets</span>[] = <span class="hljs-keyword">new</span> MultiExportA(<span class="hljs-keyword">$this</span>-&gt;date);        <span class="hljs-variable">$sheets</span>[] = <span class="hljs-keyword">new</span> MultiExportB(<span class="hljs-keyword">$this</span>-&gt;date);        <span class="hljs-keyword">return</span> <span class="hljs-variable">$sheets</span>;    &#125;&#125;---<span class="hljs-comment">// MultiExportAï¼ŒMultiExportBç±»æ¯”å³å¯</span><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exports</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Concerns</span>\<span class="hljs-title">FromArray</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Concerns</span>\<span class="hljs-title">WithHeadings</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Concerns</span>\<span class="hljs-title">WithTitle</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">ExportA</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiExportA</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FromArray</span>, <span class="hljs-title">WithTitle</span>, <span class="hljs-title">WithHeadings</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$date</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$date</span>, <span class="hljs-variable">$cityId</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;date = <span class="hljs-variable">$date</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">headings</span>(<span class="hljs-params"></span>): <span class="hljs-title">array</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> [            <span class="hljs-string">&#x27;ID&#x27;</span>,            <span class="hljs-string">&#x27;åç§°&#x27;</span>,            <span class="hljs-string">&#x27;ä»·æ ¼&#x27;</span>,            <span class="hljs-string">&#x27;æ‰‹æœº&#x27;</span>        ];    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> array</span><span class="hljs-comment">    */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">array</span>(<span class="hljs-params"></span>) : <span class="hljs-title">array</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$data</span> = ExportA::where(<span class="hljs-string">&#x27;date&#x27;</span>, <span class="hljs-keyword">$this</span>-&gt;date)            -&gt;get()            -&gt;toArray();        <span class="hljs-variable">$ret</span> = [];        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$val</span>) &#123;            <span class="hljs-comment">// ä¸€æ®µç¥å¥‡çš„ä»£ç è®¡ç®—å‡ºäº†ä»·æ ¼</span>            <span class="hljs-variable">$price</span> = ...;            <span class="hljs-variable">$ret</span>[] = [                <span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-variable">$val</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&quot;\t&quot;</span>,                <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-variable">$val</span>[<span class="hljs-string">&#x27;name&#x27;</span>],                <span class="hljs-string">&#x27;price&#x27;</span> =&gt; <span class="hljs-variable">$price</span>,                <span class="hljs-comment">// è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œç¼–ç excelä½¿ç”¨äº†ç§‘å­¦è®¡æ•°æ³•</span>                <span class="hljs-string">&#x27;mobile&#x27;</span> =&gt; <span class="hljs-variable">$val</span>[<span class="hljs-string">&#x27;mobile&#x27;</span>].<span class="hljs-string">&quot;\t&quot;</span>,            ];        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ret</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> string</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">title</span>(<span class="hljs-params"></span>): <span class="hljs-title">string</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;è¡¨æ ¼A&#x27;</span>;    &#125;&#125;</code></pre></div><p>ä½¿ç”¨</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// ä¿å­˜</span><span class="hljs-variable">$obj</span> = <span class="hljs-keyword">new</span> MultiExport(<span class="hljs-variable">$date</span>);Excel::store(<span class="hljs-variable">$obj</span>, <span class="hljs-string">&#x27;MultiExport&#x27;</span>.<span class="hljs-variable">$date</span>.<span class="hljs-string">&#x27;.xlsx&#x27;</span>);<span class="hljs-comment">// ä¸‹è½½csv</span>Excel::download(<span class="hljs-variable">$obj</span>, <span class="hljs-string">&#x27;MultiExport&#x27;</span>.<span class="hljs-variable">$date</span>.<span class="hljs-string">&#x27;.csv&#x27;</span>, \Maatwebsite\Excel\Excel::CSV, [<span class="hljs-string">&#x27;Content-Type&#x27;</span> =&gt; <span class="hljs-string">&#x27;text/csv&#x27;</span>]);</code></pre></div><h2 id="é—®é¢˜æ€è€ƒ"><a href="#é—®é¢˜æ€è€ƒ" class="headerlink" title="é—®é¢˜æ€è€ƒ"></a>é—®é¢˜æ€è€ƒ</h2><p>å½“æ•°æ®é‡è¿‡å¤§çš„æ—¶å€™ï¼Œå¯¼å‡ºæ—¶å¾ˆå¯èƒ½ä¼šå†…å­˜æº¢å‡ºäº†ã€‚å»ºè®®ï¼š</p><ul><li>ä½¿ç”¨å…¶ä»–é«˜æ€§èƒ½çš„ç»„ä»¶ï¼Œæˆ–è€…ä½¿ç”¨åŸç”Ÿä»£ç æµå¼è¾“å‡ºåˆ°æµè§ˆå™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼ˆæ¯”å¦‚goï¼‰ç¼–å†™</li><li>æ–‡ä»¶è¿‡å¤§ï¼ŒExcelæ‰“å¼€å¤§æ•°æ®é‡æ–‡ä»¶ä¹Ÿå¾ˆé¸¡è‚‹ï¼Œå®¹æ˜“å¡æ­»ç”šè‡³å´©æºƒï¼Œå°è¯•åˆ†æ–‡ä»¶å¯¼å‡ºï¼Œæ¯”å¦‚1wä¸€ä¸ªæ–‡ä»¶</li><li>éƒ¨åˆ†å¯¼å‡ºè¿‡ç¨‹å¯èƒ½æœ‰è®¡ç®—ï¼Œå¯ä»¥æå‰è®¡ç®—å¥½ï¼Œå¯¼å‡ºæ—¶ç›´æ¥è¯»è¡¨ï¼Œä½¿ç”¨LazyCollectionï¼Œ <a href="https://learnku.com/laravel/t/42018" title="ä½¿ç”¨ Lazy Collections æ¥æé«˜ Laravel Excel è¯»å–çš„æ€§èƒ½ï¼ˆè½»æ¾æ”¯æŒç™¾ä¸‡æ•°æ®ï¼‰">ä½¿ç”¨ Lazy Collections æ¥æé«˜ Laravel Excel è¯»å–çš„æ€§èƒ½ï¼ˆè½»æ¾æ”¯æŒç™¾ä¸‡æ•°æ®ï¼‰</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravelå¸¸ç”¨ä»£ç åˆé›†</title>
    <link href="/2020/08/30/270/"/>
    <url>/2020/08/30/270/</url>
    
    <content type="html"><![CDATA[<p>ç”¨Laravelä¹Ÿæœ‰ä¸çŸ­çš„æ—¶é—´äº†ï¼Œä¹Ÿç”¨è¿‡ä¸å°‘ç‰ˆæœ¬äº†ï¼Œä»¥ä¸‹ä»£ç æ˜¯åœ¨æ—¥å¸¸é¡¹ç›®ä¸­æ”¶é›†ï¼Œä½œä¸ºç¬”è®°ï¼Œä¹Ÿåˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›å¯¹ä½ æœ‰ç‚¹ç”¨å¤„ã€‚<br>æ³¨ï¼šç‰ˆæœ¬æ²¡æ ‡æ³¨ï¼Œè‹¥æœ‰ä¸å…¼å®¹çš„é—®é¢˜ï¼Œå¾®è°ƒå³å¯ã€‚</p><h1 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h1><p>ä¸å¤ªä¹ æƒ¯å•ç‹¬å¼„ä¸ªRequestéªŒè¯ç±»ï¼Œæ¯”è¾ƒä¹ æƒ¯ä¸‹é¢çš„å†™æ³•ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Validator</span>;<span class="hljs-variable">$inputData</span> = <span class="hljs-variable">$request</span>-&gt;only([<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;address&#x27;</span>, <span class="hljs-string">&#x27;mobile&#x27;</span>, <span class="hljs-string">&#x27;draw_id&#x27;</span>]);    <span class="hljs-variable">$messages</span> = [    <span class="hljs-string">&#x27;required&#x27;</span>=&gt;<span class="hljs-string">&#x27;:attributeä¸ºå¿…å¡«é¡¹&#x27;</span>,         <span class="hljs-string">&#x27;int&#x27;</span>=&gt;<span class="hljs-string">&#x27;:attributeå‚æ•°ç±»å‹é”™è¯¯&#x27;</span>,         <span class="hljs-string">&#x27;max&#x27;</span>=&gt;<span class="hljs-string">&#x27;:attributeé•¿åº¦ä¸å¾—è¶…è¿‡ :size&#x27;</span>,    ];    <span class="hljs-variable">$validator</span> = Validator::make(<span class="hljs-variable">$inputData</span>, [<span class="hljs-string">&#x27;draw_id&#x27;</span> =&gt; <span class="hljs-string">&#x27;required|int&#x27;</span>,<span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;required&#x27;</span>,<span class="hljs-string">&#x27;mobile&#x27;</span> =&gt; <span class="hljs-string">&#x27;required&#x27;</span>,<span class="hljs-string">&#x27;address&#x27;</span> =&gt; <span class="hljs-string">&#x27;required&#x27;</span>,], <span class="hljs-variable">$messages</span>,[<span class="hljs-string">&#x27;name&#x27;</span>=&gt;<span class="hljs-string">&#x27;æ”¶è´§äººå§“å&#x27;</span>,<span class="hljs-string">&#x27;mobile&#x27;</span>=&gt;<span class="hljs-string">&#x27;æ‰‹æœºå·ç &#x27;</span>,<span class="hljs-string">&#x27;address&#x27;</span>=&gt;<span class="hljs-string">&#x27;æ”¶è´§åœ°å€&#x27;</span>,]);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$validator</span>-&gt;fails()) &#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::response([], current(<span class="hljs-variable">$validator</span>-&gt;errors()-&gt;all()), <span class="hljs-number">2</span>);&#125;</code></pre></div><h1 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h1><h2 id="å…³è”æŸ¥è¯¢"><a href="#å…³è”æŸ¥è¯¢" class="headerlink" title="å…³è”æŸ¥è¯¢"></a>å…³è”æŸ¥è¯¢</h2><ul><li><p>ä¸€å¯¹ä¸€</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// Modelå®šä¹‰ï¼Œå…³è”å¤–é”®</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span><span class="hljs-class"></span>&#123;    ...        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">userIntegral</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;hasOne(<span class="hljs-string">&#x27;App\Models\UserIntegral&#x27;</span>, <span class="hljs-string">&#x27;user_id&#x27;</span>, <span class="hljs-string">&#x27;id&#x27;</span>);    &#125;&#125;<span class="hljs-comment">// ä½¿ç”¨withæŸ¥è¯¢</span>(<span class="hljs-keyword">new</span> User())-&gt;with(<span class="hljs-string">&#x27;userIntegral&#x27;</span>)-&gt;orderBy(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;desc&#x27;</span>)-&gt;paginate(<span class="hljs-variable">$limit</span>);</code></pre></div></li><li><p>ä¸€å¯¹å¤š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//Model</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Model</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hotel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">orders</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;hasMany(<span class="hljs-string">&#x27;App\Models\Order&#x27;</span>);    &#125;&#125;<span class="hljs-comment">//ä½¿ç”¨ï¼Œæ¯”å¦‚æŸ¥è¯¢æŸä¸ªHotelä¸‹status=30çš„Order</span><span class="hljs-variable">$hotel</span> = Hotel::with([<span class="hljs-string">&#x27;orders&#x27;</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$query</span></span>) </span>&#123;        <span class="hljs-variable">$query</span>-&gt;where(<span class="hljs-string">&#x27;status&#x27;</span>, <span class="hljs-number">30</span>);    &#125;])-&gt;find(<span class="hljs-number">4</span>);</code></pre></div></li></ul><h1 id="ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h1><p>è¿™ä¸ªå¯ä»¥å‚è§ä¹‹å‰çš„æ–‡ç« <a href="https://learnku.com/articles/39988" title="Laravel ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸º JSON">Laravel ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸º JSON</a></p><h1 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h1><h2 id="å¤±è´¥é˜Ÿåˆ—å…¥åº“"><a href="#å¤±è´¥é˜Ÿåˆ—å…¥åº“" class="headerlink" title="å¤±è´¥é˜Ÿåˆ—å…¥åº“"></a>å¤±è´¥é˜Ÿåˆ—å…¥åº“</h2><ul><li><p>ç”Ÿæˆè¡¨<br>ç”Ÿæˆfailed_jobsè¡¨</p><div class="code-wrapper"><pre><code class="hljs cpp">php artisan queue:failed-tablephp artisan migrate</code></pre></div></li><li><p>å•ç‹¬å¤„ç†</p></li></ul><p>å¯ä»¥åœ¨Jobä¸­å•ç‹¬å¤„ç†å¤±è´¥ï¼ŒJobå¤±è´¥ä¹Ÿä¼šå†™å…¥ä¸Šé¢ç”Ÿæˆçš„failed_jobsè¡¨</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">/**</span><span class="hljs-comment">* ä»»åŠ¡å¤±è´¥çš„å¤„ç†è¿‡ç¨‹</span><span class="hljs-comment">*</span><span class="hljs-comment">* <span class="hljs-doctag">@param</span>  Exception  $exception</span><span class="hljs-comment">* [<span class="hljs-doctag">@return</span>](https://learnku.com/users/31554) void</span><span class="hljs-comment">*/</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failed</span>(<span class="hljs-params"><span class="hljs-built_in">Exception</span> <span class="hljs-variable">$exception</span></span>)</span><span class="hljs-function"></span>&#123;<span class="hljs-comment">// å¤„ç†</span>&#125;</code></pre></div><h2 id="é‡è¯•é˜Ÿåˆ—"><a href="#é‡è¯•é˜Ÿåˆ—" class="headerlink" title="é‡è¯•é˜Ÿåˆ—"></a>é‡è¯•é˜Ÿåˆ—</h2><p>æœ‰æ—¶å€™ä»£ç æœ‰æ¼æ´å¯èƒ½ä¼šæœ‰é˜Ÿåˆ—æ‰§è¡Œå¤±è´¥çš„çŠ¶å†µï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦é‡è¯•ã€‚</p><ul><li>æŸ¥çœ‹æ‰€æœ‰å¤±è´¥<div class="code-wrapper"><pre><code class="hljs shell">php artisan queue:failed</code></pre></div></li><li>é‡è¯•æ‰€æœ‰å¤±è´¥<div class="code-wrapper"><pre><code class="hljs shell">php artisan queue:retry all</code></pre></div></li><li>é‡è¯•å•ä¸ªå¤±è´¥<div class="code-wrapper"><pre><code class="hljs shell">php artisan queue:retry 13</code></pre></div></li><li>æ¸…ç©ºå¤±è´¥ï¼ˆé‡è¦çš„é˜Ÿåˆ—æ•°æ®ä¸‡ä¸å¯è¿™ä¹ˆæ“ä½œï¼‰<div class="code-wrapper"><pre><code class="hljs arduino">php artisan queue:flush</code></pre></div></li></ul><p>å¦å¤–ï¼Œæ‰‹åŠ¨å»æ“ä½œç¡®å®ä¸å¤ªæ–¹ä¾¿ï¼Œä½ å¯ä»¥è®¾ç½®ä¸ªcronï¼Œå®šæ—¶é‡è¯•æ‰€æœ‰å¤±è´¥ï¼Œä½†åŠ¡å¿…è¦æ³¨æ„æ¶ˆæ¯æé†’ï¼Œä»¥å…é˜Ÿåˆ—ä¸€ç›´é‡è¯•ä¸€ç›´å¤±è´¥ï¼Œå¾€å¤è¿è¡Œï¼Œå½±å“äº†æ­£å¸¸çš„é˜Ÿåˆ—æ€§èƒ½ã€‚</p><h1 id="å…¶ä»–å¸¸ç”¨ä»£ç "><a href="#å…¶ä»–å¸¸ç”¨ä»£ç " class="headerlink" title="å…¶ä»–å¸¸ç”¨ä»£ç "></a>å…¶ä»–å¸¸ç”¨ä»£ç </h1><h2 id="æ–‡ä»¶ä¸Šä¼ OSS"><a href="#æ–‡ä»¶ä¸Šä¼ OSS" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ OSS"></a>æ–‡ä»¶ä¸Šä¼ OSS</h2><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Controller</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Storage</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Validator</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">OSS</span>\<span class="hljs-title">OssClient</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">OSS</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">OssException</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UploadController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$request</span>-&gt;file(<span class="hljs-string">&#x27;file&#x27;</span>);        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span>-&gt;isValid()) &#123;            <span class="hljs-variable">$ext</span> = <span class="hljs-variable">$file</span>-&gt;getClientOriginalExtension();            <span class="hljs-variable">$realPath</span> = <span class="hljs-variable">$file</span>-&gt;getRealPath();            <span class="hljs-variable">$filepath</span> = config(<span class="hljs-string">&#x27;app.env&#x27;</span>).<span class="hljs-string">&#x27;/&#x27;</span> . md5(uniqid(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-literal">true</span>));            <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;uploadOss(<span class="hljs-variable">$realPath</span>, <span class="hljs-variable">$filepath</span>.<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>);            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>[<span class="hljs-string">&#x27;code&#x27;</span>]) &#123;                <span class="hljs-keyword">return</span> response([<span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-variable">$result</span>[<span class="hljs-string">&#x27;msg&#x27;</span>]]);            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-keyword">return</span> response([<span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>, <span class="hljs-string">&#x27;data&#x27;</span> =&gt; [                    <span class="hljs-string">&#x27;filepath&#x27;</span> =&gt; <span class="hljs-variable">$result</span>[<span class="hljs-string">&#x27;data&#x27;</span>][<span class="hljs-string">&#x27;url&#x27;</span>],                    <span class="hljs-string">&#x27;data&#x27;</span> =&gt; <span class="hljs-variable">$request</span>-&gt;all()                ]]);            &#125;        &#125;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ä¸Šä¼ oss</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> $filePath  å½“å‰è·¯å¾„</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> $object   é¢„å®šä¹‰æ–‡ä»¶åï¼Œå¯å«æ–‡ä»¶å¤¹</span><span class="hljs-comment">     * [<span class="hljs-doctag">@return</span>](https://learnku.com/users/31554) array</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uploadOss</span>(<span class="hljs-params"><span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$object</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$accessKeyId</span> = config(<span class="hljs-string">&#x27;filesystems.disks&#x27;</span>)[config(<span class="hljs-string">&#x27;filesystems.default&#x27;</span>)][<span class="hljs-string">&#x27;access_key&#x27;</span>];        <span class="hljs-variable">$accessKeySecret</span> = config(<span class="hljs-string">&#x27;filesystems.disks&#x27;</span>)[config(<span class="hljs-string">&#x27;filesystems.default&#x27;</span>)][<span class="hljs-string">&#x27;secret_key&#x27;</span>];        <span class="hljs-variable">$endpoint</span> = config(<span class="hljs-string">&#x27;filesystems.disks&#x27;</span>)[config(<span class="hljs-string">&#x27;filesystems.default&#x27;</span>)][<span class="hljs-string">&#x27;endpoint&#x27;</span>];        <span class="hljs-variable">$bucket</span>= config(<span class="hljs-string">&#x27;filesystems.disks&#x27;</span>)[config(<span class="hljs-string">&#x27;filesystems.default&#x27;</span>)][<span class="hljs-string">&#x27;bucket&#x27;</span>];        <span class="hljs-variable">$url</span> = config(<span class="hljs-string">&#x27;filesystems.disks&#x27;</span>)[config(<span class="hljs-string">&#x27;filesystems.default&#x27;</span>)][<span class="hljs-string">&#x27;host&#x27;</span>];        <span class="hljs-keyword">try</span>&#123;            <span class="hljs-variable">$ossClient</span> = <span class="hljs-keyword">new</span> OssClient(<span class="hljs-variable">$accessKeyId</span>, <span class="hljs-variable">$accessKeySecret</span>, <span class="hljs-variable">$endpoint</span>);            <span class="hljs-variable">$ossClient</span>-&gt;uploadFile(<span class="hljs-variable">$bucket</span>, <span class="hljs-variable">$object</span>, <span class="hljs-variable">$filePath</span>);            <span class="hljs-keyword">return</span> [                <span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-number">0</span>,                <span class="hljs-string">&#x27;data&#x27;</span> =&gt; [                    <span class="hljs-string">&#x27;url&#x27;</span> =&gt; <span class="hljs-variable">$url</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$object</span>                ]            ];        &#125; <span class="hljs-keyword">catch</span>(OssException <span class="hljs-variable">$e</span>) &#123;            <span class="hljs-keyword">return</span> [                <span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-number">1</span>,                <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-variable">$e</span>-&gt;getMessage()            ];        &#125;    &#125;&#125;<span class="hljs-comment">// -------</span><span class="hljs-comment">// é…ç½®</span><span class="hljs-string">&#x27;oss&#x27;</span> =&gt; [  <span class="hljs-string">&#x27;driver&#x27;</span> =&gt; <span class="hljs-string">&#x27;oss&#x27;</span>,  <span class="hljs-string">&#x27;root&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,  <span class="hljs-string">&#x27;access_key&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;OSS_ACCESS_KEY&#x27;</span>),  <span class="hljs-string">&#x27;secret_key&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;OSS_SECRET_KEY&#x27;</span>),  <span class="hljs-string">&#x27;endpoint&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;OSS_ENDPOINT&#x27;</span>), <span class="hljs-comment">// ä½¿ç”¨ ssl è¿™é‡Œè®¾ç½®å¦‚: https://oss-cn-beijing.aliyuncs.com</span>  <span class="hljs-string">&#x27;bucket&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;OSS_BUCKET&#x27;</span>),  <span class="hljs-string">&#x27;isCName&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;OSS_IS_CNAME&#x27;</span>, <span class="hljs-literal">false</span>), <span class="hljs-comment">// å¦‚æœ isCname ä¸º falseï¼Œendpoint åº”é…ç½® oss æä¾›çš„åŸŸåå¦‚ï¼š`oss-cn-beijing.aliyuncs.com`ï¼Œå¦åˆ™ä¸ºè‡ªå®šä¹‰åŸŸåï¼Œï¼Œcname æˆ– cdn è¯·è‡ªè¡Œåˆ°é˜¿é‡Œ oss åå°é…ç½®å¹¶ç»‘å®š bucket</span>  <span class="hljs-string">&#x27;host&#x27;</span> =&gt; env(<span class="hljs-string">&#x27;OSS_HOST&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)],</code></pre></div><h2 id="jsonè¾“å‡º"><a href="#jsonè¾“å‡º" class="headerlink" title="jsonè¾“å‡º"></a>jsonè¾“å‡º</h2><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$code</span> = <span class="hljs-number">0</span>;<span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ok&#x27;</span>;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">response</span>(<span class="hljs-params"><span class="hljs-variable">$data</span> = [], <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$code</span> = <span class="hljs-number">0</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$data</span>)) &#123;        <span class="hljs-variable">$data</span> = <span class="hljs-keyword">new</span> \<span class="hljs-built_in">stdClass</span>();    &#125;    <span class="hljs-keyword">return</span> response()-&gt;json([        <span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-variable">$code</span>? <span class="hljs-variable">$code</span> : <span class="hljs-built_in">self</span>::<span class="hljs-variable">$code</span>,        <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-variable">$msg</span>? <span class="hljs-variable">$msg</span> : <span class="hljs-built_in">self</span>::<span class="hljs-variable">$msg</span>,        <span class="hljs-string">&#x27;data&#x27;</span> =&gt; <span class="hljs-variable">$data</span>,    ], <span class="hljs-number">200</span>);&#125;</code></pre></div><h2 id="è¿›ç¨‹é”"><a href="#è¿›ç¨‹é”" class="headerlink" title="è¿›ç¨‹é”"></a>è¿›ç¨‹é”</h2><ul><li><p>æ™®é€šç‰ˆæœ¬</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// $autoDelå­—æ®µåˆ é™¤ï¼Œ$ttl è¿‡æœŸæ—¶é—´ï¼Œç§’</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">processLock</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>, <span class="hljs-variable">$autoDel</span> = <span class="hljs-literal">true</span>, <span class="hljs-variable">$ttl</span> = <span class="hljs-number">60</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;processLock:&#x27;</span>.<span class="hljs-variable">$key</span>;<span class="hljs-comment">// ä¸åŒç‰ˆæœ¬æˆ–Redisæ‰©å±•ï¼Œä¼šæœ‰ç•¥å¾®ä¸åŒï¼Œè‡ªè¡Œè°ƒæ•´ä¸‹ä»£ç å³å¯</span>    <span class="hljs-keyword">if</span> (Redis::Command(<span class="hljs-string">&#x27;set&#x27;</span>, [<span class="hljs-variable">$key</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;EX&#x27;</span>, <span class="hljs-variable">$ttl</span>, <span class="hljs-string">&#x27;NX&#x27;</span>])) &#123;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$autoDel</span>) &#123;            register_shutdown_function(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) <span class="hljs-keyword">use</span> (<span class="hljs-params"><span class="hljs-variable">$key</span></span>) </span>&#123;                Redis::del(<span class="hljs-variable">$key</span>);            &#125;);        &#125;                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre></div></li><li><p>luaç‰ˆæœ¬</p></li></ul><div class="code-wrapper"><pre><code class="hljs php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getScript</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&lt;&lt;&lt;LUA</span><span class="hljs-string">        local ret = Redis.call(&quot;setnx&quot;, KEYS[1], ARGV[1])</span><span class="hljs-string">        if ret == 1 then</span><span class="hljs-string">            return Redis.call(&quot;expire&quot;, KEYS[1], ARGV[2])</span><span class="hljs-string">        else</span><span class="hljs-string">            return 0</span><span class="hljs-string">        end</span><span class="hljs-string">LUA</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processLock</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>, <span class="hljs-variable">$autoDel</span> = <span class="hljs-literal">true</span>, <span class="hljs-variable">$ttl</span> = <span class="hljs-number">60</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (Redis::eval(<span class="hljs-keyword">$this</span>-&gt;getScript(), <span class="hljs-number">1</span>, <span class="hljs-variable">$key</span>, <span class="hljs-number">1</span>, <span class="hljs-variable">$ttl</span>)) &#123;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$autoDel</span>) &#123;register_shutdown_function(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) <span class="hljs-keyword">use</span> (<span class="hljs-params"><span class="hljs-variable">$key</span></span>) </span>&#123;Redis::del(<span class="hljs-variable">$key</span>);&#125;);&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre></div><p>è¯´æ˜ï¼šRedis::evalè¡Œç¬¬ä¸€ä¸ª1è¡¨ç¤ºkeyçš„æ•°é‡ï¼Œæ˜¯ä¸ºäº†åŒºåˆ†KEYSå’ŒARGVã€‚</p><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p><a href="https://learnku.com/articles/39993" title="Laravel é…åˆ jwt ä½¿ç”¨">Laravel é…åˆ jwt ä½¿ç”¨</a></p><h2 id="ç³»ç»Ÿé€šçŸ¥åˆ°é’‰é’‰"><a href="#ç³»ç»Ÿé€šçŸ¥åˆ°é’‰é’‰" class="headerlink" title="ç³»ç»Ÿé€šçŸ¥åˆ°é’‰é’‰"></a>ç³»ç»Ÿé€šçŸ¥åˆ°é’‰é’‰</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—ï¼ŒæŠŠä¸€äº›é‡è¦çš„é€šçŸ¥æŠ•åˆ°é’‰é’‰ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Dispatchable</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">SerializesModels</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Log</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">GuzzleHttp</span>\<span class="hljs-title">Client</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SystemNotify</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">use</span> <span class="hljs-title">Dispatchable</span>, <span class="hljs-title">InteractsWithQueue</span>, <span class="hljs-title">Queueable</span>, <span class="hljs-title">SerializesModels</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$title</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$content</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$type</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$robot</span>;    <span class="hljs-keyword">const</span> DD_URL = <span class="hljs-string">&#x27;https://oapi.dingtalk.com&#x27;</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Create a new job instance.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> $title</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string $content</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string $type text, markdown</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> int $robot</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$title</span>, <span class="hljs-variable">$content</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$type</span> = <span class="hljs-string">&#x27;markdown&#x27;</span>, <span class="hljs-variable">$robot</span> = <span class="hljs-number">1</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">// å•ç‹¬ä½¿ç”¨SystemNotifyé˜Ÿåˆ—</span>        <span class="hljs-keyword">$this</span>-&gt;queue = <span class="hljs-string">&#x27;SystemNotify&#x27;</span>;        <span class="hljs-keyword">$this</span>-&gt;title = <span class="hljs-variable">$title</span>;        <span class="hljs-keyword">$this</span>-&gt;content = <span class="hljs-variable">$content</span>;        <span class="hljs-keyword">$this</span>-&gt;type = <span class="hljs-variable">$type</span>;        <span class="hljs-keyword">$this</span>-&gt;robot = <span class="hljs-variable">$robot</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Execute the job.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">// å¯ä»¥ä¸ä½¿ç”¨å…³é”®å­—ï¼Œå»ºè®®é’‰é’‰æœºå™¨äººä½¿ç”¨IPæ®µè®¾ç½®ï¼Œæ›´ä¸ºå®‰å…¨</span>        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">$this</span>-&gt;type)&#123;            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;markdown&#x27;</span>:                <span class="hljs-variable">$params</span> = [                    <span class="hljs-string">&#x27;msgtype&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;type,                    <span class="hljs-keyword">$this</span>-&gt;type =&gt; [                        <span class="hljs-string">&#x27;title&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;title.<span class="hljs-string">&#x27;[å…³é”®å­—]&#x27;</span>,                        <span class="hljs-string">&#x27;text&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;content                    ]                ];                <span class="hljs-keyword">break</span>;            <span class="hljs-keyword">default</span>:                <span class="hljs-variable">$params</span> = [                    <span class="hljs-string">&#x27;msgtype&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;type,                    <span class="hljs-keyword">$this</span>-&gt;type =&gt; [                        <span class="hljs-string">&#x27;content&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;content.<span class="hljs-string">&#x27;[å…³é”®å­—]&#x27;</span>,                    ]                ];                <span class="hljs-keyword">break</span>;        &#125;        <span class="hljs-variable">$params</span> = json_encode(<span class="hljs-variable">$params</span>, JSON_UNESCAPED_UNICODE);        <span class="hljs-variable">$uri</span> = <span class="hljs-built_in">self</span>::URL_MAPPING[<span class="hljs-keyword">$this</span>-&gt;robot];        <span class="hljs-keyword">$this</span>-&gt;getClient()-&gt;request(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-variable">$uri</span>, [            <span class="hljs-string">&#x27;headers&#x27;</span> =&gt; [                <span class="hljs-string">&#x27;Content-Type&#x27;</span> =&gt; <span class="hljs-string">&#x27;application/json;charset=utf-8&#x27;</span>            ],            <span class="hljs-string">&#x27;body&#x27;</span> =&gt; <span class="hljs-variable">$params</span>        ]);    &#125;    <span class="hljs-comment">// å¯¹åº”ä¸åŒçš„é’‰é’‰ç¾¤é€šçŸ¥ï¼Œä¿®æ”¹access_tokenå‚æ•°å³å¯</span>    <span class="hljs-keyword">const</span> URL_MAPPING = [        <span class="hljs-number">1</span> =&gt; <span class="hljs-string">&#x27;/robot/send?access_token=@1&#x27;</span>,        <span class="hljs-number">2</span> =&gt; <span class="hljs-string">&#x27;/robot/send?access_token=@2&#x27;</span>    ];    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getClient</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Client([            <span class="hljs-string">&#x27;base_uri&#x27;</span> =&gt; <span class="hljs-string">&#x27;https://oapi.dingtalk.com&#x27;</span>,            <span class="hljs-string">&#x27;timeout&#x27;</span>  =&gt; <span class="hljs-number">30</span>,            <span class="hljs-string">&#x27;verify&#x27;</span> =&gt; <span class="hljs-literal">false</span>        ]);    &#125;&#125;</code></pre></div><p>è¯´æ˜ï¼šé€šçŸ¥å†…å®¹å¯ä»¥è‡ªå®šä¹‰ï¼Œæ·»åŠ æ™ºèƒ½æœºå™¨äººæ“ä½œæ¯”è¾ƒç®€å•å°±ä¸èµ˜è¿°äº†</p><ul><li><a href="https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq" title="é’‰é’‰æ–‡æ¡£">é’‰é’‰æ–‡æ¡£</a></li></ul><h2 id="åå°æ“ä½œæ—¥å¿—"><a href="#åå°æ“ä½œæ—¥å¿—" class="headerlink" title="åå°æ“ä½œæ—¥å¿—"></a>åå°æ“ä½œæ—¥å¿—</h2><p><a href="https://learnku.com/articles/43900" title="åˆ©ç”¨ Laravel ä¸­é—´ä»¶ç»™åå°åŠ ä¸ªæ“ä½œæ—¥å¿—">åˆ©ç”¨ Laravel ä¸­é—´ä»¶ç»™åå°åŠ ä¸ªæ“ä½œæ—¥å¿—</a></p><h2 id="Excel"><a href="#Excel" class="headerlink" title="Excel"></a>Excel</h2><p><a href="https://learnku.com/articles/42849" title="Laravel6 é…åˆ Maatwebsite\Excel å®ç° Excel å¯¼å…¥">Laravel6 é…åˆ Maatwebsite\Excel å®ç° Excel å¯¼å…¥</a></p><p><a href="https://learnku.com/articles/49392" title="Laravel6 é…åˆ Maatwebsite\Excel å®ç° Excel å¯¼å‡º">Laravel6 é…åˆ Maatwebsite\Excel å®ç° Excel å¯¼å‡º</a></p><p>é™†ç»­è¡¥å……ä¸­â€¦</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ€è¿‘ä½¿ç”¨ginçš„æ€»ç»“</title>
    <link href="/2020/07/20/261/"/>
    <url>/2020/07/20/261/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰æ–°é¡¹ç›®æ˜¯åˆ©ç”¨ginå¼€å‘çš„ï¼Œè¿‡ç¨‹ä¸­é‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œä½œä¸ºç¬”è®°ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ã€‚</p><h2 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="headerlink" title="è·¨åŸŸé—®é¢˜"></a>è·¨åŸŸé—®é¢˜</h2><p>ä¸­é—´ä»¶ï¼š</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Cors</span><span class="hljs-params">()</span> <span class="hljs-title">gin</span>.<span class="hljs-title">HandlerFunc</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œå¯ä»¥ç”¨*ï¼Œä¹Ÿå¯ä»¥ç”¨ä½ æŒ‡å®šçš„åŸŸå</span>c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>)<span class="hljs-comment">// å…è®¸å¤´éƒ¨å‚æ•°</span>c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;Content-Type,AccessToken,X-CSRF-Token, Authorization, Token&quot;</span>)<span class="hljs-comment">// å…è®¸çš„æ–¹æ³•</span>c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;POST, GET, OPTIONS&quot;</span>)c.Header(<span class="hljs-string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="hljs-string">&quot;Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Content-Type&quot;</span>)c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>) method := c.Request.Method<span class="hljs-comment">//æ”¾è¡ŒOPTIONSæ–¹æ³•</span><span class="hljs-keyword">if</span> method == <span class="hljs-string">&quot;OPTIONS&quot;</span> &#123;c.AbortWithStatus(http.StatusOK)&#125;<span class="hljs-comment">// å¤„ç†è¯·æ±‚</span>c.Next()&#125;&#125;</code></pre></div><p>ç„¶ååœ¨è·¯ç”±ä¸­åŠ å…¥ï¼š</p><div class="code-wrapper"><pre><code class="hljs ada">// g : *<span class="hljs-type">gin.Engine</span>g.<span class="hljs-keyword">Use</span>(Cors())</code></pre></div><p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨Nginxå±‚é…ç½®ï¼Œå¯è‡ªè¡ŒæŸ¥é˜…ï¼Œæˆ‘å°±ä¸å±•å¼€äº†ã€‚</p><h2 id="ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶"><a href="#ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶" class="headerlink" title="ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶"></a>ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶</h2><div class="code-wrapper"><pre><code class="hljs css">// g : *gin.Engineg.<span class="hljs-built_in">Use</span>(<span class="hljs-built_in">Cors</span>())g.<span class="hljs-built_in">Use</span>(<span class="hljs-built_in">Session</span>())</code></pre></div><h2 id="ä¸­é—´ä»¶ç»ˆæ­¢è¯·æ±‚"><a href="#ä¸­é—´ä»¶ç»ˆæ­¢è¯·æ±‚" class="headerlink" title="ä¸­é—´ä»¶ç»ˆæ­¢è¯·æ±‚"></a>ä¸­é—´ä»¶ç»ˆæ­¢è¯·æ±‚</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Auth</span><span class="hljs-params">()</span> <span class="hljs-title">gin</span>.<span class="hljs-title">HandlerFunc</span></span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;uid := c.MustGet(<span class="hljs-string">&quot;uid&quot;</span>).(<span class="hljs-keyword">int</span>)<span class="hljs-keyword">if</span> uid == <span class="hljs-number">0</span> &#123;c.Abort()controller.SendResponse(c, <span class="hljs-number">401</span>, <span class="hljs-string">&quot;æœªç™»å½•&quot;</span>, <span class="hljs-literal">nil</span>)<span class="hljs-comment">// returnå¯å¿½ç•¥</span><span class="hljs-keyword">return</span>&#125; <span class="hljs-keyword">else</span> &#123;c.Next()&#125;    &#125;&#125;</code></pre></div><h2 id="sessionä½¿ç”¨"><a href="#sessionä½¿ç”¨" class="headerlink" title="sessionä½¿ç”¨"></a>sessionä½¿ç”¨</h2><div class="code-wrapper"><pre><code class="hljs stylus">package utilimport (<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><span class="hljs-string">&quot;github.com/gin-contrib/sessions/Redis&quot;</span>RedisGo <span class="hljs-string">&quot;github.com/gomodule/redigo/Redis&quot;</span><span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>)<span class="hljs-comment">// å¯åŠ¨session</span>func SessionStart(g *gin<span class="hljs-selector-class">.Engine</span>, RedisClient *RedisGo<span class="hljs-selector-class">.Pool</span>, key ...<span class="hljs-selector-attr">[]</span>byte)  &#123;store, _ := Redis<span class="hljs-selector-class">.NewStoreWithPool</span>(RedisClient, <span class="hljs-selector-attr">[]</span>byte(viper<span class="hljs-selector-class">.GetString</span>(<span class="hljs-string">&quot;name&quot;</span>)))Redis<span class="hljs-selector-class">.SetKeyPrefix</span>(store, <span class="hljs-string">&quot;session_&quot;</span>)g<span class="hljs-selector-class">.Use</span>(sessions<span class="hljs-selector-class">.Sessions</span>(viper<span class="hljs-selector-class">.GetString</span>(<span class="hljs-string">&quot;name&quot;</span>), store))&#125;<span class="hljs-comment">// ä½¿ç”¨session</span>session  := sessions<span class="hljs-selector-class">.Default</span>(c)session<span class="hljs-selector-class">.Set</span>(<span class="hljs-string">&quot;uid&quot;</span>, uid)uid  := session<span class="hljs-selector-class">.Get</span>(<span class="hljs-string">&quot;uid&quot;</span>)</code></pre></div><h2 id="ä¸Šä¼ oss"><a href="#ä¸Šä¼ oss" class="headerlink" title="ä¸Šä¼ oss"></a>ä¸Šä¼ oss</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;os&quot;</span><span class="hljs-string">&quot;github.com/aliyun/aliyun-oss-go-sdk/oss&quot;</span><span class="hljs-string">&quot;github.com/spf13/viper&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">upload</span><span class="hljs-params">(localPath <span class="hljs-keyword">string</span>, iType <span class="hljs-keyword">int</span>, Name <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(path <span class="hljs-keyword">string</span>)</span></span> &#123;client, err := oss.New(viper.GetString(<span class="hljs-string">&quot;oss.end_point&quot;</span>), viper.GetString(<span class="hljs-string">&quot;oss.access_key_id&quot;</span>), viper.GetString(<span class="hljs-string">&quot;oss.access_key_secret&quot;</span>))    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span>     &#125;    <span class="hljs-comment">// è·å–å­˜å‚¨ç©ºé—´ã€‚</span>    bucket, err := client.Bucket(viper.GetString(<span class="hljs-string">&quot;oss.bucket&quot;</span>))    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span>     &#125;    <span class="hljs-comment">// ä¸Šä¼ æœ¬åœ°æ–‡ä»¶ã€‚</span>ossPath := fmt.Sprintf(<span class="hljs-string">&quot;%s/%s&quot;</span>, <span class="hljs-string">&quot;qiling&quot;</span>, Name)    err = bucket.PutObjectFromFile(ossPath, localPath)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span>    &#125;path = fmt.Sprintf(<span class="hljs-string">&quot;%s/%s&quot;</span>, viper.GetString(<span class="hljs-string">&quot;oss.hosts&quot;</span>), ossPath)os.Remove(localPath)<span class="hljs-keyword">return</span>&#125;</code></pre></div><h2 id="å‡ ä¸ªå®ç”¨çš„æ–¹æ³•"><a href="#å‡ ä¸ªå®ç”¨çš„æ–¹æ³•" class="headerlink" title="å‡ ä¸ªå®ç”¨çš„æ–¹æ³•"></a>å‡ ä¸ªå®ç”¨çš„æ–¹æ³•</h2><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">import</span>  (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;crypto/md5&quot;</span><span class="hljs-string">&quot;bytes&quot;</span><span class="hljs-string">&quot;regexp&quot;</span>)<span class="hljs-comment">// md5</span><span class="hljs-function"><span class="hljs-keyword">func</span>  <span class="hljs-title">Md5</span><span class="hljs-params">(str <span class="hljs-keyword">string</span>)</span>  <span class="hljs-title">string</span></span>  &#123;<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;%x&quot;</span>, md5.Sum([]<span class="hljs-keyword">byte</span>(str)));&#125;<span class="hljs-comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯çœŸå®æ‰‹æœºå·ç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">IsMobile</span><span class="hljs-params">(mobile <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">bool</span></span> &#123;    result, _ := regexp.MatchString(<span class="hljs-string">`^(1\d&#123;10&#125;)$`</span>, mobile)    <span class="hljs-keyword">if</span> result &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>    &#125;&#125;<span class="hljs-comment">// åˆå¹¶å­—ç¬¦ä¸²</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StrCombine</span><span class="hljs-params">(str ...<span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">var</span> bt bytes.Buffer<span class="hljs-keyword">for</span> _, arg := <span class="hljs-keyword">range</span> str &#123;bt.WriteString(arg)    &#125;<span class="hljs-comment">//è·å¾—æ‹¼æ¥åçš„å­—ç¬¦ä¸²</span><span class="hljs-keyword">return</span> bt.String()&#125;</code></pre></div><p>å¤§æ¦‚å°±è¿™äº›äº†ï¼Œåé¢æœ‰å¯ä»¥åˆ†æçš„å†è¡¥å……ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨vue-element-adminçš„ä¸€äº›æ€»ç»“</title>
    <link href="/2020/07/14/262/"/>
    <url>/2020/07/14/262/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å¼€å‘çš„é¡¹ç›®åå°åŸºäºvue-element-adminå¼€å‘ï¼Œåœ¨é€æ­¥å®Œå–„çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œç‰¹æ­¤æ€»ç»“ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><p>å…ˆä¸Šé“¾æ¥ï¼ŒçœŸçš„å¾ˆå¥½ç”¨ï¼Œå®‰åˆ©ä¸€ä¸‹ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š</p><ul><li>  <a href="https://link.zhihu.com/?target=https://panjiachen.gitee.io/vue-element-admin-site/zh/">A magical vue admin</a></li></ul><p>åŸºæœ¬ä¸Šå¸¸ç”¨çš„ä¸å¸¸ç”¨çš„åŠŸèƒ½éƒ½æœ‰ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œæœ‰å…´è¶£é“¾æ¥ç›´è¾¾ï¼Œæ­£å¼å¼€å§‹æ­£æ–‡ã€‚</p><h3 id="ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡"><a href="#ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡" class="headerlink" title="ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡"></a>ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡</h3><p>å®˜æ–¹çš„svgå›¾æ ‡ç¡®å®æ¯”è¾ƒå°‘ï¼Œæ·»åŠ æˆ‘ä¹Ÿè§‰å¾—ç¹çï¼Œå¦å¤–ï¼Œæ—¢ç„¶é›†æˆäº†elementUIï¼Œç›´æ¥ç”¨elementUIå›¾æ ‡å°±å¥½äº†ã€‚</p><p>æ”¹ï¼š</p><div class="code-wrapper"><pre><code class="hljs stylus">ä¿®æ”¹èœå•<span class="hljs-attribute">icon</span>ä¸ºelementUIå›¾æ ‡ï¼š<span class="hljs-comment">// æ–‡ä»¶åœ°å€ï¼šsrc\layout\components\Sidebar\Item.vue</span><span class="hljs-comment">// if (icon) &#123;</span><span class="hljs-comment">//   vnodes.push(&lt;svg-icon icon-class=&#123;icon&#125;/&gt;)</span><span class="hljs-comment">// &#125;</span><span class="hljs-keyword">if</span> (<span class="hljs-attribute">icon</span>) &#123;  vnodes<span class="hljs-selector-class">.push</span>(&lt;<span class="hljs-selector-tag">i</span> class=&#123;<span class="hljs-attribute">icon</span>&#125;&gt;&lt;/i&gt;)&#125;</code></pre></div><h3 id="å…³é—­eslint"><a href="#å…³é—­eslint" class="headerlink" title="å…³é—­eslint"></a>å…³é—­eslint</h3><p>å®˜ç½‘å·²æœ‰ç­”æ¡ˆ</p><div class="code-wrapper"><pre><code class="hljs actionscript"><span class="hljs-comment">// vue.config.js</span>lintOnSave: <span class="hljs-literal">false</span></code></pre></div><p>butï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯gitç®¡ç†ä»£ç ï¼Œä¼šå‘ç°commitçš„æ—¶å€™ä¾æ—§ä¼šè§¦å‘eslintã€‚</p><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> package.json <span class="hljs-string">&quot;lint-staged&quot;</span>: &#123;    <span class="hljs-string">&quot;src/**/*.&#123;js,vue&#125;&quot;</span>: [      <span class="hljs-string">&quot;eslint --fix&quot;</span>, <span class="hljs-regexp">//</span> åˆ é™¤è¿™ä¸€è¡Œ      <span class="hljs-string">&quot;git add&quot;</span>    ]  &#125;,</code></pre></div><h3 id="å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡"><a href="#å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡" class="headerlink" title="å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡"></a>å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡</h3><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> package.json <span class="hljs-string">&quot;scripts&quot;</span>: &#123;    <span class="hljs-string">&quot;local&quot;</span>: <span class="hljs-string">&quot;vue-cli-service serve --mode local&quot;</span>,    ...  &#125;,</code></pre></div><p>å¤åˆ¶.env.productionä¸º.env.localï¼Œè‡ªå®šä¹‰é…ç½®åï¼Œè¿è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs applescript">yarn <span class="hljs-built_in">run</span> <span class="hljs-keyword">local</span></code></pre></div><h3 id="ç¼“å­˜é¡µé¢"><a href="#ç¼“å­˜é¡µé¢" class="headerlink" title="ç¼“å­˜é¡µé¢"></a>ç¼“å­˜é¡µé¢</h3><p>æƒ³ç¼“å­˜çš„é¡µé¢ï¼š</p><div class="code-wrapper"><pre><code class="hljs xquery"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span></span><span class="javascript"><span class="xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> </span></span><span class="xquery">&#123;</span><span class="xquery"> <span class="hljs-built_in"> name</span>: <span class="hljs-string">&quot;cacheIndex&quot;</span>,</span></code></pre></div><p>åŠ å…¥cachedViews</p><div class="code-wrapper"><pre><code class="hljs pf">// src\store\modules\tagsView.js<span class="hljs-keyword">const</span>Â <span class="hljs-keyword">state</span>Â =Â &#123;Â Â visitedViews:Â [],Â Â cachedViews:Â [Â Â Â Â &#x27;cacheIndex&#x27;Â Â ]&#125;</code></pre></div><p>æœ€è¿‘å¼€å‘çš„é¡¹ç›®åå°åŸºäºvue-element-adminå¼€å‘ï¼Œåœ¨é€æ­¥å®Œå–„çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œç‰¹æ­¤æ€»ç»“ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><p>å…ˆä¸Šé“¾æ¥ï¼ŒçœŸçš„å¾ˆå¥½ç”¨ï¼Œå®‰åˆ©ä¸€ä¸‹ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š</p><ul><li>  <a href="https://link.zhihu.com/?target=https://panjiachen.gitee.io/vue-element-admin-site/zh/">A magical vue admin</a></li></ul><p>åŸºæœ¬ä¸Šå¸¸ç”¨çš„ä¸å¸¸ç”¨çš„åŠŸèƒ½éƒ½æœ‰ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œæœ‰å…´è¶£é“¾æ¥ç›´è¾¾ï¼Œæ­£å¼å¼€å§‹æ­£æ–‡ã€‚</p><h3 id="ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡-1"><a href="#ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡-1" class="headerlink" title="ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡"></a>ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡</h3><p>å®˜æ–¹çš„svgå›¾æ ‡ç¡®å®æ¯”è¾ƒå°‘ï¼Œæ·»åŠ æˆ‘ä¹Ÿè§‰å¾—ç¹çï¼Œå¦å¤–ï¼Œæ—¢ç„¶é›†æˆäº†elementUIï¼Œç›´æ¥ç”¨elementUIå›¾æ ‡å°±å¥½äº†ã€‚</p><p>æ”¹ï¼š</p><div class="code-wrapper"><pre><code class="hljs stylus">ä¿®æ”¹èœå•<span class="hljs-attribute">icon</span>ä¸ºelementUIå›¾æ ‡ï¼š<span class="hljs-comment">// æ–‡ä»¶åœ°å€ï¼šsrc\layout\components\Sidebar\Item.vue</span><span class="hljs-comment">// if (icon) &#123;</span><span class="hljs-comment">//   vnodes.push(&lt;svg-icon icon-class=&#123;icon&#125;/&gt;)</span><span class="hljs-comment">// &#125;</span><span class="hljs-keyword">if</span> (<span class="hljs-attribute">icon</span>) &#123;  vnodes<span class="hljs-selector-class">.push</span>(&lt;<span class="hljs-selector-tag">i</span> class=&#123;<span class="hljs-attribute">icon</span>&#125;&gt;&lt;/i&gt;)&#125;</code></pre></div><h3 id="å…³é—­eslint-1"><a href="#å…³é—­eslint-1" class="headerlink" title="å…³é—­eslint"></a>å…³é—­eslint</h3><p>å®˜ç½‘å·²æœ‰ç­”æ¡ˆ</p><div class="code-wrapper"><pre><code class="hljs actionscript"><span class="hljs-comment">// vue.config.js</span>lintOnSave: <span class="hljs-literal">false</span></code></pre></div><p>butï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯gitç®¡ç†ä»£ç ï¼Œä¼šå‘ç°commitçš„æ—¶å€™ä¾æ—§ä¼šè§¦å‘eslintã€‚</p><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> package.json <span class="hljs-string">&quot;lint-staged&quot;</span>: &#123;    <span class="hljs-string">&quot;src/**/*.&#123;js,vue&#125;&quot;</span>: [      <span class="hljs-string">&quot;eslint --fix&quot;</span>, <span class="hljs-regexp">//</span> åˆ é™¤è¿™ä¸€è¡Œ      <span class="hljs-string">&quot;git add&quot;</span>    ]  &#125;,</code></pre></div><h3 id="å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡-1"><a href="#å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡-1" class="headerlink" title="å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡"></a>å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡</h3><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> package.json <span class="hljs-string">&quot;scripts&quot;</span>: &#123;    <span class="hljs-string">&quot;local&quot;</span>: <span class="hljs-string">&quot;vue-cli-service serve --mode local&quot;</span>,    ...  &#125;,</code></pre></div><p>å¤åˆ¶.env.productionä¸º.env.localï¼Œè‡ªå®šä¹‰é…ç½®åï¼Œè¿è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs applescript">yarn <span class="hljs-built_in">run</span> <span class="hljs-keyword">local</span></code></pre></div><h3 id="ç¼“å­˜é¡µé¢-1"><a href="#ç¼“å­˜é¡µé¢-1" class="headerlink" title="ç¼“å­˜é¡µé¢"></a>ç¼“å­˜é¡µé¢</h3><p>æƒ³ç¼“å­˜çš„é¡µé¢ï¼š</p><div class="code-wrapper"><pre><code class="hljs xquery"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span></span><span class="javascript"><span class="xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> </span></span><span class="xquery">&#123;</span><span class="xquery"> <span class="hljs-built_in"> name</span>: <span class="hljs-string">&quot;cacheIndex&quot;</span>,</span></code></pre></div><p>åŠ å…¥cachedViews</p><div class="code-wrapper"><pre><code class="hljs pf">// src\store\modules\tagsView.js<span class="hljs-keyword">const</span>Â <span class="hljs-keyword">state</span>Â =Â &#123;Â Â visitedViews:Â [],Â Â cachedViews:Â [Â Â Â Â &#x27;cacheIndex&#x27;Â Â ]&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElementUI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨ElementUIçš„tableå’Œcalendaråˆ¶ä½œä¸€ä¸ªä»·æ ¼æ—¥å†</title>
    <link href="/2020/05/04/250/"/>
    <url>/2020/05/04/250/</url>
    
    <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­éœ€è¦åšä¸€ä¸ªä»·æ ¼æ—¥å†ï¼Œä¾¿äºå±•ç¤ºå’Œä¿®æ”¹æ—¥æœŸä»·æ ¼ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹æœ€ç»ˆæ•ˆæœï¼Œç„¶ååˆ©ç”¨ElementUIçš„table å’Œ calendar å®ç°ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/202005/04/41489/pto2GeGfrI.jpg!large" alt="ä»·æ ¼æ—¥å†"><br><img src="https://cdn.learnku.com/uploads/images/202005/04/41489/pjnT5lsXnM.jpg!large" alt="è®¾ç½®ä»·æ ¼"></p><p>æ¥çœ‹çœ‹ä¸»è¦ä»£ç ï¼ˆä»£ç ä»…ä¿ç•™äº†ä¸»è¦ä»£ç å’Œå±æ€§ï¼Œå¹¶ä¸å®Œæ•´ï¼Œå¯ä»¥è‡ªè¡Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ï¼š</p><div class="code-wrapper"><pre><code class="hljs handlebars"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;calendar-list-container&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-comment">&lt;!--expand-row-keysè®¾ç½®äº†row-keyä¹Ÿè¦è®¾ç½®ï¼Œ</span></span><span class="hljs-comment"><span class="xml">expand-changeå½“ç”¨æˆ·å¯¹æŸä¸€è¡Œå±•å¼€æˆ–è€…å…³é—­çš„æ—¶å€™ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼ˆå±•å¼€è¡Œæ—¶ï¼Œå›è°ƒçš„ç¬¬äºŒä¸ªå‚æ•°ä¸º expandedRowsï¼›æ ‘å½¢è¡¨æ ¼æ—¶ç¬¬äºŒå‚æ•°ä¸º expandedï¼‰row, (expandedRows | expanded)--&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;table&quot;</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;id&quot;</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">v-loading</span>=<span class="hljs-string">&quot;listLoading&quot;</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;list&quot;</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">element-loading-text</span>=<span class="hljs-string">&quot;loading&quot;</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">row-key</span>=<span class="hljs-string">&quot;id&quot;</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">:expand-row-keys</span>=<span class="hljs-string">&quot;expands&quot;</span></span></span><span class="hljs-tag"><span class="xml">      @<span class="hljs-attr">expand-change</span>=<span class="hljs-string">&quot;expandChange&quot;</span></span></span><span class="hljs-tag"><span class="xml">    &gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> </span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;expand&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-comment">&lt;!--ä»·æ ¼æ—¥å†æ¸²æŸ“ --&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-calendar</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">v-loading</span>=<span class="hljs-string">&quot;calendarLoad&quot;</span>  </span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">element-loading-text</span>=<span class="hljs-string">&quot;loading&quot;</span></span></span><span class="hljs-tag"><span class="xml">          &gt;</span></span><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">template</span></span></span><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;dateCell&quot;</span></span></span><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;&#123;date, data&#125;&quot;</span></span></span><span class="hljs-tag"><span class="xml">            &gt;</span></span><span class="xml"><span class="hljs-comment">&lt;!--ä»Šæ—¥åŠä¹‹åçš„ä»·æ ¼å¯è®¾ç½®setPrice --&gt;</span></span><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;nowDay &lt;= data.day.replace(/-/g, &#x27;&#x27;)? &#x27;calendar-div&#x27; : &#x27;calendar-div calendar-prev&#x27;&quot;</span></span></span><span class="hljs-tag"><span class="xml">                @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;nowDay &lt;= data.day.replace(/-/g, &#x27;&#x27;) &amp;&amp; setPrice(data, date)&quot;</span></span></span><span class="hljs-tag"><span class="xml">              &gt;</span></span><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">data.day.slice</span>(<span class="hljs-name">-2</span>) &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><span class="hljs-tag"><span class="xml">                  <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;data.type == &#x27;current-month&#x27; &amp;&amp; refreshPrice(data)&quot;</span></span></span><span class="hljs-tag"><span class="xml">                  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;price &quot;</span></span></span><span class="hljs-tag"><span class="xml">                &gt;</span></span><span class="xml">                  é¢„è®¢ä»·ï¼š</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">priceList</span>[data.day.slice(-2) -1] &#125;&#125;</span><span class="xml">å…ƒ</span><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">el-calendar</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;åç§°&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">class-name</span>=<span class="hljs-string">&quot;overflow-on&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><span class="xml">          </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">scope.row.name</span> &#125;&#125;</span><span class="xml"></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><span class="xml"></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;å›¾ç‰‡&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;210&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;scope.row.imageList[0]&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:150px&quot;</span></span></span><span class="hljs-tag"><span class="xml">          &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><span class="xml"></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;ä»Šæ—¥ä»·æ ¼&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">max-width</span>=<span class="hljs-string">&quot;200&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">scope.row.price</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><span class="xml"></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;åŸä»·&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">max-width</span>=<span class="hljs-string">&quot;200&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">scope.row.original_price</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><span class="xml"></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;æ“ä½œ&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span></span><span class="hljs-tag"><span class="xml">            @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;handleCheck(scope.row)&quot;</span></span></span><span class="hljs-tag"><span class="xml">          &gt;</span></span><span class="xml">            ä»·æ ¼è®¾ç½®</span><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span></span><span class="xml"></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;è®¾ç½®ä»·æ ¼&quot;</span></span></span><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">:visible.sync</span>=<span class="hljs-string">&quot;dialogPriceVisible&quot;</span></span></span><span class="hljs-tag"><span class="xml">    &gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;small-space&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">:model</span>=<span class="hljs-string">&quot;temp&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label-position</span>=<span class="hljs-string">&quot;left&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label-width</span>=<span class="hljs-string">&quot;100px&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 500px; margin-left:50px;&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;åç§°&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;temp.name&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">disabled</span></span></span><span class="hljs-tag"><span class="xml">          /&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;æ—¶é—´æ®µ&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-date-picker</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;temp.date&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;daterange&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">range-separator</span>=<span class="hljs-string">&quot;è‡³&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">start-placeholder</span>=<span class="hljs-string">&quot;å¼€å§‹æ—¥æœŸ&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">end-placeholder</span>=<span class="hljs-string">&quot;ç»“æŸæ—¥æœŸ&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">:picker-options</span>=<span class="hljs-string">&quot;pickerBeginDateBefore&quot;</span></span></span><span class="hljs-tag"><span class="xml">          /&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span><span class="xml"></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span></span></span><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;åˆ†æ—¶è®¡ä»·&quot;</span></span></span><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;is_part&quot;</span></span></span><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">required</span></span></span><span class="hljs-tag"><span class="xml">        &gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-radio</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;temp.is_part&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;0&quot;</span></span></span><span class="hljs-tag"><span class="xml">          &gt;</span></span><span class="xml">            ä¸åˆ†å¹³æ—¶å‘¨æœ«</span><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">el-radio</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-radio</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;temp.is_part&quot;</span></span></span><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;1&quot;</span></span></span><span class="hljs-tag"><span class="xml">          &gt;</span></span><span class="xml">            åŒºåˆ†å‘¨æœ«</span><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">el-radio</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;å¹³æ—¶ä»·&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;temp.normal_price&quot;</span> /&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span><span class="xml"></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span></span></span><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;temp.is_part == 1&quot;</span></span></span><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;å‘¨æœ«ä»·&quot;</span></span></span><span class="hljs-tag"><span class="xml">        &gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;temp.week_price&quot;</span> /&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span></span><span class="xml"></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;footer&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dialog-footer&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;dialogPriceVisible = false&quot;</span>&gt;</span></span><span class="xml">          å– æ¶ˆ</span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span></span><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span></span><span class="hljs-tag"><span class="xml">          @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;putPrice&quot;</span></span></span><span class="hljs-tag"><span class="xml">        &gt;</span></span><span class="xml">          ç¡® å®š</span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span></span><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml"></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span></span><span class="javascript"><span class="xml"><span class="hljs-keyword">import</span> &#123; fetchList, setRoomPrice, getRoomPrice &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/api&quot;</span>;</span></span><span class="javascript"><span class="xml"><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;moment&#x27;</span>;</span></span><span class="javascript"><span class="xml"></span></span><span class="javascript"><span class="xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><span class="javascript"><span class="xml">  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;room&quot;</span>,</span></span><span class="javascript"><span class="xml">  <span class="hljs-function"><span class="hljs-title">data</span>(<span class="hljs-params"></span>)</span> &#123;</span></span><span class="javascript"><span class="xml">    <span class="hljs-keyword">return</span> &#123;</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">pickerBeginDateBefore</span>:&#123;</span></span><span class="javascript"><span class="xml">        <span class="hljs-function"><span class="hljs-title">disabledDate</span>(<span class="hljs-params">time</span>)</span> &#123;</span></span><span class="javascript"><span class="xml">          <span class="hljs-keyword">return</span> time.getTime() &lt; <span class="hljs-built_in">Date</span>.now() - <span class="hljs-number">86400</span>*<span class="hljs-number">1000</span>;</span></span><span class="javascript"><span class="xml">        &#125;</span></span><span class="javascript"><span class="xml">      &#125;,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">schedule</span>: [],</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">list</span>: [],</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">dialogPriceVisible</span>: <span class="hljs-literal">false</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">dialogFormVisible</span>: <span class="hljs-literal">false</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">priceDate</span>: <span class="hljs-string">&#x27;2020-01-01&#x27;</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">nowDate</span>: <span class="hljs-number">1</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">nowMonth</span>: <span class="hljs-number">1</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">nowDay</span>: <span class="hljs-number">0</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">nowYear</span>: <span class="hljs-number">2020</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">calendarMonth</span>: <span class="hljs-number">1</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">priceList</span>: [],</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">expands</span>: [],<span class="hljs-comment">//åªå±•å¼€ä¸€è¡Œæ”¾å…¥å½“å‰è¡Œid</span></span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">room</span>: &#123;&#125;,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">listLoading</span>:<span class="hljs-literal">false</span>,</span></span><span class="javascript"><span class="xml">      <span class="hljs-attr">calendarLoad</span>: <span class="hljs-literal">false</span>,</span></span><span class="javascript"><span class="xml">    &#125;;</span></span><span class="javascript"><span class="xml">  &#125;,</span></span><span class="javascript"><span class="xml">  <span class="hljs-function"><span class="hljs-title">created</span>(<span class="hljs-params"></span>)</span> &#123;</span></span><span class="javascript"><span class="xml">    <span class="hljs-built_in">this</span>.priceDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();</span></span><span class="javascript"><span class="xml">    <span class="hljs-built_in">this</span>.nowDate = <span class="hljs-built_in">this</span>.priceDate.getDate();</span></span><span class="javascript"><span class="xml">    <span class="hljs-built_in">this</span>.nowMonth = <span class="hljs-built_in">this</span>.priceDate.getMonth();</span></span><span class="javascript"><span class="xml">    <span class="hljs-built_in">this</span>.calendarMonth = <span class="hljs-built_in">this</span>.nowMonth;</span></span><span class="javascript"><span class="xml">    <span class="hljs-built_in">this</span>.nowYear = <span class="hljs-built_in">this</span>.priceDate.getFullYear();</span></span><span class="javascript"><span class="xml">    <span class="hljs-built_in">this</span>.nowDay = <span class="hljs-built_in">this</span>.priceDate.getFullYear()*<span class="hljs-number">10000</span>+ (<span class="hljs-number">1</span>+<span class="hljs-built_in">this</span>.priceDate.getMonth())*<span class="hljs-number">100</span>+ <span class="hljs-built_in">this</span>.priceDate.getDate();</span></span><span class="javascript"><span class="xml">  &#125;,</span></span><span class="javascript"><span class="xml">  <span class="hljs-attr">methods</span>: &#123;</span></span><span class="javascript"><span class="xml">    refreshPrice (data) &#123;</span></span><span class="javascript"><span class="xml">      <span class="hljs-comment">// console.log(data);</span></span></span><span class="javascript"><span class="xml">      <span class="hljs-keyword">if</span> (!data.isSelected) &#123;</span></span><span class="javascript"><span class="xml">        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span></span><span class="javascript"><span class="xml">      &#125;</span></span><span class="javascript"><span class="xml">      <span class="hljs-keyword">if</span> (data.day.slice(<span class="hljs-number">5</span>, <span class="hljs-number">7</span>) == <span class="hljs-built_in">this</span>.calendarMonth + <span class="hljs-number">1</span>) &#123;</span></span><span class="javascript"><span class="xml">        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span></span><span class="javascript"><span class="xml">      &#125;</span></span><span class="javascript"><span class="xml">      <span class="hljs-built_in">this</span>.calendarMonth = data.day.slice(<span class="hljs-number">5</span>, <span class="hljs-number">7</span>) - <span class="hljs-number">1</span>;</span></span><span class="javascript"><span class="xml">      <span class="hljs-keyword">var</span> that = <span class="hljs-built_in">this</span>;</span></span><span class="javascript"><span class="xml">      getRoomPrice(that.room.id, &#123;<span class="hljs-string">&#x27;date&#x27;</span>: data.day&#125;).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;</span></span><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> arr = [];</span></span><span class="javascript"><span class="xml">        response.data.priceList.forEach(<span class="hljs-function">(<span class="hljs-params">item,index,array</span>)=&gt;</span>&#123;</span></span><span class="javascript"><span class="xml">            arr[index] = item? item : that.room.price;</span></span><span class="javascript"><span class="xml">        &#125;)</span></span><span class="javascript"><span class="xml">        that.priceList = arr</span></span><span class="javascript"><span class="xml">      &#125;);</span></span><span class="javascript"><span class="xml">      that.$forceUpdate()</span></span><span class="javascript"><span class="xml">    &#125;,</span></span><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">getRowKeys</span>(<span class="hljs-params">row</span>)</span> &#123;</span></span><span class="javascript"><span class="xml">        <span class="hljs-comment">// console.log(row.id)</span></span></span><span class="javascript"><span class="xml">        <span class="hljs-keyword">return</span> row.id   <span class="hljs-comment">//è¿™é‡Œçœ‹è¿™ä¸€è¡Œä¸­éœ€è¦æ ¹æ®å“ªä¸ªå±æ€§å€¼æ˜¯id</span></span></span><span class="javascript"><span class="xml">    &#125;,</span></span><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">selectDate</span>(<span class="hljs-params">type</span>)</span> &#123;</span></span><span class="javascript"><span class="xml">      <span class="hljs-comment">// consoloe.log(type)</span></span></span><span class="javascript"><span class="xml">    &#125;,</span></span><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">expandChange</span>(<span class="hljs-params">row, expandedRows</span>)</span> &#123;</span></span><span class="javascript"><span class="xml">      <span class="hljs-comment">// console.log(this.expands)</span></span></span><span class="javascript"><span class="xml">      <span class="hljs-keyword">var</span> that = <span class="hljs-built_in">this</span>;</span></span><span class="javascript"><span class="xml">      that.room = row;</span></span><span class="javascript"><span class="xml">  <span class="hljs-comment">// æ¯æ¬¡åªå±•å¼€ä¸€è¡Œ</span></span></span><span class="javascript"><span class="xml">      <span class="hljs-keyword">if</span> (expandedRows.length) &#123; </span></span><span class="javascript"><span class="xml">        that.calendarLoad = <span class="hljs-literal">true</span>;</span></span><span class="javascript"><span class="xml">        getRoomPrice(row.id, &#123;<span class="hljs-string">&#x27;date&#x27;</span>: <span class="hljs-built_in">this</span>.priceDate&#125;).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;</span></span><span class="javascript"><span class="xml">          that.calendarLoad = <span class="hljs-literal">false</span>;</span></span><span class="javascript"><span class="xml">          <span class="hljs-keyword">var</span> arr = [];</span></span><span class="javascript"><span class="xml">          response.data.priceList.forEach(<span class="hljs-function">(<span class="hljs-params">item,index,array</span>)=&gt;</span>&#123;</span></span><span class="javascript"><span class="xml">              arr[index] = item? item : row.price;</span></span><span class="javascript"><span class="xml">          &#125;)</span></span><span class="javascript"><span class="xml">          that.priceList = arr</span></span><span class="javascript"><span class="xml">          that.expands = [row.id]</span></span><span class="javascript"><span class="xml">        &#125;);</span></span><span class="javascript"><span class="xml">      &#125; <span class="hljs-keyword">else</span> &#123; </span></span><span class="javascript"><span class="xml">  <span class="hljs-comment">// æ”¶èµ·ä»·æ ¼æ—¥å†</span></span></span><span class="javascript"><span class="xml">        that.expands = []</span></span><span class="javascript"><span class="xml">      &#125;</span></span><span class="javascript"><span class="xml">    &#125;,</span></span><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">setPrice</span>(<span class="hljs-params">data, date</span>)</span> &#123;</span></span><span class="javascript"><span class="xml">      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.nowDay &gt; data.day.replace(<span class="hljs-regexp">/-/g</span>, <span class="hljs-string">&#x27;&#x27;</span>)) &#123;</span></span><span class="javascript"><span class="xml">          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span></span><span class="javascript"><span class="xml">      &#125;</span></span><span class="javascript"><span class="xml">      <span class="hljs-keyword">var</span> that = <span class="hljs-built_in">this</span>;</span></span><span class="javascript"><span class="xml">      <span class="hljs-built_in">this</span>.temp = &#123;</span></span><span class="javascript"><span class="xml">        <span class="hljs-attr">name</span>: that.room.name,</span></span><span class="javascript"><span class="xml">        <span class="hljs-attr">date</span>: [date, date],</span></span><span class="javascript"><span class="xml">        <span class="hljs-attr">is_part</span>: <span class="hljs-number">0</span>,</span></span><span class="javascript"><span class="xml">      &#125;;</span></span><span class="javascript"><span class="xml">      <span class="hljs-built_in">this</span>.dialogPriceVisible = <span class="hljs-literal">true</span>;</span></span><span class="javascript"><span class="xml">    &#125;,</span></span><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">putPrice</span>(<span class="hljs-params"></span>)</span> &#123;</span></span><span class="javascript"><span class="xml">      <span class="hljs-built_in">this</span>.dialogPriceVisible = <span class="hljs-literal">true</span>;</span></span><span class="javascript"><span class="xml">        setRoomPrice(<span class="hljs-built_in">this</span>.room.id, <span class="hljs-built_in">this</span>.temp).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;</span></span><span class="javascript"><span class="xml">          <span class="hljs-keyword">if</span> (res.code == <span class="hljs-number">0</span>) &#123;</span></span><span class="javascript"><span class="xml">            <span class="hljs-built_in">this</span>.$message.success(<span class="hljs-string">&quot;ç¼–è¾‘æˆåŠŸ&quot;</span>);</span></span><span class="javascript"><span class="xml">            <span class="hljs-built_in">this</span>.dialogPriceVisible = !<span class="hljs-built_in">this</span>.dialogPriceVisible;</span></span><span class="javascript"><span class="xml">            <span class="hljs-keyword">var</span> that = <span class="hljs-built_in">this</span>;</span></span><span class="javascript"><span class="xml">            getRoomPrice(that.room.id, &#123;<span class="hljs-string">&#x27;date&#x27;</span>: <span class="hljs-built_in">this</span>.temp.date[<span class="hljs-number">0</span>]&#125;).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;</span></span><span class="javascript"><span class="xml">              <span class="hljs-keyword">var</span> arr = [];</span></span><span class="javascript"><span class="xml">              response.data.priceList.forEach(<span class="hljs-function">(<span class="hljs-params">item,index,array</span>)=&gt;</span>&#123;</span></span><span class="javascript"><span class="xml">                  arr[index] = item? item : that.room.price;</span></span><span class="javascript"><span class="xml">              &#125;)</span></span><span class="javascript"><span class="xml">              that.priceList = arr</span></span><span class="javascript"><span class="xml">            &#125;);</span></span><span class="javascript"><span class="xml">            fetchList(that.params).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;</span></span><span class="javascript"><span class="xml">              that.list = response.data;</span></span><span class="javascript"><span class="xml">            &#125;);</span></span><span class="javascript"><span class="xml">            that.resetTemp();</span></span><span class="javascript"><span class="xml">            that.$forceUpdate()</span></span><span class="javascript"><span class="xml">          &#125; <span class="hljs-keyword">else</span> &#123;</span></span><span class="javascript"><span class="xml">            <span class="hljs-built_in">this</span>.$message.error(res.msg);</span></span><span class="javascript"><span class="xml">          &#125;</span></span><span class="javascript"><span class="xml">        &#125;);</span></span><span class="javascript"><span class="xml">    &#125;,</span></span><span class="javascript"><span class="xml"><span class="hljs-comment">// ç”¨äºå¯å±•å¼€è¡¨æ ¼ä¸æ ‘å½¢è¡¨æ ¼ï¼Œåˆ‡æ¢æŸä¸€è¡Œçš„å±•å¼€çŠ¶æ€ï¼Œå¦‚æœä½¿ç”¨äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™æ˜¯è®¾ç½®è¿™ä¸€è¡Œå±•å¼€ä¸å¦ï¼ˆexpanded ä¸º true åˆ™å±•å¼€ï¼‰</span></span></span><span class="javascript"><span class="xml">    <span class="hljs-function"><span class="hljs-title">handleCheck</span>(<span class="hljs-params">row</span>)</span> &#123;</span></span><span class="javascript"><span class="xml">        <span class="hljs-keyword">const</span> $table = <span class="hljs-built_in">this</span>.$refs.table</span></span><span class="javascript"><span class="xml">        $table.toggleRowExpansion(row)</span></span><span class="javascript"><span class="xml">    &#125;</span></span><span class="javascript"><span class="xml">  &#125;</span></span><span class="javascript"><span class="xml">&#125;;</span></span><span class="javascript"><span class="xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></pre></div><p>ä»·æ ¼æ—¥å†è¿”å›æ•°æ®æ ¼å¼ï¼š</p><div class="code-wrapper"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-number">0</span>,<span class="hljs-attr">&quot;msg&quot;</span>: <span class="hljs-string">&quot;æ“ä½œæˆåŠŸ&quot;</span>,<span class="hljs-attr">&quot;data&quot;</span>: &#123;<span class="hljs-attr">&quot;room&quot;</span>: &#123;<span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;å¤§åºŠæˆ¿&quot;</span>,<span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">299</span>,<span class="hljs-attr">&quot;original_price&quot;</span>: <span class="hljs-number">289</span>&#125;,<span class="hljs-attr">&quot;priceList&quot;</span>: [<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">209</span>, <span class="hljs-number">219</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>],&#125;&#125;</code></pre></div><p>priceListæ˜¯æœ¬æœˆä»·æ ¼ï¼Œfalseè¡¨ç¤ºæœªè®¾ç½®ã€‚</p><hr><p>tableçš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œéƒ¨åˆ†å±æ€§å‡½æ•°å¹¶ä¸å¸¸ç”¨ï¼Œå¯ä»¥è‡ªè¡Œæ‰“å°å‡ºæ¥çœ‹çœ‹ï¼Œç ”ç©¶ä¸€ä¸‹å³å¯ã€‚<br>calendaræ˜¯2.8ç‰ˆæœ¬æ–°å¢çš„ç»„ä»¶ï¼Œå¦‚æœç‰ˆæœ¬è¿‡ä½ï¼Œå¯ä»¥å°è¯•å‡çº§åˆ°æ–°ç‰ˆæœ¬ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElementUI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨Laravelä¸­é—´ä»¶ç»™åå°åŠ ä¸ªæ“ä½œæ—¥å¿—</title>
    <link href="/2020/04/29/248/"/>
    <url>/2020/04/29/248/</url>
    
    <content type="html"><![CDATA[<p>é¡¹ç›®åå°è§’è‰²åŠäººå‘˜å˜å¤šï¼Œéœ€è¦åŠ ä¸‹æ—¥å¿—ï¼Œæ–¹ä¾¿æŸ¥è¯¢ï¼Œä¸å¦¨åˆ©ç”¨ä¸­é—´ä»¶å®ç°ä¸‹ã€‚</p><p>æ–¹æ¡ˆï¼š</p><ul><li>ä¸­é—´ä»¶åˆ¤æ–­æ˜¯å¦éœ€è¦è®°å½•ï¼Œå†™å…¥é˜Ÿåˆ—</li><li>é˜Ÿåˆ—å†™å…¥æ•°æ®åº“</li></ul><p>è¡¨è®¾è®¡</p><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `admin_log` (  `id` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) unsigned <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,  `user_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `path` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `<span class="hljs-keyword">method</span>` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `ip` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `input` text <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  `created_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci ROW_FORMAT<span class="hljs-operator">=</span><span class="hljs-keyword">DYNAMIC</span>;</code></pre></div><p>æ–°å»ºä¸­é—´ä»¶AdminLogMiddlewareï¼Œåœ¨åå°è·¯ç”±ä¸­åŠ å…¥æ­¤ä¸­é—´ä»¶å³å¯ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Author: sai</span><span class="hljs-comment"> * Date: 2020/4/1</span><span class="hljs-comment"> * Time: 16:19</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Middleware</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>\<span class="hljs-title">OperationLogJob</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Closure</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Auth</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminLogMiddleware</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å¤„ç†ä¼ å…¥çš„å‚æ•°</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Illuminate\Http\Request  $request</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Closure  $next</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  string  $role</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"><span class="hljs-variable">$request</span>, <span class="hljs-built_in">Closure</span> <span class="hljs-variable">$next</span>, <span class="hljs-variable">$role</span></span>)</span><span class="hljs-function">    </span>&#123;<span class="hljs-comment">// å‰”é™¤GETï¼ŒOPTIONSè¯·æ±‚</span>        <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$method</span> = <span class="hljs-variable">$request</span>-&gt;getMethod(), [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;OPTIONS&#x27;</span>])) &#123;            <span class="hljs-variable">$data</span> = [                <span class="hljs-string">&#x27;user_id&#x27;</span> =&gt; Auth::guard(<span class="hljs-string">&#x27;admin&#x27;</span>)-&gt;id(),                <span class="hljs-string">&#x27;path&#x27;</span> =&gt; <span class="hljs-variable">$request</span>-&gt;getPathInfo(),                <span class="hljs-string">&#x27;method&#x27;</span> =&gt; <span class="hljs-variable">$method</span>,                <span class="hljs-string">&#x27;ip&#x27;</span> =&gt; <span class="hljs-variable">$request</span>-&gt;getClientIp(),                <span class="hljs-string">&#x27;input&#x27;</span> =&gt; \json_encode(<span class="hljs-variable">$request</span>-&gt;all(), JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP | JSON_UNESCAPED_UNICODE),            ];<span class="hljs-comment">// å¼‚æ­¥å†™å…¥ï¼Œæé«˜æ“ä½œæµç•…æ€§</span>            <span class="hljs-variable">$job</span> = (<span class="hljs-keyword">new</span> OperationLogJob(<span class="hljs-variable">$data</span>));            dispatch(<span class="hljs-variable">$job</span>);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$next</span>(<span class="hljs-variable">$request</span>);    &#125;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Jobs</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">AdminLog</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Dispatchable</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">SerializesModels</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OperationLogJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">use</span> <span class="hljs-title">Dispatchable</span>, <span class="hljs-title">InteractsWithQueue</span>, <span class="hljs-title">Queueable</span>, <span class="hljs-title">SerializesModels</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Create a new job instance.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">//</span>        <span class="hljs-keyword">$this</span>-&gt;queue = <span class="hljs-string">&#x27;adminLog&#x27;</span>;        <span class="hljs-keyword">$this</span>-&gt;data = <span class="hljs-variable">$data</span>;    &#125;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$data</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Execute the job.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">//</span>        AdminLog::create(<span class="hljs-keyword">$this</span>-&gt;data);    &#125;&#125;</code></pre></div><p>æ‰§è¡Œé˜Ÿåˆ—ï¼š</p><div class="code-wrapper"><pre><code class="hljs cpp">php artisan queue:work --queue=adminLog</code></pre></div><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸å†™å…¥æ•°æ®åº“ï¼Œå†™åœ¨logæ–‡ä»¶é‡Œï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œä¹Ÿå¯ä»¥ç»™åå°ç»Ÿä¸€åŠ å…¥AdminLogMiddlewareä¸­é—´ä»¶ï¼ŒæŠŠä¸éœ€è¦åšè®°å½•çš„è·¯ç”±åŠ å…¥é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸­é—´ä»¶åŠ å…¥åˆ¤æ–­ï¼Œçœå»åœ¨è·¯ç”±é…ç½®å»åŒºåˆ†æ˜¯å¦éœ€è¦è®°å½•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElementUIä¸­tableè¡¨æ ¼è‡ªå®šä¹‰è¡¨å¤´Tooltipæ–‡å­—æç¤º</title>
    <link href="/2020/04/29/247/"/>
    <url>/2020/04/29/247/</url>
    
    <content type="html"><![CDATA[<p>tableè¡¨æ ¼éœ€è¦å¢åŠ æç¤ºæ–‡æ¡ˆè¯´æ˜ï¼Œæ²¡æœ‰ç°æˆçš„å±æ€§æ·»åŠ ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>render-header</code>æ¥æ¸²æŸ“è¡¨å¤´ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs handlebars"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;ä»·æ ¼&quot;</span></span></span><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">:render-header</span>=<span class="hljs-string">&quot;renderTipsHeader&quot;</span></span></span><span class="hljs-tag"><span class="xml">      &gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><span class="xml">          </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">scope.row.amount</span> &#125;&#125;</span><span class="xml"></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span></code></pre></div><p>renderTipsHeaderï¼š</p><div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">renderTipsHeader</span> (h,&#123;<span class="hljs-selector-tag">column</span>&#125;) &#123;      <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">h</span>(        <span class="hljs-string">&#x27;div&#x27;</span>,[              h(<span class="hljs-string">&#x27;span&#x27;</span>, column.label),             h(<span class="hljs-string">&#x27;el-tooltip&#x27;</span>,&#123;ã€€ã€€ã€€ã€€      <span class="hljs-attribute">props</span>:&#123;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="hljs-attribute">effect</span>:<span class="hljs-string">&#x27;dark&#x27;</span>,ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="hljs-attribute">content</span>:<span class="hljs-string">&#x27;æç¤ºæ–‡æ¡ˆ&#x27;</span>,ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="hljs-attribute">placement</span>:<span class="hljs-string">&#x27;top&#x27;</span>ã€€ã€€ã€€ã€€ã€€ã€€&#125;,ã€€ã€€ã€€ ã€€ã€€ã€€ã€€ &#125;,[                 h(<span class="hljs-string">&#x27;i&#x27;</span>, &#123;                     <span class="hljs-attribute">class</span>:<span class="hljs-string">&#x27;el-icon-question&#x27;</span>,                     <span class="hljs-attribute">style</span>:<span class="hljs-string">&#x27;color:#409EFF;margin-left:5px;&#x27;</span>                 &#125;)            ])        ]    ); &#125;</code></pre></div><p>æ•ˆæœå¦‚å›¾ï¼š<br><img src="https://cdn.learnku.com/uploads/images/202004/29/41489/I9iAzrrrkU.png!large"></p><div class="code-wrapper"><pre><code class="hljs stylus">render-<span class="hljs-selector-tag">header</span> åˆ—æ ‡é¢˜ Label åŒºåŸŸæ¸²æŸ“ä½¿ç”¨çš„ Function <span class="hljs-function"><span class="hljs-title">Function</span><span class="hljs-params">(h, &#123; column, <span class="hljs-variable">$index</span> &#125;)</span></span></code></pre></div><p>æ„Ÿå…´è¶£å¯ä»¥æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼Œè¿™é‡Œè¿˜æœ‰æ›´å¤æ‚çš„åº”ç”¨â€“<a href="https://github.com/Darkerxi/ElementUI-Table-column_render-header">https://github.com/Darkerxi/ElementUI-Table-column_render-header</a></p><hr><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://www.cnblogs.com/jmwlhj/p/11004378.html" title="element-uiè‡ªå®šä¹‰tableè¡¨å¤´ï¼Œä¿®æ”¹æ ‡é¢˜æ ·å¼ã€æ·»åŠ tooltipåŠ :render-headerä½¿ç”¨ç®€ä»‹">element-uiè‡ªå®šä¹‰tableè¡¨å¤´ï¼Œä¿®æ”¹æ ‡é¢˜æ ·å¼ã€æ·»åŠ tooltipåŠ :render-headerä½¿ç”¨ç®€ä»‹</a></p>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElementUI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†äº«æŒ‰æ—¥æ‰§è¡Œçš„è„šæœ¬</title>
    <link href="/2020/04/25/246/"/>
    <url>/2020/04/25/246/</url>
    
    <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­è¦åšä¸€äº›æŒ‰æ—¥è¿›è¡Œçš„ç»Ÿè®¡ï¼Œä¹‹å‰çš„ä»»åŠ¡éƒ½æ²¡è·‘ï¼Œå†™ä¸ªè„šæœ¬æ‰§è¡Œä¸‹ã€‚</p><p>plus.sh</p><div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span>START_DATE=<span class="hljs-variable">$1</span>END_DATE=<span class="hljs-variable">$2</span>EXEC_COMMAND=<span class="hljs-variable">$3</span><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;start_date: &#x27;</span><span class="hljs-variable">$START_DATE</span><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;end_date: &#x27;</span><span class="hljs-variable">$END_DATE</span>i=<span class="hljs-variable">$START_DATE</span><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$i</span> &lt; `date -d <span class="hljs-string">&quot;+1 day <span class="hljs-variable">$END_DATE</span>&quot;</span> +%Y%m%d` ]]  <span class="hljs-keyword">do</span>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span>    <span class="hljs-variable">$EXEC_COMMAND</span> <span class="hljs-variable">$i</span>    i=`date -d <span class="hljs-string">&quot;+1 day <span class="hljs-variable">$i</span>&quot;</span> +%Y%m%d`<span class="hljs-keyword">done</span></code></pre></div><p>æ‰§è¡Œ</p><blockquote><p>./plus.sh 2020-03-01 2020-04-24 â€˜php artisan command:testâ€™</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>shell</category>
      
    </categories>
    
    
    <tags>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravelé…åˆMaatwebsiteExcelå®ç°Excelå¯¼å…¥</title>
    <link href="/2020/04/05/245/"/>
    <url>/2020/04/05/245/</url>
    
    <content type="html"><![CDATA[<p>å‰ä¸€æ®µéœ€è¦é¡¹ç›®ä¸­éœ€è¦é€šè¿‡Excelå¯¼å…¥ç”¨æˆ·ï¼Œä¹‹å‰ç”¨è¿‡phpexcelï¼Œæ€»æ„Ÿè§‰å¤ªè¿‡ç¹çï¼Œå°è±¡ä¸­phpexcelä¹Ÿå¾ˆä¹…æ²¡æ›´æ–°ï¼Œçœ‹åˆ°é¡¹ç›®ä¸­æœ‰ä½¿ç”¨<code>Maatwebsite\Excel</code>ï¼Œä¾¿å°è¯•ä½¿ç”¨ä¸€ä¸‹ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><div class="code-wrapper"><pre><code class="hljs armasm"><span class="hljs-symbol">composer</span> <span class="hljs-meta">require</span> maatwebsite/excel</code></pre></div><h2 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h2><h3 id="ç”Ÿæˆå¯¼å…¥ç±»"><a href="#ç”Ÿæˆå¯¼å…¥ç±»" class="headerlink" title="ç”Ÿæˆå¯¼å…¥ç±»"></a>ç”Ÿæˆå¯¼å…¥ç±»</h3><div class="code-wrapper"><pre><code class="hljs elm"><span class="hljs-title">php</span> artisan make:<span class="hljs-keyword">import</span> AdminsImport <span class="hljs-comment">--model=Admin</span></code></pre></div><p>ä¼šçœ‹åˆ°appä¸‹é¢ç”Ÿæˆäº†Importsæ–‡ä»¶å¤¹ã€‚</p><h3 id="å®Œå–„ä¸šåŠ¡é€»è¾‘"><a href="#å®Œå–„ä¸šåŠ¡é€»è¾‘" class="headerlink" title="å®Œå–„ä¸šåŠ¡é€»è¾‘"></a>å®Œå–„ä¸šåŠ¡é€»è¾‘</h3><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Imports</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Admin</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">function</span> <span class="hljs-title">EasyWeChat</span>\<span class="hljs-title">Kernel</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">str_random</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Concerns</span>\<span class="hljs-title">ToModel</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminsImport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ToModel</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> array $row</span><span class="hljs-comment">    *</span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> \Illuminate\Database\Eloquent\Model|null</span><span class="hljs-comment">    */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">model</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$row</span></span>)</span><span class="hljs-function">    </span>&#123;<span class="hljs-comment">//è¿‡æ»¤è¡¨å¤´å’Œç©ºè¡Œï¼Œæˆ‘è¿™è¾¹è¡¨å¤´çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼æ˜¯idï¼Œå…·ä½“è‡ªè¡Œè°ƒæ•´</span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>]) || <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;id&#x27;</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Admin([            <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>],            <span class="hljs-string">&#x27;password&#x27;</span> =&gt; bcrypt(<span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>]),            <span class="hljs-string">&#x27;api_token&#x27;</span> =&gt; str_random(<span class="hljs-number">60</span>),        ]);    &#125;&#125;</code></pre></div><h3 id="å¯¼å…¥ä»»åŠ¡"><a href="#å¯¼å…¥ä»»åŠ¡" class="headerlink" title="å¯¼å…¥ä»»åŠ¡"></a>å¯¼å…¥ä»»åŠ¡</h3><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Commands</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Imports</span>\<span class="hljs-title">AdminsImport</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Command</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Excel</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImportAdmin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Command</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * The name and signature of the console command.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@var</span> string</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$signature</span> = <span class="hljs-string">&#x27;importAdmin&#x27;</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * The console command description.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@var</span> string</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$description</span> = <span class="hljs-string">&#x27;å¯¼å…¥admin&#x27;</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Create a new command instance.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-built_in">parent</span>::__construct();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Execute the console command.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        Excel::import(<span class="hljs-keyword">new</span> AdminsImport(), storage_path(<span class="hljs-string">&#x27;files/export.xlsx&#x27;</span>));<span class="hljs-keyword">$this</span>-&gt;info(<span class="hljs-keyword">$this</span>-&gt;description.<span class="hljs-string">&#x27;å®Œæˆ&#x27;</span>);&#125;&#125;</code></pre></div><h3 id="å…¶ä»–é€»è¾‘"><a href="#å…¶ä»–é€»è¾‘" class="headerlink" title="å…¶ä»–é€»è¾‘"></a>å…¶ä»–é€»è¾‘</h3><p>å½“ç„¶ï¼Œå¯èƒ½ä¸šåŠ¡å¿…ä¸ä»…ä»…æ˜¯å†™å…¥æ•°æ®ï¼Œå¯èƒ½æœ‰ä¸€äº›è®¾è®¡å…·ä½“ä¸šåŠ¡çš„æ“ä½œï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™æ ·æ“ä½œã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Imports</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Admin</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">function</span> <span class="hljs-title">EasyWeChat</span>\<span class="hljs-title">Kernel</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">str_random</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Concerns</span>\<span class="hljs-title">ToCollection</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Collection</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminsImport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ToCollection</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">collection</span>(<span class="hljs-params">Collection <span class="hljs-variable">$rows</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">//å¦‚æœéœ€è¦å»é™¤è¡¨å¤´</span>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$rows</span>[<span class="hljs-number">0</span>]);        <span class="hljs-comment">//$rows æ˜¯æ•°ç»„æ ¼å¼</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;createData(<span class="hljs-variable">$rows</span>);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createData</span>(<span class="hljs-params"><span class="hljs-variable">$rows</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$success</span> = <span class="hljs-number">0</span>;        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$rows</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) &#123;            <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>] = (<span class="hljs-keyword">int</span>) <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>];            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>])) &#123;                <span class="hljs-keyword">continue</span>;            &#125;            (<span class="hljs-keyword">new</span> Admin())-&gt;create(                [                    <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>],                    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>],                    <span class="hljs-string">&#x27;password&#x27;</span> =&gt; bcrypt(<span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>]),                    <span class="hljs-string">&#x27;api_token&#x27;</span> =&gt; str_random(<span class="hljs-number">60</span>),                ]            );            <span class="hljs-comment">// å…¶ä»–ä¸šåŠ¡ä»£ç </span>            <span class="hljs-variable">$success</span>++;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$success</span>.<span class="hljs-string">&#x27;-&#x27;</span>.count(<span class="hljs-variable">$rows</span>);    &#125;&#125;</code></pre></div><h2 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h2><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">php7</span>.<span class="hljs-number">2</span> artisan importAdmin</code></pre></div><p>æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨èµ·æ¥è¿˜æ˜¯ç®€å•æ˜äº†çš„ã€‚</p><h2 id="more"><a href="#more" class="headerlink" title="more"></a>more</h2><p>å…·ä½“å¯¼å…¥å®ç°å¯ä»¥æœç´¢<code>Maatwebsite\Excel\Excel</code>æŸ¥çœ‹ï¼Œé‡Œé¢è¿˜æœ‰å¯¼å‡ºã€ä»¥é˜Ÿåˆ—æ–¹å¼å¯¼å…¥ç­‰ï¼Œæ”¯æŒçš„æ ¼å¼ä¹Ÿæ˜¯å¤šç§å¤šæ ·ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼ŒåŠŸèƒ½è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œè¶³å¤Ÿåº”ä»˜æ—¥å¸¸éœ€æ±‚äº†ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Collection</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Files</span>\<span class="hljs-title">Filesystem</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Files</span>\<span class="hljs-title">TemporaryFile</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">PendingDispatch</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Maatwebsite</span>\<span class="hljs-title">Excel</span>\<span class="hljs-title">Helpers</span>\<span class="hljs-title">FileTypeDetector</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Excel</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Exporter</span>, <span class="hljs-title">Importer</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">use</span> <span class="hljs-title">RegistersCustomConcerns</span>;    <span class="hljs-keyword">const</span> XLSX     = <span class="hljs-string">&#x27;Xlsx&#x27;</span>;    <span class="hljs-keyword">const</span> CSV      = <span class="hljs-string">&#x27;Csv&#x27;</span>;    <span class="hljs-keyword">const</span> TSV      = <span class="hljs-string">&#x27;Csv&#x27;</span>;    <span class="hljs-keyword">const</span> ODS      = <span class="hljs-string">&#x27;Ods&#x27;</span>;    <span class="hljs-keyword">const</span> XLS      = <span class="hljs-string">&#x27;Xls&#x27;</span>;    <span class="hljs-keyword">const</span> SLK      = <span class="hljs-string">&#x27;Slk&#x27;</span>;    <span class="hljs-keyword">const</span> XML      = <span class="hljs-string">&#x27;Xml&#x27;</span>;    <span class="hljs-keyword">const</span> GNUMERIC = <span class="hljs-string">&#x27;Gnumeric&#x27;</span>;    <span class="hljs-keyword">const</span> HTML     = <span class="hljs-string">&#x27;Html&#x27;</span>;    <span class="hljs-keyword">const</span> MPDF     = <span class="hljs-string">&#x27;Mpdf&#x27;</span>;    <span class="hljs-keyword">const</span> DOMPDF   = <span class="hljs-string">&#x27;Dompdf&#x27;</span>;    <span class="hljs-keyword">const</span> TCPDF    = <span class="hljs-string">&#x27;Tcpdf&#x27;</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@var</span> Writer</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$writer</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@var</span> QueuedWriter</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$queuedWriter</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@var</span> Filesystem</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filesystem</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@var</span> Reader</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$reader</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> Writer       $writer</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> QueuedWriter $queuedWriter</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> Reader       $reader</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> Filesystem   $filesystem</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span></span><span class="hljs-params"><span class="hljs-function">        Writer <span class="hljs-variable">$writer</span>,</span></span><span class="hljs-params"><span class="hljs-function">        QueuedWriter <span class="hljs-variable">$queuedWriter</span>,</span></span><span class="hljs-params"><span class="hljs-function">        Reader <span class="hljs-variable">$reader</span>,</span></span><span class="hljs-params"><span class="hljs-function">        Filesystem <span class="hljs-variable">$filesystem</span></span></span><span class="hljs-params"><span class="hljs-function">    </span>) </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;writer       = <span class="hljs-variable">$writer</span>;        <span class="hljs-keyword">$this</span>-&gt;reader       = <span class="hljs-variable">$reader</span>;        <span class="hljs-keyword">$this</span>-&gt;filesystem   = <span class="hljs-variable">$filesystem</span>;        <span class="hljs-keyword">$this</span>-&gt;queuedWriter = <span class="hljs-variable">$queuedWriter</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">download</span>(<span class="hljs-params"><span class="hljs-variable">$export</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$fileName</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$writerType</span> = <span class="hljs-literal">null</span>, <span class="hljs-keyword">array</span> <span class="hljs-variable">$headers</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> response()-&gt;download(            <span class="hljs-keyword">$this</span>-&gt;export(<span class="hljs-variable">$export</span>, <span class="hljs-variable">$fileName</span>, <span class="hljs-variable">$writerType</span>)-&gt;getLocalPath(),            <span class="hljs-variable">$fileName</span>,            <span class="hljs-variable">$headers</span>        )-&gt;deleteFileAfterSend(<span class="hljs-literal">true</span>);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params"><span class="hljs-variable">$export</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$filePath</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$diskName</span> = <span class="hljs-literal">null</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$writerType</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$diskOptions</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$export</span> <span class="hljs-keyword">instanceof</span> ShouldQueue) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;queue(<span class="hljs-variable">$export</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$diskName</span>, <span class="hljs-variable">$writerType</span>, <span class="hljs-variable">$diskOptions</span>);        &#125;        <span class="hljs-variable">$temporaryFile</span> = <span class="hljs-keyword">$this</span>-&gt;export(<span class="hljs-variable">$export</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$writerType</span>);        <span class="hljs-variable">$exported</span> = <span class="hljs-keyword">$this</span>-&gt;filesystem-&gt;disk(<span class="hljs-variable">$diskName</span>, <span class="hljs-variable">$diskOptions</span>)-&gt;copy(            <span class="hljs-variable">$temporaryFile</span>,            <span class="hljs-variable">$filePath</span>        );        <span class="hljs-variable">$temporaryFile</span>-&gt;delete();        <span class="hljs-keyword">return</span> <span class="hljs-variable">$exported</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">queue</span>(<span class="hljs-params"><span class="hljs-variable">$export</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$filePath</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$disk</span> = <span class="hljs-literal">null</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$writerType</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$diskOptions</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$writerType</span> = FileTypeDetector::detectStrict(<span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$writerType</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;queuedWriter-&gt;store(            <span class="hljs-variable">$export</span>,            <span class="hljs-variable">$filePath</span>,            <span class="hljs-variable">$disk</span>,            <span class="hljs-variable">$writerType</span>,            <span class="hljs-variable">$diskOptions</span>        );    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">raw</span>(<span class="hljs-params"><span class="hljs-variable">$export</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$writerType</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$temporaryFile</span> = <span class="hljs-keyword">$this</span>-&gt;writer-&gt;export(<span class="hljs-variable">$export</span>, <span class="hljs-variable">$writerType</span>);        <span class="hljs-variable">$contents</span> = <span class="hljs-variable">$temporaryFile</span>-&gt;contents();        <span class="hljs-variable">$temporaryFile</span>-&gt;delete();        <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">import</span>(<span class="hljs-params"><span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$disk</span> = <span class="hljs-literal">null</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$readerType</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$readerType</span> = FileTypeDetector::detect(<span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$readerType</span>);        <span class="hljs-variable">$response</span>   = <span class="hljs-keyword">$this</span>-&gt;reader-&gt;read(<span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$readerType</span>, <span class="hljs-variable">$disk</span>);        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> PendingDispatch) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toArray</span>(<span class="hljs-params"><span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$disk</span> = <span class="hljs-literal">null</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$readerType</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">array</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$readerType</span> = FileTypeDetector::detect(<span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$readerType</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;reader-&gt;toArray(<span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$readerType</span>, <span class="hljs-variable">$disk</span>);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toCollection</span>(<span class="hljs-params"><span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$disk</span> = <span class="hljs-literal">null</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$readerType</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">Collection</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$readerType</span> = FileTypeDetector::detect(<span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$readerType</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;reader-&gt;toCollection(<span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$readerType</span>, <span class="hljs-variable">$disk</span>);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@inheritdoc</span>&#125;</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">queueImport</span>(<span class="hljs-params">ShouldQueue <span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$disk</span> = <span class="hljs-literal">null</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$readerType</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;import(<span class="hljs-variable">$import</span>, <span class="hljs-variable">$filePath</span>, <span class="hljs-variable">$disk</span>, <span class="hljs-variable">$readerType</span>);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> object      $export</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string|null $fileName</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string      $writerType</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> \PhpOffice\PhpSpreadsheet\Exception</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> TemporaryFile</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">export</span>(<span class="hljs-params"><span class="hljs-variable">$export</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$fileName</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$writerType</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">TemporaryFile</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$writerType</span> = FileTypeDetector::detectStrict(<span class="hljs-variable">$fileName</span>, <span class="hljs-variable">$writerType</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;writer-&gt;export(<span class="hljs-variable">$export</span>, <span class="hljs-variable">$writerType</span>);    &#125;&#125;</code></pre></div><p>æœ€åï¼Œæ„Ÿè°¢ä¸‹é¢è¿™ä¸€ç¯‡ç«™å†…æ–‡ç« è®©æˆ‘å¿«é€Ÿä¸Šæ‰‹ã€‚</p><ul><li><a href="https://learnku.com/articles/32400" title="maatwebsite/Excel 3.1 ä½¿ç”¨æ•™ç¨‹ ï¼ˆå¯¼å…¥ç¯‡ï¼‰">maatwebsite/Excel 3.1 ä½¿ç”¨æ•™ç¨‹ ï¼ˆå¯¼å…¥ç¯‡ï¼‰</a></li></ul><p>æœ€åï¼Œé™„ä¸ŠLaravel Excel æ–‡æ¡£ï¼š</p><ul><li><a href="https://docs.laravel-excel.com/3.1/getting-started/" title="Laravel Excel">Laravel Excel</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goçš„ç±»å‹è½¬æ¢</title>
    <link href="/2020/03/29/243/"/>
    <url>/2020/03/29/243/</url>
    
    <content type="html"><![CDATA[<p>ç±»å‹è½¬æ¢æ˜¯ç»å¸¸ä½¿ç”¨åˆ°çš„ï¼Œæ±‡æ€»äº†ä¸€äº›æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•ï¼Œåˆ†äº«ç»™ä½ ï½</p><div class="code-wrapper"><pre><code class="hljs nim">package main/**å˜é‡ç±»å‹è½¬æ¢*/<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;reflect&quot;</span><span class="hljs-string">&quot;strconv&quot;</span>)<span class="hljs-keyword">func</span> main() &#123;    v := <span class="hljs-string">&quot;hello world&quot;</span>    fmt.<span class="hljs-type">Println</span>(typeofFmt(v))fmt.<span class="hljs-type">Println</span>(typeofReflect(v))str := <span class="hljs-string">&quot;1245&quot;</span>fmt.<span class="hljs-type">Println</span>(stringToInt(str))fmt.<span class="hljs-type">Println</span>(stringToInt64(str))a := <span class="hljs-number">3545</span>;<span class="hljs-keyword">var</span> b <span class="hljs-built_in">int64</span>;b = <span class="hljs-number">98</span>;fmt.<span class="hljs-type">Println</span>(int64ToString(b))fmt.<span class="hljs-type">Println</span>(intToString(a))<span class="hljs-keyword">var</span> f <span class="hljs-built_in">float64</span>f = <span class="hljs-number">3</span>.<span class="hljs-number">45</span>fmt.<span class="hljs-type">Println</span>(floatToString(f))str = <span class="hljs-string">&quot;1.24&quot;</span>fmt.<span class="hljs-type">Println</span>(stringToFloat(str))//<span class="hljs-built_in">int</span>åˆ°<span class="hljs-built_in">int64</span>fmt.<span class="hljs-type">Println</span>(<span class="hljs-built_in">int64</span>(<span class="hljs-number">1234</span>))//<span class="hljs-built_in">int</span> è½¬åŒ–ä¸º <span class="hljs-built_in">float</span>score := <span class="hljs-number">100</span>fmt.<span class="hljs-type">Println</span>(<span class="hljs-built_in">float64</span>(score))&#125;// åˆ©ç”¨fmt<span class="hljs-keyword">func</span> typeofFmt(v <span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-built_in">string</span> &#123;    <span class="hljs-keyword">return</span> fmt.<span class="hljs-type">Sprintf</span>(<span class="hljs-string">&quot;%T&quot;</span>, v)&#125;// åˆ©ç”¨reflect<span class="hljs-keyword">func</span> typeofReflect(v <span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-built_in">string</span> &#123;    <span class="hljs-keyword">return</span> reflect.<span class="hljs-type">TypeOf</span>(v).<span class="hljs-type">String</span>()&#125;// <span class="hljs-built_in">string</span>è½¬<span class="hljs-built_in">int</span><span class="hljs-keyword">func</span> stringToInt(a <span class="hljs-built_in">string</span>) <span class="hljs-built_in">int</span> &#123;d,_ := strconv.<span class="hljs-type">Atoi</span>(a)<span class="hljs-keyword">return</span>  d&#125;//<span class="hljs-type">Atoi</span>æ˜¯<span class="hljs-type">ParseInt</span>(s, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>)çš„ç®€å†™ã€‚// <span class="hljs-built_in">string</span>è½¬<span class="hljs-built_in">int64</span><span class="hljs-keyword">func</span> stringToInt64(a <span class="hljs-built_in">string</span>) <span class="hljs-built_in">int64</span> &#123;d, _ := strconv.<span class="hljs-type">ParseInt</span>(a, <span class="hljs-number">10</span>, <span class="hljs-number">64</span>) <span class="hljs-keyword">return</span>  d&#125;/**<span class="hljs-keyword">func</span> <span class="hljs-type">ParseInt</span>(s <span class="hljs-built_in">string</span>, base <span class="hljs-built_in">int</span>, bitSize <span class="hljs-built_in">int</span>) (i <span class="hljs-built_in">int64</span>, err error)è¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•´æ•°å€¼ï¼Œæ¥å—æ­£è´Ÿå·ã€‚baseæŒ‡å®šè¿›åˆ¶ï¼ˆ<span class="hljs-number">2</span>åˆ°<span class="hljs-number">36</span>ï¼‰ï¼Œå¦‚æœbaseä¸º<span class="hljs-number">0</span>ï¼Œåˆ™ä¼šä»å­—ç¬¦ä¸²å‰ç½®åˆ¤æ–­ï¼Œ<span class="hljs-string">&quot;0x&quot;</span>æ˜¯<span class="hljs-number">16</span>è¿›åˆ¶ï¼Œ<span class="hljs-string">&quot;0&quot;</span>æ˜¯<span class="hljs-number">8</span>è¿›åˆ¶ï¼Œå¦åˆ™æ˜¯<span class="hljs-number">10</span>è¿›åˆ¶ï¼›bitSizeæŒ‡å®šç»“æœå¿…é¡»èƒ½æ— æº¢å‡ºèµ‹å€¼çš„æ•´æ•°ç±»å‹ï¼Œ<span class="hljs-number">0</span>ã€<span class="hljs-number">8</span>ã€<span class="hljs-number">16</span>ã€<span class="hljs-number">32</span>ã€<span class="hljs-number">64</span> åˆ†åˆ«ä»£è¡¨ <span class="hljs-built_in">int</span>ã€<span class="hljs-built_in">int8</span>ã€<span class="hljs-built_in">int16</span>ã€<span class="hljs-built_in">int32</span>ã€<span class="hljs-built_in">int64</span>ï¼›è¿”å›çš„erræ˜¯*<span class="hljs-type">NumErr</span>ç±»å‹çš„ï¼Œå¦‚æœè¯­æ³•æœ‰è¯¯ï¼Œerr.<span class="hljs-type">Error</span> = <span class="hljs-type">ErrSyntax</span>ï¼›å¦‚æœç»“æœè¶…å‡ºç±»å‹èŒƒå›´err.<span class="hljs-type">Error</span> = <span class="hljs-type">ErrRange</span>ã€‚*/// <span class="hljs-built_in">int</span>è½¬<span class="hljs-built_in">string</span><span class="hljs-keyword">func</span> intToString(a <span class="hljs-built_in">int</span>) <span class="hljs-built_in">string</span> &#123;str := strconv.<span class="hljs-type">Itoa</span>(a) <span class="hljs-keyword">return</span> str&#125;// <span class="hljs-built_in">int64</span>è½¬<span class="hljs-built_in">string</span><span class="hljs-keyword">func</span> int64ToString(a <span class="hljs-built_in">int64</span>) <span class="hljs-built_in">string</span> &#123;str := strconv.<span class="hljs-type">FormatInt</span>(a,<span class="hljs-number">10</span>)<span class="hljs-keyword">return</span> str&#125;/**<span class="hljs-keyword">func</span> <span class="hljs-type">FormatInt</span>(i <span class="hljs-built_in">int64</span>, base <span class="hljs-built_in">int</span>) <span class="hljs-built_in">string</span>è¿”å›içš„baseè¿›åˆ¶çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚base å¿…é¡»åœ¨<span class="hljs-number">2</span>åˆ°<span class="hljs-number">36</span>ä¹‹é—´ï¼Œç»“æœä¸­ä¼šä½¿ç”¨å°å†™å­—æ¯&#x27;a&#x27;åˆ°&#x27;z&#x27;è¡¨ç¤ºå¤§äº<span class="hljs-number">10</span>çš„æ•°å­—ã€‚*/// <span class="hljs-built_in">float</span>è½¬<span class="hljs-built_in">string</span><span class="hljs-keyword">func</span> floatToString (f <span class="hljs-built_in">float64</span>) <span class="hljs-built_in">string</span> &#123;<span class="hljs-keyword">return</span> strconv.<span class="hljs-type">FormatFloat</span>(f,&#x27;f&#x27;,-<span class="hljs-number">1</span>,<span class="hljs-number">32</span>)&#125;/**<span class="hljs-keyword">func</span> <span class="hljs-type">FormatFloat</span>(f <span class="hljs-built_in">float64</span>, fmt byte, prec, bitSize <span class="hljs-built_in">int</span>) <span class="hljs-built_in">string</span>bitSizeè¡¨ç¤ºfçš„æ¥æºç±»å‹ï¼ˆ<span class="hljs-number">32</span>ï¼š<span class="hljs-built_in">float32</span>ã€<span class="hljs-number">64</span>ï¼š<span class="hljs-built_in">float64</span>ï¼‰ï¼Œä¼šæ®æ­¤è¿›è¡Œèˆå…¥ã€‚fmtè¡¨ç¤ºæ ¼å¼ï¼š&#x27;f&#x27;ï¼ˆ-ddd.ddddï¼‰ã€&#x27;b&#x27;ï¼ˆ-ddddpÂ±dddï¼ŒæŒ‡æ•°ä¸ºäºŒè¿›åˆ¶ï¼‰ã€&#x27;e&#x27;ï¼ˆ-d.ddddeÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€&#x27;E&#x27;ï¼ˆ-d.ddddEÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€&#x27;g&#x27;ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨&#x27;e&#x27;æ ¼å¼ï¼Œå¦åˆ™&#x27;f&#x27;æ ¼å¼ï¼‰ã€&#x27;G&#x27;ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨&#x27;E&#x27;æ ¼å¼ï¼Œå¦åˆ™&#x27;f&#x27;æ ¼å¼ï¼‰ã€‚precæ§åˆ¶ç²¾åº¦ï¼ˆæ’é™¤æŒ‡æ•°éƒ¨åˆ†ï¼‰ï¼šå¯¹&#x27;f&#x27;ã€&#x27;e&#x27;ã€&#x27;E&#x27;ï¼Œå®ƒè¡¨ç¤ºå°æ•°ç‚¹åçš„æ•°å­—ä¸ªæ•°ï¼›å¯¹&#x27;g&#x27;ã€&#x27;G&#x27;ï¼Œå®ƒæ§åˆ¶æ€»çš„æ•°å­—ä¸ªæ•°ã€‚å¦‚æœprec ä¸º-<span class="hljs-number">1</span>ï¼Œåˆ™ä»£è¡¨ä½¿ç”¨æœ€å°‘æ•°é‡çš„ã€ä½†åˆå¿…éœ€çš„æ•°å­—æ¥è¡¨ç¤ºfã€‚*/// <span class="hljs-built_in">string</span>è½¬<span class="hljs-built_in">float</span><span class="hljs-keyword">func</span> stringToFloat(s <span class="hljs-built_in">string</span>) <span class="hljs-built_in">float64</span> &#123;f,_ := strconv.<span class="hljs-type">ParseFloat</span>(s,<span class="hljs-number">64</span>)<span class="hljs-keyword">return</span> f&#125;/**<span class="hljs-keyword">func</span> <span class="hljs-type">ParseFloat</span>(s <span class="hljs-built_in">string</span>, bitSize <span class="hljs-built_in">int</span>) (f <span class="hljs-built_in">float64</span>, err error)è§£æä¸€ä¸ªè¡¨ç¤ºæµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²å¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœsåˆä¹è¯­æ³•è§„åˆ™ï¼Œå‡½æ•°ä¼šè¿”å›æœ€ä¸ºæ¥è¿‘sè¡¨ç¤ºå€¼çš„ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆä½¿ç”¨<span class="hljs-type">IEEE754</span>è§„èŒƒèˆå…¥ï¼‰ã€‚bitSizeæŒ‡å®šäº†æœŸæœ›çš„æ¥æ”¶ç±»å‹ï¼Œ<span class="hljs-number">32</span>æ˜¯<span class="hljs-built_in">float32</span>ï¼ˆè¿”å›å€¼å¯ä»¥ä¸æ”¹å˜ç²¾ç¡®å€¼çš„èµ‹å€¼ç»™<span class="hljs-built_in">float32</span>ï¼‰ï¼Œ<span class="hljs-number">64</span>æ˜¯<span class="hljs-built_in">float64</span>ï¼›è¿”å›å€¼erræ˜¯*<span class="hljs-type">NumErr</span>ç±»å‹çš„ï¼Œè¯­æ³•æœ‰è¯¯çš„ï¼Œerr.<span class="hljs-type">Error</span>=<span class="hljs-type">ErrSyntax</span>ï¼›ç»“æœè¶…å‡ºè¡¨ç¤ºèŒƒå›´çš„ï¼Œè¿”å›å€¼fä¸ºÂ±<span class="hljs-type">Inf</span>ï¼Œerr.<span class="hljs-type">Error</span>= <span class="hljs-type">ErrRange</span>ã€‚*/</code></pre></div><p>æ›´å¤šç±»å‹è½¬æ¢ç›¸å…³å¯æŸ¥çœ‹æ ‡å‡†åº“ï¼š<br>-Â <a href="https://studygolang.com/pkgdoc" title="strconv">strconv</a></p><hr><p>æŠ€æœ¯æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨è‡ªå·±çš„å…¬ä¼—å·ã€çˆ±å¥½å†å²çš„ç¨‹åºå‘˜ã€‘ï¼Œæ¬¢è¿æ‰«ç å…³æ³¨ï¼Œè°¢è°¢ï¼</p><p><img src="https://cdn.learnku.com/uploads/images/201912/01/41489/1DaPm3bQeT.png!large" alt="çˆ±å¥½å†å²çš„ç¨‹åºå‘˜"></p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså¸¸ç”¨ç±»å‹åŠåº”ç”¨åœºæ™¯</title>
    <link href="/2020/03/22/230/"/>
    <url>/2020/03/22/230/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸»è¦ç±»å‹"><a href="#ä¸»è¦ç±»å‹" class="headerlink" title="ä¸»è¦ç±»å‹"></a>ä¸»è¦ç±»å‹</h2><ul><li>å­—ç¬¦ä¸²ï¼ˆstringsï¼Œbitmapsï¼‰</li><li>æ•£åˆ—ï¼ˆhashesï¼‰</li><li>åˆ—è¡¨ï¼ˆlistsï¼‰</li><li>é›†åˆï¼ˆsetsï¼‰</li><li>æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ </li><li>hyperloglogs </li><li>å‘å¸ƒè®¢é˜…ï¼ˆpub/subï¼‰</li><li>åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰</li><li>Streamï¼ˆ5.0ç‰ˆæœ¬æ–°å¢ï¼‰</li></ul><p>å…³äºå‘½ä»¤æˆ‘æ¨èçœ‹è¿™ä¸¤ä¸ªï¼š</p><ul><li><a href="http://doc.redisfans.com/">http://doc.Redisfans.com/</a></li><li><a href="http://www.redis.cn/commands.html">http://www.Redis.cn/commands.html</a></li></ul><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><h3 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h3><ul><li>ç¼“å­˜</li><li>åˆ†å¸ƒå¼é”ï¼ˆsetnxï¼‰</li><li>ç­¾åˆ°ç»Ÿè®¡ï¼ˆsetbitï¼‰</li><li>è®¡æ•°ï¼ˆincrï¼‰</li></ul><h3 id="hashes"><a href="#hashes" class="headerlink" title="hashes"></a>hashes</h3><ul><li>ç¼“å­˜</li><li>ç”¨æˆ·æ ‡ç­¾</li></ul><h3 id="lists"><a href="#lists" class="headerlink" title="lists"></a>lists</h3><ul><li>é˜Ÿåˆ—</li></ul><h3 id="sets"><a href="#sets" class="headerlink" title="sets"></a>sets</h3><ul><li>äº¤é›†å¹¶é›†</li><li>æ•°æ®å»é‡</li></ul><h3 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h3><ul><li>æ’è¡Œæ¦œ</li><li>å»¶æ—¶ä»»åŠ¡</li><li>é™æµ</li></ul><h3 id="hyperloglogs"><a href="#hyperloglogs" class="headerlink" title="hyperloglogs"></a>hyperloglogs</h3><ul><li>uvç»Ÿè®¡ï¼ˆipç»Ÿè®¡ï¼‰</li></ul><h3 id="pub-sub"><a href="#pub-sub" class="headerlink" title="pub/sub"></a>pub/sub</h3><ul><li>å‘å¸ƒè®¢é˜…ï¼ˆä¸æ˜¯ç‰¹åˆ«å¯é ï¼‰</li></ul><h3 id="geospatial"><a href="#geospatial" class="headerlink" title="geospatial"></a>geospatial</h3><ul><li>é™„è¿‘çš„äºº</li></ul><h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><ul><li>é˜Ÿåˆ—</li><li>å‘å¸ƒè®¢é˜…</li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€"><a href="#åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€" class="headerlink" title="åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€"></a>åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€</h4><p>ä»¥phpä»£ç ä¸ºä¾‹ï¼š</p><blockquote><p>WATCHå‘½ä»¤å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œã€‚ç›‘æ§ä¸€ç›´æŒç»­åˆ°EXECå‘½ä»¤ï¼ˆäº‹åŠ¡ä¸­çš„å‘½ä»¤æ˜¯åœ¨EXECä¹‹åæ‰æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨MULTIå‘½ä»¤åå¯ä»¥ä¿®æ”¹WATCHç›‘æ§çš„é”®å€¼ï¼‰</p></blockquote><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> åº“å­˜ä¸º<span class="hljs-number">5</span><span class="hljs-regexp">//</span>å®ä¾‹åŒ–Redis<span class="hljs-variable">$Redis</span> = new Redis();<span class="hljs-regexp">//</span>è¿æ¥<span class="hljs-variable">$Redis</span>-&gt;connect(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">6379</span>);<span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;sale&#x27;</span>;<span class="hljs-variable">$Redis</span>-&gt;setnx(<span class="hljs-variable">$key</span>, <span class="hljs-number">0</span>); <span class="hljs-regexp">//</span> æ­¤é¡¹ä¸é¢„å®šä¹‰äº¦å¯ï¼Œä¿è¯keyå”¯ä¸€å°±è¡Œ<span class="hljs-variable">$Redis</span>-&gt;watch(<span class="hljs-variable">$key</span>); <span class="hljs-regexp">//</span>ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚<span class="hljs-variable">$sale_num</span> = <span class="hljs-variable">$Redis</span>-&gt;get(<span class="hljs-variable">$key</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$sale_num</span> &gt; <span class="hljs-number">4</span>) &#123;<span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$Redis</span>-&gt;multi(); <span class="hljs-regexp">//</span>æ ‡è®°äº‹åŠ¡<span class="hljs-variable">$Redis</span>-&gt;incr(<span class="hljs-variable">$key</span>);  <span class="hljs-regexp">//</span>é”€é‡+<span class="hljs-number">1</span>sleep(<span class="hljs-number">1</span>); <span class="hljs-regexp">//</span>æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ<span class="hljs-variable">$ret</span> = <span class="hljs-variable">$Redis</span>-&gt;exec(); <span class="hljs-regexp">//</span> äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚<span class="hljs-keyword">if</span> (<span class="hljs-variable">$ret</span>) &#123;    <span class="hljs-regexp">//</span> è‡ªå®šä¹‰çš„ä¸€ä¸ªåŸºäºmedooçš„dbclassinclude <span class="hljs-string">&#x27;db.php&#x27;</span>;<span class="hljs-variable">$db</span> = new db([    <span class="hljs-string">&#x27;database_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;mysql&#x27;</span>,    <span class="hljs-string">&#x27;database_name&#x27;</span> =&gt; <span class="hljs-string">&#x27;test&#x27;</span>,    <span class="hljs-string">&#x27;server&#x27;</span> =&gt; <span class="hljs-string">&#x27;13sai&#x27;</span>,    <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;13sai&#x27;</span>,    <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;*&#x27;</span>,    <span class="hljs-string">&#x27;charset&#x27;</span> =&gt; <span class="hljs-string">&#x27;utf8&#x27;</span>]);<span class="hljs-variable">$db</span>-&gt;update(<span class="hljs-string">&#x27;goods&#x27;</span>, [<span class="hljs-string">&quot;stock_num[-]&quot;</span> =&gt; <span class="hljs-number">1</span>], [<span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">1</span>]);&#125;</code></pre></div><h4 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h4><blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/201910/30/41489/7MfaHZCwKT.png!large" alt="bloom"></p><p>phpå®ç°æ¨èçœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š</p><ul><li><a href="https://github.oscome.cn/2019/05/21/188/">https://github.oscome.cn/2019/05/21/188/</a></li></ul><p>å½“ç„¶ï¼ŒRedisè‡ªå·±ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š</p><ul><li><a href="https://github.com/RedisBloom/RedisBloom">https://github.com/RedisBloom/RedisBloom</a></li></ul><div class="code-wrapper"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/RedisBloom/</span>RedisBloom.gitcd Redisbloommake<span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/Redis-server --loadmodule ./</span>Redisbloom.so</code></pre></div><p>Bloomï¼šå‘è¿‡æ»¤å™¨æ·»åŠ æ–°é¡¹,å¦‚æœå°šä¸å­˜åœ¨ï¼Œåˆ™ä¼šä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨</p><div class="code-wrapper"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; BF.ADD newFilter foo(integer) <span class="hljs-number">1</span></code></pre></div><p>Bloomï¼šæ£€æŸ¥è¿‡æ»¤å™¨ä¸­æ˜¯å¦å­˜åœ¨é¡¹ </p><div class="code-wrapper"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; BF.EXISTS newFilter foo(integer) <span class="hljs-number">1</span><span class="hljs-number">127.0.0.1:6379</span>&gt; BF.EXISTS newFilter notpresent(integer) <span class="hljs-number">0</span></code></pre></div><h3 id="é™æµRedis-cell"><a href="#é™æµRedis-cell" class="headerlink" title="é™æµRedis-cell"></a>é™æµRedis-cell</h3><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> æå‰å®‰è£…rustå“Ÿgit clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/brandur/</span>Redis-cell.gitcd Redis-cellcargo build --releasecp target<span class="hljs-regexp">/release/</span>libRedis_cell.dylib <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/modules/</span>Redis-server --loadmodule <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/modules/</span>libRedis_cell.so</code></pre></div><p>è¯¥æ¨¡å—åªæœ‰1æ¡æŒ‡ä»¤cl.throttleï¼Œå®ƒçš„å‚æ•°å’Œè¿”å›å€¼éƒ½ç•¥æ˜¾å¤æ‚ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæŒ‡ä»¤å…·ä½“è¯¥å¦‚ä½•ä½¿ç”¨ã€‚</p><div class="code-wrapper"><pre><code class="hljs gherkin">&gt; cl.throttle limitThrot  15  30  60  1                    â–²     â–²  â–²  â–²  â–²                    |<span class="hljs-string">     </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  â””â”€â”€â”€â”€â”€ need 1 quota (å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯1)</span><span class="hljs-string">                    </span>|<span class="hljs-string">     </span>|<span class="hljs-string">  â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€ 30 operations / 60 seconds è¿™æ˜¯æ¼æ°´é€Ÿç‡</span><span class="hljs-string">                    </span>|<span class="hljs-string">     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 15 capacity è¿™æ˜¯æ¼æ–—å®¹é‡</span><span class="hljs-string">&gt;                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ key</span></code></pre></div><p>ä¸Šé¢è¿™ä¸ªæŒ‡ä»¤çš„æ„æ€æ˜¯å…è®¸é¢‘ç‡ä¸ºæ¯ 60s æœ€å¤š 30 æ¬¡(æ¼æ°´é€Ÿç‡)ï¼Œæ¼æ–—çš„åˆå§‹å®¹é‡ä¸º 15ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹å¯ä»¥å– 15 ä¸ªï¼Œç„¶åæ‰å¼€å§‹å—æ¼æ°´é€Ÿç‡çš„å½±å“ã€‚æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªæŒ‡ä»¤ä¸­æ¼æ°´é€Ÿç‡å˜æˆäº† 2 ä¸ªå‚æ•°ï¼Œæ›¿ä»£äº†ä¹‹å‰çš„å•ä¸ªæµ®ç‚¹æ•°ã€‚ç”¨ä¸¤ä¸ªå‚æ•°ç›¸é™¤çš„ç»“æœæ¥è¡¨è¾¾æ¼æ°´é€Ÿç‡ç›¸å¯¹å•ä¸ªæµ®ç‚¹æ•°è¦æ›´åŠ ç›´è§‚ä¸€äº›ã€‚</p><div class="code-wrapper"><pre><code class="hljs tap">&gt; cl.throttle limitThrot<span class="hljs-number"> 15 </span>30<span class="hljs-number"> 60 </span>11) (integer)<span class="hljs-number"> 0 </span>  <span class="hljs-comment"># 0 è¡¨ç¤ºå…è®¸ï¼Œ1è¡¨ç¤ºæ‹’ç»</span>2) (integer)<span class="hljs-number"> 15 </span> <span class="hljs-comment"># æ¼æ–—å®¹é‡capacity</span>3) (integer)<span class="hljs-number"> 14 </span> <span class="hljs-comment"># æ¼æ–—å‰©ä½™ç©ºé—´left_quota</span>4) (integer) -1  <span class="hljs-comment"># å¦‚æœæ‹’ç»äº†ï¼Œéœ€è¦å¤šé•¿æ—¶é—´åå†è¯•(æ¼æ–—æœ‰ç©ºé—´äº†ï¼Œå•ä½ç§’)</span>5) (integer)<span class="hljs-number"> 2 </span>  <span class="hljs-comment"># å¤šé•¿æ—¶é—´åï¼Œæ¼æ–—å®Œå…¨ç©ºå‡ºæ¥(left_quota==capacityï¼Œå•ä½ç§’)</span></code></pre></div><hr><p>åŸºæœ¬ä¸Šå¸¸è§çš„åœºæ™¯å°±æ˜¯è¿™äº›äº†ï¼Œå„ä½å‘¨æœ«æ„‰å¿«ï¼</p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLæ˜¯å¦‚ä½•åšåˆ°ä¸ä¸¢æ•°æ®</title>
    <link href="/2020/03/18/MySQL-data/"/>
    <url>/2020/03/18/MySQL-data/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚é™„ä¸Šä¸“æ é“¾æ¥ï¼Œæœ‰å…´è¶£å¯ç‚¹å‡»è®¢é˜…ï¼š<a href="https://time.geekbang.org/column/intro/139">https://time.geekbang.org/column/intro/139</a></p></blockquote><p>MySQLæ˜¯å¦‚ä½•åšåˆ°æ•°æ®ä¸ä¸¢å¤±å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸‹WALã€‚</p><h3 id="WAL-Write-Ahead-Loggin-æœºåˆ¶"><a href="#WAL-Write-Ahead-Loggin-æœºåˆ¶" class="headerlink" title="WAL(Write-Ahead Loggin)æœºåˆ¶"></a>WAL(Write-Ahead Loggin)æœºåˆ¶</h3><p>WAL æ˜¯é¢„å†™å¼æ—¥å¿—, å…³é”®ç‚¹åœ¨äºå…ˆå†™æ—¥å¿—å†å†™ç£ç›˜.</p><p>MySQLåœ¨å¯¹æ•°æ®é¡µè¿›è¡Œä¿®æ”¹æ—¶, é€šè¿‡å°†â€ä¿®æ”¹äº†ä»€ä¹ˆâ€è¿™ä¸ªæ“ä½œè®°å½•åœ¨æ—¥å¿—ä¸­, è€Œä¸å¿…é©¬ä¸Šå°†æ›´æ”¹å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸Š, ä»è€Œå°†éšæœºå†™è½¬æ¢ä¸ºé¡ºåºå†™, æé«˜äº†æ€§èƒ½ã€‚</p><p>è¿™ç§æœºåˆ¶ä¸€æ–¹é¢æé«˜äº†MySQLçš„ååé‡ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå®ç°äº†æ•°æ®çš„é«˜å¯é æ€§ã€‚</p><h3 id="binlogçš„å†™å…¥æœºåˆ¶"><a href="#binlogçš„å†™å…¥æœºåˆ¶" class="headerlink" title="binlogçš„å†™å…¥æœºåˆ¶"></a>binlogçš„å†™å…¥æœºåˆ¶</h3><p>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­ã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡çš„binlogæ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„ï¼Œå› æ­¤ä¸è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ã€‚è¿™å°±æ¶‰åŠåˆ°äº†binlog cacheçš„ä¿å­˜é—®é¢˜ã€‚</p><p>ç³»ç»Ÿç»™binlog cacheåˆ†é…äº†ä¸€ç‰‡å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œå‚æ•° binlog_cache_sizeç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†…binlog cacheæ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚</p><p>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨æŠŠbinlog cacheé‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ°binlogä¸­ï¼Œå¹¶æ¸…ç©ºbinlog cacheã€‚</p><p><img src="/image/qiniu/9ed86644d5f39efb0efec595abb92e3e.png" alt="binlog"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±binlog cacheï¼Œä½†æ˜¯å…±ç”¨åŒä¸€ä»½binlogæ–‡ä»¶ã€‚</p><p>å›¾ä¸­çš„writeï¼ŒæŒ‡çš„å°±æ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚</p><p>å›¾ä¸­çš„fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œã€‚</p><p>write å’Œfsyncçš„æ—¶æœºï¼Œæ˜¯ç”±å‚æ•°sync_binlogæ§åˆ¶çš„ï¼š</p><ul><li>sync_binlog=0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åªwriteï¼Œä¸fsyncï¼›</li><li>sync_binlog=1çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œfsyncï¼›</li><li>sync_binlog=N(N&gt;1)çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œä½†ç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè€ƒè™‘åˆ°ä¸¢å¤±æ—¥å¿—é‡çš„å¯æ§æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®å°†è¿™ä¸ªå‚æ•°è®¾æˆ0ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯å°†å…¶è®¾ç½®ä¸º100~1000ä¸­çš„æŸä¸ªæ•°å€¼ã€‚</p><p>ä½†æ˜¯ï¼Œå°†sync_binlogè®¾ç½®ä¸ºNï¼Œå¯¹åº”çš„é£é™©æ˜¯ï¼šå¦‚æœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—ã€‚</p><h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h3><p>å…ˆè¯´è¯´è¯´redo logçš„ä¸‰ç§çŠ¶æ€ï¼š</p><p><img src="/image/qiniu/9d057f61d3962407f413deebc80526d4.png" alt="redo log"></p><ul><li>çº¢è‰²ï¼šå­˜åœ¨redo log bufferä¸­ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨MySQLè¿›ç¨‹å†…å­˜ä¸­</li><li>é»„è‰²ï¼šå†™åˆ°ç£ç›˜(write)ï¼Œä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–ï¼ˆfsync)ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿçš„page cacheé‡Œé¢</li><li>ç»¿è‰²ï¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¯¹åº”çš„æ˜¯hard disk</li></ul><hr><p>ä¸ºäº†æ§åˆ¶ redo log çš„å†™å…¥ç­–ç•¥ï¼ŒInnoDB æä¾›äº† innodb_flush_log_at_trx_commit å‚ æ•°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½å–å€¼:</p><ul><li>0ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ;</li><li>1ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜;</li><li>2 ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚</li></ul><p>InnoDB æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš” 1 ç§’ï¼Œå°±ä¼šæŠŠ redo log buffer ä¸­çš„æ—¥å¿—ï¼Œè°ƒç”¨ write å†™ åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œç„¶åè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p><p>å®é™…ä¸Šï¼Œé™¤äº†åå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡çš„è½®è¯¢æ“ä½œå¤–ï¼Œè¿˜æœ‰ä¸¤ç§åœºæ™¯ä¼šè®©ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚</p><div class="code-wrapper"><pre><code class="hljs vim"><span class="hljs-number">1</span>. <span class="hljs-keyword">redo</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">buffer</span> å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶ å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜ã€‚æ³¨æ„ï¼Œç”±äºè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œåªæ˜¯ <span class="hljs-keyword">write</span>ï¼Œè€Œæ²¡æœ‰è°ƒç”¨ fsyncï¼Œä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ page cacheã€‚<span class="hljs-number">2</span>. å¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ <span class="hljs-keyword">redo</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">buffer</span> æŒä¹…åŒ–åˆ°ç£ ç›˜ã€‚å‡è®¾ä¸€ä¸ªäº‹åŠ¡ A æ‰§è¡Œåˆ°ä¸€åŠï¼Œå·²ç»å†™äº†ä¸€äº› <span class="hljs-keyword">redo</span> <span class="hljs-built_in">log</span> åˆ° <span class="hljs-keyword">buffer</span> ä¸­ï¼Œè¿™æ—¶å€™æœ‰å¦ å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡ B æäº¤ï¼Œå¦‚æœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ <span class="hljs-number">1</span>ï¼Œé‚£ä¹ˆ æŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘ï¼Œäº‹åŠ¡ B è¦æŠŠ <span class="hljs-keyword">redo</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">buffer</span> é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ—¶ å€™ï¼Œå°±ä¼šå¸¦ä¸Šäº‹åŠ¡ A åœ¨ <span class="hljs-keyword">redo</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">buffer</span> é‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</code></pre></div><p>æ—¢ç„¶MySQLèƒ½ä¿è¯redo logå’Œbinlogèƒ½å¯é æ€§å†™å…¥ç£ç›˜ï¼Œé‚£ä¹ˆåœ¨ä»–ä»¬ä¸¤è€…ç›´æ¥å¦‚ä½•ä¿è¯å¯é è½¬æ¢çš„å‘¢ï¼Ÿ</p><h3 id="ä¸¤é˜¶æ®µæäº¤"><a href="#ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤"></a>ä¸¤é˜¶æ®µæäº¤</h3><p>redo log å…ˆ prepareï¼Œå†å†™ binlogï¼Œæœ€åå†æŠŠ redo log commitã€‚åˆ©ç”¨è¿™ä¸ªä¸¤é˜¶æ®µæäº¤æœºåˆ¶ï¼ŒMySQLä¿è¯äº†redo logå’Œbinlogçš„å¯é ä¼ è¾“ã€‚</p><p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸‹æ•´ä½“ç®€å›¾ï¼š</p><p><img src="/images/post/wal.png" alt="æŒä¹…åŒ–"></p><hr><h3 id="é…ç½®å»ºè®®"><a href="#é…ç½®å»ºè®®" class="headerlink" title="é…ç½®å»ºè®®"></a>é…ç½®å»ºè®®</h3><ul><li>innodb_flush_log_at_trx_commit=1ã€‚è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„redologéƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¿è¯mysqlé‡å¯åæ•°æ®ä¸ä¸¢å¤±ã€‚</li><li>sync_binlog=1ã€‚è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„binlogéƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¿è¯mysqlé‡å¯åbinlogè®°å½•æ˜¯å®Œæ•´çš„ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLä¸»ä»</title>
    <link href="/2020/03/17/MySQL-master-slave/"/>
    <url>/2020/03/17/MySQL-master-slave/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚é™„ä¸Šä¸“æ é“¾æ¥ï¼Œæœ‰å…´è¶£å¯ç‚¹å‡»è®¢é˜…ï¼š<a href="https://time.geekbang.org/column/intro/139">https://time.geekbang.org/column/intro/139</a></p></blockquote><p>æ˜¨å¤©çš„æ–‡ç« æˆ‘ä»¬æ“ä½œäº†ä¸»ä»å¤åˆ¶ï¼Œé‚£ä¹ˆä½ æœ‰ä»”ç»†æƒ³ä¸€æƒ³å·¥ä½œåŸç†å—ï¼Ÿ</p><h3 id="ä¸»ä»åŒæ­¥å¤åˆ¶åŸç†"><a href="#ä¸»ä»åŒæ­¥å¤åˆ¶åŸç†" class="headerlink" title="ä¸»ä»åŒæ­¥å¤åˆ¶åŸç†"></a>ä¸»ä»åŒæ­¥å¤åˆ¶åŸç†</h3><p>å¤åˆ¶ç®€å•åˆ†æˆä¸‰æ­¥ï¼š</p><ol><li>masterå°†æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(binary log)ä¸­ï¼ˆè¿™äº›è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼Œbinary log eventsï¼‰ï¼›</li><li>slaveå°†masterçš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)ï¼›</li><li>slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚</li></ol><p>å½“ç„¶ï¼Œå…¶ä¸­çš„ç»†èŠ‚æ˜¯å¾ˆå¤æ‚çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ä¸“æ çš„å›¾ï¼š</p><p><img src="/image/qiniu/a66c154c1bc51e071dd2cc8c1d6ca6a3.png" alt="master-slave"></p><p>ä¸»åº“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ›´æ–°è¯·æ±‚åï¼Œæ‰§è¡Œå†…éƒ¨äº‹åŠ¡çš„æ›´æ–°é€»è¾‘ï¼ŒåŒæ—¶å†™binlogã€‚</p><p>è€Œå¤‡åº“Bè·Ÿä¸»åº“Aä¹‹é—´ç»´æŒäº†ä¸€ä¸ªé•¿è¿æ¥ã€‚ä¸»åº“Aå†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å¤‡åº“Bçš„è¿™ä¸ªé•¿è¿æ¥ã€‚ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p>åœ¨å¤‡åº“Bä¸Šé€šè¿‡change masterå‘½ä»¤ï¼Œè®¾ç½®ä¸»åº“Açš„IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠè¦ä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ã€‚</p><p>åœ¨å¤‡åº“Bä¸Šæ‰§è¡Œstart slaveå‘½ä»¤ï¼Œè¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„io_threadå’Œsql_threadã€‚å…¶ä¸­io_threadè´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥ã€‚</p><p>ä¸»åº“Aæ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§å¤‡åº“Bä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å–binlogï¼Œå‘ç»™Bã€‚</p><p>å¤‡åº“Bæ‹¿åˆ°binlogåï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç§°ä¸ºä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚</p><p>sql_threadè¯»å–ä¸­è½¬æ—¥å¿—ï¼Œè§£æå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œã€‚</p><h3 id="binlogé‡Œè®°å½•çš„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#binlogé‡Œè®°å½•çš„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="binlogé‡Œè®°å½•çš„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>binlogé‡Œè®°å½•çš„æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>é‚£ä¹ˆä»‹ç»äº†å·¥ä½œåŸç†ï¼Œä¹‹å‰ä¹Ÿæœ‰æ–‡ç« ä»‹ç»è¿‡binlogï¼Œé‚£ä¹ˆbinlogé‡Œåˆ°åº•è®°å½•çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>binlogæ ¹æ®é…ç½®è®°å½•çš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬çœ‹è¡¨æ ¼ï¼š</p><table><thead><tr><th>format</th><th>å®šä¹‰</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>statement</td><td>è®°å½•çš„æ˜¯ä¿®æ”¹SQLè¯­å¥</td><td>æ—¥å¿—æ–‡ä»¶å°ï¼ŒèŠ‚çº¦IOï¼Œæé«˜æ€§èƒ½</td><td>å‡†ç¡®æ€§å·®ï¼Œå¯¹ä¸€äº›ç³»ç»Ÿå‡½æ•°ä¸èƒ½å‡†ç¡®å¤åˆ¶æˆ–ä¸èƒ½å¤åˆ¶ï¼Œå¦‚now()ã€uuid()ç­‰</td></tr><tr><td>row</td><td>è®°å½•çš„æ˜¯æ¯è¡Œå®é™…æ•°æ®çš„å˜æ›´</td><td>å‡†ç¡®æ€§å¼ºï¼Œèƒ½å‡†ç¡®å¤åˆ¶æ•°æ®çš„å˜æ›´</td><td>æ—¥å¿—æ–‡ä»¶å¤§ï¼Œè¾ƒå¤§çš„ç½‘ç»œIOå’Œç£ç›˜IO</td></tr><tr><td>mixed</td><td>statementå’Œrowæ¨¡å¼çš„æ··åˆ</td><td>å‡†ç¡®æ€§å¼ºï¼Œæ–‡ä»¶å¤§å°é€‚ä¸­</td><td>æœ‰å¯èƒ½å‘ç”Ÿä¸»ä»ä¸ä¸€è‡´é—®é¢˜</td></tr></tbody></table><p><img src="/image/qiniu/b9818f73cd7d38a96ddcb75350b52931.png" alt="statement"></p><p><img src="/image/qiniu/d67a38db154afff610ae3bb64e266826.png" alt="row"></p><p>æ¨èä½¿ç”¨çš„æ˜¯rowæ¨¡å¼ï¼Œå‡†ç¡®æ€§é«˜ï¼Œè™½ç„¶è¯´æ–‡ä»¶å¤§ï¼Œä½†æ˜¯ç°åœ¨æœ‰SSDå’Œä¸‡å…†å…‰çº¤ç½‘ç»œï¼Œè¿™äº›ç£ç›˜IOå’Œç½‘ç»œIOéƒ½æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p><p>mixedæ ¼å¼çš„æ„æ€æ˜¯ï¼ŒMySQLè‡ªå·±ä¼šåˆ¤æ–­è¿™æ¡SQLè¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·ä¸»å¤‡ä¸ä¸€è‡´ï¼Œå¦‚æœæœ‰å¯èƒ½ï¼Œå°±ç”¨rowæ ¼å¼ï¼Œå¦åˆ™å°±ç”¨statementæ ¼å¼ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œmixedæ ¼å¼å¯ä»¥åˆ©ç”¨statmentæ ¼å¼çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åˆé¿å…äº†æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨mixedæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¾ä¾‹è¯´æ˜ï¼ˆæ•°æ®æ¢å¤ï¼‰ï¼š</p><p>æˆ‘ä»¬å°±åˆ†åˆ«ä»deleteã€insertå’Œupdateè¿™ä¸‰ç§SQLè¯­å¥çš„è§’åº¦ï¼Œæ¥çœ‹çœ‹æ•°æ®æ¢å¤çš„é—®é¢˜ã€‚</p><p>å³ä½¿æ‰§è¡Œçš„æ˜¯deleteè¯­å¥ï¼Œrowæ ¼å¼çš„binlogä¹Ÿä¼šæŠŠè¢«åˆ æ‰çš„è¡Œçš„æ•´è¡Œä¿¡æ¯ä¿å­˜èµ·æ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨æ‰§è¡Œå®Œä¸€æ¡deleteè¯­å¥ä»¥åï¼Œå‘ç°åˆ é”™æ•°æ®äº†ï¼Œå¯ä»¥ç›´æ¥æŠŠbinlogä¸­è®°å½•çš„deleteè¯­å¥è½¬æˆinsertï¼ŒæŠŠè¢«é”™åˆ çš„æ•°æ®æ’å…¥å›å»å°±å¯ä»¥æ¢å¤äº†ã€‚</p><p>å¦‚æœä½ æ˜¯æ‰§è¡Œé”™äº†insertè¯­å¥å‘¢ï¼Ÿé‚£å°±æ›´ç›´æ¥äº†ã€‚rowæ ¼å¼ä¸‹ï¼Œinsertè¯­å¥çš„binlogé‡Œä¼šè®°å½•æ‰€æœ‰çš„å­—æ®µä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥ç²¾ç¡®å®šä½åˆšåˆšè¢«æ’å…¥çš„é‚£ä¸€è¡Œã€‚è¿™æ—¶ï¼Œä½ ç›´æ¥æŠŠinsertè¯­å¥è½¬æˆdeleteè¯­å¥ï¼Œåˆ é™¤æ‰è¿™è¢«è¯¯æ’å…¥çš„ä¸€è¡Œæ•°æ®å°±å¯ä»¥äº†ã€‚</p><p>å¦‚æœæ‰§è¡Œçš„æ˜¯updateè¯­å¥çš„è¯ï¼Œbinlogé‡Œé¢ä¼šè®°å½•ä¿®æ”¹å‰æ•´è¡Œçš„æ•°æ®å’Œä¿®æ”¹åçš„æ•´è¡Œæ•°æ®ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ è¯¯æ‰§è¡Œäº†updateè¯­å¥çš„è¯ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªeventå‰åçš„ä¸¤è¡Œä¿¡æ¯å¯¹è°ƒä¸€ä¸‹ï¼Œå†å»æ•°æ®åº“é‡Œé¢æ‰§è¡Œï¼Œå°±èƒ½æ¢å¤è¿™ä¸ªæ›´æ–°æ“ä½œäº†ã€‚</p><p>å…¶å®ï¼Œç”±deleteã€insertæˆ–è€…updateè¯­å¥å¯¼è‡´çš„æ•°æ®æ“ä½œé”™è¯¯ï¼Œéœ€è¦æ¢å¤åˆ°æ“ä½œä¹‹å‰çŠ¶æ€çš„æƒ…å†µï¼Œä¹Ÿæ—¶æœ‰å‘ç”Ÿã€‚</p><h3 id="æŸ¥çœ‹binlog"><a href="#æŸ¥çœ‹binlog" class="headerlink" title="æŸ¥çœ‹binlog"></a>æŸ¥çœ‹binlog</h3><p>binlogæœ¬èº«æ˜¯ä¸€ç±»äºŒè¿›åˆ¶æ–‡ä»¶ã€‚äºŒè¿›åˆ¶æ–‡ä»¶æ›´çœç©ºé—´ï¼Œå†™å…¥é€Ÿåº¦æ›´å¿«ï¼Œæ˜¯æ— æ³•ç›´æ¥æ‰“å¼€æ¥æŸ¥çœ‹çš„ã€‚<br>å› æ­¤mysqlæä¾›äº†å‘½ä»¤mysqlbinlogè¿›è¡ŒæŸ¥çœ‹ã€‚<br>ä¸€èˆ¬çš„statementæ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨ä¸‹é¢å‘½ä»¤å°±å¯ä»¥</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">mysqlbinlog</span> mysql-bin.<span class="hljs-number">000001</span></code></pre></div><p>å¦‚æœæ˜¯rowæ ¼å¼ï¼ŒåŠ ä¸Š-væˆ–è€…-vvå‚æ•°å°±è¡Œï¼Œå¦‚</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">mysqlbinlog</span> -vv mysql-bin.<span class="hljs-number">000001</span></code></pre></div><h3 id="é…ç½®å‚æ•°"><a href="#é…ç½®å‚æ•°" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h3><table><thead><tr><th>å‚æ•°å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>log_bin = {on | off | base_name}</td><td>æŒ‡å®šæ˜¯å¦å¯ç”¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿—æˆ–è€…æŒ‡å®šä¸€ä¸ªæ—¥å¿—è·¯å¾„</td></tr><tr><td>sql_log_bin ={ on | off }</td><td>æŒ‡å®šæ˜¯å¦å¯ç”¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿—</td></tr><tr><td>expire_logs_days</td><td>æŒ‡å®šè‡ªåŠ¨åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—çš„æ—¶é—´ï¼Œå³æ—¥å¿—è¿‡æœŸæ—¶é—´</td></tr><tr><td>log_bin_index</td><td>æŒ‡å®šmysql-bin.indexæ–‡ä»¶çš„è·¯å¾„</td></tr><tr><td>binlog_format = { mixed | row | statement }</td><td>æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—åŸºäºä»€ä¹ˆæ¨¡å¼è®°å½•</td></tr><tr><td>max_binlog_size</td><td>æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æœ€å¤§å€¼</td></tr><tr><td>binlog_cache_size</td><td>æŒ‡å®šäº‹åŠ¡æ—¥å¿—ç¼“å­˜åŒºå¤§å°</td></tr><tr><td>max_binlog_cache_size</td><td>æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—ç¼“å­˜æœ€å¤§å¤§å°</td></tr><tr><td>sync_binlog = { 0 | n }</td><td>æŒ‡å®šå†™ç¼“å†²å¤šå°‘æ¬¡ï¼Œåˆ·ä¸€æ¬¡ç›˜</td></tr></tbody></table><hr><p>ä¹‹å‰æ˜¯ä»‹ç»ä¸€äº›æ¦‚å¿µçš„ä¸œè¥¿ï¼Œä»Šå¤©æˆ‘ä»¬æ¥æ¢æ¢å£å‘³ï¼Œå®é™…æ“ä½œä¸€ä¸‹å•Šï¼Œæ“ä½œå†…å®¹æ˜¯æ­å»ºæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„MySQLä¸»ä»ã€‚</p><h3 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h3><p>å·²ç»å®‰è£…å¥½äº†ä¸»æ•°æ®åº“å’Œä»æ•°æ®åº“ï¼Œå¹¶æ–°å»ºdatabaseä¸ºtestï¼Œå‡å¦‚ä¸€äº›æ•°æ®ã€‚ï¼ˆå› ä¸ºæ˜¯æµ‹è¯•ï¼Œå•æœºå™¨ä¸Šå¼€ä¸¤ä¸ªMySQLç¤ºä¾‹ä¹Ÿå¯ä»¥ï¼‰</p><h4 id="master"><a href="#master" class="headerlink" title="master"></a>master</h4><div class="code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">REPLICATION</span> SLAVE, <span class="hljs-keyword">REPLICATION</span> CLIENT <span class="hljs-keyword">ON</span> . <span class="hljs-keyword">TO</span> repl@<span class="hljs-string">&#x27;127.0.0.1&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;111111&#x27;</span>; //åˆ†é…è´¦å· <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> . <span class="hljs-keyword">to</span> repl@<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>; //æˆæƒ</code></pre></div><p>æŸ¥çœ‹çŠ¶æ€</p><div class="code-wrapper"><pre><code class="hljs crmsh">SHOW <span class="hljs-keyword">MASTER</span> <span class="hljs-title">STATUS</span>;//è®°ä½è¿™é‡Œçš„fileå’Œpositionã€‚</code></pre></div><p>ä¿®æ”¹é…ç½®</p><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span> <span class="hljs-attr">log-bin</span>=mysql-bin <span class="hljs-attr">server-id</span>=<span class="hljs-number">1</span></code></pre></div><p>é‡å¯</p><h4 id="slave"><a href="#slave" class="headerlink" title="slave"></a>slave</h4><p>ä¿®æ”¹é…ç½®ï¼Œæ³¨æ„server_idè¦ä¸ä¸»åº“ï¼Œå…¶ä»–ä»åº“ä¸ä¸€æ ·ï¼Œå¯ä»¥è®¾ç½®æˆip</p><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span> <span class="hljs-attr">log_bin</span> = mysql-bin <span class="hljs-attr">server_id</span> = <span class="hljs-number">2</span> <span class="hljs-attr">relay_log</span> = mysql-relay-bin <span class="hljs-attr">log_slave_updates</span> = <span class="hljs-number">1</span> <span class="hljs-attr">read_only</span> = <span class="hljs-number">1</span></code></pre></div><p>é‡å¯åï¼Œå»ºè®®å…ˆè¿›è¡Œé‡ç½®æ“ä½œã€‚</p><div class="code-wrapper"><pre><code class="hljs crmsh">reset <span class="hljs-literal">slave</span></code></pre></div><p>è¿æ¥master</p><div class="code-wrapper"><pre><code class="hljs routeros">CHANGE MASTER <span class="hljs-keyword">TO</span> <span class="hljs-attribute">MASTER_HOST</span>=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,MASTER_USER=&#x27;repl&#x27;, <span class="hljs-attribute">MASTER_PASSWORD</span>=<span class="hljs-string">&#x27;111111&#x27;</span>, <span class="hljs-attribute">MASTER_LOG_FILE</span>=<span class="hljs-string">&#x27;mysql-bin.000051&#x27;</span>,master_log_pos=8694;</code></pre></div><p>master_log_fileå’Œmaster_log_poså°±æ˜¯ä¸Šé¢è®°ä½çš„fileå’Œpositionï¼Œå…·ä½“è‡ªè¡Œä¿®æ”¹ã€‚</p><p>å¼€å¯å¹¶æŸ¥çœ‹çŠ¶æ€</p><div class="code-wrapper"><pre><code class="hljs crmsh"><span class="hljs-literal">start</span> <span class="hljs-literal">slave</span> show <span class="hljs-literal">slave</span> status</code></pre></div><p>å¦‚æœSlave_IO_Runningå’ŒSlave_SQL_Runningéƒ½æ˜¾ç¤ºYesï¼Œä¸€èˆ¬å°±æˆåŠŸäº†ã€‚</p><p>å¤±è´¥ä¸€èˆ¬å°±æ˜¯master_log_posï¼Œmaster_log_fileé…ç½®æœ‰é—®é¢˜ï¼Œé‡æ–°é…ç½®ä¸‹å°±è¡Œäº†ã€‚</p><p>å¯ä»¥åœ¨masteræ’å…¥ä¿®æ”¹æ•°æ®ï¼Œæµ‹è¯•slaveæ˜¯å¦ç›¸åº”å˜åŒ–ã€‚</p><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>å¦‚æœmasterå·²æœ‰æ•°æ®ï¼Œå¯ä»¥é”å®šmasterï¼ˆflush tables with read lockï¼‰ï¼Œç„¶åå¯¼å‡ºåŒæ­¥åˆ°slaveï¼Œé…ç½®å®Œæˆåé‡Šæ”¾masterï¼ˆunlock tablesï¼‰ã€‚</p><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li>ã€åŸåˆ›ã€‘ç ”å‘åº”è¯¥æ‡‚çš„binlogçŸ¥è¯†(ä¸Š) <a href="https://www.cnblogs.com/rjzheng/p/9721765.html">https://www.cnblogs.com/rjzheng/p/9721765.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLçš„count</title>
    <link href="/2020/03/15/MySQL-count/"/>
    <url>/2020/03/15/MySQL-count/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚</p></blockquote><p>count(*)è¯­å¥åº”è¯¥æ˜¯æˆ‘ä»¬å¼€å‘ä¸­å¾ˆç»å¸¸ç”¨åˆ°çš„,né‚£ä¹ˆä½ æœ‰ä»”ç»†ç ”ç©¶è¿‡å—ï¼Ÿ</p><h3 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h3><blockquote><p>MyISAMå¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œcount(<em>)çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼›å¦‚æœåŠ äº†where æ¡ä»¶çš„è¯ï¼ŒMyISAMè¡¨ä¹Ÿæ˜¯ä¸èƒ½è¿”å›å¾—è¿™ä¹ˆå¿«çš„ã€‚è€ŒInnoDBå¼•æ“å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œcount(</em>)çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶ååˆ¤æ–­not nullç´¯ç§¯è®¡æ•°ã€‚</p></blockquote><p>é‚£ä½ å°±é—®äº†ï¼Œä¸ºä»€ä¹ˆInnoDBä¸è·ŸMyISAMä¸€æ ·ï¼Œä¹ŸæŠŠæ•°å­—å­˜èµ·æ¥å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºå³ä½¿æ˜¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»çš„å¤šä¸ªæŸ¥è¯¢ï¼Œç”±äºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰çš„åŸå› ï¼ŒInnoDBè¡¨â€œåº”è¯¥è¿”å›å¤šå°‘è¡Œâ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ã€‚</p><p>å‡è®¾è¡¨tä¸­ç°åœ¨æœ‰10000æ¡è®°å½•ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸‰ä¸ªç”¨æˆ·å¹¶è¡Œçš„ä¼šè¯ã€‚</p><ul><li>ä¼šè¯Aå…ˆå¯åŠ¨äº‹åŠ¡å¹¶æŸ¥è¯¢ä¸€æ¬¡è¡¨çš„æ€»è¡Œæ•°ï¼›</li><li>ä¼šè¯Bå¯åŠ¨äº‹åŠ¡ï¼Œæ’å…¥ä¸€è¡Œåè®°å½•åï¼ŒæŸ¥è¯¢è¡¨çš„æ€»è¡Œæ•°ï¼›</li><li>ä¼šè¯Cå…ˆå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„è¯­å¥ï¼Œæ’å…¥ä¸€è¡Œè®°å½•åï¼ŒæŸ¥è¯¢è¡¨çš„æ€»è¡Œæ•°ã€‚</li><li>æˆ‘ä»¬å‡è®¾ä»ä¸Šåˆ°ä¸‹æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œçš„ï¼ŒåŒä¸€è¡Œè¯­å¥æ˜¯åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡Œçš„ã€‚</li></ul><p><img src="/image/qiniu/5e716ba1d464c8224c1c1f36135d0e97.png" alt="å›¾1 ä¼šè¯Aã€Bã€Cçš„æ‰§è¡Œæµç¨‹"></p><p>ä½ ä¼šçœ‹åˆ°ï¼Œåœ¨æœ€åä¸€ä¸ªæ—¶åˆ»ï¼Œä¸‰ä¸ªä¼šè¯Aã€Bã€Cä¼šåŒæ—¶æŸ¥è¯¢è¡¨tçš„æ€»è¡Œæ•°ï¼Œä½†æ‹¿åˆ°çš„ç»“æœå´ä¸åŒã€‚</p><p>è¿™å’ŒInnoDBçš„äº‹åŠ¡è®¾è®¡æœ‰å…³ç³»ï¼Œå¯é‡å¤è¯»æ˜¯å®ƒé»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œåœ¨ä»£ç ä¸Šå°±æ˜¯é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æ¥å®ç°çš„ã€‚æ¯ä¸€è¡Œè®°å½•éƒ½è¦åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯¹è¿™ä¸ªä¼šè¯å¯è§ï¼Œå› æ­¤å¯¹äº<code>count(*)</code>è¯·æ±‚æ¥è¯´ï¼ŒInnoDBåªå¥½æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°è¯»å‡ºä¾æ¬¡åˆ¤æ–­ï¼Œå¯è§çš„è¡Œæ‰èƒ½å¤Ÿç”¨äºè®¡ç®—â€œåŸºäºè¿™ä¸ªæŸ¥è¯¢â€çš„è¡¨çš„æ€»è¡Œæ•°ã€‚</p><p>å½“ç„¶ï¼Œç°åœ¨è¿™ä¸ªçœ‹ä¸Šå»ç¬¨ç¬¨çš„MySQLï¼Œåœ¨æ‰§è¡Œ<code>count(*)</code>æ“ä½œçš„æ—¶å€™è¿˜æ˜¯åšäº†ä¼˜åŒ–çš„ã€‚</p><p>InnoDBæ”¯æŒçš„æ˜¯ç´¢å¼•ç»„ç»‡è¡¨ï¼Œä¸»é”®ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯æ•°æ®ï¼Œè€Œæ™®é€šç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸»é”®å€¼ã€‚æ‰€ä»¥ï¼Œæ™®é€šç´¢å¼•æ ‘æ¯”ä¸»é”®ç´¢å¼•æ ‘å°å¾ˆå¤šã€‚å¯¹äºcount(*)è¿™æ ·çš„æ“ä½œï¼Œéå†å“ªä¸ªç´¢å¼•æ ‘å¾—åˆ°çš„ç»“æœé€»è¾‘ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼ŒMySQLä¼˜åŒ–å™¨ä¼šæ‰¾åˆ°æœ€å°çš„é‚£æ£µæ ‘æ¥éå†ã€‚</p><p>åœ¨ä¿è¯é€»è¾‘æ­£ç¡®çš„å‰æä¸‹ï¼Œå°½é‡å‡å°‘æ‰«æçš„æ•°æ®é‡ï¼Œæ˜¯æ•°æ®åº“ç³»ç»Ÿè®¾è®¡çš„é€šç”¨æ³•åˆ™ä¹‹ä¸€ã€‚</p><p>å¦‚æœä½ ç”¨è¿‡<code>show table status</code> å‘½ä»¤çš„è¯ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªå‘½ä»¤çš„è¾“å‡ºç»“æœé‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªTABLE_ROWSç”¨äºæ˜¾ç¤ºè¿™ä¸ªè¡¨å½“å‰æœ‰å¤šå°‘è¡Œï¼Œè¿™ä¸ªå‘½ä»¤æ‰§è¡ŒæŒºå¿«çš„ï¼Œé‚£è¿™ä¸ªTABLE_ROWSèƒ½ä»£æ›¿<code>count(*)</code>å—ï¼Ÿ</p><p>è€Œç´¢å¼•ç»Ÿè®¡çš„å€¼æ˜¯é€šè¿‡é‡‡æ ·æ¥ä¼°ç®—çš„ï¼Œå®é™…ä¸Šï¼ŒTABLE_ROWSå°±æ˜¯ä»è¿™ä¸ªé‡‡æ ·ä¼°ç®—å¾—æ¥çš„ï¼Œå› æ­¤å®ƒä¹Ÿä¸æ˜¯å¾ˆå‡†ã€‚æœ‰å¤šä¸å‡†å‘¢ï¼Œå®˜æ–¹æ–‡æ¡£è¯´è¯¯å·®å¯èƒ½è¾¾åˆ°40%åˆ°50%ã€‚æ‰€ä»¥ï¼Œ<code>show table status</code>å‘½ä»¤æ˜¾ç¤ºçš„è¡Œæ•°ä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚</p><blockquote><p>MyISAMè¡¨è™½ç„¶count(*)å¾ˆå¿«ï¼Œä½†æ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼›<code>show table status</code>å‘½ä»¤è™½ç„¶è¿”å›å¾ˆå¿«ï¼Œä½†æ˜¯ä¸å‡†ç¡®ï¼›InnoDBè¡¨ç›´æ¥<code>count(*)</code>ä¼šéå†å…¨è¡¨ï¼Œè™½ç„¶ç»“æœå‡†ç¡®ï¼Œä½†ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p></blockquote><p>é‚£ä¹ˆï¼Œå¦‚æœä½ ç°åœ¨æœ‰ä¸€ä¸ªé¡µé¢ç»å¸¸è¦æ˜¾ç¤ºè®°å½•æ€»æ•°ï¼Œåˆ°åº•åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æœªå¿…å°±åªèƒ½çº ç»“äºcountï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±é¢å¤–è®¡æ•°ã€‚</p><h3 id="è®¡æ•°æ–¹æ³•"><a href="#è®¡æ•°æ–¹æ³•" class="headerlink" title="è®¡æ•°æ–¹æ³•"></a>è®¡æ•°æ–¹æ³•</h3><h4 id="ç¼“å­˜è®¡æ•°"><a href="#ç¼“å­˜è®¡æ•°" class="headerlink" title="ç¼“å­˜è®¡æ•°"></a>ç¼“å­˜è®¡æ•°</h4><p>å¯¹äºæ›´æ–°å¾ˆé¢‘ç¹çš„åº“æ¥è¯´ï¼Œä½ å¯èƒ½ä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°ï¼Œç”¨ç¼“å­˜ç³»ç»Ÿæ¥æ”¯æŒï¼Œæ¯”å¦‚Redisã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªRedisæœåŠ¡æ¥ä¿å­˜è¿™ä¸ªè¡¨çš„æ€»è¡Œæ•°ï¼Œè¯»å’Œæ›´æ–°æ“ä½œéƒ½å¾ˆå¿«ã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨Rediså­˜å‚¨è®¡æ•°æ˜¯æœ‰ä¸€äº›é—®é¢˜çš„ã€‚</p><p>é¦–å…ˆï¼Œæ— æ³•ä¿è¯Rediså®Œå…¨å¯ç”¨ï¼Œå‡å¦‚å¼‚å¸¸æŒ‚æ‰ï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯MySQLå’ŒRedisæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>å…¶æ¬¡ï¼Œå³ä½¿Redisæ­£å¸¸å¯ç”¨ï¼Œè®¡æ•°ä¹Ÿå¹¶ä¸ç²¾ç¡®ï¼Œå› ä¸ºMySQLå’ŒRediså­˜å‚¨å¿…ç„¶æœ‰å…ˆåä¹‹åˆ†ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤šä¸ªä¼šè¯ä»Rediså’ŒMySQLè¯»åˆ°çš„æ•°æ®å¾ˆå¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å›¾ç‰‡ï¼Œå°±ä¸å±•å¼€è¯´æ˜äº†ã€‚</p><p><img src="/image/qiniu/39898af053695dad37227d71ae288e33.png" alt="å›¾2 ä¼šè¯Aã€Bæ‰§è¡Œæ—¶åºå›¾"></p><p>å½“ç„¶äº†ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼Œå› ä¸ºä¸šåŠ¡å¹¶ä¸è¦ä¿è¯æ•°æ®æ¯æ—¶æ¯åˆ»éƒ½æ˜¯ç²¾ç¡®çš„ï¼Œé‚£å°±æ— éœ€è€ƒè™‘è¿™äº›é—®é¢˜ï¼ŒRediså¼‚å¸¸åæˆ‘ä»¬å¯ä»¥ä»è®¡ç®—è¡¨è¡Œæ•°å»æ›´æ–°ã€‚</p><h4 id="æ•°æ®åº“è®¡æ•°"><a href="#æ•°æ®åº“è®¡æ•°" class="headerlink" title="æ•°æ®åº“è®¡æ•°"></a>æ•°æ®åº“è®¡æ•°</h4><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨MySQlæ–°å»ºä¸€å¼ è¡¨å»è®¡æ•°ã€‚é‚£ä¹ˆé’ˆå¯¹ç¼“å­˜è®¡æ•°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹ï¼š</p><p>é¦–å…ˆï¼Œè¿™è§£å†³äº†å´©æºƒä¸¢å¤±çš„é—®é¢˜ï¼ŒInnoDBæ˜¯æ”¯æŒå´©æºƒæ¢å¤ä¸ä¸¢æ•°æ®çš„ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å†çœ‹çœ‹èƒ½ä¸èƒ½è§£å†³è®¡æ•°ä¸ç²¾ç¡®çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æœ‰â€œäº‹åŠ¡â€è¿™ä¸ªå¤§æ€å™¨ï¼Œå¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><h3 id="ä¸åŒçš„countç”¨æ³•å¯¹æ¯”"><a href="#ä¸åŒçš„countç”¨æ³•å¯¹æ¯”" class="headerlink" title="ä¸åŒçš„countç”¨æ³•å¯¹æ¯”"></a>ä¸åŒçš„countç”¨æ³•å¯¹æ¯”</h3><ol><li><p><code>count(ä¸»é”®id)</code>ï¼šInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™serverå±‚ã€‚serverå±‚æ‹¿åˆ°idåï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºnullï¼Œå°±æŒ‰è¡Œç´¯åŠ ã€‚</p></li><li><p><code>count(1)</code>ï¼šInnoDBå¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚serverå±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€è¿›å»ï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºnullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼Œæ˜¾ç„¶è¿™æ¯”ä¸Šé¢çš„æ•ˆç‡è¦é«˜ä¸€äº›ã€‚</p></li><li><p><code>count(å­—æ®µ)</code>ï¼šå¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€æ˜¯å®šä¹‰ä¸ºnot nullçš„è¯ï¼Œä¸€è¡Œè¡Œåœ°ä»è®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­ä¸èƒ½ä¸ºnullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼›å¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€å®šä¹‰å…è®¸ä¸ºnullï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­åˆ°æœ‰å¯èƒ½æ˜¯nullï¼Œè¿˜è¦æŠŠå€¼å–å‡ºæ¥å†åˆ¤æ–­ä¸€ä¸‹ï¼Œä¸æ˜¯nullæ‰ç´¯åŠ ã€‚</p></li><li><p>count(<em>)ï¼šæ˜¯ä¾‹å¤–ï¼Œå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ã€‚count(</em>)è‚¯å®šä¸æ˜¯nullï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚</p></li></ol><blockquote><p>æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œ<code>count(å­—æ®µ)&lt;count(ä¸»é”®id)&lt;count(1)â‰ˆcount(*)</code>ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ ï¼Œå°½é‡ä½¿ç”¨<code>count(*)</code>ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLçš„é”</title>
    <link href="/2020/03/14/MySQL-lock/"/>
    <url>/2020/03/14/MySQL-lock/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚</p></blockquote><p>é”æ˜¯MySQLä¸­ç»å¸¸ç”¨åˆ°çš„ï¼Œæ ¹æ®åŠ é”çš„èŒƒå›´ï¼ŒMySQLé‡Œé¢çš„é”å¤§è‡´å¯ä»¥åˆ†æˆå…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”ä¸‰ç±»ã€‚</p><p><img src="/images/qiniu/master-slave.png" alt="ä¸»å¤‡æµç¨‹å›¾"></p><h3 id="å…¨å±€é”"><a href="#å…¨å±€é”" class="headerlink" title="å…¨å±€é”"></a>å…¨å±€é”</h3><p>é¡¾åæ€ä¹‰ï¼Œå…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚</p><p>MySQLæä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯</p><blockquote><p>Flush tables with read lock (FTWRL)ã€‚</p></blockquote><p>å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚</p><blockquote><p>å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ã€‚</p></blockquote><p>å®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·æ˜¯mysqldumpã€‚å½“mysqldumpä½¿ç”¨å‚æ•°â€“single-transactionçš„æ—¶å€™ï¼Œå¯¼æ•°æ®ä¹‹å‰å°±ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ¥ç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äºMVCCçš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ã€‚</p><h3 id="è¡¨é”"><a href="#è¡¨é”" class="headerlink" title="è¡¨é”"></a>è¡¨é”</h3><p>MySQLé‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDL)ã€‚</p><p>è¡¨é”çš„è¯­æ³•æ˜¯ </p><blockquote><p>lock tables â€¦ read/writeã€‚</p></blockquote><p>ä¸FTWRLç±»ä¼¼ï¼Œå¯ä»¥ç”¨unlock tablesä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚éœ€è¦æ³¨æ„ï¼Œlock tablesè¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­, å¦‚æœåœ¨æŸä¸ªçº¿ç¨‹Aä¸­æ‰§è¡Œ</p><blockquote><p>lock tables t1 read, t2 write</p></blockquote><p>è¿™ä¸ªè¯­å¥ï¼Œåˆ™å…¶ä»–çº¿ç¨‹å†™t1ã€è¯»å†™t2çš„è¯­å¥éƒ½ä¼šè¢«é˜»å¡ã€‚åŒæ—¶ï¼Œçº¿ç¨‹Aåœ¨æ‰§è¡Œunlock tablesä¹‹å‰ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œè¯»t1ã€è¯»å†™t2çš„æ“ä½œã€‚è¿å†™t1éƒ½ä¸å…è®¸ï¼Œè‡ªç„¶ä¹Ÿä¸èƒ½è®¿é—®å…¶ä»–è¡¨ã€‚</p><p>åœ¨è¿˜æ²¡æœ‰å‡ºç°æ›´ç»†ç²’åº¦çš„é”çš„æ—¶å€™ï¼Œè¡¨é”æ˜¯æœ€å¸¸ç”¨çš„å¤„ç†å¹¶å‘çš„æ–¹å¼ã€‚è€Œå¯¹äºInnoDBè¿™ç§æ”¯æŒè¡Œé”çš„å¼•æ“ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨lock tableså‘½ä»¤æ¥æ§åˆ¶å¹¶å‘ï¼Œæ¯•ç«Ÿé”ä½æ•´ä¸ªè¡¨çš„å½±å“é¢è¿˜æ˜¯å¤ªå¤§ã€‚</p><p>å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯MDLï¼ˆmetadata lock)ã€‚</p><p>MDLä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚</p><blockquote><p>MDLçš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšå˜æ›´ï¼Œåˆ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p></blockquote><p>å› æ­¤ï¼Œåœ¨MySQL 5.5ç‰ˆæœ¬ä¸­å¼•å…¥äº†MDLï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”ã€‚</p><p>è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æ”¹æŸ¥ã€‚</p><p>è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªè¦ç­‰å¦ä¸€ä¸ªæ‰§è¡Œå®Œæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚</p><p>è™½ç„¶MDLé”æ˜¯ç³»ç»Ÿé»˜è®¤ä¼šåŠ çš„ï¼Œä½†å´æ˜¯ä½ ä¸èƒ½å¿½ç•¥çš„ä¸€ä¸ªæœºåˆ¶ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°æœ‰äººæ‰åˆ°è¿™ä¸ªå‘é‡Œï¼šç»™ä¸€ä¸ªå°è¡¨åŠ ä¸ªå­—æ®µï¼Œå¯¼è‡´æ•´ä¸ªåº“æŒ‚äº†ã€‚</p><h3 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h3><p>MySQLçš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚MyISAMå¼•æ“å°±ä¸æ”¯æŒè¡Œé”ã€‚ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”ï¼Œå¯¹äºè¿™ç§å¼•æ“çš„è¡¨ï¼ŒåŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œï¼Œè¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦ã€‚InnoDBæ˜¯æ”¯æŒè¡Œé”çš„ï¼Œè¿™ä¹Ÿæ˜¯MyISAMè¢«InnoDBæ›¿ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚</p><blockquote><p>åœ¨InnoDBäº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚</p></blockquote><h3 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h3><blockquote><p>æ‰€è°“æ­»é”<DeadLock>: æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­,<br>å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡,è‹¥æ— å¤–åŠ›ä½œç”¨,å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å».<br>æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”,è¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰ç«ºçš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹.<br>è¡¨çº§é”ä¸ä¼šäº§ç”Ÿæ­»é”.æ‰€ä»¥è§£å†³æ­»é”ä¸»è¦è¿˜æ˜¯é’ˆå¯¹äºæœ€å¸¸ç”¨çš„InnoDB.</p></blockquote><p><img src="/images/qiniu/lock.png" alt="æ­»é”"></p><blockquote><p>å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š</p></blockquote><p>ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeoutæ¥è®¾ç½®ã€‚<br>å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œå‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚</p><h3 id="åŠ é”è§„åˆ™"><a href="#åŠ é”è§„åˆ™" class="headerlink" title="åŠ é”è§„åˆ™"></a>åŠ é”è§„åˆ™</h3><p>åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ã€‚</p><ul><li>åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockï¼Œlockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚</li><li>åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚</li><li>ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºè¡Œé”ã€‚</li><li>ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºé—´éš™é”ã€‚</li><li>ä¸€ä¸ªbugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLäº‹åŠ¡éš”ç¦»</title>
    <link href="/2020/03/13/MySQL-Isolation/"/>
    <url>/2020/03/13/MySQL-Isolation/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚</p></blockquote><p>æåˆ°äº‹åŠ¡ï¼Œä½ è‚¯å®šä¼šæƒ³åˆ°ACIDï¼ˆAtomicityã€Consistencyã€Isolationã€Durabilityï¼Œå³åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥è¯´è¯´å…¶ä¸­Iï¼Œä¹Ÿå°±æ˜¯â€œéš”ç¦»æ€§â€ã€‚</p><p>SQLæ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼šè¯»æœªæäº¤ï¼ˆread uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆserializable ï¼‰ã€‚</p><ul><li>è¯»æœªæäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚</li><li>è¯»æäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚</li><li>å¯é‡å¤è¯»æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚</li><li>ä¸²è¡ŒåŒ–ï¼Œé¡¾åæ€ä¹‰æ˜¯å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</li></ul><p><img src="/images/qiniu/7dea45932a6b722eb069d2264d0066f8.png" alt="éš”ç¦»çº§åˆ«"></p><div class="code-wrapper"><pre><code class="hljs armasm">æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aä¼šæœ‰å“ªäº›ä¸åŒçš„è¿”å›ç»“æœï¼Œä¹Ÿå°±æ˜¯å›¾é‡Œé¢<span class="hljs-built_in">V1</span>ã€<span class="hljs-built_in">V2</span>ã€<span class="hljs-built_in">V3</span>çš„è¿”å›å€¼åˆ†åˆ«æ˜¯ä»€ä¹ˆã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æœªæäº¤â€ï¼Œ åˆ™<span class="hljs-built_in">V1</span>çš„å€¼å°±æ˜¯<span class="hljs-number">2</span>ã€‚è¿™æ—¶å€™äº‹åŠ¡Bè™½ç„¶è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ç»“æœå·²ç»è¢«Açœ‹åˆ°äº†ã€‚å› æ­¤ï¼Œ<span class="hljs-built_in">V2</span>ã€<span class="hljs-built_in">V3</span>ä¹Ÿéƒ½æ˜¯<span class="hljs-number">2</span>ã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æäº¤â€ï¼Œåˆ™<span class="hljs-built_in">V1</span>æ˜¯<span class="hljs-number">1</span>ï¼Œ<span class="hljs-built_in">V2</span>çš„å€¼æ˜¯<span class="hljs-number">2</span>ã€‚äº‹åŠ¡Bçš„æ›´æ–°åœ¨æäº¤åæ‰èƒ½è¢«Açœ‹åˆ°ã€‚æ‰€ä»¥ï¼Œ <span class="hljs-built_in">V3</span>çš„å€¼ä¹Ÿæ˜¯<span class="hljs-number">2</span>ã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œå¯é‡å¤è¯»â€ï¼Œåˆ™<span class="hljs-built_in">V1</span>ã€<span class="hljs-built_in">V2</span>æ˜¯<span class="hljs-number">1</span>ï¼Œ<span class="hljs-built_in">V3</span>æ˜¯<span class="hljs-number">2</span>ã€‚ä¹‹æ‰€ä»¥<span class="hljs-built_in">V2</span>è¿˜æ˜¯<span class="hljs-number">1</span>ï¼Œéµå¾ªçš„å°±æ˜¯è¿™ä¸ªè¦æ±‚ï¼šäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®å‰åå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œä¸²è¡ŒåŒ–â€ï¼Œåˆ™åœ¨äº‹åŠ¡Bæ‰§è¡Œâ€œå°†<span class="hljs-number">1</span>æ”¹æˆ<span class="hljs-number">2</span>â€çš„æ—¶å€™ï¼Œä¼šè¢«é”ä½ã€‚ç›´åˆ°äº‹åŠ¡Aæäº¤åï¼Œäº‹åŠ¡Bæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥ä»Açš„è§’åº¦çœ‹ï¼Œ <span class="hljs-built_in">V1</span>ã€<span class="hljs-built_in">V2</span>å€¼æ˜¯<span class="hljs-number">1</span>ï¼Œ<span class="hljs-built_in">V3</span>çš„å€¼æ˜¯<span class="hljs-number">2</span>ã€‚</code></pre></div><p>æŸ¥çœ‹éš”ç¦»çº§åˆ«ï¼š</p><blockquote><p>show variables like â€˜transaction_isolationâ€™;</p></blockquote><h3 id="äº‹åŠ¡å¯åŠ¨"><a href="#äº‹åŠ¡å¯åŠ¨" class="headerlink" title="äº‹åŠ¡å¯åŠ¨"></a>äº‹åŠ¡å¯åŠ¨</h3><blockquote><p>æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œ begin æˆ– start transactionã€‚é…å¥—çš„æäº¤è¯­å¥æ˜¯commitï¼Œå›æ»šè¯­å¥æ˜¯rollbackã€‚</p></blockquote><p>å»ºè®®ä½ æ€»æ˜¯ä½¿ç”¨set autocommit=1, é€šè¿‡æ˜¾å¼è¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡ã€‚</p><h3 id="äº‹åŠ¡éš”ç¦»çš„å®ç°"><a href="#äº‹åŠ¡éš”ç¦»çš„å®ç°" class="headerlink" title="äº‹åŠ¡éš”ç¦»çš„å®ç°"></a>äº‹åŠ¡éš”ç¦»çš„å®ç°</h3><p>ç†è§£äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹äº‹åŠ¡éš”ç¦»å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ã€‚è¿™é‡Œæˆ‘ä»¬å±•å¼€è¯´æ˜â€œå¯é‡å¤è¯»â€ã€‚</p><p>åœ¨MySQLä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚</p><p>å‡è®¾ä¸€ä¸ªå€¼ä»1è¢«æŒ‰é¡ºåºæ”¹æˆäº†2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚</p><p><img src="/image/qiniu/d9c313809e5ac148fc39feff532f0fee.png" alt="img"></p><p>å½“å‰å€¼æ˜¯4ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„read-viewã€‚å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œåœ¨è§†å›¾Aã€Bã€Cé‡Œé¢ï¼Œè¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯1ã€2ã€4ï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ã€‚å¯¹äºread-view Aï¼Œè¦å¾—åˆ°1ï¼Œå°±å¿…é¡»å°†å½“å‰å€¼ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›æ»šæ“ä½œå¾—åˆ°ã€‚</p><p>åŒæ—¶ä½ ä¼šå‘ç°ï¼Œå³ä½¿ç°åœ¨æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å°†4æ”¹æˆ5ï¼Œè¿™ä¸ªäº‹åŠ¡è·Ÿread-view Aã€Bã€Cå¯¹åº”çš„äº‹åŠ¡æ˜¯ä¸ä¼šå†²çªçš„ã€‚</p><p>ä½ ä¸€å®šä¼šé—®ï¼Œå›æ»šæ—¥å¿—æ€»ä¸èƒ½ä¸€ç›´ä¿ç•™å§ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™æ‰åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ã€‚</p><p>ä»€ä¹ˆæ—¶å€™æ‰ä¸éœ€è¦äº†å‘¢ï¼Ÿå°±æ˜¯å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„read-viewçš„æ—¶å€™ã€‚</p><p>åŸºäºä¸Šé¢çš„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ä¸ºä»€ä¹ˆå»ºè®®ä½ å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ã€‚</p><p>é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚</p><p>åœ¨MySQL 5.5åŠä»¥å‰çš„ç‰ˆæœ¬ï¼Œå›æ»šæ—¥å¿—æ˜¯è·Ÿæ•°æ®å­—å…¸ä¸€èµ·æ”¾åœ¨ibdataæ–‡ä»¶é‡Œçš„ï¼Œå³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤ï¼Œå›æ»šæ®µè¢«æ¸…ç†ï¼Œæ–‡ä»¶ä¹Ÿä¸ä¼šå˜å°ã€‚æˆ‘è§è¿‡æ•°æ®åªæœ‰20GBï¼Œè€Œå›æ»šæ®µæœ‰200GBçš„åº“ã€‚æœ€ç»ˆåªå¥½ä¸ºäº†æ¸…ç†å›æ»šæ®µï¼Œé‡å»ºæ•´ä¸ªåº“ã€‚</p><p>é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½æ‹–å®æ•´ä¸ªåº“ï¼Œè¿™äº‹éœ€è¦æ³¨æ„çš„ã€‚</p><h3 id="ç›¸å…³è¯­æ³•"><a href="#ç›¸å…³è¯­æ³•" class="headerlink" title="ç›¸å…³è¯­æ³•"></a>ç›¸å…³è¯­æ³•</h3><div class="code-wrapper"><pre><code class="hljs inform7">START TRANSACTION    <span class="hljs-comment">[transaction_characteristic <span class="hljs-comment">[, transaction_characteristic]</span> ...]</span>transaction_characteristic: &#123;    WITH CONSISTENT SNAPSHOT  | READ WRITE  | READ ONLY&#125;BEGIN <span class="hljs-comment">[WORK]</span>COMMIT <span class="hljs-comment">[WORK]</span> <span class="hljs-comment">[AND <span class="hljs-comment">[NO]</span> CHAIN]</span> <span class="hljs-comment">[<span class="hljs-comment">[NO]</span> RELEASE]</span>ROLLBACK <span class="hljs-comment">[WORK]</span> <span class="hljs-comment">[AND <span class="hljs-comment">[NO]</span> CHAIN]</span> <span class="hljs-comment">[<span class="hljs-comment">[NO]</span> RELEASE]</span>SET autocommit = &#123;0 | 1&#125;</code></pre></div><p>è¿™äº›è¯­å¥æä¾›å¯¹äº‹åŠ¡ä½¿ç”¨çš„æ§åˆ¶ ï¼š</p><ul><li>START TRANSACTIONæˆ– BEGINå¼€å§‹æ–°äº¤æ˜“ã€‚</li><li>COMMIT æäº¤å½“å‰äº‹åŠ¡ï¼Œä½¿å…¶æ›´æ”¹æ°¸ä¹…ç”Ÿæ•ˆã€‚</li><li>ROLLBACK å›æ»šå½“å‰äº‹åŠ¡ï¼Œå–æ¶ˆå…¶æ›´æ”¹ã€‚</li><li>SET autocommit ç¦ç”¨æˆ–å¯ç”¨å½“å‰ä¼šè¯çš„é»˜è®¤è‡ªåŠ¨æäº¤æ¨¡å¼ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLä¸­å‡ ä¸ªé‡è¦çš„æ—¥å¿—</title>
    <link href="/2020/03/12/MySQL-log/"/>
    <url>/2020/03/12/MySQL-log/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚</p></blockquote><h3 id="å‡ ä¸ªæ—¥å¿—çš„ä½œç”¨"><a href="#å‡ ä¸ªæ—¥å¿—çš„ä½œç”¨" class="headerlink" title="å‡ ä¸ªæ—¥å¿—çš„ä½œç”¨"></a>å‡ ä¸ªæ—¥å¿—çš„ä½œç”¨</h3><ul><li>é‡åšæ—¥å¿—ï¼ˆredo logï¼‰ï¼šç¡®ä¿äº‹åŠ¡çš„æŒä¹…æ€§ã€‚é˜²æ­¢åœ¨å‘ç”Ÿæ•…éšœçš„æ—¶é—´ç‚¹ï¼Œå°šæœ‰è„é¡µæœªå†™å…¥ç£ç›˜ï¼Œåœ¨é‡å¯mysqlæœåŠ¡çš„æ—¶å€™ï¼Œæ ¹æ®redo logè¿›è¡Œé‡åšï¼Œä»è€Œè¾¾åˆ°äº‹åŠ¡çš„æŒä¹…æ€§è¿™ä¸€ç‰¹æ€§ã€‚</li><li>å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰ï¼šä¿å­˜äº†äº‹åŠ¡å‘ç”Ÿä¹‹å‰çš„æ•°æ®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨äºå›æ»šï¼ŒåŒæ—¶å¯ä»¥æä¾›å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ä¸‹çš„è¯»ï¼ˆMVCCï¼‰ï¼Œå³éé”å®šè¯»</li><li>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰ï¼šç”¨äºå¤åˆ¶å’Œå¤‡ä»½ï¼Œåœ¨ä¸»ä»å¤åˆ¶ä¸­ï¼Œä»åº“åˆ©ç”¨ä¸»åº“ä¸Šçš„binlogè¿›è¡Œé‡æ’­ï¼Œå®ç°ä¸»ä»åŒæ­¥ã€‚ ä¹Ÿå¯åŸºäºæ—¶é—´ç‚¹åšæ•°æ®åº“çš„çš„è¿˜åŸã€‚</li></ul><h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h3><p>åœ¨MySQLé‡Œï¼Œå¦‚æœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹IOæˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQLçš„è®¾è®¡è€…å°±ç”¨äº†WALæŠ€æœ¯ï¼ŒWALçš„å…¨ç§°æ˜¯Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDBå¼•æ“å°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ°redo logé‡Œé¢ï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚åŒæ—¶ï¼ŒInnoDBå¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢ï¼Œè€Œè¿™ä¸ªæ›´æ–°å¾€å¾€æ˜¯åœ¨ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™åšã€‚</p><p>å¦å¤–ï¼ŒInnoDBçš„redo logæ˜¯å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„4ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯1GBï¼Œé‚£ä¹ˆè¿™å—â€œç²‰æ¿â€æ€»å…±å°±å¯ä»¥è®°å½•4GBçš„æ“ä½œã€‚ä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å°±åˆå›åˆ°å¼€å¤´å¾ªç¯å†™ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªå›¾æ‰€ç¤ºã€‚</p><p><img src="/images/qiniu/redolog.png" alt="redolog"></p><p>write posæ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»ï¼Œå†™åˆ°ç¬¬3å·æ–‡ä»¶æœ«å°¾åå°±å›åˆ°0å·æ–‡ä»¶å¼€å¤´ã€‚checkpointæ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åæ¨ç§»å¹¶ä¸”å¾ªç¯çš„ï¼Œæ“¦é™¤è®°å½•å‰è¦æŠŠè®°å½•æ›´æ–°åˆ°æ•°æ®æ–‡ä»¶ã€‚</p><p>write poså’Œcheckpointä¹‹é—´çš„æ˜¯ç©ºç€çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ“ä½œã€‚å¦‚æœwrite posè¿½ä¸Šcheckpointï¼Œè¡¨ç¤ºæ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†æ‰§è¡Œæ–°çš„æ›´æ–°ï¼Œå¾—åœä¸‹æ¥å…ˆæ“¦æ‰ä¸€äº›è®°å½•ï¼ŒæŠŠcheckpointæ¨è¿›ä¸€ä¸‹ã€‚</p><p>æœ‰äº†redo logï¼ŒInnoDBå°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸ºcrash-safeã€‚</p><h3 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h3><p>åœ¨æ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œä¸ä»…è®°å½•äº†redo logï¼Œè¿˜è®°å½•äº†ç›¸å¯¹åº”çš„undo logï¼Œå¦‚æœå› ä¸ºæŸäº›åŸå› å¯¼è‡´äº‹åŠ¡å¤±è´¥æˆ–å›æ»šäº†ï¼Œå¯ä»¥å€ŸåŠ©undo logè¿›è¡Œå›æ»šã€‚</p><p>undo logå’Œredo logè®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯é€»è¾‘æ—¥å¿—ã€‚å¯ä»¥è®¤ä¸ºå½“deleteä¸€æ¡è®°å½•æ—¶ï¼Œundo logä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„insertè®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œå½“updateä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„updateè®°å½•ã€‚</p><p>å½“æ‰§è¡Œrollbackæ—¶ï¼Œå°±å¯ä»¥ä»undo logä¸­çš„é€»è¾‘è®°å½•è¯»å–åˆ°ç›¸åº”çš„å†…å®¹å¹¶è¿›è¡Œå›æ»šã€‚æœ‰æ—¶å€™åº”ç”¨åˆ°è¡Œç‰ˆæœ¬æ§åˆ¶çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯é€šè¿‡undo logæ¥å®ç°çš„ï¼šå½“è¯»å–çš„æŸä¸€è¡Œè¢«å…¶ä»–äº‹åŠ¡é”å®šæ—¶ï¼Œå®ƒå¯ä»¥ä»undo logä¸­åˆ†æå‡ºè¯¥è¡Œè®°å½•ä»¥å‰çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Œä»è€Œæä¾›è¯¥è¡Œç‰ˆæœ¬ä¿¡æ¯ï¼Œè®©ç”¨æˆ·å®ç°éé”å®šä¸€è‡´æ€§è¯»å–ã€‚</p><p>undo logæ˜¯é‡‡ç”¨æ®µ(segment)çš„æ–¹å¼æ¥è®°å½•çš„ï¼Œæ¯ä¸ªundoæ“ä½œåœ¨è®°å½•çš„æ—¶å€™å ç”¨ä¸€ä¸ªundo log segmentã€‚</p><p>å¦å¤–ï¼Œundo logä¹Ÿä¼šäº§ç”Ÿredo logï¼Œå› ä¸ºundo logä¹Ÿè¦å®ç°æŒä¹…æ€§ä¿æŠ¤ã€‚</p><h3 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h3><p>MySQLæ•´ä½“æ¥çœ‹ï¼Œå…¶å®å°±æœ‰ä¸¤å—ï¼šä¸€å—æ˜¯Serverå±‚ï¼Œå®ƒä¸»è¦åšçš„æ˜¯MySQLåŠŸèƒ½å±‚é¢çš„äº‹æƒ…ï¼›è¿˜æœ‰ä¸€å—æ˜¯å¼•æ“å±‚ï¼Œè´Ÿè´£å­˜å‚¨ç›¸å…³çš„å…·ä½“äº‹å®œã€‚ä¸Šé¢æˆ‘ä»¬èŠåˆ°çš„redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„æ—¥å¿—ï¼Œè€ŒServerå±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—ï¼Œç§°ä¸ºbinlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚</p><p>æˆ‘æƒ³ä½ è‚¯å®šä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä»½æ—¥å¿—å‘¢ï¼Ÿ</p><p>å› ä¸ºæœ€å¼€å§‹MySQLé‡Œå¹¶æ²¡æœ‰InnoDBå¼•æ“ã€‚MySQLè‡ªå¸¦çš„å¼•æ“æ˜¯MyISAMï¼Œä½†æ˜¯MyISAMæ²¡æœ‰crash-safeçš„èƒ½åŠ›ï¼Œbinlogæ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£ã€‚è€ŒInnoDBæ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥MySQLçš„ï¼Œæ—¢ç„¶åªä¾é binlogæ˜¯æ²¡æœ‰crash-safeèƒ½åŠ›çš„ï¼Œæ‰€ä»¥InnoDBä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿâ€”â€”ä¹Ÿå°±æ˜¯redo logæ¥å®ç°crash-safeèƒ½åŠ›ã€‚</p><p>è¿™ä¸¤ç§æ—¥å¿—æœ‰ä»¥ä¸‹ä¸‰ç‚¹ä¸åŒã€‚</p><ul><li>redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„ï¼›binlogæ˜¯MySQLçš„Serverå±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li><li>redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ID=2è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1 â€ã€‚</li><li>redo logæ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlogæ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡binlogæ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚</li></ul><p>æœ‰äº†å¯¹è¿™ä¸¤ä¸ªæ—¥å¿—çš„æ¦‚å¿µæ€§ç†è§£ï¼Œæˆ‘ä»¬å†æ¥çœ‹æ‰§è¡Œå™¨å’ŒInnoDBå¼•æ“åœ¨æ‰§è¡Œè¿™ä¸ªç®€å•çš„updateè¯­å¥æ—¶çš„å†…éƒ¨æµç¨‹ã€‚</p><p>æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å–ID=2è¿™ä¸€è¡Œã€‚IDæ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœID=2è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚</p><p>æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯Nï¼Œç°åœ¨å°±æ˜¯N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚</p><p>å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ°redo logé‡Œé¢ï¼Œæ­¤æ—¶redo logå¤„äºprepareçŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚</p><p>æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„binlogï¼Œå¹¶æŠŠbinlogå†™å…¥ç£ç›˜ã€‚</p><p>æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„redo logæ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚</p><p>è¿™é‡Œæˆ‘ç»™å‡ºè¿™ä¸ªupdateè¯­å¥çš„æ‰§è¡Œæµç¨‹å›¾ï¼Œå›¾ä¸­æµ…è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨InnoDBå†…éƒ¨æ‰§è¡Œçš„ï¼Œæ·±è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œçš„ã€‚</p><p><img src="http://image.13sai.com/mysql2e5bff4910ec189fe1ee6e2ecc7b4bbe.png" alt="image"></p><p>å‚è€ƒæ–‡ç« ï¼š<br>è¯¦ç»†åˆ†æMySQLäº‹åŠ¡æ—¥å¿—(redo logå’Œundo log)-<br><a href="https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html#auto_id_14">https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html#auto_id_14</a></p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLæ‰§è¡Œæµç¨‹è¯´æ˜</title>
    <link href="/2020/03/11/MySQL-workon/"/>
    <url>/2020/03/11/MySQL-workon/</url>
    
    <content type="html"><![CDATA[<p>MySQLçš„æ‰§è¡Œæµç¨‹ç¤ºæ„å›¾ï¼š</p><p><img src="/images/qiniu/FC0E1A88145F46E6856980A725570302.png" alt="sqlæ‰§è¡Œæµç¨‹"></p><p>å¤§ä½“æ¥è¯´ï¼ŒMySQLå¯ä»¥åˆ†ä¸ºServerå±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¸¤éƒ¨åˆ†ã€‚</p><p>Serverå±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›–MySQLçš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚</p><p>è€Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå¸¸è§çš„æœ‰InnoDBã€MyISAMã€Memoryç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯InnoDBï¼Œä»MySQL 5.5.5ç‰ˆæœ¬å¼€å§‹å®ƒæˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><p>ä»å›¾ä¸­ä¸éš¾çœ‹å‡ºï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å…±ç”¨ä¸€ä¸ªServerå±‚ï¼Œä¹Ÿå°±æ˜¯ä»è¿æ¥å™¨åˆ°æ‰§è¡Œå™¨çš„éƒ¨åˆ†ã€‚</p><p>æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹æ¯ä¸ªç»„ä»¶çš„ä½œç”¨ã€‚</p><h3 id="è¿æ¥å™¨"><a href="#è¿æ¥å™¨" class="headerlink" title="è¿æ¥å™¨"></a>è¿æ¥å™¨</h3><p>è¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚è¿æ¥å‘½ä»¤ä¸€èˆ¬æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><div class="code-wrapper"><pre><code class="hljs tp">mysql -h <span class="hljs-variable">$ip</span> -<span class="hljs-keyword">P</span> <span class="hljs-variable">$port</span> -u <span class="hljs-variable">$user</span> -p</code></pre></div><p>è¾“å®Œå‘½ä»¤ä¹‹åï¼Œä½ å°±éœ€è¦åœ¨äº¤äº’å¯¹è¯é‡Œé¢è¾“å…¥å¯†ç ã€‚</p><p>è¿æ¥å®Œæˆåï¼Œå¦‚æœä½ æ²¡æœ‰åç»­çš„åŠ¨ä½œï¼Œè¿™ä¸ªè¿æ¥å°±å¤„äºç©ºé—²çŠ¶æ€ï¼Œä½ å¯ä»¥åœ¨<code>show processlist</code>å‘½ä»¤ä¸­çœ‹åˆ°å®ƒã€‚</p><p>å¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ªâ€Access denied for userâ€çš„é”™è¯¯ï¼Œç„¶åå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œã€‚<br>å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚</p><p>è¿™å°±æ„å‘³ç€ï¼Œä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚</p><p>å®¢æˆ·ç«¯å¦‚æœå¤ªé•¿æ—¶é—´æ²¡åŠ¨é™ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚è¿™ä¸ªæ—¶é—´æ˜¯ç”±å‚æ•°wait_timeoutæ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯8å°æ—¶ã€‚</p><p>å¦‚æœåœ¨è¿æ¥è¢«æ–­å¼€ä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚çš„è¯ï¼Œå°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯æé†’ï¼š Lost connection to MySQL server during queryã€‚è¿™æ—¶å€™å¦‚æœä½ è¦ç»§ç»­ï¼Œå°±éœ€è¦è¿›è¡Œé‡è¿æ“ä½œï¼Œç„¶åå†æ‰§è¡Œè¯·æ±‚ã€‚</p><h5 id="è¿æ¥æ³¨æ„ç‚¹ï¼š"><a href="#è¿æ¥æ³¨æ„ç‚¹ï¼š" class="headerlink" title="è¿æ¥æ³¨æ„ç‚¹ï¼š"></a>è¿æ¥æ³¨æ„ç‚¹ï¼š</h5><ul><li>é•¿è¿æ¥æ˜¯æŒ‡è¿æ¥æˆåŠŸåï¼Œå¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚</li><li>çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚</li></ul><p>å»ºç«‹è¿æ¥çš„è¿‡ç¨‹é€šå¸¸æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ åœ¨ä½¿ç”¨ä¸­è¦å°½é‡å‡å°‘å»ºç«‹è¿æ¥çš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯å°½é‡ä½¿ç”¨é•¿è¿æ¥ã€‚</p><p>ä½†æ˜¯å…¨éƒ¨ä½¿ç”¨é•¿è¿æ¥åï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œæœ‰äº›æ—¶å€™MySQLå ç”¨å†…å­˜æ¶¨å¾—ç‰¹åˆ«å¿«ï¼Œè¿™æ˜¯å› ä¸ºMySQLåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢çš„ã€‚è¿™äº›èµ„æºä¼šåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾ã€‚æ‰€ä»¥å¦‚æœé•¿è¿æ¥ç´¯ç§¯ä¸‹æ¥ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œè¢«ç³»ç»Ÿå¼ºè¡Œæ€æ‰ï¼ˆOOMï¼‰ï¼Œä»ç°è±¡çœ‹å°±æ˜¯MySQLå¼‚å¸¸é‡å¯äº†ã€‚</p><p>æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆã€‚</p><ol><li>å®šæœŸä¸»åŠ¨æ–­å¼€é•¿è¿æ¥ã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œæ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢å†é‡è¿ã€‚</li><li>å¦‚æœä½ ç”¨çš„æ˜¯MySQL 5.7æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connectionæ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚</li></ol><h3 id="æŸ¥è¯¢ç¼“å­˜"><a href="#æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜"></a>æŸ¥è¯¢ç¼“å­˜</h3><p>è¿æ¥å»ºç«‹å®Œæˆåï¼Œä½ å°±å¯ä»¥æ‰§è¡Œselectè¯­å¥äº†ã€‚æ‰§è¡Œé€»è¾‘å°±ä¼šæ¥åˆ°ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜ã€‚</p><p>MySQLæ‹¿åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå…ˆåˆ°æŸ¥è¯¢ç¼“å­˜çœ‹çœ‹ï¼Œä¹‹å‰æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡è¿™æ¡è¯­å¥ã€‚ä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥key-valueå¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚keyæ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalueæ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœä½ çš„æŸ¥è¯¢èƒ½å¤Ÿç›´æ¥åœ¨è¿™ä¸ªç¼“å­˜ä¸­æ‰¾åˆ°keyï¼Œé‚£ä¹ˆè¿™ä¸ªvalueå°±ä¼šè¢«ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¦‚æœè¯­å¥ä¸åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­ï¼Œå°±ä¼šç»§ç»­åé¢çš„æ‰§è¡Œé˜¶æ®µã€‚æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œç»“æœä¼šè¢«å­˜å…¥æŸ¥è¯¢ç¼“å­˜ä¸­ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæŸ¥è¯¢å‘½ä¸­ç¼“å­˜ï¼ŒMySQLä¸éœ€è¦æ‰§è¡Œåé¢çš„å¤æ‚æ“ä½œï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œè¿™ä¸ªæ•ˆç‡ä¼šå¾ˆé«˜ã€‚</p><p>ä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä¼šå»ºè®®ä½ ä¸è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ã€‚</p><p>æŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚å› æ­¤å¾ˆå¯èƒ½ä½ è´¹åŠ²åœ°æŠŠç»“æœå­˜èµ·æ¥ï¼Œè¿˜æ²¡ä½¿ç”¨å‘¢ï¼Œå°±è¢«ä¸€ä¸ªæ›´æ–°å…¨æ¸…ç©ºäº†ã€‚å¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚é™¤éä½ çš„ä¸šåŠ¡å°±æ˜¯æœ‰ä¸€å¼ é™æ€è¡¨ï¼Œå¾ˆé•¿æ—¶é—´æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ï¼Œé‚£è¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</p><p>å¥½åœ¨MySQLä¹Ÿæä¾›äº†è¿™ç§â€œæŒ‰éœ€ä½¿ç”¨â€çš„æ–¹å¼ã€‚ä½ å¯ä»¥å°†å‚æ•°query_cache_typeè®¾ç½®æˆDEMANDï¼Œè¿™æ ·å¯¹äºé»˜è®¤çš„SQLè¯­å¥éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚è€Œå¯¹äºä½ ç¡®å®šè¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„è¯­å¥ï¼Œå¯ä»¥ç”¨SQL_CACHEæ˜¾å¼æŒ‡å®šï¼Œåƒä¸‹é¢è¿™ä¸ªè¯­å¥ä¸€æ ·ï¼š</p><p>mysql&gt; select SQL_CACHE * from T where ID=10ï¼›</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 8.0ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´8.0å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚</p></blockquote><h3 id="åˆ†æå™¨"><a href="#åˆ†æå™¨" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h3><p>å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMySQLéœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹SQLè¯­å¥åšè§£æã€‚</p><p>åˆ†æå™¨å…ˆä¼šåšâ€œè¯æ³•åˆ†æâ€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡SQLè¯­å¥ï¼ŒMySQLéœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚</p><p>MySQLä»ä½ è¾“å…¥çš„â€selectâ€è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸²â€œTâ€è¯†åˆ«æˆâ€œè¡¨åTâ€ï¼ŒæŠŠå­—ç¬¦ä¸²â€œIDâ€è¯†åˆ«æˆâ€œåˆ—IDâ€ã€‚</p><p>åšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åï¼Œå°±è¦åšâ€œè¯­æ³•åˆ†æâ€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ªSQLè¯­å¥æ˜¯å¦æ»¡è¶³MySQLè¯­æ³•ã€‚</p><p>å¦‚æœä½ çš„è¯­å¥ä¸å¯¹ï¼Œå°±ä¼šæ”¶åˆ°â€œYou have an error in your SQL syntaxâ€çš„é”™è¯¯æé†’ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥selectå°‘æ‰“äº†å¼€å¤´çš„å­—æ¯â€œsâ€ã€‚</p><div class="code-wrapper"><pre><code class="hljs routeros">mysql&gt; elect * <span class="hljs-keyword">from</span> t where <span class="hljs-attribute">id</span>=1;<span class="hljs-builtin-name">ERROR</span> 1064 (42000): You have an <span class="hljs-builtin-name">error</span> <span class="hljs-keyword">in</span> your SQL syntax; check the<span class="hljs-built_in"> manual </span>that corresponds <span class="hljs-keyword">to</span> your MySQL<span class="hljs-built_in"> server </span>version <span class="hljs-keyword">for</span> the right syntax <span class="hljs-keyword">to</span> use near <span class="hljs-string">&#x27;elect * from t where ID=1&#x27;</span> at line 1</code></pre></div><p>ä¸€èˆ¬è¯­æ³•é”™è¯¯ä¼šæç¤ºç¬¬ä¸€ä¸ªå‡ºç°é”™è¯¯çš„ä½ç½®ï¼Œæ‰€ä»¥ä½ è¦å…³æ³¨çš„æ˜¯ç´§æ¥â€œuse nearâ€çš„å†…å®¹ã€‚</p><h3 id="ä¼˜åŒ–å™¨"><a href="#ä¼˜åŒ–å™¨" class="headerlink" title="ä¼˜åŒ–å™¨"></a>ä¼˜åŒ–å™¨</h3><p>ç»è¿‡äº†åˆ†æå™¨ï¼ŒMySQLå°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚</p><p>ä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºã€‚</p><p>ä¼˜åŒ–å™¨é˜¶æ®µå®Œæˆåï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆå°±ç¡®å®šä¸‹æ¥äº†ï¼Œç„¶åè¿›å…¥æ‰§è¡Œå™¨é˜¶æ®µã€‚å¦‚æœä½ è¿˜æœ‰ä¸€äº›ç–‘é—®ï¼Œæ¯”å¦‚ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆé€‰æ‹©ç´¢å¼•çš„ï¼Œæœ‰æ²¡æœ‰å¯èƒ½é€‰æ‹©é”™ç­‰ç­‰ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­å•ç‹¬å±•å¼€è¯´æ˜ä¼˜åŒ–å™¨çš„å†…å®¹ã€‚</p><h3 id="æ‰§è¡Œå™¨"><a href="#æ‰§è¡Œå™¨" class="headerlink" title="æ‰§è¡Œå™¨"></a>æ‰§è¡Œå™¨</h3><p>MySQLé€šè¿‡åˆ†æå™¨çŸ¥é“äº†ä½ è¦åšä»€ä¹ˆï¼Œé€šè¿‡ä¼˜åŒ–å™¨çŸ¥é“äº†è¯¥æ€ä¹ˆåšï¼Œäºæ˜¯å°±è¿›å…¥äº†æ‰§è¡Œå™¨é˜¶æ®µï¼Œå¼€å§‹æ‰§è¡Œè¯­å¥ã€‚</p><p>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹ä½ å¯¹è¿™ä¸ªè¡¨Tæœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤º(åœ¨å·¥ç¨‹å®ç°ä¸Šï¼Œå¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œä¼šåœ¨æŸ¥è¯¢ç¼“å­˜è¿”å›ç»“æœçš„æ—¶å€™ï¼Œåšæƒé™éªŒè¯ã€‚æŸ¥è¯¢ä¹Ÿä¼šåœ¨ä¼˜åŒ–å™¨ä¹‹å‰è°ƒç”¨precheckéªŒè¯æƒé™)ã€‚</p><div class="code-wrapper"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> T <span class="hljs-keyword">where</span> ID=<span class="hljs-number">10</span>;ERROR <span class="hljs-number">1142</span> (<span class="hljs-number">42000</span>): <span class="hljs-keyword">SELECT</span> command denied <span class="hljs-keyword">to</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;b&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;T&#x27;</span></code></pre></div><p>å¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­çš„è¡¨Tä¸­ï¼ŒIDå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p>è°ƒç”¨InnoDBå¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­IDå€¼æ˜¯ä¸æ˜¯10ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ï¼›</p><p>è°ƒç”¨å¼•æ“æ¥å£å–â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚</p><p>æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†ã€‚</p><p>å¯¹äºæœ‰ç´¢å¼•çš„è¡¨ï¼Œæ‰§è¡Œçš„é€»è¾‘ä¹Ÿå·®ä¸å¤šã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ˜¯â€œå–æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€è¡Œâ€è¿™ä¸ªæ¥å£ï¼Œä¹‹åå¾ªç¯å–â€œæ»¡è¶³æ¡ä»¶çš„ä¸‹ä¸€è¡Œâ€è¿™ä¸ªæ¥å£ï¼Œè¿™äº›æ¥å£éƒ½æ˜¯å¼•æ“ä¸­å·²ç»å®šä¹‰å¥½çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElementUIå¤šå›¾æ‹–æ‹½</title>
    <link href="/2020/02/27/228/"/>
    <url>/2020/02/27/228/</url>
    
    <content type="html"><![CDATA[<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><blockquote><p>yarn add vuedraggable<br>or<br>npm i -S vuedraggable</p></blockquote><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">el-row</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top: 20px;&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">&quot;20&quot;</span> <span class="hljs-attr">:offset</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;é¢„è§ˆ&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;desc&quot;</span>&gt;</span>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;image-list&quot;</span>&gt;</span>                        <span class="hljs-tag">&lt;<span class="hljs-name">draggable</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;showImgList&quot;</span>  @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;dragChange&quot;</span>&gt;</span>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(image, index) in showImgList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;image-wrap&quot;</span>&gt;</span>                                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;image&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;imgStyle&quot;</span> /&gt;</span>                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon-wrap&quot;</span> @<span class="hljs-attr">click.stop</span>=<span class="hljs-string">&quot;removeFile(index)&quot;</span>&gt;</span>                                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-icon-delete&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>                            <span class="hljs-tag">&lt;<span class="hljs-name">el-upload</span></span><span class="hljs-tag">                                <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;imageListUpload&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">:action</span>=<span class="hljs-string">&quot;$uploadPicUrl&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">:headers</span>=<span class="hljs-string">&quot;header&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">:before-upload</span>=<span class="hljs-string">&quot;beforeUpload&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">:on-success</span>=<span class="hljs-string">&quot;uploadSuccess&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;image-uploader&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">:on-error</span>=<span class="hljs-string">&quot;onError&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">multiple</span></span><span class="hljs-tag">                                <span class="hljs-attr">:show-file-list</span>=<span class="hljs-string">&quot;false&quot;</span></span><span class="hljs-tag">                                <span class="hljs-attr">accept</span>=<span class="hljs-string">&quot;image/*&quot;</span>&gt;</span>                                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;loading ? &#x27;el-icon-loading&#x27; : &#x27;el-icon-plus&#x27;&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;imgStyle&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>                            <span class="hljs-tag">&lt;/<span class="hljs-name">el-upload</span>&gt;</span>                        <span class="hljs-tag">&lt;/<span class="hljs-name">draggable</span>&gt;</span>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>                    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"></span><span class="css"><span class="hljs-selector-class">.ql-container</span> <span class="hljs-selector-class">.ql-editor</span>&#123;</span><span class="css">    <span class="hljs-attribute">height</span>:<span class="hljs-number">400px</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.avatar-uploader</span> <span class="hljs-selector-class">.el-upload</span> &#123;</span><span class="css">    <span class="hljs-attribute">height</span>: <span class="hljs-number">180px</span>;</span><span class="css">    <span class="hljs-attribute">width</span>: <span class="hljs-number">180px</span>;</span><span class="css">    <span class="hljs-attribute">overflow</span>: hidden;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.avatar-uploader</span> <span class="hljs-selector-tag">img</span> &#123;</span><span class="css">    <span class="hljs-attribute">height</span>: <span class="hljs-number">180px</span>;</span><span class="css">    <span class="hljs-attribute">width</span>: <span class="hljs-number">180px</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.avatar-uploader</span> <span class="hljs-selector-class">.avatar-uploader-icon</span> &#123;</span><span class="css">    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#d9d9d9</span>;</span><span class="css">    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;</span><span class="css">    <span class="hljs-attribute">cursor</span>: pointer;</span><span class="css">    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;</span><span class="css">    <span class="hljs-attribute">color</span>: <span class="hljs-number">#8c939d</span>;</span><span class="css">    <span class="hljs-attribute">width</span>: <span class="hljs-number">178px</span>;</span><span class="css">    <span class="hljs-attribute">height</span>: <span class="hljs-number">178px</span>;</span><span class="css">    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">178px</span>;</span><span class="css">    <span class="hljs-attribute">text-align</span>: center;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-id">#video</span> <span class="hljs-selector-class">.video</span> &#123;</span><span class="css">    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">300px</span>;</span><span class="css">    <span class="hljs-attribute">max-height</span>: <span class="hljs-number">200px</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.avatar</span> &#123;</span><span class="css"> <span class="hljs-attribute">width</span>: <span class="hljs-number">178px</span>;</span><span class="css"> <span class="hljs-attribute">height</span>: <span class="hljs-number">178px</span>;</span><span class="css"> <span class="hljs-attribute">display</span>: block;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.avatar-uploader</span> <span class="hljs-selector-tag">img</span> &#123;</span><span class="css">   <span class="hljs-attribute">height</span>: <span class="hljs-number">180px</span>;</span><span class="css">   <span class="hljs-attribute">width</span>: <span class="hljs-number">180px</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.ql-editor</span>&#123;</span><span class="css">    <span class="hljs-attribute">height</span>:<span class="hljs-number">400px</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.ql-snow</span> <span class="hljs-selector-class">.ql-picker</span> &#123;</span><span class="css">      <span class="hljs-attribute">height</span>: auto;</span><span class="css">&#125;</span><span class="css"></span><span class="css"><span class="hljs-selector-class">.image-list</span>,</span><span class="css"><span class="hljs-selector-class">.image-item</span> &#123;</span><span class="css">  <span class="hljs-attribute">display</span>: flex;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-list</span> <span class="hljs-selector-class">.image-wrap</span>,</span><span class="css"><span class="hljs-selector-class">.image-item</span> <span class="hljs-selector-class">.image-wrap</span> &#123;</span><span class="css">  <span class="hljs-attribute">position</span>: relative;</span><span class="css">  <span class="hljs-attribute">display</span>: inline-block;</span><span class="css">  <span class="hljs-attribute">box-sizing</span>: content-box;</span><span class="css">  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">8px</span> <span class="hljs-number">0</span>;</span><span class="css">  <span class="hljs-attribute">vertical-align</span>: top;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-list</span> <span class="hljs-selector-class">.image-wrap</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.icon-wrap</span>,</span><span class="css"><span class="hljs-selector-class">.image-item</span> <span class="hljs-selector-class">.image-wrap</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.icon-wrap</span> &#123;</span><span class="css">  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-list</span> <span class="hljs-selector-class">.image-wrap</span> <span class="hljs-selector-class">.icon-wrap</span>,</span><span class="css"><span class="hljs-selector-class">.image-item</span> <span class="hljs-selector-class">.image-wrap</span> <span class="hljs-selector-class">.icon-wrap</span> &#123;</span><span class="css">  <span class="hljs-attribute">position</span>: absolute;</span><span class="css">  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;</span><span class="css">  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;</span><span class="css">  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span><span class="css">  <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;</span><span class="css">  <span class="hljs-attribute">cursor</span>: default;</span><span class="css">  <span class="hljs-attribute">text-align</span>: center;</span><span class="css">  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;</span><span class="css">  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;</span><span class="css">  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;</span><span class="css">  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.7</span>);</span><span class="css">  <span class="hljs-attribute">transition</span>: opacity .<span class="hljs-number">3s</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-list</span> <span class="hljs-selector-class">.image-wrap</span> <span class="hljs-selector-class">.icon-wrap</span> <span class="hljs-selector-class">.el-icon-zoom-in</span>,</span><span class="css"><span class="hljs-selector-class">.image-item</span> <span class="hljs-selector-class">.image-wrap</span> <span class="hljs-selector-class">.icon-wrap</span> <span class="hljs-selector-class">.el-icon-zoom-in</span> &#123;</span><span class="css">  <span class="hljs-attribute">cursor</span>: pointer;</span><span class="css">  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">8px</span>;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-list</span> <span class="hljs-selector-class">.image-wrap</span> <span class="hljs-selector-class">.icon-wrap</span> <span class="hljs-selector-class">.el-icon-delete</span>,</span><span class="css"><span class="hljs-selector-class">.image-item</span> <span class="hljs-selector-class">.image-wrap</span> <span class="hljs-selector-class">.icon-wrap</span> <span class="hljs-selector-class">.el-icon-delete</span> &#123;</span><span class="css">  <span class="hljs-attribute">cursor</span>: pointer;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-item</span> &#123;</span><span class="css">  <span class="hljs-attribute">display</span>: inline-flex;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-uploader</span> &#123;</span><span class="css">  <span class="hljs-attribute">display</span>: inline-block;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-uploader</span> <span class="hljs-selector-class">.el-upload</span> &#123;</span><span class="css">  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#d9d9d9</span>;</span><span class="css">  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;</span><span class="css">  <span class="hljs-attribute">cursor</span>: pointer;</span><span class="css">  <span class="hljs-attribute">position</span>: relative;</span><span class="css">  <span class="hljs-attribute">overflow</span>: hidden;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-uploader</span> <span class="hljs-selector-class">.el-upload</span> <span class="hljs-selector-attr">[class^=<span class="hljs-string">&quot;el-icon&quot;</span>]</span> &#123;</span><span class="css">  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;</span><span class="css">  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8c939d</span>;</span><span class="css">  <span class="hljs-attribute">text-align</span>: center;</span><span class="css">&#125;</span><span class="css"><span class="hljs-selector-class">.image-uploader</span> <span class="hljs-selector-class">.el-upload</span><span class="hljs-selector-pseudo">:hover</span> &#123;</span><span class="css">  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#409EFF</span>;</span><span class="css">&#125;</span><span class="css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><span class="javascript"><span class="hljs-keyword">import</span> draggable <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuedraggable&#x27;</span></span><span class="javascript"></span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><span class="javascript">    <span class="hljs-attr">components</span>: &#123;</span><span class="javascript">        draggable,</span><span class="javascript">    &#125;,</span><span class="javascript">    <span class="hljs-function"><span class="hljs-title">data</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">        <span class="hljs-keyword">return</span> &#123;</span><span class="javascript">            <span class="hljs-attr">showImgList</span>: [],</span><span class="javascript">            <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,</span><span class="javascript">        &#125;</span><span class="javascript">    &#125;,</span><span class="javascript">    <span class="hljs-function"><span class="hljs-title">created</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.$route.params.id &gt; <span class="hljs-number">0</span>) &#123;</span><span class="javascript">            <span class="hljs-built_in">this</span>.getInfo(<span class="hljs-built_in">this</span>.$route.params.id)</span><span class="javascript">            <span class="hljs-built_in">this</span>.goodsForm.id = <span class="hljs-built_in">this</span>.$route.params.id;</span><span class="javascript">        &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">            <span class="hljs-built_in">this</span>.responseVisible = <span class="hljs-literal">false</span>;</span><span class="javascript">        &#125;</span><span class="javascript">    &#125;,</span><span class="javascript">    <span class="hljs-attr">computed</span>: &#123;</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">imgStyle</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">            <span class="hljs-keyword">return</span> &#123;</span><span class="javascript">                <span class="hljs-attr">width</span>: <span class="hljs-string">&#x27;180px&#x27;</span>, </span><span class="javascript">                <span class="hljs-attr">height</span>: <span class="hljs-string">&#x27;180px&#x27;</span>,</span><span class="javascript">                <span class="hljs-attr">lineHeight</span>: <span class="hljs-string">&#x27;180px&#x27;</span>,</span><span class="javascript">            &#125;</span><span class="javascript">        &#125;</span><span class="javascript">    &#125;,</span><span class="javascript">    <span class="hljs-function"><span class="hljs-title">mounted</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">        <span class="hljs-comment">// ä¸ºå›¾ç‰‡ICONç»‘å®šäº‹ä»¶  getModule ä¸ºç¼–è¾‘å™¨çš„å†…éƒ¨å±æ€§</span></span><span class="javascript">        <span class="hljs-comment">// this.$refs.myQuillEditor.quill.getModule(&#x27;toolbar&#x27;).addHandler(&#x27;image&#x27;, this.imgHandler)</span></span><span class="javascript">        <span class="hljs-comment">// this.$refs.myQuillEditor.quill.getModule(&#x27;toolbar&#x27;).addHandler(&#x27;video&#x27;, this.insertVideo) // ä¸ºè§†é¢‘ICONç»‘å®šäº‹ä»¶</span></span><span class="javascript">    &#125;,</span><span class="javascript">    <span class="hljs-attr">methods</span>: &#123;</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">beforeUpload</span>(<span class="hljs-params">file</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-keyword">if</span> (file.type.split(<span class="hljs-string">&#x27;/&#x27;</span>)[<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;image&#x27;</span>) &#123;</span><span class="javascript">                <span class="hljs-keyword">let</span> tempSize = file.size / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">2</span>;</span><span class="javascript">                <span class="hljs-keyword">if</span> (tempSize &gt; <span class="hljs-number">1</span>) &#123;</span><span class="javascript">                    <span class="hljs-built_in">this</span>.$message.error(<span class="hljs-string">&#x27;å›¾ç‰‡å°ºå¯¸ä¸å¾—å¤§äº2Mï¼&#x27;</span>);</span><span class="javascript">                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><span class="javascript">                &#125;</span><span class="javascript">            &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">                <span class="hljs-built_in">this</span>.$message.error(<span class="hljs-string">&#x27;è¯·ä¸Šä¼ å›¾ç‰‡æ ¼å¼ï¼ˆjpgã€pngã€gifï¼‰&#x27;</span>);</span><span class="javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><span class="javascript">            &#125;</span><span class="javascript">        &#125;,</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">getInfo</span>(<span class="hljs-params">id</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-keyword">var</span> _self = <span class="hljs-built_in">this</span>;</span><span class="javascript">            projectInfo(id).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>&#123;</span><span class="javascript">                _self.goodsForm = res.data.data;</span><span class="javascript">                _self.goodsForm.start_time = timestampToDate(_self.goodsForm.start_time);</span><span class="javascript">                _self.goodsForm.over_time = timestampToDate(_self.goodsForm.over_time);</span><span class="javascript">                _self.showImgList = _self.goodsForm.desc.split(<span class="hljs-string">&quot;|&quot;</span>);</span><span class="javascript">                _self.responseVisible = <span class="hljs-literal">false</span>;</span><span class="javascript">            &#125;).catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>)</span>&#123;</span><span class="javascript">                <span class="hljs-built_in">console</span>.log(error);</span><span class="javascript">            &#125;)</span><span class="javascript">        &#125;,</span><span class="javascript">        </span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">handleRemove</span>(<span class="hljs-params">file, fileList</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-built_in">console</span>.log(file, fileList);</span><span class="javascript">        &#125;,</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">uploadSuccess</span>(<span class="hljs-params">response, file, fileList</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-keyword">try</span> &#123;</span><span class="javascript">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> fileInfo <span class="hljs-keyword">of</span> fileList) &#123;</span><span class="javascript">                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.type === <span class="hljs-string">&#x27;image&#x27;</span>) &#123;</span><span class="javascript">                        <span class="hljs-built_in">this</span>.imgUrl = response.key</span><span class="javascript">                        <span class="hljs-built_in">this</span>.$emit(<span class="hljs-string">&#x27;update:data&#x27;</span>, response.key)</span><span class="javascript">                    &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">                        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showImgList.length &gt;= <span class="hljs-built_in">this</span>.limit) &#123; <span class="hljs-comment">// é™åˆ¶å›¾ç‰‡å¼ æ•°</span></span><span class="javascript">                            <span class="hljs-built_in">this</span>.showImgList.length = <span class="hljs-built_in">this</span>.limit</span><span class="javascript">                            <span class="hljs-keyword">throw</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`æœ€å¤šä¸Šä¼  <span class="hljs-subst">$&#123;<span class="hljs-built_in">this</span>.limit&#125;</span> å¼ å›¾ç‰‡`</span>))</span><span class="javascript">                        &#125;</span><span class="javascript">                        <span class="hljs-built_in">this</span>.showImgList.push(response.data.filepath)</span><span class="javascript">                        <span class="hljs-built_in">this</span>.$emit(<span class="hljs-string">&#x27;update:data&#x27;</span>, <span class="hljs-built_in">this</span>.showImgList)</span><span class="javascript">                    &#125;</span><span class="javascript">                &#125;</span><span class="javascript">            &#125; <span class="hljs-keyword">catch</span> (error) &#123;</span><span class="javascript">                <span class="hljs-built_in">this</span>.$message.error(error.message)</span><span class="javascript">            &#125; <span class="hljs-keyword">finally</span> &#123;</span><span class="javascript">                <span class="hljs-built_in">this</span>.loading = <span class="hljs-literal">false</span></span><span class="javascript">                <span class="hljs-built_in">this</span>.$refs.imageListUpload &amp;&amp; <span class="hljs-built_in">this</span>.$refs.imageListUpload.clearFiles()</span><span class="javascript">                <span class="hljs-built_in">this</span>.$refs.imageUpload &amp;&amp; <span class="hljs-built_in">this</span>.$refs.imageUpload.clearFiles()</span><span class="javascript">            &#125;</span><span class="javascript">        &#125;,</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">removeFile</span>(<span class="hljs-params">index</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-built_in">this</span>.$confirm(<span class="hljs-string">&#x27;ç¡®å®šåˆ é™¤è¯¥å›¾ç‰‡å—?&#x27;</span>, <span class="hljs-string">&#x27;æç¤º&#x27;</span>, &#123;</span><span class="javascript">                <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">&#x27;ç¡®å®š&#x27;</span>,</span><span class="javascript">                <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">&#x27;å–æ¶ˆ&#x27;</span>,</span><span class="javascript">                <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;warning&#x27;</span></span><span class="javascript">            &#125;).then(<span class="hljs-function">() =&gt;</span> &#123;</span><span class="javascript">                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.type === <span class="hljs-string">&#x27;image&#x27;</span>) &#123;</span><span class="javascript">                    <span class="hljs-built_in">this</span>.$emit(<span class="hljs-string">&#x27;update:data&#x27;</span>, <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">this</span>.data === <span class="hljs-string">&#x27;object&#x27;</span> ? &#123;&#125; : <span class="hljs-string">&#x27;&#x27;</span>)</span><span class="javascript">                &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">                    <span class="hljs-built_in">this</span>.showImgList.splice(index, <span class="hljs-number">1</span>)</span><span class="javascript">                    <span class="hljs-built_in">this</span>.$emit(<span class="hljs-string">&#x27;update:data&#x27;</span>, <span class="hljs-built_in">this</span>.showImgList)</span><span class="javascript">                &#125;</span><span class="javascript">            &#125;)</span><span class="javascript">        &#125;,</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">onError</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">            <span class="hljs-built_in">this</span>.$message.error(<span class="hljs-string">&#x27;ä¸Šä¼ æ–‡ä»¶å¤±è´¥&#x27;</span>)</span><span class="javascript">        &#125;,</span><span class="javascript"></span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">dragChange</span>(<span class="hljs-params">ele</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-built_in">console</span>(ele.moved)</span><span class="javascript">        &#125;,</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">handleRemove</span>(<span class="hljs-params">file, fileList</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-keyword">let</span> imgList = fileList.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;</span><span class="javascript">                <span class="hljs-keyword">return</span> item.response.key</span><span class="javascript">            &#125;)</span><span class="javascript">            <span class="hljs-built_in">this</span>.$emit(<span class="hljs-string">&#x27;update:data&#x27;</span>, imgList)</span><span class="javascript">        &#125;,</span><span class="javascript">    &#125;</span><span class="javascript">&#125;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>æ³¨æ„åŠ¡å¿…æ³¨å†Œå¼•å…¥ç»„ä»¶</p><div class="code-wrapper"><pre><code class="hljs coffeescript"><span class="hljs-keyword">import</span> draggable <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuedraggable&#x27;</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;    ...    components: &#123;        draggable,    &#125;,    ...</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElementUI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åº”ç”¨ç¯‡ï¼š2.å»¶æ—¶ä»»åŠ¡</title>
    <link href="/2020/02/22/phpframe14/"/>
    <url>/2020/02/22/phpframe14/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><blockquote><p>å»¶æ—¶ä»»åŠ¡æœ‰åˆ«äºå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡å¾€å¾€æ˜¯å›ºå®šå‘¨æœŸçš„ï¼Œæœ‰æ˜ç¡®çš„è§¦å‘æ—¶é—´ã€‚è€Œå»¶æ—¶ä»»åŠ¡ä¸€èˆ¬æ²¡æœ‰å›ºå®šçš„å¼€å§‹æ—¶é—´ï¼Œå®ƒå¸¸å¸¸æ˜¯ç”±ä¸€ä¸ªäº‹ä»¶è§¦å‘çš„ï¼Œè€Œåœ¨è¿™ä¸ªäº‹ä»¶è§¦å‘ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…è§¦å‘å¦ä¸€ä¸ªäº‹ä»¶ã€‚</p></blockquote><p>æˆ‘ä»¬ä¸å¦¨æ¥è®¾å®šä¸€ä¸ªå®é™…çš„åœºæ™¯ï¼Œç”µå•†ç³»ç»Ÿä¸‹å•æˆåŠŸä¹‹åå¦‚æœ15åˆ†é’Ÿæœªæ”¯ä»˜æˆåŠŸï¼Œå°±ç³»ç»Ÿè‡ªåŠ¨å–æ¶ˆè®¢å•ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥å®ç°ä»£ç ï¼Œç„¶åå†æ¥è¯¦ç»†è¯´æ˜ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªabstractï¼Œå®šä¹‰ä¸¤ä¸ªæ–¹æ³•ï¼ŒstartAfterå’ŒstartAt</span><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DelayTask</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">const</span> DELAY_TASK = <span class="hljs-string">&#x27;delayTask&#x27;</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å»¶æ—¶æ—¶é—´ï¼Œåœ¨è§¦å‘æ—¶é—´åå¤šä¹…æ‰§è¡Œ</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> $pushDelayTime</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startAfter</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-variable">$pushDelayTime</span></span>)</span><span class="hljs-function">    </span>&#123;        RedisManager::getRedis()-&gt;zAdd(<span class="hljs-built_in">self</span>::DELAY_TASK, time() + <span class="hljs-variable">$pushDelayTime</span>, serialize(<span class="hljs-keyword">$this</span>));    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å®šæ—¶æ—¶é—´ï¼Œåœ¨æœªæ¥æŸæ—¶åˆ»æ‰§è¡Œ</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> $pushDelayAt</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startAt</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-variable">$pushDelayAt</span></span>)</span><span class="hljs-function">    </span>&#123;        RedisManager::getRedis()-&gt;zAdd(<span class="hljs-built_in">self</span>::DELAY_TASK, <span class="hljs-variable">$pushDelayAt</span>, serialize(<span class="hljs-keyword">$this</span>));    &#125;    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>)</span>;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestDelayTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DelayTask</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;id = <span class="hljs-variable">$id</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$file</span>  = <span class="hljs-string">&#x27;text.txt&#x27;</span>;<span class="hljs-comment">//è¦å†™å…¥æ–‡ä»¶çš„æ–‡ä»¶åï¼ˆå¯ä»¥æ˜¯ä»»æ„æ–‡ä»¶åï¼‰ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ª</span>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;å†™å…¥çš„å†…å®¹&quot;</span>.time().<span class="hljs-string">&quot;\n&quot;</span>;        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$f</span> = file_put_contents(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$content</span>,FILE_APPEND))&#123;<span class="hljs-comment">// è¿™ä¸ªå‡½æ•°æ”¯æŒç‰ˆæœ¬(PHP 5)</span>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å†™å…¥æˆåŠŸã€‚&lt;br /&gt;&quot;</span>;        &#125;    &#125;&#125;</code></pre></div><p>RedisManageræ˜¯å°è£…çš„ä¸€ä¸ªå•ä¾‹æ¨¡å¼å®ç°çš„Redisç±»ï¼Œæˆ‘ä»¬ä¹Ÿè´´å‡ºä»£ç ï¼Œç„¶åå†å¯¹ä¸Šé¢çš„ä»£ç åšä¸€äº›è¯´æ˜ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisManager</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$instance</span> = <span class="hljs-literal">null</span>;    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> = <span class="hljs-keyword">new</span> \Redis();        <span class="hljs-variable">$config</span> = <span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;Redis.config.php&#x27;</span>;        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>-&gt;connect(<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;host&#x27;</span>], <span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;port&#x27;</span>], <span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;timeout&#x27;</span>]);        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;            <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>-&gt;auth(<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);        &#125;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è·å–é™æ€å®ä¾‹</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRedis</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>) &#123;            <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ç¦æ­¢clone</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;    &#125;&#125;</code></pre></div><h3 id="æœ‰åºé›†åˆ"><a href="#æœ‰åºé›†åˆ" class="headerlink" title="æœ‰åºé›†åˆ"></a>æœ‰åºé›†åˆ</h3><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">Redis</span> <span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD saif <span class="hljs-number">1</span> Redis(integer) <span class="hljs-number">1</span>Redis <span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD saif <span class="hljs-number">2</span> mongodb(integer) <span class="hljs-number">1</span>Redis <span class="hljs-number">127.0.0.1:6379</span>&gt; ZADD saif <span class="hljs-number">4</span> mysql(integer) <span class="hljs-number">0</span>Redis <span class="hljs-number">127.0.0.1:6379</span>&gt; ZRANGE saif <span class="hljs-number">0</span> <span class="hljs-number">10</span> WITHSCORES<span class="hljs-number">1</span>) <span class="hljs-string">&quot;Redis&quot;</span><span class="hljs-number">2</span>) <span class="hljs-string">&quot;1&quot;</span><span class="hljs-number">3</span>) <span class="hljs-string">&quot;mongodb&quot;</span><span class="hljs-number">4</span>) <span class="hljs-string">&quot;2&quot;</span><span class="hljs-number">5</span>) <span class="hljs-string">&quot;mysql&quot;</span><span class="hljs-number">6</span>) <span class="hljs-string">&quot;4&quot;</span></code></pre></div><p>å¦‚æœä½ æœ‰Rediså¯è§†åŒ–å·¥å…·ï¼Œä½ ä¼šå‘ç°æœ‰åºé›†åˆå­˜å‚¨çš„ç»“æ„æ˜¯è¿™æ ·ï¼š</p><table><thead><tr><th>row</th><th>value</th><th>score</th></tr></thead><tbody><tr><td>1</td><td>Redis</td><td>1</td></tr><tr><td>2</td><td>mongodb</td><td>2</td></tr><tr><td>3</td><td>mysql</td><td>4</td></tr></tbody></table><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºåˆ†å€¼ï¼Œä½¿ç”¨å¯¹è±¡ä½œä¸ºå€¼ï¼Œå­˜å‚¨åˆ°Redisæœ‰åºé›†åˆã€‚</p><blockquote><p>file_put_contents ( string $filename , mixed $data [, int $flags = 0 [, resource $context ]] ) : int   â€” å°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶</p></blockquote><h3 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h3><div class="code-wrapper"><pre><code class="hljs livescript">æˆ‘ä»¬å…ˆå°è¯•å†™å…¥ä»»åŠ¡ï¼š<span class="hljs-function"><span class="hljs-params">(<span class="hljs-keyword">new</span> TestDelayTask(<span class="hljs-number">4</span>))</span>-&gt;</span>startAfter(<span class="hljs-number">900</span>);<span class="hljs-function"><span class="hljs-params">(<span class="hljs-keyword">new</span> TestDelayTask(<span class="hljs-number">4</span>))</span>-&gt;</span>startAfter(<span class="hljs-number">120</span>);<span class="hljs-function"><span class="hljs-params">(<span class="hljs-keyword">new</span> TestDelayTask(<span class="hljs-number">4</span>))</span>-&gt;</span>startAfter(<span class="hljs-number">600</span>);<span class="hljs-function"><span class="hljs-params">(<span class="hljs-keyword">new</span> TestDelayTask(<span class="hljs-number">3</span>))</span>-&gt;</span>startAt(<span class="hljs-number">158120384</span>);<span class="hljs-function"><span class="hljs-params">(<span class="hljs-keyword">new</span> TestDelayTask(<span class="hljs-number">3</span>))</span>-&gt;</span>startAt(<span class="hljs-number">158420380</span>);<span class="hljs-function"><span class="hljs-params">(<span class="hljs-keyword">new</span> TestDelayTask(<span class="hljs-number">3</span>))</span>-&gt;</span>startAt(<span class="hljs-number">158120900</span>);</code></pre></div><p>æ‰§è¡Œä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DelayTaskTask</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">const</span> QueneName = <span class="hljs-string">&#x27;delayTask&#x27;</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$currentTime</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$once</span> = <span class="hljs-number">5</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;currentTime = time();        error_reporting(error_reporting() &amp; ~E_WARNING);        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;            <span class="hljs-comment">// æ¯æ¬¡å–å‡º5æ¡</span>            <span class="hljs-variable">$list</span> = RedisManager::getRedis()-&gt;zRange(<span class="hljs-built_in">self</span>::QueneName, <span class="hljs-number">0</span>, <span class="hljs-keyword">$this</span>-&gt;once, <span class="hljs-literal">true</span>);            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$list</span>)) &#123;                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$list</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$val</span>=&gt;<span class="hljs-variable">$score</span>) &#123;                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$score</span> &lt; <span class="hljs-keyword">$this</span>-&gt;currentTime) &#123;                        unserialize(<span class="hljs-variable">$val</span>)-&gt;run();                        RedisManager::getRedis()-&gt;zDelete(<span class="hljs-built_in">self</span>::QueneName, <span class="hljs-variable">$val</span>);                    &#125; <span class="hljs-keyword">else</span> &#123;                        <span class="hljs-keyword">break</span> <span class="hljs-number">2</span>;                    &#125;                &#125;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-keyword">break</span>;            &#125;        &#125;    &#125;&#125;(<span class="hljs-keyword">new</span> DelayTaskTask())-&gt;run();</code></pre></div><p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ä¸Šè¿°ä»£ç ã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œä¹‹åï¼Œä¼šå‘ç°ä¸€æ—¦è¿‡äº†æˆ‘ä»¬è®¾å®šçš„æ—¶é—´ï¼Œtext.txtå°±ä¸æ–­æœ‰æ–‡å­—å†™å…¥äº†ã€‚</p><p>ä»£ç æ¯”è¾ƒæ‚ï¼Œæˆ‘æœ‰ä¸€ä¸ªdemoä»£ç ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹ã€‚</p><p><a href="https://github.com/13sai/wheels/tree/master/DelayTask-%E5%9F%BA%E4%BA%8ERedis%E7%9A%84%E5%BB%B6%E6%97%B6%E4%BB%BB%E5%8A%A1">DelayTask-åŸºäºRedisçš„å»¶æ—¶ä»»åŠ¡</a></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨Redisæœ‰åºé›†åˆï¼Œå®Œæˆäº†ä¸€ä¸ªå¾ˆåŸºç¡€çš„å»¶æ—¶ä»»åŠ¡ã€‚</p><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul><li>åŠ å…¥runæ–¹æ³•ä»£ç æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</li><li>æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œé—´éš”æœ‰ç‚¹é•¿ï¼Œèƒ½ä¸èƒ½ä¼˜åŒ–å‘¢ï¼Ÿ</li></ul>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åº”ç”¨ç¯‡ï¼š1.åˆ†å¸ƒå¼é”</title>
    <link href="/2020/02/22/phpframe13/"/>
    <url>/2020/02/22/phpframe13/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><h3 id="å«ä¹‰"><a href="#å«ä¹‰" class="headerlink" title="å«ä¹‰"></a>å«ä¹‰</h3><blockquote><p>ä¸ºäº†é˜²æ­¢åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šä¸ªè¿›ç¨‹ä¹‹é—´ç›¸äº’å¹²æ‰°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§åˆ†å¸ƒå¼åè°ƒæŠ€æœ¯æ¥å¯¹è¿™äº›è¿›ç¨‹è¿›è¡Œè°ƒåº¦ã€‚è€Œè¿™ä¸ªåˆ†å¸ƒå¼åè°ƒæŠ€æœ¯çš„æ ¸å¿ƒå°±æ˜¯æ¥å®ç°è¿™ä¸ªåˆ†å¸ƒå¼é”ã€‚</p></blockquote><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªæœºå™¨çš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</li><li>é«˜å¯ç”¨çš„è·å–é”ä¸é‡Šæ”¾é”</li><li>é«˜æ€§èƒ½çš„è·å–é”ä¸é‡Šæ”¾é”</li><li>å…·å¤‡å¯é‡å…¥ç‰¹æ€§ï¼ˆå¯ç†è§£ä¸ºé‡æ–°è¿›å…¥ï¼Œç”±å¤šäºä¸€ä¸ªä»»åŠ¡å¹¶å‘ä½¿ç”¨ï¼Œè€Œä¸å¿…æ‹…å¿ƒæ•°æ®é”™è¯¯ï¼‰</li><li>å…·å¤‡é”å¤±æ•ˆæœºåˆ¶ï¼Œé˜²æ­¢æ­»é”</li><li>å…·å¤‡éé˜»å¡é”ç‰¹æ€§ï¼Œå³æ²¡æœ‰è·å–åˆ°é”å°†ç›´æ¥è¿”å›è·å–é”å¤±è´¥</li></ul><h3 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h3><p>å¸¸è§çš„æœ‰ï¼š</p><ul><li>åŸºäºRedis</li><li>åŸºäºmysql</li><li>åŸºäºZookeeper</li></ul><h3 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h3><p>è€ƒè™‘åˆ°æˆ‘ä»¬ä½¿ç”¨çš„PHPè¯­è¨€ï¼Œç®€å•ç»“åˆRedisæ¥å®ç°ä¸€ä¸‹åˆ†å¸ƒå¼é”ã€‚</p><p>æˆ‘ä»¬æ¥ç”»ä¸ªç®€å•çš„åŸç†å›¾ï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/202002/25/41489/ov5tcJmAKT.png!large" alt="image"></p><p>åŸç†ååˆ†ç®€å•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><ul><li>Redisçš„setnxæ–¹æ³•</li><li>phpçš„register</li></ul><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processLock</span>(<span class="hljs-params"><span class="hljs-variable">$Redis</span>, <span class="hljs-variable">$key</span>, <span class="hljs-variable">$ttl</span> = <span class="hljs-number">5</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$ret</span> = <span class="hljs-variable">$Redis</span>-&gt;setnx(<span class="hljs-variable">$key</span>, <span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$ret</span>) &#123;        <span class="hljs-variable">$Redis</span>-&gt;expire(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$ttl</span>);        register_shutdown_function(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) <span class="hljs-keyword">use</span> (<span class="hljs-params"><span class="hljs-variable">$Redis</span>, <span class="hljs-variable">$key</span></span>)</span>&#123;            <span class="hljs-variable">$Redis</span>-&gt;del(<span class="hljs-variable">$key</span>);            &#125;);    &#125;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ret</span>;&#125;</code></pre></div><p>demoé‡Œçš„$Redisæ˜¯ä¸€ä¸ªRediså®ä¾‹ï¼Œæˆ‘ä»¬åœ¨å‰é¢å·²ç»å®ç°è¿‡ï¼Œä¸å¤šè¯´æ˜ã€‚</p><h4 id="åŠ é”"><a href="#åŠ é”" class="headerlink" title="åŠ é”"></a>åŠ é”</h4><p>æˆ‘ä»¬ä½¿ç”¨çš„setnxå‘½ä»¤ï¼Œsenxè¡¨ç¤ºâ€œSET if Not eXistsâ€ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™setï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸set</p><div class="code-wrapper"><pre><code class="hljs pgsql">Redis&gt; SETNX mykey &quot;Hello&quot;(<span class="hljs-type">integer</span>) <span class="hljs-number">1</span>Redis&gt; SETNX mykey &quot;World&quot;(<span class="hljs-type">integer</span>) <span class="hljs-number">0</span>Redis&gt; <span class="hljs-keyword">GET</span> mykey&quot;Hello&quot;</code></pre></div><h4 id="è§£é”"><a href="#è§£é”" class="headerlink" title="è§£é”"></a>è§£é”</h4><p>ä½¿ç”¨çš„æ˜¯delï¼Œå³åˆ é™¤è¿™ä¸ªkeyã€‚è¿™é‡Œç»“åˆäº† register_shutdown_function â€” æ³¨å†Œä¸€ä¸ªä¼šåœ¨phpä¸­æ­¢æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼Œè®¾ç½®äº†ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä¸å¿…æ‰‹åŠ¨å»è§£é”</p><h4 id="é”è¶…æ—¶"><a href="#é”è¶…æ—¶" class="headerlink" title="é”è¶…æ—¶"></a>é”è¶…æ—¶</h4><p>è¿™é‡Œç»™é”åŠ äº†ä¸€ä¸ªexpireè¿‡æœŸæ—¶é—´5ç§’ï¼Œç›®çš„æ˜¯é˜²æ­¢ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¹‹åçš„æ‰§è¡Œäº†â€œç¥å¥‡â€ä»£ç æŠ›å‡ºäº†è¯­æ³•é”™è¯¯ï¼Œå¯¼è‡´register_shutdown_functioné‡Œçš„ä»£ç æ²¡æœ‰æ‰§è¡Œï¼Œè™½ç„¶è¯·æ±‚ç»“æŸï¼Œä½†æ˜¯åŠ é”åï¼Œæ²¡æœ‰è§£é”ï¼Œå½±å“äº†åç»­è¯·æ±‚ã€‚</p><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul><li>åŠ å…¥setnxä¹‹åexpireä¹‹å‰ç¨‹åºå¼‚å¸¸äº†æ€ä¹ˆåŠï¼Ÿ</li></ul>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RedisæŒä¹…åŒ–aofå’Œrdb</title>
    <link href="/2020/02/16/aof/"/>
    <url>/2020/02/16/aof/</url>
    
    <content type="html"><![CDATA[<h1 id="RedisæŒä¹…"><a href="#RedisæŒä¹…" class="headerlink" title="RedisæŒä¹…"></a>RedisæŒä¹…</h1><p>æŒä¹…åŒ–çš„åŠŸèƒ½:Redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†é¿å…è¿›ç¨‹é€€å‡ºå¯¼è‡´æ•°æ®çš„æ°¸ä¹…ä¸¢å¤±ï¼Œéœ€è¦å®šæœŸå°†Redisä¸­çš„æ•°æ®ä»¥æŸç§å½¢å¼(æ•°æ®æˆ–å‘½ä»¤) ä»å†…å­˜ä¿å­˜åˆ°ç¡¬ç›˜ã€‚ å½“ä¸‹æ¬¡Redisé‡å¯æ—¶ï¼Œåˆ©ç”¨æŒä¹…åŒ–æ–‡ä»¶å®ç°æ•°æ®æ¢å¤ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†è¿›è¡Œç¾éš¾å¤‡ä»½ï¼Œå¯ä»¥å°†æŒä¹…åŒ–æ–‡ä»¶æ‹·è´åˆ°ä¸€ä¸ªè¿œç¨‹ä½ç½®ã€‚</p><p>RedisæŒä¹…åŒ–åˆ†ä¸ºRDBæŒä¹…åŒ–å’ŒAOFæŒä¹…åŒ–ï¼Œå‰è€…å°†å½“å‰æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ï¼Œåè€…åˆ™æ˜¯å°†æ¯æ¬¡æ‰§è¡Œçš„å†™å‘½ä»¤ä¿å­˜åˆ°ç¡¬ç›˜ã€‚</p><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><blockquote><p>RDBæ˜¯ä¸€ç§å¿«ç…§å­˜å‚¨æŒä¹…åŒ–æ–¹å¼ï¼Œå…·ä½“å°±æ˜¯å°†RedisæŸä¸€æ—¶åˆ»çš„å†…å­˜æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜çš„æ–‡ä»¶å½“ä¸­ï¼Œé»˜è®¤ä¿å­˜çš„æ–‡ä»¶åä¸ºdump.rdbï¼Œè€Œåœ¨RedisæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œä¼šé‡æ–°åŠ è½½dump.rdbæ–‡ä»¶çš„æ•°æ®åˆ°å†…å­˜å½“ä¸­æ¢å¤æ•°æ®ã€‚ ï¼Œè§¦å‘ RDB æŒä¹…åŒ–è¿‡ç¨‹åˆ†ä¸ºæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘ã€‚</p></blockquote><h3 id="è§¦å‘æœºåˆ¶"><a href="#è§¦å‘æœºåˆ¶" class="headerlink" title="è§¦å‘æœºåˆ¶"></a>è§¦å‘æœºåˆ¶</h3><p>save å‘½ä»¤:é˜»å¡å½“å‰ Redis æœåŠ¡å™¨ï¼Œç›´åˆ° RDB è¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œå¯¹äºå†…å­˜æ¯”è¾ƒå¤§çš„å®ä¾‹ä¼šé€ æˆé•¿æ—¶é—´é˜»å¡ï¼Œçº¿ä¸Šç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚</p><p>bgsave å‘½ä»¤:Redis è¿›ç¨‹æ‰§è¡Œ fork æ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼ŒRDB æŒä¹…åŒ–è¿‡ç¨‹ç”±å­è¿›ç¨‹è´Ÿè´£ï¼Œå®Œæˆåè‡ªåŠ¨ç»“æŸã€‚é˜»å¡åªå‘ç”Ÿåœ¨ fork é˜¶æ®µï¼Œä¸€èˆ¬æ—¶é—´å¾ˆçŸ­ã€‚</p><p>æ˜¾ç„¶ bgsave å‘½ä»¤æ˜¯é’ˆå¯¹ saveé˜»å¡é—®é¢˜åšçš„ä¼˜åŒ–ã€‚å› æ­¤ Redis å†…éƒ¨æ‰€æœ‰çš„æ¶‰åŠ RDB çš„æ“ä½œéƒ½é‡‡ç”¨ bgsave çš„æ–¹å¼ã€‚</p><p>é™¤äº†æ‰§è¡Œå‘½ä»¤æ‰‹åŠ¨è§¦å‘ä¹‹å¤–ï¼ŒRedis å†…éƒ¨è¿˜å­˜åœ¨è‡ªåŠ¨è§¦å‘ RDB çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œä¾‹å¦‚ä»¥ä¸‹åœºæ™¯:</p><ol><li>ä½¿ç”¨ save ç›¸å…³é…ç½®ï¼Œå¦‚â€œsave m nâ€ã€‚è¡¨ç¤º m ç§’å†…æ•°æ®é›†å­˜åœ¨ n æ¬¡ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ bgsaveã€‚</li><li>å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œ bgsave ç”Ÿæˆ RDB æ–‡ä»¶å¹¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚</li><li>æ‰§è¡Œ debug reload å‘½ä»¤é‡æ–°åŠ è½½ Redis æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨è§¦å‘ save æ“ä½œã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œ shutdown å‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½åˆ™è‡ªåŠ¨æ‰§è¡Œ bgsaveã€‚</li></ol><h3 id="bgsaveæµç¨‹"><a href="#bgsaveæµç¨‹" class="headerlink" title="bgsaveæµç¨‹"></a>bgsaveæµç¨‹</h3><p><img src="http://img1.sycdn.imooc.com/5c8518900001734506990490.png" alt="bgsaveæµç¨‹"></p><ol><li>æ‰§è¡Œ bgsave å‘½ä»¤ï¼ŒRedis çˆ¶è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œå¦‚ RDB/AOF å­è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨ bgsave å‘½ä»¤ç›´æ¥è¿”å›ã€‚</li><li>çˆ¶è¿›ç¨‹æ‰§è¡Œ fork æ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œforkæ“ä½œè¿‡ç¨‹ä¸­çˆ¶è¿›ç¨‹ä¼šé˜»å¡ã€‚</li><li>çˆ¶è¿›ç¨‹ fork å®Œæˆåï¼Œbgsave å‘½ä»¤è¿”å›â€œBackground saving startedâ€ä¿¡æ¯å¹¶ä¸å†é˜»å¡çˆ¶è¿›ç¨‹ï¼Œå¯ä»¥ç»§ç»­å“åº”å…¶ä»–å‘½ä»¤ã€‚</li><li>å­è¿›ç¨‹ä¼šå…±äº«ä¸€éƒ¨åˆ†ä¸»è¿›ç¨‹çš„æ•°æ®ç©ºé—´ï¼Œå¹¶ä¸”æŠŠå…±äº«çš„æ•°æ®ç½®ä¸ºread-onlyçš„çŠ¶æ€ï¼Œå­è¿›ç¨‹åˆ›å»º RDB æ–‡ä»¶ï¼Œæ ¹æ®çˆ¶è¿›ç¨‹å†…å­˜ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶ï¼Œå®Œæˆåå¯¹åŸæœ‰æ–‡ä»¶è¿›è¡ŒåŸå­æ›¿æ¢ã€‚åœ¨æŒä¹…åŒ–çš„è¿‡ç¨‹ä¸­æ˜¯é¿å…ä¸äº†æœ‰æ–°çš„æ•°æ®å†™å…¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€éƒ¨åˆ†çš„æ•°æ®æ˜¯å…±äº«çš„ï¼Œä¸¤ä¸ªè¿›ç¨‹åŒæ—¶æ‹¥æœ‰ä¸€å—æ•°æ®ï¼Œè‚¯å®šä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œ ä½†æ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„forkæœºåˆ¶ï¼Œåœ¨ä¿®æ”¹çš„æ—¶å€™ä¸€å®šæ˜¯ä¿®æ”¹éƒ¨åˆ†å†…å­˜é¡µçš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè§¦å‘å¯¹åº”å†…å­˜é¡µçš„copyonwriteçš„æ“ä½œ</li><li>è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚</li></ol><h3 id="é…ç½®æ–‡ä»¶ï¼ˆæµç¨‹ç±»ä¼¼bgsaveï¼‰"><a href="#é…ç½®æ–‡ä»¶ï¼ˆæµç¨‹ç±»ä¼¼bgsaveï¼‰" class="headerlink" title="é…ç½®æ–‡ä»¶ï¼ˆæµç¨‹ç±»ä¼¼bgsaveï¼‰"></a>é…ç½®æ–‡ä»¶ï¼ˆæµç¨‹ç±»ä¼¼bgsaveï¼‰</h3><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># 900så†…è‡³å°‘è¾¾åˆ°ä¸€æ¡å†™å‘½ä»¤ </span><span class="hljs-attribute">save</span> <span class="hljs-number">900</span> <span class="hljs-number">1</span><span class="hljs-comment"># 300så†…è‡³å°‘è¾¾è‡³10æ¡å†™å‘½ä»¤ </span><span class="hljs-attribute">save</span> <span class="hljs-number">300</span> <span class="hljs-number">10</span><span class="hljs-comment"># 60så†…è‡³å°‘è¾¾åˆ°10000æ¡å†™å‘½ä»¤ </span><span class="hljs-attribute">save</span> <span class="hljs-number">60</span> <span class="hljs-number">10000</span></code></pre></div><h3 id="RDB-æ–‡ä»¶çš„å¤„ç†"><a href="#RDB-æ–‡ä»¶çš„å¤„ç†" class="headerlink" title="RDB æ–‡ä»¶çš„å¤„ç†"></a>RDB æ–‡ä»¶çš„å¤„ç†</h3><h5 id="1-ä¿å­˜"><a href="#1-ä¿å­˜" class="headerlink" title="1. ä¿å­˜:"></a>1. ä¿å­˜:</h5><p>RDB æ–‡ä»¶ä¿å­˜åœ¨ dir é…ç½®æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åé€šè¿‡ dbfilename é…ç½®æŒ‡å®šã€‚å¯ä»¥é€šè¿‡æ‰§è¡Œ config set dir{newDir}å’Œ config set<br>dbfilename{newFileName}è¿è¡ŒæœŸåŠ¨æ€æ‰§è¡Œï¼Œå½“ä¸‹æ¬¡è¿è¡Œæ—¶ RDB æ–‡ä»¶ä¼šä¿å­˜åˆ°æ–°ç›®å½•ã€‚<br>å½“é‡åˆ°åç›˜æˆ–ç£ç›˜å†™æ»¡ç­‰æƒ…å†µæ—¶ï¼Œå¯ä»¥é€šè¿‡ config set dir{newDir}åœ¨çº¿ä¿®æ”¹æ–‡ä»¶è·¯å¾„åˆ°å¯ç”¨çš„ç£ç›˜è·¯å¾„ï¼Œä¹‹åæ‰§è¡Œ bgsave è¿›è¡Œç£ç›˜åˆ‡æ¢ï¼ŒåŒæ ·é€‚ç”¨äº AOF æŒä¹…åŒ–æ–‡ä»¶ã€‚</p><h5 id="2-å‹ç¼©"><a href="#2-å‹ç¼©" class="headerlink" title="2. å‹ç¼©:"></a>2. å‹ç¼©:</h5><p>Redis é»˜è®¤é‡‡ç”¨ LZF ç®—æ³•å¯¹ç”Ÿæˆçš„ RDB æ–‡ä»¶åšå‹ç¼©å¤„ç†ï¼Œå‹ç¼©åçš„æ–‡ä»¶è¿œè¿œå°äºå†…å­˜å¤§å°ï¼Œé»˜è®¤å¼€å¯ï¼Œå¯ä»¥é€šè¿‡å‚æ•° config set rdbcompression{yes|no}åŠ¨æ€ä¿®æ”¹ã€‚<br>è™½ç„¶å‹ç¼© RDB ä¼šæ¶ˆè€— CPUï¼Œä½†å¯å¤§å¹…é™ä½æ–‡ä»¶çš„ä½“ç§¯ï¼Œæ–¹ä¾¿ä¿å­˜åˆ°ç¡¬ç›˜æˆ–é€šè¿‡ç½‘ç»œå‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå› æ­¤çº¿ä¸Šå»ºè®®å¼€å¯ã€‚</p><h3 id="RDBæ–¹å¼çš„ä¼˜ç‚¹"><a href="#RDBæ–¹å¼çš„ä¼˜ç‚¹" class="headerlink" title="RDBæ–¹å¼çš„ä¼˜ç‚¹"></a>RDBæ–¹å¼çš„ä¼˜ç‚¹</h3><ol><li>RDB æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„æ–‡ä»¶ï¼Œå®ƒä¿å­˜äº† Redis åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®é›†ã€‚è¿™ç§æ–‡ä»¶éå¸¸é€‚åˆç”¨äºè¿›è¡Œå¤‡ä»½: æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥åœ¨æœ€è¿‘çš„ 24å°æ—¶å†…ï¼Œæ¯å°æ—¶å¤‡ä»½ä¸€æ¬¡ RDBæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæœˆçš„æ¯ä¸€å¤©ï¼Œä¹Ÿå¤‡ä»½ä¸€ä¸ª RDB æ–‡ä»¶ã€‚ è¿™æ ·çš„è¯ï¼Œå³ä½¿é‡ä¸Šé—®é¢˜ï¼Œä¹Ÿå¯ä»¥éšæ—¶å°†æ•°æ®é›†è¿˜åŸåˆ°ä¸åŒçš„ç‰ˆæœ¬ã€‚</li><li>RDB å¯ä»¥æœ€å¤§åŒ– Redis çš„æ€§èƒ½:çˆ¶è¿›ç¨‹åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶å”¯ä¸€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åè¿™ä¸ªå­è¿›ç¨‹å°±ä¼šå¤„ç†æ¥ä¸‹æ¥çš„æ‰€æœ‰ä¿å­˜ å·¥ä½œï¼Œçˆ¶è¿›ç¨‹æ— é¡»æ‰§è¡Œä»»ä½•ç£ç›˜ I/O æ“ä½œã€‚</li><li>RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</li></ol><h3 id="RDBæ–¹å¼çš„ç¼ºç‚¹"><a href="#RDBæ–¹å¼çš„ç¼ºç‚¹" class="headerlink" title="RDBæ–¹å¼çš„ç¼ºç‚¹"></a>RDBæ–¹å¼çš„ç¼ºç‚¹</h3><ol><li>RDB æ–¹å¼æ•°æ®æ²¡åŠæ³•åšåˆ°å®æ—¶æŒä¹…åŒ–/ç§’çº§æŒä¹…åŒ–ã€‚ å¦‚æœæœåŠ¡å™¨å®•æœºçš„è¯ï¼Œé‡‡ç”¨RDBçš„æ–¹å¼ä¼šé€ æˆæŸä¸ªæ—¶æ®µå†…æ•°æ®çš„ä¸¢å¤±ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾ç½®10åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æˆ–5åˆ†é’Ÿè¾¾åˆ°1000æ¬¡å†™å…¥å°±åŒæ­¥ä¸€æ¬¡ï¼Œé‚£ä¹ˆå¦‚æœè¿˜æ²¡è¾¾åˆ°è§¦å‘æ¡ä»¶æœåŠ¡å™¨å°±æ­»æœºäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´æ®µçš„æ•°æ®ä¼šä¸¢å¤±ã€‚</li><li>ä½¿ç”¨bgsaveå‘½ä»¤åœ¨forkså­è¿›ç¨‹æ—¶ï¼Œå¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œforksçš„è¿‡ç¨‹ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ï¼Œå¦å¤–ï¼Œforkså­è¿›ç¨‹ä¼šè€—è´¹å†…å­˜ã€‚</li></ol><h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><blockquote><p>AOF(append only file)æŒä¹…åŒ–:ä¸RDBå­˜å‚¨æŸä¸ªæ—¶åˆ»çš„å¿«ç…§ä¸åŒï¼ŒAOFæŒä¹…åŒ–æ–¹å¼ä¼šè®°å½•å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨çš„æ¯ä¸€æ¬¡å†™æ“ä½œå‘½ä»¤åˆ°æ—¥å¿—å½“ä¸­ï¼Œå¹¶å°†è¿™äº›å†™æ“ä½œä»¥Redisåè®®è¿½åŠ ä¿å­˜åˆ°ä»¥åç¼€ä¸ºaofæ–‡ä»¶æœ«å°¾</p></blockquote><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>Redis.conf</p><div class="code-wrapper"><pre><code class="hljs pgsql">appendonly yes #å¯ç”¨aofæŒä¹…åŒ–æ–¹å¼ appendfsync <span class="hljs-keyword">always</span>/<span class="hljs-keyword">no</span>/everysecè®¾ç½®ä¸º<span class="hljs-keyword">always</span>æ—¶ï¼Œä¼šæå¤§æ¶ˆå¼±Redisçš„æ€§èƒ½ï¼Œå› ä¸ºè¿™ç§æ¨¡å¼ä¸‹æ¯æ¬¡<span class="hljs-keyword">write</span>åéƒ½ä¼šè°ƒç”¨fsyncï¼ˆLinuxä¸ºè°ƒç”¨fdatasyncï¼‰ã€‚å¦‚æœè®¾ç½®ä¸º<span class="hljs-keyword">no</span>ï¼Œåˆ™<span class="hljs-keyword">write</span>åä¸ä¼šæœ‰fsyncè°ƒç”¨ï¼Œç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨è°ƒåº¦åˆ·ç£ç›˜ï¼Œæ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚everysecä¸ºæœ€å¤šæ¯ç§’è°ƒç”¨ä¸€æ¬¡fsyncï¼Œè¿™ç§æ¨¡å¼æ€§èƒ½å¹¶ä¸æ˜¯å¾ˆç³Ÿç³•ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šäº§ç”Ÿæ¯›åˆºï¼Œè¿™å½’åŠŸäºRediså¼•å…¥äº†BIOçº¿ç¨‹ï¼Œæ‰€æœ‰fsyncæ“ä½œéƒ½å¼‚æ­¥äº¤ç»™äº†BIOçº¿ç¨‹ã€‚</code></pre></div><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><img src="http://image.13sai.com/study/aof.png" alt="image"></p><ol><li>æ‰€æœ‰çš„å†™å…¥å‘½ä»¤ä¼šè¿½åŠ åˆ° aof_buf(ç¼“å†²åŒº)ä¸­ã€‚ï¼ˆRedisä½¿ç”¨å•çº¿ç¨‹å“åº”å‘½ä»¤ï¼Œå¦‚æœæ¯æ¬¡AOFæ–‡ä»¶å‘½ä»¤éƒ½è¿½åŠ åˆ°ç£ç›˜ï¼Œä¼šæå¤§çš„å½±å“å¤„ç†æ€§èƒ½ï¼‰</li><li>AOF ç¼“å†²åŒºæ ¹æ®å¯¹åº”çš„ç­–ç•¥å‘ç¡¬ç›˜åšåŒæ­¥æ“ä½œã€‚</li><li>éšç€ AOF æ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦å®šæœŸå¯¹ AOF æ–‡ä»¶è¿›è¡Œé‡å†™ï¼Œè¾¾åˆ°å‹ç¼©çš„ç›®çš„ã€‚</li><li>å½“ Redis æœåŠ¡å™¨é‡å¯æ—¶ï¼Œå¯ä»¥åŠ è½½ AOF æ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤ã€‚</li></ol><h3 id="é‡å†™æœºåˆ¶"><a href="#é‡å†™æœºåˆ¶" class="headerlink" title="é‡å†™æœºåˆ¶"></a>é‡å†™æœºåˆ¶</h3><blockquote><p>AOFå°†å®¢æˆ·ç«¯çš„æ¯ä¸€ä¸ªå†™æ“ä½œéƒ½è¿½åŠ åˆ°aofæ–‡ä»¶æœ«å°¾ï¼Œéšç€å‘½ä»¤ä¸æ–­å†™å…¥ AOFï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¼•å…¥äº†AOF é‡å†™æœºåˆ¶å‹ç¼©æ–‡ä»¶ä½“ç§¯ã€‚AOF æ–‡ä»¶é‡å†™æ˜¯æŠŠ Redis è¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤åŒæ­¥åˆ°æ–° AOF æ–‡ä»¶çš„è¿‡ç¨‹ã€‚ æ¯”å¦‚:<br>å¤šæ¡å†™å‘½ä»¤å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªï¼Œå¦‚:lpush list aã€lpush list bã€lpush list c å¯ä»¥è½¬åŒ–ä¸º:lpush list a b cã€‚ </p><p>AOF é‡å†™é™ä½äº†æ–‡ä»¶å ç”¨ç©ºé—´ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªç›®çš„æ˜¯:æ›´å°çš„ AOF æ–‡ä»¶å¯ä»¥æ›´å¿«åœ°è¢« Redis åŠ è½½ã€‚</p></blockquote><h3 id="é‡å†™æµç¨‹"><a href="#é‡å†™æµç¨‹" class="headerlink" title="é‡å†™æµç¨‹"></a>é‡å†™æµç¨‹</h3><p><img src="http://image.13sai.com/study/aof-rewrite.png" alt="é‡å†™æœºåˆ¶"></p><ol><li><p>æ‰§è¡Œ AOF é‡å†™è¯·æ±‚ã€‚ å¦‚æœå½“å‰è¿›ç¨‹æ­£åœ¨æ‰§è¡Œ AOF é‡å†™ï¼Œè¯·æ±‚ä¸æ‰§è¡Œå¹¶è¿”å›å¦‚ä¸‹å“åº”: ERR Background append only file rewriting already in progress</p></li><li><p>çˆ¶è¿›ç¨‹æ‰§è¡Œ fork åˆ›å»ºå­è¿›ç¨‹ï¼Œå¹¶æ‹¿åˆ°forkæ—¶çš„AOFæ–‡ä»¶æ•°æ®å†™åˆ°ä¸€ä¸ªä¸´æ—¶AOFæ–‡ä»¶ä¸­ã€‚</p></li><li><p>ä¸»è¿›ç¨‹ fork æ“ä½œå®Œæˆåï¼Œç»§ç»­å“åº”å…¶ä»–å‘½ä»¤ã€‚æ‰€æœ‰ä¿®æ”¹å‘½ä»¤ä¾ç„¶å†™å…¥ AOF ç¼“å†²åŒºå¹¶æ ¹æ® appendfsync ç­–ç•¥åŒæ­¥åˆ°ç¡¬ç›˜ï¼Œä¿è¯åŸæœ‰ AOF æœºåˆ¶æ­£ç¡® æ€§ã€‚</p></li><li><p>ç”±äº fork æ“ä½œè¿ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œå­è¿›ç¨‹åªèƒ½å…±äº« fork æ“ä½œæ—¶çš„å†…å­˜æ•°æ®ã€‚ç”±äºçˆ¶è¿›ç¨‹ä¾ç„¶å“åº”å‘½ä»¤ï¼ŒRedis ä½¿ç”¨â€œAOF é‡å†™ç¼“å†²åŒºâ€ä¿å­˜è¿™éƒ¨åˆ†æ–°æ•°æ®ï¼Œé˜²æ­¢æ–° AOF æ–‡ä»¶ç”ŸæˆæœŸé—´ä¸¢å¤±è¿™éƒ¨åˆ†æ•°æ®ã€‚</p></li><li><p>å­è¿›ç¨‹æ ¹æ®å†…å­˜å¿«ç…§ï¼ŒæŒ‰ç…§å‘½ä»¤åˆå¹¶è§„åˆ™å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ã€‚æ¯æ¬¡æ‰¹é‡å†™å…¥ç¡¬ç›˜æ•°æ®é‡ç”±é…ç½® aof-rewrite-incremental-fsync æ§åˆ¶ï¼Œé»˜è®¤ä¸º 32MBï¼Œé˜²æ­¢å• æ¬¡åˆ·ç›˜æ•°æ®è¿‡å¤šé€ æˆç¡¬ç›˜é˜»å¡ã€‚</p><p>5.1) æ–° AOF æ–‡ä»¶å†™å…¥å®Œæˆåï¼Œå­è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚<br>5.2) çˆ¶è¿›ç¨‹æŠŠ AOF é‡å†™ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ã€‚<br>5.3) ä½¿ç”¨æ–° AOF æ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ï¼Œå®Œæˆ AOF é‡å†™ã€‚</p></li></ol><h3 id="è§¦å‘é‡å†™"><a href="#è§¦å‘é‡å†™" class="headerlink" title="è§¦å‘é‡å†™"></a>è§¦å‘é‡å†™</h3><ol><li><p>æ‰‹åŠ¨è§¦å‘:ç›´æ¥è°ƒç”¨ bgrewriteaof å‘½ä»¤ã€‚</p></li><li><p>è‡ªåŠ¨è§¦å‘:æ ¹æ® auto-aof-rewrite-min-sizeå’Œauto-aof-rewrite-percentage å‚æ•°ç¡®å®šè‡ªåŠ¨è§¦å‘æ—¶æœºã€‚</p><div class="code-wrapper"><pre><code class="hljs coq"><span class="hljs-built_in">auto</span>-aof-<span class="hljs-built_in">rewrite</span>-min-size:è¡¨ç¤ºè¿è¡Œ AOF é‡å†™æ—¶æ–‡ä»¶æœ€å°ä½“ç§¯ï¼Œé»˜è®¤ä¸º <span class="hljs-number">64</span>MBã€‚<span class="hljs-built_in">auto</span>-aof-<span class="hljs-built_in">rewrite</span>-percentage:ä»£è¡¨å½“å‰ AOF æ–‡ä»¶ç©ºé—´(aof_current_size)å’Œä¸Šä¸€æ¬¡é‡å†™å AOF æ–‡ä»¶ç©ºé—´(aof_base_size)çš„æ¯”å€¼ã€‚ç¤ºä¾‹:<span class="hljs-built_in">auto</span>-aof-<span class="hljs-built_in">rewrite</span>-percentage:<span class="hljs-number">100</span> <span class="hljs-built_in">auto</span>-aof-<span class="hljs-built_in">rewrite</span>-min-size:<span class="hljs-number">64</span>mbé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡<span class="hljs-built_in">rewrite</span>åå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº<span class="hljs-number">64</span>Mæ—¶è§¦å‘</code></pre></div></li></ol><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>AOFæ–‡ä»¶æŸå<br>åœ¨å†™å…¥aofæ—¥å¿—æ–‡ä»¶æ—¶ï¼Œå¦‚æœRedisæœåŠ¡å™¨å®•æœºï¼Œåˆ™aofæ—¥å¿—æ–‡ä»¶æ–‡ä»¶ä¼šå‡ºæ ¼å¼é”™è¯¯ï¼Œåœ¨é‡å¯RedisæœåŠ¡å™¨æ—¶ï¼ŒRedisæœåŠ¡å™¨ä¼šæ‹’ç»è½½å…¥è¿™ä¸ªaofæ–‡ä»¶ï¼Œ å¯ä»¥é€šè¿‡å‘½ä»¤ä¿®å¤aofå¹¶æ¢å¤æ•°æ®</p><blockquote><p>Redis-check-aof -fix file.aof</p></blockquote><h3 id="AOFçš„ä¼˜ç‚¹"><a href="#AOFçš„ä¼˜ç‚¹" class="headerlink" title="AOFçš„ä¼˜ç‚¹"></a>AOFçš„ä¼˜ç‚¹</h3><ol><li>AOFå¯ä»¥è®¾ç½® å®Œå…¨ä¸åŒæ­¥ã€æ¯ç§’åŒæ­¥ã€æ¯æ¬¡æ“ä½œåŒï¼Œé»˜è®¤æ˜¯æ¯ç§’åŒæ­¥ã€‚å› ä¸ºAOFæ˜¯æ“ä½œæŒ‡ä»¤çš„è¿½åŠ ï¼Œæ‰€ä»¥å¯ä»¥é¢‘ç¹çš„å¤§é‡çš„åŒæ­¥ã€‚</li><li>AOFæ–‡ä»¶æ˜¯ä¸€ä¸ªå€¼è¿½åŠ æ—¥å¿—çš„æ–‡ä»¶ï¼Œå³ä½¿æœåŠ¡å®•æœºä¸ºå†™å…¥å®Œæ•´çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Redis-check-aofå·¥å…·ä¿®å¤è¿™äº›é—®é¢˜ã€‚</li><li>å¦‚æœAOFæ–‡ä»¶è¿‡å¤§ï¼ŒRedisä¼šåœ¨åå°è‡ªåŠ¨åœ°é‡å†™AOFæ–‡ä»¶ã€‚é‡å†™åä¼šä½¿AOFæ–‡ä»¶å‹ç¼©åˆ°æœ€å°æ‰€éœ€çš„æŒ‡ä»¤é›†ã€‚</li><li>AOFæ–‡ä»¶æ˜¯æœ‰åºä¿å­˜æ•°æ®åº“çš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œæ˜“è¯»ï¼Œæ˜“åˆ†æã€‚å³ä½¿å¦‚æœä¸å°å¿ƒè¯¯æ“ä½œæ•°æ®åº“ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ‰¾å‡ºé”™è¯¯æŒ‡ä»¤ï¼Œæ¢å¤åˆ°æŸä¸ªæ•°æ®èŠ‚ç‚¹ã€‚ä¾‹å¦‚ä¸å°å¿ƒFLUSHALLï¼Œå¯ä»¥éå¸¸å®¹æ˜“æ¢å¤åˆ°æ‰§è¡Œå‘½ä»¤ä¹‹å‰ã€‚</li></ol><h3 id="AOFçš„ç¼ºç‚¹"><a href="#AOFçš„ç¼ºç‚¹" class="headerlink" title="AOFçš„ç¼ºç‚¹"></a>AOFçš„ç¼ºç‚¹</h3><ol><li>ç›¸åŒæ•°æ®é‡ä¸‹ï¼ŒAOFçš„æ–‡ä»¶é€šå¸¸ä½“ç§¯ä¼šæ¯”RDBå¤§ã€‚å› ä¸ºAOFæ˜¯å­˜æŒ‡ä»¤çš„ï¼Œè€ŒRDBæ˜¯æ‰€æœ‰æŒ‡ä»¤çš„ç»“æœå¿«ç…§ã€‚ä½†AOFåœ¨æ—¥å¿—é‡å†™åä¼šå‹ç¼©ä¸€äº›ç©ºé—´ã€‚</li><li>åœ¨å¤§é‡å†™å…¥å’Œè½½å…¥çš„æ—¶å€™ï¼ŒAOFçš„æ•ˆç‡ä¼šæ¯”RDBä½ã€‚å› ä¸ºå¤§é‡å†™å…¥ï¼ŒAOFä¼šæ‰§è¡Œæ›´å¤šçš„ä¿å­˜å‘½ä»¤ï¼Œè½½å…¥çš„æ—¶å€™ä¹Ÿéœ€è¦å¤§é‡çš„é‡æ‰§è¡Œå‘½ä»¤æ¥å¾—åˆ°æœ€åçš„ç»“æœã€‚RDBå¯¹æ­¤æ›´æœ‰ä¼˜åŠ¿ã€‚</li></ol><h3 id="é…ç½®æ±‡æ€»"><a href="#é…ç½®æ±‡æ€»" class="headerlink" title="é…ç½®æ±‡æ€»"></a>é…ç½®æ±‡æ€»</h3><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">save</span> <span class="hljs-number">60</span> <span class="hljs-number">1000</span>:<span class="hljs-number">60</span>så†…è‡³å°‘è¾¾åˆ°<span class="hljs-number">1000</span>æ¡å†™å‘½ä»¤<span class="hljs-attribute">appendonly</span> no:æ˜¯å¦å¼€å¯AOF<span class="hljs-attribute">appendfilename</span> <span class="hljs-string">&quot;appendonly.aof&quot;</span>:AOFæ–‡ä»¶å<span class="hljs-attribute">dir</span> ./:RDBæ–‡ä»¶å’ŒAOFæ–‡ä»¶æ‰€åœ¨ç›®å½•<span class="hljs-attribute">appendfsync</span> everysec:fsyncæŒä¹…åŒ–ç­–ç•¥<span class="hljs-attribute">no</span>-appendfsync-<span class="hljs-literal">on</span>-rewrite no:AOFé‡å†™æœŸé—´æ˜¯å¦ç¦æ­¢fsync;å¦‚æœå¼€å¯è¯¥é€‰é¡¹ï¼Œå¯ä»¥å‡è½»æ–‡ä»¶é‡å†™æ—¶CPUå’Œç¡¬ç›˜çš„è´Ÿè½½(å°¤å…¶æ˜¯ç¡¬ç›˜)ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸¢ å¤±AOFé‡å†™æœŸé—´çš„æ•°æ®;éœ€è¦åœ¨è´Ÿè½½å’Œå®‰å…¨æ€§ä¹‹é—´è¿›è¡Œå¹³è¡¡<span class="hljs-attribute">auto</span>-aof-rewrite-percentage <span class="hljs-number">100</span>:æ–‡ä»¶é‡å†™è§¦å‘æ¡ä»¶ä¹‹ä¸€<span class="hljs-attribute">auto</span>-aof-rewrite-min-size <span class="hljs-number">64</span>mb:æ–‡ä»¶é‡å†™è§¦å‘æäº¤ä¹‹ä¸€<span class="hljs-attribute">aof</span>-load-truncated yes:å¦‚æœAOFæ–‡ä»¶ç»“å°¾æŸåï¼ŒRediså¯åŠ¨æ—¶æ˜¯å¦ä»è½½å…¥AOFæ–‡ä»¶</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š9.è®¾è®¡æ¨¡å¼</title>
    <link href="/2020/02/16/phpframe12/"/>
    <url>/2020/02/16/phpframe12/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><p>æ¡†æ¶çš„å¼€å‘åŸºæœ¬ç»“æŸäº†ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹è®¾è®¡æ¨¡å¼ã€‚</p><hr><p>è°ˆè®¾è®¡æ¨¡å¼ï¼Œé¦–å…ˆè¦æ¥ç®€å•èŠèŠé¢å‘å¯¹è±¡ã€‚</p><h3 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h3><blockquote><p>é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ï¼ˆObject-Oriented Programming, OOPï¼‰æ˜¯ä¸€ç§ç¨‹åºè®¾è®¡èŒƒå‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§ç¨‹åºå¼€å‘æ–¹æ³•ã€‚å®ƒå°†å¯¹è±¡ä½œä¸ºç¨‹åºçš„åŸºæœ¬å•å…ƒï¼Œå°†ç¨‹åºå’Œæ•°æ®å°è£…å…¶ä¸­ï¼Œä»¥æé«˜è½¯ä»¶çš„é‡ç”¨æ€§ã€çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚å®ƒå’Œé¢å‘è¿‡ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹è¢«ç§°ä¸ºç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸‰å¤§èŒƒå¼ã€‚</p></blockquote><h3 id="æ¦‚å¿µçŸ¥è¯†"><a href="#æ¦‚å¿µçŸ¥è¯†" class="headerlink" title="æ¦‚å¿µçŸ¥è¯†"></a>æ¦‚å¿µçŸ¥è¯†</h3><ol><li>é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯å¯¹è±¡ã€å°è£…ã€å¯é‡ç”¨æ€§ã€å¯æ‰©å±•æ€§ã€‚</li><li>é¢å‘å¯¹è±¡ä¸‰è¦ç´ ï¼šå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ã€‚</li><li>é¢å‘å¯¹è±¡è®¾è®¡çš„äº”å¤§åŸåˆ™ï¼šå•ä¸€èŒè´£åŸåˆ™ã€æ¥å£éš”ç¦»åŸåˆ™ã€å¼€æ”¾å°é—­åŸåˆ™ã€æ›¿æ¢åŸåˆ™ã€ä¾èµ–å€’ç½®åŸåˆ™ã€‚</li></ol><p>å…³äºè¿™äº›æ¦‚å¿µçš„æ›´è¯¦ç»†è§£é‡Šï¼Œæˆ‘æ¨èå¤§å®¶é˜…è¯»ã€ŠPHPæ ¸å¿ƒæŠ€æœ¯ä¸æœ€ä½³å®è·µã€‹è¿™æœ¬ä¹¦å…³äºå…³äºé¢å‘å¯¹è±¡çš„éƒ¨åˆ†ã€‚</p><h3 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h3><p>ä¸Šè¿°æ‰€è¿°çš„é¢å‘å¯¹è±¡çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„äº”å¤§åŸåˆ™ï¼Œæ˜¯è¯¸å¤šè®¾è®¡æ¨¡å¼çš„åŸºç¡€ã€‚</p><p>è®¾è®¡æ¨¡å¼æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åˆ—å‡ºæ¥ï¼š</p><ol><li>æœ‰å¼ºè°ƒå®ä¾‹åŒ–è¿‡ç¨‹çš„åˆ›å»ºå‹è®¾è®¡æ¨¡å¼</li></ol><ul><li>æŠ½è±¡å·¥å‚</li><li>ç”Ÿæˆå™¨</li><li>å·¥å‚æ–¹æ³•</li><li>åŸå‹</li><li>å•ä¾‹</li></ul><ol start="2"><li>åˆæœ‰ç»„åˆå¯¹è±¡å’Œç±»æ„æˆæ›´å¤§ç»“æ„çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼</li></ol><ul><li>é€‚é…å™¨æ¨¡å¼</li><li>æ¡¥æ¥æ¨¡å¼</li><li>ç»„åˆæ¨¡å¼</li><li>è£…é¥°å™¨æ¨¡å¼</li><li>å¤–è§‚æ¨¡å¼</li><li>äº«å…ƒæ¨¡å¼</li><li>ä»£ç†æ¨¡å¼</li></ul><ol start="3"><li>è¿˜æœ‰è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼</li></ol><ul><li>èŒè´£é“¾æ¨¡å¼</li><li>å‘½ä»¤æ¨¡å¼</li><li>è§£é‡Šå™¨æ¨¡å¼</li><li>è¿­ä»£å™¨æ¨¡å¼</li><li>ä¸­ä»‹è€…æ¨¡å¼</li><li>å¤‡å¿˜å½•æ¨¡å¼</li><li>è§‚å¯Ÿè€…æ¨¡å¼</li><li>çŠ¶æ€æ¨¡å¼</li><li>ç­–ç•¥æ¨¡å¼</li><li>æ¨¡æ¿æˆæƒæ¨¡å¼</li><li>è®¿é—®è€…æ¨¡å¼</li></ul><p>è¯´åˆ°è¿™é‡Œä½ æœ‰æ²¡æœ‰è’™åœˆï¼Ÿ</p><p>å…¶å®æˆ‘ä»¬æ— éœ€ä¸€ä¸‹å­å»äº†è§£é‚£ä¹ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½ä¹Ÿæ˜¯æ··åˆä½¿ç”¨è®¾è®¡æ¨¡å¼çš„ã€‚æˆ‘ä»¬ä¸å¦¨å¯ä»¥å°±æ¡†æ¶é‡Œç”¨åˆ°çš„å‡ ä¸ªå…¸å‹çš„è®¾è®¡æ¨¡å¼åšä¸€äº›åˆ†æã€‚</p><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><p>æ˜¯å¦è¿˜è®°å¾—æˆ‘ä»¬ä½¿ç”¨Redisä»£æ›¿Sessioné‚£ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°±ç”¨åˆ°äº†å•ä¾‹æ¨¡å¼ã€‚</p><p>æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisSession</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$Redis</span>;        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRedisInstance</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;Redis)) &#123;            <span class="hljs-variable">$Redis</span> = <span class="hljs-keyword">new</span> \Redis();            <span class="hljs-variable">$Redis</span>-&gt;connect(<span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;host&#x27;</span>], <span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;port&#x27;</span>], <span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;timeout&#x27;</span>]);            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;auth&#x27;</span>]) &#123;                <span class="hljs-variable">$Redis</span>-&gt;auth(<span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;auth&#x27;</span>]);            &#125;            <span class="hljs-keyword">$this</span>-&gt;Redis = <span class="hljs-variable">$Redis</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;Redis;    &#125;&#125;</code></pre></div><p>ä¸€èˆ¬æˆ‘ä»¬è¿˜ä¼šåœ¨ç±»é‡Œé¢åŠ å…¥ä¸€ä¸ªé­”æœ¯æ–¹æ³•__cloneï¼Œé˜²æ­¢å®ä¾‹åˆ›å»ºåè¢«clone</p><p>å•ä¾‹æ¨¡å¼æœ‰æ˜¾è€Œæ˜“è§çš„ä¼˜ç‚¹ï¼šæé«˜å¯é‡ç”¨æ€§ï¼Œå‡å°‘å¼€é”€ã€‚æ¡†æ¶é‡Œä½¿ç”¨Redisæ—¶éƒ½å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ¥è·å–Redisï¼Œä¹Ÿå‡å°‘Redisçš„è¿æ¥æ•°å’Œå¤šæ¬¡è¿æ¥æ—¶é—´ã€‚</p><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><p>è¿˜è®°å¾—ä¾èµ–æ³¨å…¥é‚£ä¸€èŠ‚ä¹ˆï¼Œæˆ‘ä»¬ä¸¾ä¾‹çš„é‚£ä¸ªTravelå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­–ç•¥æ¨¡å¼Demoï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Travel</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travelAlgorithm</span>(<span class="hljs-params"></span>)</span>;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> *å…·ä½“ç­–ç•¥ç±»(ConcreteStrategy)</span><span class="hljs-comment"> *1ï¼šä¹˜åé£æœº</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AirPlanelStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Travel</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travelAlgorithm</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;travelbyAirPlain\r\n&quot;</span>;    &#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> *å…·ä½“ç­–ç•¥ç±»(ConcreteStrategy)</span><span class="hljs-comment"> *2ï¼šä¹˜åç«è½¦</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TrainStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Travel</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travelAlgorithm</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;travelbyTrain\r\n&quot;</span>;    &#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> *</span><span class="hljs-comment"> *ç¯å¢ƒç±»(Context):</span><span class="hljs-comment"> *ç”¨ä¸€ä¸ªConcreteStrategyå¯¹è±¡æ¥é…ç½®ã€‚</span><span class="hljs-comment"> *ç»´æŠ¤ä¸€ä¸ªå¯¹Travelå¯¹è±¡çš„å¼•ç”¨ã€‚å¯å®šä¹‰ä¸€ä¸ªæ¥å£æ¥è®©Strategyè®¿é—®å®ƒçš„æ•°æ®ã€‚</span><span class="hljs-comment"> *ç®—æ³•è§£å†³ç±»ï¼Œä»¥æä¾›å®¢æˆ·é€‰æ‹©ä½¿ç”¨ä½•ç§è§£å†³æ–¹æ¡ˆï¼š</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonContext</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$strategy</span> = <span class="hljs-literal">null</span>;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">Travel <span class="hljs-variable">$travel</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;strategy=<span class="hljs-variable">$travel</span>;    &#125;        <span class="hljs-comment">/**</span><span class="hljs-comment">     *æ—…è¡Œ</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travel</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span><span class="hljs-keyword">$this</span>-&gt;strategy-&gt;travelAlgorithm();    &#125;&#125;<span class="hljs-comment">// ä¹˜åç«è½¦æ—…è¡Œ</span><span class="hljs-variable">$person</span> = <span class="hljs-keyword">new</span> PersonContext(<span class="hljs-keyword">new</span> TrainStrategy());<span class="hljs-variable">$person</span>-&gt;travel();<span class="hljs-comment">// æ”¹ä¹˜é£æœº</span><span class="hljs-variable">$person</span> =PersonContext(<span class="hljs-keyword">new</span> AirPlanelStrategy());<span class="hljs-variable">$person</span>-&gt;travel();</code></pre></div><p>ç­–ç•¥æ¨¡å¼é™ä½äº†ä»£ç è€¦åˆåº¦ï¼Œå¯ä»¥ä½¿å¾—æˆ‘ä»¬ä¸‹å±‚ä»£ç ä¾èµ–ä¸Šå±‚ï¼Œæ›¿æ¢ä¸‹å±‚ä»£ç å³å¯ç®€å•å®ç°åŠŸèƒ½çš„æ›¿æ¢ã€‚</p><h3 id="å·¥å‚æ–¹æ³•"><a href="#å·¥å‚æ–¹æ³•" class="headerlink" title="å·¥å‚æ–¹æ³•"></a>å·¥å‚æ–¹æ³•</h3><p>æˆ‘ä»¬åœ¨è·¯ç”±è§£æåˆ›å»ºæ§åˆ¶å™¨é‚£é‡Œä½¿ç”¨äº†å·¥å‚æ–¹æ³•ï¼Œåªä¸è¿‡ä¸è·¯ç”±è§£æä»£ç ç³…åˆåœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Factory</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createController</span>(<span class="hljs-params"><span class="hljs-variable">$controllerName</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$controllerName</span> = rtrim(<span class="hljs-variable">$controllerName</span>,<span class="hljs-string">&#x27;\\&#x27;</span>).<span class="hljs-string">&#x27;Controller&#x27;</span>;        <span class="hljs-keyword">if</span> (!class_exists(<span class="hljs-variable">$controllerName</span>)) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotFoundException(<span class="hljs-string">&quot;æœªæ‰¾åˆ°æ§åˆ¶å™¨&quot;</span>);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$controllerName</span>;    &#125;        Â·Â·Â·&#125;</code></pre></div><p>å·¥å‚æ–¹æ³•æ˜¯å¾ˆå¸¸è§çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼ŒåƒModelç»å¸¸èƒ½ç”¨åˆ°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š8.ä¾èµ–æ³¨å…¥ä¸æ§åˆ¶åè½¬</title>
    <link href="/2020/02/15/phpframe11/"/>
    <url>/2020/02/15/phpframe11/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><h3 id="ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence-Inversion-Principleï¼‰"><a href="#ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence-Inversion-Principleï¼‰" class="headerlink" title="ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰"></a>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰</h3><p>DIPæ˜¯é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¹‹ä¸€ã€‚<br>ä¼ ç»Ÿè½¯ä»¶è®¾è®¡ä¸­ï¼Œä¸Šå±‚ä»£ç ä¾èµ–äºä¸‹å±‚ä»£ç ï¼Œå½“ä¸‹å±‚å‡ºç°å˜åŠ¨æ—¶ï¼Œ ä¸Šå±‚ä»£ç ä¹Ÿè¦ç›¸åº”å˜åŒ–ï¼Œç»´æŠ¤æˆæœ¬è¾ƒé«˜ã€‚è€ŒDIPçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸Šå±‚å®šä¹‰æ¥å£ï¼Œä¸‹å±‚å®ç°è¿™ä¸ªæ¥å£ï¼Œ ä»è€Œä½¿å¾—ä¸‹å±‚ä¾èµ–äºä¸Šå±‚ï¼Œé™ä½è€¦åˆåº¦ï¼Œæé«˜æ•´ä¸ªç³»ç»Ÿçš„å¼¹æ€§ã€‚è¿™æ˜¯ä¸€ç§ç»å®è·µè¯æ˜çš„æœ‰æ•ˆç­–ç•¥ã€‚</p><h3 id="æ§åˆ¶åè½¬ï¼ˆInversion-of-Controlï¼‰"><a href="#æ§åˆ¶åè½¬ï¼ˆInversion-of-Controlï¼‰" class="headerlink" title="æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼‰"></a>æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼‰</h3><p>IoCåˆ™æ˜¯DIPçš„ä¸€ç§å…·ä½“æ€è·¯ï¼ŒDIPåªæ˜¯ä¸€ç§ç†å¿µã€æ€æƒ³ï¼Œè€ŒIoCæ˜¯ä¸€ç§å®ç°DIPçš„æ–¹æ³•ã€‚ IoCçš„æ ¸å¿ƒæ˜¯å°†ç±»ï¼ˆä¸Šå±‚ï¼‰æ‰€ä¾èµ–çš„å•å…ƒï¼ˆä¸‹å±‚ï¼‰çš„å®ä¾‹åŒ–è¿‡ç¨‹äº¤ç”±ç¬¬ä¸‰æ–¹æ¥å®ç°ã€‚</p><p>å½“è°ƒç”¨è€…éœ€è¦è¢«è°ƒç”¨è€…çš„ååŠ©æ—¶ï¼Œåœ¨ä¼ ç»Ÿçš„ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ç”±è°ƒç”¨è€…æ¥åˆ›å»ºè¢«è°ƒç”¨è€…çš„å®ä¾‹ï¼Œä½†åœ¨è¿™é‡Œï¼Œåˆ›å»ºè¢«è°ƒç”¨è€…çš„å·¥ä½œä¸å†ç”±è°ƒç”¨è€…æ¥å®Œæˆï¼Œè€Œæ˜¯å°†è¢«è°ƒç”¨è€…çš„åˆ›å»ºç§»åˆ°è°ƒç”¨è€…çš„å¤–éƒ¨ï¼Œä»è€Œåè½¬è¢«è°ƒç”¨è€…çš„åˆ›å»ºï¼Œæ¶ˆé™¤äº†è°ƒç”¨è€…å¯¹è¢«è°ƒç”¨è€…åˆ›å»ºçš„æ§åˆ¶ï¼Œå› æ­¤ç§°ä¸ºæ§åˆ¶åè½¬ã€‚</p><h3 id="ä¾èµ–æ³¨å…¥ï¼ˆDependence-Injectionï¼‰"><a href="#ä¾èµ–æ³¨å…¥ï¼ˆDependence-Injectionï¼‰" class="headerlink" title="ä¾èµ–æ³¨å…¥ï¼ˆDependence Injectionï¼‰"></a>ä¾èµ–æ³¨å…¥ï¼ˆDependence Injectionï¼‰</h3><p>DIæ˜¯IoCçš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼ŒæŒ‰ç…§DIçš„æ¨¡å¼ï¼Œå°±å¯ä»¥å®ç°IoCã€‚ DIçš„å®è´¨å°±æ˜¯æŠŠä¸€ä¸ªç±»ä¸å¯èƒ½æ›´æ¢çš„éƒ¨åˆ†å’Œå¯æ›´æ¢çš„éƒ¨åˆ†åˆ†ç¦»å¼€æ¥ï¼Œé€šè¿‡æ³¨å…¥çš„æ–¹å¼æ¥ä½¿ç”¨ï¼Œä»è€Œè¾¾åˆ°è§£è€¦çš„ç›®çš„ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼ˆæ—…è¡Œçš„æ¥å£ï¼‰è¯´æ˜ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Travel</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travelAlgorithm</span>(<span class="hljs-params"></span>)</span>;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> *ä¹˜åé£æœº</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AirPlanelStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Travel</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travelAlgorithm</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;travelbyAirPlain\r\n&quot;</span>;    &#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> *ä¹˜åç«è½¦</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TrainStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Travel</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travelAlgorithm</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;travelbyTrain\r\n&quot;</span>;    &#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> *</span><span class="hljs-comment"> *ç®—æ³•è§£å†³ç±»ï¼Œä»¥æä¾›å®¢æˆ·é€‰æ‹©ä½¿ç”¨ä½•ç§è§£å†³æ–¹æ¡ˆï¼š</span><span class="hljs-comment"> */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonContext</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$strategy</span> = <span class="hljs-literal">null</span>;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">Travel <span class="hljs-variable">$travel</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;strategy=<span class="hljs-variable">$travel</span>;    &#125;        <span class="hljs-comment">/**</span><span class="hljs-comment">     *æ—…è¡Œ</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">travel</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span><span class="hljs-keyword">$this</span>-&gt;strategy-&gt;travelAlgorithm();    &#125;&#125;<span class="hljs-comment">// ä¹˜åç«è½¦æ—…è¡Œ</span><span class="hljs-variable">$person</span> = <span class="hljs-keyword">new</span> PersonContext(<span class="hljs-keyword">new</span> TrainStrategy());<span class="hljs-variable">$person</span>-&gt;travel();<span class="hljs-comment">// æ”¹ä¹˜é£æœº</span><span class="hljs-variable">$person</span> =PersonContext(<span class="hljs-keyword">new</span> AirPlanelStrategy());<span class="hljs-variable">$person</span>-&gt;travel();</code></pre></div><p>å½“æˆ‘ä»¬æ›´æ¢äº¤é€šå·¥å…·æ—¶ï¼Œåªéœ€è¦å»å¢åŠ Travelæ¥å£çš„å®ç°ï¼Œä¿®æ”¹ä¸‹å®ç°çš„ä»£ç æ¥å£ï¼Œæ— éœ€å»æ”¹åŠ¨æ ¸å¿ƒä»£ç ã€‚</p><h3 id="æ§åˆ¶åè½¬å®¹å™¨ï¼ˆIoC-Containerï¼‰"><a href="#æ§åˆ¶åè½¬å®¹å™¨ï¼ˆIoC-Containerï¼‰" class="headerlink" title="æ§åˆ¶åè½¬å®¹å™¨ï¼ˆIoC Containerï¼‰"></a>æ§åˆ¶åè½¬å®¹å™¨ï¼ˆIoC Containerï¼‰</h3><p>å½“é¡¹ç›®æ¯”è¾ƒå¤§æ—¶ï¼Œä¾èµ–å…³ç³»å¯èƒ½ä¼šååˆ†å¤æ‚ã€‚ è€ŒIoC Containeræä¾›äº†åŠ¨æ€åœ°åˆ›å»ºã€æ³¨å…¥ä¾èµ–å•å…ƒï¼Œæ˜ å°„ä¾èµ–å…³ç³»ç­‰åŠŸèƒ½ï¼Œæ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ï¼Œå¹¶å¤§å¤§ç¼©å‡äº†è®¸å¤šä»£ç é‡ã€‚ </p><p>å› ä¸ºæˆ‘ä»¬çš„æ¡†æ¶æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸å¦¨å®ç°ä¸‹Iocå®¹å™¨(ä¸»è¦å‚è€ƒäº†Yiiçš„diå®¹å™¨)ã€‚</p><p>ä»£ç å®ç°ç”¨åˆ°äº†PHPçš„åå°„Apiï¼Œæœ‰ç–‘é—®çš„ä¸å¦¨å…ˆçœ‹çœ‹æ‰‹å†Œï¼š</p><ul><li><a href="https://www.php.net/manual/zh/book.reflection.php">PHPåå°„</a></li></ul><p>è¿˜è®°å¾—PSRå—ï¼ŸPSR11æ˜¯å…³äºä¾èµ–æ³¨å…¥å®¹å™¨æ¥å£è§„èŒƒï¼š</p><p>ç„¶åæˆ‘ä»¬åˆ©ç”¨composeræ‰§è¡Œ</p><blockquote><p>composer require psr/container</p></blockquote><p>æˆ‘ä»¬åœ¨library/Componentsæ–°å»ºContainerå®ç°ContainerInterfaceï¼Œåœ¨library/Exceptionsä¸‹æ–°å»ºContainerExceptionå®ç°Psr\Container\ContainerExceptionInterfaceï¼Œæ–°å»ºContainerNotFoundExceptionå®ç°Psr\Container\NotFoundExceptionInterfaceã€‚</p><p>æˆ‘ä»¬ä¸»è¦æ¥å®ç°ä¸€ä¸‹Containerä»£ç ï¼Œæˆ‘ä»¬é¢„å…ˆå®šä¹‰ä¸‰ä¸ªå±æ€§ï¼Œç”¨ä»¥ä¿å­˜å¯¹è±¡ã€ä¾èµ–åŠä¾èµ–çš„å®šä¹‰ä¿¡æ¯ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Components</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">ContainerException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">ContainerNotFoundException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">ReflectionClass</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Container</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ContainerInterface</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">// ç”¨äºä¿å­˜ä¾èµ–çš„å®šä¹‰ï¼Œä»¥å¯¹è±¡åç§°ä¸ºé”®</span>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$definitions</span> = [];    <span class="hljs-comment">// ç”¨äºç¼“å­˜ReflectionClasså¯¹è±¡ï¼Œä»¥å¯¹è±¡åç§°ä¸ºé”®</span>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$reflections</span> = [];    <span class="hljs-comment">// ç”¨äºç¼“å­˜ä¾èµ–ä¿¡æ¯ï¼Œä»¥å¯¹è±¡åç§°ä¸ºé”®</span>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$dependencies</span> = [];    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">has</span>(<span class="hljs-params"><span class="hljs-variable">$class</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;definitions[<span class="hljs-variable">$class</span>]);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$class</span></span>)</span><span class="hljs-function">    </span>&#123;        ...    &#125;&#125;</code></pre></div><p>æˆ‘ä»¬å…ˆæ·»åŠ ä¸€ä¸ªsetæ–¹æ³•ï¼Œç”¨ä»¥å®šä¹‰ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$class</span>, <span class="hljs-variable">$definition</span> = []</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">$this</span>-&gt;definitions[<span class="hljs-variable">$class</span>] = <span class="hljs-keyword">$this</span>-&gt;normalizeDefinition(<span class="hljs-variable">$class</span>, <span class="hljs-variable">$definition</span>);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;&#125;<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeDefinition</span>(<span class="hljs-params"><span class="hljs-variable">$class</span>, <span class="hljs-variable">$definition</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// $definition æ˜¯ç©ºçš„è½¬æ¢æˆ [&#x27;class&#x27; =&gt; $class] å½¢å¼</span>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$definition</span>)) &#123;        <span class="hljs-keyword">return</span> [<span class="hljs-string">&#x27;class&#x27;</span> =&gt; <span class="hljs-variable">$class</span>];        <span class="hljs-comment">// $definition æ˜¯å­—ç¬¦ä¸²ï¼Œè½¬æ¢æˆ [&#x27;class&#x27; =&gt; $definition] å½¢å¼</span>    &#125; <span class="hljs-keyword">elseif</span> (is_string(<span class="hljs-variable">$definition</span>)) &#123;        <span class="hljs-keyword">return</span> [<span class="hljs-string">&#x27;class&#x27;</span> =&gt; <span class="hljs-variable">$definition</span>];        <span class="hljs-comment">// $definition æ˜¯å¯¹è±¡ï¼Œåˆ™ç›´æ¥å°†å…¶ä½œä¸ºä¾èµ–çš„å®šä¹‰</span>    &#125; <span class="hljs-keyword">elseif</span> (is_object(<span class="hljs-variable">$definition</span>)) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$definition</span>;        <span class="hljs-comment">// $definition æ˜¯æ•°ç»„åˆ™ç¡®ä¿è¯¥æ•°ç»„å®šä¹‰äº† class å…ƒç´ </span>    &#125; <span class="hljs-keyword">elseif</span> (is_array(<span class="hljs-variable">$definition</span>)) &#123;        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$definition</span>[<span class="hljs-string">&#x27;class&#x27;</span>])) &#123;            <span class="hljs-variable">$definition</span>[<span class="hljs-string">&#x27;class&#x27;</span>] = <span class="hljs-variable">$class</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$definition</span>;        <span class="hljs-comment">// è¿™ä¹Ÿä¸æ˜¯ï¼Œé‚£ä¹Ÿä¸æ˜¯ï¼Œé‚£å°±æŠ›å‡ºå¼‚å¸¸ç®—äº†</span>    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ContainerException(            <span class="hljs-string">&quot;ä¸æ”¯æŒçš„ç±»å‹ï¼š \&quot;<span class="hljs-subst">$class</span>\&quot;: &quot;</span> . gettype(<span class="hljs-variable">$definition</span>));    &#125;&#125;</code></pre></div><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li>gettype â€” è·å–å˜é‡çš„ç±»å‹</li></ul><p>ç„¶åæˆ‘ä»¬é‡ç‚¹å®ç°getæ–¹æ³•ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$class</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// åŠ å…¥æœªä½œsetæ“ä½œï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥æ„å»º</span>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;definitions[<span class="hljs-variable">$class</span>])) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;build(<span class="hljs-variable">$class</span>);    &#125;    <span class="hljs-variable">$definition</span> = <span class="hljs-keyword">$this</span>-&gt;definitions[<span class="hljs-variable">$class</span>];    <span class="hljs-keyword">if</span> (is_array(<span class="hljs-variable">$definition</span>)) &#123;        <span class="hljs-variable">$concrete</span> = <span class="hljs-variable">$definition</span>[<span class="hljs-string">&#x27;class&#x27;</span>];        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$definition</span>[<span class="hljs-string">&#x27;class&#x27;</span>]);        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$concrete</span> === <span class="hljs-variable">$class</span>) &#123;            <span class="hljs-variable">$object</span> = <span class="hljs-keyword">$this</span>-&gt;build(<span class="hljs-variable">$class</span>, <span class="hljs-variable">$definition</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$object</span> = <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-variable">$concrete</span>);        &#125;    &#125; <span class="hljs-keyword">elseif</span> (is_object(<span class="hljs-variable">$definition</span>)) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;_singletons[<span class="hljs-variable">$class</span>] = <span class="hljs-variable">$definition</span>;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ContainerNotFoundException(<span class="hljs-string">&#x27;ä¸èƒ½è¯†åˆ«çš„å¯¹è±¡ç±»å‹: &#x27;</span> . gettype(<span class="hljs-variable">$definition</span>));    &#125;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$object</span>;&#125;</code></pre></div><p>buildæ–¹æ³•å¦‚ä¸‹ï¼Œä¸»è¦æ˜¯æ„å»ºå‡ºå¯¹è±¡å¹¶å®ç°æ³¨å…¥ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">build</span>(<span class="hljs-params"><span class="hljs-variable">$class</span>, <span class="hljs-variable">$params</span> = []</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">// é€šè¿‡åå°„apiè·å–å¯¹è±¡</span>        <span class="hljs-variable">$reflector</span> = <span class="hljs-keyword">$this</span>-&gt;getReflectionClass(<span class="hljs-variable">$class</span>);                <span class="hljs-comment">// è·å–ä¾èµ–å…³ç³»æ•°ç»„</span>        <span class="hljs-variable">$dependencies</span> = <span class="hljs-keyword">$this</span>-&gt;getDependencies(<span class="hljs-variable">$class</span>, <span class="hljs-variable">$reflector</span>);        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç±»çš„æ–°å®ä¾‹,ç»™å‡ºçš„å‚æ•°å°†ä¼ é€’åˆ°ç±»çš„æ„é€ å‡½æ•°.</span>        <span class="hljs-variable">$reflector</span> =  <span class="hljs-variable">$reflector</span>-&gt;newInstanceArgs(<span class="hljs-variable">$dependencies</span>);                <span class="hljs-keyword">return</span> <span class="hljs-variable">$reflector</span>;    &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$t</span>) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ContainerException(<span class="hljs-string">&#x27;åå°„å‡ºé”™&#x27;</span>);    &#125;&#125;</code></pre></div><p>è·å–å¯¹è±¡ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReflectionClass</span>(<span class="hljs-params"><span class="hljs-variable">$class</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;reflections[<span class="hljs-variable">$class</span>])) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;reflections[<span class="hljs-variable">$class</span>];    &#125;    <span class="hljs-variable">$reflector</span> = <span class="hljs-keyword">new</span> ReflectionClass(<span class="hljs-variable">$class</span>);    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$reflector</span>-&gt;isInstantiable()) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ContainerException(<span class="hljs-string">&quot;ä¸èƒ½å®ä¾‹åŒ–&quot;</span>.<span class="hljs-variable">$class</span>);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;reflections[<span class="hljs-variable">$class</span>] = <span class="hljs-variable">$reflector</span>;&#125;</code></pre></div><p>è·å–ä¾èµ–å…³ç³»ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDependencies</span>(<span class="hljs-params"><span class="hljs-variable">$class</span>, <span class="hljs-variable">$reflector</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ä¾èµ–å…³ç³»</span>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;dependencies[<span class="hljs-variable">$class</span>])) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;dependencies[<span class="hljs-variable">$class</span>];    &#125;    <span class="hljs-variable">$constructor</span> = <span class="hljs-variable">$reflector</span>-&gt;getConstructor();    <span class="hljs-comment">#å¦‚æœæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œ ç›´æ¥å®ä¾‹åŒ–å¹¶è¿”å›</span>    <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$constructor</span>)) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;dependencies[<span class="hljs-variable">$class</span>] = [];    &#125;    <span class="hljs-variable">$parameters</span> = <span class="hljs-variable">$constructor</span>-&gt;getParameters();    <span class="hljs-variable">$dependencies</span> = [];    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$parameters</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$className</span>) &#123;        <span class="hljs-variable">$dependency</span> = <span class="hljs-variable">$className</span>-&gt;getClass();        <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$dependency</span>)) &#123;            <span class="hljs-variable">$dependencies</span>[] = <span class="hljs-keyword">$this</span>-&gt;resolveNoneClass(<span class="hljs-variable">$className</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// å…ˆå–å‡ºå®¹å™¨ä¸­ç»‘å®šçš„ç±» å¦åˆ™è‡ªåŠ¨ç»‘å®š</span>            <span class="hljs-variable">$dependencies</span>[] = <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-variable">$dependency</span>-&gt;getName());        &#125;    &#125;        <span class="hljs-keyword">$this</span>-&gt;dependencies[<span class="hljs-variable">$class</span>] = <span class="hljs-variable">$dependencies</span>;    <span class="hljs-keyword">return</span> <span class="hljs-variable">$dependencies</span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveNoneClass</span>(<span class="hljs-params"><span class="hljs-variable">$class</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// æœ‰é»˜è®¤å€¼åˆ™è¿”å›é»˜è®¤å€¼</span>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$class</span>-&gt;isDefaultValueAvailable()) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$class</span>-&gt;getDefaultValue();    &#125;    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ContainerException(<span class="hljs-string">&#x27;ä¸èƒ½è§£æå‚æ•°&#x27;</span>);&#125;</code></pre></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬å°±å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„IOC Containerçš„ä»£ç ã€‚</p><p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªdemoï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Controllers</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span><span class="hljs-class"></span>&#123;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Controllers</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">C <span class="hljs-variable">$c</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;ccc = <span class="hljs-variable">$c</span>;    &#125;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Controllers</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">B <span class="hljs-variable">$b</span>, C <span class="hljs-variable">$c</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;bbb = <span class="hljs-variable">$b</span>;        <span class="hljs-keyword">$this</span>-&gt;ccc = <span class="hljs-variable">$c</span>;    &#125;&#125;</code></pre></div><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Controllers</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Components</span>\<span class="hljs-title">Container</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Controller</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$contain</span> = <span class="hljs-keyword">new</span> Container();        <span class="hljs-variable">$contain</span>-&gt;set(<span class="hljs-string">&#x27;App\\Https\\Controllers\\A&#x27;</span>);        p(<span class="hljs-variable">$contain</span>-&gt;get(<span class="hljs-string">&#x27;App\\Https\\Controllers\\A&#x27;</span>));    &#125;&#125;</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„ç»“æœï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/f42MB1d9gr.png!large" alt="image"></p><p>æ˜¯ä¸æ˜¯ä»£ç ç®€æ´å¾ˆå¤šäº†ï¼Œä¸æ„¿å› ä¸ºéœ€è¦åˆ›å»ºä¸€ä¸ªAå¯¹è±¡ï¼Œè€Œå…ˆå»å®ä¾‹åŒ–Bå’ŒCï¼Œè¿™äº›éƒ½æ˜¯ç”±æˆ‘ä»¬å®Œæˆçš„IOC Containerå»å®ç°äº†ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸€èŠ‚æˆ‘ä»¬å®ç°äº†IOCå®¹å™¨ï¼Œç„¶è€Œä½ å¦‚æœä»”ç»†å»æƒ³ï¼Œæˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬å¯ä»¥è®©å®¹å™¨æ›´åŠ å¼ºå¤§ï¼Œæ¯”å¦‚å•ä¾‹å¯¹è±¡çš„å®ç°ï¼Œæ¯”å¦‚ä¾èµ–çš„æ‰©å±•ï¼ˆå…¼å®¹å¯¹è±¡å‚æ•°æ³¨å…¥ï¼Œæ•°ç»„å‚æ•°æ³¨å…¥ç­‰ï¼‰ã€‚è¿™äº›ä½ å¯ä»¥è‡ªè¡Œå®ç°ï¼Œæˆ‘ä¹Ÿåœ¨æºä»£ç åšäº†ç®€å•çš„æ‰©å±•ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒè¯•ç€å®ç°ä¸€ä¸‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥çœ‹çœ‹å¼€æºæ¡†æ¶Laravelã€Yiiçš„æœåŠ¡å®¹å™¨çš„å®ç°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š7.ä½¿ç”¨RedisåŠ é€Ÿsessionè¯»å†™</title>
    <link href="/2020/02/15/phpframe10/"/>
    <url>/2020/02/15/phpframe10/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œé»˜è®¤çš„sessionæ˜¯å­˜å‚¨åœ¨æ–‡ä»¶é‡Œçš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œç„¶è€Œä¸€æ—¦è®¿é—®å¾ˆå¤šï¼Œsessionçš„ä½¿ç”¨å°±ä¼šé¢‘ç¹è¯»å†™æ–‡ä»¶ï¼Œå¿…ç„¶ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ã€‚å¦å¤–ï¼Œå‡å¦‚æ˜¯å¤šæœºéƒ¨ç½²ï¼Œsessionçš„å…±äº«ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚</p><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“æœ‰Redisè¿™ä¸ªåˆ©å™¨ï¼Œè€ŒPHPä¹Ÿæ˜¯æ”¯æŒsessionè‡ªå®šä¹‰çš„ï¼Œé‚£ä¹ˆä¸ºä½•ä¸è¦æ€§èƒ½æ›´å¥½åˆèƒ½å®ç°å…±äº«sessionçš„Rediså‘¢ï¼Ÿ</p><h3 id="Redisæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Redisæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Redisæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Redisæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Redis æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œéµå®ˆ BSD åè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ key - value æ•°æ®åº“</p><h3 id="Redisæ•°æ®ç»“æ„"><a href="#Redisæ•°æ®ç»“æ„" class="headerlink" title="Redisæ•°æ®ç»“æ„"></a>Redisæ•°æ®ç»“æ„</h3><ul><li>string</li><li>hash</li><li>set</li><li>sorted set</li><li>pub/sub</li><li>list</li></ul><p>å¦å¤–è¿˜æœ‰HyperLogLogï¼Œgeoâ€¦.</p><h3 id="Redisçš„ä¼˜åŠ¿"><a href="#Redisçš„ä¼˜åŠ¿" class="headerlink" title="Redisçš„ä¼˜åŠ¿"></a>Redisçš„ä¼˜åŠ¿</h3><ul><li>æ€§èƒ½æä½³ï¼Œå®˜ç½‘æ˜¾ç¤ºQPSèƒ½è¾¾åˆ°100k/s</li><li>æ•°æ®ç»“æ„ä¸°å¯Œï¼Œä¸æ­¢äºå­—ç¬¦ä¸²ï¼Œhash</li><li>ç¨³å®šæ€§ä¸é”™ï¼ŒæŒä¹…åŒ–</li><li>æ”¯æŒé›†ç¾¤</li><li>ç¤¾åŒºä¸é”™ï¼Œä½¿ç”¨ç‡é«˜ï¼Œå¯¹äºPHPç¨‹åºå‘˜ï¼Œé™¤äº†LNMP/LAMPï¼Œç„¶ååº”è¯¥å°±æ˜¯Redisäº†</li></ul><h3 id="Redisåº”ç”¨"><a href="#Redisåº”ç”¨" class="headerlink" title="Redisåº”ç”¨"></a>Redisåº”ç”¨</h3><ul><li>ç¼“å­˜</li><li>åˆ†å¸ƒå¼é”</li><li>è®¡æ•°å™¨</li><li>é˜Ÿåˆ—</li><li>geo</li><li>â€¦â€¦</li></ul><h3 id="Rediså‘½ä»¤"><a href="#Rediså‘½ä»¤" class="headerlink" title="Rediså‘½ä»¤"></a>Rediså‘½ä»¤</h3><ul><li><a href="http://doc.redisfans.com/">ç‚¹å‡»æŸ¥çœ‹Rediså‘½ä»¤</a></li></ul><h3 id="ä½¿ç”¨Rediså­˜å‚¨session"><a href="#ä½¿ç”¨Rediså­˜å‚¨session" class="headerlink" title="ä½¿ç”¨Rediså­˜å‚¨session"></a>ä½¿ç”¨Rediså­˜å‚¨session</h3><p>æˆ‘ä»‹ç»ä¸¤ç§æ–¹æ³•ç»™å¤§å®¶ï¼š</p><ol><li>session_startå¸¦å‚</li><li>session_set_save_handleræ‰˜ç®¡session</li></ol><p>ä¸‹é¢æˆ‘ä»¬é‡Œä¸€ä¸€è¯´æ˜ï¼š</p><h2 id="session-start"><a href="#session-start" class="headerlink" title="session_start"></a>session_start</h2><p>session_start ([ array $options = array() ] ) : bool â€”â€” å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼ˆ<a href="https://www.php.net/manual/zh/session.configuration.php">ç‚¹å‡»æŸ¥çœ‹æ›´å¤šå‚æ•°</a>ï¼‰</p><p>æ¥çœ‹demoï¼š</p><div class="code-wrapper"><pre><code class="hljs prolog">session_start([    <span class="hljs-string">&#x27;save_path&#x27;</span> =&gt; <span class="hljs-string">&#x27;tcp://127.0.0.1:6379&#x27;</span>,    <span class="hljs-string">&#x27;save_handler&#x27;</span> =&gt; <span class="hljs-string">&#x27;Redis&#x27;</span>,]);$<span class="hljs-symbol">_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>] = <span class="hljs-number">10001</span>;$<span class="hljs-symbol">_SESSION</span>[<span class="hljs-string">&#x27;userInfo&#x27;</span>] = [<span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;sai&#x27;</span>];p($<span class="hljs-symbol">_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>]);p($<span class="hljs-symbol">_SESSION</span>[<span class="hljs-string">&#x27;userInfo&#x27;</span>]);</code></pre></div><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>10001</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>Array(    [name] => sai)</pre></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Redis-cliè¿æ¥æŸ¥çœ‹ï¼š</p><blockquote><p>Redis-cli -h 127.0.0.1 -p 6379<br>// å¦‚è®¾ç½®å¯†ç å†è¾“å…¥ï¼ˆauth ä½ è®¾ç½®çš„å¯†ç ï¼‰å³å¯</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/89KRhPfXOo.png!large" alt="image"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Redisé‡Œæœ‰äº†PHPREDIS_SESSION:nmo65igogqnq8ur2gia94jt15uï¼Œé‡Œé¢å­˜å‚¨äº†æˆ‘ä»¬çš„sessionä¿¡æ¯ã€‚</p><h2 id="session-set-save-handler"><a href="#session-set-save-handler" class="headerlink" title="session_set_save_handler"></a>session_set_save_handler</h2><p>å»ºè®®session.serialize_handler = php_serializeï¼Œé»˜è®¤phpå†™å…¥å’Œè¯»å–ç•¥å¾®ç¹çã€‚</p><p>è¿™é‡Œè¯´æ˜æˆ‘ä»¬æˆåŠŸäº†å°†sessionä¿¡æ¯é€šè¿‡Redisè¿›è¡Œäº†è¯»å†™ã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨session_set_save_handleræ¥å®ç°ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Sessions</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">SessionHandler</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisSession</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SessionHandler</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$Redis</span>;        <span class="hljs-keyword">private</span> <span class="hljs-variable">$lifeTime</span> = <span class="hljs-number">7200</span>;        <span class="hljs-keyword">private</span> <span class="hljs-variable">$config</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$prefix</span> = <span class="hljs-string">&#x27;PHPREDIS_SESSION:&#x27;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$config</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;config = <span class="hljs-variable">$config</span>;    &#125;        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRedisInstance</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;Redis)) &#123;            <span class="hljs-variable">$Redis</span> = <span class="hljs-keyword">new</span> \Redis();            <span class="hljs-variable">$Redis</span>-&gt;connect(<span class="hljs-keyword">$this</span>-&gt;config[<span class="hljs-string">&#x27;host&#x27;</span>], <span class="hljs-keyword">$this</span>-&gt;config[<span class="hljs-string">&#x27;port&#x27;</span>], <span class="hljs-keyword">$this</span>-&gt;config[<span class="hljs-string">&#x27;timeout&#x27;</span>]);            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;config[<span class="hljs-string">&#x27;auth&#x27;</span>]) &#123;                <span class="hljs-variable">$Redis</span>-&gt;auth(<span class="hljs-keyword">$this</span>-&gt;config[<span class="hljs-string">&#x27;auth&#x27;</span>]);            &#125;            <span class="hljs-keyword">$this</span>-&gt;Redis = <span class="hljs-variable">$Redis</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;Redis;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;getRedisInstance()-&gt;get(<span class="hljs-keyword">$this</span>-&gt;prefix.<span class="hljs-variable">$id</span>);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>, <span class="hljs-variable">$data</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;getRedisInstance()-&gt;setex(<span class="hljs-keyword">$this</span>-&gt;prefix.<span class="hljs-variable">$id</span>, <span class="hljs-keyword">$this</span>-&gt;lifeTime, <span class="hljs-variable">$data</span>)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;getRedisInstance()-&gt;delete(<span class="hljs-variable">$id</span>))&#123;<span class="hljs-comment">//åˆ é™¤Redisä¸­çš„æŒ‡å®šè®°å½•</span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gc</span>(<span class="hljs-params"><span class="hljs-variable">$maxlifetime</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        session_write_close();    &#125;&#125;<span class="hljs-variable">$handler</span> = <span class="hljs-keyword">new</span> RedisSession([            <span class="hljs-string">&#x27;host&#x27;</span> =&gt; <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,            <span class="hljs-string">&#x27;port&#x27;</span> =&gt; <span class="hljs-number">6379</span>,            <span class="hljs-string">&#x27;auth&#x27;</span> =&gt; <span class="hljs-literal">null</span>,            <span class="hljs-string">&#x27;timeout&#x27;</span> =&gt; <span class="hljs-number">5</span>,        ]);session_set_save_handler(<span class="hljs-variable">$handler</span>, <span class="hljs-literal">true</span>);session_start();<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>] = <span class="hljs-number">10001</span>;<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;userInfo&#x27;</span>] = [<span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;sai&#x27;</span>];p(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>]);p(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;userInfo&#x27;</span>]);</code></pre></div><p>çŸ¥è¯†ç‚¹ï¼š</p><ol><li>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹readæ–¹æ³•ï¼Œé‡Œé¢éœ€è¦åŠ ä¸€ä¸‹serializeï¼Œä»¥ä¾¿äºæˆ‘ä»¬å­˜å‚¨å¤æ‚çš„sessionç»“æ„ã€‚å¦‚æœä¸åŠ ä¼šæŠ¥é”™ï¼ˆWarning: session_start(): Failed to read session data: user (path: )ï¼‰è¿™æ˜¯å› ä¸ºRedisæ— æ³•ç›´æ¥å­˜å‚¨arrayç»“æ„ï¼Œéœ€è¦è½¬åŒ–ä¸ºstringç±»å‹å­˜å‚¨ã€‚</li></ol><p>æˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹Rediså®¢æˆ·ç«¯å­˜å‚¨æƒ…å†µï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/joxyEbzS9I.png!large" alt="image"></p><p>é€šç”¨æˆ‘ä»¬ä¹Ÿçœ‹åˆ°Rediså­˜å‚¨äº†sessionï¼Œä¸å‰é¢ç•¥æœ‰ä¸åŒçš„åªæ˜¯å­˜å‚¨çš„keyä¸ä¸€æ ·ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼š</p><blockquote><p>private $prefix = â€˜PHPREDIS_SESSION:â€™;</p></blockquote><p>ç„¶ååšä¸€ä¸‹è°ƒæ•´å³å¯ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> serialize(<span class="hljs-keyword">$this</span>-&gt;getRedisInstance()-&gt;get(<span class="hljs-keyword">$this</span>-&gt;prefix.<span class="hljs-variable">$id</span>));&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>,<span class="hljs-variable">$data</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;getRedisInstance()-&gt;setex(<span class="hljs-keyword">$this</span>-&gt;prefix.<span class="hljs-variable">$id</span>, <span class="hljs-keyword">$this</span>-&gt;lifeTime, <span class="hljs-variable">$data</span>)) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre></div><p>è¿è¡Œåä¼šå‘ç°æŠŠä¹‹å‰ç¬¬ä¸€ç§è®¾ç½®çš„sessionè¦†ç›–æ‰ã€‚</p><p>å½“ç„¶æˆ‘æ¯”è¾ƒå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œä¾¿äºæˆ‘ä»¬å®šåˆ¶åŒ–ç¼–ç ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€»çš„æ¥è¯´ï¼Œä¸¤ç§æ–¹æ³•é…ç½®éƒ½æ¯”è¾ƒç®€å•ï¼Œä¸ªäººå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼å®ç°ï¼Œè¿™æ ·ä¹Ÿæ¯”è¾ƒé€‚åˆé›†æˆåˆ°æ¡†æ¶ï¼ŒåæœŸæˆ‘ä»¬å¯ä»¥åœ¨è¿›è¡Œæ‰©å±•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š6.ç®€å•æµ‹è¯•</title>
    <link href="/2020/02/13/phpframe09/"/>
    <url>/2020/02/13/phpframe09/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><p>è™½ç„¶æ¡†æ¶åŸºæœ¬å®Œæˆï¼Œä½†æˆ‘ä»¬è¿˜æ²¡æœ‰æµ‹è¯•è¿‡ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨postmanä½œä¸ºæ¥å£æµ‹è¯•å·¥å…·ï¼ˆ<a href="http://saif.com/test%EF%BC%89%E3%80%82">http://saif.com/testï¼‰ã€‚</a></p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// è‡ªå®šä¹‰è·¯ç”±</span><span class="hljs-keyword">return</span> [    <span class="hljs-string">&#x27;debug&#x27;</span> =&gt; <span class="hljs-literal">false</span>,    <span class="hljs-string">&#x27;route&#x27;</span> =&gt; [        <span class="hljs-string">&#x27;&#x27;</span> =&gt; <span class="hljs-string">&#x27;demo/welcome&#x27;</span>,        <span class="hljs-string">&#x27;test&#x27;</span> =&gt; <span class="hljs-string">&#x27;demo/test&#x27;</span>,    ],];<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">welcome</span>(<span class="hljs-params"><span class="hljs-variable">$params</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;response-&gt;json([<span class="hljs-string">&#x27;hello&#x27;</span> =&gt; <span class="hljs-string">&#x27;welcome&#x27;</span>]);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-variable">$params</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;response-&gt;json(<span class="hljs-variable">$params</span>);    &#125;&#125;</code></pre></div><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/rLIdUbGV7m.png!large" alt="postman"></p><p>æˆ‘ä»¬æµ‹è¯•ä¸‹ï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/sJhWP98OZl.png!large" alt="image"><br><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/HNUl9U9nds.png!large" alt="image"><br><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/LRE2vTxosk.png!large" alt="image"></p><p>æˆ‘ä»¬å‘ç°èƒ½æ­£å¸¸è·å–è·å–GETå‚æ•°ï¼Œä½†æ²¡æœ‰è·å–åˆ°POSTå‚æ•°ã€‚</p><p>debugï¼š</p><p>æˆ‘ä»¬å‘ç°Content-Typeè¾“å‡ºæ˜¯ï¼š</p><meta charset='utf-8' /><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>multipart/form-data; boundary=--------------------------498010462598077868347660</pre></div><p>æˆ‘ä»¬ä¼˜åŒ–ä¸€ä¸‹ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBodyParams</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$contentType</span> = strtolower(<span class="hljs-keyword">$this</span>-&gt;getHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>));        <span class="hljs-comment">// p($contentType);</span>    <span class="hljs-keyword">if</span> (strpos(<span class="hljs-variable">$contentType</span>, <span class="hljs-string">&#x27;multipart/form-data&#x27;</span>) === <span class="hljs-literal">false</span>) &#123;        <span class="hljs-keyword">$this</span>-&gt;_bodyParams = \json_decode(file_get_contents(<span class="hljs-string">&quot;php://input&quot;</span>), <span class="hljs-literal">true</span>);    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">$this</span>-&gt;_bodyParams = <span class="hljs-variable">$_POST</span>;    &#125;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;_bodyParams?? [];&#125;</code></pre></div><p>å¦å¤–æˆ‘ä»¬å‘ç°getHeaderæ–¹æ³•æœ‰ç‚¹é—®é¢˜ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHeader</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$defaultValue</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$name</span> = ucfirst(<span class="hljs-variable">$name</span>);    <span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">&#x27;apache_request_headers&#x27;</span>)) &#123;        <span class="hljs-variable">$headers</span> = apache_request_headers();        p(<span class="hljs-variable">$headers</span>);        <span class="hljs-keyword">return</span> <span class="hljs-variable">$headers</span>[<span class="hljs-variable">$name</span>]?? <span class="hljs-variable">$defaultValue</span>;    &#125;    <span class="hljs-comment">// $_SERVERä½¿ç”¨ä¸‹åˆ’çº¿</span>    <span class="hljs-variable">$name</span> = strtoupper(str_replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$name</span>));    <span class="hljs-comment">// éƒ¨åˆ†è‡ªå®šä¹‰å‚æ•°éœ€è¦åŠ ä¸ŠHTTP_</span>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-variable">$name</span>]?? (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_&#x27;</span>.<span class="hljs-variable">$name</span>] ?? <span class="hljs-variable">$defaultValue</span>);&#125;</code></pre></div><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/b8XamwywCv.png!large" alt="image"></p><p>æµ‹è¯•æ­£å¸¸ã€‚</p><p>å¦å¤–ï¼Œåšä¸€ä¸‹è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨public function test($params)ï¼Œæ˜¯æºäºæˆ‘ä»¬Requestï¼Œå°†å‚æ•°æ³¨å…¥åˆ°æ–¹æ³•é‡Œã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runAction</span>(<span class="hljs-params"><span class="hljs-variable">$route</span></span>)</span><span class="hljs-function"></span>&#123;    ... çœç•¥ä»£ç     <span class="hljs-keyword">return</span> <span class="hljs-variable">$controller</span>-&gt;<span class="hljs-variable">$action</span>(array_merge(<span class="hljs-keyword">$this</span>-&gt;getQueryParams(), <span class="hljs-keyword">$this</span>-&gt;getBodyParams()));&#125;</code></pre></div><h3 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h3><blockquote><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯wrkå‹æµ‹</p></blockquote><p><a href="https://github.com/wg/wrk">wrk</a></p><div class="code-wrapper"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">git clone https:<span class="hljs-comment">//github.com/wg/wrk</span></span><span class="hljs-meta">&gt;</span> <span class="javascript">cd wrk </span><span class="hljs-meta">&gt;</span> <span class="javascript">make</span><span class="hljs-meta">&gt;</span> <span class="javascript">ln -s ./wrk /usr/bin/wrk</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs vim">wrkå‚æ•°ï¼š-<span class="hljs-keyword">c</span>,    --connectionsï¼ˆè¿æ¥æ•°ï¼‰:      total <span class="hljs-keyword">number</span> of HTTP connections <span class="hljs-keyword">to</span> keep <span class="hljs-keyword">open</span> with each thread handling <span class="hljs-keyword">N</span> = connections/threads-d,    --durationï¼ˆæµ‹è¯•æŒç»­æ—¶é—´ï¼‰:     duration of the test, <span class="hljs-keyword">e</span>.g. <span class="hljs-number">2</span>s, <span class="hljs-number">2</span><span class="hljs-keyword">m</span>, <span class="hljs-number">2</span>h-t,    --threadsï¼ˆçº¿ç¨‹ï¼‰:            total <span class="hljs-keyword">number</span> of threads <span class="hljs-keyword">to</span> use-s,    --scriptï¼ˆè„šæœ¬ï¼‰:             LuaJIT script, see SCRIPTING-H,    --headerï¼ˆå¤´ä¿¡æ¯ï¼‰:           HTTP header <span class="hljs-keyword">to</span> <span class="hljs-built_in">add</span> <span class="hljs-keyword">to</span> request, <span class="hljs-keyword">e</span>.g. <span class="hljs-string">&quot;User-Agent: wrk&quot;</span>       --latencyï¼ˆå“åº”ä¿¡æ¯ï¼‰:         <span class="hljs-keyword">print</span> detailed latency statistics       --timeoutï¼ˆè¶…æ—¶æ—¶é—´ï¼‰:         record <span class="hljs-keyword">a</span> timeout <span class="hljs-keyword">if</span> <span class="hljs-keyword">a</span> response <span class="hljs-keyword">is</span> not received within this amount of time.-v,    --<span class="hljs-keyword">version</span>ï¼ˆç‰ˆæœ¬ä¿¡æ¯ï¼‰          <span class="hljs-keyword">Print</span> <span class="hljs-keyword">version</span> details</code></pre></div><p>æˆ‘ä»¬ä»…ä»…åœ¨æ§åˆ¶è¿”å›ç©ºä¿¡æ¯ï¼Œç„¶åå¯¹æ¯”yii2ï¼ˆè¿”å›å­—ç¬¦ä¸²â€œyii2â€ï¼‰ï¼Œlaravel5.5ï¼ˆè¿”å›å­—ç¬¦ä¸²â€œlaravel5.5â€ï¼‰ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/Lr272Ljbqz.png!large" alt="image"></p><p><img src="/images/qiniu/wrk2.png" alt="image"></p><p>å› ä¸ºæˆ‘ä»¬çš„æ¡†æ¶æ²¡æœ‰ä¸­é—´ä»¶ã€ç»„ä»¶ä¹‹ç±»çš„ï¼Œæ‰€ä»¥æ€§èƒ½å¯¹æ¯”yii2ã€laravelï¼ŒQPSè¦é«˜å¾ˆå¤šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š5.è‡ªå®šä¹‰é…ç½®ä¸è·¯ç”±</title>
    <link href="/2020/02/09/phpframe08/"/>
    <url>/2020/02/09/phpframe08/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><p>æˆ‘ä»¬å·²ç»å¼€å‘å®Œæˆï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦æ›´å¤šã€‚æ¯”å¦‚è‡ªå®šä¹‰é…ç½®å’Œè·¯ç”±ã€‚</p><p>appæ–‡ä»¶å¤¹ä¸‹æ–°å»ºConfig.php</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> *è‡ªå®šä¹‰é…ç½®</span><span class="hljs-comment"> */</span><span class="hljs-keyword">return</span> [    <span class="hljs-string">&#x27;debug&#x27;</span> =&gt; <span class="hljs-literal">false</span>,    <span class="hljs-string">&#x27;route&#x27;</span> =&gt; [        <span class="hljs-string">&#x27;&#x27;</span> =&gt; <span class="hljs-string">&#x27;demo/welcome&#x27;</span>,        <span class="hljs-string">&#x27;test&#x27;</span> =&gt; <span class="hljs-string">&#x27;demo/test&#x27;</span>,    ],];</code></pre></div><p>æ–°å»ºDemoControllerï¼ˆapp/Https/Controllersç›®å½•ä¸‹ï¼‰</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Demoæ§åˆ¶å™¨</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Controllers</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Controller</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">welcome</span>(<span class="hljs-params"><span class="hljs-variable">$params</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;response-&gt;json([<span class="hljs-string">&#x27;hello&#x27;</span> =&gt; <span class="hljs-string">&#x27;welcome&#x27;</span>]);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-variable">$params</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;response-&gt;json(<span class="hljs-variable">$params</span>);    &#125;&#125;</code></pre></div><p>ä¿®æ”¹å…¥å£æ–‡ä»¶index.php,åŠ å…¥åŠ è½½é…ç½®ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php">... çœç•¥ä»£ç <span class="hljs-comment">// åŠ è½½é…ç½®</span><span class="hljs-variable">$config</span> = <span class="hljs-keyword">require</span> SF_LIBRARY_PATH.<span class="hljs-string">&#x27;Config.php&#x27;</span>;<span class="hljs-variable">$appConfig</span> = file_exists(<span class="hljs-variable">$appConfigPath</span> = SF_APP_PATH.<span class="hljs-string">&#x27;Config.php&#x27;</span>) ? <span class="hljs-keyword">require</span> <span class="hljs-variable">$appConfigPath</span> : [];<span class="hljs-variable">$config</span> = array_merge(<span class="hljs-variable">$config</span>, <span class="hljs-variable">$appConfig</span>);<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;debug&#x27;</span>] = (<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;debug&#x27;</span>]?? SF_DEBUG);...çœç•¥ä»£ç </code></pre></div><p>è§£æè·¯ç”±éƒ¨åˆ†ä¹ŸåŠ å…¥è‡ªå®šä¹‰è·¯ç”±å¤„ç†ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// Application</span>...çœç•¥ä»£ç <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$route</span> = <span class="hljs-variable">$request</span>-&gt;resolve(<span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;route&#x27;</span>]??[]);    <span class="hljs-variable">$response</span> = <span class="hljs-variable">$request</span>-&gt;runAction(<span class="hljs-variable">$route</span>);    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ‰§è¡Œç»“æœèµ‹å€¼ç»™$response-&gt;dataï¼Œå¹¶è¿”å›ç»™responseå¯¹è±¡</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> Response) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;    &#125;    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SaiException(<span class="hljs-string">&#x27;Content format error&#x27;</span>);&#125;...çœç•¥ä»£ç <span class="hljs-comment">// Request</span>...çœç•¥ä»£ç <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runAction</span>(<span class="hljs-params"><span class="hljs-variable">$route</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (array_key_exists(<span class="hljs-variable">$route</span>, <span class="hljs-keyword">$this</span>-&gt;_route)) &#123;        <span class="hljs-variable">$route</span> = <span class="hljs-keyword">$this</span>-&gt;_route[<span class="hljs-variable">$route</span>];    &#125;    <span class="hljs-variable">$match</span> = explode(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-variable">$route</span>);    <span class="hljs-variable">$match</span> = array_filter(<span class="hljs-variable">$match</span>);    ...çœç•¥ä»£ç </code></pre></div><p>ä¿å­˜åæ‰“å¼€æµè§ˆå™¨çœ‹çœ‹æ•ˆæœï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/VAvnoQ1BZY.png!large" alt="image"></p><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/FnRaFKfjAC.png!large" alt="image"></p><p>è¿™é‡Œè™½ç„¶æœ‰è‡ªå®šä¹‰è·¯ç”±ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦ç¦æ­¢é»˜è®¤è·¯ç”±ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨å¢åŠ é…ç½®å‚æ•°defaultRouteï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å¼€å¯é»˜è®¤è·¯ç”±ã€‚</p><p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è·¯ç”±è§£æçš„ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//Application</span>...çœç•¥ä»£ç <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$route</span> = <span class="hljs-variable">$request</span>-&gt;resolve(<span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;route&#x27;</span>]??[]);    <span class="hljs-variable">$response</span> = <span class="hljs-variable">$request</span>-&gt;runAction(<span class="hljs-variable">$route</span>, <span class="hljs-keyword">$this</span>-&gt;_config[<span class="hljs-string">&#x27;defaultRoute&#x27;</span>]??<span class="hljs-literal">true</span>);    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ‰§è¡Œç»“æœèµ‹å€¼ç»™$response-&gt;dataï¼Œå¹¶è¿”å›ç»™responseå¯¹è±¡</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> Response) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;    &#125;    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SaiException(<span class="hljs-string">&#x27;Content format error&#x27;</span>);&#125;...çœç•¥ä»£ç </code></pre></div><div class="code-wrapper"><pre><code class="hljs php">...çœç•¥ä»£ç <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runAction</span>(<span class="hljs-params"><span class="hljs-variable">$route</span>, <span class="hljs-variable">$defaultRoute</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (array_key_exists(<span class="hljs-variable">$route</span>, <span class="hljs-keyword">$this</span>-&gt;_route)) &#123;        <span class="hljs-variable">$route</span> = <span class="hljs-keyword">$this</span>-&gt;_route[<span class="hljs-variable">$route</span>];    &#125; <span class="hljs-keyword">elseif</span> (!<span class="hljs-variable">$defaultRoute</span>) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotFoundException(<span class="hljs-string">&quot;route not found:&quot;</span>.<span class="hljs-variable">$route</span>);    &#125;    ...çœç•¥ä»£ç </code></pre></div><p>æˆ‘ä»¬åœ¨appä¸‹é¢çš„Configï¼ŒåŠ å…¥ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">return</span> [    <span class="hljs-string">&#x27;debug&#x27;</span> =&gt; <span class="hljs-literal">false</span>,    <span class="hljs-string">&#x27;route&#x27;</span> =&gt; [        <span class="hljs-string">&#x27;&#x27;</span> =&gt; <span class="hljs-string">&#x27;demo/welcome&#x27;</span>,        <span class="hljs-string">&#x27;test&#x27;</span> =&gt; <span class="hljs-string">&#x27;demo/test&#x27;</span>,    ],    <span class="hljs-string">&#x27;defaultRoute&#x27;</span> =&gt; <span class="hljs-literal">false</span>,];</code></pre></div><p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è¾“å…¥<a href="http://saif.com/login">http://saif.com/login</a></p><p>æŠ¥é”™å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre style="position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;">Array(    [line] =&gt; 137    [msg] =&gt; route not found:login    [code] =&gt; 404    [file] =&gt; library/Https/Request.php)</pre></div>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š4.å…¥å£æ–‡ä»¶</title>
    <link href="/2020/02/08/phpframe07/"/>
    <url>/2020/02/08/phpframe07/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><h3 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h3><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å®Œæˆäº†ä»è·¯ç”±è§£æåˆ°æ•°æ®è¾“å‡ºçš„è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¹‹å‰å·²ç»å®Œæˆäº†Requestçš„ç¼–å†™ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å†™å®Œå…¥å£æ–‡ä»¶ï¼ŒçœŸæ­£çš„å°†æˆ‘ä»¬çš„webåº”ç”¨è·‘èµ·æ¥äº†ã€‚</p><hr><p>å…¥å£æ–‡ä»¶é‡Œéœ€è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è¿˜è®°å¾—é‚£ä¸ªæµç¨‹å›¾å—ï¼Ÿ</p><p><img src="https://cdn.learnku.com/uploads/images/202002/18/41489/Fd5m6n01d6.png!large" alt="ç®€å•æµç¨‹å›¾"></p><p>æˆ‘ä»¬éœ€è¦åŠ è½½é…ç½®ï¼Œå®ä¾‹åŒ–Applicationå¹¶è¿è¡Œï¼Œå¹¶ä¸”å¼•å…¥åé¢å¯èƒ½é‡åˆ°çš„ä¸€äº›å¸¸é‡ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span>.DIRECTORY_SEPARATOR.<span class="hljs-string">&#x27;..&#x27;</span>.DIRECTORY_SEPARATOR.<span class="hljs-string">&#x27;library&#x27;</span>.DIRECTORY_SEPARATOR.<span class="hljs-string">&#x27;System.php&#x27;</span>;<span class="hljs-comment">// åŠ è½½é…ç½®</span><span class="hljs-variable">$config</span> = <span class="hljs-keyword">require</span> SF_LIBRARY_PATH.<span class="hljs-string">&#x27;Config.php&#x27;</span>;<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;debug&#x27;</span>] = (<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;debug&#x27;</span>]?? SF_DEBUG);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;debug&#x27;</span>]) &#123;    ini_set(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-string">&quot;On&quot;</span>);    error_reporting(E_ALL);&#125;<span class="hljs-comment">// composerè‡ªåŠ¨åŠ è½½</span><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/../vendor/autoload.php&#x27;</span>;<span class="hljs-comment">// å®ä¾‹åŒ–åº”ç”¨å¹¶è¿è¡Œ</span><span class="hljs-variable">$app</span> = <span class="hljs-keyword">new</span> Library\Application(<span class="hljs-keyword">new</span> Library\Https\Request() ,<span class="hljs-variable">$config</span>);<span class="hljs-variable">$app</span>-&gt;run();</code></pre></div><p>çŸ¥è¯†ç‚¹ï¼š</p><ol><li>__DIR__æ˜¯PHPçš„ä¸€ä¸ªé­”æœ¯å¸¸é‡ï¼Œå¯ä»¥ç†è§£æˆå½“å‰æ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚DIRECTORY_SEPARATORæ˜¯ä¸€ä¸ªæ˜¾ç¤ºç³»ç»Ÿåˆ†éš”ç¬¦çš„å‘½ä»¤ï¼ŒDIRECTORY_SEPARATORæ˜¯PHPçš„å†…éƒ¨å¸¸é‡ï¼Œä¸éœ€è¦ä»»ä½•å®šä¹‰ä¸åŒ…å«å³å¯ç›´æ¥ä½¿ç”¨ã€‚</li><li>ini_set â€” ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼</li><li>error_reporting â€” è®¾ç½®åº”è¯¥æŠ¥å‘Šä½•ç§ PHP é”™è¯¯</li></ol><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">// Turn off all error reporting</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-comment">// Report simple running errors</span>error_reporting(E_ERROR | E_WARNING | E_PARSE);<span class="hljs-comment">// Reporting E_NOTICE can be good too (to report uninitialized</span><span class="hljs-comment">// variables or catch variable name misspellings ...)</span>error_reporting(E_ERROR | E_WARNING | E_PARSE | E_NOTICE);<span class="hljs-comment">// Report all errors except E_NOTICE</span>error_reporting(E_ALL &amp; ~E_NOTICE);<span class="hljs-comment">// Report all PHP errors (see changelog)</span>error_reporting(E_ALL);<span class="hljs-comment">// Report all PHP errors</span>error_reporting(-<span class="hljs-number">1</span>);<span class="hljs-comment">// Same as error_reporting(E_ALL);</span>ini_set(<span class="hljs-string">&#x27;error_reporting&#x27;</span>, E_ALL);<span class="hljs-meta">?&gt;</span></code></pre></div><h3 id="System-php"><a href="#System-php" class="headerlink" title="System.php"></a>System.php</h3><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">// debugé»˜è®¤å¼€å¯</span>defined(<span class="hljs-string">&#x27;SF_DEBUG&#x27;</span>) <span class="hljs-keyword">or</span> define(<span class="hljs-string">&#x27;SF_DEBUG&#x27;</span>, <span class="hljs-literal">true</span>);<span class="hljs-comment">// æ¡†æ¶å¼€å§‹è¿è¡Œæ—¶é—´</span>defined(<span class="hljs-string">&#x27;SF_START_TIME&#x27;</span>) <span class="hljs-keyword">or</span> define(<span class="hljs-string">&#x27;SF_START_TIME&#x27;</span>, microtime(<span class="hljs-literal">true</span>));<span class="hljs-comment">// æ ¸å¿ƒæ–‡ä»¶ç›®å½•</span>defined(<span class="hljs-string">&#x27;SF_LIBRARY_PATH&#x27;</span>) <span class="hljs-keyword">or</span> define(<span class="hljs-string">&#x27;SF_LIBRARY_PATH&#x27;</span>, <span class="hljs-keyword">__DIR__</span>.DIRECTORY_SEPARATOR);<span class="hljs-comment">// åº”ç”¨ç›®å½•</span>defined(<span class="hljs-string">&#x27;SF_APP_PATH&#x27;</span>) <span class="hljs-keyword">or</span> define(<span class="hljs-string">&#x27;SF_APP_PATH&#x27;</span>, <span class="hljs-keyword">__DIR__</span>.DIRECTORY_SEPARATOR.<span class="hljs-string">&#x27;..&#x27;</span>.DIRECTORY_SEPARATOR.<span class="hljs-string">&#x27;app&#x27;</span>.DIRECTORY_SEPARATOR);<span class="hljs-comment">// å…¥å£ç›®å½•</span>defined(<span class="hljs-string">&#x27;SF_PUBLIC_PATH&#x27;</span>) <span class="hljs-keyword">or</span> define(<span class="hljs-string">&#x27;SF_PUBLIC_PATH&#x27;</span>, <span class="hljs-keyword">__DIR__</span>.DIRECTORY_SEPARATOR.<span class="hljs-string">&#x27;..&#x27;</span>.DIRECTORY_SEPARATOR.<span class="hljs-string">&#x27;public&#x27;</span>.DIRECTORY_SEPARATOR);</code></pre></div><h3 id="Config-php"><a href="#Config-php" class="headerlink" title="Config.php"></a>Config.php</h3><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * ç³»ç»Ÿé…ç½®</span><span class="hljs-comment"> */</span><span class="hljs-keyword">return</span> [    <span class="hljs-string">&#x27;debug&#x27;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-comment">// å»ºè®®å¼€å‘è¿‡ç¨‹ä¸­å¼€å¯</span>];</code></pre></div><hr><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„æ¡†æ¶å·²ç»å¯ä»¥è¿è¡Œèµ·æ¥äº†ã€‚</p><h3 id="è¿è¡Œåº”ç”¨"><a href="#è¿è¡Œåº”ç”¨" class="headerlink" title="è¿è¡Œåº”ç”¨"></a>è¿è¡Œåº”ç”¨</h3><p>é…ç½®Nginx</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;    <span class="hljs-attribute">server_name</span>  saif.com;    <span class="hljs-comment"># æ¡†æ¶æ ¹ç›®å½•</span>    <span class="hljs-attribute">root</span> /Users/sai/Work/www/saif/public;    <span class="hljs-attribute">location</span> / &#123;        <span class="hljs-attribute">index</span> index.html index.htm index.php;        <span class="hljs-attribute">try_files</span> $uri $uri/ /index.php?$query_string;    &#125;    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;    <span class="hljs-attribute">location</span> = /50x.html &#123;    &#125;    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ \.php$</span> &#123;        <span class="hljs-attribute">fastcgi_pass</span>   <span class="hljs-number">127.0.0.1:9000</span>;        <span class="hljs-attribute">fastcgi_index</span>  index.php;        <span class="hljs-attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;        <span class="hljs-attribute">include</span>        fastcgi_params;    &#125;&#125;</code></pre></div><p>æµè§ˆå™¨è¾“å…¥<a href="http://saif.com./">http://saif.comã€‚</a></p><p>ä½ ä¼šçœ‹åˆ°è¿”å›çš„jsonæ•°ç»„ï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/202002/20/41489/Nm11LNESo9.png!large" alt="æ¡†æ¶å…¥å£"></p><p>å¤‡æ³¨ï¼šå‰é¢3è¡Œè¯·å¿½ç•¥ï¼Œæ˜¯æˆ‘æµè§ˆå™¨çš„æ’ä»¶è‡ªåŠ¨åŠ å…¥çš„ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åŸºç¡€APIæ¡†æ¶çš„å¼€å‘ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š3.è·¯ç”±è§£æ</title>
    <link href="/2020/02/08/phpframe06/"/>
    <url>/2020/02/08/phpframe06/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><h3 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h3><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†ç¼–å†™äº†å¦‚ä½•å¤„ç†è¯·æ±‚ä¸è¾“å‡ºæ•°æ®ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å¼€å§‹ç¼–å†™è·¯ç”±æ¨¡å—ã€‚</p><hr><h3 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h3><p>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰å»ºç«‹çš„Applicationåœ¨å“ªé‡Œå—ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ€è€ƒä¸€ä¸‹Applicationåº”è¯¥å…·å¤‡å“ªäº›åŠŸèƒ½ï¼Ÿ</p><p>é¦–å…ˆå¾ˆé‡è¦çš„ï¼Œæˆ‘ä»¬è¦è®©åº”ç”¨è¿è¡Œèµ·æ¥ï¼Œå§‘ä¸”å°±å…ˆå®šä¹‰runæ–¹æ³•ã€‚å¦å¤–æˆ‘ä»¬éœ€è¦å¤„ç†è¯·æ±‚å¹¶ä¸”è¾“å‡ºæ•°æ®ï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªhandleRequestæ–¹æ³•ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨æ˜¯æœ‰ä¸€äº›é…ç½®ä¿¡æ¯ï¼ˆconfigï¼‰çš„ã€‚</p><p>å› ä¸ºï¼Œæˆ‘ä»¬ä¸éš¾ç¼–å†™å‡ºä»¥ä¸‹ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">SaiException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Request</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Https</span>\<span class="hljs-title">Response</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$config</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$request</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span>, <span class="hljs-variable">$config</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;config = <span class="hljs-variable">$config</span>;        <span class="hljs-keyword">$this</span>-&gt;request = <span class="hljs-variable">$request</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¿è¡Œåº”ç”¨å¹¶è¾“å‡ºæ•°æ®</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> bool</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-variable">$response</span> = <span class="hljs-keyword">$this</span>-&gt;handleRequest(<span class="hljs-keyword">$this</span>-&gt;request);            <span class="hljs-variable">$response</span>-&gt;send();            <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>-&gt;exitStatus;        &#125; <span class="hljs-keyword">catch</span> (SaiException <span class="hljs-variable">$e</span>) &#123;            <span class="hljs-variable">$e</span>-&gt;response(<span class="hljs-variable">$e</span>-&gt;getCode(), [                <span class="hljs-string">&#x27;line&#x27;</span> =&gt; <span class="hljs-variable">$e</span>-&gt;getLine(),                <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-variable">$e</span>-&gt;getMessage(),                <span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-variable">$e</span>-&gt;getCode(),                <span class="hljs-string">&#x27;file&#x27;</span> =&gt; <span class="hljs-variable">$e</span>-&gt;getFile(),            ]);            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å¤„ç†è¯·æ±‚</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> Request $request</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed</span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> SaiException</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">// todo</span>        <span class="hljs-comment">// è¿”å›Responseå¯¹è±¡</span>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;    &#125;&#125;</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°handleRequestæ–¹æ³•è¿˜æœ‰ä¸€éƒ¨åˆ†ä»£ç ä¸ºå®Œæˆï¼Œå›æƒ³ä»¥ä¸‹æµç¨‹å›¾ï¼Œè¿™é‡Œå°±æ˜¯æˆ‘ä»¬æ¯”è¾ƒæ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œè·¯ç”±å¤„ç†æ¨¡å—ã€‚</p><h3 id="è·¯ç”±è§£æ"><a href="#è·¯ç”±è§£æ" class="headerlink" title="è·¯ç”±è§£æ"></a>è·¯ç”±è§£æ</h3><p>è·¯ç”±è§£ææˆ‘ä»¬ä½¿ç”¨éå¸¸ç®€å•è€Œå¸¸è§çš„å¤„ç†æ–¹å¼ï¼Œä¸å¦¨çœ‹å‡ ä¸ªurlä¾‹å­æ¥ç†è§£ä¸€ä¸‹ï¼š</p><table><thead><tr><th>route</th><th>controller</th><th>method</th></tr></thead><tbody><tr><td><a href="http://blog.13sai.com/">http://blog.13sai.com/</a></td><td>IndexController</td><td>index</td></tr><tr><td><a href="http://blog.13sai.com/admin">http://blog.13sai.com/admin</a></td><td>AdminController</td><td>index</td></tr><tr><td><a href="http://blog.13sai.com/admin/test">http://blog.13sai.com/admin/test</a></td><td>AdminController</td><td>test</td></tr><tr><td><a href="http://blog.13sai.com/admin/index/test">http://blog.13sai.com/admin/index/test</a></td><td>Admin\IndexController</td><td>test</td></tr></tbody></table><p>æœ‰æ²¡æœ‰çœ‹å‡ºè§„å¾‹ï¼Œæˆ‘ä»¬ä¼šä»¥æ–œæ /åˆ†å‰²è·¯ç”±ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œæœ€åä¸¤éƒ¨åˆ†åˆ†åˆ«æ˜¯å¯¹åº”çš„æ§åˆ¶å™¨åç§°å’Œæ–¹æ³•åç§°ï¼Œå°‘äºä¸¤éƒ¨åˆ†é»˜è®¤ç”¨indexï¼Œå¤šä½™ä¸¤éƒ¨åˆ†çš„ä½œä¸ºæ§åˆ¶å™¨çš„å‘½åç©ºé—´ã€‚ç„¶åæˆ‘ä»¬è¦æ ¹æ®è·¯ç”±æ‰¾åˆ°æ§åˆ¶å™¨æ„å»ºå‡ºæ§åˆ¶å™¨ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ§åˆ¶å™¨å¤„ç†</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> $route</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> mixed</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> NotFoundException</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runAction</span>(<span class="hljs-params"><span class="hljs-variable">$route</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$match</span> = explode(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-variable">$route</span>);    <span class="hljs-variable">$match</span> = array_filter(<span class="hljs-variable">$match</span>);    <span class="hljs-comment">// å¤„ç†$route=/</span>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$match</span>)) &#123;        <span class="hljs-variable">$match</span> = [<span class="hljs-string">&#x27;index&#x27;</span>];        <span class="hljs-variable">$controller</span> = <span class="hljs-keyword">$this</span>-&gt;createController(<span class="hljs-variable">$match</span>);        <span class="hljs-variable">$action</span> = <span class="hljs-string">&#x27;index&#x27;</span>;    <span class="hljs-comment">// å¤„ç†$route=index</span>    &#125; <span class="hljs-keyword">elseif</span> (count(<span class="hljs-variable">$match</span>) &lt; <span class="hljs-number">2</span>) &#123;        <span class="hljs-variable">$controller</span> = <span class="hljs-keyword">$this</span>-&gt;createController(<span class="hljs-variable">$match</span>);        <span class="hljs-variable">$action</span> = <span class="hljs-string">&#x27;index&#x27;</span>;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$action</span> = array_pop(<span class="hljs-variable">$match</span>);        <span class="hljs-variable">$controller</span> = <span class="hljs-keyword">$this</span>-&gt;createController(<span class="hljs-variable">$match</span>);        <span class="hljs-keyword">if</span> (!method_exists(<span class="hljs-variable">$controller</span>, <span class="hljs-variable">$action</span>)) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotFoundException(<span class="hljs-string">&quot;method not found:&quot;</span>.<span class="hljs-variable">$action</span>);        &#125;    &#125;    <span class="hljs-comment">// å°†getå’Œpostæ³¨å…¥æ§åˆ¶å™¨æ–¹æ³•ä¸­</span>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$controller</span>-&gt;<span class="hljs-variable">$action</span>(array_merge(<span class="hljs-keyword">$this</span>-&gt;getQueryParams(), <span class="hljs-keyword">$this</span>-&gt;getBodyParams()));&#125;<span class="hljs-comment">// appåº”ç”¨æ§åˆ¶å™¨å‘½åç©ºé—´</span><span class="hljs-keyword">private</span> <span class="hljs-variable">$controllerNameSpace</span> = <span class="hljs-string">&#x27;App\\Https\\Controllers\\&#x27;</span>;<span class="hljs-comment">// ä¹‹å‰å®šä¹‰çš„åŸºç±»æ§åˆ¶å™¨</span><span class="hljs-keyword">private</span> <span class="hljs-variable">$baseController</span> = <span class="hljs-string">&#x27;Library\\Https\\Controller&#x27;</span>;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createController</span>(<span class="hljs-params"><span class="hljs-variable">$match</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$controllerName</span> = <span class="hljs-keyword">$this</span>-&gt;controllerNameSpace;    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$match</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$namespace</span>) &#123;        <span class="hljs-variable">$controllerName</span> .= ucfirst(<span class="hljs-variable">$namespace</span>).<span class="hljs-string">&#x27;\\&#x27;</span>;    &#125;    <span class="hljs-variable">$controllerName</span> = rtrim(<span class="hljs-variable">$controllerName</span>,<span class="hljs-string">&#x27;\\&#x27;</span>).<span class="hljs-string">&#x27;Controller&#x27;</span>;    <span class="hljs-keyword">if</span> (!class_exists(<span class="hljs-variable">$controllerName</span>)) &#123;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$controllerName</span> == <span class="hljs-keyword">$this</span>-&gt;controllerNameSpace.<span class="hljs-string">&#x27;IndexController&#x27;</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">$this</span>-&gt;baseController;        &#125;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotFoundException(<span class="hljs-string">&quot;controller not found:&quot;</span>.<span class="hljs-variable">$controllerName</span>);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$controllerName</span>;&#125;</code></pre></div><p>ä¸Šé¢æ˜¯å¯»æ‰¾æ§åˆ¶å™¨å’Œæ–¹æ³•çš„è¿‡ç¨‹ï¼Œä½†æˆ‘ä»¬éœ€è¦æå‰è·å¾—é¡µé¢åœ°å€ä»¥è§£æè·¯ç”±ã€‚</p><p>çŸ¥è¯†ç‚¹ï¼š</p><ol><li>åæ–œæ ï¼šåæ–œçº¿æœ‰å¤šç§ç”¨æ³•ã€‚é¦–å…ˆï¼Œå¦‚æœç´§æ¥ç€æ˜¯ä¸€ä¸ªéå­—æ¯æ•°å­—å­—ç¬¦ï¼Œè¡¨æ˜å–æ¶ˆ è¯¥å­—ç¬¦æ‰€ä»£è¡¨çš„ç‰¹æ®Šæ¶µä¹‰ã€‚è¿™ç§å°†åæ–œçº¿ä½œä¸ºè½¬ä¹‰å­—ç¬¦çš„ç”¨æ³•åœ¨å­—ç¬¦ç±» å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ç”¨ã€‚</li><li>array_filter ( array $array [, callable $callback [, int $flag = 0 ]] ) : arrayâ€”â€”ä¾æ¬¡å°† array æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¼ é€’åˆ° callback å‡½æ•°ã€‚å¦‚æœ callback å‡½æ•°è¿”å› trueï¼Œåˆ™ array æ•°ç»„çš„å½“å‰å€¼ä¼šè¢«åŒ…å«åœ¨è¿”å›çš„ç»“æœæ•°ç»„ä¸­ã€‚æ•°ç»„çš„é”®åä¿ç•™ä¸å˜ã€‚ä»£ç ä¸­æ˜¯è¿‡æ»¤valueä¸ºç©ºçš„å•å…ƒã€‚</li></ol><h3 id="è·å–é¡µé¢åœ°å€"><a href="#è·å–é¡µé¢åœ°å€" class="headerlink" title="è·å–é¡µé¢åœ°å€"></a>è·å–é¡µé¢åœ°å€</h3><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">/**</span><span class="hljs-comment"> * è¿”å›ä¸å«å‚æ•°çš„REQUEST_URIåœ°å€</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolve</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;getPathUrl();&#125;<span class="hljs-keyword">private</span> <span class="hljs-variable">$pathUrl</span>;<span class="hljs-comment">/**</span><span class="hljs-comment"> * è·å–è¯·æ±‚åœ°å€</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> bool|mixed|string</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPathUrl</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (is_null(<span class="hljs-keyword">$this</span>-&gt;pathUrl)) &#123;        <span class="hljs-variable">$url</span> = trim(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>], <span class="hljs-string">&#x27;/&#x27;</span>);        <span class="hljs-variable">$index</span> = strpos(<span class="hljs-variable">$url</span>, <span class="hljs-string">&#x27;?&#x27;</span>);        <span class="hljs-keyword">$this</span>-&gt;pathUrl = (<span class="hljs-variable">$index</span> &gt; -<span class="hljs-number">1</span>) ? substr(<span class="hljs-variable">$url</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$index</span>) : <span class="hljs-variable">$url</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;pathUrl;&#125;</code></pre></div><p>æˆ‘ä»¬å°½é‡è®©Applicationå˜å¾—ç®€æ´ï¼Œè€Œè·¯ç”±è§£æåˆå’ŒRequestå…³è”åº¦è¾ƒé«˜ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¦¨æŠŠè¿™äº›æ–¹æ³•æŠ›å‡ºåˆ°Requestå¯¹è±¡ã€‚</p><p>çŸ¥è¯†ç‚¹ï¼š</p><ol><li>strpos ( string $haystack , mixed $needle [, int $offset = 0 ] ) : intâ€”â€”è¿”å› needle åœ¨ haystack ä¸­é¦–æ¬¡å‡ºç°çš„æ•°å­—ä½ç½®ï¼Œå¦‚æœæ²¡æ‰¾åˆ° needleï¼Œå°†è¿”å› FALSEã€‚</li></ol><p>ä¸Šé¢å·²ç»è§£æå¥½è·¯ç”±å¹¶ä¸”æ‰¾åˆ°äº†æ§åˆ¶å™¨å’Œæ–¹æ³•ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®Œå–„Applicationçš„ä»£ç äº†ã€‚</p><h3 id="å¤„ç†è¯·æ±‚"><a href="#å¤„ç†è¯·æ±‚" class="headerlink" title="å¤„ç†è¯·æ±‚"></a>å¤„ç†è¯·æ±‚</h3><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$route</span> = <span class="hljs-variable">$request</span>-&gt;resolve();    <span class="hljs-variable">$response</span> = <span class="hljs-variable">$request</span>-&gt;runAction(<span class="hljs-variable">$route</span>);    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ‰§è¡Œç»“æœèµ‹å€¼ç»™$response-&gt;dataï¼Œå¹¶è¿”å›ç»™responseå¯¹è±¡</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> Response) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;    &#125;    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SaiException(<span class="hljs-string">&#x27;è¾“å‡ºçš„å†…å®¹æ ¼å¼é”™è¯¯&#x27;</span>);&#125;</code></pre></div><p>å†æ¬¡éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä»…åšäº†jsonæ ¼å¼è¾“å‡ºï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œä½ å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ‹“å±•ä¸€ä¸‹ã€‚</p><p>å¦ï¼šNotFoundExceptionç»§æ‰¿è‡ªSaiExceptionï¼Œä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Exceptions</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotFoundException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SaiException</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$code</span> = <span class="hljs-number">404</span>;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š2.è¯·æ±‚ä¸è¾“å‡º</title>
    <link href="/2020/02/04/phpframe05/"/>
    <url>/2020/02/04/phpframe05/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><p>æˆ‘ä»¬åœ¨library\Httpsç›®å½•ä¸‹æ–°å»ºRequestã€Responseï¼Œå¼€å§‹ç¼–å†™è¯·æ±‚å’Œè¾“å‡ºçš„ä»£ç ã€‚</p><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>æˆ‘ä»¬å®ç°å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œgetã€postã€methodç­‰ï¼Œè¿™é‡Œä¸»è¦ç”¨$_SERVERå®ç°ï¼Œä¸ºäº†å¤ç”¨æˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªç§æœ‰å±æ€§å­˜å‚¨getå‚æ•°ã€postå‚æ•°å’Œmethodã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * å¤„ç†è¯·æ±‚</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Https</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Components</span>\<span class="hljs-title">Base</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Base</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è·å–è¯·æ±‚æ–¹æ³•</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> string</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMethod</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>])) &#123;            <span class="hljs-keyword">return</span> strtoupper(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>]);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;GET&#x27;</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¯·æ±‚å¤´</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> $name</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> null $defaultValue</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed|null</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHeader</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$defaultValue</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$name</span> = ucfirst(<span class="hljs-variable">$name</span>);        <span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">&#x27;apache_request_headers&#x27;</span>)) &#123;            <span class="hljs-variable">$headers</span> = apache_request_headers();            <span class="hljs-keyword">return</span> <span class="hljs-variable">$headers</span>[<span class="hljs-variable">$name</span>]?? <span class="hljs-variable">$defaultValue</span>;        &#125;        <span class="hljs-variable">$name</span> = strtoupper(<span class="hljs-variable">$name</span>);        <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-variable">$name</span>]?? <span class="hljs-variable">$defaultValue</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è·å–getå‚æ•°</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> null $name</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> null $defaultValue</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> |null</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$defaultValue</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$name</span> === <span class="hljs-literal">null</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;getQueryParams();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;getQueryParam(<span class="hljs-variable">$name</span>, <span class="hljs-variable">$defaultValue</span>);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getQueryParam</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$defaultValue</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$params</span> = <span class="hljs-keyword">$this</span>-&gt;getQueryParams();        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$params</span>[<span class="hljs-variable">$name</span>]) ? <span class="hljs-variable">$params</span>[<span class="hljs-variable">$name</span>] : <span class="hljs-variable">$defaultValue</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getQueryParams</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;queryParams)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;queryParams = <span class="hljs-variable">$_GET</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;queryParams;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è·å–postå‚æ•°</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> null $name</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> null $defaultValue</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> array|mixed|null</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">post</span>(<span class="hljs-params"><span class="hljs-variable">$name</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$defaultValue</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$name</span> === <span class="hljs-literal">null</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;getBodyParams();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;getBodyParam(<span class="hljs-variable">$name</span>, <span class="hljs-variable">$defaultValue</span>);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBodyParam</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$defaultValue</span> = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$params</span> = <span class="hljs-keyword">$this</span>-&gt;getBodyParams();        <span class="hljs-keyword">if</span> (is_object(<span class="hljs-variable">$params</span>)) &#123;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-keyword">return</span> <span class="hljs-variable">$params</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;;            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-variable">$defaultValue</span>;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$params</span>[<span class="hljs-variable">$name</span>]) ? <span class="hljs-variable">$params</span>[<span class="hljs-variable">$name</span>] : <span class="hljs-variable">$defaultValue</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBodyParams</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$contentType</span> = strtolower(<span class="hljs-keyword">$this</span>-&gt;getHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>));        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$contentType</span> == <span class="hljs-string">&#x27;multipart/form-data&#x27;</span>) &#123;            <span class="hljs-keyword">$this</span>-&gt;bodyParams = <span class="hljs-variable">$_POST</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">$this</span>-&gt;bodyParams = \json_decode(file_get_contents(<span class="hljs-string">&quot;php://input&quot;</span>), <span class="hljs-literal">true</span>);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;bodyParams?? [];    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * getå‚æ•°æ•°ç»„</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$queryParams</span> = [];    <span class="hljs-comment">/**</span><span class="hljs-comment">     * postå‚æ•°æ•°ç»„</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$bodyParams</span> = [];    <span class="hljs-keyword">private</span> <span class="hljs-variable">$method</span>;&#125;</code></pre></div><p>çŸ¥è¯†ç‚¹ï¼š</p><ol><li>è·å–è¯·æ±‚å¤´éƒ¨ä¿¡æ¯çš„æ–¹å¼nginxå’Œapacheä¸åŒ</li></ol><ul><li>apacheå¯ä»¥ä½¿ç”¨apache_request_headers</li><li>nginxä½¿ç”¨$_SERVERï¼Œå¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯çš„æ˜¯è‡ªå®šä¹‰ä¿¡æ¯ç­‰å‚æ•°ä¼šåœ¨å‰é¢è‡ªåŠ¨åŠ ä¸Šhttp_ï¼Œå¹¶ä¸”ä¼šè½¬æ¢ä¸ºå¤§å†™</li></ul><p><img src="/images/qiniu/server.png" alt="serverå›¾ç‰‡"></p><ol start="2"><li>postå‚æ•°è·å–çš„æ–¹å¼</li></ol><ul><li>å½“Content-Typeæ˜¯<code>application/x-www-data-urlencoded</code>æˆ–<code>multipart/form-data</code>æ—¶ï¼Œæ•°æ®ä¼šæ”¾è¿›$_POSTä¸­ï¼›</li><li>é™¤äº†Coentent-Typeä¸ºmultipart/form-dataçš„æƒ…å†µï¼Œæ•°æ®éƒ½å¯ä»¥é€šè¿‡file_get_contents(â€œphp://inputâ€)å–åˆ°ï¼›</li><li>ä¸å»ºè®®ä½¿ç”¨$GLOBALS[â€˜HTTP_RAW_POST_DATAâ€™]</li></ul><hr><h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><p>Responseé»˜è®¤ä»¥ä½¿ç”¨å¹¿æ³›çš„jsonè¾“å‡ºï¼Œæš‚æ—¶ä¹Ÿåªè€ƒè™‘jsonæ ¼å¼è¾“å‡ºçš„æƒ…å†µã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ•°æ®è¾“å‡º</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Https</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Components</span>\<span class="hljs-title">Base</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Response</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Base</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span> = <span class="hljs-number">0</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$result</span> = [];    <span class="hljs-keyword">public</span> <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;success&quot;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        header(<span class="hljs-string">&#x27;Content-Type:application/json; charset=utf-8&#x27;</span>);        <span class="hljs-keyword">echo</span> \json_encode([            <span class="hljs-string">&#x27;data&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;result,            <span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;msg,            <span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;code,            <span class="hljs-string">&#x27;timestamp&#x27;</span> =&gt; time()        ]);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">json</span>(<span class="hljs-params"><span class="hljs-variable">$data</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;result = array_merge(<span class="hljs-keyword">$this</span>-&gt;result, <span class="hljs-variable">$data</span>);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;    &#125;&#125;</code></pre></div><p>çŸ¥è¯†ç‚¹ï¼š</p><ol><li>header() ç”¨äºå‘é€åŸç”Ÿçš„ HTTP å¤´ã€‚</li><li>json_encode ( mixed $value [, int $options = 0 [, int $depth = 512 ]] ) : string â€” å¯¹å˜é‡è¿›è¡Œ JSON ç¼–ç ï¼Œ<a href="https://www.php.net/manual/zh/json.constants.php">optionså¯ä»¥é¢„å®šä¹‰å¸¸é‡</a>ï¼Œå¦‚ JSON_UNESCAPED_UNICODEï¼ŒJSON_UNESCAPED_SLASHESã€‚</li></ol><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>ç»“åˆè¾“å‡ºå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªåŸºç±»æ§åˆ¶å™¨ï¼Œä¹Ÿæ”¾åœ¨ç›¸åŒçš„Httpsç›®å½•ï¼Œæˆ‘ä»¬æ§åˆ¶åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªResponseï¼Œå¹¶å®ç°ä¸€ä¸ªé€šç”¨çš„jsonï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * åŸºç±»æ§åˆ¶å™¨</span><span class="hljs-comment"> * é¢„å®šä¹‰jsonæ–¹æ³•ï¼Œä¾¿äºå…¶ä»–æ§åˆ¶å™¨ä½¿ç”¨</span><span class="hljs-comment"> * è¿”å›æ ¼å¼</span><span class="hljs-comment"> &#123;</span><span class="hljs-comment">    &quot;data&quot;: [],</span><span class="hljs-comment">    &quot;msg&quot;: &quot;success&quot;,</span><span class="hljs-comment">    &quot;code&quot;: 0,</span><span class="hljs-comment">    &quot;timestamp&quot;: 1572231957</span><span class="hljs-comment">&#125;</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Https</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Controller</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$response</span>;    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$code</span> = <span class="hljs-number">200</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;response = <span class="hljs-keyword">new</span> Response();    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">json</span>(<span class="hljs-params"><span class="hljs-variable">$data</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;response-&gt;json(<span class="hljs-variable">$data</span>);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"><span class="hljs-variable">$params</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;response-&gt;json([<span class="hljs-string">&#x27;hello&#x27;</span> =&gt; <span class="hljs-string">&#x27;saif&#x27;</span>]);    &#125;&#125;</code></pre></div><p>appåº”ç”¨é‡Œçš„æ§åˆ¶å™¨éƒ½å¿…é¡»ç»§æ‰¿è¿™ä¸ªåŸºç±»æ§åˆ¶å™¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶ç¯‡ï¼š1.æ¡†æ¶ç›®å½•ä¸è¾…åŠ©</title>
    <link href="/2020/02/02/phpframe04/"/>
    <url>/2020/02/02/phpframe04/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><p>é‚£ä¹ˆå°±åˆ©ç”¨composeræ¥å¼€å§‹æˆ‘ä»¬çš„é¡¹ç›®å§ã€‚</p><p>æ–°å»ºç›®å½•å¹¶è¿›å…¥ç›®å½•ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p><blockquote><p>composer init</p></blockquote><p>å‘½ä»¤è¡Œä¼šè·Ÿä½ ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼ˆä»¥ä¸‹ä¿¡æ¯å¯ä»¥è‡ªè¡ŒDIYï¼‰</p><div class="code-wrapper"><pre><code class="hljs livescript"><span class="hljs-comment"># 1. è¾“å…¥é¡¹ç›®å‘½åç©ºé—´</span><span class="hljs-comment"># æ³¨æ„&lt;vendor&gt;/&lt;name&gt; å¿…é¡»è¦ç¬¦åˆ [a-z0-9_.-]+/[a-z0-9_.-]+</span>Package name (&lt;vendor&gt;/&lt;name&gt;) yourname/projectname<span class="hljs-comment"># 2. é¡¹ç›®æè¿°</span>Description []:è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•composer init é¡¹ç›®<span class="hljs-comment"># 3. è¾“å…¥ä½œè€…ä¿¡æ¯</span>Author [<span class="hljs-number">13sai</span> &lt;sai0556@qq.com&gt;, n <span class="hljs-keyword">to</span> skip]:<span class="hljs-comment"># 4. è¾“å…¥æœ€ä½ç¨³å®šç‰ˆæœ¬ï¼Œstable, RC, beta, alpha, dev</span>Minimum Stability []:dev<span class="hljs-comment"># 5. è¾“å…¥é¡¹ç›®ç±»å‹</span>Package Type (e.g. library, project, metapackage, composer-plugin) []:project<span class="hljs-comment"># 6. è¾“å…¥æˆæƒç±»å‹</span>License []:MITDefine your dependencies.<span class="hljs-comment"># 7. è¾“å…¥ä¾èµ–ä¿¡æ¯</span>Would you like <span class="hljs-keyword">to</span> define your dependencies (<span class="hljs-built_in">require</span>) interactively [<span class="hljs-literal">yes</span>]?<span class="hljs-comment"># 7.1. å¦‚æœéœ€è¦ä¾èµ–ï¼Œåˆ™è¾“å…¥è¦å®‰è£…çš„ä¾èµ–</span>Search <span class="hljs-keyword">for</span> a package:php<span class="hljs-comment"># 7.2. è¾“å…¥ç‰ˆæœ¬å·</span>Enter the version constraint <span class="hljs-keyword">to</span> <span class="hljs-built_in">require</span> (<span class="hljs-keyword">or</span> leave blank <span class="hljs-keyword">to</span> use the latest version): &gt;=<span class="hljs-number">5.4</span>.<span class="hljs-number">0</span><span class="hljs-comment">#  å¦‚éœ€å¤šä¸ªä¾èµ–ï¼Œåˆ™é‡å¤ä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤(7.1/7.2)</span>Search <span class="hljs-keyword">for</span> a package:<span class="hljs-comment"># 8. æ˜¯å¦éœ€è¦require-devï¼Œ</span>Would you like <span class="hljs-keyword">to</span> define your dev dependencies (<span class="hljs-built_in">require</span>-dev) interactively [<span class="hljs-literal">yes</span>]?&#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;sai/saif&quot;</span>,    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;php framework&quot;</span>,    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;project&quot;</span>,    <span class="hljs-string">&quot;require&quot;</span>: &#123;    &#125;,    <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;MIT&quot;</span>,    <span class="hljs-string">&quot;authors&quot;</span>: [        &#123;            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;13sai&quot;</span>,            <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;sai0556@qq.com&quot;</span>        &#125;    ],    <span class="hljs-string">&quot;minimum-stability&quot;</span>: <span class="hljs-string">&quot;dev&quot;</span>&#125;<span class="hljs-comment"># 9. æ˜¯å¦ç”Ÿæˆcomposer.json</span>Do you confirm generation [<span class="hljs-literal">yes</span>]?<span class="hljs-comment"># ç°åœ¨å®‰è£…ä¾èµ–é¡¹å—</span>Would you like <span class="hljs-keyword">to</span> install dependencies now [<span class="hljs-literal">yes</span>]?</code></pre></div><p>æˆ‘ä»¬çš„ç›®å½•ä¸‹ä¼šç”Ÿæˆcomposer.jsonã€‚</p><hr><p>ç„¶åæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š</p><blockquote><p>ä½ è§‰å¾—ä¸€ä¸ªåŸºç¡€çš„APIæ¡†æ¶éœ€è¦ä»€ä¹ˆæ¨¡å—å‘¢ï¼Ÿ</p></blockquote><p>ä¸‹é¢æ˜¯æˆ‘çš„æ€è€ƒç»“æœï¼š</p><ul><li>è·¯ç”±</li><li>è¯·æ±‚</li><li>æ•°æ®å“åº”</li><li>å¼‚å¸¸å¤„ç†</li><li>æ—¥å¿—ç³»ç»Ÿâ€¦</li></ul><p>å½“ç„¶ï¼Œä½ å¯èƒ½è§‰å¾—è¿˜åº”è¯¥æœ‰ï¼š</p><ul><li>é…ç½®</li><li>session</li><li>ç¼“å­˜</li><li>éªŒè¯</li><li>æ¨¡å‹</li><li>æœåŠ¡å±‚</li><li>æ–‡ä»¶ä¸Šä¼ â€¦</li></ul><p>ä¹Ÿè®¸ä½ æƒ³åˆ°æ›´å¤šï¼š</p><ul><li>ä»»åŠ¡è°ƒåº¦</li><li>é˜Ÿåˆ—</li><li>ç”¨æˆ·éªŒè¯</li><li>é”</li><li>â€¦</li></ul><p>é‚£ä¹ˆè¿™ä¹ˆäº›æˆ‘ä»¬å¦‚ä½•å–èˆå‘¢ï¼Ÿæ‰‹å¿ƒæ‰‹èƒŒéƒ½æ˜¯è‚‰å•Šã€‚</p><p>è¿™é‡Œéœ€è¦åšä¸€ä¸‹è¯´æ˜ï¼Œæˆ‘ä»¬æ‰€åšçš„æ¡†æ¶æ— éœ€è€ƒè™‘å¤ªå¤šçš„åŠŸèƒ½ï¼Œæ˜¯åšä¸€ä¸ªç®€å•å¯ç”¨çš„APIæ¥å£æ¡†æ¶ï¼Œæˆ‘ä»¬æ¥å—get/postè¯·æ±‚ï¼Œè¿”å›jsonæ•°æ®ï¼Œå¹¶ä¸”è·¯ç”±å¥½ç”¨ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åˆè¡·ï¼Œå…¶ä»–çš„æš‚ä¸”å°±â€œæ–­èˆç¦»â€å§ã€‚</p><p>æˆ‘ä»¬å…ˆç”»ä¸€ä¸ªæç®€çš„æµç¨‹å›¾ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/202002/18/41489/I8ta10A3ob.png!large" alt="ç®€å•æµç¨‹å›¾"></p><p>æˆ‘ä»¬ä¸€åˆ‡ä»ç®€ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š</p><ul><li>è·¯ç”±</li><li>æ§åˆ¶å™¨</li><li>è¯·æ±‚</li><li>æ•°æ®å“åº”</li><li>é…ç½®</li><li>å¼‚å¸¸å¤„ç†</li><li>â€¦</li></ul><p>åŸºäºè¿™äº›ï¼Œæˆ‘ä»¬æ–°å»ºç›®å½•ï¼Œappå’Œlibraryï¼Œpublic</p><ul><li>app webåº”ç”¨</li><li>library æ ¸å¿ƒä»£ç </li><li>public å…¥å£ç›®å½•</li></ul><p>å‡ºäºç®€å•å®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬çš„å…¥å£å•ç‹¬æ”¾åœ¨publicç›®å½•ï¼Œå¹¶åœ¨ç›®å½•ä¸‹æ–°å»ºindex.phpä½œä¸ºæˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ã€‚</p><p>libraryä¸‹é¢æ–°å»ºå‡ ä¸ªç›®å½•å’Œæ–‡ä»¶</p><ul><li>Components å¸¸ç”¨ç»„ä»¶</li><li>Exceptions å¼‚å¸¸æ¨¡å—</li><li>Https httpåº”ç”¨æ¨¡å—</li><li>Sessions sessionæ¨¡å—</li><li>Application.php åº”ç”¨æ–‡ä»¶</li><li>Config.php é…ç½®æ–‡ä»¶</li><li>Functions.php å¸¸ç”¨å‡½æ•°</li><li>System.php æ¡†æ¶è‡ªå®šä¹‰å¸¸é‡</li></ul><p><img src="https://cdn.learnku.com/uploads/images/202002/18/41489/QE8AHxxoup.png!large" alt="image"></p><p>å¯¹åº”çš„æˆ‘ä»¬åœ¨composer.jsonä¸­åŠ å…¥ä¸€äº›autoloadé…ç½®ï¼Œç”¨ä»¥è‡ªåŠ¨åŠ è½½ï¼Œçœå»æˆ‘ä»¬å®ç°è‡ªåŠ¨åŠ è½½ã€‚</p><div class="code-wrapper"><pre><code class="hljs swift"><span class="hljs-string">&quot;autoload&quot;</span>: &#123;    <span class="hljs-string">&quot;psr-4&quot;</span>: &#123;        <span class="hljs-string">&quot;Library<span class="hljs-subst">\\</span>&quot;</span>: <span class="hljs-string">&quot;library/&quot;</span>,        <span class="hljs-string">&quot;App<span class="hljs-subst">\\</span>&quot;</span>: <span class="hljs-string">&quot;app/&quot;</span>    &#125;,    <span class="hljs-string">&quot;files&quot;</span>: [        <span class="hljs-string">&quot;library/Functions.php&quot;</span>    ]&#125;</code></pre></div><p>æ‰§è¡Œä¸€ä¸‹ï¼Œcomposer installæˆ–è€…composer dump-autoloadå³å¯ã€‚</p><hr><p>è¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹autoloadçš„å››ç§æ–¹å¼ï¼š</p><h4 id="autoloadçš„å››ç§æ–¹å¼"><a href="#autoloadçš„å››ç§æ–¹å¼" class="headerlink" title="autoloadçš„å››ç§æ–¹å¼"></a>autoloadçš„å››ç§æ–¹å¼</h4><ol><li>PSR-4</li></ol><p>åœ¨psr-4é”®ä¸‹ï¼Œå®šä¹‰äº†ç›¸å¯¹äºåŒ…æ ¹ç›®å½•ä»åç§°ç©ºé—´åˆ°è·¯å¾„çš„æ˜ å°„ã€‚å½“è‡ªåŠ¨åŠ è½½ä¸€ä¸ªç±»ï¼ˆå¦‚foo\bar\bazï¼‰æ—¶ï¼ŒæŒ‡å‘src/ç›®å½•çš„åç§°ç©ºé—´å‰ç¼€foo\ï¼Œæ„å‘³ç€è‡ªåŠ¨åŠ è½½ç¨‹åºå°†æŸ¥æ‰¾ä¸€ä¸ªåä¸ºsrc/bar/baz.phpçš„æ–‡ä»¶ï¼Œå¹¶åŒ…æ‹¬å®ƒï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚æ³¨æ„ï¼Œä¸æ—§çš„psr-0æ ·å¼ç›¸åï¼Œå‰ç¼€ï¼ˆfoo\ï¼‰ä¸åœ¨æ–‡ä»¶è·¯å¾„ä¸­ã€‚</p><p>å‘½åç©ºé—´å‰ç¼€å¿…é¡»ä»¥â€œ\â€ç»“å°¾ï¼Œä»¥é¿å…ç±»ä¼¼å‰ç¼€ä¹‹é—´çš„å†²çªã€‚ä¾‹å¦‚ï¼Œfooå°†åŒ¹é…foobaråç§°ç©ºé—´ä¸­çš„ç±»ï¼Œå› æ­¤åé¢çš„åæ–œæ å¯ä»¥è§£å†³é—®é¢˜ï¼šfoo\ï¼Œfoobar\ã€‚</p><p>è¯¥æ•°ç»„å¯ä»¥åœ¨ç”Ÿæˆçš„æ–‡ä»¶vendor/composer/autoload_psr4.phpä¸­æ‰¾åˆ°ã€‚</p><ol start="2"><li>PSR-0</li></ol><p>åœ¨ psr-0 key ä¸‹ä½ å®šä¹‰äº†ä¸€ä¸ªå‘½åç©ºé—´åˆ°å®é™…è·¯å¾„çš„æ˜ å°„ï¼ˆç›¸å¯¹äºåŒ…çš„æ ¹ç›®å½•ï¼‰ã€‚æ³¨æ„ï¼Œè¿™é‡ŒåŒæ ·æ”¯æŒ PEAR-style æ–¹å¼çš„çº¦å®šï¼ˆä¸å‘½åç©ºé—´ä¸åŒï¼ŒPEAR ç±»åº“åœ¨ç±»åä¸Šé‡‡ç”¨äº†ä¸‹åˆ’çº¿åˆ†éš”ï¼‰ã€‚</p><p>è¯·æ³¨æ„ï¼Œå‘½åç©ºé—´çš„ç”³æ˜åº”è¯¥ä»¥ \ ç»“æŸï¼Œä»¥ç¡®ä¿ autoloader èƒ½å¤Ÿå‡†ç¡®å“åº”ã€‚ä¾‹ï¼š Foo å°†ä¼šä¸ FooBar åŒ¹é…ï¼Œç„¶è€Œä»¥åæ–œæ ç»“æŸå°±å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œ Foo\ å’Œ FooBar\ å°†ä¼šè¢«åŒºåˆ†å¼€æ¥ã€‚</p><p>PSR-0 å¼•ç”¨éƒ½å°†è¢«ç»“åˆä¸ºä¸€ä¸ªå•ä¸€çš„é”®å€¼å¯¹æ•°ç»„ï¼Œå­˜å‚¨è‡³ vendor/composer/autoload_namespaces.php æ–‡ä»¶ä¸­ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/202002/18/41489/weRQPYwumQ.png!large" alt="image"></p><ol start="3"><li>classmap</li></ol><p>ä½ å¯ä»¥ç”¨ classmap ç”Ÿæˆæ”¯æŒæ”¯æŒè‡ªå®šä¹‰åŠ è½½çš„ä¸éµå¾ª PSR-0/4 è§„èŒƒçš„ç±»åº“ã€‚è¦é…ç½®å®ƒæŒ‡å‘éœ€è¦çš„ç›®å½•ï¼Œä»¥ä¾¿èƒ½å¤Ÿå‡†ç¡®æœç´¢åˆ°ç±»æ–‡ä»¶ã€‚</p><p>classmap å¼•ç”¨çš„æ‰€æœ‰ç»„åˆä¼šå­˜å‚¨åˆ° vendor/composer/autoload_classmap.php æ–‡ä»¶ä¸­ã€‚è¿™ä¸ª map æ˜¯ç»è¿‡æ‰«ææŒ‡å®šç›®å½•ï¼ˆåŒæ ·æ”¯æŒç›´æ¥ç²¾ç¡®åˆ°æ–‡ä»¶ï¼‰ä¸­æ‰€æœ‰çš„ .php å’Œ .inc æ–‡ä»¶é‡Œå†…ç½®çš„ç±»è€Œå¾—åˆ°çš„ã€‚</p><ol start="4"><li>files</li></ol><p>å¦‚æœä½ æƒ³è¦æ˜ç¡®çš„æŒ‡å®šï¼Œåœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½è¦è½½å…¥æŸäº›æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ â€˜filesâ€™ autoloadingã€‚é€šå¸¸ä½œä¸ºå‡½æ•°åº“çš„è½½å…¥æ–¹å¼ï¼ˆè€Œéç±»åº“ï¼‰ã€‚files å¼•ç”¨çš„æ–‡ä»¶ä¼šå­˜å‚¨åˆ° vendor/composer/autoload_files.php æ–‡ä»¶ä¸­</p><ul><li><a href="https://docs.phpcomposer.com/04-schema.html#autoload">ç‚¹å‡»æŸ¥çœ‹autoloadè¯´æ˜ä¸å®ä¾‹</a></li></ul><hr><p>æˆ‘ä»¬å…ˆä¸ç€æ€¥è¿›è¡Œæ ¸å¿ƒä»£ç ç¼–å†™ï¼Œä¸å¦¨å…ˆåšä¸€ä¸‹è¾…åŠ©å·¥ä½œï¼Œå¸¸ç”¨æ–¹æ³•ï¼Œå¼‚å¸¸å¤„ç†ç­‰ã€‚</p><h3 id="å¸¸ç”¨å‡½æ•°Functions"><a href="#å¸¸ç”¨å‡½æ•°Functions" class="headerlink" title="å¸¸ç”¨å‡½æ•°Functions"></a>å¸¸ç”¨å‡½æ•°Functions</h3><p>ç¼–å†™å¸¸ç”¨å‡½æ•°</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * å¸¸ç”¨å‡½æ•°</span><span class="hljs-comment"> */</span> <span class="hljs-keyword">if</span> (!function_exists(<span class="hljs-string">&quot;p&quot;</span>)) &#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">p</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (is_bool(<span class="hljs-variable">$var</span>)) &#123;            var_dump(<span class="hljs-variable">$var</span>);        &#125; <span class="hljs-keyword">elseif</span> (is_null(<span class="hljs-variable">$var</span>)) &#123;            var_dump(<span class="hljs-literal">null</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;meta charset=&#x27;utf-8&#x27;/&gt;</span><span class="hljs-string">&lt;pre style=&#x27;position:relative;</span><span class="hljs-string">z-index:999;</span><span class="hljs-string">padding:10px;</span><span class="hljs-string">border-radius:5px;</span><span class="hljs-string">background:#f5f5f5;</span><span class="hljs-string">border:1px solid #aaa;</span><span class="hljs-string">font-size:14px;</span><span class="hljs-string">line-height:18px;</span><span class="hljs-string">opacity:0.8;&#x27;&gt;&quot;</span>.print_r(<span class="hljs-variable">$var</span>, <span class="hljs-literal">true</span>).<span class="hljs-string">&quot;&lt;/pre&gt;&quot;</span>);        &#125;    &#125;&#125;Â·Â·Â·Â·Â·Â·</code></pre></div><hr><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>åœ¨Exceptionsç›®å½•ä¸‹ï¼Œå®šä¹‰ä¸€ä¸ªæœ€åŸºç¡€çš„å¼‚å¸¸SaiExceptionï¼š</p><div class="code-wrapper"><pre><code class="hljs zephir">&lt;?php<span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Exceptions</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SaiException</span> <span class="hljs-keyword">extends</span> \<span class="hljs-title">Exception</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">const</span> CODE_MAPPING = [        <span class="hljs-number">100</span> =&gt; <span class="hljs-string">&#x27;Continue&#x27;</span>,        <span class="hljs-number">101</span> =&gt; <span class="hljs-string">&#x27;Switching Protocols&#x27;</span>,        <span class="hljs-number">102</span> =&gt; <span class="hljs-string">&#x27;Processing&#x27;</span>,        <span class="hljs-number">200</span> =&gt; <span class="hljs-string">&#x27;OK&#x27;</span>,        <span class="hljs-number">201</span> =&gt; <span class="hljs-string">&#x27;Created&#x27;</span>,        <span class="hljs-number">202</span> =&gt; <span class="hljs-string">&#x27;Accepted&#x27;</span>,        <span class="hljs-number">203</span> =&gt; <span class="hljs-string">&#x27;Non-Authoritative Information&#x27;</span>,        <span class="hljs-number">204</span> =&gt; <span class="hljs-string">&#x27;No Content&#x27;</span>,        <span class="hljs-number">205</span> =&gt; <span class="hljs-string">&#x27;Reset Content&#x27;</span>,        <span class="hljs-number">206</span> =&gt; <span class="hljs-string">&#x27;Partial Content&#x27;</span>,        <span class="hljs-number">207</span> =&gt; <span class="hljs-string">&#x27;Multi-Status&#x27;</span>,        <span class="hljs-number">226</span> =&gt; <span class="hljs-string">&#x27;IM Used&#x27;</span>,        <span class="hljs-number">300</span> =&gt; <span class="hljs-string">&#x27;Multiple Choices&#x27;</span>,        <span class="hljs-number">301</span> =&gt; <span class="hljs-string">&#x27;Moved Permanently&#x27;</span>,        <span class="hljs-number">302</span> =&gt; <span class="hljs-string">&#x27;Found&#x27;</span>,        <span class="hljs-number">303</span> =&gt; <span class="hljs-string">&#x27;See Other&#x27;</span>,        <span class="hljs-number">304</span> =&gt; <span class="hljs-string">&#x27;Not Modified&#x27;</span>,        <span class="hljs-number">305</span> =&gt; <span class="hljs-string">&#x27;Use Proxy&#x27;</span>,        <span class="hljs-number">306</span> =&gt; <span class="hljs-string">&#x27;Reserved&#x27;</span>,        <span class="hljs-number">307</span> =&gt; <span class="hljs-string">&#x27;Temporary Redirect&#x27;</span>,        <span class="hljs-number">400</span> =&gt; <span class="hljs-string">&#x27;Bad Request&#x27;</span>,        <span class="hljs-number">401</span> =&gt; <span class="hljs-string">&#x27;Unauthorized&#x27;</span>,        <span class="hljs-number">402</span> =&gt; <span class="hljs-string">&#x27;Payment Required&#x27;</span>,        <span class="hljs-number">403</span> =&gt; <span class="hljs-string">&#x27;Forbidden&#x27;</span>,        <span class="hljs-number">404</span> =&gt; <span class="hljs-string">&#x27;Not Found&#x27;</span>,        <span class="hljs-number">405</span> =&gt; <span class="hljs-string">&#x27;Method Not Allowed&#x27;</span>,        <span class="hljs-number">406</span> =&gt; <span class="hljs-string">&#x27;Not Acceptable&#x27;</span>,        <span class="hljs-number">407</span> =&gt; <span class="hljs-string">&#x27;Proxy Authentication Required&#x27;</span>,        <span class="hljs-number">408</span> =&gt; <span class="hljs-string">&#x27;Request Timeout&#x27;</span>,        <span class="hljs-number">409</span> =&gt; <span class="hljs-string">&#x27;Conflict&#x27;</span>,        <span class="hljs-number">410</span> =&gt; <span class="hljs-string">&#x27;Gone&#x27;</span>,        <span class="hljs-number">411</span> =&gt; <span class="hljs-string">&#x27;Length Required&#x27;</span>,        <span class="hljs-number">412</span> =&gt; <span class="hljs-string">&#x27;Precondition Failed&#x27;</span>,        <span class="hljs-number">413</span> =&gt; <span class="hljs-string">&#x27;Request Entity Too Large&#x27;</span>,        <span class="hljs-number">414</span> =&gt; <span class="hljs-string">&#x27;Request-URI Too Long&#x27;</span>,        <span class="hljs-number">415</span> =&gt; <span class="hljs-string">&#x27;Unsupported Media Type&#x27;</span>,        <span class="hljs-number">416</span> =&gt; <span class="hljs-string">&#x27;Requested Range Not Satisfiable&#x27;</span>,        <span class="hljs-number">417</span> =&gt; <span class="hljs-string">&#x27;Expectation Failed&#x27;</span>,        <span class="hljs-number">422</span> =&gt; <span class="hljs-string">&#x27;Unprocessable Entity&#x27;</span>,        <span class="hljs-number">423</span> =&gt; <span class="hljs-string">&#x27;Locked&#x27;</span>,        <span class="hljs-number">424</span> =&gt; <span class="hljs-string">&#x27;Failed Dependency&#x27;</span>,        <span class="hljs-number">426</span> =&gt; <span class="hljs-string">&#x27;Upgrade Required&#x27;</span>,        <span class="hljs-number">429</span> =&gt; <span class="hljs-string">&#x27;Too Many Request&#x27;</span>,        <span class="hljs-number">500</span> =&gt; <span class="hljs-string">&#x27;Internal Server Error&#x27;</span>,        <span class="hljs-number">501</span> =&gt; <span class="hljs-string">&#x27;Not Implemented&#x27;</span>,        <span class="hljs-number">502</span> =&gt; <span class="hljs-string">&#x27;Bad Gateway&#x27;</span>,        <span class="hljs-number">503</span> =&gt; <span class="hljs-string">&#x27;Service Unavailable&#x27;</span>,        <span class="hljs-number">504</span> =&gt; <span class="hljs-string">&#x27;Gateway Timeout&#x27;</span>,        <span class="hljs-number">505</span> =&gt; <span class="hljs-string">&#x27;HTTP Version Not Supported&#x27;</span>,        <span class="hljs-number">506</span> =&gt; <span class="hljs-string">&#x27;Variant Also Negotiates&#x27;</span>,        <span class="hljs-number">507</span> =&gt; <span class="hljs-string">&#x27;Insufficient Storage&#x27;</span>,        <span class="hljs-number">510</span> =&gt; <span class="hljs-string">&#x27;Not Extended&#x27;</span>,        <span class="hljs-number">1001</span> =&gt; <span class="hljs-string">&#x27;LACK PARAMS&#x27;</span>,        <span class="hljs-number">1002</span> =&gt; <span class="hljs-string">&#x27;RETRY TOO MANY&#x27;</span>,    ];    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¾“å‡ºæŒ‡å®šHTTPçŠ¶æ€ç çš„å“åº”å¤´ä¿¡æ¯</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> int $code</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> $data</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">response</span><span class="hljs-params">($code, $data)</span></span>&#123;        $code = array_key_exists($code, <span class="hljs-keyword">self</span>::CODE_MAPPING)? $code : <span class="hljs-number">500</span>;        $desc = <span class="hljs-keyword">self</span>::CODE_MAPPING[$code];        $protocol = $_SERVER[<span class="hljs-string">&#x27;SERVER_PROTOCOL&#x27;</span>];        <span class="hljs-keyword">if</span> ( <span class="hljs-string">&#x27;HTTP/1.1&#x27;</span> != $protocol &amp;&amp; <span class="hljs-string">&#x27;HTTP/1.0&#x27;</span> != $protocol )            $protocol = <span class="hljs-string">&#x27;HTTP/1.0&#x27;</span>;        $header = <span class="hljs-string">&quot;$protocol $code $desc&quot;</span>;        header($header);        p($data);    &#125;&#125;</code></pre></div><p>å‡ ä¹åé¢æ‰€æœ‰Exceptionçš„ç±»éƒ½ä¼šç»§æ‰¿è¿™ä¸ªå¼‚å¸¸ç±»ã€‚</p><hr><p>åœ¨Componentsç›®å½•ä¸‹æ–°å»ºåŸºç¡€çš„ç±»Baseï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Library</span>\<span class="hljs-title">Components</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> <span class="hljs-keyword">implements</span> \<span class="hljs-title">ArrayAccess</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$_container</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (method_exists(<span class="hljs-keyword">$this</span>, <span class="hljs-variable">$method</span> = <span class="hljs-string">&#x27;get&#x27;</span>.ucfirst(<span class="hljs-variable">$name</span>))) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;<span class="hljs-variable">$method</span>(<span class="hljs-variable">$name</span>);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (method_exists(<span class="hljs-keyword">$this</span>, <span class="hljs-variable">$method</span> = <span class="hljs-string">&#x27;set&#x27;</span>.ucfirst(<span class="hljs-variable">$name</span>))) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;<span class="hljs-variable">$method</span>(<span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>);        &#125;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">offsetSet</span>(<span class="hljs-params"><span class="hljs-variable">$offset</span>, <span class="hljs-variable">$value</span></span>) </span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$offset</span>)) &#123;            <span class="hljs-keyword">$this</span>-&gt;_container[] = <span class="hljs-variable">$value</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">$this</span>-&gt;_container[<span class="hljs-variable">$offset</span>] = <span class="hljs-variable">$value</span>;        &#125;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">offsetExists</span>(<span class="hljs-params"><span class="hljs-variable">$offset</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_container[<span class="hljs-variable">$offset</span>]);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">offsetUnset</span>(<span class="hljs-params"><span class="hljs-variable">$offset</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">unset</span>(<span class="hljs-keyword">$this</span>-&gt;_container[<span class="hljs-variable">$offset</span>]);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">offsetGet</span>(<span class="hljs-params"><span class="hljs-variable">$offset</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_container[<span class="hljs-variable">$offset</span>]) ? <span class="hljs-keyword">$this</span>-&gt;_container[<span class="hljs-variable">$offset</span>] : <span class="hljs-literal">null</span>;    &#125;&#125;</code></pre></div><p>è¿™é‡Œæœ‰ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><ol><li>ArrayAccessæ•°ç»„å¼è®¿é—®æ¥å£ï¼ˆæä¾›åƒè®¿é—®æ•°ç»„ä¸€æ ·è®¿é—®å¯¹è±¡çš„èƒ½åŠ›çš„æ¥å£ã€‚ï¼‰</li><li>é­”æœ¯æ–¹æ³•__setå’Œ__getï¼ˆåœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶__set() ä¼šè¢«è°ƒç”¨;è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶__get() ä¼šè¢«è°ƒç”¨ã€‚ï¼‰</li></ol><p>å¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå¯çœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p><ul><li><a href="https://www.php.net/manual/zh/class.arrayaccess.php">ArrayAccessæ¥å£</a></li><li><a href="https://www.php.net/manual/zh/language.oop5.magic.php">é­”æœ¯æ–¹æ³•</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºç¡€ç¯‡ï¼š3.åå°„</title>
    <link href="/2020/02/01/phpframe03/"/>
    <url>/2020/02/01/phpframe03/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><blockquote><p>åå°„ï¼Œç›´è§‚ç†è§£å°±æ˜¯æ ¹æ®åˆ°è¾¾åœ°æ‰¾åˆ°å‡ºå‘åœ°å’Œæ¥æºã€‚ åå°„æŒ‡åœ¨PHPè¿è¡ŒçŠ¶æ€ä¸­ï¼Œæ‰©å±•åˆ†æPHPç¨‹åºï¼Œå¯¼å‡ºæˆ–æå‡ºå…³äºç±»ã€æ–¹æ³•ã€å±æ€§ã€å‚æ•°ç­‰çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨é‡Šã€‚è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºåå°„APIã€‚</p></blockquote><p>ä¸å¦¨å…ˆæ¥çœ‹ä¸€ä¸ªdemoï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Author: sai</span><span class="hljs-comment"> * Date: 2019/10/21</span><span class="hljs-comment"> * Time: 10:59</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">p</span>(<span class="hljs-params"><span class="hljs-variable">$msg</span>, <span class="hljs-variable">$var</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;&lt;pre style=&#x27;position:relative;</span><span class="hljs-string">z-index:999;</span><span class="hljs-string">padding:10px;</span><span class="hljs-string">border-radius:5px;</span><span class="hljs-string">background:#f5f5f5;</span><span class="hljs-string">border:1px solid #aaa;</span><span class="hljs-string">font-size:14px;</span><span class="hljs-string">line-height:18px;</span><span class="hljs-string">opacity:0.8;&#x27;&gt;&quot;</span>.<span class="hljs-variable">$msg</span>.<span class="hljs-string">&quot;:&quot;</span>.print_r(<span class="hljs-variable">$var</span>, <span class="hljs-literal">true</span>).<span class="hljs-string">&quot;&lt;/pre&gt;&quot;</span>);&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$id</span>;    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$name</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$skills</span> = [];    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>, <span class="hljs-variable">$name</span>, <span class="hljs-variable">$skills</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;id = <span class="hljs-variable">$id</span>;        <span class="hljs-keyword">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;        <span class="hljs-keyword">$this</span>-&gt;skills = <span class="hljs-variable">$skills</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;name;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSkill</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        p(<span class="hljs-string">&#x27;skill&#x27;</span>, <span class="hljs-keyword">$this</span>-&gt;skills);    &#125;&#125;<span class="hljs-variable">$ref</span> = <span class="hljs-keyword">new</span> ReflectionClass(<span class="hljs-string">&#x27;Demo&#x27;</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$ref</span>-&gt;isInstantiable()) &#123;    p(<span class="hljs-string">&#x27;æ£€æŸ¥ç±»æ˜¯å¦å¯å®ä¾‹åŒ–isInstantiable&#x27;</span>, <span class="hljs-literal">null</span> );&#125;<span class="hljs-variable">$constructor</span> = <span class="hljs-variable">$ref</span>-&gt;getConstructor();p(<span class="hljs-string">&#x27;è·å–æ„é€ å‡½æ•°getConstructor&#x27;</span>, <span class="hljs-variable">$constructor</span>);<span class="hljs-variable">$parameters</span> = <span class="hljs-variable">$constructor</span>-&gt;getParameters();<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$parameters</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$param</span>) &#123;    p(<span class="hljs-string">&#x27;è·å–å‚æ•°getParameters&#x27;</span>, <span class="hljs-variable">$param</span>);&#125;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$ref</span>-&gt;hasProperty(<span class="hljs-string">&#x27;name&#x27;</span>)) &#123;    <span class="hljs-variable">$attr</span> = <span class="hljs-variable">$ref</span>-&gt;getProperty(<span class="hljs-string">&#x27;name&#x27;</span>);    p(<span class="hljs-string">&#x27;è·å–å±æ€§getProperty&#x27;</span>, <span class="hljs-variable">$attr</span>);&#125;<span class="hljs-variable">$attributes</span> = <span class="hljs-variable">$ref</span>-&gt;getProperties();<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$attributes</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) &#123;    p(<span class="hljs-string">&#x27;è·å–å±æ€§åˆ—è¡¨getProperties&#x27;</span>, <span class="hljs-variable">$row</span>-&gt;getName() );&#125;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$ref</span>-&gt;hasMethod(<span class="hljs-string">&#x27;getSkill&#x27;</span>)) &#123;    <span class="hljs-variable">$method</span> = <span class="hljs-variable">$ref</span>-&gt;getMethod(<span class="hljs-string">&#x27;getSkill&#x27;</span>);    p(<span class="hljs-string">&#x27;è·å–æ–¹æ³•getMethod&#x27;</span>, <span class="hljs-variable">$method</span>);&#125;<span class="hljs-variable">$methods</span> = <span class="hljs-variable">$ref</span>-&gt;getMethods();<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$methods</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) &#123;    p(<span class="hljs-string">&#x27;è·å–æ–¹æ³•åˆ—è¡¨getMethods&#x27;</span>, <span class="hljs-variable">$row</span>-&gt;getName());&#125;<span class="hljs-variable">$instance</span> = <span class="hljs-variable">$ref</span>-&gt;newInstanceArgs([<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;sai&#x27;</span>, [<span class="hljs-string">&#x27;php&#x27;</span>, <span class="hljs-string">&#x27;js&#x27;</span>]]);p(<span class="hljs-string">&#x27;newInstanceArgs&#x27;</span>, <span class="hljs-variable">$instance</span>);</code></pre></div><p>è¾“å‡ºï¼š</p><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>æ£€æŸ¥ç±»æ˜¯å¦å¯å®ä¾‹åŒ–isInstantiable:</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–æ„é€ å‡½æ•°getConstructor:ReflectionMethod Object(    [name] => __construct    [class] => Demo)</pre></div><p></pre><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–å‚æ•°getParameters:ReflectionParameter Object<br>(<br>    [name] => id<br>)<br></pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–å‚æ•°getParameters:ReflectionParameter Object<br>(<br>    [name] => name<br>)<br></pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–å‚æ•°getParameters:ReflectionParameter Object<br>(<br>    [name] => skills<br>)<br></pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–å±æ€§getProperty:ReflectionProperty Object<br>(<br>    [name] => name<br>    [class] => Demo<br>)<br></pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–å±æ€§åˆ—è¡¨getProperties:id</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–å±æ€§åˆ—è¡¨getProperties:name</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–å±æ€§åˆ—è¡¨getProperties:skills</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–æ–¹æ³•getMethod:ReflectionMethod Object<br>(<br>    [name] => getSkill<br>    [class] => Demo<br>)<br></pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–æ–¹æ³•åˆ—è¡¨getMethods:__construct</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–æ–¹æ³•åˆ—è¡¨getMethods:getName</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>è·å–æ–¹æ³•åˆ—è¡¨getMethods:getSkill</pre></div><div class="code-wrapper"><pre style='position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;'>newInstanceArgs:Demo Object<br>(<br>    [id:Demo:private] => 1<br>    [name:protected] => sai<br>    [skills] => Array<br>        (<br>            [0] => php<br>            [1] => js<br>        )</p><p>)<br></pre></div></p><p>demoé‡Œé¢å°±æœ‰ä½¿ç”¨äº†ReflectionClassç±»ï¼Œå½“ç„¶ReflectionClassç±»ä¸æ­¢äºè¿™äº›æ–¹æ³•ã€‚</p><h3 id="æ›´å¤šæ–¹æ³•"><a href="#æ›´å¤šæ–¹æ³•" class="headerlink" title="æ›´å¤šæ–¹æ³•"></a>æ›´å¤šæ–¹æ³•</h3><p>ReflectionClassç±»è¿˜æœ‰æ›´å¤šæ–¹æ³•ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ReflectionClass::__construct</td><td>åˆå§‹åŒ– ReflectionClass ç±»</td></tr><tr><td>ReflectionClass::export</td><td>å¯¼å‡ºä¸€ä¸ªç±»</td></tr><tr><td>ReflectionClass::getConstant</td><td>è·å–å®šä¹‰è¿‡çš„ä¸€ä¸ªå¸¸é‡</td></tr><tr><td>ReflectionClass::getConstants</td><td>è·å–ä¸€ç»„å¸¸é‡</td></tr><tr><td>ReflectionClass::getConstructor</td><td>è·å–ç±»çš„æ„é€ å‡½æ•°</td></tr><tr><td>ReflectionClass::getDefaultProperties</td><td>è·å–é»˜è®¤å±æ€§</td></tr><tr><td>ReflectionClass::getDocComment</td><td>è·å–æ–‡æ¡£æ³¨é‡Š</td></tr><tr><td>ReflectionClass::getEndLine</td><td>è·å–æœ€åä¸€è¡Œçš„è¡Œæ•°</td></tr><tr><td>ReflectionClass::getExtension</td><td>æ ¹æ®å·²å®šä¹‰çš„ç±»è·å–æ‰€åœ¨æ‰©å±•çš„ ReflectionExtension å¯¹è±¡</td></tr><tr><td>ReflectionClass::getExtensionName</td><td>è·å–å®šä¹‰çš„ç±»æ‰€åœ¨çš„æ‰©å±•çš„åç§°</td></tr><tr><td>ReflectionClass::getFileName</td><td>è·å–å®šä¹‰ç±»çš„æ–‡ä»¶å</td></tr><tr><td>ReflectionClass::getInterfaceNames</td><td>è·å–æ¥å£ï¼ˆinterfaceï¼‰åç§°</td></tr><tr><td>ReflectionClass::getInterfaces</td><td>è·å–æ¥å£</td></tr><tr><td>ReflectionClass::getMethod</td><td>è·å–ä¸€ä¸ªç±»æ–¹æ³•çš„ ReflectionMethodã€‚</td></tr><tr><td>ReflectionClass::getMethods</td><td>è·å–æ–¹æ³•çš„æ•°ç»„</td></tr><tr><td>ReflectionClass::getModifiers</td><td>è·å–ç±»çš„ä¿®é¥°ç¬¦</td></tr><tr><td>ReflectionClass::getName</td><td>è·å–ç±»å</td></tr><tr><td>ReflectionClass::getNamespaceName</td><td>è·å–å‘½åç©ºé—´çš„åç§°</td></tr><tr><td>ReflectionClass::getParentClass</td><td>è·å–çˆ¶ç±»</td></tr><tr><td>ReflectionClass::getProperties</td><td>è·å–ä¸€ç»„å±æ€§</td></tr><tr><td>ReflectionClass::getProperty</td><td>è·å–ç±»çš„ä¸€ä¸ªå±æ€§çš„ ReflectionProperty</td></tr><tr><td>ReflectionClass::getReflectionConstant</td><td>Gets a ReflectionClassConstant for a classâ€™s constant</td></tr><tr><td>ReflectionClass::getReflectionConstants</td><td>Gets class constants</td></tr><tr><td>ReflectionClass::getShortName</td><td>è·å–çŸ­å</td></tr><tr><td>ReflectionClass::getStartLine</td><td>è·å–èµ·å§‹è¡Œå·</td></tr><tr><td>ReflectionClass::getStaticProperties</td><td>è·å–é™æ€ï¼ˆstaticï¼‰å±æ€§</td></tr><tr><td>ReflectionClass::getStaticPropertyValue</td><td>è·å–é™æ€ï¼ˆstaticï¼‰å±æ€§çš„å€¼</td></tr><tr><td>ReflectionClass::getTraitAliases</td><td>è¿”å› trait åˆ«åçš„ä¸€ä¸ªæ•°ç»„</td></tr><tr><td>ReflectionClass::getTraitNames</td><td>è¿”å›è¿™ä¸ªç±»æ‰€ä½¿ç”¨ traits çš„åç§°çš„æ•°ç»„</td></tr><tr><td>ReflectionClass::getTraits</td><td>è¿”å›è¿™ä¸ªç±»æ‰€ä½¿ç”¨çš„ traits æ•°ç»„</td></tr><tr><td>ReflectionClass::hasConstant</td><td>æ£€æŸ¥å¸¸é‡æ˜¯å¦å·²ç»å®šä¹‰</td></tr><tr><td>ReflectionClass::hasMethod</td><td>æ£€æŸ¥æ–¹æ³•æ˜¯å¦å·²å®šä¹‰</td></tr><tr><td>ReflectionClass::hasProperty</td><td>æ£€æŸ¥å±æ€§æ˜¯å¦å·²å®šä¹‰</td></tr><tr><td>ReflectionClass::implementsInterface</td><td>æ¥å£çš„å®ç°</td></tr><tr><td>ReflectionClass::inNamespace</td><td>æ£€æŸ¥æ˜¯å¦ä½äºå‘½åç©ºé—´ä¸­</td></tr><tr><td>ReflectionClass::isAbstract</td><td>æ£€æŸ¥ç±»æ˜¯å¦æ˜¯æŠ½è±¡ç±»ï¼ˆabstractï¼‰</td></tr><tr><td>ReflectionClass::isAnonymous</td><td>æ£€æŸ¥ç±»æ˜¯å¦æ˜¯åŒ¿åç±»</td></tr><tr><td>ReflectionClass::isCloneable</td><td>è¿”å›äº†ä¸€ä¸ªç±»æ˜¯å¦å¯å¤åˆ¶</td></tr><tr><td>ReflectionClass::isFinal</td><td>æ£€æŸ¥ç±»æ˜¯å¦å£°æ˜ä¸º final</td></tr><tr><td>ReflectionClass::isInstance</td><td>æ£€æŸ¥ç±»çš„å®ä¾‹</td></tr><tr><td>ReflectionClass::isInstantiable</td><td>æ£€æŸ¥ç±»æ˜¯å¦å¯å®ä¾‹åŒ–</td></tr><tr><td>ReflectionClass::isInterface</td><td>æ£€æŸ¥ç±»æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆinterfaceï¼‰</td></tr><tr><td>ReflectionClass::isInternal</td><td>æ£€æŸ¥ç±»æ˜¯å¦ç”±æ‰©å±•æˆ–æ ¸å¿ƒåœ¨å†…éƒ¨å®šä¹‰</td></tr><tr><td>ReflectionClass::isIterable</td><td>Check whether this class is iterable</td></tr><tr><td>ReflectionClass::isIterateable</td><td>æ£€æŸ¥æ˜¯å¦å¯è¿­ä»£ï¼ˆiterateableï¼‰</td></tr><tr><td>ReflectionClass::isSubclassOf</td><td>æ£€æŸ¥æ˜¯å¦ä¸ºä¸€ä¸ªå­ç±»</td></tr><tr><td>ReflectionClass::isTrait</td><td>è¿”å›äº†æ˜¯å¦ä¸ºä¸€ä¸ª trait</td></tr><tr><td>ReflectionClass::isUserDefined</td><td>æ£€æŸ¥æ˜¯å¦ç”±ç”¨æˆ·å®šä¹‰çš„</td></tr><tr><td>ReflectionClass::newInstance</td><td>ä»æŒ‡å®šçš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹</td></tr><tr><td>ReflectionClass::newInstanceArgs</td><td>ä»ç»™å‡ºçš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹ã€‚</td></tr><tr><td>ReflectionClass::newInstanceWithoutConstructor</td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹è€Œä¸è°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°</td></tr><tr><td>ReflectionClass::setStaticPropertyValue</td><td>è®¾ç½®é™æ€å±æ€§çš„å€¼</td></tr><tr><td>ReflectionClass::__toString</td><td>è¿”å› ReflectionClass å¯¹è±¡å­—ç¬¦ä¸²çš„è¡¨ç¤ºå½¢å¼ã€‚</td></tr></tbody></table><p>é™¤å»å¼ºå¤§çš„ReflectionClassï¼Œè¿˜æœ‰Reflectionã€ReflectionClassConstant ã€ReflectionMethod ã€ReflectionFunctionAbstractç­‰ç­‰ã€‚å»ºè®®æŸ¥çœ‹æ‰‹å†Œï¼š</p><ul><li><a href="https://www.php.net/manual/zh/book.reflection.php">PHPåå°„</a></li></ul><h3 id="åå°„çš„å®é™…åº”ç”¨"><a href="#åå°„çš„å®é™…åº”ç”¨" class="headerlink" title="åå°„çš„å®é™…åº”ç”¨"></a>åå°„çš„å®é™…åº”ç”¨</h3><ol><li>åå°„å¯ä»¥ç”¨äºæ–‡æ¡£ã€æ–‡ä»¶ç”Ÿæˆã€‚å¯ä»¥ç”¨å®ƒå¯¹æ–‡ä»¶é‡Œçš„ç±»è¿›è¡Œæ‰«æï¼Œé€ä¸ªç”Ÿæˆæè¿°æ–‡æ¡£;</li><li>æ—¢ç„¶åå°„å¯ä»¥æ¢çŸ¥ç±»çš„å†…éƒ¨ç»“æ„ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å®ƒåšhookå®ç°æ’ä»¶åŠŸèƒ½ï¼›</li><li>å¯ä»¥ç”¨äºåšåŠ¨æ€ä»£ç†ï¼Œåœ¨æœªçŸ¥æˆ–è€…ä¸ç¡®å®šç±»åçš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€ç”Ÿæˆå’Œå®ä¾‹åŒ–ä¸€äº›ç±»å’Œæ‰§è¡Œæ–¹æ³•ï¼›</li><li>ä¾èµ–æ³¨å…¥ã€‚å¯¹äºå¤šæ¬¡ç»§æ‰¿çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šæ¬¡åå°„æ¢ç´¢åˆ°åŸºç±»çš„ç»“æ„ï¼Œæˆ–è€…é‡‡ç”¨é€’å½’çš„å½¢å¼åå°„ï¼Œå®ç°å®ä¾‹åŒ–æ‰€æœ‰ç»§æ‰¿ç±»ï¼Œè¿™ä¹Ÿæ˜¯PHPä¾èµ–æ³¨å…¥çš„åŸç†ã€‚</li></ol><h3 id="åå°„çš„ä¼˜ç‚¹"><a href="#åå°„çš„ä¼˜ç‚¹" class="headerlink" title="åå°„çš„ä¼˜ç‚¹"></a>åå°„çš„ä¼˜ç‚¹</h3><ol><li>æ”¯æŒåå°„çš„è¯­è¨€æä¾›äº†ä¸€äº›åœ¨ä½çº§è¯­è¨€ä¸­éš¾ä»¥å®ç°çš„è¿è¡Œæ—¶ç‰¹æ€§ã€‚</li><li>å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…ç¡¬ç¼–ç ï¼Œæä¾›çµæ´»æ€§å’Œé€šç”¨æ€§ã€‚</li><li>å¯ä»¥ä½œä¸ºä¸€ä¸ªç¬¬ä¸€ç±»å¯¹è±¡å‘ç°å¹¶ä¿®æ”¹æºä»£ç çš„ç»“æ„ï¼ˆå¦‚ä»£ç å—ã€ç±»ã€æ–¹æ³•ã€åè®®ç­‰ï¼‰ã€‚</li><li>å¯ä»¥åœ¨è¿è¡Œæ—¶åƒå¯¹å¾…æºä»£ç è¯­å¥ä¸€æ ·è®¡ç®—ç¬¦å·è¯­æ³•çš„å­—ç¬¦ä¸²ï¼ˆç±»ä¼¼JavaScriptçš„eval()å‡½æ•°ï¼‰ï¼Œè¿›è€Œå¯å°†è·Ÿclassæˆ–functionåŒ¹é…çš„å­—ç¬¦ä¸²è½¬æ¢æˆclassæˆ–functionçš„è°ƒç”¨æˆ–å¼•ç”¨ã€‚</li><li>å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¯­è¨€å­—èŠ‚ç è§£é‡Šå™¨æ¥ç»™ç¼–ç¨‹ç»“æ„ä¸€ä¸ªæ–°çš„æ„ä¹‰æˆ–ç”¨é€”ã€‚</li></ol><h3 id="åå°„çš„ç¼ºç‚¹"><a href="#åå°„çš„ç¼ºç‚¹" class="headerlink" title="åå°„çš„ç¼ºç‚¹"></a>åå°„çš„ç¼ºç‚¹</h3><ol><li>å­¦ä¹ æˆæœ¬é«˜ã€‚é¢å‘åå°„çš„ç¼–ç¨‹éœ€è¦è¾ƒå¤šçš„é«˜çº§çŸ¥è¯†ï¼ŒåŒ…æ‹¬æ¡†æ¶ã€å…³ç³»æ˜ å°„å’Œå¯¹è±¡äº¤äº’ï¼Œä»¥åˆ©ç”¨æ›´é€šç”¨çš„ä»£ç æ‰§è¡Œ</li><li>åŒæ ·å› ä¸ºåå°„çš„æ¦‚å¿µå’Œè¯­æ³•éƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œè¿‡å¤šåœ°æ»¥ç”¨åå°„æŠ€æœ¯ä¼šä½¿å¾—ä»£ç éš¾ä»¥è¢«å…¶ä»–äººè¯»æ‡‚ï¼Œä¸åˆ©äºåˆä½œä¸äº¤æµ</li><li>åå°„åœ¨æé«˜äº†ä»£ç çµæ´»æ€§çš„åŒæ—¶ï¼Œç‰ºç‰²äº†ä¸€ç‚¹ç‚¹è¿è¡Œæ•ˆç‡ï¼Œæœ‰ä¸€å®šçš„æ¶ˆè€—</li><li>åå°„ä¹Ÿä¼šç ´åç±»çš„å°è£…æ€§ï¼ŒæŠŠæœ¬ä¸è¯¥æš´éœ²çš„æ–¹æ³•æˆ–å±æ€§æš´éœ²äº†å‡ºæ¥</li></ol><p>åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°åå°„å…¶å®ä¸å¤šï¼Œä¸ºä»€ä¹ˆæŠŠå®ƒæ‹¿åˆ°è¿™é‡Œæ¥è¯´å‘¢ï¼Ÿä¸€æ¥æ˜¯æˆ‘ä»¬åé¢ä¼šä½¿ç”¨åˆ°åå°„å»å®ç°Iocå®¹å™¨ï¼ŒäºŒæ¥åå°„ä¹Ÿæ˜¯PHPæ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œåœ¨æˆ‘ä»¬æµè¡Œçš„æ¡†æ¶ä¸­ååˆ†å¸¸è§ï¼Œç†è§£å®ƒæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºç¡€ç¯‡ï¼š2.composer</title>
    <link href="/2020/02/01/phpframe02/"/>
    <url>/2020/02/01/phpframe02/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><hr><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†æˆ‘ä»¬éœ€è¦éµå¾ªçš„è§„èŒƒï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬çš„é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·â€”â€”Composerã€‚</p><blockquote><p>Composer æ˜¯ PHP çš„ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·ã€‚å®ƒå…è®¸ä½ ç”³æ˜é¡¹ç›®æ‰€ä¾èµ–çš„ä»£ç åº“ï¼Œå®ƒä¼šåœ¨ä½ çš„é¡¹ç›®ä¸­ä¸ºä½ å®‰è£…ä»–ä»¬ã€‚</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/202002/18/41489/DV0PWOB3Vo.png!large" alt="image"></p><p>å¦‚æœä½ æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä½ åº”è¯¥ç”¨è¿‡npmï¼›å¦‚æœä½ æ˜¯pyhtonå¼€å‘è€…ï¼Œä½ åº”è¯¥ç”¨è¿‡pipï¼Œç®€å•è¯´ä½ å¯ä»¥è¿™æ ·ç†è§£composerã€‚</p><p>composeråœ¨å°å†Œä¸­å¯èƒ½ç»å¸¸ä¼šè¢«æåŠï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹å®‰è£…å’Œå¸¸ç”¨å‘½ä»¤ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ol><li>Linux</li></ol><p>composerçš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œä¸å»ºè®®ä½¿ç”¨yumç­‰ç®¡ç†åŒ…ç›´æ¥installï¼Œå› ä¸ºæœ‰å¯èƒ½ä¼šä¿®æ”¹ä½ çš„é»˜è®¤phpç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥è·³è¿‡ä»¥ä¸‹æ–¹å¼å®‰è£…ï¼š</p><blockquote><p>curl -sS <a href="https://getcomposer.org/installer">https://getcomposer.org/installer</a> | php</p></blockquote><blockquote><p>mv composer.phar /usr/local/bin/composer</p></blockquote><ol start="2"><li>Windows</li></ol><p>ä¸‹è½½å¹¶ä¸”è¿è¡Œ Composer-Setup.exeï¼Œå®ƒå°†å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Composer ï¼Œå»ºè®®åŠ å…¥ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹ç›´æ¥ä½¿ç”¨ composer å‘½ä»¤ã€‚</p><h3 id="ä¿®æ”¹é•œåƒæº"><a href="#ä¿®æ”¹é•œåƒæº" class="headerlink" title="ä¿®æ”¹é•œåƒæº"></a>ä¿®æ”¹é•œåƒæº</h3><p>é»˜è®¤é•œåƒæºå›½å†…ä¸‹è½½æ¯”è¾ƒæ…¢ï¼Œå»ºè®®æ›´æ¢é•œåƒæº</p><blockquote><p>composer config -g repo.packagist composer <a href="https://packagist.phpcomposer.com/">https://packagist.phpcomposer.com</a></p></blockquote><p>ä¹Ÿå¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„é•œåƒæº(æ¨è)</p><blockquote><p>composer config -g repo.packagist composer <a href="https://mirrors.aliyun.com/composer/">https://mirrors.aliyun.com/composer/</a></p></blockquote><blockquote><p>config -g/â€“global è¡¨ç¤ºå…¨å±€é…ç½®</p></blockquote><h3 id="composerå¸¸ç”¨å‘½ä»¤"><a href="#composerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="composerå¸¸ç”¨å‘½ä»¤"></a>composerå¸¸ç”¨å‘½ä»¤</h3><h4 id="initåˆå§‹åŒ–"><a href="#initåˆå§‹åŒ–" class="headerlink" title="initåˆå§‹åŒ–"></a>initåˆå§‹åŒ–</h4><div class="code-wrapper"><pre><code class="hljs haml">å‚æ•°ï¼š-<span class="ruby">-<span class="hljs-symbol">name:</span> åŒ…çš„åç§°ã€‚</span><span class="ruby"></span>-<span class="ruby">-<span class="hljs-symbol">description:</span> åŒ…çš„æè¿°ã€‚</span><span class="ruby"></span>-<span class="ruby">-<span class="hljs-symbol">author:</span> åŒ…çš„ä½œè€…ã€‚</span><span class="ruby"></span>-<span class="ruby">-<span class="hljs-symbol">homepage:</span> åŒ…çš„ä¸»é¡µã€‚</span><span class="ruby"></span>-<span class="ruby">-<span class="hljs-symbol">require:</span> éœ€è¦ä¾èµ–çš„å…¶å®ƒåŒ…ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªç‰ˆæœ¬çº¦æŸã€‚å¹¶ä¸”åº”è¯¥éµå¾ª foo/<span class="hljs-symbol">bar:</span><span class="hljs-number">1.0</span>.<span class="hljs-number">0</span> è¿™æ ·çš„æ ¼å¼ã€‚</span><span class="ruby"></span>-<span class="ruby">-<span class="hljs-keyword">require</span>-<span class="hljs-symbol">dev:</span> å¼€å‘ç‰ˆçš„ä¾èµ–åŒ…ï¼Œå†…å®¹æ ¼å¼ä¸ --<span class="hljs-keyword">require</span> ç›¸åŒã€‚</span><span class="ruby"></span>-<span class="ruby">-stability (-s): minimum-stability å­—æ®µçš„å€¼ã€‚</span></code></pre></div><h3 id="requireå¢åŠ "><a href="#requireå¢åŠ " class="headerlink" title="requireå¢åŠ "></a>requireå¢åŠ </h3><p>require å‘½ä»¤å¢åŠ æ–°çš„ä¾èµ–åŒ…åˆ°å½“å‰ç›®å½•çš„ composer.json æ–‡ä»¶ä¸­ï¼Œå¹¶å¯ä»¥æŒ‡å®šç‰ˆæœ¬ã€‚</p><blockquote><p>composer require vendor/package:2.* vendor/package2:dev-master</p></blockquote><h4 id="installå®‰è£…"><a href="#installå®‰è£…" class="headerlink" title="installå®‰è£…"></a>installå®‰è£…</h4><p>install å‘½ä»¤ä»å½“å‰ç›®å½•è¯»å– composer.json æ–‡ä»¶ï¼Œå¤„ç†äº†ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠå…¶å®‰è£…åˆ° vendor ç›®å½•ä¸‹ã€‚</p><p>å¦‚æœå½“å‰ç›®å½•ä¸‹å­˜åœ¨ composer.lock æ–‡ä»¶ï¼Œå®ƒä¼šä»æ­¤æ–‡ä»¶è¯»å–ä¾èµ–ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æ ¹æ® composer.json æ–‡ä»¶å»è·å–ä¾èµ–ã€‚è¿™ç¡®ä¿äº†è¯¥åº“çš„æ¯ä¸ªä½¿ç”¨è€…éƒ½èƒ½å¾—åˆ°ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ã€‚</p><p>å¦‚æœæ²¡æœ‰ composer.lock æ–‡ä»¶ï¼Œcomposer å°†åœ¨å¤„ç†å®Œä¾èµ–å…³ç³»ååˆ›å»ºå®ƒã€‚</p><p>ä½ å¯ä»¥ç®€å•æŠŠcomposer.lockç†è§£ä¸ºæ‰©å±•åº“çš„ç¼“å­˜ã€‚</p><h4 id="updateæ›´æ–°"><a href="#updateæ›´æ–°" class="headerlink" title="updateæ›´æ–°"></a>updateæ›´æ–°</h4><p>ä¸ºäº†è·å–ä¾èµ–çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ›´æ–° composer.lock æ–‡ä»¶ï¼Œä½ åº”è¯¥ä½¿ç”¨ update å‘½ä»¤ã€‚</p><blockquote><p>composer update</p></blockquote><p>è¿™å°†è§£å†³é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼Œå¹¶å°†ç¡®åˆ‡çš„ç‰ˆæœ¬å·å†™å…¥ composer.lockã€‚</p><p>å¦‚æœä½ åªæ˜¯æƒ³æ›´æ–°å‡ ä¸ªåŒ…ï¼Œä½ å¯ä»¥åƒè¿™æ ·åˆ†åˆ«åˆ—å‡ºå®ƒä»¬ï¼š</p><blockquote><p>composer update vendor/package vendor/package2</p></blockquote><p>==æ³¨æ„==ï¼šupdateå‘½ä»¤ä¼šæ›´æ–°composer.jsoné‡Œé™å®šç‰ˆæœ¬çš„æœ€æ–°ä¾èµ–ã€‚<br>æ¯”å¦‚ä½ å†™çš„æ˜¯â€monolog/monologâ€: â€œ1.*â€,updateå‘½ä»¤å¯èƒ½ä¼šæŠŠ1.0æ›´æ–°ä¸º1.2ç‰ˆæœ¬ï¼Œä½†ä¸ä¼šå°†1.0æ›´æ–°ä¸º2.0ã€‚æ‰€ä»¥ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ã€‚</p><h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><p>search å‘½ä»¤å…è®¸ä½ ä¸ºå½“å‰é¡¹ç›®æœç´¢ä¾èµ–åŒ…ï¼Œé€šå¸¸å®ƒåªæœç´¢ packagist.org ä¸Šçš„åŒ…ï¼Œä½ å¯ä»¥ç®€å•çš„è¾“å…¥ä½ çš„æœç´¢æ¡ä»¶ã€‚</p><h3 id="show"><a href="#show" class="headerlink" title="show"></a>show</h3><p>åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„è½¯ä»¶åŒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨ show å‘½ä»¤ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/202002/18/41489/0I2UwFU0bz.png!large" alt="composer-show"></p><p><a href="https://packagist.org/">ä¹Ÿå¯ä»¥ç‚¹å‡»æŸ¥çœ‹æ›´å¤šcomposeråŒ…</a></p><h3 id="dump-autoload"><a href="#dump-autoload" class="headerlink" title="dump-autoload"></a>dump-autoload</h3><p>æ‰“å°è‡ªåŠ¨åŠ è½½ç´¢å¼•ï¼ŒæŸäº›æƒ…å†µä¸‹ä½ éœ€è¦æ›´æ–° autoloaderï¼Œä¾‹å¦‚åœ¨ä½ çš„åŒ…ä¸­åŠ å…¥äº†ä¸€ä¸ªæ–°çš„ç±»ã€‚ä½ å¯ä»¥ä½¿ç”¨ dump-autoload æ¥å®Œæˆï¼Œè€Œä¸å¿…æ‰§è¡Œ install æˆ– update å‘½ä»¤ã€‚</p><p>æ­¤å¤–ï¼Œå®ƒå¯ä»¥æ‰“å°ä¸€ä¸ªä¼˜åŒ–è¿‡çš„ï¼Œç¬¦åˆ PSR-0/4 è§„èŒƒçš„ç±»çš„ç´¢å¼•ï¼Œè¿™ä¹Ÿæ˜¯å‡ºäºå¯¹æ€§èƒ½çš„å¯è€ƒè™‘ã€‚åœ¨å¤§å‹çš„åº”ç”¨ä¸­ä¼šæœ‰è®¸å¤šç±»æ–‡ä»¶ï¼Œè€Œ autoloader ä¼šå ç”¨æ¯ä¸ªè¯·æ±‚çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´ï¼Œä½¿ç”¨ classmaps æˆ–è®¸åœ¨å¼€å‘æ—¶ä¸å¤ªæ–¹ä¾¿ï¼Œä½†å®ƒåœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹ï¼Œä»ç„¶å¯ä»¥è·å¾— PSR-0/4 è§„èŒƒå¸¦æ¥çš„ä¾¿åˆ©ã€‚</p><p><a href="https://docs.phpcomposer.com/03-cli.html#Command-line-interface/">æ›´composerå¤šå‘½ä»¤è¯·ç‚¹å‡»æŸ¥çœ‹</a></p><hr><p>å¥½äº†ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†composerçš„å®‰è£…å’Œå¸¸ç”¨å‘½ä»¤ã€‚æˆ‘ä»¬åé¢å¯ä»¥å°†æ¡†æ¶é›†æˆåˆ°ä¸€ä¸ªcomposeråŒ…ï¼Œåˆ†äº«ç»™å…¶ä»–å¼€å‘åŒå­¦ä½¿ç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºç¡€ç¯‡ï¼š1.PSR</title>
    <link href="/2020/02/01/phpframe01/"/>
    <url>/2020/02/01/phpframe01/</url>
    
    <content type="html"><![CDATA[<p>PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶</p><h3 id="åˆ›ä½œåˆè¡·"><a href="#åˆ›ä½œåˆè¡·" class="headerlink" title="åˆ›ä½œåˆè¡·"></a>åˆ›ä½œåˆè¡·</h3><ul><li>æœ‰æ²¡æœ‰ç”¨çƒ¦äº†CURDï¼Ÿ</li><li>å„ç§æ¡†æ¶æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤´å¤§ï¼Ÿ</li><li>æœ‰æ²¡æœ‰å°è¯•è‡ªå·±è®¾è®¡ä¸€ä¸ªæ¡†æ¶ï¼Ÿ</li><li>å­¦äº†PHPè¯­æ³•ï¼Œæ²¡æœ‰é¡¹ç›®å»å®æˆ˜ï¼Œå¤¯å®åŸºç¡€</li></ul><p>å¸Œæœ›èƒ½å¸®åŠ©èƒ½è®©ä½ å¿«é€Ÿåœ°æ­å»ºä¸€ä¸ªè‡ªå·±çš„æ¡†æ¶ï¼Œèƒ½ç»™ä½ çš„å·¥ä½œæˆ–è€…å­¦ä¹ ä¸­å¸¦æ¥ä¸€å®šçš„å¸®åŠ©ä¸å¯å‘ã€‚</p><h3 id="ä½ èƒ½å­¦åˆ°ä»€ä¹ˆ"><a href="#ä½ èƒ½å­¦åˆ°ä»€ä¹ˆ" class="headerlink" title="ä½ èƒ½å­¦åˆ°ä»€ä¹ˆ"></a>ä½ èƒ½å­¦åˆ°ä»€ä¹ˆ</h3><ol><li>PSRè§„èŒƒ</li><li>composerçš„ä½¿ç”¨</li><li>å¿«é€Ÿæ­å»ºä¸€ä¸ªAPIæ¥å£æ¡†æ¶</li><li>Rediså„ç§æ•°æ®ç±»å‹çš„åº”ç”¨</li><li>ç¼“å­˜åº”ç”¨åˆ†æ</li></ol><hr><p>åœ¨å¼€å‘æ¡†æ¶ä¹‹å‰ï¼Œæˆ‘æ¥ä»‹ç»æ¡†æ¶å¼€å‘éµå¾ªçš„è§„èŒƒã€‚</p><p>å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è‡ªå·±çš„ä¸€å¥—ç¼–ç è§„èŒƒï¼Œä½œä¸ºâ€œä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€â€ï¼ŒPHPå½“ç„¶ä¹Ÿæœ‰è‡ªå·±çš„ç¼–ç è§„èŒƒã€‚è¿™ä¸ªè§„èŒƒå°±æ˜¯PHP Standard Recommendationï¼ˆç®€ç§°PSRï¼‰ã€‚</p><p>å½“ç„¶ï¼Œä»æˆ‘è‡ªå·±çš„å·¥ä½œä¸­ï¼Œæˆ‘å‘ç°å¾ˆå¤šPHPç¨‹åºå‘˜å°¤å…¶æ˜¯åˆçº§ç¨‹åºå‘˜ï¼Œæ˜¯ä¸çŸ¥é“PHPæ˜¯æœ‰è¿™ä¹ˆä¸€ä¸ªè§„èŒƒçš„ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ç§‘å­¦çš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯PSRï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯PSRï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯PSRï¼Ÿ"></a>ä»€ä¹ˆæ˜¯PSRï¼Ÿ</h3><p>ä»‹ç»PSRä¹‹å‰éœ€è¦ä»‹ç»ä¸€ä¸‹åˆ¶å®šæ­¤è§„èŒƒçš„ç»„ç»‡â€”â€“PHP-FIGï¼Œå…¨ç§°æ˜¯PHP Framework Interoperabilityã€‚</p><p>ç»„ç»‡æˆå‘˜åˆ¶å®šè§„èŒƒï¼Œå¹¶ä¸”è½å®åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œè™½ç„¶ä¸æ˜¯å®˜æ–¹ç»„ç»‡ï¼Œä½†ä¹Ÿä»£è¡¨äº†å¤§éƒ¨åˆ†PHPç¤¾åŒºé¡¹ç›®ï¼Œå¦‚CakePHPï¼ŒComposerï¼ŒDrupalï¼ŒPEARï¼ŒSlimï¼ŒYii frameworkï¼ŒZend Frameworkç­‰ã€‚å¹¶ä¸”æœ‰è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®åŠ å…¥å¹¶éµå¾ªæ­¤æ ‡å‡†ã€‚</p><p>PSRé¡¹ç›®çš„ç›®çš„åœ¨äºï¼šé€šè¿‡æ¡†æ¶ä½œè€…æˆ–è€…æ¡†æ¶çš„ä»£è¡¨ä¹‹é—´è®¨è®ºï¼Œä»¥æœ€ä½ç¨‹åº¦çš„é™åˆ¶ï¼Œåˆ¶å®šä¸€ä¸ªåä½œæ ‡å‡†ï¼Œå„ä¸ªæ¡†æ¶éµå¾ªç»Ÿä¸€çš„ç¼–ç è§„èŒƒï¼Œè®©å·¥ç¨‹å¸ˆä¸€èµ·æ›´å¥½ååŒå·¥ä½œã€‚</p><p>æˆªæ­¢ç›®å‰ï¼Œå·²ç»å®˜ç½‘å·²æœ‰20æ¡åˆ—å‡ºï¼Œé™¤å»èµ·è‰ä¸­å’Œèˆå¼ƒçš„ï¼Œæœ‰ä»¥ä¸‹13æ¡ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/202002/18/41489/1wmtWCQ4Fv.png!large" alt="PSRs"></p><hr><p>æˆ‘ä»¬ä¸å¦¨æ¥çœ‹çœ‹è¿™äº›è§„èŒƒï¼š</p><h4 id="PSR-1-åŸºç¡€ç¼–ç è§„èŒƒ"><a href="#PSR-1-åŸºç¡€ç¼–ç è§„èŒƒ" class="headerlink" title="PSR-1 åŸºç¡€ç¼–ç è§„èŒƒ"></a>PSR-1 åŸºç¡€ç¼–ç è§„èŒƒ</h4><ul><li>PHP ä»£ç æ–‡ä»¶å¿…é¡»ä»¥ &lt;?php æˆ– &lt;?= æ ‡ç­¾å¼€å§‹</li><li>PHP ä»£ç æ–‡ä»¶å¿…é¡»ä»¥ä¸å¸¦BOMçš„UTF-8ç¼–ç </li><li>PHP ä»£ç ä¸­ åº”è¯¥ åªå®šä¹‰ç±»ã€å‡½æ•°ã€å¸¸é‡ç­‰å£°æ˜ï¼Œæˆ–å…¶ä»–ä¼šäº§ç”Ÿ å‰¯ä½œç”¨ çš„æ“ä½œï¼ˆå¦‚ï¼šç”Ÿæˆæ–‡ä»¶è¾“å‡ºä»¥åŠä¿®æ”¹ .ini é…ç½®æ–‡ä»¶ç­‰ï¼‰ï¼ŒäºŒè€…åªèƒ½é€‰å…¶ä¸€</li><li>å‘½åç©ºé—´ä»¥åŠç±»å¿…é¡»ç¬¦åˆ PSR çš„è‡ªåŠ¨åŠ è½½è§„èŒƒPSR-4</li><li>ç±»çš„å‘½åå¿…é¡»éµå¾ª StudlyCaps å¼å¤§å†™å¼€å¤´çš„é©¼å³°å‘½åè§„èŒƒ</li><li>ç±»ä¸­çš„å¸¸é‡æ‰€æœ‰å­—æ¯éƒ½å¿…é¡» å¤§å†™ï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”</li><li>æ–¹æ³•åç§°å¿…é¡»ç¬¦åˆ camelCase å¼çš„å°å†™å¼€å¤´é©¼å³°å‘½åè§„èŒƒ</li></ul><h4 id="PSR-12-ä»£ç é£æ ¼è§„èŒƒ"><a href="#PSR-12-ä»£ç é£æ ¼è§„èŒƒ" class="headerlink" title="PSR-12 ä»£ç é£æ ¼è§„èŒƒ"></a>PSR-12 ä»£ç é£æ ¼è§„èŒƒ</h4><p>PSR-12çš„è§„èŒƒå¾ˆç»†è‡´ï¼ŒåŒ…å«äº†å£°æ˜ã€å‘½åç©ºé—´ã€ç±»åŠç»§æ‰¿ä»¥åŠæ§åˆ¶ç»“æ„ç­‰è¯´æ˜ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªdemoï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);<span class="hljs-keyword">namespace</span> <span class="hljs-title">Vendor</span>\<span class="hljs-title">Package</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Vendor</span>\<span class="hljs-title">Package</span>\&#123;<span class="hljs-title">ClassA</span> <span class="hljs-title">as</span> <span class="hljs-title">A</span>, <span class="hljs-title">ClassB</span>, <span class="hljs-title">ClassC</span> <span class="hljs-title">as</span> <span class="hljs-title">C</span>&#125;;<span class="hljs-keyword">use</span> <span class="hljs-title">Vendor</span>\<span class="hljs-title">Package</span>\<span class="hljs-title">SomeNamespace</span>\<span class="hljs-title">ClassD</span> <span class="hljs-title">as</span> <span class="hljs-title">D</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">function</span> <span class="hljs-title">Vendor</span>\<span class="hljs-title">Package</span>\&#123;<span class="hljs-title">functionA</span>, <span class="hljs-title">functionB</span>, <span class="hljs-title">functionC</span>&#125;;<span class="hljs-keyword">use</span> <span class="hljs-title">const</span> <span class="hljs-title">Vendor</span>\<span class="hljs-title">Package</span>\&#123;<span class="hljs-title">ConstantA</span>, <span class="hljs-title">ConstantB</span>, <span class="hljs-title">ConstantC</span>&#125;;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FooInterface</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sampleFunction</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-variable">$a</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$b</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">array</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> === <span class="hljs-variable">$b</span>) &#123;            bar();        &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$a</span> &gt; <span class="hljs-variable">$b</span>) &#123;            <span class="hljs-variable">$foo</span>-&gt;bar(<span class="hljs-variable">$arg1</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            BazClass::bar(<span class="hljs-variable">$arg2</span>, <span class="hljs-variable">$arg3</span>);        &#125;    &#125;    <span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">// method body</span>    &#125;&#125;</code></pre></div><ul><li>ä»£ç  å¿…é¡» éµå¾ª [PSR-1] ä¸­çš„ç¼–ç è§„èŒƒ</li><li>æ‰€æœ‰PHPæ–‡ä»¶å¿…é¡»ä½¿ç”¨Unix LF (linefeed)ä½œä¸ºè¡Œçš„ç»“æŸç¬¦ï¼›</li><li>æ‰€æœ‰PHPæ–‡ä»¶å¿…é¡»ä»¥ä¸€ä¸ªç©ºç™½è¡Œä½œä¸ºç»“æŸï¼›</li><li>çº¯PHPä»£ç æ–‡ä»¶å¿…é¡»çœç•¥æœ€åçš„ ?&gt; ç»“æŸæ ‡ç­¾</li><li>æ¯è¡Œçš„å­—ç¬¦æ•° åº”è¯¥è½¯æ€§ä¿æŒåœ¨ 80 ä¸ªä¹‹å†…ï¼Œç†è®ºä¸Š ä¸€å®šä¸å¯ å¤šäº 120 ä¸ªï¼Œä½†ä¸€å®šä¸å¯æœ‰ç¡¬æ€§é™åˆ¶ï¼›éç©ºè¡Œåä¸€å®šä¸èƒ½æœ‰å¤šä½™çš„ç©ºæ ¼ç¬¦ï¼›</li><li>ç©ºè¡Œå¯ä»¥ä½¿å¾—é˜…è¯»ä»£ç æ›´åŠ æ–¹ä¾¿ä»¥åŠæœ‰åŠ©äºä»£ç çš„åˆ†å—ã€‚</li><li>æ¯è¡Œä¸€å®šä¸èƒ½å­˜åœ¨å¤šäºä¸€æ¡è¯­å¥</li><li>ä»£ç å¿…é¡»ä½¿ç”¨4ä¸ªç©ºæ ¼ç¬¦çš„ç¼©è¿›ï¼Œä¸€å®šä¸èƒ½ç”¨ tabé”®</li><li>PHPæ‰€æœ‰å…³é”®å­—å¿…é¡»å…¨éƒ¨å°å†™</li><li>æ§åˆ¶ç»“æ„çš„åŸºæœ¬è§„èŒƒå¦‚ä¸‹ï¼š<div class="code-wrapper"><pre><code class="hljs dust"><span class="xml">æ§åˆ¶ç»“æ„å…³é”®è¯åå¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚</span><span class="xml">å·¦æ‹¬å· ( åä¸€å®šä¸èƒ½æœ‰ç©ºæ ¼ã€‚</span><span class="xml">å³æ‹¬å· ) å‰ä¹Ÿä¸€å®šä¸èƒ½æœ‰ç©ºæ ¼ã€‚</span><span class="xml">å³æ‹¬å· ) ä¸å¼€å§‹èŠ±æ‹¬å· </span><span class="hljs-template-variable">&#123; é—´ä¸€å®šæœ‰ä¸€ä¸ªç©ºæ ¼ã€‚</span><span class="hljs-template-variable">ç»“æ„ä½“ä¸»ä½“ä¸€å®šè¦æœ‰ä¸€æ¬¡ç¼©è¿›ã€‚</span><span class="hljs-template-variable">ç»“æŸèŠ±æ‹¬å· &#125;</span><span class="xml"> ä¸€å®šåœ¨ç»“æ„ä½“ä¸»ä½“åå•ç‹¬æˆè¡Œã€‚</span></code></pre></div>ä»£ç é£æ ¼è§„èŒƒå†…å®¹å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€è¯´æ˜äº†ï¼Œå¤§å®¶å¯è‡ªè¡Œé˜…è¯»</li></ul><h4 id="PSR-4-è‡ªåŠ¨åŠ è½½"><a href="#PSR-4-è‡ªåŠ¨åŠ è½½" class="headerlink" title="PSR-4 è‡ªåŠ¨åŠ è½½"></a>PSR-4 è‡ªåŠ¨åŠ è½½</h4><p>å…³äºç”±æ–‡ä»¶è·¯å¾„ è‡ªåŠ¨è½½å…¥ å¯¹åº”ç±»çš„ç›¸å…³è§„èŒƒï¼Œ æœ¬è§„èŒƒæ˜¯å¯äº’æ“ä½œçš„ï¼Œå¯ä»¥ä½œä¸ºä»»ä¸€è‡ªåŠ¨è½½å…¥è§„èŒƒçš„è¡¥å……ï¼Œå…¶ä¸­åŒ…æ‹¬ PSR-0ï¼Œæ­¤å¤–ï¼Œ æœ¬ PSR è¿˜åŒ…æ‹¬è‡ªåŠ¨è½½å…¥çš„ç±»å¯¹åº”çš„æ–‡ä»¶å­˜æ”¾è·¯å¾„è§„èŒƒã€‚</p><ol><li><p>æ­¤å¤„çš„â€œç±»â€æ³›æŒ‡æ‰€æœ‰çš„classç±»ã€æ¥å£ã€traitså¯å¤ç”¨ä»£ç å—ä»¥åŠå…¶å®ƒç±»ä¼¼ç»“æ„ã€‚</p></li><li><p>ä¸€ä¸ªå®Œæ•´çš„ç±»åéœ€å…·æœ‰ä»¥ä¸‹ç»“æ„:</p><div class="code-wrapper"><pre><code class="hljs"> \&lt;å‘½åç©ºé—´&gt;(\&lt;å­å‘½åç©ºé—´&gt;)*\&lt;ç±»å&gt;</code></pre></div><ol><li><p>å®Œæ•´çš„ç±»å<strong>å¿…é¡»</strong>è¦æœ‰ä¸€ä¸ªé¡¶çº§å‘½åç©ºé—´ï¼Œè¢«ç§°ä¸º â€œvendor namespaceâ€ï¼›</p></li><li><p>å®Œæ•´çš„ç±»å<strong>å¯ä»¥</strong>æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­å‘½åç©ºé—´ï¼›</p></li><li><p>å®Œæ•´çš„ç±»å<strong>å¿…é¡»</strong>æœ‰ä¸€ä¸ªæœ€ç»ˆçš„ç±»åï¼›</p></li><li><p>å®Œæ•´çš„ç±»åä¸­ä»»æ„ä¸€éƒ¨åˆ†ä¸­çš„ä¸‹åˆ’çº¿éƒ½æ˜¯æ²¡æœ‰ç‰¹æ®Šå«ä¹‰çš„ï¼›</p></li><li><p>å®Œæ•´çš„ç±»å<strong>å¯ä»¥</strong>ç”±ä»»æ„å¤§å°å†™å­—æ¯ç»„æˆï¼›</p></li><li><p>æ‰€æœ‰ç±»åéƒ½<strong>å¿…é¡»</strong>æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</p></li></ol></li><li><p>å½“æ ¹æ®å®Œæ•´çš„ç±»åè½½å…¥ç›¸åº”çš„æ–‡ä»¶â€¦â€¦</p><ol><li><p>å®Œæ•´çš„ç±»åä¸­ï¼Œå»æ‰æœ€å‰é¢çš„å‘½åç©ºé—´åˆ†éš”ç¬¦ï¼Œå‰é¢è¿ç»­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‘½åç©ºé—´å’Œå­å‘½åç©ºé—´ï¼Œä½œä¸ºâ€œå‘½åç©ºé—´å‰ç¼€â€ï¼Œå…¶å¿…é¡»ä¸è‡³å°‘ä¸€ä¸ªâ€œæ–‡ä»¶åŸºç›®å½•â€ç›¸å¯¹åº”ï¼›</p></li><li><p>ç´§æ¥å‘½åç©ºé—´å‰ç¼€åçš„å­å‘½åç©ºé—´<strong>å¿…é¡»</strong>ä¸ç›¸åº”çš„â€æ–‡ä»¶åŸºç›®å½•â€œç›¸åŒ¹é…ï¼Œå…¶ä¸­çš„å‘½åç©ºé—´åˆ†éš”ç¬¦å°†ä½œä¸ºç›®å½•åˆ†éš”ç¬¦ã€‚</p></li><li><p>æœ«å°¾çš„ç±»å<strong>å¿…é¡»</strong>ä¸å¯¹åº”çš„ä»¥ <code>.php</code> ä¸ºåç¼€çš„æ–‡ä»¶åŒåã€‚</p></li><li><p>è‡ªåŠ¨åŠ è½½å™¨ï¼ˆautoloaderï¼‰çš„å®ç°<strong>ä¸€å®šä¸èƒ½</strong>æŠ›å‡ºå¼‚å¸¸ã€<strong>ä¸€å®šä¸èƒ½</strong>è§¦å‘ä»»ä¸€çº§åˆ«çš„é”™è¯¯ä¿¡æ¯ä»¥åŠ<strong>ä¸åº”è¯¥</strong>æœ‰è¿”å›å€¼ã€‚</p></li></ol></li></ol><h5 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h5><p>ä¸‹è¡¨å±•ç¤ºäº†ç¬¦åˆè§„èŒƒå®Œæ•´ç±»åã€å‘½åç©ºé—´å‰ç¼€å’Œæ–‡ä»¶åŸºç›®å½•æ‰€å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ã€‚</p><table><thead><tr><th>å®Œæ•´ç±»å</th><th>å‘½åç©ºé—´å‰ç¼€</th><th>æ–‡ä»¶åŸºç›®å½•</th><th>æ–‡ä»¶è·¯å¾„</th></tr></thead><tbody><tr><td>\Acme\Log\Writer\File_Writer</td><td>Acme\Log\Writer</td><td>./acme-log-writer/lib/</td><td>./acme-log-writer/lib/File_Writer.php</td></tr><tr><td>\Aura\Web\Response\Status</td><td>Aura\Web</td><td>/path/to/aura-web/src/</td><td>/path/to/aura-web/src/Response/Status.php</td></tr><tr><td>\Symfony\Core\Request</td><td>Symfony\Core</td><td>./vendor/Symfony/Core/</td><td>./vendor/Symfony/Core/Request.php</td></tr><tr><td>\Zend\Acl</td><td>Zend</td><td>/usr/includes/Zend/</td><td>/usr/includes/Zend/Acl.php</td></tr></tbody></table><p>æš‚ä¸”åªä»‹ç»è¿™æ¯”è¾ƒå¸¸ç”¨çš„ä¸‰ä¸ªè§„èŒƒã€‚</p><p><a href="https://www.php-fig.org/psr/">æ›´å¤šæœ€æ–°è§„èŒƒå»ºè®®ç‚¹å‡»æŸ¥çœ‹</a></p><hr><p>æœ¬èŠ‚ä¸»è¦ä»‹ç»äº†PHPçš„ç¼–ç è§„èŒƒPSRï¼Œå»ºè®®å¤§å®¶åœ¨å¼€å‘ä¸­å°½é‡éµå¾ªæ­¤è§„èŒƒï¼Œç‰¹åˆ«æ˜¯å›¢é˜Ÿå¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å„è‡ªæœ‰ç€å„è‡ªçš„ç¼–ç é£æ ¼ï¼Œåº”è¯¥å°½å¯èƒ½ç»Ÿä¸€é£æ ¼ã€‚æ­£å¦‚PHP-FIGç»„ç»‡çš„åˆè¡·æ‰€è¯´ï¼Œä»–ä»¬å»ºç«‹çš„è§„èŒƒä¸æ˜¯é™åˆ¶å¤§å®¶çš„ç¼–ç è‡ªç”±ï¼Œåªæ˜¯å¯»æ‰¾å…±æ€§ï¼Œä¸ºäº†æˆ‘ä»¬ä¸€èµ·æ›´å¥½çš„ååŒå·¥ä½œã€‚</p>]]></content>
    
    
    <categories>
      
      <category>phpframe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpframe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisä½¿ç”¨scanæ›¿æ¢keys</title>
    <link href="/2020/01/26/225/"/>
    <url>/2020/01/26/225/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“æŸ¥æ‰¾Redisçš„é”®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>keys pattern</code>ï¼Œä½†å½“keyå¤ªå¤šæ—¶ï¼Œkeyså‘½ä»¤çš„æ•ˆç‡å°±å¾ˆä½ï¼Œå¦‚æœåœ¨çº¿ä¸Šç›´æ¥ä½¿ç”¨ï¼Œç”šè‡³å¯èƒ½å‘ç”Ÿç”Ÿäº§äº‹æ•…ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¦¨ä½¿ç”¨scanå‘½ä»¤ã€‚</p><blockquote><p>SCAN å‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼ˆcursor based iteratorï¼‰ï¼š SCAN å‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨ä¹‹åï¼Œ éƒ½ä¼šå‘ç”¨æˆ·è¿”å›ä¸€ä¸ªæ–°çš„æ¸¸æ ‡ï¼Œ ç”¨æˆ·åœ¨ä¸‹æ¬¡è¿­ä»£æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–°æ¸¸æ ‡ä½œä¸º SCAN å‘½ä»¤çš„æ¸¸æ ‡å‚æ•°ï¼Œ ä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚å½“ SCAN å‘½ä»¤çš„æ¸¸æ ‡å‚æ•°è¢«è®¾ç½®ä¸º 0 æ—¶ï¼Œ æœåŠ¡å™¨å°†å¼€å§‹ä¸€æ¬¡æ–°çš„è¿­ä»£ï¼Œ è€Œå½“æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›å€¼ä¸º 0 çš„æ¸¸æ ‡æ—¶ï¼Œ è¡¨ç¤ºè¿­ä»£å·²ç»“æŸã€‚</p></blockquote><h2 id="ç”Ÿæˆkey"><a href="#ç”Ÿæˆkey" class="headerlink" title="ç”Ÿæˆkey"></a>ç”Ÿæˆkey</h2><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">// ç”Ÿæˆ1000ä¸ª</span><span class="hljs-variable">$Redis</span> = <span class="hljs-keyword">new</span> \Redis();<span class="hljs-variable">$Redis</span>-&gt;connect(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">10</span>);<span class="hljs-variable">$Redis</span>-&gt;select(<span class="hljs-number">2</span>);<span class="hljs-variable">$arr</span> = [    <span class="hljs-string">&#x27;rwer&#x27;</span>,    <span class="hljs-string">&#x27;24erw&#x27;</span>,    <span class="hljs-string">&#x27;rterq4&#x27;</span>,    <span class="hljs-string">&#x27;sdgfd5&#x27;</span>,    <span class="hljs-string">&#x27;dgsdg&#x27;</span>,    <span class="hljs-string">&#x27;sfst&#x27;</span>,];<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;<span class="hljs-number">1000</span>; <span class="hljs-variable">$i</span>++) &#123;    <span class="hljs-variable">$Redis</span>-&gt;set(md5(<span class="hljs-variable">$i</span>.<span class="hljs-variable">$arr</span>[<span class="hljs-variable">$i</span>%<span class="hljs-number">6</span>]), md5(<span class="hljs-variable">$arr</span>[<span class="hljs-variable">$i</span>%<span class="hljs-number">6</span>].<span class="hljs-string">&#x27;sdfsd&#x27;</span>));&#125;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;OK&quot;</span>.PHP_EOL;</code></pre></div><h2 id="keysæŸ¥çœ‹ä¸ªæ•°"><a href="#keysæŸ¥çœ‹ä¸ªæ•°" class="headerlink" title="keysæŸ¥çœ‹ä¸ªæ•°"></a>keysæŸ¥çœ‹ä¸ªæ•°</h2><p><code>keys c*</code></p><p><img src="https://cdn.learnku.com/uploads/images/202001/26/41489/1h6zy6J8lM.png!large" alt="Redisä¸­ä½¿ç”¨scanæ›¿æ¢keys"></p><h2 id="scanéå†"><a href="#scanéå†" class="headerlink" title="scanéå†"></a>scanéå†</h2><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$Redis</span> = <span class="hljs-keyword">new</span> \Redis();<span class="hljs-variable">$Redis</span>-&gt;connect(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">10</span>);<span class="hljs-variable">$Redis</span>-&gt;select(<span class="hljs-number">2</span>);<span class="hljs-variable">$iterator</span> = <span class="hljs-literal">null</span>;<span class="hljs-comment">// éå†å‰ç¼€</span><span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;c*&#x27;</span>;<span class="hljs-variable">$count</span> = <span class="hljs-number">100</span>;<span class="hljs-comment">// åŠ¡å¿…è®¾ç½®ï¼Œå¦‚æœæ²¡æ‰«æåˆ°ï¼Œç»§ç»­æ‰«æï¼Œè€Œä¸æ˜¯è¿”å›ç©ºï¼Œå¦åˆ™whileç›´æ¥é€€å‡ºï¼Œéå†å°±ä¼šä¸å‡†ç¡®</span><span class="hljs-variable">$Redis</span>-&gt;setOption(\Redis::OPT_SCAN, \Redis::SCAN_RETRY);<span class="hljs-variable">$total</span> = [];<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<span class="hljs-comment">// $countå¯ä»¥ä¸è®¾ç½®ï¼Œéå¿…éœ€å‚æ•°</span><span class="hljs-keyword">while</span>(<span class="hljs-variable">$arr</span> = <span class="hljs-variable">$Redis</span>-&gt;scan(<span class="hljs-variable">$iterator</span>, <span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$count</span>)) &#123;    <span class="hljs-variable">$arrVal</span> = <span class="hljs-variable">$Redis</span>-&gt;mget(<span class="hljs-variable">$arr</span>);    <span class="hljs-variable">$ret</span> = array_combine(<span class="hljs-variable">$arr</span>, <span class="hljs-variable">$arrVal</span>);    <span class="hljs-variable">$total</span> = array_merge(<span class="hljs-variable">$total</span>, <span class="hljs-variable">$ret</span>);    <span class="hljs-variable">$i</span>++;&#125;<span class="hljs-comment">// var_dump($total);</span>var_dump(<span class="hljs-variable">$i</span>);<span class="hljs-keyword">echo</span> count(<span class="hljs-variable">$total</span>).PHP_EOL;</code></pre></div><p><img src="https://cdn.learnku.com/uploads/images/202001/26/41489/RR8bffjcP6.png!large" alt="Redisä¸­ä½¿ç”¨scanæ›¿æ¢keys"></p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨\Redis::OPT_SCAN, \Redis::SCAN_RETRYè¿™ä¸¤ä¸ªå‚æ•°ï¼Œè‡ªè¡Œå¾ªç¯ï¼Œåˆ¤æ–­è¿”å›å€¼æ˜¯ä¸æ˜¯falseï¼Œä¹Ÿèƒ½éå†æˆåŠŸã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravelé…åˆJWT</title>
    <link href="/2020/01/20/224/"/>
    <url>/2020/01/20/224/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æµ‹è¯•ä½¿ç”¨çš„æ˜¯Laravel5.5ç‰ˆæœ¬ã€‚</p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">composer</span> require tymon/jwt-auth=<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>-rc.<span class="hljs-number">5</span></code></pre></div><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h4 id="ç”Ÿæˆé…ç½®"><a href="#ç”Ÿæˆé…ç½®" class="headerlink" title="ç”Ÿæˆé…ç½®"></a>ç”Ÿæˆé…ç½®</h4><div class="code-wrapper"><pre><code class="hljs taggerscript">php artisan vendor:publish --provider=&quot;Tymon<span class="hljs-symbol">\J</span>WTAuth<span class="hljs-symbol">\P</span>roviders<span class="hljs-symbol">\L</span>aravelServiceProvider&quot;php artisan jwt:secret</code></pre></div><h4 id="authé…ç½®"><a href="#authé…ç½®" class="headerlink" title="authé…ç½®"></a>authé…ç½®</h4><div class="code-wrapper"><pre><code class="hljs dart">&lt;?php<span class="hljs-keyword">return</span> [...    <span class="hljs-string">&#x27;defaults&#x27;</span> =&gt; [        <span class="hljs-string">&#x27;guard&#x27;</span> =&gt; <span class="hljs-string">&#x27;web&#x27;</span>,        <span class="hljs-string">&#x27;passwords&#x27;</span> =&gt; <span class="hljs-string">&#x27;users&#x27;</span>,    ],    <span class="hljs-string">&#x27;guards&#x27;</span> =&gt; [        <span class="hljs-string">&#x27;web&#x27;</span> =&gt; [            <span class="hljs-string">&#x27;driver&#x27;</span> =&gt; <span class="hljs-string">&#x27;session&#x27;</span>,            <span class="hljs-string">&#x27;provider&#x27;</span> =&gt; <span class="hljs-string">&#x27;users&#x27;</span>,        ],<span class="hljs-comment">// ä½¿ç”¨jwt</span>        <span class="hljs-string">&#x27;api&#x27;</span> =&gt; [            <span class="hljs-string">&#x27;driver&#x27;</span> =&gt; <span class="hljs-string">&#x27;jwt&#x27;</span>,            <span class="hljs-string">&#x27;provider&#x27;</span> =&gt; <span class="hljs-string">&#x27;apiUser&#x27;</span>,        ],    ],    <span class="hljs-string">&#x27;providers&#x27;</span> =&gt; [        ...<span class="hljs-comment">// æŒ‡å®šmodel</span>        <span class="hljs-string">&#x27;apiUser&#x27;</span> =&gt; [            <span class="hljs-string">&#x27;driver&#x27;</span> =&gt; <span class="hljs-string">&#x27;eloquent&#x27;</span>,            <span class="hljs-string">&#x27;model&#x27;</span> =&gt; App\ApiUser::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span><span class="hljs-class">        ],</span><span class="hljs-class">    ],</span><span class="hljs-class">];</span></code></pre></div><h2 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h2><p>æ§åˆ¶å™¨ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Api</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">ApiUser</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Controller</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Tymon</span>\<span class="hljs-title">JWTAuth</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">JWTAuth</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ä¸­é—´ä»¶å»é™¤loginå’Œrefresh</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;middleware(<span class="hljs-string">&#x27;auth:api&#x27;</span>, [<span class="hljs-string">&#x27;except&#x27;</span> =&gt; [<span class="hljs-string">&#x27;login&#x27;</span>,<span class="hljs-string">&#x27;refresh&#x27;</span>]]);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Get a JWT via given credentials.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\JsonResponse</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$credentials</span> = <span class="hljs-variable">$request</span>-&gt;only(<span class="hljs-string">&#x27;phone&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>);        <span class="hljs-keyword">if</span> (count(<span class="hljs-variable">$credentials</span>) &lt; <span class="hljs-number">2</span>) &#123;            <span class="hljs-keyword">return</span> response()-&gt;json([<span class="hljs-string">&#x27;error&#x27;</span> =&gt; <span class="hljs-string">&#x27;Unauthorized&#x27;</span>], <span class="hljs-number">401</span>);        &#125;         <span class="hljs-variable">$user</span> = ApiUser::where(<span class="hljs-string">&#x27;phone&#x27;</span>, <span class="hljs-variable">$credentials</span>[<span class="hljs-string">&#x27;phone&#x27;</span>])            -&gt;where(<span class="hljs-string">&#x27;password&#x27;</span>, md5(<span class="hljs-variable">$credentials</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))            -&gt;first();        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$user</span>) || !<span class="hljs-variable">$token</span> = JWTAuth::fromUser(<span class="hljs-variable">$user</span>)) &#123;            <span class="hljs-keyword">return</span> response()-&gt;json([<span class="hljs-string">&#x27;error&#x27;</span> =&gt; <span class="hljs-string">&#x27;Unauthorized&#x27;</span>], <span class="hljs-number">401</span>);        &#125;        <span class="hljs-comment">// dd($token);</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;respondWithToken(<span class="hljs-variable">$token</span>);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Get the authenticated User.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\JsonResponse</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">me</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> response()-&gt;json(auth(<span class="hljs-string">&#x27;api&#x27;</span>)-&gt;user());    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Log the user out (Invalidate the token).</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\JsonResponse</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        auth()-&gt;logout();        <span class="hljs-keyword">return</span> response()-&gt;json([<span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Successfully logged out&#x27;</span>]);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Refresh a token.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\JsonResponse</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refresh</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;respondWithToken(auth(<span class="hljs-string">&#x27;api&#x27;</span>)-&gt;refresh());    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Get the token array structure.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  string $token</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> \Illuminate\Http\JsonResponse</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">respondWithToken</span>(<span class="hljs-params"><span class="hljs-variable">$token</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> response()-&gt;json([            <span class="hljs-string">&#x27;access_token&#x27;</span> =&gt; <span class="hljs-variable">$token</span>,            <span class="hljs-string">&#x27;token_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;bearer&#x27;</span>,            <span class="hljs-string">&#x27;expires_in&#x27;</span> =&gt; auth(<span class="hljs-string">&#x27;api&#x27;</span>)-&gt;factory()-&gt;getTTL() * <span class="hljs-number">60</span>        ]);    &#125;&#125;</code></pre></div><p>è·¯ç”±ï¼š</p><blockquote><p><strong>æ­¤å¤„æ³¨æ„ï¼Œæˆ‘ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œä½¿ç”¨äº†getæ–¹æ³•ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨getã€‚</strong></p></blockquote><div class="code-wrapper"><pre><code class="hljs css">// routes/api<span class="hljs-selector-class">.php</span>Route::<span class="hljs-built_in">middleware</span>(<span class="hljs-string">&#x27;api&#x27;</span>)-&gt;<span class="hljs-built_in">prefix</span>(<span class="hljs-string">&#x27;auth&#x27;</span>)-&gt;<span class="hljs-built_in">namespace</span>(<span class="hljs-string">&#x27;Api&#x27;</span>)-&gt;<span class="hljs-built_in">group</span>(function () &#123;Route::<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;login&#x27;</span>, <span class="hljs-string">&#x27;AuthController@login&#x27;</span>);Route::<span class="hljs-built_in">post</span>(<span class="hljs-string">&#x27;logout&#x27;</span>, <span class="hljs-string">&#x27;AuthController@logout&#x27;</span>);Route::<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;refresh&#x27;</span>, <span class="hljs-string">&#x27;AuthController@refresh&#x27;</span>);Route::<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;me&#x27;</span>, <span class="hljs-string">&#x27;AuthController@me&#x27;</span>);&#125;);</code></pre></div><p>æµ‹è¯•ä¸€ä¸‹:</p><p><img src="https://cdn.learnku.com/uploads/images/202001/20/41489/EFqa4Najap.png!large" alt="Laravel"><br><img src="https://cdn.learnku.com/uploads/images/202001/20/41489/5JiV5lJM5j.png!large" alt="Laravel"><br><img src="https://cdn.learnku.com/uploads/images/202001/20/41489/bfhTMMdvVq.png!large" alt="Laravel"></p><h4 id="unauthenticatedå¤„ç†"><a href="#unauthenticatedå¤„ç†" class="headerlink" title="unauthenticatedå¤„ç†"></a>unauthenticatedå¤„ç†</h4><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼Œunauthenticatedå¤„ç†ä¸€ä¸‹æ¯”è¾ƒå¥½ï¼Œå¦åˆ™ä¼šé»˜è®¤è·³è½¬loginç™»å½•é¡µé¢ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exceptions</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Exception</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">Handler</span> <span class="hljs-title">as</span> <span class="hljs-title">ExceptionHandler</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Auth</span>\<span class="hljs-title">AuthenticationException</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Handler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExceptionHandler</span></span><span class="hljs-class"></span>&#123;    ...    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unauthenticated</span>(<span class="hljs-params"><span class="hljs-variable">$request</span>, AuthenticationException <span class="hljs-variable">$exception</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> response()-&gt;json([<span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Unauthenticated.&#x27;</span>], <span class="hljs-number">401</span>);         <span class="hljs-comment">/*éapiå¯ä»¥è¿™ä¹ˆå¤„ç†</span><span class="hljs-comment">        return $request-&gt;expectsJson()</span><span class="hljs-comment">                    ? response()-&gt;json([&#x27;message&#x27; =&gt; &#x27;Unauthenticated.&#x27;], 401)</span><span class="hljs-comment">                    : redirect()-&gt;guest(route(&#x27;login&#x27;));</span><span class="hljs-comment">                    */</span>    &#125;&#125;</code></pre></div><hr><h4 id="åŠ å…¥token-refresh"><a href="#åŠ å…¥token-refresh" class="headerlink" title="åŠ å…¥token refresh"></a>åŠ å…¥token refresh</h4><p>åŠ å…¥ä¸­é—´ä»¶ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Middleware</span>;  <span class="hljs-keyword">use</span> <span class="hljs-title">Closure</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Tymon</span>\<span class="hljs-title">JWTAuth</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">JWTAuth</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Tymon</span>\<span class="hljs-title">JWTAuth</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">JWTException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Auth</span>\<span class="hljs-title">AuthenticationException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Tymon</span>\<span class="hljs-title">JWTAuth</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">TokenExpiredException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">HttpResponseException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Tymon</span>\<span class="hljs-title">JWTAuth</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Middleware</span>\<span class="hljs-title">BaseMiddleware</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RefreshToken</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseMiddleware</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Handle an incoming request.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Illuminate\Http\Request  $request</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span>  \Closure  $next</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> mixed</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"><span class="hljs-variable">$request</span>, <span class="hljs-built_in">Closure</span> <span class="hljs-variable">$next</span></span>)</span><span class="hljs-function">    </span>&#123;          <span class="hljs-keyword">try</span>&#123;            <span class="hljs-comment">//æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦å¸¦æœ‰token å¦‚æœæ²¡æœ‰tokenå€¼åˆ™æŠ›å‡ºå¼‚å¸¸</span>            <span class="hljs-keyword">$this</span>-&gt;checkForToken(<span class="hljs-variable">$request</span>);             <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;user = JWTAuth::parseToken()-&gt;authenticate()) &#123;                       <span class="hljs-keyword">return</span> <span class="hljs-variable">$next</span>(<span class="hljs-variable">$request</span>);            &#125;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationException(<span class="hljs-string">&#x27;Unauthorized&#x27;</span>, []);        &#125;<span class="hljs-keyword">catch</span> (TokenExpiredException <span class="hljs-variable">$exception</span>)&#123;            <span class="hljs-comment">//è¿”å›ç‰¹æ®Šçš„code</span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> HttpResponseException(response()-&gt;json([                <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;token expired&#x27;</span>            ]));        &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$exception</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationException(<span class="hljs-string">&#x27;Unauthorized&#x27;</span>, []);        &#125;    &#125;&#125;</code></pre></div><p>æ³¨å†Œï¼š</p><div class="code-wrapper"><pre><code class="hljs moonscript">&lt;?phpnamespace App\Http;use Illuminate\Foundation\Http\Kernel as HttpKernel;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Kernel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpKernel</span></span>&#123;    ...    protected $routeMiddleware = [        <span class="hljs-string">&#x27;token.refresh&#x27;</span> =&gt; \App\Http\Middleware\RefreshToken::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span>        <span class="hljs-string">&#x27;auth.basic&#x27;</span> =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span>        <span class="hljs-string">&#x27;bindings&#x27;</span> =&gt; \Illuminate\Routing\Middleware\SubstituteBindings::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span>        <span class="hljs-string">&#x27;can&#x27;</span> =&gt; \Illuminate\Auth\Middleware\Authorize::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span>        <span class="hljs-string">&#x27;guest&#x27;</span> =&gt; \App\Http\Middleware\RedirectIfAuthenticated::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span>        <span class="hljs-string">&#x27;throttle&#x27;</span> =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::<span class="hljs-class"><span class="hljs-keyword">class</span>,</span>    ];&#125;</code></pre></div><p>ç›¸åº”çš„æ§åˆ¶å™¨æ„é€ å‡½æ•°ä¿®æ”¹ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;        <span class="hljs-keyword">$this</span>-&gt;middleware(<span class="hljs-string">&#x27;token.refresh&#x27;</span>, [<span class="hljs-string">&#x27;except&#x27;</span> =&gt; [<span class="hljs-string">&#x27;login&#x27;</span>,<span class="hljs-string">&#x27;refresh&#x27;</span>]]);&#125;</code></pre></div><p>æŠŠtokenæ—¶é—´è®¾ç½®æˆ1åˆ†é’Ÿï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/202001/20/41489/aLxjMvw3xc.png!large" alt="Laravel é…åˆ jwt ä½¿ç”¨"></p><p>å¯ä»¥æ ¹æ®apiè¿”å›ï¼Œå»è°ƒç”¨åˆ·æ–°æ¥å£ã€‚</p><p>ç®€å•ä½¿ç”¨å°±æ˜¯è¿™æ ·å•¦ã€‚æ›´å¤šä½¿ç”¨å¯ä»¥çœ‹ä¸‹ç«™å†…å…¶ä»–æ–‡ç« ï¼š<br><a href="https://learnku.com/articles/10885/full-use-of-jwt">JWT å®Œæ•´ä½¿ç”¨è¯¦è§£</a><br><a href="https://jwt-auth.readthedocs.io/en/develop/laravel-installation/">jwt-authæ–‡æ¡£</a></p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
      <tag>jwt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravelç»Ÿä¸€é”™è¯¯å¤„ç†</title>
    <link href="/2020/01/20/223/"/>
    <url>/2020/01/20/223/</url>
    
    <content type="html"><![CDATA[<p>Laravelä¸­çš„App\Exceptions\Handler ç±»è´Ÿè´£è®°å½•åº”ç”¨ç¨‹åºè§¦å‘çš„æ‰€æœ‰å¼‚å¸¸ï¼Œè¿™åœ¨æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­ååˆ†æ–¹ä¾¿ï¼Œæ€»æ˜¯tryâ€¦catchä½¿ä»£ç å¤ªè¿‡ç¹çä¸”å¯è¯»æ€§å¤§å¤§é™ä½ï¼Œé‚£ä¹ˆæ€ä¹ˆä½¿ç”¨å®ƒå¤„ç†å¼‚å¸¸ä¸º<code>json</code>å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªclassï¼Œç”¨æ¥å¤„ç†å¼‚å¸¸è¿”å›ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Author: sai</span><span class="hljs-comment"> * Date: 2020/1/15</span><span class="hljs-comment"> * Time: 14:31</span><span class="hljs-comment"> */</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exceptions</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiException</span> <span class="hljs-keyword">extends</span> \<span class="hljs-title">Exception</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">const</span> ERROR_CODE = <span class="hljs-number">1001</span>;    <span class="hljs-keyword">const</span> ERROR_MSG  = <span class="hljs-string">&#x27;ApiException&#x27;</span>;    <span class="hljs-keyword">private</span> <span class="hljs-variable">$data</span> = [];    <span class="hljs-comment">/**</span><span class="hljs-comment">     * BusinessException constructor.</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string $message</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string $code</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> array $data</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$message</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$code</span>, <span class="hljs-variable">$data</span> = []</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;code = <span class="hljs-variable">$code</span>  ? : <span class="hljs-built_in">self</span>::ERROR_CODE;        <span class="hljs-keyword">$this</span>-&gt;message  = <span class="hljs-variable">$message</span> ? : <span class="hljs-built_in">self</span>::ERROR_MSG;        <span class="hljs-keyword">$this</span>-&gt;data = <span class="hljs-variable">$data</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> array</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;data;    &#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * å¼‚å¸¸è¾“å‡º</span><span class="hljs-comment"> */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"><span class="hljs-variable">$request</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> response()-&gt;json([            <span class="hljs-string">&#x27;data&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;getData(),            <span class="hljs-string">&#x27;code&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;getCode(),            <span class="hljs-string">&#x27;messgae&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;getMessage(),        ], <span class="hljs-number">200</span>);    &#125;&#125;</code></pre></div><p>ç„¶åæˆ‘ä»¬åœ¨HandleråŠ å…¥ï¼ŒåŠ å…¥<code>$dontReport</code>ï¼Œä¾¿ä¸ä¼šä½¿ç”¨è‡ªå¸¦çš„é”™è¯¯å¤„ç†ï¼Œè€Œä½¿ç”¨è‡ªå®šä¹‰çš„å¤„ç†ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exceptions</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Exception</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">Handler</span> <span class="hljs-title">as</span> <span class="hljs-title">ExceptionHandler</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Handler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExceptionHandler</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ä¸€äº›ä¸éœ€ç®¡æˆ–ä¸éœ€è¦æŠ›å‡ºçš„å¼‚å¸¸</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$dontReport</span> = [        ApiException::class,    ];    ...&#125;</code></pre></div><p>æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Exceptions</span>\<span class="hljs-title">ApiException</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApiException(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-number">10001</span>, [<span class="hljs-string">&#x27;oh&#x27;</span> =&gt; <span class="hljs-string">&#x27;no&#x27;</span>]);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    &#125;&#125;</code></pre></div><p>æŸ¥çœ‹è¾“å‡ºï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/202001/20/41489/PdsyaJkryT.png!large" alt="Laravelç»Ÿä¸€é”™è¯¯å¤„ç†"></p><p>æµ‹è¯•okï¼Œæˆ‘ä»¬å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨å•¦ã€‚å½“ç„¶ï¼Œå…¶ä»–å½¢å¼çš„é”™è¯¯è¾“å‡ºå¯ä»¥è‡ªè¡Œæ‰©å±•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElementUIæ•´åˆç¼–è¾‘å™¨vue-quill-editor</title>
    <link href="/2020/01/08/222/"/>
    <url>/2020/01/08/222/</url>
    
    <content type="html"><![CDATA[<p>ç›´æ¥ä¸Šä»£ç ï¼š</p><p>main.js</p><div class="code-wrapper"><pre><code class="hljs clean"><span class="hljs-keyword">import</span> VueQuillEditor <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-quill-editor&#x27;</span><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;quill/dist/quill.core.css&#x27;</span><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;quill/dist/quill.snow.css&#x27;</span><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;quill/dist/quill.bubble.css&#x27;</span>Vue.use(VueQuillEditor)</code></pre></div><p>template:</p><div class="code-wrapper"><pre><code class="hljs xml">...<span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;è¯¦æƒ…&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">quill-editor</span> </span><span class="hljs-tag">        <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;form.remark&quot;</span> </span><span class="hljs-tag">        <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;myQuillEditor&quot;</span> </span><span class="hljs-tag">        <span class="hljs-attr">:options</span>=<span class="hljs-string">&quot;editorOption&quot;</span> </span><span class="hljs-tag">        @<span class="hljs-attr">blur</span>=<span class="hljs-string">&quot;onEditorBlur($event)&quot;</span> @<span class="hljs-attr">focus</span>=<span class="hljs-string">&quot;onEditorFocus($event)&quot;</span></span><span class="hljs-tag">        @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;onEditorChange($event)&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">quill-editor</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none;&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">el-upload</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;edit-uploader&quot;</span> <span class="hljs-attr">:action</span>=<span class="hljs-string">&quot;uploadPicUrl&quot;</span></span><span class="hljs-tag">        <span class="hljs-attr">:show-file-list</span>=<span class="hljs-string">&quot;false&quot;</span></span><span class="hljs-tag">        <span class="hljs-attr">:headers</span>=<span class="hljs-string">&quot;header&quot;</span></span><span class="hljs-tag">        <span class="hljs-attr">:on-success</span>=<span class="hljs-string">&quot;editorUploadSuccess&quot;</span></span><span class="hljs-tag">        <span class="hljs-attr">:on-error</span>=<span class="hljs-string">&quot;editorUploadError&quot;</span></span><span class="hljs-tag">        <span class="hljs-attr">:before-upload</span>=<span class="hljs-string">&quot;beforeEditorUpload&quot;</span> &gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-icon-plus avatar-uploader-icon&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;aUpload&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-upload</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>...   <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><span class="javascript"></span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><span class="javascript">    <span class="hljs-function"><span class="hljs-title">data</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">        <span class="hljs-keyword">return</span> &#123;</span><span class="javascript">            <span class="hljs-attr">editorOption</span>: &#123;</span><span class="javascript">                <span class="hljs-attr">modules</span>: &#123;</span><span class="javascript">                    <span class="hljs-attr">toolbar</span>: &#123;<span class="hljs-attr">container</span>:[</span><span class="javascript">                    [<span class="hljs-string">&#x27;bold&#x27;</span>, <span class="hljs-string">&#x27;italic&#x27;</span>, <span class="hljs-string">&#x27;underline&#x27;</span>, <span class="hljs-string">&#x27;strike&#x27;</span>],</span><span class="javascript">                    [<span class="hljs-string">&#x27;blockquote&#x27;</span>, <span class="hljs-string">&#x27;code-block&#x27;</span>],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;header&#x27;</span>: <span class="hljs-number">1</span> &#125;, &#123; <span class="hljs-string">&#x27;header&#x27;</span>: <span class="hljs-number">2</span> &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;list&#x27;</span>: <span class="hljs-string">&#x27;ordered&#x27;</span> &#125;, &#123; <span class="hljs-string">&#x27;list&#x27;</span>: <span class="hljs-string">&#x27;bullet&#x27;</span> &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;script&#x27;</span>: <span class="hljs-string">&#x27;sub&#x27;</span> &#125;, &#123; <span class="hljs-string">&#x27;script&#x27;</span>: <span class="hljs-string">&#x27;super&#x27;</span> &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;indent&#x27;</span>: <span class="hljs-string">&#x27;-1&#x27;</span> &#125;, &#123; <span class="hljs-string">&#x27;indent&#x27;</span>: <span class="hljs-string">&#x27;+1&#x27;</span> &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;direction&#x27;</span>: <span class="hljs-string">&#x27;rtl&#x27;</span> &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;size&#x27;</span>: [<span class="hljs-string">&#x27;small&#x27;</span>, <span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;large&#x27;</span>, <span class="hljs-string">&#x27;huge&#x27;</span>] &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;header&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-literal">false</span>] &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;font&#x27;</span>: [] &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;color&#x27;</span>: [] &#125;, &#123; <span class="hljs-string">&#x27;background&#x27;</span>: [] &#125;],</span><span class="javascript">                    [&#123; <span class="hljs-string">&#x27;align&#x27;</span>: [] &#125;],</span><span class="javascript">                    [<span class="hljs-string">&#x27;clean&#x27;</span>],</span><span class="javascript">                    [<span class="hljs-string">&#x27;link&#x27;</span>, <span class="hljs-string">&#x27;image&#x27;</span>]</span><span class="javascript">                    ],</span><span class="javascript">                    <span class="hljs-attr">handlers</span>: &#123;</span><span class="javascript">                        <span class="hljs-string">&#x27;image&#x27;</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>&#123;</span><span class="javascript">                            <span class="hljs-keyword">if</span> (value) &#123;</span><span class="javascript">                                <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;.edit-uploader input&#x27;</span>).click()</span><span class="javascript">                            &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">                                <span class="hljs-built_in">this</span>.quill.format(<span class="hljs-string">&#x27;image&#x27;</span>, <span class="hljs-literal">false</span>);</span><span class="javascript">                            &#125;</span><span class="javascript">                            <span class="hljs-comment">// this.$refs.aUpload.click() //è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ å›è°ƒ</span></span><span class="javascript">                        &#125;</span><span class="javascript">                    &#125;</span><span class="javascript">                    &#125;,</span><span class="javascript">                    <span class="hljs-attr">syntax</span>: &#123;</span><span class="javascript">                        <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> hljs.highlightAuto(text).value</span><span class="javascript">                    &#125;</span><span class="javascript">                &#125;,</span><span class="javascript">                </span><span class="javascript">            &#125;</span><span class="javascript">        &#125;</span><span class="javascript">    &#125;,</span><span class="javascript">    <span class="hljs-attr">methods</span>: &#123;</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">onEditorReady</span>(<span class="hljs-params">editor</span>)</span> &#123; <span class="hljs-comment">// å‡†å¤‡ç¼–è¾‘å™¨</span></span><span class="javascript">        &#125;,</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">onEditorBlur</span>(<span class="hljs-params"></span>)</span>&#123;&#125;, <span class="hljs-comment">// å¤±å»ç„¦ç‚¹äº‹ä»¶</span></span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">onEditorFocus</span>(<span class="hljs-params"></span>)</span>&#123;&#125;, <span class="hljs-comment">// è·å¾—ç„¦ç‚¹äº‹ä»¶</span></span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">onEditorChange</span>(<span class="hljs-params"></span>)</span>&#123;&#125;, <span class="hljs-comment">// å†…å®¹æ”¹å˜äº‹ä»¶</span></span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">beforeEditorUpload</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">            <span class="hljs-comment">// æ˜¾ç¤ºloadingåŠ¨ç”»</span></span><span class="javascript">            <span class="hljs-built_in">this</span>.quillUpdateImg = <span class="hljs-literal">true</span></span><span class="javascript">        &#125;,</span><span class="javascript">        </span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">editorUploadSuccess</span>(<span class="hljs-params">res, file</span>)</span> &#123;</span><span class="javascript">            <span class="hljs-comment">// è·å–å¯Œæ–‡æœ¬ç»„ä»¶å®ä¾‹</span></span><span class="javascript">            <span class="hljs-keyword">let</span> quill = <span class="hljs-built_in">this</span>.$refs.myQuillEditor.quill</span><span class="javascript">            <span class="hljs-comment">// å¦‚æœä¸Šä¼ æˆåŠŸ</span></span><span class="javascript">            <span class="hljs-keyword">if</span> (res.code === <span class="hljs-number">0</span>) &#123;</span><span class="javascript">                <span class="hljs-comment">// è·å–å…‰æ ‡æ‰€åœ¨ä½ç½®</span></span><span class="javascript">                <span class="hljs-keyword">let</span> length = quill.getSelection().index;</span><span class="javascript">                <span class="hljs-comment">// æ’å…¥å›¾ç‰‡  res.infoä¸ºæœåŠ¡å™¨è¿”å›çš„å›¾ç‰‡åœ°å€</span></span><span class="javascript">                quill.insertEmbed(length, <span class="hljs-string">&#x27;image&#x27;</span>, res.data.filepath)</span><span class="javascript">                <span class="hljs-comment">// è°ƒæ•´å…‰æ ‡åˆ°æœ€å</span></span><span class="javascript">                quill.setSelection(length + <span class="hljs-number">1</span>)</span><span class="javascript">            &#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">                <span class="hljs-built_in">this</span>.$message.error(<span class="hljs-string">&#x27;å›¾ç‰‡æ’å…¥å¤±è´¥&#x27;</span>)</span><span class="javascript">            &#125;</span><span class="javascript">            <span class="hljs-comment">// loadingåŠ¨ç”»æ¶ˆå¤±</span></span><span class="javascript">            <span class="hljs-built_in">this</span>.quillUpdateImg = <span class="hljs-literal">false</span></span><span class="javascript">        &#125;,</span><span class="javascript">    </span><span class="javascript">        <span class="hljs-comment">// å¯Œæ–‡æœ¬å›¾ç‰‡ä¸Šä¼ å¤±è´¥</span></span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">editorUploadError</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">            <span class="hljs-comment">// loadingåŠ¨ç”»æ¶ˆå¤±</span></span><span class="javascript">            <span class="hljs-built_in">this</span>.quillUpdateImg = <span class="hljs-literal">false</span></span><span class="javascript">            <span class="hljs-built_in">this</span>.$message.error(<span class="hljs-string">&#x27;å›¾ç‰‡æ’å…¥å¤±è´¥&#x27;</span>)</span><span class="javascript">        &#125;</span><span class="javascript">    &#125;</span><span class="javascript">&#125;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¼–è¾‘å™¨é»˜è®¤ä½¿ç”¨base64ä¸Šä¼ ï¼Œæˆ‘ä»¬ä½¿ç”¨elementuiçš„ä¸Šä¼ ç»„ä»¶æ›¿æ¢æ‰åŸæ¥çš„å›¾ç‰‡ä¸Šä¼ ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElementUI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javascriptç­¾åç›´ä¼ OSS</title>
    <link href="/2020/01/08/221/"/>
    <url>/2020/01/08/221/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å†™åå°ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯VUE+ElementUIï¼Œè¸©äº†ä¸€äº›å‘åˆ†äº«ä¸€ä¸‹ã€‚</p><blockquote><p>åŸç†ï¼šä»æœåŠ¡ç«¯è·å–ç­¾åï¼Œjsç›´æ¥ä¸Šä¼ é˜¿é‡Œäº‘OSSæœåŠ¡å™¨ã€‚</p></blockquote><p>elementuiä¸»è¦ä»£ç </p><div class="code-wrapper"><pre><code class="hljs sas">template:&lt;el-form-item <span class="hljs-meta">label</span>=<span class="hljs-string">&quot;ä¸Šä¼ å›¾ç‰‡&quot;</span> prop=<span class="hljs-string">&quot;video&quot;</span>&gt;    &lt;el-upload id=<span class="hljs-string">&quot;video&quot;</span>  action        :data=<span class="hljs-string">&quot;aliyunOssToken&quot;</span>        :http-request=<span class="hljs-string">&quot;uploadVideo&quot;</span>        :headers=<span class="hljs-string">&quot;header&quot;</span>&gt;        &lt;img v-<span class="hljs-meta">if</span>=<span class="hljs-string">&quot;form.cover&quot;</span> :src=<span class="hljs-string">&quot;form.cover&quot;</span>&gt;        &lt;el-button class=<span class="hljs-string">&quot;avatar-uploader-icon&quot;</span> type=<span class="hljs-string">&quot;primary&quot;</span>&gt;ä¸Šä¼ &lt;/el-button&gt;    &lt;/el-upload&gt;&lt;/el-form-item&gt;scriptï¼šupload(<span class="hljs-meta">file</span>)&#123;    var _self = this;    let imgType = <span class="hljs-meta">file</span>.<span class="hljs-meta">file</span>.type.split(<span class="hljs-string">&quot;/&quot;</span>)[1].toLowerCase();    <span class="hljs-meta">if</span> (imgType != <span class="hljs-string">&#x27;jpg&#x27;</span> <span class="hljs-variable">&amp;&amp;</span> imgType != <span class="hljs-string">&#x27;png&#x27;</span>) &#123;        this.$<span class="hljs-meta">message</span>.<span class="hljs-meta">error</span>(<span class="hljs-string">&#x27;è¯·ä¸Šä¼ å›¾ç‰‡ç±»å‹&#x27;</span>);        <span class="hljs-meta">return</span>;    &#125;    getOSSTok<span class="hljs-meta">en(</span>).th<span class="hljs-meta">en(</span>functi<span class="hljs-meta">on(</span>res)&#123;        _self.aliyunOssToken = res.data;        var ossData = &#123;&#125;;        //<span class="hljs-meta">key</span>å°±ä»£è¡¨æ–‡ä»¶å±‚çº§å’Œé˜¿é‡Œäº‘ä¸Šçš„æ–‡ä»¶å        let imgType = <span class="hljs-meta">file</span>.<span class="hljs-meta">file</span>.type.split(<span class="hljs-string">&quot;/&quot;</span>)[1];        let <span class="hljs-meta">filename</span> = <span class="hljs-meta">file</span>.<span class="hljs-meta">file</span>.name + <span class="hljs-meta">file</span>.<span class="hljs-meta">file</span>.size; //md5å¯¹å›¾ç‰‡åç§°è¿›è¡ŒåŠ å¯†        let keyValue = <span class="hljs-string">&quot;images/&quot;</span> + md5(new<span class="hljs-meta"> Date(</span>) + <span class="hljs-meta">filename</span>) + <span class="hljs-string">&quot;.&quot;</span> + imgType;        // ç»„è£…formdata        let formdata = new FormData();        formdata.append(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-meta">file</span>.<span class="hljs-meta">file</span>.name)        formdata.append(<span class="hljs-string">&#x27;key&#x27;</span>, keyValue)        formdata.append(<span class="hljs-string">&#x27;policy&#x27;</span>, _self.aliyunOssToken.policy)        formdata.append(<span class="hljs-string">&#x27;OSSAccessKeyId&#x27;</span>, _self.aliyunOssToken.accessid)        formdata.append(<span class="hljs-string">&#x27;success_action_status&#x27;</span>, 200)        formdata.append(<span class="hljs-string">&#x27;signature&#x27;</span>, _self.aliyunOssToken.signature)        formdata.append(<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-meta">file</span>.<span class="hljs-meta">file</span>)                _self.uploadOSS(formdata, _self.aliyunOssToken.host).th<span class="hljs-meta">en(</span>functi<span class="hljs-meta">on(</span>res)&#123;            _self.form.cover = _self.aliyunOssToken.host + <span class="hljs-string">&#x27;/&#x27;</span> + keyValue;            _self.$<span class="hljs-meta">message</span>.success(<span class="hljs-string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>);        &#125;).catch(functi<span class="hljs-meta">on(</span><span class="hljs-meta">error</span>)&#123;            _self.$<span class="hljs-meta">message</span>.<span class="hljs-meta">error</span>(<span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>);            console<span class="hljs-meta">.log(</span><span class="hljs-meta">error</span>);        &#125;)    &#125;).catch(functi<span class="hljs-meta">on(</span><span class="hljs-meta">error</span>)&#123;        console<span class="hljs-meta">.log(</span><span class="hljs-meta">error</span>);    &#125;)&#125;,uploadOSS(formData, url) &#123;  const config = &#123;    headers: &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;multipart/form-data;boundary=&quot;</span>+new<span class="hljs-meta"> Date(</span>).ge<span class="hljs-meta">tTime(</span>) &#125;    &#125;;  <span class="hljs-meta">return</span> axios.post(url,formData,config);&#125;</code></pre></div><p>å…¶ä¸­ï¼šåŠ¡å¿…ä½¿ç”¨è¡¨å•æäº¤æ–¹å¼ï¼ŒaliyunOssTokenæ ¼å¼å¦‚ä¸‹</p><div class="code-wrapper"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;accessid&quot;</span>: <span class="hljs-string">&quot;LToofXWKudxfoAlI&quot;</span>,<span class="hljs-attr">&quot;host&quot;</span>: <span class="hljs-string">&quot;https:\/\/xxx.oss-cn-hangzhou.aliyuncs.com&quot;</span>,<span class="hljs-attr">&quot;policy&quot;</span>: <span class="hljs-string">&quot;eyJleHBpcmF0eretaW9uIjoiQxODowNzowMFoiLCJjb25kaXRpb25zIjpbWyJjb250ZW50LWxlbmd0aC17ewreMDQ4NTc2MDAwXSxbInN0YXJ0cy13aXRoIiwiJGtleSIsInZpZGVvXC8iXV19&quot;</span>,<span class="hljs-attr">&quot;signature&quot;</span>: <span class="hljs-string">&quot;HRFJ4345VIvRhrsMa44546=&quot;</span>,<span class="hljs-attr">&quot;expire&quot;</span>: <span class="hljs-number">1578478020</span>,<span class="hljs-attr">&quot;dir&quot;</span>: <span class="hljs-string">&quot;images\/&quot;</span>&#125;</code></pre></div><p>è®°å¾—è®¾ç½®é˜¿é‡Œäº‘OSSè·¨åŸŸè§„åˆ™ï¼š</p><p><img src="https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/8466738751/p12308.png" alt="è·¨åŸŸè§„åˆ™"></p><p>æ–‡æ¡£ï¼š</p><ul><li><a href="https://help.aliyun.com/document_detail/31925.html?spm=a2c4g.11186623.6.1443.723d6e285fVXLr#title-c0t-t20-dd6">javascriptç­¾åç›´ä¼ </a></li></ul>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>wrkå‹æµ‹ä½¿ç”¨</title>
    <link href="/2019/12/30/220/"/>
    <url>/2019/12/30/220/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰éœ€è¦åšä¸€äº›å‹åŠ›æµ‹è¯•ï¼Œä¹‹å‰ä¸€ç›´ç”¨abï¼Œç”¨èµ·æ¥ä¸æ˜¯å¾ˆèˆ’æœï¼Œæœ€è¿‘æœ‰ä½¿ç”¨wrkï¼Œè½»é‡å¥½ç”¨ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><div class="code-wrapper"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/wg/</span>wrk.git wrkcd wrkmake<span class="hljs-comment"># move the executable to somewhere in your PATH</span>sudo cp wrk <span class="hljs-regexp">/somewhere/i</span>n<span class="hljs-regexp">/your/</span>PATH</code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹wrkä¼šä½¿ç”¨è‡ªå¸¦çš„LuaJITå’ŒOpenSSLï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ç³»ç»Ÿå·²å®‰è£…çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨WITH_LUAJITå’ŒWITH_OPENSSLè¿™ä¸¤ä¸ªé€‰é¡¹æ¥æŒ‡å®šå®ƒä»¬çš„è·¯å¾„ã€‚æ¯”å¦‚ï¼š</p><div class="code-wrapper"><pre><code class="hljs routeros">make <span class="hljs-attribute">WITH_LUAJIT</span>=/usr <span class="hljs-attribute">WITH_OPENSSL</span>=/usr</code></pre></div><h2 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h2><div class="code-wrapper"><pre><code class="hljs dts">wrk <span class="hljs-params">&lt;é€‰é¡¹&gt;</span> <span class="hljs-params">&lt;è¢«æµ‹HTTPæœåŠ¡çš„URL&gt;</span>                            <span class="hljs-symbol">  Options:</span>                                                -c, --connections <span class="hljs-params">&lt;N&gt;</span>  è·ŸæœåŠ¡å™¨å»ºç«‹å¹¶ä¿æŒçš„TCPè¿æ¥æ•°é‡      -d, --duration    <span class="hljs-params">&lt;T&gt;</span>  å‹æµ‹æ—¶é—´               -t, --threads     <span class="hljs-params">&lt;N&gt;</span>  ä½¿ç”¨å¤šå°‘ä¸ªçº¿ç¨‹è¿›è¡Œå‹æµ‹                                                             -s, --script      <span class="hljs-params">&lt;S&gt;</span>  æŒ‡å®šLuaè„šæœ¬è·¯å¾„           -H, --header      <span class="hljs-params">&lt;H&gt;</span>  ä¸ºæ¯ä¸€ä¸ªHTTPè¯·æ±‚æ·»åŠ HTTPå¤´              --latency          åœ¨å‹æµ‹ç»“æŸåï¼Œæ‰“å°å»¶è¿Ÿç»Ÿè®¡ä¿¡æ¯           --timeout     <span class="hljs-params">&lt;T&gt;</span>  è¶…æ—¶æ—¶é—´         -v, --version          æ‰“å°æ­£åœ¨ä½¿ç”¨çš„wrkçš„è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯                                                        <span class="hljs-params">&lt;N&gt;</span>ä»£è¡¨æ•°å­—å‚æ•°ï¼Œæ”¯æŒå›½é™…å•ä½ (<span class="hljs-number">1</span>k, <span class="hljs-number">1</span>M, <span class="hljs-number">1</span>G)  <span class="hljs-params">&lt;T&gt;</span>ä»£è¡¨æ—¶é—´å‚æ•°ï¼Œæ”¯æŒæ—¶é—´å•ä½ (<span class="hljs-number">2</span>s, <span class="hljs-number">2</span>m, <span class="hljs-number">2</span>h)</code></pre></div><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><div class="code-wrapper"><pre><code class="hljs erlang-repl">wrk -t8 -c200 -d30s --latency  <span class="hljs-string">&quot;http://www.bing.com&quot;</span>è¾“å‡ºï¼šRunning <span class="hljs-number">30</span>s test @ http://www.bing.com  <span class="hljs-number">8</span> threads and <span class="hljs-number">200</span> connections  Thread Stats   Avg      Stdev     Max   +/- Stdev    Latency    <span class="hljs-number">46.67</span>ms  <span class="hljs-number">215.38</span>ms   <span class="hljs-number">1.67</span>s    <span class="hljs-number">95.59</span><span class="hljs-comment">%</span>    Req/Sec     <span class="hljs-number">7.91</span>k     <span class="hljs-number">1.15</span>k   <span class="hljs-number">10.26</span>k    <span class="hljs-number">70.77</span><span class="hljs-comment">%</span>  Latency Distribution     <span class="hljs-number">50</span><span class="hljs-comment">%    2.93ms</span>     <span class="hljs-number">75</span><span class="hljs-comment">%    3.78ms</span>     <span class="hljs-number">90</span><span class="hljs-comment">%    4.73ms</span>     <span class="hljs-number">99</span><span class="hljs-comment">%    1.35s </span>  <span class="hljs-number">1790465</span> requests in <span class="hljs-number">30.01</span>s, <span class="hljs-number">684.08</span>MB readRequests/sec:  <span class="hljs-number">59658.29</span>Running <span class="hljs-number">30</span>s test @ http://www.bing.com ï¼ˆå‹æµ‹æ—¶é—´<span class="hljs-number">30</span>sï¼‰  <span class="hljs-number">8</span> threads and <span class="hljs-number">200</span> connections ï¼ˆå…±<span class="hljs-number">8</span>ä¸ªæµ‹è¯•çº¿ç¨‹ï¼Œ<span class="hljs-number">200</span>ä¸ªè¿æ¥ï¼‰  Thread Stats   Avg      Stdev     Max   +/- Stdev              ï¼ˆå¹³å‡å€¼ï¼‰ ï¼ˆæ ‡å‡†å·®ï¼‰ï¼ˆæœ€å¤§å€¼ï¼‰ï¼ˆæ­£è´Ÿä¸€ä¸ªæ ‡å‡†å·®æ‰€å æ¯”ä¾‹ï¼‰    Latency    <span class="hljs-number">46.67</span>ms  <span class="hljs-number">215.38</span>ms   <span class="hljs-number">1.67</span>s    <span class="hljs-number">95.59</span><span class="hljs-comment">%</span>    ï¼ˆå»¶è¿Ÿï¼‰    Req/Sec     <span class="hljs-number">7.91</span>k     <span class="hljs-number">1.15</span>k   <span class="hljs-number">10.26</span>k    <span class="hljs-number">70.77</span><span class="hljs-comment">%</span>    ï¼ˆå¤„ç†ä¸­çš„è¯·æ±‚æ•°ï¼‰  Latency Distribution ï¼ˆå»¶è¿Ÿåˆ†å¸ƒï¼‰     <span class="hljs-number">50</span><span class="hljs-comment">%    2.93ms</span>     <span class="hljs-number">75</span><span class="hljs-comment">%    3.78ms</span>     <span class="hljs-number">90</span><span class="hljs-comment">%    4.73ms</span>     <span class="hljs-number">99</span><span class="hljs-comment">%    1.35s ï¼ˆ99åˆ†ä½çš„å»¶è¿Ÿï¼‰</span>  <span class="hljs-number">1790465</span> requests in <span class="hljs-number">30.01</span>s, <span class="hljs-number">684.08</span>MB read ï¼ˆ<span class="hljs-number">30.01</span>ç§’å†…å…±å¤„ç†å®Œæˆäº†<span class="hljs-number">1790465</span>ä¸ªè¯·æ±‚ï¼Œè¯»å–äº†<span class="hljs-number">684.08</span>MBæ•°æ®ï¼‰Requests/sec:  <span class="hljs-number">59658.29</span> ï¼ˆå¹³å‡æ¯ç§’å¤„ç†å®Œæˆ<span class="hljs-number">59658.29</span>ä¸ªè¯·æ±‚ï¼‰Transfer/sec:     <span class="hljs-number">22.79</span>MB ï¼ˆå¹³å‡æ¯ç§’è¯»å–æ•°æ®<span class="hljs-number">22.79</span>MBï¼‰</code></pre></div><h2 id="luaè„šæœ¬ä½¿ç”¨"><a href="#luaè„šæœ¬ä½¿ç”¨" class="headerlink" title="luaè„šæœ¬ä½¿ç”¨"></a>luaè„šæœ¬ä½¿ç”¨</h2><div class="code-wrapper"><pre><code class="hljs lua"><span class="hljs-comment">--data.lua</span><span class="hljs-keyword">local</span> data=  <span class="hljs-string">&quot;&#123;.count.:1&#125;&quot;</span>wrk.headers[<span class="hljs-string">&quot;Content-Type&quot;</span>] =  <span class="hljs-string">&quot;application/jason&quot;</span>wrk.method  =  <span class="hljs-string">&quot;POST&quot;</span><span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">request</span><span class="hljs-params">()</span></span><span class="hljs-keyword">return</span> wrk.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, data)<span class="hljs-keyword">end</span></code></pre></div><p>æµ‹è¯•ï¼š</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">wrk</span> -t<span class="hljs-number">500</span> -c<span class="hljs-number">1000</span> -d<span class="hljs-number">1</span>s  --script=data.lua --latency https://github.oscome.cn/</code></pre></div><p>ä¸ªäººç”¨äº†å‡ æ¬¡ï¼Œæ„Ÿè§‰æ¯”abå¥½ç”¨ï¼Œæ¨èä¸€ä¸‹ã€‚</p><p>å‚è€ƒï¼š<br><a href="http://zhaox.github.io/benchmark/2016/12/28/wrk-guidelines">Httpå‹æµ‹å·¥å…·wrkä½¿ç”¨æŒ‡å—</a><br><a href="https://github.com/wg/wrk">wrk</a></p>]]></content>
    
    
    <categories>
      
      <category>test</category>
      
    </categories>
    
    
    <tags>
      
      <tag>wrk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gomodules</title>
    <link href="/2019/12/27/219/"/>
    <url>/2019/12/27/219/</url>
    
    <content type="html"><![CDATA[<p>Modules æ˜¯ Go ç®¡ç†ä¾èµ–å…³ç³»çš„å·¥å…·ï¼Œåœ¨ 1.11 ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œå¹¶åœ¨ 1.13ä¸­å¯¹æ¨¡å—è¿›è¡Œäº†é‡å¤§æ”¹è¿›å’Œæ›´æ”¹ã€‚ç›¸æ¯”å‰é¢çš„ depï¼Œvendorï¼Œglide ç­‰åŒ…ç®¡ç†æ–¹æ¡ˆï¼Œæ›´æ˜“äºä¸Šæ‰‹ã€‚å¦‚æœä½ ç°åœ¨å¼€å§‹ä¸€ä¸ª go é¡¹ç›®ï¼Œæœ€å¥½äº†è§£ä¸€ä¸‹ã€‚</p><p>Modules çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ä¸å¦¨å°è¯•ä¸€ä¸‹ï¼š</p><h2 id="å¼€å¯ï¼ˆ1-13ç‰ˆæœ¬åŠä»¥åæ— éœ€è¿™ä¸€æ­¥"><a href="#å¼€å¯ï¼ˆ1-13ç‰ˆæœ¬åŠä»¥åæ— éœ€è¿™ä¸€æ­¥" class="headerlink" title="å¼€å¯ï¼ˆ1.13ç‰ˆæœ¬åŠä»¥åæ— éœ€è¿™ä¸€æ­¥)"></a>å¼€å¯ï¼ˆ1.13ç‰ˆæœ¬åŠä»¥åæ— éœ€è¿™ä¸€æ­¥)</h2><p>1.13ç‰ˆæœ¬å‰è¯·éœ€æ‰‹åŠ¨å¼€å¯æ¨¡å—ï¼ˆ1.13 ç‰ˆæœ¬å¼€å§‹å·²ç»æ˜¯é»˜è®¤æ¨¡å¼ï¼‰</p><blockquote><p>export GO111MODULE=auto</p></blockquote><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><blockquote><p>go mod init github.com/13sai/gomodules</p></blockquote><p>output:</p><div class="code-wrapper"><pre><code class="hljs shell">go: creating new go.mod: module github.com/13sai/gomodules</code></pre></div><p>å¯ä»¥çœ‹åˆ°ä¼šç”Ÿæˆgo.modï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ã€go 1.19è¡¨ç¤ºå½“å‰ç‰ˆæœ¬ã€‘</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">module</span> github.com/<span class="hljs-number">13</span>sai/gomodules<span class="hljs-attribute">go</span> <span class="hljs-number">1</span>.<span class="hljs-number">19</span></code></pre></div><h2 id="ä½¿ç”¨-go-get"><a href="#ä½¿ç”¨-go-get" class="headerlink" title="ä½¿ç”¨ go get"></a>ä½¿ç”¨ go get</h2><p>æ¯æ¬¡ go get åï¼Œmodulesä¹Ÿä¼šå°†ä½ çš„å®‰è£…çš„packageåŠ å…¥go.mod</p><blockquote><p>go get github.com/13sai/gohelper</p></blockquote><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">module</span> github.com/<span class="hljs-number">13</span>sai/gomodules<span class="hljs-attribute">go</span> <span class="hljs-number">1</span>.<span class="hljs-number">19</span><span class="hljs-attribute">require</span> github.com/<span class="hljs-number">13</span>sai/gohelper v<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> // indirect</code></pre></div><p>å½“ç„¶ï¼Œå¦‚æœä½ æ²¡æœ‰ç¿»å¢™ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨å›½å†…é•œåƒï¼Œå¾ˆå¤šåŒ…å¯èƒ½éƒ½ä¸‹è½½å¤±è´¥ã€‚å¯ä»¥å‚è€ƒ<a href="https://goproxy.cn/">https://goproxy.cn/</a>è®¾ç½®ã€‚</p><h2 id="æœ¬åœ°æ–‡ä»¶å¤¹ç›¸äº’è°ƒç”¨"><a href="#æœ¬åœ°æ–‡ä»¶å¤¹ç›¸äº’è°ƒç”¨" class="headerlink" title="æœ¬åœ°æ–‡ä»¶å¤¹ç›¸äº’è°ƒç”¨"></a>æœ¬åœ°æ–‡ä»¶å¤¹ç›¸äº’è°ƒç”¨</h2><p>æ–°å»º pkg ç›®å½•ï¼Œæ–°å»º str.go</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> pkg<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;github.com/13sai/gohelper/str&quot;</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MD</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> str.Md5(s)&#125;</code></pre></div><p>ç®€å•å†™ä¸€ä¸‹ main.go</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;github.com/13sai/gomodules/pkg&quot;</span> <span class="hljs-comment">// å¼•å…¥åˆšåˆšæ–°å»ºçš„ pkg</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-built_in">print</span>(pkg.MD(<span class="hljs-string">&quot;13sai&quot;</span>))&#125;</code></pre></div><p>ç„¶åæ‰§è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs routeros">go <span class="hljs-builtin-name">run</span> main.gopkg/str.go:3:8: <span class="hljs-literal">no</span> required module provides package github.com/13sai/gohelper/str; <span class="hljs-keyword">to</span> <span class="hljs-builtin-name">add</span> it:        go <span class="hljs-builtin-name">get</span> github.com/13sai/gohelper/str</code></pre></div><p>è¿™é‡Œå¯ä»¥æ‰§è¡Œæ ¹æ®æç¤ºæ‰§è¡Œ</p><blockquote><p>go get github.com/13sai/gohelper/str</p></blockquote><p>æˆ–è€…å¯ä»¥ä½¿ç”¨</p><blockquote><p>go mod tidy </p></blockquote><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥æ‹‰å–ç¼ºå°‘çš„ packageï¼Œç§»é™¤ä¸ç”¨çš„ packageã€‚</p><blockquote><p>è¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œæˆ‘ä¹ æƒ¯æ¯æ¬¡å®Œæˆä¸€ä¸ªé˜¶æ®µä»£ç éƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå¯ä»¥å»é™¤å¾ˆå¤šå†—ä½™çš„ packageã€‚</p></blockquote><h2 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h2><div class="code-wrapper"><pre><code class="hljs awk">go mod download<span class="hljs-regexp">//</span>ä¸‹è½½ä¾èµ–åŒ…åˆ°æœ¬åœ°ç¼“å­˜go mod graph <span class="hljs-regexp">//</span>æ‰“å°ç°æœ‰ä¾èµ–ç»“æ„go mod verify <span class="hljs-regexp">//</span>æ ¡éªŒä¾èµ–go mod why <span class="hljs-regexp">//</span>è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦æ­¤æ¨¡å—go mod vendor <span class="hljs-regexp">//</span>ä¸‹è½½ä¾èµ–çš„packageåˆ°æœ¬åœ°vendorç›®å½•ï¼Œå­¦ä¹ ä¸­å¯ä½¿ç”¨</code></pre></div><p>ç›¸å…³ä»£ç å¯å‚è€ƒ:<br><a href="https://github.com/13sai/blog-code/tree/master/gomodules">https://github.com/13sai/blog-code/tree/master/gomodules</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/golang/go/wiki/Modules#quick-start">Modulesçš„wiki</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxè´Ÿè½½å‡è¡¡</title>
    <link href="/2019/12/21/Nginx2/"/>
    <url>/2019/12/21/Nginx2/</url>
    
    <content type="html"><![CDATA[<h2 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p>1.è½®è¯¢(é»˜è®¤)ï¼šæ¯ä¸€ä¸ªæ¥è‡ªç½‘ç»œä¸­çš„è¯·æ±‚ï¼Œè½®æµåˆ†é…ç»™å†…éƒ¨çš„æœåŠ¡å™¨ï¼Œä»1åˆ°Nç„¶åé‡æ–°å¼€å§‹ã€‚æ­¤ç§è´Ÿè½½å‡è¡¡ç®—æ³•é€‚åˆæœåŠ¡å™¨ç»„å†…éƒ¨çš„æœåŠ¡å™¨éƒ½å…·æœ‰ç›¸åŒçš„é…ç½®å¹¶ä¸”å¹³å‡æœåŠ¡è¯·æ±‚ ç›¸å¯¹å‡è¡¡çš„æƒ…å†µã€‚<br>2.åŠ æƒè½®è¯¢ï¼ˆweightï¼‰ï¼šæ ¹æ®æœåŠ¡å™¨çš„ä¸åŒå¤„ç†èƒ½åŠ›ï¼Œç»™æ¯ä¸ªæœåŠ¡å™¨åˆ†é…ä¸åŒçš„æƒå€¼ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥å—ç›¸åº”æƒå€¼æ•°çš„æœåŠ¡è¯·æ±‚ã€‚ä¾‹å¦‚:æœåŠ¡å™¨Açš„æƒå€¼è¢«è®¾è®¡æˆ1ï¼ŒBçš„æƒå€¼æ˜¯3ï¼ŒCçš„æƒå€¼æ˜¯6ï¼Œåˆ™æœåŠ¡å™¨Aã€Bã€Cå°†åˆ†åˆ«æ¥å—åˆ°10%ã€30%ã€60%çš„æœåŠ¡è¯·æ±‚ã€‚æ­¤ç§å‡è¡¡ç®—æ³•èƒ½ç¡®ä¿é«˜æ€§èƒ½çš„æœåŠ¡å™¨å¾—åˆ°æ›´å¤šçš„ä½¿ç”¨ç‡ï¼Œé¿å…ä½æ€§èƒ½çš„æœåŠ¡å™¨è´Ÿè½½è¿‡é‡ã€‚<br>3.ip-hashï¼ˆip_hashï¼‰ï¼šnginxå°†ä¼šæ ¹æ®ç›¸åº”çš„hashå‡½æ•°ï¼Œå¯¹æ¯ä¸ªè¯·æ±‚çš„ipä½œä¸ºå…³é”®å­—ï¼Œå¾—åˆ°çš„hashå€¼å°†ä¼šå†³å®šå°†è¯·æ±‚åˆ†å‘ç»™ç›¸åº”Serverè¿›è¡Œå¤„ç†ã€‚<br>4.æœ€å°‘è¿æ¥æ•°ï¼ˆleast_connï¼‰ï¼šnginxä¼šåˆ¤æ–­åç«¯é›†ç¾¤æœåŠ¡å™¨ä¸­å“ªä¸ªServerå½“å‰çš„ Active Connection æ•°æ˜¯æœ€å°‘çš„ï¼Œå¯¹äºæ¯ä¸ªæ–°è¿›æ¥çš„è¯·æ±‚ï¼Œnginxå°†è¯¥å…¶åˆ†å‘ç»™å¯¹åº”çš„Serverã€‚</p><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">è¯­æ³•: upstream name &#123; ... &#125; </span><span class="hljs-section">é»˜è®¤å€¼: â€”</span><span class="hljs-section">ä¸Šä¸‹æ–‡: http</span>upstream æŒ‡ä»¤å½“ä¸­åŒ…å«serveræŒ‡ä»¤<span class="hljs-section">è¯­æ³•: server address [parameters]; </span><span class="hljs-section">ä¸Šä¸‹æ–‡: upstream</span></code></pre></div><p>demo:</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">upstream</span> backend &#123;    <span class="hljs-attribute">server</span> backend1.example.com:<span class="hljs-number">8081</span> weight=<span class="hljs-number">4</span> max_fails=<span class="hljs-number">2</span> fail_timeout=<span class="hljs-number">30s</span>;     <span class="hljs-attribute">server</span> backend2.example.com:<span class="hljs-number">8080</span> weight=<span class="hljs-number">1</span>;&#125;<span class="hljs-section">server</span> &#123;     <span class="hljs-attribute">location</span> / &#123;        <span class="hljs-attribute">proxy_pass</span> http://backend;     &#125;&#125;</code></pre></div><p>å‚æ•°è¯´æ˜:</p><ul><li>weight=number è®¾å®šæœåŠ¡å™¨çš„æƒé‡ï¼Œé»˜è®¤æ˜¯1ï¼Œæƒé‡è¶Šå¤§è¢«è®¿é—®æœºä¼šè¶Šå¤§ï¼Œå¯ä»¥æ ¹æ®æœºå™¨çš„é…ç½®æƒ…å†µæ¥é…ç½®ã€‚</li><li>max_fails=number è®¾å®šNginxä¸æœåŠ¡å™¨é€šä¿¡çš„å°è¯•å¤±è´¥çš„æ¬¡æ•°ã€‚åœ¨fail_timeoutå‚æ•°å®šä¹‰çš„æ—¶é—´æ®µå†…ï¼Œå¦‚æœå¤±è´¥çš„æ¬¡æ•°è¾¾åˆ°æ­¤å€¼ï¼ŒNginxå°±è®¤ä¸ºæœåŠ¡å™¨ä¸ å¯ç”¨ã€‚åœ¨ä¸‹ä¸€ä¸ªfail_timeoutæ—¶é—´æ®µï¼ŒæœåŠ¡å™¨ä¸ä¼šå†è¢«å°è¯•ã€‚ å¤±è´¥çš„å°è¯•æ¬¡æ•°é»˜è®¤æ˜¯1ã€‚é»˜è®¤é…ç½®æ—¶ï¼Œhttp_404çŠ¶æ€ä¸è¢«è®¤ä¸ºæ˜¯å¤±è´¥çš„å°è¯•ã€‚ å¯ä»¥é€šè¿‡æŒ‡ä»¤proxy_next_upstream å’Œ memcached_next_upstream æ¥é…ç½®ä»€ä¹ˆæ˜¯å¤±è´¥çš„å°è¯•ã€‚</li><li>fail_timeout=time,ç»Ÿè®¡å¤±è´¥å°è¯•æ¬¡æ•°çš„æ—¶é—´æ®µã€‚åœ¨è¿™æ®µæ—¶é—´ä¸­ï¼ŒæœåŠ¡å™¨å¤±è´¥æ¬¡æ•°è¾¾åˆ°æŒ‡å®šçš„å°è¯•æ¬¡æ•°ï¼ŒæœåŠ¡å™¨å°±è¢«è®¤ä¸ºä¸å¯ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥è¶…æ—¶æ—¶é—´æ˜¯10ç§’ã€‚ </li><li>backup,æ ‡è®°ä¸ºå¤‡ç”¨æœåŠ¡å™¨ã€‚å½“ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ä»¥åï¼Œè¯·æ±‚ä¼šè¢«ä¼ ç»™è¿™äº›æœåŠ¡å™¨ï¼Œé…ç½®è¿™ä¸ªæŒ‡ä»¤å¯ä»¥å®ç°æ•…éšœè½¬ç§»ã€‚</li><li>down,æ ‡è®°æœåŠ¡å™¨æ°¸ä¹…ä¸å¯ç”¨ï¼Œå¯ä»¥è·Ÿip_hashæŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><h2 id="proxy-next-upstream-æŒ‡ä»¤"><a href="#proxy-next-upstream-æŒ‡ä»¤" class="headerlink" title="proxy_next_upstream æŒ‡ä»¤"></a>proxy_next_upstream æŒ‡ä»¤</h2><p>åœ¨nginxçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œ proxy_next_upstream é¡¹å®šä¹‰äº†ä»€ä¹ˆæƒ…å†µä¸‹è¿›è¡Œé‡è¯•</p><div class="code-wrapper"><pre><code class="hljs coq">è¯­æ³•: proxy_next_upstream error | <span class="hljs-type">timeout</span> | <span class="hljs-type">invalid_header</span> | <span class="hljs-type">http_500</span> | <span class="hljs-type">http_502</span> | <span class="hljs-type">http_503</span> | <span class="hljs-type">http_504</span> | <span class="hljs-type">http_403</span> | <span class="hljs-type">http_404</span> | <span class="hljs-type">http_429</span> | <span class="hljs-type">non_idempotent</span> | <span class="hljs-type">off</span> ...; é»˜è®¤å€¼: proxy_next_upstream error <span class="hljs-built_in">timeout</span>;ä¸Šä¸‹æ–‡: http, server, location</code></pre></div><p>å‚æ•°è¯´æ˜:</p><ul><li>error è¡¨ç¤ºå’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œæˆ–è€…å‘åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæˆ–è€…ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´æ—¶ï¼Œå‡ºç°é”™è¯¯ã€‚ </li><li>timeout è¡¨ç¤ºå’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œæˆ–è€…å‘åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæˆ–è€…ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´æ—¶ï¼Œå‡ºç°è¶…æ—¶ã€‚ </li><li>invalid_header è¡¨ç¤ºåç«¯æœåŠ¡å™¨è¿”å›ç©ºå“åº”æˆ–è€…éæ³•å“åº”å¤´</li><li>http_500 è¡¨ç¤ºåç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”çŠ¶æ€ç ä¸º500</li><li>non_idempotent é€šå¸¸ï¼Œå¦‚æœè¯·æ±‚å·²å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåˆ™å…·æœ‰éç­‰å¹‚æ–¹æ³•ï¼ˆPOSTã€LOCKã€PATCHï¼‰çš„è¯·æ±‚ä¸ä¼šä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæœåŠ¡å™¨ï¼›å¯ç”¨æ­¤é€‰é¡¹å¯æ˜¾å¼å…è®¸é‡è¯•æ­¤ç±»è¯·æ±‚ï¼›</li><li>off è¡¨ç¤ºåœæ­¢å°†è¯·æ±‚å‘é€ç»™ä¸‹ä¸€å°åç«¯æœåŠ¡å™¨</li></ul><p>PS: non_idempotentå‚æ•°ï¼Œproxy_next_upstreamé…ç½®é»˜è®¤è½¬å‘getè¯·æ±‚ï¼Œä½†å¯¹äºpostç­‰è¯·æ±‚å¹¶æ— æ•ˆæœï¼Œå»ºè®®é…ç½®è¿™ä¸€é¡¹ã€‚</p><h4 id="ç›¸å…³"><a href="#ç›¸å…³" class="headerlink" title="ç›¸å…³"></a>ç›¸å…³</h4><ul><li>proxy_next_upstream_tries:è®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤0è¡¨ç¤ºä¸é™åˆ¶ï¼Œæ³¨æ„æ­¤é‡è¯•æ¬¡æ•°æŒ‡çš„æ˜¯æ‰€æœ‰è¯·æ±‚æ¬¡æ•°(åŒ…æ‹¬ç¬¬ä¸€æ¬¡å’Œä¹‹åçš„é‡è¯•æ¬¡æ•°ä¹‹å’Œ)ã€‚ </li><li>proxy_next_upstream_timeout: è®¾ç½®é‡è¯•æœ€å¤§è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤0è¡¨ç¤ºä¸é™åˆ¶ã€‚å³åœ¨ proxy_next_upstream_timeout æ—¶é—´å†…å…è®¸ proxy_next_upstream_tries æ¬¡é‡è¯•ã€‚å¦‚æœè¶…è¿‡äº†å…¶ä¸­ä¸€ä¸ªè®¾ç½®ï¼Œåˆ™ Nginx ä¹Ÿä¼šç»“æŸé‡è¯•å¹¶è¿”å›å®¢æˆ·ç«¯å“åº”(å¯èƒ½æ˜¯é”™è¯¯ç )ã€‚</li><li>proxy_send_timeout:åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶æ—¶é—´)</li><li>proxy_read_timeout:è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶æ—¶é—´) </li><li>proxy_connect_timeout:nginxè¿æ¥åç«¯çš„è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸è¶…è¿‡75s</li></ul><p>demo:</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">location</span> / &#123;    <span class="hljs-attribute">proxy_pass</span>         http://app-proxy;    <span class="hljs-attribute">proxy_next_upstream</span> <span class="hljs-literal">error</span> timeout http_500 http_502 http_503 http_504;    <span class="hljs-attribute">proxy_next_upstream_tries</span> <span class="hljs-number">3</span>;    <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">60s</span>;    <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">60s</span>;    <span class="hljs-attribute">proxy_send_timeout</span> <span class="hljs-number">60s</span>;    <span class="hljs-attribute">proxy_pass_request_headers</span>      <span class="hljs-literal">on</span>;    <span class="hljs-attribute">proxy_set_header</span>   Host             $host:$server_port;    <span class="hljs-attribute">proxy_set_header</span>   X-Real-IP        $remote_addr;    <span class="hljs-attribute">proxy_set_header</span>   X-Forwarded-For  $proxy_add_x_forwarded_for;&#125;</code></pre></div><p>å»ºè®®è‡ªå·±åŠ¨æ‰‹ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œè¯•éªŒä¸€ä¸‹ï¼ŒåŠ æ·±å°è±¡å’Œç†è§£ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxå·¥ä½œæ¨¡å¼å’Œè¿›ç¨‹æ¨¡å‹</title>
    <link href="/2019/12/20/Nginx3/"/>
    <url>/2019/12/20/Nginx3/</url>
    
    <content type="html"><![CDATA[<h2 id="å·¥ä½œæ¨¡å¼"><a href="#å·¥ä½œæ¨¡å¼" class="headerlink" title="å·¥ä½œæ¨¡å¼"></a>å·¥ä½œæ¨¡å¼</h2><ol><li>Nginxå¯åŠ¨åï¼Œä¼šäº§ç”Ÿä¸€ä¸ªmasterä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ‰§è¡Œä¸€ç³»åˆ—çš„å·¥ä½œåä¼šäº§ç”Ÿä¸€ä¸ªæˆ–è€…å¤šä¸ªå·¥ä½œè¿›ç¨‹worker</li><li>åœ¨å®¢æˆ·ç«¯è¯·æ±‚åŠ¨æ€ç«™ç‚¹çš„è¿‡ç¨‹ä¸­ï¼ŒNginxæœåŠ¡å™¨è¿˜æ¶‰åŠå’Œåç«¯æœåŠ¡å™¨çš„é€šä¿¡ã€‚Nginxå°†æ¥æ”¶åˆ°çš„Webè¯·æ±‚é€šè¿‡ä»£ç†è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼Œç”±åç«¯æœåŠ¡å™¨è¿›è¡Œæ•°æ®å¤„ç†å’Œç»„ç»‡;</li><li>Nginxä¸ºäº†æé«˜å¯¹è¯·æ±‚çš„å“åº”æ•ˆç‡ï¼Œé™ä½ç½‘ç»œå‹åŠ›ï¼Œé‡‡ç”¨äº†ç¼“å­˜æœºåˆ¶ï¼Œå°†å†å²åº”ç­”æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°ã€‚ä¿éšœå¯¹ç¼“å­˜æ–‡ä»¶çš„å¿«é€Ÿè®¿é—®</li></ol><h2 id="è¿›ç¨‹æ¨¡å‹"><a href="#è¿›ç¨‹æ¨¡å‹" class="headerlink" title="è¿›ç¨‹æ¨¡å‹"></a>è¿›ç¨‹æ¨¡å‹</h2><p>nginxçš„è¿›ç¨‹æ¨¡å‹ï¼Œå¯ä»¥ç”±ä¸‹å›¾æ¥è¡¨ç¤ºï¼š</p><p><img src="https://cdn.learnku.com/uploads/images/201912/20/41489/gVfCciWSaq.png!large" alt="image"></p><h3 id="masterè¿›ç¨‹"><a href="#masterè¿›ç¨‹" class="headerlink" title="masterè¿›ç¨‹"></a>masterè¿›ç¨‹</h3><p>ä¸»è¦ç”¨æ¥ç®¡ç† worker è¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¼šæ¥æ”¶æ¥è‡ªå¤–ç•Œå‘æ¥çš„ä¿¡å·ï¼Œå†æ ¹æ®ä¿¡å·åšä¸åŒçš„äº‹æƒ…ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ§åˆ¶nginxï¼Œåªéœ€è¦é€šè¿‡killå‘masterè¿›ç¨‹å‘é€ä¿¡å·å°±è¡Œäº†ã€‚</p><p>å…·ä½“åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦åŠŸèƒ½:</p><ul><li>æ¥æ”¶æ¥è‡ªå¤–ç•Œçš„ä¿¡å·</li><li>å‘å„workerè¿›ç¨‹å‘é€ä¿¡å·</li><li>ç›‘æ§workerè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“workerè¿›ç¨‹é€€å‡ºå(å¼‚å¸¸æƒ…å†µä¸‹)ï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„workerè¿›ç¨‹</li></ul><h4 id="é‡å¯è¯´æ˜ï¼ˆç¤ºä¾‹ï¼‰"><a href="#é‡å¯è¯´æ˜ï¼ˆç¤ºä¾‹ï¼‰" class="headerlink" title="é‡å¯è¯´æ˜ï¼ˆç¤ºä¾‹ï¼‰"></a>é‡å¯è¯´æ˜ï¼ˆç¤ºä¾‹ï¼‰</h4><p>æ¯”å¦‚kill -HUP pidï¼Œåˆ™æ˜¯å‘Šè¯‰nginxï¼Œé‡å¯nginxï¼Œæ—©æœŸç‰ˆæœ¬å¯ä»¥ç”¨è¿™ä¸ªä¿¡å·æ¥é‡å¯nginxï¼Œå› ä¸ºæ˜¯ä»å®¹åœ°é‡å¯ï¼Œå› æ­¤æœåŠ¡æ˜¯ä¸ä¸­æ–­çš„ã€‚ï¼ˆç°åœ¨ä¸€èˆ¬ä½¿ç”¨<code>nginx -s reload</code>ï¼‰</p><p>masterè¿›ç¨‹åœ¨æ¥æ”¶åˆ°HUPä¿¡å·åï¼Œä¼šå…ˆé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œç„¶åå†å¯åŠ¨æ–°çš„workerè¿›ç¨‹ï¼Œå¹¶å‘æ‰€æœ‰è€çš„workerè¿›ç¨‹å‘é€ä¿¡å·ï¼Œå‘Šè¯‰ä»–ä»¬å¯ä»¥å…‰è£é€€ä¼‘äº†ã€‚æ–°çš„workeråœ¨å¯åŠ¨åï¼Œå°±å¼€å§‹æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œè€Œè€çš„workeråœ¨æ”¶åˆ°æ¥è‡ªmasterçš„ä¿¡å·åï¼Œå°±ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œå¹¶ä¸”åœ¨å½“å‰è¿›ç¨‹ä¸­çš„æ‰€æœ‰æœªå¤„ç†å®Œçš„è¯·æ±‚å¤„ç†å®Œæˆåï¼Œå†é€€å‡ºã€‚</p><blockquote><p>ï¼ˆmasterä¸éœ€è¦å¤„ç†ç½‘ç»œäº‹ä»¶ï¼Œä¸è´Ÿè´£ä¸šåŠ¡çš„æ‰§è¡Œï¼‰</p></blockquote><h3 id="workerè¿›ç¨‹"><a href="#workerè¿›ç¨‹" class="headerlink" title="workerè¿›ç¨‹"></a>workerè¿›ç¨‹</h3><p>ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆå…·ä½“çš„ä»»åŠ¡é€»è¾‘ã€‚å…¶ä¸»è¦å…³æ³¨ç‚¹æ˜¯ä¸å®¢æˆ·ç«¯æˆ–åç«¯çœŸå®æœåŠ¡å™¨(æ­¤æ—¶ worker ä½œä¸ºä¸­é—´ä»£ç†)ä¹‹é—´çš„æ•°æ®å¯è¯»/å¯å†™ç­‰I/Oäº¤äº’äº‹ä»¶ã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦åŠŸèƒ½:</p><ul><li>æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚;</li><li>å°†è¯·æ±‚ä¸€æ¬¡é€å…¥å„ä¸ªåŠŸèƒ½æ¨¡å—è¿›è¡Œè¿‡æ»¤å¤„ç†;</li><li>ä¸åç«¯æœåŠ¡å™¨é€šä¿¡ï¼Œæ¥æ”¶åç«¯æœåŠ¡å™¨å¤„ç†ç»“æœ;</li><li>æ•°æ®ç¼“å­˜proxy_cacheæ¨¡å—</li><li>å“åº”å®¢æˆ·ç«¯è¯·æ±‚</li></ul><p>ï¼ˆä¸€ä¸ªè¯·æ±‚ï¼Œå®Œå…¨ç”±workerè¿›ç¨‹æ¥å¤„ç†ï¼Œè€Œä¸”åªåœ¨ä¸€ä¸ªworkerè¿›ç¨‹ä¸­å¤„ç†ã€‚ï¼‰</p><h4 id="workerè¿›ç¨‹æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ"><a href="#workerè¿›ç¨‹æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ" class="headerlink" title="workerè¿›ç¨‹æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ"></a>workerè¿›ç¨‹æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿ</h4><p>é¦–å…ˆï¼Œworkerè¿›ç¨‹ä¹‹é—´æ˜¯å¹³ç­‰çš„ï¼Œæ¯ä¸ªworkerè¿›ç¨‹éƒ½æ˜¯ä»masterè¿›ç¨‹forkè¿‡æ¥ï¼Œåœ¨masterè¿›ç¨‹é‡Œé¢ï¼Œå…ˆå»ºç«‹å¥½éœ€è¦listençš„socketï¼ˆlistenfdï¼‰ä¹‹åï¼Œç„¶åå†forkå‡ºå¤šä¸ªworkerè¿›ç¨‹ã€‚æ¯ä¸ªworkerè¿›ç¨‹ï¼Œå¤„ç†è¯·æ±‚çš„æœºä¼šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å½“ä¸€ä¸ªè¿æ¥è¯·æ±‚è¿‡æ¥ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å¯èƒ½å¤„ç†è¿™ä¸ªè¿æ¥ï¼Œæ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p><p>æ‰€æœ‰workerè¿›ç¨‹çš„listenfdä¼šåœ¨æ–°è¿æ¥åˆ°æ¥æ—¶å˜å¾—å¯è¯»ï¼Œä¸ºä¿è¯åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„ç†è¯¥è¿æ¥ï¼Œæ‰€æœ‰workerè¿›ç¨‹åœ¨æ³¨å†Œlistenfdè¯»äº‹ä»¶å‰æŠ¢accept_mutexï¼ŒæŠ¢åˆ°<code>äº’æ–¥é”</code>çš„é‚£ä¸ªworkerè¿›ç¨‹æ³¨å†Œlistenfdè¯»äº‹ä»¶ï¼Œåœ¨è¯»äº‹ä»¶é‡Œè°ƒç”¨acceptæ¥å—è¯¥è¿æ¥ã€‚</p><p>å½“ä¸€ä¸ªworkerè¿›ç¨‹åœ¨acceptè¿™ä¸ªè¿æ¥ä¹‹åï¼Œå°±å¼€å§‹è¯»å–è¯·æ±‚ï¼Œè§£æè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚ï¼Œäº§ç”Ÿæ•°æ®åï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæœ€åæ–­å¼€è¿æ¥ï¼Œè¿™æ ·å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚å°±æ˜¯è¿™æ ·çš„äº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå®Œå…¨ç”±workerè¿›ç¨‹æ¥å¤„ç†ï¼Œä¸”åªåœ¨ä¸€ä¸ªworkerè¿›ç¨‹ä¸­å¤„ç†ã€‚</p><h3 id="Nginxé‡‡ç”¨çš„IOå¤šè·¯å¤ç”¨æ¨¡å‹"><a href="#Nginxé‡‡ç”¨çš„IOå¤šè·¯å¤ç”¨æ¨¡å‹" class="headerlink" title="Nginxé‡‡ç”¨çš„IOå¤šè·¯å¤ç”¨æ¨¡å‹"></a>Nginxé‡‡ç”¨çš„IOå¤šè·¯å¤ç”¨æ¨¡å‹</h3><blockquote><p>IOå¤šè·¯å¤ç”¨æ˜¯æŒ‡å†…æ ¸ä¸€æ—¦å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªIOæ¡ä»¶å‡†å¤‡è¯»å–ï¼Œå®ƒå°±é€šçŸ¥è¯¥è¿›ç¨‹ï¼Œç›®å‰æ”¯æŒI/Oå¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰ select ï¼Œ poll ï¼Œ epoll ï¼ŒI/Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦(socket)ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ª(ä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ª)ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯» å†™æ“ä½œã€‚</p></blockquote><h5 id="select"><a href="#select" class="headerlink" title="select"></a>select</h5><h6 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h6><p>select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsã€‚è°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p><h6 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h6><ul><li>ç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯æŒ</li></ul><h6 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h6><blockquote><p>selectæœ¬è´¨ä¸Šæ˜¯é€šè¿‡è®¾ç½®æˆ–è€…æ£€æŸ¥å­˜æ”¾fdæ ‡å¿—ä½çš„æ•°æ®ç»“æ„æ¥è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚è¿™æ ·æ‰€å¸¦æ¥çš„ç¼ºç‚¹æ˜¯ï¼š</p></blockquote><ul><li>selectæœ€å¤§çš„ç¼ºé™·å°±æ˜¯å•ä¸ªè¿›ç¨‹æ‰€æ‰“å¼€çš„FDæ˜¯æœ‰ä¸€å®šé™åˆ¶çš„ï¼Œå®ƒç”±FD_SETSIZEè®¾ç½®ï¼Œé»˜è®¤å€¼æ˜¯1024ã€‚ï¼ˆä¸€èˆ¬æ¥è¯´è¿™ä¸ªæ•°ç›®å’Œç³»ç»Ÿå†…å­˜å…³ç³»å¾ˆå¤§ï¼Œå…·ä½“æ•°ç›®å¯ä»¥cat /proc/sys/fs/file-maxæŸ¥çœ‹ã€‚32ä½æœºé»˜è®¤æ˜¯1024ä¸ªã€‚64ä½æœºé»˜è®¤æ˜¯2048ï¼‰</li><li>å¯¹socketè¿›è¡Œæ‰«ææ—¶æ˜¯çº¿æ€§æ‰«æï¼Œå³é‡‡ç”¨è½®è¯¢çš„æ–¹æ³•ï¼Œæ•ˆç‡è¾ƒä½ã€‚ï¼ˆå½“å¥—æ¥å­—æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ¯æ¬¡select()éƒ½è¦é€šè¿‡éå†FD_SETSIZEä¸ªSocketæ¥å®Œæˆè°ƒåº¦ï¼Œä¸ç®¡å“ªä¸ªSocketæ˜¯æ´»è·ƒçš„ï¼Œéƒ½éå†ä¸€éã€‚è¿™ä¼šæµªè´¹å¾ˆå¤šCPUæ—¶é—´ã€‚å¦‚æœèƒ½ç»™å¥—æ¥å­—æ³¨å†ŒæŸä¸ªå›è°ƒå‡½æ•°ï¼Œå½“ä»–ä»¬æ´»è·ƒæ—¶ï¼Œè‡ªåŠ¨å®Œæˆç›¸å…³æ“ä½œï¼Œé‚£å°±é¿å…äº†è½®è¯¢ï¼Œè¿™æ­£æ˜¯epollä¸kqueueåšçš„ï¼‰</li><li>éœ€è¦ç»´æŠ¤ä¸€ä¸ªç”¨æ¥å­˜æ”¾å¤§é‡fdçš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·ä¼šä½¿å¾—ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´åœ¨ä¼ é€’è¯¥ç»“æ„æ—¶å¤åˆ¶å¼€é”€å¤§ã€‚</li></ul><h5 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h5><h6 id="åŸºæœ¬åŸç†-1"><a href="#åŸºæœ¬åŸç†-1" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h6><p>pollæœ¬è´¨ä¸Šå’Œselectæ²¡æœ‰åŒºåˆ«ï¼Œå®ƒå°†ç”¨æˆ·ä¼ å…¥çš„æ•°ç»„æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œç„¶åæŸ¥è¯¢æ¯ä¸ªfdå¯¹åº”çš„è®¾å¤‡çŠ¶æ€ï¼Œå¦‚æœè®¾å¤‡å°±ç»ªåˆ™åœ¨è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€é¡¹å¹¶ç»§ç»­éå†ï¼Œå¦‚æœéå†å®Œæ‰€æœ‰fdåæ²¡æœ‰å‘ç°å°±ç»ªè®¾å¤‡ï¼Œåˆ™æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°è®¾å¤‡å°±ç»ªæˆ–è€…ä¸»åŠ¨è¶…æ—¶ï¼Œè¢«å”¤é†’åå®ƒåˆè¦å†æ¬¡éå†fdã€‚è¿™ä¸ªè¿‡ç¨‹ç»å†äº†å¤šæ¬¡æ— è°“çš„éå†ã€‚</p><h6 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h6><ul><li>å®ƒæ²¡æœ‰æœ€å¤§è¿æ¥æ•°çš„é™åˆ¶ï¼ŒåŸå› æ˜¯å®ƒæ˜¯åŸºäºé“¾è¡¨æ¥å­˜å‚¨çš„ã€‚</li></ul><h6 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h6><ul><li>å¤§é‡çš„fdçš„æ•°ç»„è¢«æ•´ä½“å¤åˆ¶äºç”¨æˆ·æ€å’Œå†…æ ¸åœ°å€ç©ºé—´ä¹‹é—´ï¼Œè€Œä¸ç®¡è¿™æ ·çš„å¤åˆ¶æ˜¯ä¸æ˜¯æœ‰æ„ä¹‰ã€‚</li><li>pollè¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯â€œæ°´å¹³è§¦å‘â€ï¼Œå¦‚æœæŠ¥å‘Šäº†fdåï¼Œæ²¡æœ‰è¢«å¤„ç†ï¼Œé‚£ä¹ˆä¸‹æ¬¡pollæ—¶ä¼šå†æ¬¡æŠ¥å‘Šè¯¥fdã€‚</li></ul><p>æ³¨æ„ï¼šä»ä¸Šé¢çœ‹ï¼Œselectå’Œpolléƒ½éœ€è¦åœ¨è¿”å›åï¼Œé€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å–å·²ç»å°±ç»ªçš„socketã€‚äº‹å®ä¸Šï¼ŒåŒæ—¶è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢é•¿ï¼Œå…¶æ•ˆç‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™ã€‚</p><h5 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h5><p>epollæ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„selectå’Œpollçš„å¢å¼ºç‰ˆæœ¬ã€‚ç›¸å¯¹äºselectå’Œpollæ¥è¯´ï¼Œepollæ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epollä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³ç³»çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyåªéœ€ä¸€æ¬¡ã€‚</p><h6 id="åŸºæœ¬åŸç†-2"><a href="#åŸºæœ¬åŸç†-2" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h6><p>epollæ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºè¾¹ç¼˜è§¦å‘ï¼Œå®ƒåªå‘Šè¯‰è¿›ç¨‹å“ªäº›fdåˆšåˆšå˜ä¸ºå°±ç»ªæ€ï¼Œå¹¶ä¸”åªä¼šé€šçŸ¥ä¸€æ¬¡ã€‚è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œepollä½¿ç”¨â€œäº‹ä»¶â€çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡epoll_ctlæ³¨å†Œfdï¼Œä¸€æ—¦è¯¥fdå°±ç»ªï¼Œå†…æ ¸å°±ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›è°ƒæœºåˆ¶æ¥æ¿€æ´»è¯¥fdï¼Œepoll_waitä¾¿å¯ä»¥æ”¶åˆ°é€šçŸ¥ã€‚</p><h6 id="epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼"><a href="#epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼" class="headerlink" title="epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼"></a>epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼</h6><p>LTï¼ˆlevel triggerï¼‰å’ŒETï¼ˆedge triggerï¼‰ã€‚LTæ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ï¼Œä¸¤è€…åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>LTæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚</li><li>ETæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚</li></ul><h6 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h6><ul><li>æ²¡æœ‰æœ€å¤§å¹¶å‘è¿æ¥çš„é™åˆ¶ï¼Œèƒ½æ‰“å¼€çš„FDçš„ä¸Šé™è¿œå¤§äº1024ï¼ˆ1Gçš„å†…å­˜ä¸Šèƒ½ç›‘å¬çº¦10ä¸‡ä¸ªç«¯å£ï¼‰ã€‚</li><li>æ•ˆç‡æå‡ï¼Œä¸æ˜¯è½®è¯¢çš„æ–¹å¼ï¼Œä¸ä¼šéšç€FDæ•°ç›®çš„å¢åŠ æ•ˆç‡ä¸‹é™ã€‚<br>ã€€ã€€åªæœ‰æ´»è·ƒå¯ç”¨çš„FDæ‰ä¼šè°ƒç”¨callbackå‡½æ•°ï¼›å³Epollæœ€å¤§çš„ä¼˜ç‚¹å°±åœ¨äºå®ƒåªç®¡ä½ â€œæ´»è·ƒâ€çš„è¿æ¥ï¼Œè€Œè·Ÿè¿æ¥æ€»æ•°æ— å…³ï¼Œå› æ­¤åœ¨å®é™…çš„ç½‘ç»œç¯å¢ƒä¸­ï¼ŒEpollçš„æ•ˆç‡å°±ä¼šè¿œè¿œé«˜äºselectå’Œpollã€‚</li><li>å†…å­˜æ‹·è´ï¼Œåˆ©ç”¨mmap()æ–‡ä»¶æ˜ å°„å†…å­˜åŠ é€Ÿä¸å†…æ ¸ç©ºé—´çš„æ¶ˆæ¯ä¼ é€’ï¼›å³epollä½¿ç”¨mmapå‡å°‘å¤åˆ¶å¼€é”€ã€‚</li></ul><h5 id="kqueue"><a href="#kqueue" class="headerlink" title="kqueue"></a>kqueue</h5><p>kqueueä¸epolléå¸¸ç›¸ä¼¼ï¼Œæœ€åˆæ˜¯2000å¹´Jonathan Lemonåœ¨FreeBSDç³»ç»Ÿä¸Šå¼€å‘çš„ä¸€ä¸ªé«˜æ€§èƒ½çš„äº‹ä»¶é€šçŸ¥æ¥å£ã€‚æ³¨å†Œä¸€æ‰¹socketæè¿°ç¬¦åˆ° kqueue ä»¥åï¼Œå½“å…¶ä¸­çš„æè¿°ç¬¦çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œkqueue å°†ä¸€æ¬¡æ€§é€šçŸ¥åº”ç”¨ç¨‹åºå“ªäº›æè¿°ç¬¦å¯è¯»ã€å¯å†™æˆ–å‡ºé”™äº†ã€‚åªæ˜¯é€‚åº”å¹³å°ä¸å¤šã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/jeakeven/p/5435916.html">ç½‘ç»œé€šä¿¡ â€“&gt; IOå¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epollè¯¦è§£</a></li><li><a href="http://tengine.taobao.org/book/chapter_02.html#id1">nginxå¹³å°åˆæ¢</a></li></ul><blockquote><p> è¿™åº”è¯¥æ˜¯Nginxç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« äº†ï¼Œå¦‚æœä½ æœ‰ç–‘é—®ï¼Œæ¬¢è¿äº¤æµï¼Œæ°´å¹³æœ‰é™ï¼Œé”™è¯¯æ¬¢è¿æŒ‡æ­£ã€‚</p></blockquote><hr><p>æŠ€æœ¯æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨è‡ªå·±çš„å…¬ä¼—å·ã€çˆ±å¥½å†å²çš„ç¨‹åºå‘˜ã€‘ï¼Œæ¬¢è¿æ‰«ç å…³æ³¨ï¼Œè°¢è°¢ï¼</p><p><img src="https://upload-images.jianshu.io/upload_images/8857285-075d6cd5c9d002b6.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="çˆ±å¥½å†å²çš„ç¨‹åºå‘˜"></p>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gRPCåˆä½“éªŒ</title>
    <link href="/2019/12/20/215/"/>
    <url>/2019/12/20/215/</url>
    
    <content type="html"><![CDATA[<blockquote><p>gRPCæ˜¯å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œçš„ç°ä»£å¼€æºé«˜æ€§èƒ½RPCæ¡†æ¶ã€‚å®ƒå¯ä»¥é€šè¿‡å¯æ’æ‹”çš„æ”¯æŒæ¥æœ‰æ•ˆåœ°è¿æ¥æ•°æ®ä¸­å¿ƒå†…å’Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ï¼Œä»¥å®ç°è´Ÿè½½å¹³è¡¡ï¼Œè·Ÿè¸ªï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥å’Œèº«ä»½éªŒè¯ã€‚å®ƒä¹Ÿé€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„æœ€åä¸€è‹±é‡Œï¼Œä»¥å°†è®¾å¤‡ï¼Œç§»åŠ¨åº”ç”¨ç¨‹åºå’Œæµè§ˆå™¨è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚</p></blockquote><h2 id="å®‰è£…protocol-buffer-ç¼–è¯‘å™¨"><a href="#å®‰è£…protocol-buffer-ç¼–è¯‘å™¨" class="headerlink" title="å®‰è£…protocol buffer ç¼–è¯‘å™¨"></a>å®‰è£…protocol buffer ç¼–è¯‘å™¨</h2><p>macï¼š</p><div class="code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-keyword">brew </span><span class="hljs-keyword">install </span>protobuf</code></pre></div><p>å…¶ä»–ç³»ç»Ÿå¯ä»¥å°è¯•ç¼–è¯‘å®‰è£…</p><ul><li><a href="https://github.com/protocolbuffers/protobuf">protocolbuffers/protobuf</a></li></ul><h2 id="å®‰è£…gprc"><a href="#å®‰è£…gprc" class="headerlink" title="å®‰è£…gprc"></a>å®‰è£…gprc</h2><div class="code-wrapper"><pre><code class="hljs maxima"><span class="hljs-built_in">go</span> <span class="hljs-built_in">get</span> -u google.golang.org/grpc</code></pre></div><h2 id="å®‰è£…protoc-gen-goæ’ä»¶"><a href="#å®‰è£…protoc-gen-goæ’ä»¶" class="headerlink" title="å®‰è£…protoc-gen-goæ’ä»¶"></a>å®‰è£…protoc-gen-goæ’ä»¶</h2><div class="code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">go</span> <span class="hljs-built_in">get</span> -<span class="hljs-keyword">u</span> github.<span class="hljs-keyword">com</span>/golang/protobuf/protoc-gen-<span class="hljs-keyword">go</span></code></pre></div><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æ–°å»ºhelloç›®å½•ï¼Œè¿›å…¥åæ‰§è¡Œï¼š</p><div class="code-wrapper"><pre><code class="hljs brainfuck"><span class="hljs-comment">protoc</span> --<span class="hljs-comment">proto_path</span> <span class="hljs-comment">hello/</span> --<span class="hljs-comment">go_out=plugins=grpc:hello</span> <span class="hljs-comment">hello</span><span class="hljs-string">.</span><span class="hljs-comment">proto</span></code></pre></div><p>ä¼šçœ‹åˆ°helloç›®å½•ä¸‹ç”Ÿæˆäº†hello.pb.goæ–‡ä»¶ã€‚</p><p>å½“ç„¶ï¼Œå…¶ä¸­çš„ <code>hello.proto</code> æ˜¯é¢„å…ˆè‡ªå®šä¹‰åœ¨helloæ–‡ä»¶å¤¹ä¸‹çš„ï¼Œå¦‚ï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;  <span class="hljs-regexp">//</span>è¯­æ³•å£°æ˜package hello; <span class="hljs-regexp">//</span>åŒ…å<span class="hljs-regexp">//</span> å®šä¹‰æœåŠ¡service Greeter &#123;  rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;&#125;<span class="hljs-regexp">//</span> è¯·æ±‚æ•°æ®æ ¼å¼message HelloRequest &#123;  string name = <span class="hljs-number">1</span>;&#125;<span class="hljs-regexp">//</span> å“åº”æ•°æ®æ ¼å¼message HelloReply &#123;  string message = <span class="hljs-number">1</span>;&#125;</code></pre></div><h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><p>æ–°å»ºserverç›®å½•ï¼Œ<br>golangä¾‹å­ä»£ç æ¥è‡ªï¼š<a href="https://github.com/grpc/grpc-go/tree/master/examples/helloworld">https://github.com/grpc/grpc-go/tree/master/examples/helloworld</a></p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// main.go</span><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;log&quot;</span><span class="hljs-string">&quot;net&quot;</span><span class="hljs-string">&quot;google.golang.org/grpc&quot;</span>pb <span class="hljs-string">&quot;local.com/sai/game/grpc/hello&quot;</span>)<span class="hljs-keyword">const</span> (port = <span class="hljs-string">&quot;:50051&quot;</span>)<span class="hljs-comment">// server is used to implement helloworld.GreeterServer.</span><span class="hljs-keyword">type</span> server <span class="hljs-keyword">struct</span> &#123;pb.UnimplementedGreeterServer&#125;<span class="hljs-comment">// SayHello implements helloworld.GreeterServer</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *server)</span> <span class="hljs-title">SayHello</span><span class="hljs-params">(ctx context.Context, in *pb.HelloRequest)</span> <span class="hljs-params">(*pb.HelloReply, error)</span></span> &#123;log.Printf(<span class="hljs-string">&quot;Received: %v&quot;</span>, in.GetName())<span class="hljs-keyword">return</span> &amp;pb.HelloReply&#123;Message: <span class="hljs-string">&quot;Hello &quot;</span> + in.GetName()&#125;, <span class="hljs-literal">nil</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;lis, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, port)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatalf(<span class="hljs-string">&quot;failed to listen: %v&quot;</span>, err)&#125;s := grpc.NewServer()pb.RegisterGreeterServer(s, &amp;server&#123;&#125;)<span class="hljs-keyword">if</span> err := s.Serve(lis); err != <span class="hljs-literal">nil</span> &#123;log.Fatalf(<span class="hljs-string">&quot;failed to serve: %v&quot;</span>, err)&#125;&#125;</code></pre></div><h2 id="client"><a href="#client" class="headerlink" title="client"></a>client</h2><h3 id="go-client"><a href="#go-client" class="headerlink" title="go client"></a>go client</h3><div class="code-wrapper"><pre><code class="hljs stylus"><span class="hljs-comment">// client.go</span>package <span class="hljs-selector-tag">main</span>import (<span class="hljs-string">&quot;context&quot;</span><span class="hljs-string">&quot;log&quot;</span><span class="hljs-string">&quot;os&quot;</span><span class="hljs-string">&quot;time&quot;</span><span class="hljs-string">&quot;google.golang.org/grpc&quot;</span>pb <span class="hljs-string">&quot;local.com/sai/game/grpc/hello&quot;</span>)const (<span class="hljs-selector-tag">address</span>     = <span class="hljs-string">&quot;127.0.0.1:50051&quot;</span>defaultName = <span class="hljs-string">&quot;13sai&quot;</span>)func <span class="hljs-selector-tag">main</span>() &#123;<span class="hljs-comment">// Set up a connection to the server.</span>conn, err := grpc<span class="hljs-selector-class">.Dial</span>(<span class="hljs-selector-tag">address</span>, grpc<span class="hljs-selector-class">.WithInsecure</span>(), grpc<span class="hljs-selector-class">.WithBlock</span>())<span class="hljs-keyword">if</span> err != nil &#123;log<span class="hljs-selector-class">.Fatalf</span>(<span class="hljs-string">&quot;did not connect: %v&quot;</span>, err)&#125;defer conn<span class="hljs-selector-class">.Close</span>()c := pb<span class="hljs-selector-class">.NewGreeterClient</span>(conn)<span class="hljs-comment">// Contact the server and print out its response.</span>name := defaultName<span class="hljs-keyword">if</span> len(os.Args) &gt; <span class="hljs-number">1</span> &#123;name = os<span class="hljs-selector-class">.Args</span><span class="hljs-selector-attr">[1]</span>&#125;ctx, cancel := context<span class="hljs-selector-class">.WithTimeout</span>(context<span class="hljs-selector-class">.Background</span>(), <span class="hljs-selector-tag">time</span>.Second)defer cancel()r, err := c<span class="hljs-selector-class">.SayHello</span>(ctx, &amp;pb.HelloRequest&#123;Name: name&#125;)<span class="hljs-keyword">if</span> err != nil &#123;log<span class="hljs-selector-class">.Fatalf</span>(<span class="hljs-string">&quot;could not greet: %v&quot;</span>, err)&#125;log<span class="hljs-selector-class">.Printf</span>(<span class="hljs-string">&quot;Greeting: %s&quot;</span>, r<span class="hljs-selector-class">.GetMessage</span>())&#125;`</code></pre></div><h3 id="php-client"><a href="#php-client" class="headerlink" title="php client"></a>php client</h3><h4 id="æ‰©å±•å®‰è£…"><a href="#æ‰©å±•å®‰è£…" class="headerlink" title="æ‰©å±•å®‰è£…"></a>æ‰©å±•å®‰è£…</h4><ul><li><a href="http://pecl.php.net/package/gRPC">grpcæ‰©å±•ä¸‹è½½</a></li><li><a href="http://pecl.php.net/package/protobuf">profo</a></li></ul><p>ä¸‹è½½å®‰è£…åˆé€‚ç‰ˆæœ¬çš„æ‰©å±•å³å¯ï¼Œè®°å¾—åˆ«å¿˜è®°åœ¨php.iniä¸­åŠ å…¥ï¼š</p><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">extension</span>=grpc.so<span class="hljs-attr">extension</span>=protobuf.so</code></pre></div><h4 id="è‡ªåŠ¨ç”Ÿæˆä»£ç "><a href="#è‡ªåŠ¨ç”Ÿæˆä»£ç " class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆä»£ç "></a>è‡ªåŠ¨ç”Ÿæˆä»£ç </h4><div class="code-wrapper"><pre><code class="hljs routeros">protoc <span class="hljs-attribute">--php_out</span>=client hello/hello.proto</code></pre></div><p>ä¼šçœ‹åˆ°clientç›®å½•ä¸‹ç”Ÿæˆäº†GPBMetadataå’ŒHelloä¸¤ä¸ªç›®å½•ã€‚</p><p>å¦‚æœä½ å¯¹grpcç›¸å¯¹è¾ƒç†Ÿç»ƒï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä»£ç ç¼–å†™ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/vendor/autoload.php&#x27;</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> <span class="hljs-keyword">extends</span> \<span class="hljs-title">Grpc</span>\<span class="hljs-title">BaseStub</span></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$hostname</span>, <span class="hljs-variable">$opts</span>, <span class="hljs-variable">$channel</span> = <span class="hljs-literal">null</span></span>) </span>&#123;        <span class="hljs-built_in">parent</span>::__construct(<span class="hljs-variable">$hostname</span>, <span class="hljs-variable">$opts</span>, <span class="hljs-variable">$channel</span>);    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * rpc SayHello(HelloRequest) returns (HelloReply) &#123;&#125;</span><span class="hljs-comment">     * æ–¹æ³•åå°½é‡å’Œ (gprc å®šä¹‰ Greeter æœåŠ¡)çš„æ–¹æ³•ä¸€æ ·</span><span class="hljs-comment">     * ç”¨äºè¯·æ±‚å’Œå“åº”è¯¥æœåŠ¡</span><span class="hljs-comment">     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SayHello</span>(<span class="hljs-params">\Hello\HelloRequest <span class="hljs-variable">$argument</span></span>)</span>&#123;        <span class="hljs-comment">// (/hello.Greeter/SayHello) æ˜¯è¯·æ±‚æœåŠ¡ç«¯é‚£ä¸ªæœåŠ¡å’Œæ–¹æ³•ï¼ŒåŸºæœ¬å’Œ proto æ–‡ä»¶å®šä¹‰ä¸€æ ·</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;_simpleRequest(<span class="hljs-string">&#x27;/hello.Greeter/SayHello&#x27;</span>,            <span class="hljs-variable">$argument</span>,            [<span class="hljs-string">&#x27;\Hello\HelloReply&#x27;</span>, <span class="hljs-string">&#x27;decode&#x27;</span>]            );    &#125;&#125;<span class="hljs-comment">//ç”¨äºè¿æ¥ æœåŠ¡ç«¯</span><span class="hljs-variable">$client</span> = <span class="hljs-keyword">new</span> \Client(<span class="hljs-string">&#x27;127.0.0.1:50051&#x27;</span>, [    <span class="hljs-string">&#x27;credentials&#x27;</span> =&gt; Grpc\ChannelCredentials::createInsecure()]);<span class="hljs-comment">//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»</span><span class="hljs-variable">$request</span> = <span class="hljs-keyword">new</span> \Hello\HelloRequest();<span class="hljs-variable">$request</span>-&gt;setName(<span class="hljs-string">&quot;fairy&quot;</span>);<span class="hljs-comment">//è°ƒç”¨è¿œç¨‹æœåŠ¡</span><span class="hljs-variable">$get</span> = <span class="hljs-variable">$client</span>-&gt;SayHello(<span class="hljs-variable">$request</span>)-&gt;wait();<span class="hljs-comment">//è¿”å›æ•°ç»„</span><span class="hljs-comment">//$reply æ˜¯ TestReply å¯¹è±¡</span><span class="hljs-comment">//$status æ˜¯æ•°ç»„</span><span class="hljs-keyword">list</span>(<span class="hljs-variable">$reply</span>, <span class="hljs-variable">$status</span>) = <span class="hljs-variable">$get</span>;<span class="hljs-keyword">echo</span> <span class="hljs-variable">$reply</span>-&gt;getMessage().PHP_EOL;<span class="hljs-comment">// print_r($client-&gt;SayHello($request));</span></code></pre></div><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨grpc_php_pluginæ’ä»¶ç”Ÿæˆã€‚</p><ul><li><a href="https://github.com/grpc/grpc/tree/master/src/php">grpc-php</a></li><li></li></ul><h4 id="grpc-php-pluginæ’ä»¶"><a href="#grpc-php-pluginæ’ä»¶" class="headerlink" title="grpc_php_pluginæ’ä»¶"></a>grpc_php_pluginæ’ä»¶</h4><p><a href="https://gitee.com/mirrors/grpc.git">cloneå¤ªæ…¢å¯ä»¥ä½¿ç”¨ç äº‘</a></p><div class="code-wrapper"><pre><code class="hljs reasonml">git clone -b <span class="hljs-constructor">$(<span class="hljs-params">curl</span> -L <span class="hljs-params">https</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">grpc</span>.<span class="hljs-params">io</span><span class="hljs-operator">/</span><span class="hljs-params">release</span>)</span> https:<span class="hljs-comment">//github.com/grpc/grpc</span>cd grpc#è¿™ä¸€æ­¥å¾ˆæ…¢ï¼Œæš‚æœªæ‰¾åˆ°ä»€ä¹ˆå¥½æ–¹æ³•git submodule update --initmake grpc_php_plugin</code></pre></div><p>æ–°å»ºphp-clientï¼Œå†æ¥è‡ªåŠ¨ç”Ÿæˆï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">protoc -I=.<span class="hljs-regexp">/hello hello.proto --php_out=./</span>php-client<span class="hljs-regexp">/ --grpc_out=php-client/</span> --plugin=protoc-gen-grpc=<span class="hljs-regexp">/Users/</span>wangzetao<span class="hljs-regexp">/www/g</span>rpc1<span class="hljs-regexp">/bins/</span>opt/grpc_php_plugin</code></pre></div><p>ä¼šå‘ç°æ¯”ä¸Šé¢è‡ªåŠ¨ç”Ÿæˆå¤šäº†ä¸€ä¸ªGreeterClient.php</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">// client.php</span><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/vendor/autoload.php&#x27;</span>;<span class="hljs-comment">//ç”¨äºè¿æ¥ æœåŠ¡ç«¯</span><span class="hljs-variable">$client</span> = <span class="hljs-keyword">new</span> \Hello\GreeterClient(<span class="hljs-string">&#x27;127.0.0.1:50051&#x27;</span>, [    <span class="hljs-string">&#x27;credentials&#x27;</span> =&gt; Grpc\ChannelCredentials::createInsecure()]);<span class="hljs-comment">//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»</span><span class="hljs-variable">$request</span> = <span class="hljs-keyword">new</span> \Hello\HelloRequest();<span class="hljs-variable">$request</span>-&gt;setName(<span class="hljs-string">&quot;world&quot;</span>);<span class="hljs-comment">//è°ƒç”¨è¿œç¨‹æœåŠ¡</span><span class="hljs-variable">$get</span> = <span class="hljs-variable">$client</span>-&gt;SayHello(<span class="hljs-variable">$request</span>)-&gt;wait();<span class="hljs-comment">//è¿”å›æ•°ç»„</span><span class="hljs-comment">//$status æ˜¯æ•°ç»„</span><span class="hljs-keyword">list</span>(<span class="hljs-variable">$reply</span>, <span class="hljs-variable">$status</span>) = <span class="hljs-variable">$get</span>;<span class="hljs-keyword">echo</span> <span class="hljs-variable">$reply</span>-&gt;getMessage().PHP_EOL;<span class="hljs-comment">// print_r($client-&gt;SayHello($request));</span></code></pre></div><h2 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h2><blockquote><p>go run grpc/server/main.go</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/201912/19/41489/lqX1HT2biY.jpg!large" alt="grpc"></p><blockquote><p>go run grpc/client/main.go</p><p>go run grpc/client/client.php</p><p>go run grpc/client/php-client.php</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/201912/19/41489/TwzBk5D5gU.jpg!large" alt="grpc"></p><p>grpcåˆä½“éªŒå®Œæˆäº†ï¼Œæœ¬æ¬¡åªæ˜¯å°å°çš„ä½¿ç”¨äº†ä¸€ä¸‹å­ï¼Œåç»­æ„Ÿå…´è¶£çš„è¯å¯ä»¥æ·±å…¥å­¦ä¹ ä¸€ä¸‹ã€‚æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºäº¤æµã€‚</p><hr><p>æŠ€æœ¯æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨è‡ªå·±çš„å…¬ä¼—å·ã€çˆ±å¥½å†å²çš„ç¨‹åºå‘˜ã€‘ï¼Œæ¬¢è¿æ‰«ç å…³æ³¨ï¼Œè°¢è°¢ï¼</p><p><img src="https://upload-images.jianshu.io/upload_images/8857285-075d6cd5c9d002b6.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="çˆ±å¥½å†å²çš„ç¨‹åºå‘˜"></p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gRPC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®‰è£…gogs</title>
    <link href="/2019/12/08/214/"/>
    <url>/2019/12/08/214/</url>
    
    <content type="html"><![CDATA[<blockquote><p>docker pull gogs/gogs</p></blockquote><blockquote><p>docker run -itd â€“name=gogs1 -p 10022:22 -p 10023:3000  gogs/gogs</p></blockquote><p>æµè§ˆå™¨è¾“å…¥<a href="http://127.0.0.1:10023/">http://127.0.0.1:10023/</a></p><p><img src="/img/gogs-install.jpg" alt="é¢æ¿"></p><p>ä¸»è¦ä¿®æ”¹çš„å‚æ•°æ˜¯</p><ul><li>åº”ç”¨ URL</li><li>æ•°æ®åº“ç”¨æˆ·å¯†ç </li><li>ç®¡ç†å‘˜ä¿¡æ¯</li></ul><p>å¦‚æœä½ æœ‰å…¶ä»–ä¿®æ”¹ï¼Œè‡ªè¡Œä¿®æ”¹å³å¯ã€‚</p><p>ç‚¹å‡»ç«‹å³å®‰è£…æŒ‰é’®ï¼ŒæŒ‰ç†è¯´ä¼šè·³åˆ°3000ç«¯å£åœ°å€ï¼Œä½ æ¢æˆ10023å°±å¥½äº†ã€‚</p><p><img src="/img/gogs-login.jpg" alt="ç™»å½•"></p><p>ç„¶åä½ å°±å¯ä»¥è‡ªè¡Œåˆ›å»ºï¼Œå¼€å§‹gogsä¹‹æ—…äº†ã€‚</p><p><img src="/img/gogs-project" alt="project"></p><blockquote><p>å¦å¤–ï¼Œé…ç½®æ–‡ä»¶åœ¨å®¹å™¨çš„/data/gogs/conf/app.iniã€‚</p></blockquote><h1 id="è¯¦ç»†é…ç½®æ–‡ä»¶æ‰‹å†Œï¼ˆæ¥è‡ªgithubï¼‰"><a href="#è¯¦ç»†é…ç½®æ–‡ä»¶æ‰‹å†Œï¼ˆæ¥è‡ªgithubï¼‰" class="headerlink" title="è¯¦ç»†é…ç½®æ–‡ä»¶æ‰‹å†Œï¼ˆæ¥è‡ªgithubï¼‰"></a>è¯¦ç»†é…ç½®æ–‡ä»¶æ‰‹å†Œï¼ˆæ¥è‡ªgithubï¼‰</h1><h3 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>APP_NAME</code></td><td>åº”ç”¨åç§°ï¼Œå¯ä»¥æ”¹æˆæ‚¨çš„ç»„ç»‡æˆ–å…¬å¸åç§°</td></tr><tr><td><code>RUN_USER</code></td><td>è¿è¡Œåº”ç”¨çš„ç”¨æˆ·åç§°ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ <code>git</code>ï¼Œä½†å¦‚æœæ‚¨åœ¨ä¸ªäººè®¡ç®—æœºä¸Šè¿è¡Œ Gogsï¼Œè¯·ä¿®æ”¹ä¸ºæ‚¨çš„ç³»ç»Ÿç”¨æˆ·åç§°ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®è®¾ç½®è¿™ä¸ªå€¼ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æ‚¨çš„åº”ç”¨å´©æºƒ</td></tr><tr><td><code>RUN_MODE</code></td><td>é‰´äºæ€§èƒ½å’Œå…¶å®ƒè€ƒè™‘ï¼Œå»ºè®®åœ¨éƒ¨ç½²ç¯å¢ƒä¸‹ä¿®æ”¹ä¸º <code>prod</code> æ¨¡å¼ã€‚åœ¨æ‚¨å®Œæˆå®‰è£…æ“ä½œæ—¶ï¼Œè¯¥å€¼ä¹Ÿä¼šè¢«è®¾ç½®ä¸º <code>prod</code></td></tr></tbody></table><h3 id="æœåŠ¡å™¨-server"><a href="#æœåŠ¡å™¨-server" class="headerlink" title="æœåŠ¡å™¨ (server)"></a>æœåŠ¡å™¨ (<code>server</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>PROTOCOL</code></td><td><code>http</code> æˆ– <code>https</code></td></tr><tr><td><code>DOMAIN</code></td><td>æœåŠ¡å™¨åŸŸå</td></tr><tr><td><code>ROOT_URL</code></td><td>å…¬å¼€çš„å®Œæ•´ URL è·¯å¾„</td></tr><tr><td><code>HTTP_ADDR</code></td><td>åº”ç”¨ HTTP ç›‘å¬åœ°å€</td></tr><tr><td><code>HTTP_PORT</code></td><td>åº”ç”¨ HTTP ç›‘å¬ç«¯å£å·</td></tr><tr><td><code>UNIX_SOCKET_PERMISSION</code></td><td>Unix å¥—æ¥å­—æ–‡ä»¶çš„æƒé™</td></tr><tr><td><code>LOCAL_ROOT_URL</code></td><td>ç”¨äº Gogs å·¥ä½œè¿›ç¨‹ï¼ˆå¦‚ï¼šSSHï¼‰å›è®¿åº”ç”¨çš„æœ¬åœ°ï¼ˆDMZï¼‰URLï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¯·ä¿æŒé»˜è®¤å€¼ï¼Œé™¤éæ‚¨çš„ SSH æœåŠ¡å™¨èŠ‚ç‚¹ä¸ HTTP å¹¶ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹å…¥å£</td></tr><tr><td><code>DISABLE_SSH</code></td><td>å½“ SSH åŠŸèƒ½ä¸å¯ç”¨æ—¶å¯ä»¥ç¦ç”¨</td></tr><tr><td><code>START_SSH_SERVER</code></td><td>å¯ç”¨è¯¥é€‰é¡¹æ¥å¯åŠ¨å†…ç½® SSH æœåŠ¡å™¨</td></tr><tr><td><code>SSH_DOMAIN</code></td><td>å…è®¸å…¬ç”¨ç½‘ç»œè®¿é—® SSH çš„åŸŸå</td></tr><tr><td><code>SSH_PORT</code></td><td>SSH ç«¯å£å·ï¼Œå¦‚æœä¸ä¸º <code>22</code> çš„è¯å¯ä»¥åœ¨æ­¤ä¿®æ”¹</td></tr><tr><td><code>SSH_LISTEN_HOST</code></td><td>å†…ç½® SSH æœåŠ¡å™¨ç›‘å¬çš„åœ°å€</td></tr><tr><td><code>SSH_LISTEN_PORT</code></td><td>å†…ç½® SSH æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£</td></tr><tr><td><code>SSH_ROOT_PATH</code></td><td>SSH æ ¹ç›®å½•ï¼Œä¸€èˆ¬ä¸º <code>~/.ssh</code>ï¼Œä½†å¿…é¡»å¡«å†™ä¸º <code>/home/git/.ssh</code></td></tr><tr><td><code>REWRITE_AUTHORIZED_KEYS_AT_START</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨é‡å†™ <code>authorized_keys</code> æ–‡ä»¶ï¼Œè¯¥é€‰é¡¹åœ¨ä½¿ç”¨å†…ç½® SSH æœåŠ¡å™¨æ—¶å°†ä¼šè¢«è‡ªåŠ¨ç¦ç”¨</td></tr><tr><td><code>SSH_KEY_TEST_PATH</code></td><td>ç”¨äºæµ‹è¯• SSH å…¬é’¥çš„ä¸´æ—¶ç›®å½•</td></tr><tr><td><code>SSH_KEYGEN_PATH</code></td><td><code>ssh-keygen</code> ç¨‹åºçš„è·¯å¾„ï¼Œé»˜è®¤ä¸º <code>ssh-keygen</code> å³é€šè¿‡ç³»ç»Ÿè·¯å¾„æŸ¥æ‰¾</td></tr><tr><td><code>MINIMUM_KEY_SIZE_CHECK</code></td><td>æŒ‡å®šä¸åŒç±»å‹çš„å…¬é’¥çš„æœ€å°å¯†é’¥å¤§å°</td></tr><tr><td><code>OFFLINE_MODE</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢ä» CDN è·å–é™æ€èµ„æºï¼ŒåŒæ—¶ Gravatar æœåŠ¡ä¹Ÿå°†è¢«è‡ªåŠ¨ç¦ç”¨</td></tr><tr><td><code>DISABLE_ROUTER_LOG</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢æ‰“å°è·¯ç”±æ—¥å¿—</td></tr><tr><td><code>CERT_FILE</code></td><td>HTTPS æˆæƒæ–‡ä»¶è·¯å¾„</td></tr><tr><td><code>KEY_FILE</code></td><td>HTTPS çš„å¯†é’¥æ–‡ä»¶è·¯å¾„</td></tr><tr><td><code>STATIC_ROOT_PATH</code></td><td>æ¨¡æ¿æ–‡ä»¶å’Œé™æ€æ–‡ä»¶çš„ä¸Šçº§ç›®å½•ï¼Œé»˜è®¤ä¸ºåº”ç”¨äºŒè¿›åˆ¶æ‰€åœ¨çš„ä½ç½®</td></tr><tr><td><code>APP_DATA_PATH</code></td><td>åº”ç”¨å†…éƒ¨æ•°æ®çš„å­˜æ”¾ç›®å½•</td></tr><tr><td><code>ENABLE_GZIP</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨åº”ç”¨çº§åˆ« GZIP æ”¯æŒ</td></tr><tr><td><code>LANDING_PAGE</code></td><td>æœªç™»å½•ç”¨æˆ·çš„é»˜è®¤é¦–é¡µï¼Œå¯ä»¥æ˜¯ <code>home</code> æˆ– <code>explore</code>ï¼ˆæ¢ç´¢é¡µï¼‰</td></tr></tbody></table><h3 id="ä»“åº“-repository"><a href="#ä»“åº“-repository" class="headerlink" title="ä»“åº“ (repository)"></a>ä»“åº“ (<code>repository</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ROOT</code></td><td>ç”¨æˆ·ä»“åº“å­˜å‚¨æ ¹ç›®å½•ï¼Œå¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼Œé»˜è®¤ä¸º <code>~/&lt;user name&gt;/gogs-repositories</code></td></tr><tr><td><code>SCRIPT_TYPE</code></td><td>ç³»ç»Ÿè„šæœ¬ç±»å‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å‡ä¸º <code>bash</code>ï¼Œä½†æœ‰äº›ç”¨æˆ·ååº”åªèƒ½ä½¿ç”¨ <code>sh</code></td></tr><tr><td><code>ANSI_CHARSET</code></td><td>å½“é‡åˆ°æ— æ³•è¯†åˆ«çš„å­—ç¬¦é›†æ—¶ä½¿ç”¨çš„é»˜è®¤å­—ç¬¦é›†</td></tr><tr><td><code>FORCE_PRIVATE</code></td><td>å¼ºåˆ¶è¦æ±‚æ‰€æœ‰æ–°å»ºçš„ä»“åº“éƒ½æ˜¯ç§æœ‰çš„</td></tr><tr><td><code>MAX_CREATION_LIMIT</code></td><td>å…¨å±€é»˜è®¤çš„æ¯ä¸ªç”¨æˆ·å¯åˆ›å»ºåˆ›å»ºä»“åº“ä¸Šé™ï¼Œ<code>-1</code> è¡¨ç¤ºæ— é™åˆ¶</td></tr><tr><td><code>PREFERRED_LICENSES</code></td><td>å»ºè®®ç”¨æˆ·é¦–é€‰çš„æˆæƒç±»å‹</td></tr><tr><td><code>DISABLE_HTTP_GIT</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢ç”¨æˆ·é€šè¿‡ HTTP å¯¹ Git ä»“åº“è¿›è¡Œäº¤äº’æ“ä½œï¼Œå³ç”¨æˆ·åªèƒ½é€šè¿‡ SSH æ“ä½œ</td></tr><tr><td><code>ENABLE_LOCAL_PATH_MIGRATION</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨æœ¬åœ°è·¯å¾„è¿ç§»ä»“åº“åŠŸèƒ½ã€‚å¯åŠ¨åé»˜è®¤åªæœ‰ç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨ï¼Œæ™®é€šç”¨æˆ·å¿…é¡»ç»ç”±ç®¡ç†å‘˜æˆæƒ</td></tr><tr><td><code>ENABLE_RAW_FILE_RENDER_MODE</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨åœ¨æŸ¥çœ‹åŸå§‹æ•°æ®æ—¶å¯¹é¡µé¢è¿›è¡ŒçœŸå®æ¸²æŸ“ï¼Œä¾‹å¦‚æ¸²æŸ“å®é™…çš„ HTML é¡µé¢ï¼Œæœ‰æ½œåœ¨å®‰å…¨éšæ‚£</td></tr></tbody></table><h4 id="ä»“åº“-ç¼–è¾‘å™¨-repository-editor"><a href="#ä»“åº“-ç¼–è¾‘å™¨-repository-editor" class="headerlink" title="ä»“åº“ - ç¼–è¾‘å™¨ (repository.editor)"></a>ä»“åº“ - ç¼–è¾‘å™¨ (<code>repository.editor</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>LINE_WRAP_EXTENSIONS</code></td><td>éœ€è¦æ˜¾ç¤ºä¸ºè¡ŒåŒ…è£…çš„æ–‡ä»¶ååç¼€ï¼Œé€šè¿‡é€—å·åˆ†éš”ã€‚å¦‚æœæ˜¯æ— åç¼€åçš„æ–‡ä»¶ï¼Œåˆ™å•ç‹¬æ”¾ç½®ä¸€ä¸ªé€—å·ï¼Œä¾‹å¦‚ï¼š<code>.txt,</code></td></tr></tbody></table><h4 id="ä»“åº“-æ–‡ä»¶ä¸Šä¼ -repository-upload"><a href="#ä»“åº“-æ–‡ä»¶ä¸Šä¼ -repository-upload" class="headerlink" title="ä»“åº“ - æ–‡ä»¶ä¸Šä¼  (repository.upload)"></a>ä»“åº“ - æ–‡ä»¶ä¸Šä¼  (<code>repository.upload</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨ä»“åº“æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</td></tr><tr><td><code>TEMP_PATH</code></td><td>æ–‡ä»¶ä¸Šä¼ çš„ä¸´æ—¶å­˜æ”¾ç›®å½•</td></tr><tr><td><code>ALLOWED_TYPES</code></td><td>å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ï¼ˆä¾‹å¦‚ï¼šâ€image/jpeg|image/pngâ€ï¼‰ï¼Œç•™ç©ºè¡¨ç¤ºå…è®¸ä¸Šä¼ ä»»æ„ç±»å‹çš„æ–‡ä»¶</td></tr><tr><td><code>FILE_MAX_SIZE</code></td><td>å•ä¸ªä¸Šä¼ çš„æ–‡ä»¶çš„æœ€å¤§ä½“ç§¯ï¼Œä»¥ MB ä¸ºå•ä½</td></tr><tr><td><code>MAX_FILES</code></td><td>å•æ¬¡åŒæ—¶ä¸Šä¼ çš„æœ€å¤šæ–‡ä»¶ä¸ªæ•°</td></tr></tbody></table><h4 id="ç‰ˆæœ¬å‘å¸ƒ-é™„ä»¶-release-attachment"><a href="#ç‰ˆæœ¬å‘å¸ƒ-é™„ä»¶-release-attachment" class="headerlink" title="ç‰ˆæœ¬å‘å¸ƒ - é™„ä»¶ (release.attachment)"></a>ç‰ˆæœ¬å‘å¸ƒ - é™„ä»¶ (<code>release.attachment</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨ç‰ˆæœ¬å‘å¸ƒé™„ä»¶åŠŸèƒ½</td></tr><tr><td><code>PATH</code></td><td>å­˜æ”¾é™„ä»¶çš„è·¯å¾„</td></tr><tr><td><code>ALLOWED_TYPES</code></td><td>å…è®¸ä¸Šä¼ çš„ MIME ç±»å‹ï¼Œä¾‹å¦‚ â€œimage/jpeg|image/pngâ€ï¼Œä½¿ç”¨ <code>*/*</code> å…è®¸æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶</td></tr><tr><td><code>MAX_SIZE</code></td><td>æœ€å¤§å…è®¸ä¸Šä¼ çš„é™„ä»¶ä½“ç§¯ï¼Œå•ä½ä¸º MBï¼Œä¾‹å¦‚ <code>32</code></td></tr><tr><td><code>MAX_FILES</code></td><td>æœ€å¤§å…è®¸ä¸€æ¬¡æ€§ä¸Šä¼ çš„é™„ä»¶ä¸ªæ•°ï¼Œä¾‹å¦‚ <code>10</code></td></tr></tbody></table><h3 id="Markdown-markdown"><a href="#Markdown-markdown" class="headerlink" title="Markdown (markdown)"></a>Markdown (<code>markdown</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLE_HARD_LINE_BREAK</code></td><td>æŒ‡ç¤ºæ˜¯å¦å¯ç”¨ç¡¬æ€§æ¢è¡Œæ‰©å±•</td></tr><tr><td><code>CUSTOM_URL_SCHEMES</code></td><td>å…è®¸è¢«è§£æä¸ºé“¾æ¥çš„è‡ªå®šä¹‰ URL æ–¹æ¡ˆï¼Œä¾‹å¦‚ <code>git</code>ï¼ˆç”¨äº <code>git://</code>ï¼‰å’Œ<code>magnet</code>ï¼ˆç”¨äº <code>magnet://</code>ï¼‰</td></tr><tr><td><code>FILE_EXTENSIONS</code></td><td>éœ€è¦è¢«æ¸²æŸ“ä¸º Markdown æ ¼å¼çš„æ–‡ä»¶ååç¼€ï¼Œé€šè¿‡é€—å·åˆ†éš”ã€‚å¦‚æœæ˜¯æ— åç¼€åçš„æ–‡ä»¶ï¼Œåˆ™å•ç‹¬æ”¾ç½®ä¸€ä¸ªé€—å·ï¼Œä¾‹å¦‚ï¼š<code>.markdown,</code></td></tr></tbody></table><h3 id="Smartypants-smartypants"><a href="#Smartypants-smartypants" class="headerlink" title="Smartypants (smartypants)"></a>Smartypants (<code>smartypants</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td>æŒ‡ç¤ºæ˜¯å¦å¯ç”¨ Smartypants æ‰©å±•</td></tr></tbody></table><h3 id="HTTP-http"><a href="#HTTP-http" class="headerlink" title="HTTP (http)"></a>HTTP (<code>http</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ACCESS_CONTROL_ALLOW_ORIGIN</code></td><td>å¤´ä¿¡æ¯ <code>Access-Control-Allow-Origin</code> çš„è‡ªå®šä¹‰å€¼ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå³ä¸å“åº”æ­¤å¤´ä¿¡æ¯</td></tr></tbody></table><h3 id="æ•°æ®åº“-database"><a href="#æ•°æ®åº“-database" class="headerlink" title="æ•°æ®åº“ (database)"></a>æ•°æ®åº“ (<code>database</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>DB_TYPE</code></td><td>æ•°æ®åº“ç±»å‹ï¼Œå¯ä»¥æ˜¯ <code>mysql</code>ã€<code>postgres</code>ã€<code>mssql</code> æˆ– <code>sqlite3</code></td></tr><tr><td><code>HOST</code></td><td>æ•°æ®åº“ä¸»æœºåœ°å€ä¸ç«¯å£</td></tr><tr><td><code>NAME</code></td><td>æ•°æ®åº“åç§°</td></tr><tr><td><code>USER</code></td><td>æ•°æ®åº“ç”¨æˆ·å</td></tr><tr><td><code>PASSWD</code></td><td>æ•°æ®åº“ç”¨æˆ·å¯†ç </td></tr><tr><td><code>SSL_MODE</code></td><td>ä»…é™ PostgreSQL ä½¿ç”¨</td></tr><tr><td><code>PATH</code></td><td>ä»…é™ SQLite3 ä½¿ç”¨ï¼Œæ•°æ®åº“æ–‡ä»¶è·¯å¾„</td></tr></tbody></table><h3 id="åº”ç”¨ç®¡ç†-admin"><a href="#åº”ç”¨ç®¡ç†-admin" class="headerlink" title="åº”ç”¨ç®¡ç† (admin)"></a>åº”ç”¨ç®¡ç† (<code>admin</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>DISABLE_REGULAR_ORG_CREATION</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢æ™®é€šç”¨æˆ·ï¼ˆéç®¡ç†å‘˜ï¼‰åˆ›å»ºç»„ç»‡</td></tr></tbody></table><h3 id="å®‰å…¨-security"><a href="#å®‰å…¨-security" class="headerlink" title="å®‰å…¨ (security)"></a>å®‰å…¨ (<code>security</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>INSTALL_LOCK</code></td><td>ç”¨äºæŒ‡ç¤ºæ˜¯å¦å…è®¸è®¿é—®å®‰è£…é¡µé¢ï¼ˆè¯¥é¡µé¢å¯ä»¥è®¾ç½®ç®¡ç†å‘˜å¸å·ï¼Œå› æ­¤è¯¥é€‰é¡¹éå¸¸é‡è¦ï¼‰</td></tr><tr><td><code>SECRET_KEY</code></td><td>å…¨å±€çš„åŠ å¯†å¯†é’¥ï¼Œ<strong>åŠ¡å¿…ä¿®æ”¹è¯¥å€¼ä»¥ç¡®ä¿æ‚¨çš„æœåŠ¡å™¨å®‰å…¨</strong>ï¼ˆä¼šåœ¨æ¯æ¬¡å®‰è£…æ—¶è‡ªåŠ¨ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼‰</td></tr><tr><td><code>LOGIN_REMEMBER_DAYS</code></td><td>è®°ä½ç™»å½•çš„å¤©æ•°</td></tr><tr><td><code>COOKIE_USERNAME</code></td><td>è®°å½•ç”¨æˆ·åçš„ Cookie åç§°</td></tr><tr><td><code>COOKIE_REMEMBER_NAME</code></td><td>è®°å½•ç”¨æˆ·è‡ªåŠ¨ç™»å½•ä¿¡æ¯çš„ Cookie åç§°</td></tr><tr><td><code>REVERSE_PROXY_AUTHENTICATION_USER</code></td><td>åå‘ä»£ç†è®¤è¯ç”¨æˆ·çš„ Header å­—æ®µå</td></tr></tbody></table><h3 id="æœåŠ¡-service"><a href="#æœåŠ¡-service" class="headerlink" title="æœåŠ¡ (service)"></a>æœåŠ¡ (<code>service</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ACTIVE_CODE_LIVE_MINUTES</code></td><td>æ¿€æ´»ç çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºåˆ†é’Ÿ</td></tr><tr><td><code>RESET_PASSWD_CODE_LIVE_MINUTES</code></td><td>é‡ç½®å¯†ç çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºåˆ†é’Ÿ</td></tr><tr><td><code>REGISTER_EMAIL_CONFIRM</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥è¦æ±‚æ³¨å†Œç”¨æˆ·å¿…é¡»éªŒè¯é‚®ç®±ï¼Œè¦æ±‚å·²å¯ç”¨ <code>Mailer</code></td></tr><tr><td><code>DISABLE_REGISTRATION</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼Œåªèƒ½ç”±ç®¡ç†å‘˜åˆ›å»ºå¸å·</td></tr><tr><td><code>SHOW_REGISTRATION_BUTTON</code></td><td>ç”¨äºæŒ‡ç¤ºæ˜¯å¦æ˜¾ç¤ºæ³¨å†ŒæŒ‰é’®</td></tr><tr><td><code>REQUIRE_SIGNIN_VIEW</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥è¦æ±‚ç”¨æˆ·å¿…é¡»ç™»å½•æ‰èƒ½æµè§ˆä»»ä½•é¡µé¢</td></tr><tr><td><code>ENABLE_CACHE_AVATAR</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¼“å­˜ Gravatar çš„å¤´åƒ</td></tr><tr><td><code>ENABLE_NOTIFY_MAIL</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å‘é€é€šçŸ¥é‚®ä»¶ç»™å…³æ³¨è€…ï¼Œä¾‹å¦‚åˆ›å»º issue æ—¶ï¼Œè¦æ±‚å·²å¯ç”¨ <code>Mailer</code></td></tr><tr><td><code>ENABLE_REVERSE_PROXY_AUTHENTICATION</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¼€å¯åå‘ä»£ç†ç”¨æˆ·è®¤è¯ï¼Œè¯·ä» <a href="https://github.com/gogs/gogs/issues/165">#165</a> äº†è§£æ›´å¤šä¿¡æ¯</td></tr><tr><td><code>ENABLE_REVERSE_PROXY_AUTO_REGISTRATION</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¼€å¯åå‘ä»£ç†ç”¨æˆ·è®¤è¯çš„è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½</td></tr><tr><td><code>DISABLE_MINIMUM_KEY_SIZE_CHECK</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢æ£€æŸ¥å“åº”ç±»å‹çš„å¯†é’¥æœ€å°é•¿åº¦</td></tr><tr><td><code>ENABLE_CAPTCHA</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨ç”¨æˆ·æ³¨å†Œæ—¶è¦æ±‚è¾“å…¥éªŒè¯ç </td></tr></tbody></table><h3 id="Web-é’©å­-webhook"><a href="#Web-é’©å­-webhook" class="headerlink" title="Web é’©å­ (webhook)"></a>Web é’©å­ (<code>webhook</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>TYPES</code></td><td>å¯åŠ¨çš„ Web é’©å­ç±»å‹ï¼Œå¯ä»¥æ˜¯ <code>gogs</code>ã€<code>slack</code>ã€<code>discord</code>æˆ–<code>dingtalk</code></td></tr><tr><td><code>QUEUE_LENGTH</code></td><td>Webé’©å­é˜Ÿåˆ—é•¿åº¦ï¼Œå¦‚æœå‘ç°éƒ¨åˆ†Webhookæœªèƒ½æˆåŠŸè§¦å‘ï¼Œå¯è€ƒè™‘å¢åŠ è¯¥å€¼</td></tr><tr><td><code>DELIVER_TIMEOUT</code></td><td>å‘é€é€šçŸ¥çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½</td></tr><tr><td><code>SKIP_TLS_VERIFY</code></td><td>æŒ‡ç¤ºæ˜¯å¦å…è®¸å‘å…·æœ‰éä¿¡ä»»è¯ä¹¦çš„åœ°å€å‘é€é€šçŸ¥</td></tr><tr><td><code>PAGING_NUM</code></td><td>Web é’©å­å†å²é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•°</td></tr></tbody></table><h3 id="é‚®ä»¶-mailer"><a href="#é‚®ä»¶-mailer" class="headerlink" title="é‚®ä»¶ (mailer)"></a>é‚®ä»¶ (<code>mailer</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td>å¯ç”¨è¯¥é€‰é¡¹ä»¥æ¿€æ´»é‚®ä»¶æœåŠ¡</td></tr><tr><td><code>SUBJECT_PREFIX</code></td><td>é‚®ä»¶æ ‡é¢˜çš„å‰ç¼€</td></tr><tr><td><code>HOST</code></td><td>SMTP ä¸»æœºåœ°å€ä¸ç«¯å£</td></tr><tr><td><code>DISABLE_HELO</code></td><td>ç¦ç”¨ HELO æ“ä½œ</td></tr><tr><td><code>HELO_HOSTNAME</code></td><td>HELO æ“ä½œçš„è‡ªå®šä¹‰ä¸»æœºå</td></tr><tr><td><code>SKIP_VERIFY</code></td><td>ä¸éªŒè¯è‡ªç­¾å‘è¯ä¹¦çš„æœ‰æ•ˆæ€§</td></tr><tr><td><code>FROM</code></td><td>é‚®ç®±çš„æ¥è‡ªåœ°å€ï¼Œéµå¾ª RFC 5322è§„èŒƒï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå•çº¯çš„é‚®ç®±åœ°å€æˆ–è€… <code>&quot;åå­—&quot; &lt;email@example.com&gt;</code> çš„å½¢å¼</td></tr><tr><td><code>USER</code></td><td>é‚®ç®±ç”¨æˆ·å</td></tr><tr><td><code>PASSWD</code></td><td>é‚®ç®±å¯†ç </td></tr><tr><td><code>USE_PLAIN_TEXT</code></td><td>ä½¿ç”¨ <code>text/plain</code> ä½œä¸ºé‚®ä»¶å†…å®¹æ ¼å¼</td></tr></tbody></table><p>å¤‡æ³¨ï¼šGogs ä»…æ”¯æŒä½¿ç”¨ STARTTLS çš„ SMTP åè®®</p><h3 id="ç¼“å­˜-cache"><a href="#ç¼“å­˜-cache" class="headerlink" title="ç¼“å­˜ (cache)"></a>ç¼“å­˜ (<code>cache</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ADAPTER</code></td><td>ç¼“å­˜å¼•æ“é€‚é…å™¨ï¼Œå¯ä»¥ä¸º <code>memory</code>ã€<code>Redis</code> æˆ– <code>memcache</code>ã€‚å¦‚æœæ‚¨ä½¿ç”¨ <code>Redis</code> æˆ– <code>memcache</code>ï¼Œè¯·ç¡®ä¿ä½¿ç”¨ <code>-tags</code> é€‰é¡¹é‡æ–°æ„å»ºæ‰€æœ‰ä¾èµ–ï¼Œä¾‹å¦‚ï¼š<code>go build -tags=&#39;Redis&#39;</code></td></tr><tr><td><code>INTERVAL</code></td><td>ä»…é™å†…å­˜ç¼“å­˜ä½¿ç”¨ï¼ŒGC å‘¨æœŸï¼Œå•ä½ä¸ºç§’</td></tr><tr><td><code>HOST</code></td><td>ä»…é™ Redis å’Œ memcache ä½¿ç”¨ï¼Œä¸»æœºåœ°å€å’Œç«¯å£å·</td></tr><tr><td>-</td><td>Redisï¼š<code>network=tcp,addr=127.0.0.1:6379,password=macaron,db=0,pool_size=100,idle_timeout=180</code></td></tr><tr><td>-</td><td>Memacheï¼š<code>127.0.0.1:9090;127.0.0.1:9091</code></td></tr></tbody></table><h3 id="ä¼šè¯-session"><a href="#ä¼šè¯-session" class="headerlink" title="ä¼šè¯ (session)"></a>ä¼šè¯ (<code>session</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>PROVIDER</code></td><td>Session å¼•æ“æä¾›è€…ï¼Œå¯ä»¥æ˜¯ <code>memory</code>ã€<code>file</code>ã€<code>Redis</code> æˆ– <code>mysql</code></td></tr><tr><td><code>PROVIDER_CONFIG</code></td><td>å¦‚æœæä¾›è€…ä¸º fileï¼Œåˆ™ä¸ºæ–‡ä»¶æ ¹ç›®å½•ï¼›å¦‚æœä¸ºå…¶å®ƒæä¾›è€…ï¼Œåˆ™ä¸ºä¸»æœºåœ°å€å’Œç«¯å£å·</td></tr><tr><td><code>COOKIE_SECURE</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥è¦æ±‚æ‰€æœ‰ session æ“ä½œå‡é€šè¿‡ HTTPS</td></tr><tr><td><code>GC_INTERVAL_TIME</code></td><td>GC å‘¨æœŸï¼Œå•ä½ä¸ºç§’</td></tr></tbody></table><h3 id="å›¾ç‰‡-picture"><a href="#å›¾ç‰‡-picture" class="headerlink" title="å›¾ç‰‡ (picture)"></a>å›¾ç‰‡ (<code>picture</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>AVATAR_UPLOAD_PATH</code></td><td>å­˜æ”¾ç”¨æˆ·ä¸Šä¼ å¤´åƒçš„ç›®å½•</td></tr><tr><td><code>GRAVATAR_SOURCE</code></td><td>å¯ä»¥æ˜¯ <code>gravatar</code>ã€<code>duoshuo</code> æˆ–ä»»ä½• URLï¼Œä¾‹å¦‚ï¼š<code>http://cn.gravatar.com/avatar/</code></td></tr><tr><td><code>DISABLE_GRAVATAR</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥ä»…ä½¿ç”¨æœ¬åœ°å¤´åƒ</td></tr><tr><td><code>ENABLE_FEDERATED_AVATAR</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨ Federated å¤´åƒæœåŠ¡ï¼ˆ<a href="http://www.libravatar.org),å½“/">http://www.libravatar.orgï¼‰ï¼Œå½“</a> Gravatar è¢«ç¦ç”¨æ—¶æ­¤é€‰é¡¹æ— æ³•ç”Ÿæ•ˆ</td></tr></tbody></table><h3 id="é™„ä»¶-attachment"><a href="#é™„ä»¶-attachment" class="headerlink" title="é™„ä»¶ (attachment)"></a>é™„ä»¶ (<code>attachment</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥å…è®¸ç”¨æˆ·ä¸Šä¼ é™„ä»¶</td></tr><tr><td><code>PATH</code></td><td>å­˜æ”¾é™„ä»¶çš„è·¯å¾„</td></tr><tr><td><code>ALLOWED_TYPES</code></td><td>å…è®¸ä¸Šä¼ çš„ MIME ç±»å‹ï¼Œä¾‹å¦‚ â€œimage/jpeg|image/pngâ€ï¼Œä½¿ç”¨ <code>*/*</code> å…è®¸æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶</td></tr><tr><td><code>MAX_SIZE</code></td><td>æœ€å¤§å…è®¸ä¸Šä¼ çš„é™„ä»¶ä½“ç§¯ï¼Œå•ä½ä¸º MBï¼Œä¾‹å¦‚ <code>4</code></td></tr><tr><td><code>MAX_FILES</code></td><td>æœ€å¤§å…è®¸ä¸€æ¬¡æ€§ä¸Šä¼ çš„é™„ä»¶ä¸ªæ•°ï¼Œä¾‹å¦‚ <code>5</code></td></tr></tbody></table><h3 id="æ—¶é—´-time"><a href="#æ—¶é—´-time" class="headerlink" title="æ—¶é—´ (time)"></a>æ—¶é—´ (<code>time</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FORMAT</code></td><td>æŒ‡å®šæ—¥æœŸçš„è¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤ä¸º RFC1123ï¼Œå…¶å®ƒå¯é€‰çš„æ ¼å¼ä¸º ANSICã€UnixDateã€RubyDateã€RFC822ã€RFC822Zã€RFC850ã€RFC1123ã€RFC1123Zã€RFC3339ã€RFC3339Nanoã€Kitchenã€Stampã€StampMilliã€StampMicro å’Œ StampNanoã€‚è®¿é—® <a href="http://golang.org/pkg/time/#pkg-constants">http://golang.org/pkg/time/#pkg-constants</a> æŸ¥çœ‹è¯¦æƒ…</td></tr></tbody></table><h3 id="æ—¥å¿—-log"><a href="#æ—¥å¿—-log" class="headerlink" title="æ—¥å¿— (log)"></a>æ—¥å¿— (<code>log</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ROOT_PATH</code></td><td>æ—¥å¿—æ–‡ä»¶çš„æ ¹ç›®å½•</td></tr><tr><td><code>MODE</code></td><td>æ—¥å¿—è®°å½•æ¨¡å¼ï¼Œé»˜è®¤ä¸º <code>console</code>ã€‚å¦‚æœæƒ³è¦å¼€å¯å¤šæ¨¡å¼ï¼Œè¯·ä½¿ç”¨é€—å·åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š<code>&quot;console, file&quot;</code></td></tr><tr><td><code>LEVEL</code></td><td>åŸºæœ¬æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ä¸º <code>Trace</code></td></tr></tbody></table><h4 id="æ—¥å¿—-æ§åˆ¶å°-log-console"><a href="#æ—¥å¿—-æ§åˆ¶å°-log-console" class="headerlink" title="æ—¥å¿— - æ§åˆ¶å° (log.console)"></a>æ—¥å¿— - æ§åˆ¶å° (<code>log.console</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>LEVEL</code></td><td>æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼</td></tr></tbody></table><h4 id="æ—¥å¿—-æ–‡ä»¶-log-file"><a href="#æ—¥å¿—-æ–‡ä»¶-log-file" class="headerlink" title="æ—¥å¿— - æ–‡ä»¶ (log.file)"></a>æ—¥å¿— - æ–‡ä»¶ (<code>log.file</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>LEVEL</code></td><td>æ–‡ä»¶æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼</td></tr><tr><td><code>LOG_ROTATE</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥å¯ç”¨æ—¥å¿—æ–‡ä»¶è‡ªè½¬</td></tr><tr><td><code>DAILY_ROTATE</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥è¿›è¡Œæ—¥å¸¸è‡ªè½¬</td></tr><tr><td><code>MAX_SIZE_SHIFT</code></td><td>è‡ªè½¬éœ€è¦è¾¾åˆ°çš„æœ€å¤§æ–‡ä»¶ä½“ç§¯ï¼Œä½¿ç”¨ä½å·¦ç§»ï¼Œé»˜è®¤ä¸º 28 å³ 1 &lt;&lt; 28ï¼Œè¡¨ç¤º 256MB</td></tr><tr><td><code>MAX_LINES</code></td><td>è‡ªè½¬éœ€è¦è¾¾åˆ°çš„æœ€å¤§æ–‡ä»¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º <code>1000000</code></td></tr><tr><td><code>MAX_DAYS</code></td><td>ä¿ç•™è‡ªè½¬æ–‡ä»¶çš„æœ€é•¿æœŸé™ï¼Œé»˜è®¤ä¸º <code>7</code> å¤©ååˆ é™¤</td></tr></tbody></table><h4 id="æ—¥å¿—-Slack-log-slack"><a href="#æ—¥å¿—-Slack-log-slack" class="headerlink" title="æ—¥å¿— - Slack (log.slack)"></a>æ—¥å¿— - Slack (<code>log.slack</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>LEVEL</code></td><td>Slack æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼</td></tr><tr><td><code>URL</code></td><td>Slack Web é’©å­ URL</td></tr></tbody></table><h4 id="æ—¥å¿—-Discord-log-discord"><a href="#æ—¥å¿—-Discord-log-discord" class="headerlink" title="æ—¥å¿— - Discord (log.discord)"></a>æ—¥å¿— - Discord (<code>log.discord</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>LEVEL</code></td><td>Discord æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼</td></tr><tr><td><code>URL</code></td><td>Discord Web é’©å­ URL</td></tr><tr><td><code>USERNAME</code></td><td>åœ¨ Web é’©å­ä¸­æ˜¾ç¤ºçš„ç”¨æˆ·å</td></tr></tbody></table><h3 id="Cron-cron"><a href="#Cron-cron" class="headerlink" title="Cron (cron)"></a>Cron (<code>cron</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥å…è®¸å‘¨æœŸæ€§è¿è¡Œ Cron ä»»åŠ¡</td></tr><tr><td><code>RUN_AT_START</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥å…è®¸åœ¨å¯åŠ¨æ—¶æ‰§è¡Œ Cron ä»»åŠ¡</td></tr></tbody></table><h4 id="Cron-æ›´æ–°é•œåƒ-cron-update-mirrors"><a href="#Cron-æ›´æ–°é•œåƒ-cron-update-mirrors" class="headerlink" title="Cron - æ›´æ–°é•œåƒ (cron.update_mirrors)"></a>Cron - æ›´æ–°é•œåƒ (<code>cron.update_mirrors</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>SCHEDULE</code></td><td>å®šæ—¶æ›´æ–°ä»“åº“é•œåƒçš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š<code>@every 1h</code></td></tr></tbody></table><h4 id="Cron-ä»“åº“å¥åº·æ£€æŸ¥-cron-repo-health-check"><a href="#Cron-ä»“åº“å¥åº·æ£€æŸ¥-cron-repo-health-check" class="headerlink" title="Cron - ä»“åº“å¥åº·æ£€æŸ¥ (cron.repo_health_check)"></a>Cron - ä»“åº“å¥åº·æ£€æŸ¥ (<code>cron.repo_health_check</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>SCHEDULE</code></td><td>å®šæ—¶è¿›è¡Œä»“åº“å¥åº·æ£€æŸ¥çš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š<code>@every 24h</code></td></tr><tr><td><code>TIMEOUT</code></td><td>ä»“åº“å¥åº·æ£€æŸ¥è¶…æ—¶çš„å®šä¹‰è¯­æ³•ï¼Œä¾‹å¦‚ï¼š<code>60s</code></td></tr><tr><td><code>ARGS</code></td><td><code>git fsck</code> å‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š<code>--unreachable --tags</code></td></tr></tbody></table><h4 id="Cron-ä»“åº“ç»Ÿè®¡æ£€æŸ¥-cron-check-repo-stats"><a href="#Cron-ä»“åº“ç»Ÿè®¡æ£€æŸ¥-cron-check-repo-stats" class="headerlink" title="Cron - ä»“åº“ç»Ÿè®¡æ£€æŸ¥ (cron.check_repo_stats)"></a>Cron - ä»“åº“ç»Ÿè®¡æ£€æŸ¥ (<code>cron.check_repo_stats</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>RUN_AT_START</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨å¯åŠ¨æ—¶æ‰§è¡Œä»“åº“ç»Ÿè®¡æ£€æŸ¥</td></tr><tr><td><code>SCHEDULE</code></td><td>å®šæ—¶è¿›è¡Œä»“åº“ç»Ÿè®¡æ£€æŸ¥çš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š<code>@every 24h</code></td></tr></tbody></table><h4 id="Cron-ä»“åº“å½’æ¡£æ¸…ç†-cron-repo-archive-cleanup"><a href="#Cron-ä»“åº“å½’æ¡£æ¸…ç†-cron-repo-archive-cleanup" class="headerlink" title="Cron - ä»“åº“å½’æ¡£æ¸…ç† (cron.repo_archive_cleanup)"></a>Cron - ä»“åº“å½’æ¡£æ¸…ç† (<code>cron.repo_archive_cleanup</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>RUN_AT_START</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨å¯åŠ¨æ—¶æ‰§è¡Œä»“åº“å½’æ¡£æ¸…ç†</td></tr><tr><td><code>SCHEDULE</code></td><td>å®šæ—¶è¿›è¡Œä»“åº“å½’æ¡£æ¸…ç†çš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š<code>@every 24h</code></td></tr><tr><td><code>OLDER_THAN</code></td><td>ä»“åº“å½’æ¡£çš„æ–‡ä»¶æœ‰æ•ˆæœŸï¼Œè¿‡æœŸçš„å½’æ¡£å°†è¢«æ¸…ç†ï¼Œä¾‹å¦‚ï¼š<code>24h</code></td></tr></tbody></table><h3 id="Git-git"><a href="#Git-git" class="headerlink" title="Git (git)"></a>Git (<code>git</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>DISABLE_DIFF_HIGHLIGHT</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥ç¦ç”¨è¡Œå†…å·®å¼‚é«˜äº®</td></tr><tr><td><code>MAX_GIT_DIFF_LINES</code></td><td>å·®å¼‚å¯¹æ¯”é¡µé¢å•ä¸ªæ–‡ä»¶æ˜¾ç¤ºçš„æœ€å¤§è¡Œæ•°</td></tr><tr><td><code>MAX_GIT_DIFF_LINE_CHARACTERS</code></td><td>å·®å¼‚å¯¹æ¯”é¡µé¢å•è¡Œæ˜¾ç¤ºçš„æœ€å¤§å­—ç¬¦æ•°</td></tr><tr><td><code>MAX_GIT_DIFF_FILES</code></td><td>å·®å¼‚å¯¹æ¯”é¡µé¢æ–‡ä»¶æ˜¾ç¤ºçš„æœ€å¤šä¸ªæ•°</td></tr><tr><td><code>GC_ARGS</code></td><td><code>git gc</code> å‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š<code>--aggressive --auto</code></td></tr></tbody></table><h4 id="Git-è¶…æ—¶-git-timeout"><a href="#Git-è¶…æ—¶-git-timeout" class="headerlink" title="Git - è¶…æ—¶ (git.timeout)"></a>Git - è¶…æ—¶ (<code>git.timeout</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>MIGRATE</code></td><td>ä»“åº“è¿ç§»æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º <code>600</code> ç§’</td></tr><tr><td><code>MIRROR</code></td><td>ä»“åº“é•œåƒåŒæ­¥æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º <code>300</code> ç§’</td></tr><tr><td><code>CLONE</code></td><td>ä»“åº“å…‹éš†æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º <code>300</code> ç§’</td></tr><tr><td><code>PULL</code></td><td>ä»“åº“æ‹‰å–æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º <code>300</code> ç§’</td></tr><tr><td><code>GC</code></td><td>ä»“åº“åƒåœ¾å›æ”¶æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º <code>60</code> ç§’</td></tr></tbody></table><h3 id="UI-ui"><a href="#UI-ui" class="headerlink" title="UI (ui)"></a>UI (<code>ui</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>EXPLORE_PAGING_NUM</code></td><td>æ¢ç´¢é¡µé¢æ¯é¡µæ˜¾ç¤ºä»“åº“çš„æ•°é‡</td></tr><tr><td><code>ISSUE_PAGING_NUM</code></td><td>æ¯é¡µæ˜¾ç¤ºå·¥å•ï¼ˆIssueï¼‰çš„æ•°é‡ï¼ˆåº”ç”¨åˆ°æ‰€æœ‰ä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºå·¥å•çš„é¡µé¢ï¼‰</td></tr><tr><td><code>FEED_MAX_COMMIT_NUM</code></td><td>ä¸€æ¡æœ€æ–°æ´»åŠ¨ä¸­æ˜¾ç¤ºä»£ç æäº¤ï¼ˆCommitï¼‰çš„æœ€å¤§æ•°é‡</td></tr><tr><td><code>THEME_COLOR_META_TAG</code></td><td>è¢«ç”¨äº Android &gt;= 5.0 ç‰ˆæœ¬ â€œtheme-colorâ€ æ ‡è®°çš„å€¼ï¼Œæ— æ•ˆçš„å€¼å°†è¢«å¿½ç•¥å¹¶ä½¿ç”¨é»˜è®¤å€¼ï¼ˆ<a href="https://developers.google.com/web/updates/2014/11/Support-for-theme-color-in-Chrome-39-for-Android">æŸ¥çœ‹è¯¦æƒ…</a>ï¼‰</td></tr><tr><td><code>MAX_DISPLAY_FILE_SIZE</code></td><td>æ˜¾ç¤ºåˆ°é¡µé¢çš„æœ€å¤§æ–‡ä»¶ä½“ç§¯ï¼ˆByteï¼‰</td></tr></tbody></table><h4 id="UI-Admin-ui-admin"><a href="#UI-Admin-ui-admin" class="headerlink" title="UI - Admin (ui.admin)"></a>UI - Admin (<code>ui.admin</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>USER_PAGING_NUM</code></td><td>ç”¨æˆ·ç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•°</td></tr><tr><td><code>REPO_PAGING_NUM</code></td><td>ä»“åº“ç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•°</td></tr><tr><td><code>NOTICE_PAGING_NUM</code></td><td>ç³»ç»Ÿæç¤ºç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•°</td></tr><tr><td><code>ORG_PAGING_NUM</code></td><td>ç»„ç»‡ç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•°</td></tr></tbody></table><h4 id="Prometheus-prometheus"><a href="#Prometheus-prometheus" class="headerlink" title="Prometheus (prometheus)"></a>Prometheus (<code>prometheus</code>)</h4><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥å¯ç”¨ Prometheus ç›‘æ§ä¿¡æ¯ï¼Œé»˜è®¤ä¸º <code>true</code></td></tr><tr><td><code>ENABLE_BASIC_AUTH</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥å¯ç”¨ HTTP åŸºæœ¬è®¤è¯ä¿æŠ¤ç›‘æ§ä¿¡æ¯æ•°æ®ï¼Œé»˜è®¤ä¸º <code>false</code></td></tr><tr><td><code>BASIC_AUTH_USERNAME</code></td><td>HTTP åŸºæœ¬è®¤è¯çš„ç”¨æˆ·å</td></tr><tr><td><code>BASIC_AUTH_PASSWORD</code></td><td>HTTP åŸºæœ¬è®¤è¯çš„å¯†ç </td></tr></tbody></table><h3 id="å…¶ä»–-other"><a href="#å…¶ä»–-other" class="headerlink" title="å…¶ä»– (other)"></a>å…¶ä»– (<code>other</code>)</h3><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>SHOW_FOOTER_BRANDING</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨é¡µè„šæ˜¾ç¤º Gogs æ¨å¹¿ä¿¡æ¯</td></tr><tr><td><code>SHOW_FOOTER_VERSION</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨é¡µè„šæ˜¾ç¤º Gogs ç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td><code>SHOW_FOOTER_TEMPLATE_LOAD_TIME</code></td><td>æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨é¡µè„šæ˜¾ç¤º Gogs æ¨¡æ¿åŠ è½½æ—¶é—´</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>CI</tag>
      
      <tag>gogs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨consul+nginx-upsyncå®ç°åŠ¨æ€è´Ÿè½½</title>
    <link href="/2019/12/01/212/"/>
    <url>/2019/12/01/212/</url>
    
    <content type="html"><![CDATA[<p>å½“ Nginx é‡åˆ°å¤§æµé‡å’Œé«˜è´Ÿè½½ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶é‡å¯ç•¥æ˜¾ç¹çï¼Œå› ä¸ºæ¢å¤Nginxå¹¶é‡è½½é…ç½®ä¼šè¿›ä¸€æ­¥å¢åŠ ç³»ç»Ÿè´Ÿè½½ï¼Œå¹¶å¾ˆå¯èƒ½çŸ­æš‚é™ä½æ€§èƒ½ï¼Œè€Œä¸€ä¸ªä¸ªä¿®æ”¹é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å‡ºé”™å’Œè´¹æ—¶é—´çš„æ“ä½œï¼Œè¿™æ—¶å€™ä¸å¦¨è¯•è¯•consul+nginx-upsync-moduleå®ç°Nginxçš„åŠ¨æ€è´Ÿè½½ã€‚</p><h3 id="nginx-upsync-module"><a href="#nginx-upsync-module" class="headerlink" title="nginx-upsync-module"></a>nginx-upsync-module</h3><p>nginx-upsync-module æä¾›äº†åŠ¨æ€çš„è´Ÿè½½å‡è¡¡ï¼Œå®ƒå¯ä»¥ä»consulæˆ–etcdåŒæ­¥upstreamsï¼ŒåŠ¨æ€ä¿®æ”¹åç«¯æœåŠ¡å™¨å±æ€§ï¼Œè€Œä¸éœ€è¦é‡æ–°åŠ è½½nginxã€‚è¿™æ ·æˆ‘ä»¬é€šè¿‡å®ƒå®ç°å¹³æ»‘ä¼¸ç¼©ï¼Œè€Œä¸ä¸¥é‡åœ°å½±å“æ€§èƒ½ã€‚</p><h3 id="åˆ©ç”¨dockerå®‰è£…"><a href="#åˆ©ç”¨dockerå®‰è£…" class="headerlink" title="åˆ©ç”¨dockerå®‰è£…"></a>åˆ©ç”¨dockerå®‰è£…</h3><p>æˆ‘å·²ç»åŸºäºcentos7æ„å»ºäº†ä¸€ä¸ªé•œåƒ 13sai/nginx-lua-upsync ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ä¸€ä¸ªå®¹å™¨</p><blockquote><p>docker run -itd â€“name=nginx-upsync -p 8008:80 -p 9501:9501 -p 9502:9502 -p 9503:9503 -p 8500:8500 13sai/nginx-lua-upsync</p></blockquote><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨dockerè‡ªè¡Œæ­å»ºï¼Œæ·»åŠ nginx-upsync-moduleæ¨¡å—å¯ä»¥å‚è€ƒ<a href="https://github.oscome.cn/2019/11/20/Nginx9/">nginxæ¨¡å—luaæ¨¡å—</a>ã€‚</p><ul><li><a href="https://github.com/weibocom/nginx-upsync-module#installation">nginx-upsync-moduleçš„gitåœ°å€</a></li></ul><h3 id="è¿›å…¥å®¹å™¨é…ç½®"><a href="#è¿›å…¥å®¹å™¨é…ç½®" class="headerlink" title="è¿›å…¥å®¹å™¨é…ç½®"></a>è¿›å…¥å®¹å™¨é…ç½®</h3><blockquote><p>docker exec -it nginx-upsync /bin/bash</p></blockquote><blockquote><p>cd /usr/local/nginx/conf</p></blockquote><blockquote><p>echo â€œserver host.docker.internal:9501 weight=1 fail_timeout=10 max_fails=3;â€ &gt;&gt; servers.conf</p></blockquote><blockquote><p>vi nginx.conf</p></blockquote><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment">#nginx.conf ä¸»è¦é…ç½®</span>...upstream <span class="hljs-number">13</span>sai&#123;    upsync <span class="hljs-number">192.168</span>.<span class="hljs-number">65.2</span>:<span class="hljs-number">8500</span><span class="hljs-regexp">/v1/</span>kv<span class="hljs-regexp">/upstreams/</span>test-server upsync_timeout=<span class="hljs-number">6</span>m upsync_interval=<span class="hljs-number">500</span>ms upsync_type=consul strong_dependency=off;    upsync_dump_path <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/servers.conf;    include <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/servers.conf;&#125;server &#123;    listen       <span class="hljs-number">80</span>;    location / &#123;proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">13</span>sai;    &#125;    ...    &#125;</code></pre></div><h4 id="ç›¸å…³è¯­æ³•è¯´æ˜"><a href="#ç›¸å…³è¯­æ³•è¯´æ˜" class="headerlink" title="ç›¸å…³è¯­æ³•è¯´æ˜"></a>ç›¸å…³è¯­æ³•è¯´æ˜</h4><ul><li>upsync å®šä¹‰ä»consul/etcdæ‹‰å–æœ€æ–°çš„upstreamä¿¡æ¯å¹¶å­˜åˆ°æœ¬åœ°çš„æ“ä½œ</li><li>upsync_timeout å®šä¹‰ä»consul/etcdæ‹‰å–é…ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 6m</li><li>upsync_interval å®šä¹‰ä»consul/etcæ‹‰å–é…ç½®çš„é—´éš”æ—¶é—´ï¼Œé»˜è®¤ 5s</li><li>upsync_type å®šä¹‰ä½¿ç”¨é…ç½®æœåŠ¡ç±»å‹ consul/etcd</li><li>strong_dependency å¯åŠ¨æ—¶æ˜¯å¦å¼ºåˆ¶ä¾èµ–é…ç½®æœåŠ¡å™¨ï¼Œå¦‚æœé…ç½®ä¸ºon,åˆ™æ‹‰å–å¤±è´¥ï¼ŒnginxåŒæ ·ä¼šå¯ç”¨å¤±è´¥</li><li>upsync_dump_path å®šä¹‰ä»consul/etcdæ‹‰å–é…ç½®åæŒä¹…åŒ–åˆ°çš„æœ¬åœ°çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™æ ·å³ä½¿ consul/etcdå‡ºé—®é¢˜äº†ï¼Œæœ¬åœ°åŒæ ·ä¼šæœ‰å¤‡ä»½æ–‡ä»¶</li></ul><blockquote><p>æ³¨æ„ upsync_dump_path æŒ‡å®šè¿™ä¸ªæ–‡ä»¶å¿…é¡»è¦æœ‰ï¼Œå¦åˆ™Nginxå¯åŠ¨ä¼šæŠ¥é”™ã€‚æ–‡ä»¶è·¯å¾„å’Œåç§°å¯ä»¥è‡ªå®šä¹‰ï¼Œnginx-upsync-moduleä¼šå°†è´Ÿè½½ä¿¡æ¯ç¼“å­˜åˆ°æ­¤æ–‡ä»¶</p></blockquote><div class="code-wrapper"><pre><code class="hljs routeros"><span class="hljs-comment">#servers.confï¼Œ192.168.x.xxxæ˜¯æˆ‘çš„å®¿ä¸»æœºip</span><span class="hljs-built_in"></span><span class="hljs-built_in">server </span>192.168.x.xxx:9501 <span class="hljs-attribute">weight</span>=20 <span class="hljs-attribute">max_fails</span>=1 <span class="hljs-attribute">fail_timeout</span>=5s;</code></pre></div><p>é‡å¯nginx</p><blockquote><p>/usr/local/nginx/sbin/nginx -t</p></blockquote><blockquote><p>/usr/local/nginx/sbin/nginx -s reload</p></blockquote><p>è¿™é‡Œè™½ç„¶æˆ‘ä»¬è¿˜æœªå¯åŠ¨consulï¼Œä½†æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œupsyncä¼šå»æ‹‰å–ï¼Œä¹Ÿå¿…ç„¶ä¼šå¤±è´¥ï¼Œservers.conf å°±ä¸ä¼šæ›´æ–°ï¼ŒNginxçš„ error æ—¥å¿—ä¼šæœ‰ä¿¡æ¯ã€‚</p><h2 id="åˆ©ç”¨swooleå¯åŠ¨3ä¸ªhttpæœåŠ¡"><a href="#åˆ©ç”¨swooleå¯åŠ¨3ä¸ªhttpæœåŠ¡" class="headerlink" title="åˆ©ç”¨swooleå¯åŠ¨3ä¸ªhttpæœåŠ¡"></a>åˆ©ç”¨swooleå¯åŠ¨3ä¸ªhttpæœåŠ¡</h2><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// å¯å¯åŠ¨3ä¸ªserverï¼Œç«¯å£åˆ†åˆ«ä¸º9501ï¼Œ9502ï¼Œ9503ï¼Œè¾“å‡ºä¹Ÿåšå¯¹åº”ä¿®æ”¹</span><span class="hljs-variable">$http</span> = <span class="hljs-keyword">new</span> Swoole\Http\Server(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">9501</span>);<span class="hljs-variable">$http</span>-&gt;on(<span class="hljs-string">&#x27;request&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$request</span>, <span class="hljs-variable">$response</span></span>) </span>&#123;    <span class="hljs-variable">$response</span>-&gt;end(<span class="hljs-string">&quot;9501&quot;</span>);&#125;);</code></pre></div><h2 id="consulå®‰è£…"><a href="#consulå®‰è£…" class="headerlink" title="consulå®‰è£…"></a>consulå®‰è£…</h2><blockquote><p>è¿™é‡Œconsulåªåšä¸€ä¸ªkvå­˜å‚¨ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ç”¨ï¼Œå°±ä¸å»åšè¿‡å¤šä»‹ç»äº†ã€‚</p></blockquote><p><a href="https://www.consul.io/downloads.html">ä¸‹è½½åœ°å€</a></p><p>è§£å‹åˆ°ä½ éœ€è¦çš„ç›®å½•ï¼Œä¸»è¦ä¹Ÿå°±æ˜¯ä¸€ä¸ªconsulå¯æ‰§è¡Œæ–‡ä»¶ã€‚ï¼ˆè¿™é‡Œæˆ‘è£…åœ¨æˆ‘çš„ç”µè„‘ï¼Œè€Œä¸æ˜¯åˆšæ‰çš„dockerå®¹å™¨ï¼‰</p><p>å‘½ä»¤å¯çœ‹æ–‡æ¡£ï¼š<a href="https://book-consul-guide.vnzmi.com/">Consul ç®€ä»‹å’Œå¿«é€Ÿå…¥é—¨</a></p><h4 id="å¯åŠ¨ï¼š"><a href="#å¯åŠ¨ï¼š" class="headerlink" title="å¯åŠ¨ï¼š"></a>å¯åŠ¨ï¼š</h4><blockquote><p>nohup ./consul agent -dev &amp;</p></blockquote><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¯åŠ¨é›†ç¾¤ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨consulé›†ç¾¤ã€‚</p><h4 id="UIæŸ¥çœ‹"><a href="#UIæŸ¥çœ‹" class="headerlink" title="UIæŸ¥çœ‹"></a>UIæŸ¥çœ‹</h4><blockquote><p><a href="http://127.0.0.1:8500/">http://127.0.0.1:8500/</a></p></blockquote><h4 id="æŸ¥çœ‹èŠ‚ç‚¹"><a href="#æŸ¥çœ‹èŠ‚ç‚¹" class="headerlink" title="æŸ¥çœ‹èŠ‚ç‚¹"></a>æŸ¥çœ‹èŠ‚ç‚¹</h4><blockquote><p>./consul members</p></blockquote><blockquote><p>curl 127.0.0.1:8500/v1/catalog/nodes</p></blockquote><h4 id="æŸ¥çœ‹kvå€¼"><a href="#æŸ¥çœ‹kvå€¼" class="headerlink" title="æŸ¥çœ‹kvå€¼"></a>æŸ¥çœ‹kvå€¼</h4><blockquote><p>curl -v <a href="http://127.0.0.1:8500/v1/kv//?recurse">http://127.0.0.1:8500/v1/kv/\?recurse</a></p></blockquote><h4 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h4><blockquote><p>curl -X PUT -d â€˜{â€œweightâ€:20,â€max_failsâ€:2,â€fail_timeoutâ€:5}â€™ <a href="http://127.0.0.1:8500/v1/kv/upstreams/test-server/192.168.x.xxx:9502">http://127.0.0.1:8500/v1/kv/upstreams/test-server/192.168.x.xxx:9502</a></p></blockquote><p>æ­¤å¤„192.168.x.xxxæ˜¯å› ä¸ºæˆ‘åˆ›å»ºçš„dockerå®¹å™¨çš„å®¿ä¸»æœºipã€‚</p><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><blockquote><p>curl -X DELETE <a href="http://127.0.0.1:8500/v1/kv/upstreams/test-server/192.168.x.xxx:9502">http://127.0.0.1:8500/v1/kv/upstreams/test-server/192.168.x.xxx:9502</a></p></blockquote><hr><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å’Œåˆ é™¤æ¥æµ‹è¯•ï¼ŒæŸ¥çœ‹ <a href="http://127.0.0.1:8008/">http://127.0.0.1:8008/</a> æ¥æŸ¥çœ‹è¾“å‡ºï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹Nginxé‡Œçš„é…ç½®æ–‡ä»¶servers.confï¼Œä½ ä¼šçœ‹åˆ°ä½ æ“ä½œconsulï¼Œä¼šåŠ¨æ€æ”¹å˜Nginxçš„upstreamï¼Œè¿™æ ·å°±å®ç°äº†Nginxçš„åŠ¨æ€æ‰©å®¹ï¼Œç›¸æ¯”ä¸€ä¸ªä¸ªæ”¹é…ç½®è¦è½»æ¾ä¸€ç‚¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>consul</tag>
      
      <tag>SLB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxé…ç½®å¸¸ç”¨å‚æ•°</title>
    <link href="/2019/11/22/Nginx6/"/>
    <url>/2019/11/22/Nginx6/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åœ¨å…¨é¢å­¦ä¹ Nginxï¼Œå½“ä½œç¬”è®°äº†ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºæˆ–æ·±å…¥äº¤æµã€‚</p></blockquote><h2 id="ä¸»æ¨¡å—"><a href="#ä¸»æ¨¡å—" class="headerlink" title="ä¸»æ¨¡å—"></a>ä¸»æ¨¡å—</h2><div class="code-wrapper"><pre><code class="hljs vala"><span class="hljs-meta"># é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobodyã€‚</span><span class="hljs-meta">#user www www;  </span> #Nginxå¼€å¯çš„workerè¿›ç¨‹æ•°ï¼Œå»ºè®®ä¸ºCPUçš„æ ¸æ•°<span class="hljs-meta">#worker_processes 2; </span><span class="hljs-meta">#æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€</span><span class="hljs-meta">#pid /nginx/pid/nginx.pid;</span><span class="hljs-meta">#æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ã€httpå—ã€serverå—ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emerg</span>error_log log/error.log debug; <span class="hljs-meta">#å¯ä»¥åœ¨ä»»æ„åœ°æ–¹ä½¿ç”¨includeæŒ‡ä»¤å®ç°é…ç½®æ–‡ä»¶çš„åŒ…å«ï¼Œç±»ä¼¼äºapacheä¸­çš„includeæ–¹æ³•ï¼Œå¯å‡å°‘ä¸»é…ç½®æ–‡ä»¶é•¿åº¦ã€‚</span>include vhosts<span class="hljs-comment">/*.conf;</span></code></pre></div><h2 id="äº‹ä»¶æ¨¡å—"><a href="#äº‹ä»¶æ¨¡å—" class="headerlink" title="äº‹ä»¶æ¨¡å—"></a>äº‹ä»¶æ¨¡å—</h2><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-section">events</span> &#123;    <span class="hljs-comment">#è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon</span>    <span class="hljs-attribute">accept_mutex</span> <span class="hljs-literal">on</span>;         <span class="hljs-comment">#é»˜è®¤: 500ms å¦‚æœä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰äº’æ–¥é”ï¼Œå®ƒå°†å»¶è¿Ÿè‡³å°‘å¤šé•¿æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå»¶è¿Ÿæ˜¯500ms ã€‚</span>    <span class="hljs-attribute">accept_mutex_delay</span> <span class="hljs-number">100ms</span>;         <span class="hljs-comment">#è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff</span>    <span class="hljs-attribute">multi_accept</span> <span class="hljs-literal">on</span>;        <span class="hljs-comment">#äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventportï¼Œä¸å»ºè®®è®¾ç½®ï¼Œnginxä¼šè‡ªè¡Œé€‰æ‹©</span>    <span class="hljs-comment">#use epoll;</span>        <span class="hljs-comment">#æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512</span>    <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;&#125;</code></pre></div><h2 id="httpéƒ¨åˆ†"><a href="#httpéƒ¨åˆ†" class="headerlink" title="httpéƒ¨åˆ†"></a>httpéƒ¨åˆ†</h2><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-section">http</span> &#123;    <span class="hljs-comment">#æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨</span>    <span class="hljs-attribute">include</span>       mime.types;        <span class="hljs-comment"># é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain</span>    <span class="hljs-attribute">default_type</span>  application/octet-stream;         <span class="hljs-comment">#å–æ¶ˆæœåŠ¡æ—¥å¿— </span>    <span class="hljs-comment">#access_log off; </span>        <span class="hljs-comment">#å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚</span>    <span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;           <span class="hljs-comment">#æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚</span>    <span class="hljs-attribute">sendfile_max_chunk</span> <span class="hljs-number">100k</span>;          <span class="hljs-comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚</span>    <span class="hljs-attribute">keepalive_timeout</span> <span class="hljs-number">65</span>;          <span class="hljs-comment">#å¼€å¯gzipèµ„æºå‹ç¼©</span>    <span class="hljs-attribute">gzip</span>  <span class="hljs-literal">on</span>;         <span class="hljs-comment"># è´Ÿè½½å‡è¡¡ï¼Œè¯¦ç»†å¯çœ‹äº†ä¸€ç¯‡æ–‡ç« ï¼šhttps://learnku.com/articles/36737</span>    <span class="hljs-attribute">upstream</span> blog &#123;           <span class="hljs-attribute">server</span> <span class="hljs-number">192.167.20.19:8081</span>;        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.10.121:8080</span> weight=<span class="hljs-number">5</span>;    &#125;        <span class="hljs-comment">#è®¾å®šè¯·æ±‚ç¼“å†²</span>    <span class="hljs-attribute">client_header_buffer_size</span>    <span class="hljs-number">128k</span>;    <span class="hljs-attribute">large_client_header_buffers</span>  <span class="hljs-number">4</span> <span class="hljs-number">128k</span>;        <span class="hljs-comment">#ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶  é»˜è®¤1m</span>    <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">8m</span>;    <span class="hljs-section">server</span> &#123;        <span class="hljs-comment">#å•è¿æ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚</span>        <span class="hljs-attribute">keepalive_requests</span> <span class="hljs-number">120</span>;                <span class="hljs-comment">#ç›‘å¬ç«¯å£</span>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;                   <span class="hljs-comment">#ç›‘å¬åœ°å€</span>        <span class="hljs-attribute">server_name</span>  blog.13sai.com;                  <span class="hljs-comment">#è®¾å®šæ—¥å¿—æ ¼å¼</span>        <span class="hljs-attribute">log_format</span>  main  <span class="hljs-string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span>                      <span class="hljs-string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span>                      <span class="hljs-string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;                              <span class="hljs-attribute">access_log</span>  /data/logs/access.log  main;                <span class="hljs-comment"># æ ¹ç›®å½•</span>        <span class="hljs-attribute">root</span> /www/web/public;                 <span class="hljs-comment"># å®šä¹‰é”™è¯¯æç¤ºé¡µé¢</span>        <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /50x.html;                        <span class="hljs-attribute">location</span> /static/ &#123;            <span class="hljs-comment">#rootä¸aliasä¸»è¦åŒºåˆ«åœ¨äºnginxå¦‚ä½•è§£é‡Šlocationåé¢çš„uriï¼Œè¿™ä¼šä½¿ä¸¤è€…åˆ†åˆ«ä»¥ä¸åŒçš„æ–¹å¼å°†è¯·æ±‚æ˜ å°„åˆ°æœåŠ¡å™¨æ–‡ä»¶ä¸Šã€‚</span>            <span class="hljs-comment">#rootçš„å¤„ç†ç»“æœæ˜¯ï¼šrootè·¯å¾„ï¼‹locationè·¯å¾„</span>            <span class="hljs-comment">#aliasçš„å¤„ç†ç»“æœæ˜¯ï¼šä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„</span>            <span class="hljs-attribute">alias</span> /www/static/;                        <span class="hljs-comment">#è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹,å¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚</span>            <span class="hljs-attribute">expires</span> <span class="hljs-number">30d</span>;        &#125;                <span class="hljs-comment"># å¤„ç†phpè¯·æ±‚åˆ°fpmç«¯å£</span>        <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ \.php$</span> &#123;            <span class="hljs-attribute">fastcgi_pass</span>   <span class="hljs-number">127.0.0.1:9000</span>;            <span class="hljs-attribute">fastcgi_index</span>  index.php;            <span class="hljs-attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;            <span class="hljs-attribute">include</span>        fastcgi_params;        &#125;                <span class="hljs-attribute">location</span> / &#123;            <span class="hljs-attribute">proxy_set_header</span> Host $host;            <span class="hljs-attribute">proxy_set_header</span>  X-Real-IP  $remote_addr;            <span class="hljs-attribute">proxy_pass</span>  http://blog;  <span class="hljs-comment">#è¯·æ±‚è½¬å‘blog å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ </span>        &#125;                <span class="hljs-comment">#ç¦æ­¢è®¿é—®æ–‡ä»¶</span>        <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ /.git</span> &#123;            <span class="hljs-attribute">deny</span> all;            <span class="hljs-attribute">allow</span> <span class="hljs-number">127.0.0.1</span>; <span class="hljs-comment">#å…è®¸çš„ip </span>        &#125;    &#125;&#125;</code></pre></div><h2 id="éƒ¨åˆ†å‚æ•°è¯¦ç»†è¯´æ˜"><a href="#éƒ¨åˆ†å‚æ•°è¯¦ç»†è¯´æ˜" class="headerlink" title="éƒ¨åˆ†å‚æ•°è¯¦ç»†è¯´æ˜"></a>éƒ¨åˆ†å‚æ•°è¯¦ç»†è¯´æ˜</h2><h4 id="server-name"><a href="#server-name" class="headerlink" title="server_name"></a>server_name</h4><div class="code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-number">1.</span>é¦–å…ˆé€‰æ‹©æ‰€æœ‰å­—ç¬¦ä¸²å®Œå…¨åŒ¹é…çš„server_nameï¼Œå¦‚ blog<span class="hljs-number">.13</span>sai.com ã€‚<span class="hljs-number">2.</span>å…¶æ¬¡é€‰æ‹©é€šé…ç¬¦åœ¨å‰é¢çš„server_nameï¼Œå¦‚ *<span class="hljs-number">.13</span>sai.comã€‚<span class="hljs-number">3.</span>å†æ¬¡é€‰æ‹©é€šé…ç¬¦åœ¨åé¢çš„server_nameï¼Œå¦‚www<span class="hljs-number">.13</span>sai.* ã€‚ <span class="hljs-number">4.</span>æœ€åé€‰æ‹©ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ‰åŒ¹é…çš„server_nameï¼Œå¦‚ ~^\.sai\.com$å¦‚æœéƒ½ä¸åŒ¹é…<span class="hljs-number">1</span>ã€ä¼˜å…ˆé€‰æ‹©<span class="hljs-keyword">listen</span>é…ç½®é¡¹åæœ‰<span class="hljs-keyword">default</span>æˆ–default_serverçš„ <span class="hljs-number">2</span>ã€æ‰¾åˆ°åŒ¹é…<span class="hljs-keyword">listen</span>ç«¯å£çš„ç¬¬ä¸€ä¸ª<span class="hljs-keyword">server</span>å—</code></pre></div><h4 id="location"><a href="#location" class="headerlink" title="location"></a>location</h4><div class="code-wrapper"><pre><code class="hljs nim">locationè¯­æ³•: location[=|~|~*|^~|@]/uri/<span class="hljs-meta">&#123;...&#125;</span>é…ç½®å—: server locationä¼šå°è¯•æ ¹æ®ç”¨æˆ·è¯·æ±‚ä¸­çš„<span class="hljs-type">URI</span>æ¥åŒ¹é…ä¸Šé¢çš„/uriè¡¨è¾¾å¼ï¼Œå¦‚æœå¯ä»¥åŒ¹é…ï¼Œå°±é€‰æ‹© location&#123;&#125;å—ä¸­çš„é…ç½®æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚</code></pre></div><p>locationè¡¨è¾¾å¼ç±»å‹</p><div class="code-wrapper"><pre><code class="hljs asciidoc">~ è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™;~* è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™;^~ è¡¨ç¤ºæ™®é€šå­—ç¬¦åŒ¹é…ã€‚ä½¿ç”¨å‰ç¼€åŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†åŒ¹é…å…¶ä»–location; <span class="hljs-section">= è¿›è¡Œæ™®é€šå­—ç¬¦ç²¾ç¡®åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯å®Œå…¨åŒ¹é…;</span>@ å®ƒå®šä¹‰ä¸€ä¸ªå‘½åçš„ locationï¼Œä½¿ç”¨åœ¨å†…éƒ¨å®šå‘æ—¶ï¼Œä¾‹å¦‚ error_page, try_files</code></pre></div><p>ä¼˜å…ˆçº§:</p><ul><li>ç­‰å·ç±»å‹(=)çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†æŸ¥æ‰¾å…¶ä»–åŒ¹é…é¡¹ </li><li>å‰ç¼€æ™®é€šåŒ¹é…(^~)ä¼˜å…ˆçº§æ¬¡ä¹‹ã€‚ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚ä½¿ç”¨å‰ç¼€åŒ¹é…ï¼Œå¦‚æœæœ‰å¤šä¸ªlocationåŒ¹é…çš„è¯ï¼Œåˆ™ä½¿ç”¨è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ª </li><li>æ­£åˆ™è¡¨è¾¾å¼ç±»å‹(~ ~*)çš„ä¼˜å…ˆçº§æ¬¡ä¹‹ã€‚ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†æŸ¥æ‰¾å…¶ä»–åŒ¹é…é¡¹ </li><li>å¸¸è§„å­—ç¬¦ä¸²åŒ¹é…ï¼Œå¦‚æœæœ‰å¤šä¸ªlocationåŒ¹é…çš„è¯ï¼Œåˆ™ä½¿ç”¨è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ª</li></ul><blockquote><p>(location =) &gt; (location å®Œæ•´è·¯å¾„) &gt; (location ^~ è·¯å¾„) &gt; (location <del>,</del>* æ­£åˆ™é¡ºåº) &gt; (location éƒ¨åˆ†èµ·å§‹è·¯å¾„)</p></blockquote><h4 id="return"><a href="#return" class="headerlink" title="return"></a>return</h4><div class="code-wrapper"><pre><code class="hljs oxygene">è¯­æ³•:return code [text] return code URL;return URL;é…ç½®å—:serverï¼Œlocationï¼Œ<span class="hljs-keyword">if</span>è¯¥æŒ‡ä»¤ç”¨äºç»“æŸè§„åˆ™çš„æ‰§è¡Œå¹¶è¿”å›çŠ¶æ€å—ç»™å®¢æˆ·ç«¯ã€‚çŠ¶æ€ç åŒ…æ‹¬:<span class="hljs-number">204</span>(No Content)ã€<span class="hljs-number">400</span>(Bad Request)ã€<span class="hljs-number">402</span>(Payment Required)ã€<span class="hljs-number">403</span>(Forbidden) <span class="hljs-number">404</span>(<span class="hljs-keyword">Not</span> Found)ã€<span class="hljs-number">405</span>(<span class="hljs-function"><span class="hljs-keyword">Method</span> <span class="hljs-title">Not</span> <span class="hljs-title">Allowed</span>)ã€</span><span class="hljs-function">406<span class="hljs-params">(<span class="hljs-keyword">Not</span> Acceptable)</span>ã€ </span><span class="hljs-function">408<span class="hljs-params">(Request Timeout)</span>ã€</span><span class="hljs-function">410<span class="hljs-params">(Gone)</span>ã€</span><span class="hljs-function">411<span class="hljs-params">(Length Required)</span>ã€</span><span class="hljs-function">413<span class="hljs-params">(Request Entity Too Large)</span>ã€</span><span class="hljs-function">416<span class="hljs-params">(Requested Range <span class="hljs-keyword">Not</span> Satisfiable)</span>ã€ 500<span class="hljs-params">(Internal Server Error)</span>ã€</span><span class="hljs-function">501<span class="hljs-params">(<span class="hljs-keyword">Not</span> Implemented)</span>ã€</span><span class="hljs-function">502<span class="hljs-params">(Bad Gateway)</span>ã€ </span><span class="hljs-function">503<span class="hljs-params">(Service Unavailable)</span></span><span class="hljs-function">504<span class="hljs-params">(Gateway Timeout)</span>ã€‚</span><span class="hljs-function"></span><span class="hljs-function">ä¾‹å¦‚ï¼Œç¤ºä¾‹ï¼Œå¦‚æœè®¿é—®çš„<span class="hljs-title">URL</span>ä»¥.<span class="hljs-title">sh</span> .<span class="hljs-title">bash</span> ç»“å°¾ï¼Œè¿”å›çŠ¶æ€ç 403 </span><span class="hljs-function"><span class="hljs-title">location</span> ~ .*\.<span class="hljs-params">(sh|bash)</span>?$ <span class="hljs-comment">&#123;</span></span><span class="hljs-comment"><span class="hljs-function">return 403;</span></span><span class="hljs-comment"><span class="hljs-function">&#125;</span></span></code></pre></div><h4 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h4><div class="code-wrapper"><pre><code class="hljs pgsql">æ‰§è¡Œé¡ºåºï¼š<span class="hljs-number">1.</span> æ‰§è¡Œ<span class="hljs-keyword">server</span>å—çš„rewriteæŒ‡ä»¤(è¿™é‡Œçš„å—æŒ‡çš„æ˜¯<span class="hljs-keyword">server</span>å…³é”®å­—å&#123;&#125;åŒ…å›´çš„åŒºåŸŸï¼Œå…¶å®ƒxxå—ç±»ä¼¼)<span class="hljs-number">2.</span> æ‰§è¡Œ<span class="hljs-keyword">location</span>åŒ¹é…<span class="hljs-number">3.</span> æ‰§è¡Œé€‰å®šçš„<span class="hljs-keyword">location</span>ä¸­çš„rewriteæŒ‡ä»¤å¦‚æœå…¶ä¸­æŸæ­¥URIè¢«é‡å†™ï¼Œåˆ™é‡æ–°å¾ªç¯æ‰§è¡Œ<span class="hljs-number">1</span><span class="hljs-number">-3</span>ï¼Œç›´åˆ°æ‰¾åˆ°çœŸå®å­˜åœ¨çš„æ–‡ä»¶å¦‚æœå¾ªç¯è¶…è¿‡<span class="hljs-number">10</span>æ¬¡ï¼Œåˆ™è¿”å›<span class="hljs-number">500</span> <span class="hljs-type">Internal</span> <span class="hljs-keyword">Server</span> Erroré”™è¯¯è¯­æ³•:rewrite regex replacement [flag]; é»˜è®¤å€¼:â€”é…ç½®å—:<span class="hljs-keyword">server</span>, <span class="hljs-keyword">location</span>, <span class="hljs-keyword">if</span>rewriteæ˜¯å®ç°URLé‡å†™çš„å…³é”®æŒ‡ä»¤ï¼Œæ ¹æ®regex(æ­£åˆ™è¡¨è¾¾å¼)éƒ¨åˆ†å†…å®¹ï¼Œé‡å®šå‘åˆ°replacementï¼Œç»“å°¾æ˜¯flagæ ‡è®°ã€‚ æ­£åˆ™:perlå…¼å®¹æ­£åˆ™è¡¨è¾¾å¼è¯­å¥è¿›è¡Œè§„åˆ™åŒ¹é…æ›¿ä»£å†…å®¹:å°†æ­£åˆ™åŒ¹é…çš„å†…å®¹æ›¿æ¢æˆreplacementflagæ ‡è®°:rewriteæ”¯æŒçš„flagæ ‡è®°</code></pre></div><h6 id="ifæŒ‡ä»¤"><a href="#ifæŒ‡ä»¤" class="headerlink" title="ifæŒ‡ä»¤"></a>ifæŒ‡ä»¤</h6><div class="code-wrapper"><pre><code class="hljs llvm">è¯­æ³•ï¼šif(condition)&#123;...&#125;é»˜è®¤å€¼ï¼šæ— é…ç½®å—ï¼šserver<span class="hljs-punctuation">,</span>locationå¯¹ç»™å®šçš„æ¡ä»¶conditionè¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœä¸ºçœŸï¼Œå¤§æ‹¬å·å†…çš„rewriteæŒ‡ä»¤å°†è¢«æ‰§è¡Œã€‚ifæ¡ä»¶(conditon)å¯ä»¥æ˜¯å¦‚ä¸‹ä»»ä½•å†…å®¹:ä¸€ä¸ªå˜é‡åï¼›<span class="hljs-keyword">false</span>å¦‚æœè¿™ä¸ªå˜é‡æ˜¯ç©ºå­—ç¬¦ä¸²æˆ–è€…ä»¥<span class="hljs-number">0</span>å¼€å§‹çš„å­—ç¬¦ä¸²ï¼›ä½¿ç”¨<span class="hljs-operator">=</span> <span class="hljs-punctuation">,</span>!<span class="hljs-operator">=</span> æ¯”è¾ƒçš„ä¸€ä¸ªå˜é‡å’Œå­—ç¬¦ä¸²æ˜¯ç”¨~ï¼Œ ~*ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å˜é‡ï¼Œå¦‚æœè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ…å«&#125;ï¼Œ<span class="hljs-comment">;åˆ™æ•´ä¸ªè¡¨è¾¾å¼éœ€è¦ç”¨&quot; æˆ–&#x27; åŒ…å›´</span>ä½¿ç”¨-f ï¼Œ<span class="hljs-title">!-f</span> æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨-d<span class="hljs-punctuation">,</span> <span class="hljs-title">!-d</span> æ£€æŸ¥ä¸€ä¸ªç›®å½•æ˜¯å¦å­˜åœ¨ä½¿ç”¨-e ï¼Œ<span class="hljs-title">!-e</span> æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥æ˜¯å¦å­˜åœ¨ä½¿ç”¨-<span class="hljs-keyword">x</span> ï¼Œ <span class="hljs-title">!-x</span> æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ</code></pre></div><h6 id="ifå®ä¾‹"><a href="#ifå®ä¾‹" class="headerlink" title="ifå®ä¾‹"></a>ifå®ä¾‹</h6><div class="code-wrapper"><pre><code class="hljs coq"><span class="hljs-keyword">if</span> ($http_user_agent~*(mobile|<span class="hljs-type">nokia</span>|<span class="hljs-type">iphone</span>|<span class="hljs-type">ipad</span>|<span class="hljs-type">android</span>|<span class="hljs-type">samsung</span>|<span class="hljs-type">htc</span>|<span class="hljs-type">blackberry</span>)) &#123;    <span class="hljs-built_in">rewrite</span> ^.+ /mobile last; ï¼ƒè·³è½¬åˆ°æ‰‹æœºç«™&#125;<span class="hljs-keyword">if</span> ($request_method = POST) &#123;    <span class="hljs-keyword">return</span> <span class="hljs-number">405</span>;&#125;<span class="hljs-keyword">if</span> ($slow) &#123;    limit_rate <span class="hljs-number">10</span>k;&#125;<span class="hljs-keyword">if</span> ($invalid_referer) &#123;    <span class="hljs-keyword">return</span> <span class="hljs-number">403</span>;&#125;</code></pre></div><h6 id="last-amp-break"><a href="#last-amp-break" class="headerlink" title="last &amp; break"></a>last &amp; break</h6><div class="code-wrapper"><pre><code class="hljs crmsh">ï¼ˆ<span class="hljs-number">1</span>ï¼‰last å’Œ break å½“å‡ºç°åœ¨<span class="hljs-keyword">location</span> <span class="hljs-title">ä¹‹å¤–æ—¶ï¼Œä¸¤è€…çš„ä½œç”¨æ˜¯ä¸€è‡´çš„æ²¡æœ‰ä»»ä½•å·®å¼‚ã€‚</span><span class="hljs-title">æ³¨æ„ä¸€ç‚¹å°±æ˜¯ï¼Œä»–ä»¬ä¼šè·³è¿‡æ‰€æœ‰çš„åœ¨ä»–ä»¬ä¹‹åçš„rewrite</span> æ¨¡å—ä¸­çš„æŒ‡ä»¤ï¼Œå»é€‰æ‹©è‡ªå·±åŒ¹é…çš„<span class="hljs-keyword">location</span><span class="hljs-title">ï¼ˆ2</span>ï¼‰last å’Œ break å½“å‡ºç°åœ¨<span class="hljs-keyword">location</span> <span class="hljs-title">å†…éƒ¨æ—¶ï¼Œä¸¤è€…å°±å­˜åœ¨äº†å·®å¼‚</span><span class="hljs-title">-- last</span>: ä½¿ç”¨äº†last æŒ‡ä»¤ï¼Œrewrite åä¼šè·³å‡º<span class="hljs-keyword">location</span> <span class="hljs-title">ä½œç”¨åŸŸï¼Œé‡æ–°å¼€å§‹å†èµ°ä¸€æ¬¡åˆšåˆšçš„è¡Œä¸º</span><span class="hljs-title">-- break</span>: ä½¿ç”¨äº†break æŒ‡ä»¤ï¼Œrewriteåä¸ä¼šè·³å‡º<span class="hljs-keyword">location</span> <span class="hljs-title">ä½œç”¨åŸŸã€‚å®ƒçš„ç”Ÿå‘½ä¹Ÿåœ¨è¿™ä¸ªlocation</span>ä¸­ç»ˆç»“ã€‚è§£é‡Šé€šä¿—æ˜“æ‡‚ï¼šlastï¼š        é‡æ–°å°†rewriteåçš„åœ°å€åœ¨serveræ ‡ç­¾ä¸­æ‰§è¡Œbreakï¼š        å°†rewriteåçš„åœ°å€åœ¨å½“å‰locationæ ‡ç­¾ä¸­æ‰§è¡Œ</code></pre></div><h6 id="permanent-amp-redirect"><a href="#permanent-amp-redirect" class="headerlink" title="permanent &amp; redirect:"></a>permanent &amp; redirect:</h6><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">permanent</span>: æ°¸ä¹…æ€§é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º<span class="hljs-number">301</span><span class="hljs-attribute">redirect</span>:ä¸´æ—¶é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º<span class="hljs-number">302</span></code></pre></div><p>ä»å®ç°åŠŸèƒ½çš„è§’åº¦ä¸Šå»çœ‹ï¼Œpermanent å’Œ redirect æ˜¯ä¸€æ ·çš„ã€‚ä¸å­˜åœ¨å¥½åã€‚ä¹Ÿä¸å­˜åœ¨ä»€ä¹ˆæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚ä½†æ˜¯å¯¹seoä¼šæœ‰å½±å“ï¼Œè¿™é‡Œè¦æ ¹æ®éœ€è¦åšå‡ºé€‰æ‹©<br>åœ¨ permanent å’Œ redirect  ä¸­æåˆ°äº† çŠ¶æ€ç  301 å’Œ 302ã€‚ </p><p>è®°ä½ï¼šlast å’Œ break æƒ³å¯¹äºçš„è®¿é—®æ—¥å¿—çš„è¯·æ±‚çŠ¶æ€ç ä¸º200</p><p>å½“ä½ æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼ŒåŒæ—¶æ‰“å¼€debug æ¨¡å¼æ—¶ï¼Œä¼šå‘ç°301 å’Œ 302 æ—¶çš„è¡Œä¸ºæ˜¯è¿™æ ·çš„ã€‚</p><p>ç¬¬ä¸€ä¸ªè¯·æ±‚301 æˆ–è€… 302 åï¼Œæµè§ˆå™¨é‡æ–°è·å–äº†ä¸€ä¸ªæ–°çš„URL ï¼Œç„¶åä¼šå¯¹è¿™ä¸ªæ–°çš„URL é‡æ–°è¿›è¡Œè®¿é—®ã€‚æ‰€ä»¥å½“ä½ é…ç½®çš„æ˜¯permanent å’Œ redirect ,ä½ å¯¹ä¸€ä¸ªURL çš„è®¿é—®è¯·æ±‚ï¼Œè½åˆ°æœåŠ¡å™¨ä¸Šè‡³å°‘ä¸º2æ¬¡ï¼›è€Œå½“ä½ é…ç½®äº†last æˆ–è€…æ˜¯break æ—¶ï¼Œä½ æœ€ç»ˆçš„URL ç¡®å®šä¸‹æ¥åï¼Œä¸ä¼šå°†è¿™ä¸ªURLè¿”å›ç»™æµè§ˆå™¨ï¼Œè€Œæ˜¯å°†å…¶æ‰”ç»™äº†fastcgi_passæˆ–è€…æ˜¯proxy_passæŒ‡ä»¤å»å¤„ç†ã€‚è¯·æ±‚ä¸€ä¸ªURL ï¼Œè½åˆ°æœåŠ¡å™¨ä¸Šçš„æ¬¡æ•°å°±ä¸º1æ¬¡ã€‚</p><p>æ³¨æ„ï¼šé…ç½®last åœ¨è·¨åŸŸçš„æ—¶å€™æ•ˆæœå’Œredirectä¸€è‡´ï¼Œéƒ½æ˜¯è¿”å›302çŠ¶æ€ç ï¼Œè¯·æ±‚åœ°å€ä¹Ÿå‘ç”Ÿæ”¹å˜</p><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><h4 id="ä¼°ç®—å¹¶å‘"><a href="#ä¼°ç®—å¹¶å‘" class="headerlink" title="ä¼°ç®—å¹¶å‘"></a>ä¼°ç®—å¹¶å‘</h4><p>nginxä½œä¸ºhttpæœåŠ¡å™¨çš„æ—¶å€™ï¼š</p><div class="code-wrapper"><pre><code class="hljs">max_clients = worker_processes * worker_connections/2</code></pre></div><p>nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼š</p><div class="code-wrapper"><pre><code class="hljs">max_clients = worker_processes * worker_connections/4  </code></pre></div><h4 id="é™åˆ¶æ¯ä¸ªIPçš„å¹¶å‘è¿æ¥æ•°"><a href="#é™åˆ¶æ¯ä¸ªIPçš„å¹¶å‘è¿æ¥æ•°" class="headerlink" title="é™åˆ¶æ¯ä¸ªIPçš„å¹¶å‘è¿æ¥æ•°"></a>é™åˆ¶æ¯ä¸ªIPçš„å¹¶å‘è¿æ¥æ•°</h4><p>demo:å®šä¹‰ä¸€ä¸ªå«â€œtwoâ€çš„è®°å½•åŒºï¼Œæ€»å®¹é‡ä¸º 10Mï¼ˆè¶…è¿‡å¤§å°å°†è¯·æ±‚å¤±è´¥ï¼Œä»¥å˜é‡ $binary_remote_addr ä½œä¸ºä¼šè¯çš„åˆ¤æ–­åŸºå‡†ï¼ˆå³ä¸€ä¸ªåœ°å€ä¸€ä¸ªä¼šè¯ï¼‰ã€‚ é™åˆ¶ /download/ ç›®å½•ä¸‹ï¼Œä¸€ä¸ªä¼šè¯åªèƒ½è¿›è¡Œä¸€ä¸ªè¿æ¥ã€‚ ç®€å•ç‚¹ï¼Œå°±æ˜¯é™åˆ¶ /download/ ç›®å½•ä¸‹ï¼Œä¸€ä¸ªIPåªèƒ½å‘èµ·ä¸€ä¸ªè¿æ¥ï¼Œå¤šè¿‡ä¸€ä¸ªï¼Œä¸€å¾‹503ã€‚</p><div class="code-wrapper"><pre><code class="hljs routeros">http &#123;    <span class="hljs-built_in">..</span>.    limit_conn_zone <span class="hljs-variable">$binary_remote_addr</span> <span class="hljs-attribute">zone</span>=two:10m;   <span class="hljs-built_in"> server </span>&#123;        <span class="hljs-built_in">..</span>.                location /download &#123;            limit_conn   two  1;        &#125;    &#125;&#125;</code></pre></div><h4 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h4><p>demo:å®šä¹‰ä¸€ä¸ªå«â€œoneâ€çš„è®°å½•åŒºï¼Œå ç”¨ç©ºé—´å¤§å°ä¸º10mï¼ˆè¶…è¿‡å¤§å°å°†è¯·æ±‚å¤±è´¥ï¼‰ï¼Œå¹³å‡å¤„ç†çš„è¯·æ±‚é¢‘ç‡ä¸èƒ½è¶…è¿‡æ¯ç§’ä¸€æ¬¡ï¼Œä¹Ÿå¯ä»¥è®¾ç½®åˆ†é’Ÿé€Ÿç‡</p><div class="code-wrapper"><pre><code class="hljs routeros">http &#123;    <span class="hljs-built_in">..</span>.            limit_req_zone  <span class="hljs-variable">$binary_remote_addr</span>  <span class="hljs-attribute">zone</span>=one:10m  <span class="hljs-attribute">rate</span>=1r/s;       <span class="hljs-built_in"> server </span>&#123;        <span class="hljs-built_in">..</span>.                location / &#123;            #ç¼“å­˜åŒºé˜Ÿåˆ—<span class="hljs-attribute">burst</span>=5ä¸ª,nodelayè¡¨ç¤ºä¸å»¶æœŸ(è¶…è¿‡çš„è¯·æ±‚å¤±è´¥)ï¼Œå³æ¯ç§’æœ€å¤šå¯å¤„ç†rate+burstä¸ª,åŒæ—¶å¤„ç†rateä¸ªã€‚            limit_req <span class="hljs-attribute">zone</span>=one <span class="hljs-attribute">burst</span>=5 nodelay;         &#125;    &#125;&#125;</code></pre></div><h4 id="ç™½åå•"><a href="#ç™½åå•" class="headerlink" title="ç™½åå•"></a>ç™½åå•</h4><div class="code-wrapper"><pre><code class="hljs php">http&#123;    ...        <span class="hljs-comment">#åˆ¤æ–­å®¢æˆ·ç«¯çš„ipåœ°å€æ˜¯å¦åœ¨ç™½åå•åˆ—è¡¨å½“ä¸­,å¦‚æœè¿”å›ä¸º0,åˆ™åœ¨ç™½åå•åˆ—è¡¨å½“ä¸­,å¦åˆ™è¿”å›ä¸º1</span>    geo <span class="hljs-variable">$whiteIpList</span> &#123;        <span class="hljs-keyword">default</span>  <span class="hljs-number">1</span>;        <span class="hljs-number">118.24</span>.<span class="hljs-number">109.254</span> <span class="hljs-number">0</span>;        <span class="hljs-number">47.98</span>.<span class="hljs-number">147.0</span>/<span class="hljs-number">24</span> <span class="hljs-number">1</span>;        <span class="hljs-comment">#å¯ä»¥å¼•å…¥ä¸€äº›ç™½åå•é…ç½®</span>        <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;whiteIP.conf&#x27;</span>    &#125;        <span class="hljs-comment">#å¦‚æœä¸åœ¨ç™½åå•ä¹‹å†…,è¿”å›å®¢æˆ·ç«¯çš„äºŒè¿›åˆ¶çš„ipåœ°å€</span>    map <span class="hljs-variable">$whiteIpList</span>  <span class="hljs-variable">$limit</span> &#123;        <span class="hljs-keyword">default</span>  <span class="hljs-string">&quot;&quot;</span>;        <span class="hljs-number">1</span>   <span class="hljs-variable">$binary_remote_addr</span>;        <span class="hljs-number">0</span>   <span class="hljs-string">&quot;&quot;</span>;    &#125;        <span class="hljs-comment">#å¦‚æœè¿”å›çš„æ˜¯ç©ºå­—ç¬¦ä¸²é‚£ä¹ˆé€Ÿç‡é™åˆ¶ä¼šå¤±æ•ˆ</span>    limit_req_zone <span class="hljs-variable">$limit</span> zone=test:<span class="hljs-number">2</span>m rate=<span class="hljs-number">1</span>r/m;        ...&#125;</code></pre></div><h4 id="é˜²ç›—é“¾"><a href="#é˜²ç›—é“¾" class="headerlink" title="é˜²ç›—é“¾"></a>é˜²ç›—é“¾</h4><div class="code-wrapper"><pre><code class="hljs coq">http &#123;    ...    server &#123;        ...                location ~* \.(gif|<span class="hljs-type">jpg</span>|<span class="hljs-type">png</span>|<span class="hljs-type">swf</span>|<span class="hljs-type">flv</span>)$ &#123;            valid_referers none blocked *<span class="hljs-number">.13</span>sai.com;            <span class="hljs-keyword">if</span> ($invalid_referer) &#123;                <span class="hljs-built_in">rewrite</span> ^/ blog<span class="hljs-number">.13</span>sai.com            &#125;        &#125;    &#125;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxä»£ç†ç¼“å­˜</title>
    <link href="/2019/11/22/Nginx1/"/>
    <url>/2019/11/22/Nginx1/</url>
    
    <content type="html"><![CDATA[<p>Nginxçš„ç¼“å­˜å¯ä»¥ç®€å•åˆ†æˆwebç¼“å­˜å’Œä»£ç†ç¼“å­˜ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä»£ç†ç¼“å­˜ã€‚</p><h2 id="webç¼“å­˜"><a href="#webç¼“å­˜" class="headerlink" title="webç¼“å­˜"></a>webç¼“å­˜</h2><p>Nginxæä¾›äº†expiresã€etagã€if-modified-sinceæŒ‡ä»¤æ¥å®ç°æµè§ˆå™¨ç¼“å­˜æ§åˆ¶ã€‚</p><p>è¿™ä¸ªé…ç½®æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬å¯ä»¥ç¼“å­˜ä¸€äº›jsã€cssç­‰é™æ€æ–‡ä»¶ã€‚</p><p>å¯¹äºè¿™å‡ ä¸ªä¸æƒ³åšè¿‡å¤šè¯´æ˜ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸¤å¼ å›¾ï¼Œç®€å•ç†è§£ä¸‹ã€‚</p><p><img src="https://cdn.learnku.com/uploads/images/201911/19/41489/ZEbgycTmrL.png!/fw/1240" alt="æµè§ˆå™¨ç¼“å­˜"></p><p><img src="https://cdn.learnku.com/uploads/images/201911/20/41489/Vo6VBgbiUr.png!/fw/1240" alt="Nginx ä»£ç†ç¼“å­˜"></p><h2 id="ä»£ç†ç¼“å­˜"><a href="#ä»£ç†ç¼“å­˜" class="headerlink" title="ä»£ç†ç¼“å­˜"></a>ä»£ç†ç¼“å­˜</h2><p>ä»£ç†ç¼“å­˜ä¸»è¦ç”¨åˆ°proxyæ¨¡å—ä¸­çš„proxy_cacheã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªdemoã€‚</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">upstream</span> 13sai&#123;    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:9501</span> weight=<span class="hljs-number">10</span>;&#125;<span class="hljs-comment">#è‡ªå®šä¹‰ç¼“å­˜ç›®å½•,ç¼“å­˜æ–‡ä»¶å¤§å°</span><span class="hljs-attribute">proxy_cache_path</span>  /usr/local/etc/nginx/cache  levels=<span class="hljs-number">1</span>:<span class="hljs-number">2</span>  keys_zone=sai_cache:<span class="hljs-number">10m</span>  max_size=<span class="hljs-number">200m</span> inactive=<span class="hljs-number">10m</span>  use_temp_path=<span class="hljs-literal">off</span>;<span class="hljs-section">server</span> &#123;    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;    <span class="hljs-attribute">server_name</span>  nginx-t.com;    <span class="hljs-attribute">location</span> / &#123;        <span class="hljs-attribute">proxy_next_upstream</span> <span class="hljs-literal">error</span> http_503;        <span class="hljs-attribute">proxy_pass</span> http://13sai;        <span class="hljs-comment">#å¯ç”¨ç¼“å­˜sai_cache</span>        <span class="hljs-attribute">proxy_cache</span> sai_cache;         <span class="hljs-comment">#å®šä¹‰å¦‚ä½•ç”Ÿæˆç¼“å­˜çš„é”®</span>        <span class="hljs-attribute">proxy_cache_key</span> $scheme$proxy_host$uri$is_args$args;        <span class="hljs-comment">#é’ˆå¯¹å¤šç§è¯·æ±‚æ–¹æ³•ç¼“å­˜ï¼Œé»˜è®¤GET HEAD</span>        <span class="hljs-attribute">proxy_cache_methods</span> GET HEAD POST;         <span class="hljs-comment">#ä¸ºä¸åŒçš„å“åº”çŠ¶æ€ç è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ã€‚</span>        <span class="hljs-attribute">proxy_cache_valid</span> <span class="hljs-number">200</span> <span class="hljs-number">302</span> <span class="hljs-number">10m</span>;        <span class="hljs-attribute">proxy_cache_valid</span> <span class="hljs-number">404</span>      <span class="hljs-number">1m</span>;        <span class="hljs-comment">#è®¾ç½®å“åº”è¢«ç¼“å­˜çš„æœ€å°è¯·æ±‚æ¬¡æ•°,æœ€å°‘2æ¬¡æ‰ä¼šç¼“å­˜</span>        <span class="hljs-attribute">proxy_cache_min_uses</span> <span class="hljs-number">1</span>;        <span class="hljs-comment">#å¼€å¯æ­¤åŠŸèƒ½æ—¶ï¼Œå¯¹äºç›¸åŒçš„è¯·æ±‚ï¼ŒåŒæ—¶åªå…è®¸ä¸€ä¸ªè¯·æ±‚å‘å¾€åç«¯</span>        <span class="hljs-attribute">proxy_cache_lock</span> <span class="hljs-literal">on</span>;         <span class="hljs-comment">#ä¸ºproxy_cache_lockæŒ‡ä»¤è®¾ç½®é”çš„è¶…æ—¶5s</span>        <span class="hljs-attribute">proxy_cache_lock_timeout</span> <span class="hljs-number">5s</span>;        <span class="hljs-comment">#å¿½ç•¥æœåŠ¡å™¨ä¸ç¼“å­˜çš„è¦æ±‚</span>        <span class="hljs-attribute">proxy_ignore_headers</span> Cache-Control;     &#125;    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;    <span class="hljs-attribute">location</span> = /50x.html &#123;    &#125;&#125;</code></pre></div><h4 id="æµ‹è¯•æ•ˆæœ"><a href="#æµ‹è¯•æ•ˆæœ" class="headerlink" title="æµ‹è¯•æ•ˆæœ"></a>æµ‹è¯•æ•ˆæœ</h4><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// server1.php</span><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$http</span> = <span class="hljs-keyword">new</span> Swoole\Http\Server(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">9501</span>);<span class="hljs-variable">$http</span>-&gt;on(<span class="hljs-string">&#x27;request&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$request</span>, <span class="hljs-variable">$response</span></span>) </span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no cache&quot;</span>.PHP_EOL;    <span class="hljs-variable">$response</span>-&gt;end(<span class="hljs-string">&quot;&lt;h1&gt;9501&lt;/h1&gt;&quot;</span>);&#125;);<span class="hljs-variable">$http</span>-&gt;start();</code></pre></div><blockquote><p>php server1.php #æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º</p></blockquote><p>å‘é€getå’Œpostè¯·æ±‚</p><blockquote><p>ab -n10 -c10 <a href="http://nginx-t.com/v/=get">http://nginx-t.com/v\=get</a></p></blockquote><blockquote><p>ab -p â€˜data.jsonâ€™ -n10 -c10 <a href="http://nginx-t.com/v/=post">http://nginx-t.com/v\=post</a></p></blockquote><p>é‡å¤æäº¤å‡ æ¬¡putè¯·æ±‚</p><blockquote><p>curl -X PUT <a href="http://nginx-t.com/v/=put">http://nginx-t.com/v\=put</a> </p></blockquote><p>ä¸‹é¢æ˜¯æˆ‘çš„æµ‹è¯•ç»“æœæˆªå›¾ï¼ˆä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘åœ¨getå’Œpostè¯·æ±‚ä¹‹å‰æ•²äº†å‡ ä¸ªç©ºè¡Œï¼‰</p><p><img src="https://cdn.learnku.com/uploads/images/201911/20/41489/StGI2M5SyZ.png!/fw/1240" alt="Nginx ç¼“å­˜"></p><p>ä¸‹é¢è¯´æ˜å‡ ä¸ªå‚æ•°ï¼š</p><h4 id="proxy-cache-path"><a href="#proxy-cache-path" class="headerlink" title="proxy_cache_path"></a>proxy_cache_path</h4><div class="code-wrapper"><pre><code class="hljs routeros">è¯­æ³•:proxy_cache_path path [<span class="hljs-attribute">levels</span>=levels] <span class="hljs-attribute">keys_zone</span>=name:size [<span class="hljs-attribute">inactive</span>=time] [<span class="hljs-attribute">max_size</span>=size] [<span class="hljs-attribute">loader_files</span>=number] [<span class="hljs-attribute">loader_sleep</span>=time] [<span class="hljs-attribute">loader_threshold</span>=time];é»˜è®¤å€¼:â€”ä¸Šä¸‹æ–‡:http</code></pre></div><ul><li>pathï¼šç¼“å­˜æ•°æ®æ˜¯ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„ï¼Œç¼“å­˜çš„é”®å’Œæ–‡ä»¶åéƒ½æ˜¯åœ¨ä»£ç†URLä¸Šæ‰§è¡ŒMD5çš„ç»“æœã€‚</li><li>levelsï¼šå®šä¹‰äº†ç¼“å­˜çš„å±‚æ¬¡ç»“æ„ <div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment">#å½“levels=1:2æ—¶ï¼Œè¡¨ç¤ºæ˜¯ä¸¤çº§ç›®å½•ï¼Œ1å’Œ2è¡¨ç¤ºç”¨1ä½å’Œ2ä½16è¿›åˆ¶æ¥å‘½åç›®å½•åç§°ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œç¬¬ä¸€çº§ç›®å½•ç”¨1ä½16è¿›åˆ¶å‘½åï¼Œå¦‚bï¼›ç¬¬äºŒçº§ç›®å½•ç”¨2ä½16è¿›åˆ¶å‘½åï¼Œå¦‚2cã€‚æ‰€ä»¥æ­¤ä¾‹ä¸­ä¸€çº§ç›®å½•æœ‰16ä¸ªï¼ŒäºŒçº§ç›®å½•æœ‰16*16=256ä¸ªï¼š</span><span class="hljs-attribute">cache</span>/b/<span class="hljs-number">2</span>c/c<span class="hljs-number">75</span>ad<span class="hljs-number">5</span>e<span class="hljs-number">343</span>f<span class="hljs-number">042</span>f<span class="hljs-number">52</span>e<span class="hljs-number">875343425</span>e<span class="hljs-number">51</span>b</code></pre></div></li><li>key_zone:åœ¨å…±äº«å†…å­˜ä¸­è®¾ç½®ä¸€å—å­˜å‚¨åŒºåŸŸæ¥å­˜æ”¾ç¼“å­˜çš„keyå’Œmetadata(ç±»ä¼¼ä½¿ç”¨æ¬¡æ•°)ï¼Œè¿™æ ·nginxå¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªrequestæ˜¯å¦å‘½ä¸­æˆ–è€…æœªå‘½ä¸­ç¼“ å­˜ï¼Œ1må¯ä»¥å­˜å‚¨8000ä¸ªkeyï¼Œ10må¯ä»¥å­˜å‚¨80000ä¸ªkeyã€‚</li><li>max_size:æœ€å¤§cacheç©ºé—´ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œä¼šä½¿ç”¨æ‰æ‰€æœ‰disk spaceï¼Œå¦‚æœè¶…è¿‡max_sizeå‚æ•°è®¾ç½®çš„æœ€å¤§å€¼ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤ç¼“å­˜æ•°æ®</li><li>inactive:æœªè¢«è®¿é—®æ–‡ä»¶åœ¨ç¼“å­˜ä¸­ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤æ˜¯10åˆ†é’Ÿã€‚æŒ‡å®šæ—¶é—´å†…æœªè¢«è®¿é—®çš„ç¼“å­˜æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚</li><li>loader_files:æ¯æ¬¡æœ€å¤šåŠ è½½çš„æ•°é‡</li><li>loader_sleeps:æ¯æ¬¡åŠ è½½çš„å»¶æ—¶</li><li>loader_threshold:æŒ‡å®šæ¯æ¬¡åŠ è½½æ‰§è¡Œçš„æ—¶é—´</li></ul><h4 id="proxy-cache-lock"><a href="#proxy-cache-lock" class="headerlink" title="proxy_cache_lock"></a>proxy_cache_lock</h4><p>å¼€å¯æ­¤åŠŸèƒ½æ—¶ï¼Œå¯¹äºç›¸åŒçš„è¯·æ±‚ï¼ŒåŒæ—¶åªå…è®¸ä¸€ä¸ªè¯·æ±‚å‘å¾€åç«¯ï¼Œå¹¶æ ¹æ®proxy_cache_keyæŒ‡ä»¤çš„è®¾ç½®åœ¨ç¼“å­˜ä¸­æ¤å…¥ä¸€ä¸ªæ–°æ¡ç›®ã€‚å…¶ä»–è¯·æ±‚ç›¸åŒæ¡ç›®çš„è¯·æ±‚å°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ç¼“å­˜ä¸­å‡ºç°ç›¸åº”çš„å†…å®¹ï¼Œæˆ–è€…é”åœ¨proxy_cache_lock_timeoutæŒ‡ä»¤è®¾ç½®çš„è¶…æ—¶åè¢«é‡Šæ”¾ã€‚</p><h4 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="headerlink" title="proxy_cache_valid"></a>proxy_cache_valid</h4><p>å¦‚æœä»…ä»…æŒ‡å®šäº†timeï¼Œ</p><blockquote><p>proxy_cache_valid 5m;</p></blockquote><p>é‚£ä¹ˆåªæœ‰çŠ¶æ€ç ä¸º200ã€300å’Œ302çš„å“åº”ä¼šè¢«ç¼“å­˜ã€‚</p><p>å¦‚æœä½¿ç”¨äº†anyå‚æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç¼“å­˜ä»»ä½•å“åº”ï¼š</p><blockquote><p>proxy_cache_valid any 1m;</p></blockquote><h4 id="proxy-ignore-headers"><a href="#proxy-ignore-headers" class="headerlink" title="proxy_ignore_headers"></a>proxy_ignore_headers</h4><div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">è¯­æ³•:proxy_ignore_headers field ...;</span><span class="hljs-section">é»˜è®¤å€¼:â€”</span><span class="hljs-section">ä¸Šä¸‹æ–‡:http, server, location</span></code></pre></div><p>ä¸å¤„ç†åç«¯æœåŠ¡å™¨è¿”å›çš„æŒ‡å®šå“åº”å¤´ã€‚ä¸‹é¢çš„å“åº”å¤´å¯ä»¥è¢«è®¾ç½®ï¼š â€œX-Accel-Redirectâ€ï¼Œâ€œX-Accel-Expiresâ€ï¼Œâ€œX-Accel-Limit-Rateâ€ ï¼Œâ€œX-Accel-Bufferingâ€ ï¼Œ â€œX-Accel-Charsetâ€ï¼Œâ€œExpiresâ€ï¼Œâ€œCache-Controlâ€ï¼Œå’Œâ€œSet-Cookieâ€ ã€‚</p><blockquote><p>æ­¤å‚æ•°ä¸å»ºè®®è®¾ç½®ï¼ŒåŸåˆ™ä¸Šè¿™äº›ç¼“å­˜åº”å½“åç«¯ä»£ç å¤„ç†ã€‚</p></blockquote><h4 id="proxy-cache-use-stale"><a href="#proxy-cache-use-stale" class="headerlink" title="proxy_cache_use_stale"></a>proxy_cache_use_stale</h4><div class="code-wrapper"><pre><code class="hljs coq">è¯­æ³•:proxy_cache_use_stale error | <span class="hljs-type">timeout</span> | <span class="hljs-type">invalid_header</span> | <span class="hljs-type">updating</span> | <span class="hljs-type">http_500</span> | <span class="hljs-type">http_502</span> | <span class="hljs-type">http_503</span> | <span class="hljs-type">http_504</span> | <span class="hljs-type">http_404</span> | <span class="hljs-type">off</span> ...;é»˜è®¤å€¼:proxy_cache_use_stale off;ä¸Šä¸‹æ–‡:http, server, location</code></pre></div><p>å¦‚æœåç«¯æœåŠ¡å™¨å‡ºç°çŠ¶å†µï¼Œnginxæ˜¯å¯ä»¥ä½¿ç”¨è¿‡æœŸçš„å“åº”ç¼“å­˜çš„ã€‚è¿™æ¡æŒ‡ä»¤å°±æ˜¯å®šä¹‰ä½•ç§æ¡ä»¶ä¸‹å…è®¸å¼€å¯æ­¤æœºåˆ¶ã€‚è¿™æ¡æŒ‡ä»¤çš„å‚æ•°ä¸proxy_next_upstreamæŒ‡ä»¤çš„å‚æ•°ç›¸åŒã€‚</p><h4 id="proxy-cache-bypassä¸proxy-no-cache"><a href="#proxy-cache-bypassä¸proxy-no-cache" class="headerlink" title="proxy_cache_bypassä¸proxy_no_cache"></a>proxy_cache_bypassä¸proxy_no_cache</h4><div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">è¯­æ³•:proxy_cache_bypass string ...;</span><span class="hljs-section">é»˜è®¤å€¼:â€”</span><span class="hljs-section">ä¸Šä¸‹æ–‡:http, server, location</span></code></pre></div><p>å®šä¹‰nginxä¸ä»ç¼“å­˜å–å“åº”çš„æ¡ä»¶ã€‚å¦‚æœè‡³å°‘ä¸€ä¸ªå­—ç¬¦ä¸²æ¡ä»¶éç©ºè€Œä¸”éâ€œ0â€ï¼Œnginxå°±ä¸ä¼šä»ç¼“å­˜ä¸­å»å–å“åº”ï¼š</p><div class="code-wrapper"><pre><code class="hljs autoit">proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment<span class="hljs-comment">;</span>proxy_cache_bypass $http_pragma    $http_authorization<span class="hljs-comment">;</span></code></pre></div><p>æœ¬æŒ‡ä»¤å¯å’Œä¸proxy_no_cacheä¸€èµ·ä½¿ç”¨ã€‚</p><div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">è¯­æ³•:proxy_no_cache string ...;</span><span class="hljs-section">é»˜è®¤å€¼:â€”</span><span class="hljs-section">ä¸Šä¸‹æ–‡:http, server, location</span></code></pre></div><p>å®šä¹‰nginxä¸å°†å“åº”å†™å…¥ç¼“å­˜çš„æ¡ä»¶ã€‚å¦‚æœè‡³å°‘ä¸€ä¸ªå­—ç¬¦ä¸²æ¡ä»¶éç©ºè€Œä¸”éâ€œ0â€ï¼Œnginxå°±ä¸å°†å“åº”å­˜å…¥ç¼“å­˜ï¼š</p><div class="code-wrapper"><pre><code class="hljs autoit">proxy_no_cache $cookie_nocache $arg_nocache$arg_comment<span class="hljs-comment">;</span>proxy_no_cache $http_pragma    $http_authorization<span class="hljs-comment">;</span></code></pre></div><h4 id="proxy-cache-methods"><a href="#proxy-cache-methods" class="headerlink" title="proxy_cache_methods"></a>proxy_cache_methods</h4><p>è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®ç¼“å­˜å“ªäº›HTTPæ–¹æ³•,é»˜è®¤ç¼“å­˜HTTP GET/HEADæ–¹æ³•,ä¸ç¼“å­˜HTTP POST æ–¹æ³•ã€‚</p><p>æœ‰äº†ä»£ç†ç¼“å­˜ï¼Œé‚£ä¹ˆæ¸…é™¤ç¼“å­˜å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ</p><h2 id="æ¸…é™¤ç¼“å­˜"><a href="#æ¸…é™¤ç¼“å­˜" class="headerlink" title="æ¸…é™¤ç¼“å­˜"></a>æ¸…é™¤ç¼“å­˜</h2><ol><li>åˆ é™¤ç¼“å­˜ç›®å½•çš„æ–‡ä»¶</li><li>ä½¿ç”¨ngx_cache_purgeæ¨¡å—ï¼Œ<a href="https://www.cnblogs.com/Eivll0m/p/4921829.html">å¯æŸ¥çœ‹è¿™ç¯‡æ–‡ç« Nginxç¼“å­˜é…ç½®åŠnginx ngx_cache_purgeæ¨¡å—çš„ä½¿ç”¨</a></li></ol><p>æ¨èç¬¬äºŒç§æ–¹æ³•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxå†…åµŒå˜é‡</title>
    <link href="/2019/11/22/Nginx5/"/>
    <url>/2019/11/22/Nginx5/</url>
    
    <content type="html"><![CDATA[<p>Nginxå†…åµŒå˜é‡æ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œè®°å½•ä¸‹å¤‡æŸ¥ã€‚</p><p>Nginxå†…åµŒå˜é‡ç”± <code>ngx_http_core_module</code> æ¨¡å—æ”¯æŒï¼Œå˜é‡åä¸ApacheæœåŠ¡å™¨å¯¹åº”ï¼Œè¿™äº›å˜é‡å¯ä»¥è¡¨ç¤ºå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´å­—æ®µï¼Œè¯¸å¦‚<code>$http_user_agent</code>ã€<code>$http_cookie</code>ç­‰ç­‰ã€‚ nginxä¹Ÿæ”¯æŒå…¶ä»–å˜é‡ï¼š</p><table><thead><tr><th>å‚æ•°åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$arg_name</td><td>è¯·æ±‚ä¸­çš„çš„å‚æ•°åï¼Œå³â€œ?â€åé¢çš„arg_name=arg_valueå½¢å¼çš„arg_nameï¼Œå¦‚/index.php?www=<a href="http://www.13sai.com,å¯ä»¥ç”¨$arg_wwwå°±æ˜¯www.13sai.com/">www.13sai.comï¼Œå¯ä»¥ç”¨$arg_wwwå°±æ˜¯www.13sai.com</a></td></tr><tr><td>$args</td><td>è¯·æ±‚ä¸­çš„å‚æ•°å€¼</td></tr><tr><td>$binary_remote_addr</td><td>å®¢æˆ·ç«¯åœ°å€çš„äºŒè¿›åˆ¶å½¢å¼, å›ºå®šé•¿åº¦ä¸º4ä¸ªå­—èŠ‚</td></tr><tr><td>$body_bytes_sent</td><td>ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œå“åº”å¤´ä¸è®¡ç®—åœ¨å†…ï¼›è¿™ä¸ªå˜é‡å’ŒApacheçš„mod_log_configæ¨¡å—ä¸­çš„â€œ%Bâ€å‚æ•°ä¿æŒå…¼å®¹</td></tr><tr><td>$bytes_sent</td><td>ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°</td></tr><tr><td>$connection</td><td>TCPè¿æ¥çš„åºåˆ—å·</td></tr><tr><td>$connection_requests</td><td>TCPè¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡</td></tr><tr><td>$content_length</td><td>â€œContent-Lengthâ€ è¯·æ±‚å¤´å­—æ®µ</td></tr><tr><td>$content_type</td><td>â€œContent-Typeâ€ è¯·æ±‚å¤´å­—æ®µ</td></tr><tr><td>$cookie_name</td><td>cookieåç§°</td></tr><tr><td>$document_root</td><td>å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«å</td></tr><tr><td>$document_uri</td><td>åŒ $uri</td></tr><tr><td>$host</td><td>ä¼˜å…ˆçº§å¦‚ä¸‹ï¼šHTTPè¯·æ±‚è¡Œçš„ä¸»æœºå&gt;â€HOSTâ€è¯·æ±‚å¤´å­—æ®µ&gt;ç¬¦åˆè¯·æ±‚çš„æœåŠ¡å™¨å</td></tr><tr><td>$hostname</td><td>ä¸»æœºå</td></tr><tr><td>$http_name</td><td>åŒ¹é…ä»»æ„è¯·æ±‚å¤´å­—æ®µï¼› å˜é‡åä¸­çš„ååŠéƒ¨åˆ†â€œnameâ€å¯ä»¥æ›¿æ¢æˆä»»æ„è¯·æ±‚å¤´å­—æ®µï¼Œå¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦è·å–httpè¯·æ±‚å¤´ï¼šâ€œAccept-Languageâ€ï¼Œé‚£ä¹ˆå°†â€œï¼â€æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œå¤§å†™å­—æ¯æ›¿æ¢ä¸ºå°å†™ï¼Œå½¢å¦‚ï¼š$http_accept_languageå³å¯ã€‚</td></tr><tr><td>$https</td><td>å¦‚æœå¼€å¯äº†SSLå®‰å…¨æ¨¡å¼ï¼Œå€¼ä¸ºâ€œonâ€ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</td></tr><tr><td>$is_args</td><td>å¦‚æœè¯·æ±‚ä¸­æœ‰å‚æ•°ï¼Œå€¼ä¸ºâ€œ?â€ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</td></tr><tr><td>$limit_rate</td><td>ç”¨äºè®¾ç½®å“åº”çš„é€Ÿåº¦é™åˆ¶ï¼Œè¯¦è§ limit_rateã€‚</td></tr><tr><td>$msec</td><td>å½“å‰çš„Unixæ—¶é—´æˆ³ (1.3.9, 1.2.6)</td></tr><tr><td>$nginx_version</td><td>nginxç‰ˆæœ¬</td></tr><tr><td>$pid</td><td>å·¥ä½œè¿›ç¨‹çš„PID</td></tr><tr><td>$pipe</td><td>å¦‚æœè¯·æ±‚æ¥è‡ªç®¡é“é€šä¿¡ï¼Œå€¼ä¸ºâ€œpâ€ï¼Œå¦åˆ™ä¸ºâ€œ.â€ (1.3.12, 1.2.7)</td></tr><tr><td>$proxy_protocol_addr</td><td>è·å–ä»£ç†è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åœ°å€ï¼Œå¦‚æœæ˜¯ç›´æ¥è®¿é—®ï¼Œè¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚(1.5.12)</td></tr><tr><td>$query_string</td><td>åŒ $argsï¼Œç„¶è€Œ $query_stringæ˜¯åªè¯»çš„ä¸ä¼šæ”¹å˜</td></tr><tr><td>$realpath_root</td><td>å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«åçš„çœŸå®è·¯å¾„ï¼Œä¼šå°†æ‰€æœ‰ç¬¦å·è¿æ¥è½¬æ¢ä¸ºçœŸå®è·¯å¾„ã€‚</td></tr><tr><td>$remote_addr</td><td>å®¢æˆ·ç«¯åœ°å€</td></tr><tr><td>$remote_port</td><td>å®¢æˆ·ç«¯ç«¯å£</td></tr><tr><td>$remote_user</td><td>ç”¨äºHTTPåŸºç¡€è®¤è¯æœåŠ¡çš„ç”¨æˆ·å</td></tr><tr><td>$request</td><td>ä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚åœ°å€</td></tr><tr><td>$request_body</td><td>å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸»ä½“,æ­¤å˜é‡å¯åœ¨locationä¸­ä½¿ç”¨ï¼Œå°†è¯·æ±‚ä¸»ä½“é€šè¿‡proxy_pass, fastcgi_pass, uwsgi_pass, å’Œ scgi_passä¼ é€’ç»™ä¸‹ä¸€çº§çš„ä»£ç†æœåŠ¡å™¨ã€‚</td></tr><tr><td>$request_body_file</td><td>è¯·æ±‚æ­£æ–‡çš„ä¸´æ—¶æ–‡ä»¶åã€‚å¤„ç†å®Œæˆæ—¶ï¼Œä¸´æ—¶æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚ å¦‚æœå¸Œæœ›æ€»æ˜¯å°†è¯·æ±‚æ­£æ–‡å†™å…¥æ–‡ä»¶ï¼Œéœ€è¦å¼€å¯client_body_in_file_onlyã€‚ å¦‚æœåœ¨è¢«ä»£ç†çš„è¯·æ±‚æˆ–FastCGIè¯·æ±‚ä¸­ä¼ é€’ä¸´æ—¶æ–‡ä»¶åï¼Œå°±åº”è¯¥ç¦æ­¢ä¼ é€’è¯·æ±‚æ­£æ–‡æœ¬èº«ã€‚ ä½¿ç”¨proxy_pass_request_body offæŒ‡ä»¤ å’Œfastcgi_pass_request_body offæŒ‡ä»¤ åˆ†åˆ«ç¦æ­¢åœ¨ä»£ç†å’ŒFastCGIä¸­ä¼ é€’è¯·æ±‚æ­£æ–‡ã€‚</td></tr><tr><td>$request_completion</td><td>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå€¼ä¸ºâ€OKâ€ï¼Œå¦‚æœè¯·æ±‚æœªå®Œæˆæˆ–è€…è¯·æ±‚ä¸æ˜¯ä¸€ä¸ªèŒƒå›´è¯·æ±‚çš„æœ€åä¸€éƒ¨åˆ†ï¼Œåˆ™ä¸ºç©ºã€‚</td></tr><tr><td>$request_filename</td><td>å½“å‰è¿æ¥è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚</td></tr><tr><td>$request_length</td><td>è¯·æ±‚çš„é•¿åº¦ (åŒ…æ‹¬è¯·æ±‚çš„åœ°å€, httpè¯·æ±‚å¤´å’Œè¯·æ±‚ä¸»ä½“)</td></tr><tr><td>$request_method</td><td>HTTPè¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸ä¸ºâ€œGETâ€æˆ–â€œPOSTâ€</td></tr><tr><td>$request_time</td><td>å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨çš„æ—¶é—´; ä»è¯»å–å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹è®¡æ—¶ã€‚</td></tr><tr><td>$request_uri</td><td>è¿™ä¸ªå˜é‡ç­‰äºåŒ…å«ä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œå®ƒæ— æ³•ä¿®æ”¹ï¼Œè¯·æŸ¥çœ‹$uriæ›´æ”¹æˆ–é‡å†™URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œä¾‹å¦‚ï¼šâ€/sai/test.php?arg=wwwâ€ã€‚</td></tr><tr><td>$scheme</td><td>è¯·æ±‚ä½¿ç”¨çš„Webåè®®, â€œhttpâ€ æˆ– â€œhttpsâ€</td></tr><tr><td>$sent_http_name</td><td>å¯ä»¥è®¾ç½®ä»»æ„httpå“åº”å¤´å­—æ®µï¼› å˜é‡åä¸­çš„ååŠéƒ¨åˆ†â€œnameâ€å¯ä»¥æ›¿æ¢æˆä»»æ„å“åº”å¤´å­—æ®µï¼Œå¦‚éœ€è¦è®¾ç½®å“åº”å¤´Content-lengthï¼Œé‚£ä¹ˆå°†â€œï¼â€æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œå¤§å†™å­—æ¯æ›¿æ¢ä¸ºå°å†™ï¼Œå½¢å¦‚ï¼š$sent_http_content_length 4096å³å¯ã€‚</td></tr><tr><td>$server_addr</td><td>æœåŠ¡å™¨ç«¯åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸ºäº†é¿å…è®¿é—®linuxç³»ç»Ÿå†…æ ¸ï¼Œåº”å°†ipåœ°å€æå‰è®¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚</td></tr><tr><td>$server_name</td><td>æœåŠ¡å™¨å</td></tr><tr><td>$server_port</td><td>æœåŠ¡å™¨ç«¯å£</td></tr><tr><td>$server_protocol</td><td>æœåŠ¡å™¨çš„HTTPç‰ˆæœ¬, é€šå¸¸ä¸º â€œHTTP/1.0â€ æˆ– â€œHTTP/1.1â€</td></tr><tr><td>$status</td><td>HTTPå“åº”ä»£ç </td></tr><tr><td>$time_iso8601</td><td>æœåŠ¡å™¨æ—¶é—´çš„ISO 8610æ ¼å¼</td></tr><tr><td>$time_local</td><td>æœåŠ¡å™¨æ—¶é—´ï¼ˆLOG Format æ ¼å¼ï¼‰ ï¼Œnginxå¤„ç†å®Œæˆæ‰“å°æ—¥å¿—çš„æ—¶é—´ï¼Œä¸æ˜¯è¯·æ±‚å‘å‡ºçš„æ—¶é—´</td></tr><tr><td>$uri</td><td>è¯·æ±‚ä¸­çš„å½“å‰URI(ä¸å¸¦è¯·æ±‚å‚æ•°ï¼Œå‚æ•°ä½äº$args)ï¼Œå¯ä»¥ä¸åŒäºæµè§ˆå™¨ä¼ é€’çš„$request_uriçš„å€¼ï¼Œå®ƒå¯ä»¥é€šè¿‡å†…éƒ¨é‡å®šå‘ï¼Œæˆ–è€…ä½¿ç”¨indexæŒ‡ä»¤è¿›è¡Œä¿®æ”¹ï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€/foo/bar.htmlâ€ã€‚</td></tr></tbody></table><p>apacheæœåŠ¡å™¨å˜é‡å¯çœ‹<a href="https://blog.csdn.net/litwhy/article/details/70893084">[å¤‡å¿˜] apacheæœåŠ¡ç«¯å˜é‡</a></p><p>å‚è€ƒï¼š</p><ul><li><a href="http://tengine.taobao.org/nginx_docs/cn/docs/http/ngx_http_core_module.html#variables">ä¸­æ–‡æ–‡æ¡£</a></li></ul><p>Nginx ç›¸å…³æ–‡ç« ï¼š</p><ul><li><a href="http://github.13sai.com/2019/11/18/203/">Nginx è´Ÿè½½å‡è¡¡</a></li><li><a href="https://learnku.com/articles/36567">Nginx æ·»åŠ  lua æ¨¡å—</a></li><li><a href="https://learnku.com/articles/36768">Nginx é…ç½®å¸¸ç”¨å‚æ•°ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></li><li><a href="https://learnku.com/articles/36857">Nginx ä»£ç†ç¼“å­˜</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxæ·»åŠ lua-nginxæ¨¡å—</title>
    <link href="/2019/11/20/Nginx9/"/>
    <url>/2019/11/20/Nginx9/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ngx_luaæ˜¯Nginxçš„ä¸€ä¸ªæ¨¡å—ï¼Œå°†LuaåµŒå…¥åˆ°Nginxä¸­ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨Luaæ¥ç¼–å†™è„šæœ¬ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨Luaç¼–å†™åº”ç”¨è„šæœ¬ï¼Œéƒ¨ç½²åˆ°Nginxä¸­è¿è¡Œï¼Œå³Nginxå˜æˆäº†ä¸€ä¸ªWebå®¹å™¨ï¼›è¿™æ ·å¼€å‘äººå‘˜å°±å¯ä»¥ä½¿ç”¨Luaè¯­è¨€å¼€å‘é«˜æ€§èƒ½Webåº”ç”¨äº†ã€‚</p></blockquote><h2 id="å®‰è£…lua"><a href="#å®‰è£…lua" class="headerlink" title="å®‰è£…lua"></a>å®‰è£…lua</h2><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> http://luajit.org/download/LuaJIT-<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5</span>.tar.gz <span class="hljs-attribute">tar</span> -zxvf LuaJIT-<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5</span>.tar.gz<span class="hljs-attribute">cd</span> LuaJIT-<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5</span><span class="hljs-attribute">make</span> &amp;&amp; make install PREFIX=/usr/local/LuaJIT</code></pre></div><h2 id="etc-profileåŠ å…¥"><a href="#etc-profileåŠ å…¥" class="headerlink" title="etc/profileåŠ å…¥"></a>etc/profileåŠ å…¥</h2><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment"># lua</span>export LUAJIT_LIB=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/LuaJIT/</span>lib export LUAJIT_INC=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/LuaJIT/i</span>nclude/luajit-<span class="hljs-number">2.0</span></code></pre></div><blockquote><p>source etc/profile</p></blockquote><h2 id="ä¸‹è½½ngx-devel-kitæ¨¡å—"><a href="#ä¸‹è½½ngx-devel-kitæ¨¡å—" class="headerlink" title="ä¸‹è½½ngx_devel_kitæ¨¡å—"></a>ä¸‹è½½ngx_devel_kitæ¨¡å—</h2><div class="code-wrapper"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/simpl/</span>ngx_devel_kit<span class="hljs-regexp">/archive/</span>v0.<span class="hljs-number">3.0</span>.tar.gz</code></pre></div><blockquote><p>NDK(nginx development kit)æ¨¡å—æ˜¯ä¸€ä¸ªæ‹“å±•nginxæœåŠ¡å™¨æ ¸å¿ƒåŠŸèƒ½çš„æ¨¡å—ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å¼€å‘å¯ä»¥åŸºäºå®ƒæ¥å¿«é€Ÿå®ç°ã€‚ NDKæä¾›å‡½æ•°å’Œå®å¤„ç†ä¸€äº›åŸºæœ¬ä»»åŠ¡ï¼Œ å‡è½»ç¬¬ä¸‰æ–¹æ¨¡å—å¼€å‘çš„ä»£ç é‡</p></blockquote><h2 id="ä¸‹è½½lua-nginx-moduleæ¨¡å—"><a href="#ä¸‹è½½lua-nginx-moduleæ¨¡å—" class="headerlink" title="ä¸‹è½½lua-nginx-moduleæ¨¡å—"></a>ä¸‹è½½lua-nginx-moduleæ¨¡å—</h2><div class="code-wrapper"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/openresty/</span>lua-nginx-module<span class="hljs-regexp">/archive/</span>v0.<span class="hljs-number">10.9</span>rc7.tar.gz</code></pre></div><p> lua-nginx-module æ¨¡å—ä½¿nginxä¸­èƒ½ç›´æ¥è¿è¡Œlua</p><h2 id="æŸ¥çœ‹åŸå§‹ç¼–è¯‘"><a href="#æŸ¥çœ‹åŸå§‹ç¼–è¯‘" class="headerlink" title="æŸ¥çœ‹åŸå§‹ç¼–è¯‘"></a>æŸ¥çœ‹åŸå§‹ç¼–è¯‘</h2><blockquote><p>nginx -V</p></blockquote><div class="code-wrapper"><pre><code class="hljs brainfuck"><span class="hljs-comment">å¦‚ï¼š</span><span class="hljs-comment">configure</span> <span class="hljs-comment">arguments:</span> --<span class="hljs-comment">user=www</span> --<span class="hljs-comment">group=www</span> --<span class="hljs-comment">prefix=/usr/local/nginx</span> --<span class="hljs-comment">with</span><span class="hljs-literal">-</span><span class="hljs-comment">http_stub_status_module</span> --<span class="hljs-comment">with</span><span class="hljs-literal">-</span><span class="hljs-comment">http_ssl_module</span> --<span class="hljs-comment">with</span><span class="hljs-literal">-</span><span class="hljs-comment">http_gzip_static_module</span> --<span class="hljs-comment">with</span><span class="hljs-literal">-</span><span class="hljs-comment">http_sub_module</span> --<span class="hljs-comment">with</span><span class="hljs-literal">-</span><span class="hljs-comment">http_v2_module</span></code></pre></div><p>è¿›å…¥nginxåŸå§‹ç›®å½•ï¼š</p><div class="code-wrapper"><pre><code class="hljs javascript">./configure --user=www --group=www --prefix=<span class="hljs-regexp">/usr/</span>local/nginx --<span class="hljs-keyword">with</span>-http_stub_status_module --<span class="hljs-keyword">with</span>-http_ssl_module --<span class="hljs-keyword">with</span>-http_gzip_static_module --<span class="hljs-keyword">with</span>-http_sub_module --<span class="hljs-keyword">with</span>-http_v2_module --add-<span class="hljs-built_in">module</span>=<span class="hljs-regexp">/root/</span>lua-nginx-<span class="hljs-built_in">module</span>-<span class="hljs-number">0.10</span>.9rc7/ --add-<span class="hljs-built_in">module</span>=<span class="hljs-regexp">/root/</span>ngx_devel_kit-<span class="hljs-number">0.3</span><span class="hljs-number">.0</span></code></pre></div><p>åªmakeï¼Œä¸æ‰§è¡Œmake installã€‚</p><p>ç¼–è¯‘æŠ¥é”™åº”è¯¥å°±æ˜¯luaç¯å¢ƒå˜é‡ä¸å¯¹ã€‚</p><div class="code-wrapper"><pre><code class="hljs stata">nginx -V å‘½ä»¤æŠ¥é”™./nginx: <span class="hljs-keyword">error</span> <span class="hljs-keyword">while</span> loading shared libraries: libluajit-5.1.<span class="hljs-keyword">so</span>.2: cannot <span class="hljs-keyword">open</span> shared object <span class="hljs-keyword">file</span>: <span class="hljs-keyword">No</span> such <span class="hljs-keyword">file</span> or directoryè§£å†³ï¼šecho <span class="hljs-string">&quot;/usr/local/LuaJIT/lib&quot;</span> &gt;&gt; /etc/ld.<span class="hljs-keyword">so</span>.<span class="hljs-keyword">conf</span>ldconfig</code></pre></div><p>æˆåŠŸä¹‹åå¯ä»¥nginx -VæŸ¥çœ‹ï¼Œæ— æŠ¥é”™å³å¯ã€‚</p><p>æŠŠåŸæ¥çš„nginxå¤‡ä»½ä¸ºnginx_old</p><p>cp objs/nginxåˆ°åŸæ¥çš„nginxå¹¶è¦†ç›–ã€‚</p><p>åœ¨ç¼–è¯‘ç›®å½•æ‰§è¡Œ</p><blockquote><p>make upgrade</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/201911/18/41489/SNDXytBYrH.png!large" alt="Nginx æ·»åŠ  lua æ¨¡å—"></p><p>æµ‹è¯•ï¼š</p><div class="code-wrapper"><pre><code class="hljs ceylon">server&#123;    ...    location /lua &#123;        <span class="hljs-keyword">default</span><span class="hljs-number">_</span>type <span class="hljs-string">&#x27;text/html&#x27;</span>;        content<span class="hljs-number">_</span><span class="hljs-meta">by</span><span class="hljs-number">_</span>lua <span class="hljs-string">&#x27;</span><span class="hljs-string">                ngx.say(&quot;hello, lua!&quot;)</span><span class="hljs-string">        &#x27;</span>;    &#125;    ...&#125;</code></pre></div><p>æµè§ˆå™¨æ‰“å¼€ï¼š</p><blockquote><p><a href="http://blog.13sai.com/lua">http://blog.13sai.com/lua</a></p></blockquote><p>å¯ä»¥çœ‹åˆ°hello, lua!</p><p>æ­¤å®‰è£…æ–¹æ³•ä¹Ÿé€‚ç”¨äºNginxå…¶ä»–moduleå®‰è£…ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitå›é€€è¿œç¨‹åˆ†æ”¯ç‰ˆæœ¬</title>
    <link href="/2019/10/29/201/"/>
    <url>/2019/10/29/201/</url>
    
    <content type="html"><![CDATA[<p>å¶å°”ä¼šæœ‰ä»£ç æäº¤é”™è¯¯ï¼Œåˆæäº¤åˆ°è¿œç¨‹åˆ†æ”¯äº†ï¼Œæ€ä¹ˆå›é€€å‘¢ï¼Ÿ</p><h3 id="å¼ºåˆ¶å›é€€"><a href="#å¼ºåˆ¶å›é€€" class="headerlink" title="å¼ºåˆ¶å›é€€"></a>å¼ºåˆ¶å›é€€</h3><div class="code-wrapper"><pre><code class="hljs git"># æŸ¥çœ‹æ—¥å¿—ï¼Œæ‰¾åˆ°å¯¹åº”çš„commit idgit loggit reset --hard å›é€€çš„ç‰ˆæœ¬idgit push -f origin åˆ†æ”¯å</code></pre></div><p>è¿™æ ·å›é€€æ˜¯æ¸…é™¤äº†å›é€€çš„ç‰ˆæœ¬idä¹‹åçš„æäº¤ï¼Œè¿æ—¥å¿—éƒ½æ²¡æœ‰äº†ã€‚</p><h3 id="å›é€€ç‰ˆæœ¬"><a href="#å›é€€ç‰ˆæœ¬" class="headerlink" title="å›é€€ç‰ˆæœ¬"></a>å›é€€ç‰ˆæœ¬</h3><div class="code-wrapper"><pre><code class="hljs git"># æŸ¥çœ‹æ—¥å¿—ï¼Œæ‰¾åˆ°å¯¹åº”çš„commit idgit loggit reset --soft å›é€€çš„ç‰ˆæœ¬idgit commit</code></pre></div><p>è¿™æ ·å›é€€æ˜¯æ”¹å›å›é€€çš„ç‰ˆæœ¬idä¹‹åçš„æäº¤ï¼Œæ—¥å¿—ä»ç„¶å­˜åœ¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>php+nginxä¸Šä¼ æ–‡ä»¶413</title>
    <link href="/2019/10/09/200/"/>
    <url>/2019/10/09/200/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸Šä¼ å‡ºé”™ï¼Œè¿”å›413 Request Entity Too Large</p><p>è§£å†³æ–¹æ³•ï¼šï¼ˆå…·ä½“å¤§å°è§†ä¸šåŠ¡è€Œå®šï¼‰</p><ol><li>ä»¥ä¸‹ä»£ç åŠ å…¥ nginx.conf æ–‡ä»¶ä¸­çš„ http{ â€¦ } å—ä¸­</li></ol><blockquote><p>client_max_body_size 32M;  </p></blockquote><ol start="2"><li>PHP è®¾ç½®ä¸Šä¼ å¤§å° </li></ol><p>æ‰“å¼€php.ini æ–‡ä»¶ä¸­ ä¿®æ”¹ä»¥ä¸‹å‡ ä¸ªå‚æ•°</p><div class="code-wrapper"><pre><code class="hljs sh">memory_limit = 32Mupload_max_filesize = 8Mpost_max_size = 16M</code></pre></div><p>é‡å¯nginxï¼Œfpmå³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šè¿‡mysqlbinlogæ¢å¤è¯¯æ“ä½œæ¸…ç©ºçš„è¡¨</title>
    <link href="/2019/09/08/198/"/>
    <url>/2019/09/08/198/</url>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«é€šè¿‡mysqlbinlogæ¢å¤è¯¯æ“ä½œæ¸…ç©ºçš„è¡¨ï¼Œåˆ†äº«æ¥æºäºå‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šçš„çœŸå®äº‹ä»¶ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æŸä¸ªæœˆé»‘é£é«˜çš„å¤œæ™šï¼Œæœ‹å‹å¾®ä¿¡æ‰¾åˆ°æˆ‘è¯´ï¼Œæ•°æ®åº“ä¸­æŸä¸ªè¡¨è¢«å¼€å‘äººå‘˜è¯¯åˆ äº†ï¼Œè€æ¿è¿˜åœ¨æ­£åœ¨æµ‹è¯•åŠŸèƒ½ï¼Œå¼€å‘å­¦è‰ºä¸ç²¾ï¼Œæ…Œäº†ï¼Œä¸çŸ¥é“æ€ä¹ˆåŠäº†ã€‚</p><p>æˆ‘é—®ä»–æ˜¯å¦å¼€å¯äº†binlogï¼Œå¹¶æŠŠä»¥ä¸‹å‘½ä»¤å‘ç»™ä»–ã€‚</p><blockquote><p>show variables like â€˜log_binâ€™;</p></blockquote><p>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œä»–ä»¬çš„ç”Ÿäº§æ•°æ®åº“å¼€äº†binlogã€‚ç„¶åè·Ÿä»–è¯´äº†ä¸‹å¯ä»¥æ¢å¤ï¼Œå¹¶åˆ†äº«äº†æ–‡ç« è®©é‚£è¾¹å¼€å‘äººå‘˜æ“ä½œä¸€ä¸‹ã€‚</p><p>ç»“æœåŠå°æ—¶ä¹‹åï¼Œæœ‹å‹é—®æˆ‘èƒ½ä¸èƒ½å¸®å¿™æ“ä½œï¼Œå…¶å®æˆ‘å†…å¿ƒæ˜¯æ‹’ç»çš„ï¼Œå› ä¸ºä¸æƒ³ç»™è‡ªå·±æ‰¾éº»çƒ¦ï¼Œä½†æƒ³åˆ°æˆ‘è²Œä¼¼æ²¡æœ‰çº¿ä¸Šå®æ“è¿‡ï¼Œè¯´æ˜é¡¾è™‘åŠå®‰å…¨æ€§é—®é¢˜åï¼Œå¯¹æ–¹åŒæ„ä¾¿å†³å®šå°è¯•ä¸€ä¸‹ã€‚</p><h3 id="æ¢å¤æ­¥éª¤"><a href="#æ¢å¤æ­¥éª¤" class="headerlink" title="æ¢å¤æ­¥éª¤"></a>æ¢å¤æ­¥éª¤</h3><p>æ“ä½œæ­¥éª¤å¦‚ä¸‹:</p><ol><li><p>æ‰¾åˆ°å­˜æ”¾binlogçš„ç›®å½•ï¼Œä½¿ç”¨ mysqlbinlog </p><blockquote><p>mysqlbinlog mysql-bin.000011 &gt; bak.log</p></blockquote></li><li><p>æ‰¾åˆ°åˆ é™¤çš„è¯­å¥æ—¶é—´ï¼Œä½¿ç”¨çš„æ˜¯truncateï¼Œå› ä¸ºé¡¹ç›®æœªä¸Šçº¿ï¼Œlog ä¸å¤§ï¼Œç›´æ¥ grep å³å¯</p></li><li><p>å†æ¬¡åˆ©ç”¨ mysqlbinlog å¯¼å‡ºsql è¯­å¥ï¼Œæ–¹ä¾¿åç»­å¿«é€Ÿå¯¼å…¥</p><blockquote><p>mysqlbinlog â€“stop-datetime=â€2019-09-07 17:30:31â€  mysql-bin.000011 &gt;all.sql</p></blockquote></li></ol><p>stop-datetimeåº”è¯¥æ˜¯è¯¯åˆ æ“ä½œå‰ä¸€åˆ»æ—¶é—´ã€‚</p><p>ä¸‹è½½ all.sql å€’å…¥æœ¬åœ°æ•°æ®åº“ï¼Œæ£€æŸ¥æ— å¼‚å¸¸ï¼Œå¯¼å‡ºè¯¯åˆ è¡¨ï¼Œç›´æ¥å°†è¯¯åˆ è¡¨å¯¼å…¥ç”Ÿäº§æ•°æ®åº“ã€‚</p><ol start="4"><li>å‘ŠçŸ¥å¯¹æ–¹æ£€æµ‹ç”Ÿäº§æ•°æ®åº“</li></ol><p>è¿™ä¸ªäº‹æƒ…å°±è¿™ä¹ˆå‘Šä¸€æ®µè½äº†ï¼Œæ²¡æœ‰ä»»ä½•é…¬åŠ³ï¼ŒçœŸå°æ°”ã€‚ã€‚ã€‚</p><h3 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h3><p>æ™šä¸Šæˆ‘åæ€äº†ä¸€ä¸‹ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li>æ•°æ®åº“é‡è¦æ•°æ®å°½é‡ä¸€å¤©ä¸€å¤‡ä»½ï¼Œç„¶åå¼€å¯binlogï¼Œä¸ºäº†å‡å°‘ç¡¬ç›˜ç©ºé—´å ç”¨ï¼Œè®¾ç½®expire_logs_days</li><li>ç”Ÿäº§æ•°æ®åº“ä¸ä½¿ç”¨rootç”¨æˆ·ï¼Œæ–°å»ºç”¨æˆ·ï¼Œé™åˆ¶dropï¼Œtruncateç­‰å±é™©æ“ä½œæƒé™</li><li>é‡äº‹åˆ«æ…Œï¼Œè‡ªå·±å°è¯•è§£å†³ï¼Œè§£å†³ä¸äº†è¯·æ•™åˆ«äººï¼Œå¿«é€Ÿè§£å†³é—®é¢˜æ‰æ˜¯å…³é”®</li><li>å¸®å¿™å¯ä»¥å¸®ï¼Œä½†è¦è¯´æ¸…æ¥šï¼Œåˆ«è¢«å‘äº†</li><li>å¯¼å‡ºsqlæ—¶åº”è¯¥æŒ‡å®šæ•°æ®åº“ï¼Œæ¯”å¦‚</li></ol><blockquote><p>mysqlbinlog â€“stop-datetime=â€2022-09-07 17:30:31â€ â€“database=test mysql-bin.000893 &gt;all.sql</p></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog.html">mysqlbin</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>db</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>laravelé»˜è®¤åˆ†é¡µå¸¦å‚</title>
    <link href="/2019/09/02/196/"/>
    <url>/2019/09/02/196/</url>
    
    <content type="html"><![CDATA[<p> é»˜è®¤çš„laravelåˆ†é¡µæ˜¯åªå¸¦åˆ†é¡µå‚æ•°çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åŠ å…¥å…¶å®ƒå‚æ•°å‘¢ï¼Ÿæ¯”å¦‚æœç´¢é¡¹ã€‚</p><ol><li>åç«¯å¸¦å‚</li></ol><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-variable">$list</span> = <span class="hljs-variable">$model</span>::paginate(<span class="hljs-number">2</span>);<span class="hljs-variable">$list</span>-&gt;appends([      name=&gt;<span class="hljs-variable">$name</span>,      city=&gt;<span class="hljs-variable">$city</span>,])-&gt;render();<span class="hljs-keyword">return</span> view(admin, [      <span class="hljs-keyword">list</span> =&gt; <span class="hljs-variable">$list</span>]);<span class="hljs-comment">// bladeä½¿ç”¨&#123;&#123; $list-&gt;links() &#125;&#125;</span></code></pre></div><ol start="2"><li>å‰ç«¯å¸¦å‚</li></ol><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-variable">$list</span> = <span class="hljs-variable">$model</span>::paginate(<span class="hljs-number">2</span>);<span class="hljs-keyword">return</span> view(admin.apply.apply, [      <span class="hljs-keyword">list</span> =&gt; <span class="hljs-variable">$list</span>,      name =&gt; <span class="hljs-variable">$name</span>,      city =&gt; <span class="hljs-variable">$city</span>]);<span class="hljs-comment">//å‰ç«¯</span>&#123;&#123; <span class="hljs-variable">$list</span>-&gt;appends([name=&gt;<span class="hljs-variable">$name</span>, city =&gt; <span class="hljs-variable">$city</span>])-&gt;links() &#125;&#125;</code></pre></div><p>ä¸¤ç§æ–¹æ³•å‡å¯ï¼</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦ä¹ goé‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œæ¦‚å¿µæ±‡æ€»</title>
    <link href="/2019/08/25/195/"/>
    <url>/2019/08/25/195/</url>
    
    <content type="html"><![CDATA[<h4 id="go-getå®‰è£…x-syså¤±è´¥çš„è§£å†³"><a href="#go-getå®‰è£…x-syså¤±è´¥çš„è§£å†³" class="headerlink" title="go getå®‰è£…x/syså¤±è´¥çš„è§£å†³"></a>go getå®‰è£…x/syså¤±è´¥çš„è§£å†³</h4><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-comment">// $GOPATHè¿™æ®µåœ°å€è¯·è‡ªè¡Œä¿®æ”¹ï¼Œä¸‹è½½åˆ°gorootå’Œgopathå¯¹åº”ä½ç½®å³å¯ï¼Œä¸åŒç³»ç»Ÿç•¥æœ‰ä¸åŒ</span>git clone https:<span class="hljs-comment">//github.com/golang/net.git $GOPATH/src/github.com/golang/net</span>git clone https:<span class="hljs-comment">//github.com/golang/sys.git $GOPATH/src/github.com/golang/sys</span>git clone https:<span class="hljs-comment">//github.com/golang/tools.git $GOPATH/src/github.com/golang/tools</span>ln -s $GOPATH/src/github.com/golang $GOPATH/src/golang.org/x</code></pre></div><blockquote><p>go getå‘½ä»¤å®‰è£…golang.orgæ¯”è¾ƒæ…¢çš„è¯ï¼Œä¸€èˆ¬éƒ½å¯ä»¥åœ¨github.comæ‰¾åˆ°å¯¹åº”çš„packageï¼Œä¸‹è½½åæ”¾åˆ°å¯¹åº”çš„ç›®å½•å³å¯</p></blockquote><h4 id="goçš„ç¯å¢ƒå˜é‡è®¾ç½®"><a href="#goçš„ç¯å¢ƒå˜é‡è®¾ç½®" class="headerlink" title="goçš„ç¯å¢ƒå˜é‡è®¾ç½®"></a>goçš„ç¯å¢ƒå˜é‡è®¾ç½®</h4><p>åœ¨/etc/profileæœ€ä¸‹é¢åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs routeros"><span class="hljs-comment"># å¯è‡ªè¡Œæ”¹æˆä½ çš„ç›®å½•</span><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">GO_INSTALL_DIR</span>=<span class="hljs-variable">$HOME</span><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">GOROOT</span>=<span class="hljs-variable">$GO_INSTALL_DIR</span>/go<span class="hljs-builtin-name">export</span> <span class="hljs-attribute">GOPATH</span>=<span class="hljs-variable">$HOME</span>/mygo<span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$GOPATH</span>/bin:$PATH:$GO_INSTALL_DIR/go/bin</code></pre></div><h4 id="import"><a href="#import" class="headerlink" title="import"></a>import</h4><blockquote><p>import _  æ‰§è¡Œinitå‡½æ•°ï¼Œä½†ä¸éœ€è¦åŒ…æ‰€æœ‰å‡½æ•°</p></blockquote><blockquote><p>import .  è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</p></blockquote><h3 id="amp-å’Œ"><a href="#amp-å’Œ" class="headerlink" title="&amp;å’Œ*"></a>&amp;å’Œ*</h3><blockquote><p>&amp;ç¬¦å·çš„æ„æ€æ˜¯å¯¹å˜é‡å–åœ°å€ï¼Œå¦‚ï¼šå˜é‡açš„åœ°å€æ˜¯&amp;a<br><em>ç¬¦å·çš„æ„æ€æ˜¯å¯¹æŒ‡é’ˆå–å€¼ï¼Œ</em>å’Œè½&amp;è½å¯ä»¥äº’ç›¸æŠµæ¶ˆ,åŒæ—¶æ³¨æ„ï¼Œ*&amp;å¯ä»¥æŠµæ¶ˆæ‰ï¼Œä½†&amp;*æ˜¯ä¸å¯ä»¥æŠµæ¶ˆçš„</p></blockquote><h3 id="åˆ‡ç‰‡å®¹é‡"><a href="#åˆ‡ç‰‡å®¹é‡" class="headerlink" title="åˆ‡ç‰‡å®¹é‡"></a>åˆ‡ç‰‡å®¹é‡</h3><blockquote><p>å®¹é‡å½“åšæˆæ€»é•¿åº¦å‡å»å·¦æŒ‡é’ˆèµ°è¿‡çš„å…ƒç´ å€¼</p></blockquote><div class="code-wrapper"><pre><code class="hljs">ä¸€æ—¦ä¸€ä¸ªåˆ‡ç‰‡æ— æ³•å®¹çº³æ›´å¤šçš„å…ƒç´ ï¼ŒGoè¯­è¨€å°±ä¼šæƒ³åŠæ³•æ‰©å®¹ã€‚ä½†å®ƒå¹¶ä¸ä¼šæ”¹å˜åŸæ¥çš„åˆ‡ç‰‡ï¼Œè€Œæ˜¯ä¼šç”Ÿæˆä¸€ä¸ªå®¹é‡æ›´å¤§çš„åˆ‡ç‰‡ï¼Œç„¶åå°†æŠŠåŸæœ‰çš„å…ƒç´ å’Œæ–°å…ƒç´ ä¸€å¹¶æ‹·è´åˆ°æ–°åˆ‡ç‰‡ä¸­ã€‚åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç®€å•åœ°è®¤ä¸ºæ–°åˆ‡ç‰‡çš„å®¹é‡ï¼ˆä»¥ä¸‹ç®€ç§°æ–°å®¹é‡ï¼‰å°†ä¼šæ˜¯åŸåˆ‡ç‰‡å®¹é‡ï¼ˆä»¥ä¸‹ç®€ç§°åŸå®¹é‡ï¼‰çš„2å€ã€‚ä½†æ˜¯ï¼Œå½“åŸåˆ‡ç‰‡çš„é•¿åº¦ï¼ˆä»¥ä¸‹ç®€ç§°åŸé•¿åº¦ï¼‰å¤§äºæˆ–ç­‰äº1024æ—¶ï¼ŒGoè¯­è¨€å°†ä¼šä»¥åŸå®¹é‡çš„1.25å€ä½œä¸ºæ–°å®¹é‡çš„åŸºå‡†ï¼ˆä»¥ä¸‹æ–°å®¹é‡åŸºå‡†ï¼‰ã€‚æ–°å®¹é‡åŸºå‡†ä¼šè¢«è°ƒæ•´ï¼ˆä¸æ–­åœ°ä¸1.25ç›¸ä¹˜ï¼‰ï¼Œç›´åˆ°ç»“æœä¸å°äºåŸé•¿åº¦ä¸è¦è¿½åŠ çš„å…ƒç´ æ•°é‡ä¹‹å’Œï¼ˆä»¥ä¸‹ç®€ç§°æ–°é•¿åº¦ï¼‰ã€‚æœ€ç»ˆï¼Œæ–°å®¹é‡å¾€å¾€ä¼šæ¯”æ–°é•¿åº¦å¤§ä¸€äº›ï¼Œå½“ç„¶ï¼Œç›¸ç­‰ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä¸€æ¬¡è¿½åŠ çš„å…ƒç´ è¿‡å¤šï¼Œä»¥è‡³äºä½¿æ–°é•¿åº¦æ¯”åŸå®¹é‡çš„2å€è¿˜è¦å¤§ï¼Œé‚£ä¹ˆæ–°å®¹é‡å°±ä¼šä»¥æ–°é•¿åº¦ä¸ºåŸºå‡†ã€‚</code></pre></div><h3 id="å¤§å°å†™"><a href="#å¤§å°å†™" class="headerlink" title="å¤§å°å†™"></a>å¤§å°å†™</h3><blockquote><p>åœ¨Goè¯­è¨€ä¸­ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªæ–¹æ³•ã€å‡½æ•°æˆ–è€…ç±»å‹æ˜¯å¦ä¸ºå…¬å¼€çš„ï¼ŒGoè¯­è¨€æä¾›çš„æ˜¯ä»¥å¤§å°å†™çš„æ–¹å¼è¿›è¡ŒåŒºåˆ†çš„ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„åå­—æ˜¯ä»¥å¤§å†™å¼€å¤´ï¼Œé‚£ä¹ˆå…¶ä»–åŒ…å°±å¯ä»¥è®¿é—®ï¼›å¦‚æœä»¥å°å†™å¼€å¤´ï¼Œå…¶ä»–åŒ…å°±ä¸èƒ½è®¿é—®ã€‚</p></blockquote><h3 id="goçš„å¹¶å‘"><a href="#goçš„å¹¶å‘" class="headerlink" title="goçš„å¹¶å‘"></a>goçš„å¹¶å‘</h3><table><thead><tr><th>æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è¿›ç¨‹</td><td>ä¸€ä¸ªç¨‹åºå¯¹åº”ä¸€ä¸ªç‹¬ç«‹ç¨‹åºç©ºé—´</td></tr><tr><td>çº¿ç¨‹</td><td>ä¸€ä¸ªæ‰§è¡Œç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹</td></tr><tr><td>é€»è¾‘å¤„ç†å™¨</td><td>æ‰§è¡Œåˆ›å»ºçš„goroutineï¼Œç»‘å®šä¸€ä¸ªçº¿ç¨‹</td></tr><tr><td>è°ƒåº¦å™¨</td><td>Goè¿è¡Œæ—¶ä¸­çš„ï¼Œåˆ†é…goroutineç»™ä¸åŒçš„é€»è¾‘å¤„ç†å™¨</td></tr><tr><td>å…¨å±€è¿è¡Œé˜Ÿåˆ—</td><td>æ‰€æœ‰åˆšåˆ›å»ºçš„goroutineéƒ½ä¼šæ”¾åˆ°è¿™é‡Œ</td></tr><tr><td>æœ¬åœ°è¿è¡Œé˜Ÿåˆ—</td><td>é€»è¾‘å¤„ç†å™¨çš„goroutineé˜Ÿåˆ—</td></tr></tbody></table><blockquote><p>å¹¶å‘çš„æ¦‚å¿µå’Œå¹¶è¡Œä¸ä¸€æ ·ï¼Œå¹¶è¡ŒæŒ‡çš„æ˜¯åœ¨ä¸åŒçš„ç‰©ç†å¤„ç†å™¨ä¸ŠåŒæ—¶æ‰§è¡Œä¸åŒçš„ä»£ç ç‰‡æ®µï¼Œå¹¶è¡Œå¯ä»¥åŒæ—¶åšå¾ˆå¤šäº‹æƒ…ï¼Œè€Œå¹¶å‘æ˜¯åŒæ—¶ç®¡ç†å¾ˆå¤šäº‹æƒ…ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„æ€»èµ„æºæ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¹¶å‘çš„æ•ˆæœè¦æ¯”å¹¶è¡Œå¥½çš„å¤šï¼Œä½¿ç”¨è¾ƒå°‘çš„èµ„æºåšæ›´å¤šçš„äº‹æƒ…ï¼Œä¹Ÿæ˜¯Goè¯­è¨€æå€¡çš„ã€‚</p></blockquote><h3 id="é€šé“"><a href="#é€šé“" class="headerlink" title="é€šé“"></a>é€šé“</h3><div class="code-wrapper"><pre><code class="hljs go">h:=<span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)é€šé“ç±»å‹å’ŒMapè¿™äº›ç±»å‹ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„<span class="hljs-built_in">make</span>å‡½æ•°å£°æ˜åˆå§‹åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬åˆå§‹åŒ–äº†ä¸€ä¸ª<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>ç±»å‹çš„é€šé“ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å¾€è¿™ä¸ªé€šé“é‡Œå‘é€<span class="hljs-keyword">int</span>ç±»å‹çš„æ•°æ®ï¼Œå½“ç„¶æ¥æ”¶ä¹Ÿåªèƒ½æ˜¯<span class="hljs-keyword">int</span>ç±»å‹çš„æ•°æ®ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œé€šé“æ˜¯ç”¨äºåœ¨goroutineä¹‹é—´é€šä¿¡çš„ï¼Œå®ƒå…·æœ‰å‘é€å’Œæ¥æ”¶ä¸¤ä¸ªæ“ä½œï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæ“ä½œçš„è¿ç®—ç¬¦éƒ½æ˜¯&lt;-ã€‚ch &lt;- <span class="hljs-number">2</span> <span class="hljs-comment">//å‘é€æ•°å€¼2ç»™è¿™ä¸ªé€šé“</span>x:=&lt;-ch <span class="hljs-comment">//ä»é€šé“é‡Œè¯»å–å€¼ï¼Œå¹¶æŠŠè¯»å–çš„å€¼èµ‹å€¼ç»™xå˜é‡</span>&lt;-ch <span class="hljs-comment">//ä»é€šé“é‡Œè¯»å–å€¼ï¼Œç„¶åå¿½ç•¥</span>çœ‹ä¾‹å­ï¼Œæ…¢æ…¢ç†è§£å‘é€å’Œæ¥æ”¶çš„ç”¨æ³•ã€‚å‘é€æ“ä½œ&lt;-åœ¨é€šé“çš„åé¢ï¼Œçœ‹ç®­å¤´æ–¹å‘ï¼Œè¡¨ç¤ºæŠŠæ•°å€¼<span class="hljs-number">2</span>å‘é€åˆ°é€šé“ché‡Œï¼›æ¥æ”¶æ“ä½œ&lt;-åœ¨é€šé“çš„å‰é¢ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªä¸€å…ƒæ“ä½œç¬¦ï¼Œçœ‹ç®­å¤´æ–¹å‘ï¼Œè¡¨ç¤ºä»é€šé“ché‡Œè¯»å–æ•°æ®ã€‚è¯»å–çš„æ•°æ®å¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥ã€‚é€šé“æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å†…ç½®çš„<span class="hljs-built_in">close</span>å‡½æ•°å…³é—­ã€‚<span class="hljs-built_in">close</span>(ch)</code></pre></div><h3 id="æ— ç¼“å†²çš„é€šé“"><a href="#æ— ç¼“å†²çš„é€šé“" class="headerlink" title="æ— ç¼“å†²çš„é€šé“"></a>æ— ç¼“å†²çš„é€šé“</h3><p>æ— ç¼“å†²çš„é€šé“æŒ‡çš„æ˜¯é€šé“çš„å¤§å°ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§ç±»å‹çš„é€šé“åœ¨æ¥æ”¶å‰æ²¡æœ‰èƒ½åŠ›ä¿å­˜ä»»ä½•å€¼ï¼Œå®ƒè¦æ±‚å‘é€goroutineå’Œæ¥æ”¶goroutineåŒæ—¶å‡†å¤‡å¥½ï¼Œæ‰å¯ä»¥å®Œæˆå‘é€å’Œæ¥æ”¶æ“ä½œã€‚</p><p>ä»ä¸Šé¢æ— ç¼“å†²çš„é€šé“å®šä¹‰æ¥çœ‹ï¼Œå‘é€goroutineå’Œæ¥æ”¶gouroutineå¿…é¡»æ˜¯åŒæ­¥çš„ï¼ŒåŒæ—¶å‡†å¤‡åï¼Œå¦‚æœæ²¡æœ‰åŒæ—¶å‡†å¤‡å¥½çš„è¯ï¼Œå…ˆæ‰§è¡Œçš„æ“ä½œå°±ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªç›¸å¯¹åº”çš„æ“ä½œå‡†å¤‡å¥½ä¸ºæ­¢ã€‚è¿™ç§æ— ç¼“å†²çš„é€šé“æˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºåŒæ­¥é€šé“ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;            <span class="hljs-keyword">var</span> sum <span class="hljs-keyword">int</span> = <span class="hljs-number">0</span>            <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;                sum += i            &#125;            ch &lt;- sum    &#125;()    fmt.Println(&lt;-ch)&#125;</code></pre></div><h3 id="æœ‰ç¼“å†²çš„é€šé“"><a href="#æœ‰ç¼“å†²çš„é€šé“" class="headerlink" title="æœ‰ç¼“å†²çš„é€šé“"></a>æœ‰ç¼“å†²çš„é€šé“</h3><p>æœ‰ç¼“å†²é€šé“ï¼Œå…¶å®æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨makeå‡½æ•°åˆ›å»ºé€šé“æ—¶ï¼Œé€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„ã€‚</p><p>ch := make(chan int, 3)<br>è¿™é‡Œåˆ›å»ºå®¹é‡ä¸º3çš„ï¼Œæœ‰ç¼“å†²çš„é€šé“ã€‚å¯¹äºæœ‰ç¼“å†²çš„é€šé“ï¼Œå‘å…¶å‘é€æ“ä½œå°±æ˜¯å‘é˜Ÿåˆ—çš„å°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œæ¥æ”¶æ“ä½œåˆ™æ˜¯ä»é˜Ÿåˆ—çš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¹¶è¿”å›è¿™ä¸ªåˆšåˆšåˆ é™¤çš„å…ƒç´ ã€‚</p><p>å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œå‘é€æ“ä½œä¼šé˜»å¡ï¼›å½“é˜Ÿåˆ—ç©ºçš„æ—¶å€™ï¼Œæ¥å—æ“ä½œä¼šé˜»å¡ã€‚æœ‰ç¼“å†²çš„é€šé“ï¼Œä¸è¦æ±‚å‘é€å’Œæ¥æ”¶æ“ä½œæ—¶åŒæ­¥çš„ï¼Œç›¸åå¯ä»¥è§£è€¦å‘é€å’Œæ¥æ”¶æ“ä½œã€‚</p><p>æƒ³çŸ¥é“é€šé“çš„å®¹é‡ä»¥åŠé‡Œé¢æœ‰å‡ ä¸ªå…ƒç´ æ•°æ®æ€ä¹ˆåŠï¼Ÿå…¶å®å’Œmapä¸€æ ·ï¼Œä½¿ç”¨capå’Œlenå‡½æ•°å°±å¯ä»¥äº†ã€‚</p><div class="code-wrapper"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">cap</span><span class="hljs-params">(ch)</span></span><span class="hljs-function"><span class="hljs-title">len</span><span class="hljs-params">(ch)</span></span></code></pre></div><p>capå‡½æ•°è¿”å›é€šé“çš„æœ€å¤§å®¹é‡ï¼Œlenå‡½æ•°è¿”å›ç°åœ¨é€šé“é‡Œæœ‰å‡ ä¸ªå…ƒç´ ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">mirroredQuery</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;    responses := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>, <span class="hljs-number">3</span>)    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; responses &lt;- request(<span class="hljs-string">&quot;asia.gopl.io&quot;</span>) &#125;()    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; responses &lt;- request(<span class="hljs-string">&quot;europe.gopl.io&quot;</span>) &#125;()        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; responses &lt;- request(<span class="hljs-string">&quot;americas.gopl.io&quot;</span>) &#125;()        <span class="hljs-keyword">return</span> &lt;-responses <span class="hljs-comment">// return the quickest response</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">request</span><span class="hljs-params">(hostname <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(response <span class="hljs-keyword">string</span>)</span></span> &#123; <span class="hljs-comment">/* ... */</span> &#125;</code></pre></div><h3 id="å•å‘é€šé“"><a href="#å•å‘é€šé“" class="headerlink" title="å•å‘é€šé“"></a>å•å‘é€šé“</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œæ¯”å¦‚é™åˆ¶ä¸€ä¸ªé€šé“åªå¯ä»¥æ¥æ”¶ï¼Œä½†æ˜¯ä¸èƒ½å‘é€ï¼›æœ‰æ—¶å€™é™åˆ¶ä¸€ä¸ªé€šé“åªèƒ½å‘é€ï¼Œä½†æ˜¯ä¸èƒ½æ¥æ”¶ï¼Œè¿™ç§é€šé“æˆ‘ä»¬ç§°ä¸ºå•å‘é€šé“ã€‚è¿™ä¸ªåœ¨ç”Ÿäº§è€…æ¶ˆè´¹è€…å¾ˆå®ç”¨ã€‚</p><p>å®šä¹‰å•å‘é€šé“ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œå¸¦ä¸Š&lt;-å³å¯ã€‚</p><div class="code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">var</span> send <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span> <span class="hljs-comment">//åªèƒ½å‘é€</span><span class="hljs-keyword">var</span> receive &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span> <span class="hljs-comment">//åªèƒ½æ¥æ”¶</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨jenkinså‘å¸ƒä»£ç </title>
    <link href="/2019/07/31/194/"/>
    <url>/2019/07/31/194/</url>
    
    <content type="html"><![CDATA[<h3 id="å®‰è£…jenkins"><a href="#å®‰è£…jenkins" class="headerlink" title="å®‰è£…jenkins"></a>å®‰è£…jenkins</h3><div class="code-wrapper"><pre><code class="hljs livescript">docker run <span class="hljs-string">\</span>  -u root <span class="hljs-string">\</span>  --rm <span class="hljs-string">\</span>  -d <span class="hljs-string">\</span>  -p <span class="hljs-number">8090</span>:<span class="hljs-number">8080</span> <span class="hljs-string">\</span>  -p <span class="hljs-number">50000</span>:<span class="hljs-number">50000</span> <span class="hljs-string">\</span>  -v jenkins-data:/<span class="hljs-keyword">var</span>/jenkins_home <span class="hljs-string">\</span>  -v /<span class="hljs-keyword">var</span>/run/docker.sock:/<span class="hljs-keyword">var</span>/run/docker.sock <span class="hljs-string">\</span>  jenkinsci/blueocean</code></pre></div><p>è¿›å…¥å®¹å™¨æŸ¥çœ‹å¯†ç ï¼š</p><blockquote><p>docker exec -it 6d1a7f988069 /bin/bash</p></blockquote><p>å¯†ç å­˜å‚¨è·¯å¾„ </p><blockquote><p>/var/jenkins_home/secrets/initialAdminPassword</p></blockquote><h3 id="jenkinså…³è”gitï¼Œæ‹‰å–æ— éœ€å¯†ç éªŒè¯"><a href="#jenkinså…³è”gitï¼Œæ‹‰å–æ— éœ€å¯†ç éªŒè¯" class="headerlink" title="jenkinså…³è”gitï¼Œæ‹‰å–æ— éœ€å¯†ç éªŒè¯"></a>jenkinså…³è”gitï¼Œæ‹‰å–æ— éœ€å¯†ç éªŒè¯</h3><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> äº§ç”Ÿå…¬é’¥ä¸ç§é’¥å¯¹.ssh-keygen<span class="hljs-regexp">//</span> ç”¨ssh-copy-idå°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨ä¸­(gitlabç­‰)ssh-copy-id -i .ssh/id_rsa.pub  git@xxx.com</code></pre></div><h3 id="jenkinså…³è”ä»£ç æœåŠ¡å™¨ï¼ŒåŒæ­¥æ— éœ€å¯†ç éªŒè¯"><a href="#jenkinså…³è”ä»£ç æœåŠ¡å™¨ï¼ŒåŒæ­¥æ— éœ€å¯†ç éªŒè¯" class="headerlink" title="jenkinså…³è”ä»£ç æœåŠ¡å™¨ï¼ŒåŒæ­¥æ— éœ€å¯†ç éªŒè¯"></a>jenkinså…³è”ä»£ç æœåŠ¡å™¨ï¼ŒåŒæ­¥æ— éœ€å¯†ç éªŒè¯</h3><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> å°½é‡ä½¿ç”¨å†…ç½‘ipscp -p .ssh<span class="hljs-regexp">/id_rsa.pub www@172.17.158.15:/</span>home<span class="hljs-regexp">/www/</span>.ssh/authorized_keys</code></pre></div><h3 id="æ–°å»ºé¡¹ç›®"><a href="#æ–°å»ºé¡¹ç›®" class="headerlink" title="æ–°å»ºé¡¹ç›®"></a>æ–°å»ºé¡¹ç›®</h3><ol><li>é€‰æ‹©è‡ªç”±é£æ ¼é¡¹ç›®</li><li>Source Code Managementå¡«å†™gitåœ°å€</li><li>Buildæ‰§è¡Œshellè„šæœ¬</li></ol><p>shell demo</p><div class="code-wrapper"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;BUILD_USER&#125;</span>SOURCE_DIR=/var/jenkins_home/workspace/<span class="hljs-variable">$&#123;JOB_NAME&#125;</span>/DEST_DIR=/usr/<span class="hljs-built_in">local</span>/nginx/html/jenkinsREMOTE_IP=172.17.158.15scp -r  <span class="hljs-variable">$SOURCE_DIR</span> www@<span class="hljs-variable">$REMOTE_IP</span>:<span class="hljs-variable">$DEST_DIR</span></code></pre></div><h3 id="ä¿å­˜åç‚¹å‡»æ„å»ºã€‚"><a href="#ä¿å­˜åç‚¹å‡»æ„å»ºã€‚" class="headerlink" title="ä¿å­˜åç‚¹å‡»æ„å»ºã€‚"></a>ä¿å­˜åç‚¹å‡»æ„å»ºã€‚</h3><h3 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h3><p>jenkinsæ‹‰å–gitä»£ç jenkinsæœåŠ¡å™¨ï¼ŒscpåŒæ­¥ä»£ç åˆ°ä»£ç æœåŠ¡å™¨ã€‚</p><p>æ˜“å‡ºé”™ç‚¹ï¼š</p><ol><li>æœåŠ¡å™¨ç›®å½•æƒé™é—®é¢˜</li><li>gitæ‹‰å–sshéªŒè¯</li><li>ç›®å½•</li></ol><p>æ„å»ºæ—¶å¯æŸ¥çœ‹Console Outputä¿¡æ¯ï¼Œèƒ½çœ‹å‡ºå“ªä¸€æ­¥é”™è¯¯ï¼Œç„¶åå¤„ç†å³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginxæ—¥å¿—æŒ‰æ—¥é…ç½®</title>
    <link href="/2019/07/23/Nginx8/"/>
    <url>/2019/07/23/Nginx8/</url>
    
    <content type="html"><![CDATA[<p>è€å®è¯´ï¼Œæˆ‘è§‰å¾—nginxæ²¡æœ‰æ—¥å¿—æŒ‰æ—¥é…ç½®åŠŸèƒ½ç¼ºå¤±æœ‰ç‚¹è´¹è§£ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç å®ç°ã€‚<br>é…ç½®å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> ($time_iso8601 <span class="hljs-regexp">~ &quot;^(\d</span>&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;) &#123;    <span class="hljs-attribute">set</span> $day <span class="hljs-variable">$1</span><span class="hljs-variable">$2</span><span class="hljs-variable">$3</span>;&#125;<span class="hljs-attribute">access_log</span> logs/access-$day.log main;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lua+nginxå®ç°é»‘åå•ç¦æ­¢è®¿é—®</title>
    <link href="/2019/07/16/192/"/>
    <url>/2019/07/16/192/</url>
    
    <content type="html"><![CDATA[<p>Lua æ˜¯å¯ä»¥å¾ˆå¥½åœ°å’ŒNginxé…åˆä½¿ç”¨çš„ï¼Œå¸¦ç›´æ¥ä½¿ç”¨ Nginx æ˜¯éœ€è¦å®‰è£…æ‰©å±•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åŠ›æ±‚ç®€å•ï¼Œçœå»å®‰è£…ï¼Œä½¿ç”¨OpenRestyï¼ˆåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼‰ï¼Œåœ°å€:<a href="http://openresty.org/cn/">OpenRestyåœ°å€</a></p><blockquote><p>è¯´æ˜ï¼šæˆ‘æ˜¯åœ¨windows7ç”µè„‘ä¸Šæµ‹è¯•ä½¿ç”¨</p></blockquote><p>ä¸»è¦é…ç½®ä»£ç å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">lua_shared_dict</span> ip_blacklist <span class="hljs-number">1m</span>;<span class="hljs-section">server</span> &#123;    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;    <span class="hljs-attribute">server_name</span>  localhost;    <span class="hljs-attribute">root</span>   E:/www/web/test;    <span class="hljs-attribute">access_log</span>  logs/host.access.log ;    <span class="hljs-attribute">error_log</span>  logs/host.<span class="hljs-literal">error</span>.log;    <span class="hljs-attribute">location</span> / &#123;        <span class="hljs-attribute">access_by_lua_file</span> ../lua/black.lua;        <span class="hljs-attribute">index</span>  index.html index.htm;    &#125;        <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;    <span class="hljs-attribute">location</span> = /50x.html &#123;        <span class="hljs-attribute">root</span>   html;    &#125;        <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ \.php$</span> &#123;        <span class="hljs-attribute">access_by_lua_file</span> <span class="hljs-string">&quot;D:\openresty-1.15.8.1-win64/lua/black.lua&quot;</span>;        <span class="hljs-attribute">fastcgi_pass</span>   <span class="hljs-number">127.0.0.1:9000</span>;        <span class="hljs-attribute">fastcgi_index</span>  index.php;        <span class="hljs-attribute">fastcgi_param</span>  SCRIPT_FILENAME  $document_root$fastcgi_script_name;        <span class="hljs-attribute">include</span>        fastcgi_params;    &#125;&#125;</code></pre></div><p>ç®€è¦è¯´æ˜:</p><blockquote><p>lua_shared_dict åˆ†é…ç»™ip_blacklistçš„å†…å­˜ï¼Œå¯æ ¹æ®ä¸šåŠ¡é‡è‡ªè¡Œå†³å®š<br>access_by_lua_file æŒ‡å®š lua æ–‡ä»¶</p></blockquote><p>black.lua ä»£ç å¦‚ä¸‹[è¯´æ˜è¾ƒå¤šï¼Œç›´æ¥æ”¾æ³¨é‡Šäº†]:</p><div class="code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">local</span> Redis_host    = &quot;127.0.0.1&quot; <span class="hljs-comment">-- Redisçš„IPåœ°å€</span><span class="hljs-keyword">local</span> Redis_port    = &quot;6379&quot;<span class="hljs-comment">-- è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½msï¼Œä¸å»ºè®®è®¾ç½®å¤ªé«˜</span><span class="hljs-keyword">local</span> Redis_connection_timeout = <span class="hljs-number">1000</span><span class="hljs-keyword">local</span> Redis_key  = &quot;ip_blacklist&quot;<span class="hljs-comment">-- ç¼“å­˜æ—¶é—´ï¼Œå•ä½ s</span><span class="hljs-keyword">local</span> cache_ttl  = <span class="hljs-number">100</span><span class="hljs-comment">-- ä»¥ä¸Šæ˜¯é…ç½®</span><span class="hljs-keyword">local</span> ip                = ngx.var.remote_addr<span class="hljs-keyword">local</span> ip_blacklist      = ngx.shared.ip_blacklist<span class="hljs-keyword">local</span> last_update_time  = ip_blacklist:<span class="hljs-keyword">get</span>(&quot;last_update_time&quot;);<span class="hljs-comment">-- å½“ç¼“å­˜æ—¶é—´åˆ°æœŸæ›´æ–°blacklist</span><span class="hljs-keyword">if</span> last_update_time == nil <span class="hljs-keyword">or</span> last_update_time &lt; ( ngx.now() - cache_ttl ) <span class="hljs-keyword">then</span>  <span class="hljs-keyword">local</span> Redis = require &quot;resty.Redis&quot;;  <span class="hljs-keyword">local</span> red = Redis:<span class="hljs-built_in">new</span>();  red:set_timeout(Redis_connect_timeout);  <span class="hljs-keyword">local</span> ok, err = red:<span class="hljs-keyword">connect</span>(Redis_host, Redis_port);  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span>    ngx.say(&quot;Redis connect failed: &quot;, err)    ngx.log(ngx.<span class="hljs-keyword">DEBUG</span>, &quot;Redis connection error while retrieving ip_blacklist: &quot; .. err);    <span class="hljs-keyword">return</span> ngx.<span class="hljs-keyword">exit</span>(ngx.HTTP_INTERNAL_SERVER_ERROR)  <span class="hljs-keyword">else</span>    <span class="hljs-comment">-- local res, err = red:auth(&quot;foobared&quot;) -- é…ç½®Redisçš„å¯†ç ï¼Œæˆ‘æµ‹è¯•æœªè®¾ç½®å¯†ç ï¼Œä»£ç æ³¨é‡Š</span>    <span class="hljs-comment">--if not res then</span>        <span class="hljs-comment">--ngx.say(&quot;Redis auth is error: &quot;, err)</span>        <span class="hljs-comment">--return</span>    <span class="hljs-comment">--end</span>    red:<span class="hljs-keyword">select</span>(<span class="hljs-number">0</span>)    <span class="hljs-keyword">local</span> new_ip_blacklist, err = red:smembers(Redis_key);    <span class="hljs-keyword">if</span> err <span class="hljs-keyword">then</span>      ngx.log(ngx.<span class="hljs-keyword">DEBUG</span>, &quot;Redis read error while retrieving ip_blacklist: &quot; .. err);    <span class="hljs-keyword">else</span>      <span class="hljs-comment">-- æƒ…å†µæœ¬åœ°å­˜å‚¨</span>      ip_blacklist:flush_all();      <span class="hljs-keyword">for</span> <span class="hljs-keyword">index</span>, banned_ip <span class="hljs-keyword">in</span> ipairs(new_ip_blacklist) <span class="hljs-keyword">do</span>        ip_blacklist:<span class="hljs-keyword">set</span>(banned_ip, <span class="hljs-keyword">true</span>);      <span class="hljs-keyword">end</span>      <span class="hljs-comment">-- æ›´æ–°æ—¶é—´</span>      ip_blacklist:<span class="hljs-keyword">set</span>(&quot;last_update_time&quot;, ngx.now());    <span class="hljs-keyword">end</span>  <span class="hljs-keyword">end</span><span class="hljs-keyword">end</span><span class="hljs-keyword">if</span> ip_blacklist:<span class="hljs-keyword">get</span>(ip) <span class="hljs-keyword">then</span>  <span class="hljs-comment">--ngx.say(ip)</span>  ngx.log(ngx.<span class="hljs-keyword">DEBUG</span>, &quot;Banned IP detected and refused access: &quot; .. ip);  <span class="hljs-keyword">return</span> ngx.<span class="hljs-keyword">exit</span>(ngx.HTTP_FORBIDDEN);<span class="hljs-keyword">end</span></code></pre></div><p>è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªé»‘åå•åŠŸèƒ½å®Œæˆã€‚</p><p>å½“ç„¶äº†ï¼Œè¿™åªæ˜¯ä¸ªåŸºç¡€ç‰ˆæœ¬ï¼Œä½ å¯ä»¥è®©è¿™ä¸ªç¦æ­¢è®¿é—®åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ¯”å¦‚å¢åŠ å¯ç–‘ipå†™å…¥ï¼Œæ¯”å¦‚å¢åŠ ipé™æµç­‰ç­‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravelç®¡ç†æ—¥å¿—</title>
    <link href="/2019/07/04/191/"/>
    <url>/2019/07/04/191/</url>
    
    <content type="html"><![CDATA[<p>æ—¥å¿—æ˜¯å¾ˆé‡è¦çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆå¦‚ä½•é…ç½®èƒ½è®©Laravelæ›´å¥½ç®¡ç†å’ŒæŸ¥çœ‹å‘¢ï¼Ÿ</p><ol><li>æŒ‰æ—¥æŸ¥çœ‹<br>è®¾ç½®ç®€å•ï¼Œåœ¨.envåŠ å…¥APP_LOG=dailyï¼Œå¦å¤–å¯å®šä¹‰æœ€å¤§æ—¥å¿—ä¿å­˜å¤©æ•°<br>åœ¨é…ç½®æ–‡ä»¶config/app.phpä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<div class="code-wrapper"><pre><code class="hljs language">log_max_files=&gt;30</code></pre></div></li></ol><ol start="2"><li>æ”¶é›†é‡è¦æ—¥å¿—<div class="code-wrapper"><pre><code class="hljs language">Log::useFiles(storage_path(logs/important.log));// æŒ‰æ—¥ï¼Œå­˜å‚¨30å¤©çš„Log::useDailyFiles(storage_path(logs/importantDaily.log, 30));</code></pre></div></li></ol>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravelæ¨¡æ¿æ¸²æŸ“çš„é—®é¢˜</title>
    <link href="/2019/05/22/189/"/>
    <url>/2019/05/22/189/</url>
    
    <content type="html"><![CDATA[<h2 id="1-laravelæ¨¡æ¿å˜é‡ç¬¦æ›´æ”¹"><a href="#1-laravelæ¨¡æ¿å˜é‡ç¬¦æ›´æ”¹" class="headerlink" title="1. laravelæ¨¡æ¿å˜é‡ç¬¦æ›´æ”¹"></a>1. laravelæ¨¡æ¿å˜é‡ç¬¦æ›´æ”¹</h2><p>å‰å‡ å¤©æ”¹ç‰ˆæ—¶ï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯ä½¿ç”¨äº†art-templateï¼Œåˆšå¥½æœ‰å’ŒLaravelé»˜è®¤çš„å˜é‡ç¬¦å·ï¼Œå°±å‘ç°äº†ç‚¹é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li>å‰ç«¯ä¿®æ”¹art-templateçš„ç¬¦å·ï¼Œé˜²æ­¢å’ŒLaravelå†²çªï¼›</li><li>ä¿®æ”¹Laravelæ¨¡æ¿å˜é‡ç¬¦-åŒå¤§æ‹¬å·</li></ol><p>å¯ä»¥åœ¨æ§åˆ¶å™¨è°ƒç”¨viewæ–¹æ³•ä¹‹å‰åŠ å…¥</p><div class="code-wrapper"><pre><code class="hljs lua">Blade::setContentTags(<span class="hljs-string">[[, ]]</span>);Blade::setEscapedContentTags(&#123;[@, @]&#125;);</code></pre></div><p>ä¾¿å¯ä»¥ç”¨{[@, @]}æ›¿ä»£åŸæ¥çš„åŒå¤§æ‹¬å·ã€‚</p><hr><h2 id="2-åŠ è½½htmlä¸ä½¿ç”¨bladeæ¨¡æ¿å¼•æ“"><a href="#2-åŠ è½½htmlä¸ä½¿ç”¨bladeæ¨¡æ¿å¼•æ“" class="headerlink" title="2. åŠ è½½htmlä¸ä½¿ç”¨bladeæ¨¡æ¿å¼•æ“"></a>2. åŠ è½½htmlä¸ä½¿ç”¨bladeæ¨¡æ¿å¼•æ“</h2><p>é™¤äº†è¿™ä¸ªè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚å‰åç«¯åˆ†ç¦»çš„æ—¶å€™ï¼Œæˆ‘åªæƒ³åŠ è½½htmlï¼Œä¸éœ€è¦æ¸²æŸ“æ›¿æ¢ï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><div class="code-wrapper"><pre><code class="hljs pgsql">Route::<span class="hljs-keyword">get</span>(/, <span class="hljs-keyword">function</span> () &#123;        \<span class="hljs-keyword">View</span>::addExtension(html, php);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">view</span>()-&gt;file(<span class="hljs-keyword">index</span>.html);//æ³¨æ„æ­¤å¤„è·¯å¾„æ˜¯<span class="hljs-built_in">public</span>&#125;);</code></pre></div><p>å°±è¿™æ ·åŠ è½½å°±ok äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxçš„topå‘½ä»¤è¯¦è§£</title>
    <link href="/2019/04/26/186/"/>
    <url>/2019/04/26/186/</url>
    
    <content type="html"><![CDATA[<p> topå‘½ä»¤æ˜¯Linuxä¸‹å¸¸ç”¨çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºç³»ç»Ÿä¸­å„ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨çŠ¶å†µï¼Œå¸¸ç”¨äºæœåŠ¡ç«¯æ€§èƒ½åˆ†æã€‚</p><p><img src="/images/qiniu/1556243283000.png" alt="top"></p><p>ç»Ÿè®¡ä¿¡æ¯åŒºå‰äº”è¡Œæ˜¯ç³»ç»Ÿæ•´ä½“çš„ç»Ÿè®¡ä¿¡æ¯ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs x86asm">ç¬¬ä¸€è¡ŒæœåŠ¡å™¨è¿è¡Œä¿¡æ¯ï¼š<span class="hljs-number">09</span>:<span class="hljs-number">46</span>:<span class="hljs-number">41</span>    å½“å‰æ—¶é—´<span class="hljs-meta">up</span> 71daysï¼Œ<span class="hljs-number">16</span>:<span class="hljs-number">51</span>    ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œæ ¼å¼ä¸ºå¤©ï¼Œæ—¶:åˆ†<span class="hljs-number">2</span> users    å½“å‰ç™»å½•ç”¨æˆ·æ•°load average: <span class="hljs-number">0.00</span>, <span class="hljs-number">0.00</span>, <span class="hljs-number">0.00</span>    ç³»ç»Ÿè´Ÿè½½ï¼Œå³ä»»åŠ¡é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦ã€‚ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸º <span class="hljs-number">1</span>åˆ†é’Ÿã€<span class="hljs-number">5</span>åˆ†é’Ÿã€<span class="hljs-number">15</span>åˆ†é’Ÿå‰åˆ°ç°åœ¨çš„å¹³å‡å€¼ã€‚ ç¬¬äºŒè¡Œä¸ºè¿›ç¨‹ä¿¡æ¯Tasks:total è¿›ç¨‹æ€»æ•°running æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°sleeping ç¡çœ çš„è¿›ç¨‹æ•°stopped åœæ­¢çš„è¿›ç¨‹æ•°zombie åƒµå°¸è¿›ç¨‹æ•°ç¬¬ä¸‰è¡Œ<span class="hljs-meta">CPU</span>ä¿¡æ¯<span class="hljs-meta">Cpu</span>(s): <span class="hljs-number">0.5</span>% us ç”¨æˆ·ç©ºé—´å ç”¨<span class="hljs-meta">CPU</span>ç™¾åˆ†æ¯”<span class="hljs-number">0.3</span>% sy å†…æ ¸ç©ºé—´å ç”¨<span class="hljs-meta">CPU</span>ç™¾åˆ†æ¯”<span class="hljs-number">0.0</span>% ni ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨<span class="hljs-meta">CPU</span>ç™¾åˆ†æ¯”<span class="hljs-number">99.0</span>% id ç©ºé—²<span class="hljs-meta">CPU</span>ç™¾åˆ†æ¯”<span class="hljs-number">0.0</span>% wa ç­‰å¾…è¾“å…¥è¾“å‡ºçš„<span class="hljs-meta">CPU</span>æ—¶é—´ç™¾åˆ†æ¯”<span class="hljs-number">0.2</span>%hiï¼šç¡¬ä»¶<span class="hljs-meta">CPU</span>ä¸­æ–­å ç”¨ç™¾åˆ†æ¯”<span class="hljs-number">0.0</span>%siï¼šè½¯ä¸­æ–­å ç”¨ç™¾åˆ†æ¯”<span class="hljs-number">0.0</span>%stï¼šè™šæ‹Ÿæœºå ç”¨ç™¾åˆ†æ¯” ç¬¬å››è¡ŒMemå†…å­˜ä¿¡æ¯:8189652k total    ç‰©ç†å†…å­˜æ€»é‡7885740k used    ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡303912k free    ç©ºé—²å†…å­˜æ€»é‡566272k buffers    ç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡ç¬¬äº”è¡Œswapäº¤æ¢åˆ†åŒºä¿¡æ¯: 4194300k total    äº¤æ¢åŒºæ€»é‡15544k used    ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡4178756k free    ç©ºé—²äº¤æ¢åŒºæ€»é‡1318852k cached    ç¼“å­˜çš„äº¤æ¢åŒºæ€»é‡ï¼Œå³å¯ç”¨äº¤æ¢åŒºå†…å­˜</code></pre></div><p>å½“ç„¶ï¼Œä¹Ÿæ¨èä½¿ç”¨å…¶ä»–è¿è¡Œåˆ†æå¯è§†åŒ–å·¥å…·ï¼Œå¦‚htopï¼ŒåŠŸèƒ½ç›¸æ¯”topæ›´ä¸ºå¼ºå¤§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windowsä¸‹çš„elasticsearchå°è¯•</title>
    <link href="/2019/04/10/183/"/>
    <url>/2019/04/10/183/</url>
    
    <content type="html"><![CDATA[<p>ç¯å¢ƒï¼šwindows7 64ä½</p><p>ElasticSearchï¼ˆåé¢ç®€ç§°esï¼‰åŸºäºjavaï¼Œæ‰€ä»¥åŠ¡å¿…å…ˆå®‰è£…javaï¼Œjavaå®‰è£…çœç•¥ï¼Œå»ºè®®å®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆã€‚</p><h2 id="å®‰è£…es"><a href="#å®‰è£…es" class="headerlink" title="å®‰è£…es"></a>å®‰è£…es</h2><p><a href="https://www.elastic.co/downloads/elasticsearch">esä¸‹è½½</a></p><p>è§£å‹åè¿›å…¥ç›®å½•ï¼Œå¯åŠ¨bin/elasticsearch.bat</p><p>è®¿é—®ï¼š</p><blockquote><p><a href="http://localhost:9200/">http://localhost:9200/</a></p></blockquote><p>å¯ä»¥çœ‹åˆ°ä¸€äº›ä¿¡æ¯ï¼Œç‰ˆæœ¬ç­‰ï¼Œå°±è¡¨æ˜å·²ç»å®‰è£…ç—…å¯åŠ¨æˆåŠŸï¼</p><h3 id="å®‰è£…HEADæ’ä»¶"><a href="#å®‰è£…HEADæ’ä»¶" class="headerlink" title="å®‰è£…HEADæ’ä»¶"></a>å®‰è£…HEADæ’ä»¶</h3><blockquote><p>git clone git://github.com/mobz/elasticsearch-head.git<br>cd elasticsearch-head<br>npm install<br>npm run start</p></blockquote><p>æµè§ˆå™¨æ‰“å¼€ï¼Œ <a href="http://localhost:9100/%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%88%9A%E5%BC%80%E5%90%AF%E5%8A%A8%E7%9A%84ES%E5%AE%9E%E4%BE%8B%E3%80%82">http://localhost:9100/ï¼Œå¯ä»¥çœ‹åˆ°åˆšå¼€å¯åŠ¨çš„ESå®ä¾‹ã€‚</a></p><h3 id="ä¼ªé›†ç¾¤"><a href="#ä¼ªé›†ç¾¤" class="headerlink" title="ä¼ªé›†ç¾¤"></a>ä¼ªé›†ç¾¤</h3><p>æ‰“å¼€configä¸‹å¾—elasticsearch.yml</p><p>åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># è‡ªå®šä¹‰é…ç½®</span><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">sai_es</span><span class="hljs-attr">node.name:</span> <span class="hljs-string">es0</span><span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span><span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span></code></pre></div><p>å¤åˆ¶esæ–‡ä»¶å¤¹åˆ°es1,es2,ä¿®æ”¹é…ç½®:</p><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">es1:</span><span class="hljs-comment"># è‡ªå®šä¹‰é…ç½®</span><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">sai_es</span><span class="hljs-attr">node.name:</span> <span class="hljs-string">es1</span><span class="hljs-attr">node.master:</span> <span class="hljs-literal">false</span><span class="hljs-attr">http.port:</span> <span class="hljs-number">9201</span><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> [<span class="hljs-string">&quot;127.0.0.1&quot;</span>]<span class="hljs-attr">es2:</span><span class="hljs-comment"># è‡ªå®šä¹‰é…ç½®</span><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">sai_es</span><span class="hljs-attr">node.name:</span> <span class="hljs-string">es2</span><span class="hljs-attr">node.master:</span> <span class="hljs-literal">false</span><span class="hljs-attr">http.port:</span> <span class="hljs-number">9202</span><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> [<span class="hljs-string">&quot;127.0.0.1&quot;</span>]</code></pre></div><p>æ³¨æ„ï¼Œæ­¤æ—¶è¦ä¿è¯es1ï¼Œes2ä¸‹é¢dataç›®å½•ä¸ºç©ºï¼Œå¦åˆ™å¯åŠ¨æ—¶ä¼šå› ä¸ºå†²çªidè¿æ¥ä¸ä¸Šes0ã€‚</p><p>ç„¶åå¯åŠ¨es1ï¼Œes2ï¼Œé€šè¿‡headæ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é›†ç¾¤æ­å»ºå®Œæˆï¼sai_esé›†ç¾¤ä¸‹æœ‰3ä¸ªå®ä¾‹ï¼šes0ï¼Œes1ï¼Œes2ã€‚</p><p>é›†ç¾¤æ­å»ºæˆåŠŸï¼</p>]]></content>
    
    
    <categories>
      
      <category>ElasticSearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisé›†ç¾¤é…ç½®</title>
    <link href="/2019/03/29/182/"/>
    <url>/2019/03/29/182/</url>
    
    <content type="html"><![CDATA[<h3 id="Redis-Cluster-æ˜¯ä»€ä¹ˆ"><a href="#Redis-Cluster-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Redis Cluster æ˜¯ä»€ä¹ˆ"></a>Redis Cluster æ˜¯ä»€ä¹ˆ</h3><p>Redis Cluster æ˜¯ Redis çš„åˆ†å¸ƒå¼å®ç°ï¼Œå®˜ç½‘è¯´æ˜ä¸­é˜è¿°äº†ä»¥ä¸‹å‡ ç‚¹ç›®æ ‡ï¼š</p><ul><li>é«˜æ€§èƒ½å’Œçº¿æ€§å¯æ‰©å±•æ€§é«˜è¾¾ 1000 ä¸ªèŠ‚ç‚¹ã€‚æ²¡æœ‰ä»£ç†ï¼Œä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œä¸å¯¹å€¼æ‰§è¡Œåˆå¹¶æ“ä½œã€‚</li><li>å¯æ¥å—çš„å†™å…¥å®‰å…¨ç¨‹åº¦ï¼šç³»ç»Ÿå°è¯•ï¼ˆä»¥æœ€å¤§åŠªåŠ›çš„æ–¹å¼ï¼‰ä¿ç•™æ‰€æœ‰æ¥è‡ªä¸å¤§å¤šæ•°ä¸»èŠ‚ç‚¹è¿æ¥çš„å®¢æˆ·ç«¯çš„å†™å…¥ã€‚é€šå¸¸æœ‰ä¸€äº›å°çª—å£ï¼Œå…¶ä¸­ç¡®è®¤çš„å†™å…¥å¯èƒ½ä¼šä¸¢å¤±ã€‚å½“å®¢æˆ·ç«¯ä½äºå°‘æ•°åˆ†åŒºä¸­æ—¶ï¼Œä¸¢å¤±å·²ç¡®è®¤å†™å…¥çš„çª—å£æ›´å¤§ã€‚</li><li>å¯ç”¨æ€§ï¼šRedis é›†ç¾¤èƒ½å¤Ÿåœ¨å¤§å¤šæ•°ä¸»èŠ‚ç‚¹å¯è®¿é—®çš„åˆ†åŒºä¸­å­˜æ´»ä¸‹æ¥ï¼Œå¹¶ä¸”æ¯ä¸ªä¸å†å¯è®¿é—®çš„ä¸»èŠ‚ç‚¹è‡³å°‘æœ‰ä¸€ä¸ªå¯è®¿é—®</li></ul><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><blockquote><p>centos7.5ï¼ŒRedis5.0.0</p></blockquote><p>Redis ä¸‹è½½åå®‰è£…åœ¨åˆé€‚çš„ç›®å½•ï¼Œæˆ‘æ˜¯å®‰è£…åœ¨/usr/local/Redis-5.0.0ä¸‹ï¼Œè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚ã€å®˜ç½‘æåŠ3.0ä¹‹åçš„ç‰ˆæœ¬å³å¯æ”¯æŒé›†ç¾¤æ“ä½œã€‘</p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åŒçº§ä¸‹æ–°å»ºclusteræ–‡ä»¶å¤¹ï¼Œæ‹·è´ redis.conf æ–‡ä»¶è¿›æ¥ï¼Œcopy 4ä¸ªæ–‡ä»¶Redis_2001.confã€Redis_2002.confã€Redis_2003.confã€Redis_2004.confï¼Œä¿®æ”¹å¯¹åº”é…ç½®ï¼Œä¸»è¦æ˜¯ç«¯å£ï¼ŒèŠ‚ç‚¹é…ç½® rdb aof ç­‰ã€‚</p><p>å¯å‚è€ƒé…ç½®å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs vala"><span class="hljs-meta"># ç«¯å£å·</span>port <span class="hljs-number">2001</span><span class="hljs-meta"># åå°å¯åŠ¨</span>daemonize yes<span class="hljs-meta"># å¼€å¯é›†ç¾¤</span>cluster-enabled yes<span class="hljs-meta"># é›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶</span>cluster-config-file nodes<span class="hljs-number">-2001.</span>conf<span class="hljs-meta"># è¿›ç¨‹pidçš„æ–‡ä»¶ä½ç½®</span>pidfile /<span class="hljs-keyword">var</span>/run/Redis<span class="hljs-number">-2001.</span>pid<span class="hljs-meta"># æŒä¹…åŒ–é…ç½®</span><span class="hljs-meta"># å¼€å¯aof</span>appendonly yes<span class="hljs-meta"># aofæ–‡ä»¶è·¯å¾„</span>appendfilename <span class="hljs-string">&quot;appendonly-2001.aof&quot;</span><span class="hljs-meta"># rdbæ–‡ä»¶è·¯å¾„</span>dbfilename dump<span class="hljs-number">-2001.</span>rdb</code></pre></div><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>æ ¹æ®ä¸Šè¿°é…ç½®æ–‡ä»¶ä¾æ¬¡å¯åŠ¨Redisè¿›ç¨‹</p><div class="code-wrapper"><pre><code class="hljs pgsql">redis-<span class="hljs-keyword">server</span> <span class="hljs-keyword">cluster</span>/Redis<span class="hljs-number">-2001.</span>confredis-<span class="hljs-keyword">server</span> <span class="hljs-keyword">cluster</span>/Redis<span class="hljs-number">-2002.</span>confredis-<span class="hljs-keyword">server</span> <span class="hljs-keyword">cluster</span>/Redis<span class="hljs-number">-2003.</span>confredis-<span class="hljs-keyword">server</span> <span class="hljs-keyword">cluster</span>/Redis<span class="hljs-number">-2004.</span>conf</code></pre></div><p>å¯åŠ¨å®Œæˆåï¼Œç…§ç€æŸä¸ªæ–‡ç« è¯´æ˜è¿æ¥æ„å»ºRedisé›†ç¾¤:</p><blockquote><p>./Redis-trib.rb create â€“replicas 1 127.0.0.1:2001 127.0.0.1:2002 127.0.0.1:2003 127.0.0.1:2004</p></blockquote><p>æŠ›å‡ºè­¦å‘Šï¼š</p><blockquote><p>WARNING: Redis-trib.rb is not longer available!</p></blockquote><p>æŸ¥çœ‹æ–‡æ¡£å‘ç°ï¼šRedisÂ 5.0å½»åº•æŠ›å¼ƒäº†rubyã€ä¼˜å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¼˜å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¼˜å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ã€‘</p><p>You should use redis-cli instead.</p><p>è¡Œï¼Œæ¢redis-cliï¼š</p><blockquote><p>redis-cli â€“cluster create 127.0.0.1:2001 127.0.0.1:2002 127.0.0.1:2003 127.0.0.1:2004 â€“cluster-replicas 1</p></blockquote><p>åˆæœ‰é”™è¯¯ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs xquery">*** ERROR: Invalid configuration <span class="hljs-keyword">for</span> cluster creation.*** Redis Cluster requires <span class="hljs-keyword">at</span> <span class="hljs-keyword">least</span> <span class="hljs-number">3</span> master nodes.*** This <span class="hljs-literal">is</span><span class="hljs-built_in"> not</span> possible with <span class="hljs-number">4</span> nodes <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> replicas per <span class="hljs-type">node</span>.*** At <span class="hljs-keyword">least</span> <span class="hljs-number">6</span> nodes are required.</code></pre></div><p>å› ä¸ºæ˜¯å•æœºæµ‹è¯•è€Œå·²ï¼Œå»æ‰å¤åˆ¶ï¼Œè‡³å°‘6ä¸ªèŠ‚ç‚¹ æˆ‘ä»¬å…ˆå¿½ç•¥ã€‚</p><blockquote><p>Redis-cli â€“cluster create 127.0.0.1:2001 127.0.0.1:2002 127.0.0.1:2003 127.0.0.1:2004</p></blockquote><p>ç„¶åæœ‰ä¸ªä¿å­˜é…ç½®çš„ç¡®è®¤ï¼Œyesä¹‹åå¯åŠ¨æˆåŠŸï¼</p><div class="code-wrapper"><pre><code class="hljs prolog">[<span class="hljs-symbol">OK</span>] <span class="hljs-symbol">All</span> nodes agree about slots configuration.&gt;&gt;&gt; <span class="hljs-symbol">Check</span> for open slots...&gt;&gt;&gt; <span class="hljs-symbol">Check</span> slots coverage...[<span class="hljs-symbol">OK</span>] <span class="hljs-symbol">All</span> <span class="hljs-number">16384</span> slots covered.</code></pre></div><p>è¿›å…¥å®¢æˆ·ç«¯</p><blockquote><p>redis-cli -p 2001</p></blockquote><p>æŸ¥çœ‹èŠ‚ç‚¹:</p><blockquote><p>cluster nodes</p></blockquote><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">90a734c7716a00060584acb82cb3dd7e437a5459</span> <span class="hljs-number">127.0.0.1:2003</span>@<span class="hljs-number">12003</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1541042930063</span> <span class="hljs-number">3</span> connected <span class="hljs-number">8192</span>-<span class="hljs-number">12287</span><span class="hljs-attribute">7ac1fab72c275ba9549a9da71245fdd29a3920a6</span> <span class="hljs-number">127.0.0.1:2002</span>@<span class="hljs-number">12002</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1541042930563</span> <span class="hljs-number">2</span> connected <span class="hljs-number">4096</span>-<span class="hljs-number">8191</span><span class="hljs-attribute">490035c372472798a224b6d00c249d8b41508b78</span> <span class="hljs-number">127.0.0.1:2001</span>@<span class="hljs-number">12001</span> myself,master - <span class="hljs-number">0</span> <span class="hljs-number">1541042928000</span> <span class="hljs-number">1</span> connected <span class="hljs-number">0</span>-<span class="hljs-number">4095</span><span class="hljs-attribute">9101d285b991c6dcb086cf3da4cd0eae7777ece0</span> <span class="hljs-number">127.0.0.1:2004</span>@<span class="hljs-number">12004</span> master - <span class="hljs-number">0</span> <span class="hljs-number">1541042929563</span> <span class="hljs-number">4</span> connected <span class="hljs-number">12288</span>-<span class="hljs-number">16383</span></code></pre></div><p>å¯ä»¥çœ‹å‡ºé›†ç¾¤å·²æ­å»ºæˆåŠŸï¼ä½ å¯ä»¥è¿›è¡Œæµ‹è¯•äº†ã€‚</p><blockquote><p>å½“ç„¶éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™åªæ˜¯æˆ‘ä»¬è‡ªå·±æµ‹è¯•ç”¨ï¼Œäº§çº¿ä¸Šè¿˜æ˜¯éœ€è¦å¼€å¯å¤åˆ¶ï¼Œä¸”æŒ‰éœ€é…ç½®èŠ‚ç‚¹ï¼Œè‡³å°‘ 6 ä¸ªï¼Œä¸ç„¶å«å•¥é«˜å¯ç”¨ï¼Œè¿˜ä¸å¦‚å•æœºä½¿ç”¨ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpå°è¯•rabbitmq</title>
    <link href="/2019/03/29/181/"/>
    <url>/2019/03/29/181/</url>
    
    <content type="html"><![CDATA[<blockquote><p>RabbitMQ is lightweight and easy to deploy on premises and in the cloud. It supports multiple messaging protocols. RabbitMQ can be deployed in distributed and federated configurations to meet high-scale, high-availability requirements.</p></blockquote><h3 id="1-å®‰è£…ï¼š"><a href="#1-å®‰è£…ï¼š" class="headerlink" title="1. å®‰è£…ï¼š"></a>1. å®‰è£…ï¼š</h3><p>windowså®‰è£…ååˆ†ç®€å•ï¼Œå°è±¡ä¸­è£…çš„è¿‡ç¨‹å‡ ä¹æ— éšœç¢ï¼Œå¿½ç•¥ã€‚</p><p>centos7å®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>ä¾èµ–å®‰è£…</p><blockquote><p>yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel unixODBC-devel socat</p></blockquote><p>å®‰è£…erlangï¼ŒåŠ¡å¿…åœ¨ä¸‹é¢çš„åœ°å€ä¸‹è½½ï¼Œä¹‹å‰åœ¨å®˜ç½‘ä¸‹è½½ï¼Œå®‰è£…æ€»æ˜¯æœ‰é—®é¢˜ï¼Œæµªè´¹äº†å¤§æŠŠæ—¶é—´ã€‚</p><div class="code-wrapper"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>dl.bintray.com<span class="hljs-regexp">/rabbitmq/</span>rpm<span class="hljs-regexp">/erlang/</span><span class="hljs-number">20</span><span class="hljs-regexp">/el/</span><span class="hljs-number">7</span>/</code></pre></div><p>å®˜ç½‘ä¸‹è½½rabiitmqï¼Œrpmå®‰è£…</p><blockquote><p>rpm -ivh (rpmåŒ…)</p></blockquote><h3 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2. é…ç½®"></a>2. é…ç½®</h3><p>å¯åŠ¨rabbitmq</p><blockquote><p>/bin/systemctl start rabbitmq-server.service</p></blockquote><p>ç‰‡åˆ»ä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹çŠ¶æ€æ˜¯å¦active</p><blockquote><p>bin/systemctl status rabbitmq-server.service</p></blockquote><blockquote><p>cp rabbitmq.config.example /etc/rabbitmq/<br>cd /etc/rabbitmq/<br>mv rabbitmq.config.example rabbitmq.config</p></blockquote><p>ä¿®æ”¹æˆä½ æƒ³è¦çš„é…ç½®ï¼Œç„¶åé‡å¯ã€‚</p><h3 id="3-UI"><a href="#3-UI" class="headerlink" title="3. UI"></a>3. UI</h3><p>å¯åŠ¨</p><blockquote><p>rabbitmq-plugins enable rabbitmq_management</p></blockquote><p>ç„¶åæ ¹æ®é…ç½®æ‰“å¼€ç•Œé¢</p><p>å®‰å…¨æ€§é—®é¢˜ï¼Œå¯ä»¥ç¦æ­¢å¤–éƒ¨guestè®¿é—®ï¼Œæ–°å»ºè´¦æˆ·</p><blockquote><p>rabbitmqctl add_user 13sai 12345678<br>rabbitmqctl set_user_tags 13sai administrator</p></blockquote><p>å¹¶ä¿®æ”¹é…ç½®ï¼š</p><blockquote><p>{loopback_users, [&lt;&lt;â€guestâ€&gt;&gt;]}</p></blockquote><p>é‡å¯rabbitmqæœåŠ¡ã€‚</p><h3 id="4-ç®€å•å®ä¾‹"><a href="#4-ç®€å•å®ä¾‹" class="headerlink" title="4. ç®€å•å®ä¾‹"></a>4. ç®€å•å®ä¾‹</h3><p>ç”Ÿäº§è€…ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Created by PhpStorm.</span><span class="hljs-comment"> * User: 13sai</span><span class="hljs-comment"> * Date: 2018/11/5</span><span class="hljs-comment"> * Time: 10:39</span><span class="hljs-comment"> */</span><span class="hljs-comment">// é…ç½®ä¿¡æ¯</span><span class="hljs-variable">$config</span> = [    host =&gt; localhost,    port =&gt; <span class="hljs-number">5672</span>,    login =&gt; sai,    password =&gt; <span class="hljs-number">123456</span>,    vhost=&gt;/];<span class="hljs-variable">$exName</span> = changes; <span class="hljs-comment">//äº¤æ¢æœºå</span><span class="hljs-variable">$route</span> = key; <span class="hljs-comment">//è·¯ç”±key</span><span class="hljs-comment">// åˆ›å»ºè¿æ¥å’Œchannel</span><span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> AMQPConnection(<span class="hljs-variable">$config</span>);<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$conn</span>-&gt;connect()) &#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿æ¥å¤±è´¥&quot;</span>);&#125;<span class="hljs-variable">$channel</span> = <span class="hljs-keyword">new</span> AMQPChannel(<span class="hljs-variable">$conn</span>);<span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span><span class="hljs-variable">$message</span> = <span class="hljs-string">&quot;æ¶ˆæ¯æµ‹è¯•&quot;</span>;<span class="hljs-comment">//åˆ›å»ºäº¤æ¢æœº</span><span class="hljs-variable">$ex</span> = <span class="hljs-keyword">new</span> AMQPExchange(<span class="hljs-variable">$channel</span>);<span class="hljs-variable">$ex</span>-&gt;setName(<span class="hljs-variable">$exName</span>);<span class="hljs-comment">//å‘é€æ¶ˆæ¯ï¼Œæ³¨æ„æŒä¹…åŒ–ä¹Ÿè¦è®¾ç½®[delivery_mode =&gt; AMQP_DURABLE]</span><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;<span class="hljs-number">5</span>; <span class="hljs-variable">$i</span>++)&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Send Message:&quot;</span>.<span class="hljs-variable">$ex</span>-&gt;publish(<span class="hljs-variable">$i</span>.:.<span class="hljs-variable">$message</span>, <span class="hljs-variable">$route</span>, AMQP_DURABLE, [delivery_mode =&gt; AMQP_DURABLE]).<span class="hljs-string">&quot;</span><span class="hljs-string">&quot;</span>;&#125;<span class="hljs-variable">$conn</span>-&gt;disconnect();</code></pre></div><p>æ¶ˆè´¹è€…ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Created by PhpStorm.</span><span class="hljs-comment"> * User: 13sai</span><span class="hljs-comment"> * Date: 2018/11/5</span><span class="hljs-comment"> * Time: 10:39</span><span class="hljs-comment"> */</span><span class="hljs-variable">$config</span> = [    host =&gt; localhost,    port =&gt; <span class="hljs-number">5672</span>,    login =&gt; sai,    password =&gt; <span class="hljs-number">123456</span>,    vhost=&gt;/];<span class="hljs-variable">$exName</span> = changes; <span class="hljs-comment">//äº¤æ¢æœºå</span><span class="hljs-variable">$queueMame</span> = queue1; <span class="hljs-comment">//é˜Ÿåˆ—å</span><span class="hljs-variable">$route</span> = key; <span class="hljs-comment">//è·¯ç”±key</span><span class="hljs-comment">// åˆ›å»ºè¿æ¥å’Œchannel</span><span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> AMQPConnection(<span class="hljs-variable">$config</span>);<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$conn</span>-&gt;connect()) &#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿æ¥å¤±è´¥&quot;</span>);&#125;<span class="hljs-variable">$channel</span> = <span class="hljs-keyword">new</span> AMQPChannel(<span class="hljs-variable">$conn</span>);<span class="hljs-comment">// åˆ›å»ºäº¤æ¢æœº</span><span class="hljs-variable">$ex</span> = <span class="hljs-keyword">new</span> AMQPExchange(<span class="hljs-variable">$channel</span>);<span class="hljs-variable">$ex</span>-&gt;setName(<span class="hljs-variable">$exName</span>);<span class="hljs-variable">$ex</span>-&gt;setType(AMQP_EX_TYPE_DIRECT); <span class="hljs-comment">//directç±»å‹</span><span class="hljs-variable">$ex</span>-&gt;setFlags(AMQP_DURABLE); <span class="hljs-comment">//æŒä¹…åŒ–ï¼Œå¾ˆé‡è¦</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Exchange Status:&quot;</span>.<span class="hljs-variable">$ex</span>-&gt;declare().<span class="hljs-string">&quot;</span><span class="hljs-string">&quot;</span>;<span class="hljs-comment">// åˆ›å»ºé˜Ÿåˆ—</span><span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> AMQPQueue(<span class="hljs-variable">$channel</span>);<span class="hljs-variable">$queue</span>-&gt;setName(<span class="hljs-variable">$queueMame</span>);<span class="hljs-variable">$queue</span>-&gt;setFlags(AMQP_DURABLE); <span class="hljs-comment">//æŒä¹…åŒ–</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Message Total:&quot;</span>.<span class="hljs-variable">$queue</span>-&gt;declare().<span class="hljs-string">&quot;</span><span class="hljs-string">&quot;</span>;<span class="hljs-comment">//ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—ï¼Œå¹¶æŒ‡å®šè·¯ç”±é”®</span><span class="hljs-keyword">echo</span> Queue Bind: .<span class="hljs-variable">$queue</span>-&gt;bind(<span class="hljs-variable">$exName</span>, <span class="hljs-variable">$route</span>).<span class="hljs-string">&quot;</span><span class="hljs-string">&quot;</span>;<span class="hljs-comment">//é˜»å¡æ¨¡å¼æ¥æ”¶æ¶ˆæ¯</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Message:</span><span class="hljs-string">&quot;</span>;<span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>)&#123;    <span class="hljs-variable">$queue</span>-&gt;consume(processMessage);&#125;<span class="hljs-variable">$conn</span>-&gt;disconnect();<span class="hljs-comment">/**</span><span class="hljs-comment"> * æ¶ˆè´¹å›è°ƒå‡½æ•°</span><span class="hljs-comment"> * å¤„ç†æ¶ˆæ¯</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processMessage</span>(<span class="hljs-params"><span class="hljs-variable">$envelope</span>, <span class="hljs-variable">$queue</span></span>) </span>&#123;    <span class="hljs-variable">$msg</span> = <span class="hljs-variable">$envelope</span>-&gt;getBody();    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$msg</span>.<span class="hljs-string">&quot;</span><span class="hljs-string">&quot;</span>; <span class="hljs-comment">//å¤„ç†æ¶ˆæ¯</span>    <span class="hljs-variable">$queue</span>-&gt;ack(<span class="hljs-variable">$envelope</span>-&gt;getDeliveryTag()); <span class="hljs-comment">//æ‰‹åŠ¨å‘é€ACKåº”ç­”</span>&#125;</code></pre></div><p>èŠ±äº†äº›æ—¶é—´ï¼Œä¸è¿‡å¼„å‡ºæ¥è¿˜æ˜¯æ„Ÿè§‰ä¸é”™çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RabbitMQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LNMPè®¾ç½®å¼€æœºè‡ªå¯åŠ¨</title>
    <link href="/2019/03/29/180/"/>
    <url>/2019/03/29/180/</url>
    
    <content type="html"><![CDATA[<p>æœåŠ¡å™¨é‡å¯åï¼Œä¸€æ­¥æ­¥å¯åŠ¨å„ç§ç¨‹åºæ˜¯ä¸ªéå¸¸éº»çƒ¦ä¹Ÿæ˜¯å®¹æ˜“å‡ºé”™çš„äº‹æƒ…ï¼Œé‡åˆ°è¿‡ä¸æ­¢ä¸€æ¬¡ï¼Œæœ‰æŸä¸ªæœåŠ¡å¿˜è®°èµ·æ¥çš„æƒ…å†µï¼Œå¿…é¡»å¾—å½»åº•è§£å†³è¿™ç§é—®é¢˜ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥å°è¯•é…ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚</p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>centos 7.5</p><p>æˆ‘çš„ç‰ˆæœ¬è·Ÿä½ç‰ˆæœ¬æœ‰å¾ˆå¤šä¸åŒï¼Œä¸èƒ½é€šè¿‡chkconfig addå‘½ä»¤åŠ å…¥è‡ªå¯åŠ¨ï¼Œæˆ‘ä»¬å…ˆè¿›å…¥ç›®å½•</p><blockquote><p>/lib/systemd/system</p></blockquote><p>ä¾æ¬¡æ–°å»ºè‹¥å¹²ä¸ªæœåŠ¡ï¼š</p><ul><li>mysqld.service</li></ul><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><span class="hljs-attr">Description</span>=mysql<span class="hljs-attr">After</span>=network.target<span class="hljs-section">[Service]</span><span class="hljs-attr">Type</span>=forking<span class="hljs-attr">ExecStart</span>=/usr/bin/mysql.server<span class="hljs-attr">ExecReload</span>=/bin/systemctl restart mysqld.service<span class="hljs-attr">ExecStop</span>=/bin/systemctl stop mysqld.service<span class="hljs-attr">PrivateTmp</span>=<span class="hljs-literal">true</span><span class="hljs-section">[Install]</span><span class="hljs-attr">WantedBy</span>=multi-user.target</code></pre></div><ul><li>nginx.service<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><span class="hljs-attr">Description</span>=nginx<span class="hljs-attr">After</span>=network.target<span class="hljs-section">[Service]</span><span class="hljs-attr">Type</span>=forking<span class="hljs-attr">ExecStart</span>=/usr/bin/nginx<span class="hljs-attr">ExecReload</span>=/usr/bin/nginx -s reload<span class="hljs-attr">ExecStop</span>=/usr/bin/nginx -s quit<span class="hljs-attr">PrivateTmp</span>=<span class="hljs-literal">true</span><span class="hljs-section">[Install]</span><span class="hljs-attr">WantedBy</span>=multi-user.target</code></pre></div></li><li> php-fpm.service<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><span class="hljs-attr">Description</span>=php-fpm<span class="hljs-attr">After</span>=network.target<span class="hljs-section">[Service]</span><span class="hljs-attr">Type</span>=forking<span class="hljs-attr">ExecStart</span>=/usr/bin/php-fpm<span class="hljs-attr">ExecReload</span>=ps -ef|grep php-fpm|awk -F   &#123;print &#125;|xargs kill -USR2<span class="hljs-attr">ExecStop</span>=ps -ef|grep php-fpm|awk -F   &#123;print &#125;|xargs kill -INT<span class="hljs-attr">PrivateTmp</span>=<span class="hljs-literal">true</span><span class="hljs-section">[Install]</span><span class="hljs-attr">WantedBy</span>=multi-user.target</code></pre></div></li><li>Redis.service<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><span class="hljs-attr">Description</span>=Redis<span class="hljs-attr">After</span>=network.target<span class="hljs-section">[Service]</span><span class="hljs-attr">Type</span>=forking<span class="hljs-attr">ExecStart</span>=/usr/bin/Redis-server /usr/local/Redis-<span class="hljs-number">5.0</span>.<span class="hljs-number">0</span>/Redis.conf<span class="hljs-attr">ExecStop</span>=/usr/local/Redis-<span class="hljs-number">5.0</span>.<span class="hljs-number">0</span>/Redis-cli shutdown<span class="hljs-attr">PrivateTmp</span>=<span class="hljs-literal">true</span><span class="hljs-section">[Install]</span><span class="hljs-attr">WantedBy</span>=multi-user.target</code></pre></div></li></ul><blockquote><p>ExecStart, ExecStop, ExecReloadå„æœ‰ä¸åŒï¼Œå¯æ ¹æ®ä¸šåŠ¡è‡ªè¡Œä¿®æ”¹</p></blockquote><p>å¹¶ä¸”æŠŠå°šéœ€å‡ ä¸ªæœåŠ¡ systemctl enable å¯åŠ¨ã€‚</p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å®Œæˆåæˆ‘ä»¬é‡å¯æœºå™¨ï¼š</p><blockquote><p>reboot</p></blockquote><p>æµ‹è¯•ä¸€ä¸‹ã€åˆ«å†ç”Ÿäº§éšæ„rebootå“Ÿã€‘ï¼Œå‡ ä¸ªå®šä¹‰çš„æœåŠ¡éƒ½é™†ç»­å¯åŠ¨æˆåŠŸã€‚</p><h3 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h3><p>ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰éƒ¨åˆ†</p><ul><li>[unit] :å®šä¹‰ä¸Unitç±»å‹æ— å…³çš„é€šç”¨é€‰é¡¹ï¼›ç”¨äºæä¾›unitçš„æè¿°ä¿¡æ¯ã€ unitè¡Œä¸ºåŠä¾èµ–å…³ç³»ç­‰</li><li>[Service]ï¼šä¸ç‰¹å®šç±»å‹ç›¸å…³çš„ä¸“ç”¨é€‰é¡¹ï¼›æ­¤å¤„ä¸ºServiceç±»å‹</li><li>[Install]ï¼šå®šä¹‰ç”±â€œ systemctl enableâ€ä»¥åŠâ€systemctl disableâ€œå‘½ä»¤åœ¨å®ç°æœåŠ¡å¯ç”¨æˆ–ç¦ç”¨æ—¶ç”¨åˆ°çš„ä¸€äº›é€‰é¡¹</li></ul><p>Serviceå‚æ•°ï¼š</p><ul><li>EnvironmentFileï¼šç¯å¢ƒé…ç½®æ–‡ä»¶</li><li>ExecStartï¼šæŒ‡æ˜å¯åŠ¨unitè¦è¿è¡Œå‘½ä»¤æˆ–è„šæœ¬çš„ç»å¯¹è·¯å¾„</li><li>ExecStartPreï¼š ExecStartå‰è¿è¡Œ</li><li>ExecStartPostï¼š ExecStartåè¿è¡Œ</li><li>ExecRsload: é‡å¯å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤</li><li>ExecStopPostï¼šåœæ­¢å½“å‰æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤</li><li>ExecStartSecï¼šè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡é—´éš”çš„ç§’æ•°</li><li>ExecStopï¼šæŒ‡æ˜åœæ­¢unitè¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</li><li>Restartï¼šå½“è®¾å®šRestart=1æ—¶ï¼Œåˆ™å½“æ¬¡daemonæœåŠ¡æ„å¤–ç»ˆæ­¢åï¼Œä¼šå†æ¬¡è‡ªåŠ¨å¯åŠ¨æ­¤æœåŠ¡ã€‚</li><li>TimeoutSecï¼šå®šä¹‰ Systemd åœæ­¢å½“å‰æœåŠ¡ä¹‹å‰ç­‰å¾…çš„ç§’æ•°ã€‚</li><li>Environmentï¼šæŒ‡å®šç¯å¢ƒå˜é‡ã€‚</li></ul><p>Installå‚æ•°ï¼š</p><ul><li>Aliasï¼šåˆ«åï¼Œå¯ä½¿ç”¨systemctl command Alias.service</li><li>RequiredByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼ºä¾èµ–</li><li>WantedByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼±ä¾èµ–</li><li>Alsoï¼šå®‰è£…æœ¬æœåŠ¡çš„æ—¶å€™è¿˜è¦å®‰è£…åˆ«çš„ç›¸å…³æœåŠ¡</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.jianshu.com/p/92208194d700">åœ¨linuxä¸‹åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡</a></li><li><a href="http://blog.51cto.com/gavin0/2156626">linuxä¸­çš„unitçš„é…ç½®æ–‡ä»¶</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•æ¢å¤è¯¯åˆ çš„æ•°æ®åº“</title>
    <link href="/2019/01/11/176/"/>
    <url>/2019/01/11/176/</url>
    
    <content type="html"><![CDATA[<p> å‰æ®µæ—¶é—´ï¼ŒæŸå¼€å‘äººå‘˜è¯¯åˆ äº†ä¸€ä¸ªæ•°æ®åº“ï¼Œå¯¼è‡´æˆ‘ä»¬çš„æœåŠ¡ï¼Œæœ€åæ˜¯æ¢å¤äº†ï¼Œè¿‡ç¨‹æˆ‘å¹¶ä¸æ¸…æ¥šï¼Œä½†å¼•èµ·äº†æˆ‘çš„å…´è¶£ã€‚å› ä¸ºè¯¯æ“ä½œçœŸçš„æ˜¯å¾ˆéš¾é¿å…çš„ï¼Œå¼€å‘äººå‘˜é‚£ä¹ˆå¤šï¼Œä¸€ä¸ªä¸å°å¿ƒï¼Œå°±å¯èƒ½å½±å“äº†å…¶ä»–äººçš„ä½¿ç”¨ï¼Œæ‰€ä»¥æ…é‡æ“ä½œï¼Œæœ€å¥½èƒ½ç¦ç”¨ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚dropï¼</p><p>é‚£ä¹ˆå¦‚ä½•æ¥æ¢å¤å‘¢ï¼Ÿ</p><p>å¦‚æœæœ‰å¤‡ä»½çš„è¯ï¼Œå½“ç„¶å»å¯»æ‰¾æœ€æ–°çš„ï¼Œç„¶åæ¢å¤ï¼Œå¦‚æœä¸åœ¨æ„æ–°å¢çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™æ ·å°±è¶³å¤Ÿäº†ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹å¤‡ä»½ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">// å¤‡ä»½æŸä¸ªæ•°æ®åº“æŸäº›è¡¨</span>mysqldump [options] db_name [tbl_name ...] &gt; bak.sql<span class="hljs-comment">// å¤‡ä»½å¤šä¸ªæ•°æ®åº“</span>mysqldump [options] --databases db_name ...&gt; bak.sql<span class="hljs-comment">// å¤‡ä»½æ‰€æœ‰æ•°æ®åº“</span>mysqldump [options] --all-databases&gt; bak.sql</code></pre></div><p>ä¸ªäººå»ºè®®å•ä¸ªå¤‡ä»½ï¼Œå¥½ç‹¬ç«‹æ“ä½œã€‚</p><p>äº†è§£æ›´å¤šè¯·çœ‹ï¼š<br><a href="https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html">mysqldump</a></p><p>æ¢å¤æ“ä½œï¼ˆä»¥å•ä¸ªæ•°æ®åº“ä¸ºä¾‹ï¼‰</p><blockquote><p>mysql -h127.0.0.1 -uroot -p del &lt; bak.sql</p></blockquote><p>æ“ä½œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ</p><p>é‚£ä¹ˆå¦‚æœæ²¡æœ‰å¤‡ä»½æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ç¬¬äºŒç§æ“ä½œå‰ææ˜¯å¼€å¯äº†binlogï¼Œé€šè¿‡logæ¢å¤ã€‚</p><p>è¯¯åˆ åå¯ä»¥ä¿å­˜ä¸‹binlog</p><blockquote><p>mysqlbinlog mysql-bin.000011 &gt; del.log</p></blockquote><p>æ‰“å¼€æ–‡ä»¶ï¼Œå»æ‰dropæ“ä½œå¹¶ä¿å­˜ã€‚</p><blockquote><p>mysql -h127.0.0.1 -uroot -p &lt;del.log</p></blockquote><p>å½“ç„¶ï¼Œæ¯”è¾ƒå»ºè®®é€šè¿‡dumpå…¨å¤‡ä»½æ“ä½œï¼Œç„¶åæ‰¾å‡ºå¤‡ä»½åˆ°dropçš„posã€‚</p><p>é€šè¿‡mysqlbinlog çš„start-positionå’Œstop-positionç”Ÿæˆsqlåæ¢å¤ã€‚è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p><p>æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹<a href="https://dev.mysql.com/doc/refman/5.7/en/mysqlbinlog.html">mysqlbinlog</a></p><p>å¥½äº†ï¼Œå°±è¯´åˆ°è¿™é‡Œï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>db</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLé«˜å¯ç”¨æ¢è®¨ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰</title>
    <link href="/2018/12/30/175/"/>
    <url>/2018/12/30/175/</url>
    
    <content type="html"><![CDATA[<p> ä¸Šä¸€ç¯‡æˆ‘ä»¬èŠåˆ°TPåšè¯»å†™åˆ†ç¦»çš„åº•å±‚å®ç°ï¼Œç›¸å¯¹æ¥è¯´ï¼Œå…¶å®æ€è·¯æ˜¯æ¸…æ™°ç®€å•çš„ï¼Œä½†è¿™äº›å…¶å®éƒ½æ˜¯åŸºäºæ•°æ®åº“å·²ç»åšåˆ°äº†ä¸»ä»é…ç½®ã€‚</p><p>å¦‚æœä½ ä¸çŸ¥é“ï¼Œå¯ä»¥<a href="https://github.com/13sai/saiNote/blob/master/sql/Mysql%E4%B8%BB%E4%BB%8E%E5%AE%9E%E6%88%98.md">mysqlä¸»ä»å®æˆ˜</a></p><p>å»ºè®®ç»™ä»åº“å•ç‹¬å¼€ä¸ªè´¦å·åªæˆæƒè¯»çš„æƒé™ï¼Œè€Œä¸æ˜¯è®¾ç½®slaveä¸ºread_onlyï¼ˆæˆ‘é…ç½®äº†ï¼Œbutæ²¡å•¥ç”¨ï¼‰</p><p>ä½†æˆ‘ä»¬ç¨å¾®æ·±å…¥æ€è€ƒä¸€ä¸‹ï¼ŒPHPæ¡†æ¶é‡Œæœ‰åšåˆ°é«˜å¯ç”¨å—ï¼ŸåŠ å…¥ä»åº“å…¶ä¸­ä¸€ä¸ªæŒ‚äº†ï¼Œç…§ç€TPçš„æ€è·¯ï¼Œä¾æ—§æœ‰å¯èƒ½å»è¿™ä¸ªä»åº“è¯»å–æ•°æ®ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸èƒ½æ¥å—çš„ã€‚</p><p>ä¸€ä¸»ä¸€ä»ç”šè‡³ä¸€ä¸»å¤šä»çš„æ¶æ„æ˜¾ç„¶åªèƒ½æ»¡è¶³è¯»å†™æ€§èƒ½ï¼Œè€Œä¸èƒ½ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚æˆ‘ä»¬çŸ¥é“ä»»ä½•ä¸€ä¸ªæœåŠ¡æŒ‚æ‰çš„å¯èƒ½æ€§éƒ½æ˜¯å­˜åœ¨çš„ï¼Œæˆ‘ä»¬è¯´çš„é«˜å¯ç”¨åªèƒ½æ˜¯å°½å¯èƒ½å°çš„é¿å…æ•´ä¸ªæœåŠ¡æŒ‚æ‰çš„å¯èƒ½ã€‚ç”±æ­¤ä½ åº”è¯¥èƒ½æƒ³åˆ°å¤šä¸»å¤šä»ï¼Œè¿™ä¸ªä»…ä»…æ–‡ç« é‡Œçš„é…ç½®æ˜¯å®Œæˆä¸äº†çš„ï¼ŒPHPæ¡†æ¶ä¹Ÿæ˜¯æ£€æµ‹ä¸äº†çš„ã€‚</p><p>æˆ‘è§‰å¾—PHPæ¡†æ¶æ¥åšè¯»å†™åˆ†ç¦»æ˜¯ä¸ç§‘å­¦çš„ï¼Œå› ä¸ºå¢åŠ äº†ä»£ç çš„å¤æ‚åº¦ï¼Œæˆ‘è®¤ä¸ºè¿™äº›åº”è¯¥äº¤ç»™æ•°æ®åº“æ¥åšï¼Œæˆ–è€…æ•°æ®åº“ä¸­é—´ä»¶æ¥åšï¼Œå„å¸å…¶èŒå—ã€‚</p><p>æˆ‘ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¾ˆå¤šäººä¼šæƒ³åˆ°mysql_proxyï¼Œç„¶è€Œå®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œæ¨èä½¿ç”¨mysql_routerï¼Œæœ‰åœ¨è‡ªå·±çš„ECSä¸Šå°è¯•äº†ä¸€ä¸‹ï¼Œé…ç½®ç›¸å¯¹è¿˜æ˜¯ç®€å•çš„ï¼Œæ²¡æµ‹è¯•æ€§èƒ½ï¼Œä½†ç¡®å®å®ç°äº†ä¸€å®šç¨‹åº¦çš„é«˜å¯ç”¨ã€‚</p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥å»ä½¿ç”¨å˜å½¢è™«ç­‰ä¸­é—´ä»¶ï¼Œä»–ä»¬çš„åŠŸèƒ½ç›¸æ¯”mysql_routeræ›´ä¸ºå¼ºå¤§ã€‚</p><blockquote><p>æ­¤ç¯‡æ²¡æœ‰å¹²è´§ï¼Œåªæ˜¯çº¯æŠ€æœ¯æ¢è®¨ï¼Œæˆ‘ä¸è¿‡æ˜¯åœ¨å—äº¬å—ç«™ï¼Œæ²¡äº‹ç ç å­—ç½¢äº†ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>db</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ThinkPHPè¯»å†™åˆ†ç¦»çš„å†…éƒ¨å®ç°</title>
    <link href="/2018/12/17/174/"/>
    <url>/2018/12/17/174/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åˆ†æçš„ç‰ˆæœ¬æ˜¯TP3.2.3</p></blockquote><p>æ­¤ç‰ˆæœ¬å·²ç»æ”¯æŒmysqlæ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œé…ç½®æ¯”è¾ƒç®€å•ï¼Œå…·ä½“å¯çœ‹<a href="http://document.thinkphp.cn/manual_3_2.html#distributed_database">åˆ†å¸ƒå¼æ•°æ®åº“æ”¯æŒ</a></p><p>æˆ‘ä»¬å°è¯•åˆ†æä¸‹æºç å®ç°ï¼š</p><p>ä¸å¦¨å…ˆyyä¸€ä¸‹ï¼Œåœ¨å†™æ“ä½œå’Œè¯»æ“ä½œæ—¶åŒºåˆ†å¼€æ•°æ®åº“è¿æ¥åˆ†åˆ«è¿æ¥masterå’Œslaveã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹è§Model.class.phpçš„dbåˆå§‹åŒ–</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">db</span>(<span class="hljs-params"><span class="hljs-variable">$linkNum</span> = , <span class="hljs-variable">$config</span> = , <span class="hljs-variable">$force</span> = <span class="hljs-literal">false</span></span>) </span>&#123;  <span class="hljs-keyword">if</span> ( === <span class="hljs-variable">$linkNum</span> &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;db) &#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db;  &#125;    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span> ( <span class="hljs-keyword">$this</span>-&gt;_db [<span class="hljs-variable">$linkNum</span>] ) || <span class="hljs-variable">$force</span>) &#123;    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</span>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span> ( <span class="hljs-variable">$config</span> ) &amp;&amp; is_string ( <span class="hljs-variable">$config</span> ) &amp;&amp; <span class="hljs-literal">false</span> === strpos ( <span class="hljs-variable">$config</span>, / )) &#123; <span class="hljs-comment">// æ”¯æŒè¯»å–é…ç½®å‚æ•°</span>      <span class="hljs-variable">$config</span> = C ( <span class="hljs-variable">$config</span> );    &#125;    <span class="hljs-keyword">$this</span>-&gt;_db [<span class="hljs-variable">$linkNum</span>] = Db::getInstance ( <span class="hljs-variable">$config</span> );  &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-literal">NULL</span> === <span class="hljs-variable">$config</span>) &#123;    <span class="hljs-keyword">$this</span>-&gt;_db [<span class="hljs-variable">$linkNum</span>]-&gt;close (); <span class="hljs-comment">// å…³é—­æ•°æ®åº“è¿æ¥</span>    <span class="hljs-keyword">unset</span> ( <span class="hljs-keyword">$this</span>-&gt;_db [<span class="hljs-variable">$linkNum</span>] );    <span class="hljs-keyword">return</span>;  &#125;    <span class="hljs-comment">// åˆ‡æ¢æ•°æ®åº“è¿æ¥</span>  <span class="hljs-keyword">$this</span>-&gt;db = <span class="hljs-keyword">$this</span>-&gt;_db [<span class="hljs-variable">$linkNum</span>];  <span class="hljs-keyword">$this</span>-&gt;_after_db ();  <span class="hljs-comment">// å­—æ®µæ£€æµ‹</span>  <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span> ( <span class="hljs-keyword">$this</span>-&gt;name ) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;autoCheckFields)    <span class="hljs-keyword">$this</span>-&gt;_checkTableInfo ();  <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;&#125;</code></pre></div><p>æ¥ç€çœ‹DBå•ä¾‹ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-built_in">static</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInstance</span>(<span class="hljs-params"><span class="hljs-variable">$config</span> = <span class="hljs-keyword">array</span>(<span class="hljs-params"></span>)</span>) </span>&#123;  <span class="hljs-variable">$md5</span> = md5 ( serialize ( <span class="hljs-variable">$config</span> ) );  <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span> ( <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> [<span class="hljs-variable">$md5</span>] )) &#123;    <span class="hljs-comment">// è§£æè¿æ¥å‚æ•° æ”¯æŒæ•°ç»„å’Œå­—ç¬¦ä¸²</span>    <span class="hljs-variable">$options</span> = <span class="hljs-built_in">self</span>::parseConfig ( <span class="hljs-variable">$config</span> );    <span class="hljs-comment">// å…¼å®¹mysqli</span>    <span class="hljs-keyword">if</span> (mysqli == <span class="hljs-variable">$options</span> [type])      <span class="hljs-variable">$options</span> [type] = mysql;      <span class="hljs-comment">// å¦‚æœé‡‡ç”¨liteæ–¹å¼ ä»…æ”¯æŒåŸç”ŸSQL åŒ…æ‹¬queryå’Œexecuteæ–¹æ³•</span>    <span class="hljs-variable">$class</span> = <span class="hljs-variable">$options</span> [lite] ? ThinkDbLite : Think\Db\Driver\ . ucwords ( strtolower ( <span class="hljs-variable">$options</span> [type] ) );    <span class="hljs-keyword">if</span> (class_exists ( <span class="hljs-variable">$class</span> )) &#123;      <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> [<span class="hljs-variable">$md5</span>] = <span class="hljs-keyword">new</span> <span class="hljs-variable">$class</span> ( <span class="hljs-variable">$options</span> );    &#125; <span class="hljs-keyword">else</span> &#123;      <span class="hljs-comment">// ç±»æ²¡æœ‰å®šä¹‰</span>      E ( L ( _NO_DB_DRIVER_ ) . :  . <span class="hljs-variable">$class</span> );    &#125;  &#125;  <span class="hljs-built_in">self</span>::<span class="hljs-variable">$_instance</span> = <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> [<span class="hljs-variable">$md5</span>];  <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$_instance</span>;&#125;</code></pre></div><p>æ¥ç€çœ‹è§mysqlé©±åŠ¨ç»§æ‰¿äº†æŠ½è±¡ç±»Driverã€‚</p><p>ä¸å¦¨æ‰¾ä¸¤ä¸ªModelæ“ä½œè¯»ï¼ˆfindï¼‰å’Œå†™(add):</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span>(<span class="hljs-params"><span class="hljs-variable">$options</span> = <span class="hljs-keyword">array</span>(<span class="hljs-params"></span>)</span>) </span>&#123;  ...  <span class="hljs-variable">$resultSet</span> = <span class="hljs-keyword">$this</span>-&gt;db-&gt;select ( <span class="hljs-variable">$options</span> );  ...&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params"><span class="hljs-variable">$data</span> = , <span class="hljs-variable">$options</span> = <span class="hljs-keyword">array</span>(<span class="hljs-params"></span>), <span class="hljs-variable">$replace</span> = <span class="hljs-literal">false</span></span>) </span>&#123;  ...  <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;db-&gt;insert ( <span class="hljs-variable">$data</span>, <span class="hljs-variable">$options</span>, <span class="hljs-variable">$replace</span> );  ...&#125;</code></pre></div><p>æˆ‘ä»¬åªèšç„¦å…³é”®ä»£ç select å’Œinsert ã€‚<br>ç„¶åå»æŸ¥çœ‹æ•°æ®åº“é©±åŠ¨ç±»ä»£ç ï¼š</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select</span>(<span class="hljs-params"><span class="hljs-variable">$options</span> = <span class="hljs-keyword">array</span>(<span class="hljs-params"></span>)</span>) </span>&#123;  ...  <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;query ( <span class="hljs-variable">$sql</span>, ! <span class="hljs-keyword">empty</span> ( <span class="hljs-variable">$options</span> [fetch_sql] ) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span> );  ...&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span>(<span class="hljs-params"><span class="hljs-variable">$data</span>, <span class="hljs-variable">$options</span> = <span class="hljs-keyword">array</span>(<span class="hljs-params"></span>), <span class="hljs-variable">$replace</span> = <span class="hljs-literal">false</span></span>) </span>&#123;  ...  <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;execute ( <span class="hljs-variable">$sql</span>, ! <span class="hljs-keyword">empty</span> ( <span class="hljs-variable">$options</span> [fetch_sql] ) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span> );&#125;</code></pre></div><p>ç»§ç»­å¯»æ ¹ï¼Œæˆ‘ä»¬çœ‹è§</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ‰§è¡ŒæŸ¥è¯¢ è¿”å›æ•°æ®é›†</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">query</span>(<span class="hljs-params"><span class="hljs-variable">$str</span>, <span class="hljs-variable">$fetchSql</span> = <span class="hljs-literal">false</span></span>) </span>&#123;  <span class="hljs-keyword">$this</span>-&gt;initConnect ( <span class="hljs-literal">false</span> );  ...&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * æ‰§è¡Œè¯­å¥</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span>(<span class="hljs-params"><span class="hljs-variable">$str</span>, <span class="hljs-variable">$fetchSql</span> = <span class="hljs-literal">false</span></span>) </span>&#123;  <span class="hljs-keyword">$this</span>-&gt;initConnect ( <span class="hljs-literal">true</span> );  ...&#125;</code></pre></div><p>æˆ‘ä»¬ç»ˆäºæ‰¾åˆ°äº†æ ¹æœ¬ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆå§‹åŒ–æ•°æ®åº“è¿æ¥</span><span class="hljs-comment"> * </span><span class="hljs-comment"> * <span class="hljs-doctag">@access</span> protected</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> boolean $master</span><span class="hljs-comment"> *        ä¸»æœåŠ¡å™¨</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment"> */</span><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initConnect</span>(<span class="hljs-params"><span class="hljs-variable">$master</span> = <span class="hljs-literal">true</span></span>) </span>&#123;<span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span> ( <span class="hljs-keyword">$this</span>-&gt;config [deploy] ))<span class="hljs-comment">// é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“</span><span class="hljs-keyword">$this</span>-&gt;_linkID = <span class="hljs-keyword">$this</span>-&gt;multiConnect ( <span class="hljs-variable">$master</span> );<span class="hljs-keyword">else</span> <span class="hljs-comment">// é»˜è®¤å•æ•°æ®åº“</span><span class="hljs-keyword">if</span> (! <span class="hljs-keyword">$this</span>-&gt;_linkID)<span class="hljs-keyword">$this</span>-&gt;_linkID = <span class="hljs-keyword">$this</span>-&gt;connect ();&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * è¿æ¥åˆ†å¸ƒå¼æœåŠ¡å™¨</span><span class="hljs-comment"> * </span><span class="hljs-comment"> * <span class="hljs-doctag">@access</span> protected</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> boolean $master</span><span class="hljs-comment"> *        ä¸»æœåŠ¡å™¨</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> void</span><span class="hljs-comment"> */</span><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiConnect</span>(<span class="hljs-params"><span class="hljs-variable">$master</span> = <span class="hljs-literal">false</span></span>) </span>&#123;<span class="hljs-comment">// åˆ†å¸ƒå¼æ•°æ®åº“é…ç½®è§£æ</span><span class="hljs-variable">$_config</span> [username] = explode ( ,, <span class="hljs-keyword">$this</span>-&gt;config [username] );<span class="hljs-variable">$_config</span> [password] = explode ( ,, <span class="hljs-keyword">$this</span>-&gt;config [password] );<span class="hljs-variable">$_config</span> [hostname] = explode ( ,, <span class="hljs-keyword">$this</span>-&gt;config [hostname] );<span class="hljs-variable">$_config</span> [hostport] = explode ( ,, <span class="hljs-keyword">$this</span>-&gt;config [hostport] );<span class="hljs-variable">$_config</span> [database] = explode ( ,, <span class="hljs-keyword">$this</span>-&gt;config [database] );<span class="hljs-variable">$_config</span> [dsn] = explode ( ,, <span class="hljs-keyword">$this</span>-&gt;config [dsn] );<span class="hljs-variable">$_config</span> [charset] = explode ( ,, <span class="hljs-keyword">$this</span>-&gt;config [charset] );<span class="hljs-variable">$m</span> = floor ( mt_rand ( <span class="hljs-number">0</span>, <span class="hljs-keyword">$this</span>-&gt;config [master_num] - <span class="hljs-number">1</span> ) );<span class="hljs-comment">// æ•°æ®åº“è¯»å†™æ˜¯å¦åˆ†ç¦»</span><span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;config [rw_separate]) &#123;<span class="hljs-comment">// ä¸»ä»å¼é‡‡ç”¨è¯»å†™åˆ†ç¦»</span><span class="hljs-keyword">if</span> (<span class="hljs-variable">$master</span>)<span class="hljs-comment">// ä¸»æœåŠ¡å™¨å†™å…¥</span><span class="hljs-variable">$r</span> = <span class="hljs-variable">$m</span>;<span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">if</span> (is_numeric ( <span class="hljs-keyword">$this</span>-&gt;config [slave_no] )) &#123; <span class="hljs-comment">// æŒ‡å®šæœåŠ¡å™¨è¯»</span><span class="hljs-variable">$r</span> = <span class="hljs-keyword">$this</span>-&gt;config [slave_no];&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// è¯»æ“ä½œè¿æ¥ä»æœåŠ¡å™¨</span><span class="hljs-variable">$r</span> = floor ( mt_rand ( <span class="hljs-keyword">$this</span>-&gt;config [master_num], count ( <span class="hljs-variable">$_config</span> [hostname] ) - <span class="hljs-number">1</span> ) ); <span class="hljs-comment">// æ¯æ¬¡éšæœºè¿æ¥çš„æ•°æ®åº“</span>&#125;&#125;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// è¯»å†™æ“ä½œä¸åŒºåˆ†æœåŠ¡å™¨</span><span class="hljs-variable">$r</span> = floor ( mt_rand ( <span class="hljs-number">0</span>, count ( <span class="hljs-variable">$_config</span> [hostname] ) - <span class="hljs-number">1</span> ) ); <span class="hljs-comment">// æ¯æ¬¡éšæœºè¿æ¥çš„æ•°æ®åº“</span>&#125;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$m</span> != <span class="hljs-variable">$r</span>) &#123;<span class="hljs-variable">$db_master</span> = <span class="hljs-keyword">array</span> (username =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [username] [<span class="hljs-variable">$m</span>] ) ? <span class="hljs-variable">$_config</span> [username] [<span class="hljs-variable">$m</span>] : <span class="hljs-variable">$_config</span> [username] [<span class="hljs-number">0</span>],password =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [password] [<span class="hljs-variable">$m</span>] ) ? <span class="hljs-variable">$_config</span> [password] [<span class="hljs-variable">$m</span>] : <span class="hljs-variable">$_config</span> [password] [<span class="hljs-number">0</span>],hostname =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [hostname] [<span class="hljs-variable">$m</span>] ) ? <span class="hljs-variable">$_config</span> [hostname] [<span class="hljs-variable">$m</span>] : <span class="hljs-variable">$_config</span> [hostname] [<span class="hljs-number">0</span>],hostport =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [hostport] [<span class="hljs-variable">$m</span>] ) ? <span class="hljs-variable">$_config</span> [hostport] [<span class="hljs-variable">$m</span>] : <span class="hljs-variable">$_config</span> [hostport] [<span class="hljs-number">0</span>],database =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [database] [<span class="hljs-variable">$m</span>] ) ? <span class="hljs-variable">$_config</span> [database] [<span class="hljs-variable">$m</span>] : <span class="hljs-variable">$_config</span> [database] [<span class="hljs-number">0</span>],dsn =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [dsn] [<span class="hljs-variable">$m</span>] ) ? <span class="hljs-variable">$_config</span> [dsn] [<span class="hljs-variable">$m</span>] : <span class="hljs-variable">$_config</span> [dsn] [<span class="hljs-number">0</span>],charset =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [charset] [<span class="hljs-variable">$m</span>] ) ? <span class="hljs-variable">$_config</span> [charset] [<span class="hljs-variable">$m</span>] : <span class="hljs-variable">$_config</span> [charset] [<span class="hljs-number">0</span>] );&#125;<span class="hljs-variable">$db_config</span> = <span class="hljs-keyword">array</span> (username =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [username] [<span class="hljs-variable">$r</span>] ) ? <span class="hljs-variable">$_config</span> [username] [<span class="hljs-variable">$r</span>] : <span class="hljs-variable">$_config</span> [username] [<span class="hljs-number">0</span>],password =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [password] [<span class="hljs-variable">$r</span>] ) ? <span class="hljs-variable">$_config</span> [password] [<span class="hljs-variable">$r</span>] : <span class="hljs-variable">$_config</span> [password] [<span class="hljs-number">0</span>],hostname =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [hostname] [<span class="hljs-variable">$r</span>] ) ? <span class="hljs-variable">$_config</span> [hostname] [<span class="hljs-variable">$r</span>] : <span class="hljs-variable">$_config</span> [hostname] [<span class="hljs-number">0</span>],hostport =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [hostport] [<span class="hljs-variable">$r</span>] ) ? <span class="hljs-variable">$_config</span> [hostport] [<span class="hljs-variable">$r</span>] : <span class="hljs-variable">$_config</span> [hostport] [<span class="hljs-number">0</span>],database =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [database] [<span class="hljs-variable">$r</span>] ) ? <span class="hljs-variable">$_config</span> [database] [<span class="hljs-variable">$r</span>] : <span class="hljs-variable">$_config</span> [database] [<span class="hljs-number">0</span>],dsn =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [dsn] [<span class="hljs-variable">$r</span>] ) ? <span class="hljs-variable">$_config</span> [dsn] [<span class="hljs-variable">$r</span>] : <span class="hljs-variable">$_config</span> [dsn] [<span class="hljs-number">0</span>],charset =&gt; <span class="hljs-keyword">isset</span> ( <span class="hljs-variable">$_config</span> [charset] [<span class="hljs-variable">$r</span>] ) ? <span class="hljs-variable">$_config</span> [charset] [<span class="hljs-variable">$r</span>] : <span class="hljs-variable">$_config</span> [charset] [<span class="hljs-number">0</span>] );<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;connect ( <span class="hljs-variable">$db_config</span>, <span class="hljs-variable">$r</span>, <span class="hljs-variable">$r</span> == <span class="hljs-variable">$m</span> ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$db_master</span> );&#125;</code></pre></div><p>å…¶å®å°±æ˜¯é€šè¿‡ä¼ å…¥initConnectæ¥åŒºåˆ†è¯»å†™æ“ä½œï¼Œå¹¶æ ¹æ®é…ç½®å»è¿æ¥æ“ä½œã€‚</p><p>ä»Šå¤©åˆ†æå°±åˆ°è¿™é‡Œäº†ï¼Œå…¶å®ä¸æˆ‘ä»¬yyçš„åŸºæœ¬ä¸€è‡´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ThinkPHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>swooleå‘é‚®ä»¶</title>
    <link href="/2018/11/29/171/"/>
    <url>/2018/11/29/171/</url>
    
    <content type="html"><![CDATA[<p>Swooleï¼šé¢å‘ç”Ÿäº§ç¯å¢ƒçš„ PHP å¼‚æ­¥ç½‘ç»œé€šä¿¡å¼•æ“</p><p>å¾ˆæ—©å°±çŸ¥é“äº†swooleï¼Œä½†ä¸€ç›´æ²¡æœ‰å®é™…ç”¨åˆ°ç”Ÿäº§ä¸­ï¼Œæœ€è¿‘åœ¨é‡æ„åšå®¢ï¼Œå°±æƒ³ç€åšç‚¹ä¸œè¥¿ï¼Œå…ˆswooleå‘é‚®ä»¶ç»ƒç»ƒæ‰‹ã€‚</p><p>å›é¡¾ä¸‹å‘é‚®ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨PHPMaileræ¥å‘é€ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Created by PhpStorm.</span><span class="hljs-comment"> * User: 13sai</span><span class="hljs-comment"> * Date: 2018/11/29</span><span class="hljs-comment"> * Time: 11:16</span><span class="hljs-comment"> */</span><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;../vendor/autoload.php&#x27;</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">PHPMailer</span>\<span class="hljs-title">PHPMailer</span>\<span class="hljs-title">PHPMailer</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">PHPMailer</span>\<span class="hljs-title">PHPMailer</span>\<span class="hljs-title">Exception</span>;<span class="hljs-variable">$mail</span> = <span class="hljs-keyword">new</span> PHPMailer(<span class="hljs-literal">true</span>);<span class="hljs-keyword">try</span> &#123;    <span class="hljs-comment">//Server settings</span>    <span class="hljs-comment">// $mail-&gt;SMTPDebug = 2;                                 // Enable verbose debug output</span>    <span class="hljs-variable">$mail</span>-&gt;isSMTP();                                      <span class="hljs-comment">// Set mailer to use SMTP</span>    <span class="hljs-variable">$mail</span>-&gt;Host = <span class="hljs-string">&#x27;smtp.163.com&#x27;</span>;  <span class="hljs-comment">// Specify main and backup SMTP servers</span>    <span class="hljs-variable">$mail</span>-&gt;SMTPAuth = <span class="hljs-literal">true</span>;                               <span class="hljs-comment">// Enable SMTP authentication</span>    <span class="hljs-variable">$mail</span>-&gt;Username = <span class="hljs-string">&#x27;sai@163.com&#x27;</span>;                 <span class="hljs-comment">// SMTP username</span>    <span class="hljs-variable">$mail</span>-&gt;Password = <span class="hljs-string">&#x27;*&#x27;</span>;                           <span class="hljs-comment">// SMTP password</span>    <span class="hljs-variable">$mail</span>-&gt;SMTPSecure = <span class="hljs-string">&#x27;tls&#x27;</span>;                            <span class="hljs-comment">// Enable TLS encryption, ssl also accepted</span>    <span class="hljs-variable">$mail</span>-&gt;Port = <span class="hljs-number">25</span>;                                    <span class="hljs-comment">// TCP port to connect to</span>    <span class="hljs-comment">//æ”¶ä»¶äºº</span>    <span class="hljs-variable">$mail</span>-&gt;setFrom(<span class="hljs-string">&#x27;sai@163.com&#x27;</span>, <span class="hljs-string">&#x27;13sai&#x27;</span>);    <span class="hljs-variable">$mail</span>-&gt;addAddress(<span class="hljs-string">&#x27;957042781@qq.com&#x27;</span>);               <span class="hljs-comment">// Name is optional</span>    <span class="hljs-variable">$mail</span>-&gt;addReplyTo(<span class="hljs-string">&#x27;957042781@qq.com&#x27;</span>, <span class="hljs-string">&#x27;Information&#x27;</span>);<span class="hljs-comment">//    $mail-&gt;addCC(&#x27;cc@example.com&#x27;);</span><span class="hljs-comment">//    $mail-&gt;addBCC(&#x27;bcc@example.com&#x27;);</span>    <span class="hljs-comment">//é™„ä»¶</span>    <span class="hljs-variable">$mail</span>-&gt;addAttachment(<span class="hljs-string">&#x27;/var/file.tar.gz&#x27;</span>);         <span class="hljs-comment">// Add attachments</span>    <span class="hljs-variable">$mail</span>-&gt;addAttachment(<span class="hljs-string">&#x27;/tmp/image.jpg&#x27;</span>, <span class="hljs-string">&#x27;new.jpg&#x27;</span>);    <span class="hljs-comment">// Optional name</span>    <span class="hljs-comment">//html</span>    <span class="hljs-variable">$mail</span>-&gt;isHTML(<span class="hljs-literal">true</span>);                               <span class="hljs-variable">$mail</span>-&gt;Subject = <span class="hljs-string">&#x27;Here is the subject&#x27;</span>;    <span class="hljs-variable">$mail</span>-&gt;Body    = <span class="hljs-string">&#x27;This is the HTML message body &lt;b&gt;in bold!&lt;/b&gt;&#x27;</span>;    <span class="hljs-variable">$mail</span>-&gt;AltBody = <span class="hljs-string">&#x27;This is the body in plain text for non-HTML mail clients&#x27;</span>;    <span class="hljs-variable">$mail</span>-&gt;send();    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Message has been sent&#x27;</span>;&#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Message could not be sent.&#x27;</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Mailer Error: &#x27;</span> . <span class="hljs-variable">$mail</span>-&gt;ErrorInfo;&#125;</code></pre></div><p>è¿è¡Œå‘é€ï¼Œæ”¶åˆ°é‚®ä»¶ã€‚</p><h2 id="ä¸»ç¨‹åº"><a href="#ä¸»ç¨‹åº" class="headerlink" title="ä¸»ç¨‹åº"></a>ä¸»ç¨‹åº</h2><div class="code-wrapper"><pre><code class="hljs perl">&lt;?php/**  Created by PhpStorm.  User: <span class="hljs-number">13</span>sai  Date: <span class="hljs-number">2018</span>/<span class="hljs-number">11</span>/<span class="hljs-number">29</span>  Time: <span class="hljs-number">14</span>:<span class="hljs-number">06</span>/<span class="hljs-keyword">require</span> dirname(DIR).<span class="hljs-string">&#x27;/vendor/autoload.php&#x27;</span>;<span class="hljs-keyword">use</span> PHPMailer\PHPMailer\PHPMailer;<span class="hljs-keyword">use</span> PHPMailer\PHPMailer\Exception;class Mailer&#123;    protected $server;    protected $host = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;    protected $port = <span class="hljs-number">9502</span>;    <span class="hljs-regexp">//</span> è¿›ç¨‹åç§°    protected $taskName = <span class="hljs-string">&#x27;swooleMailer&#x27;</span>;    <span class="hljs-regexp">//</span> PIDè·¯å¾„    protected $pidPath = <span class="hljs-string">&#x27;/run/swooleMail.pid&#x27;</span>;    <span class="hljs-regexp">//</span> è®¾ç½®è¿è¡Œæ—¶å‚æ•°    protected $options = [        <span class="hljs-string">&#x27;worker_num&#x27;</span> =&gt; <span class="hljs-number">4</span>, <span class="hljs-regexp">//</span>workerè¿›ç¨‹æ•°,ä¸€èˆ¬è®¾ç½®ä¸ºCPUæ•°çš„<span class="hljs-number">1</span>-<span class="hljs-number">4</span>å€        <span class="hljs-string">&#x27;daemonize&#x27;</span> =&gt; true, <span class="hljs-regexp">//</span>å¯ç”¨å®ˆæŠ¤è¿›ç¨‹        <span class="hljs-string">&#x27;log_file&#x27;</span> =&gt; <span class="hljs-string">&#x27;/data/logs/swoole.log&#x27;</span>, <span class="hljs-regexp">//</span>æŒ‡å®šswooleé”™è¯¯æ—¥å¿—æ–‡ä»¶        <span class="hljs-string">&#x27;log_level&#x27;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-regexp">//</span>æ—¥å¿—çº§åˆ« èŒƒå›´æ˜¯<span class="hljs-number">0</span>-<span class="hljs-number">5</span>ï¼Œ<span class="hljs-number">0</span>-DEBUGï¼Œ<span class="hljs-number">1</span>-TRACEï¼Œ<span class="hljs-number">2</span>-INFOï¼Œ<span class="hljs-number">3</span>-NOTICEï¼Œ<span class="hljs-number">4</span>-WARNINGï¼Œ<span class="hljs-number">5</span>-ERROR        <span class="hljs-string">&#x27;dispatch_mode&#x27;</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-regexp">//</span>æ•°æ®åŒ…åˆ†å‘ç­–ç•¥,<span class="hljs-number">1</span>-è½®è¯¢æ¨¡å¼        <span class="hljs-string">&#x27;task_worker_num&#x27;</span> =&gt; <span class="hljs-number">4</span>, <span class="hljs-regexp">//</span>taskè¿›ç¨‹çš„æ•°é‡        <span class="hljs-string">&#x27;task_ipc_mode&#x27;</span> =&gt; <span class="hljs-number">3</span>, <span class="hljs-regexp">//</span>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ï¼Œå¹¶è®¾ç½®ä¸ºäº‰æŠ¢æ¨¡å¼        //<span class="hljs-string">&#x27;heartbeat_idle_time&#x27;</span> =&gt; <span class="hljs-number">600</span>, <span class="hljs-regexp">//</span>ä¸€ä¸ªè¿æ¥å¦‚æœ<span class="hljs-number">600</span>ç§’å†…æœªå‘æœåŠ¡å™¨å‘é€ä»»ä½•æ•°æ®ï¼Œæ­¤è¿æ¥å°†è¢«å¼ºåˆ¶å…³é—­        //<span class="hljs-string">&#x27;heartbeat_check_interval&#x27;</span> =&gt; <span class="hljs-number">60</span>, <span class="hljs-regexp">//</span>å¯ç”¨å¿ƒè·³æ£€æµ‹ï¼Œæ¯éš”<span class="hljs-number">60</span>sè½®å¾ªä¸€æ¬¡    ];    <span class="hljs-regexp">//</span> é‚®ä»¶æœåŠ¡å™¨é…ç½®    protected $mailConfig = [        <span class="hljs-string">&#x27;smtp_host&#x27;</span> =&gt; <span class="hljs-string">&#x27;smtp.163.com&#x27;</span>,        <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;sai0556@163.com&#x27;</span>,        <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;xmw1015&#x27;</span>,<span class="hljs-regexp">//</span> SMTP å¯†ç /å£ä»¤        <span class="hljs-string">&#x27;secure&#x27;</span> =&gt; <span class="hljs-string">&#x27;ssl&#x27;</span>, <span class="hljs-regexp">//</span>Enable TLS encryption, ssl also accepted        <span class="hljs-string">&#x27;port&#x27;</span> =&gt; <span class="hljs-number">465</span>, <span class="hljs-regexp">//</span> tcpé‚®ä»¶æœåŠ¡å™¨ç«¯å£    ];    public function __construct($mailConfig, $options = [])    &#123;        <span class="hljs-regexp">//</span> æ„å»ºServerå¯¹è±¡ï¼Œç›‘å¬ç«¯å£        $this-&gt;server = new swoole_server($this-&gt;host, $this-&gt;port);        <span class="hljs-keyword">if</span> (!empty($options)) &#123;            $this-&gt;options = array_merge($this-&gt;options, $options);        &#125;        $this-&gt;server-&gt;set($this-&gt;options);        $this-&gt;mailConfig = $mailConfig;        <span class="hljs-regexp">//</span> æ³¨å†Œäº‹ä»¶        $this-&gt;server-&gt;on(<span class="hljs-string">&#x27;Start&#x27;</span>, [$this, <span class="hljs-string">&#x27;onStart&#x27;</span>]);        $this-&gt;server-&gt;on(<span class="hljs-string">&#x27;Connect&#x27;</span>, [$this, <span class="hljs-string">&#x27;onConnect&#x27;</span>]);        $this-&gt;server-&gt;on(<span class="hljs-string">&#x27;Receive&#x27;</span>, [$this, <span class="hljs-string">&#x27;onReceive&#x27;</span>]);        $this-&gt;server-&gt;on(<span class="hljs-string">&#x27;Task&#x27;</span>, [$this, <span class="hljs-string">&#x27;onTask&#x27;</span>]);        $this-&gt;server-&gt;on(<span class="hljs-string">&#x27;Finish&#x27;</span>, [$this, <span class="hljs-string">&#x27;onFinish&#x27;</span>]);        $this-&gt;server-&gt;on(<span class="hljs-string">&#x27;Close&#x27;</span>, [$this, <span class="hljs-string">&#x27;onClose&#x27;</span>]);        <span class="hljs-regexp">//</span> å¯åŠ¨æœåŠ¡        //$this-&gt;server-&gt;start();    &#125;    protected function init()    &#123;        <span class="hljs-regexp">//</span>    &#125;    public function start()    &#123;        <span class="hljs-regexp">//</span> Run worker        $this-&gt;server-&gt;start();    &#125;    public function onStart($server)    &#123;        <span class="hljs-regexp">//</span> è®¾ç½®è¿›ç¨‹å        cli_set_process_title($this-&gt;taskName);        <span class="hljs-regexp">//</span>è®°å½•è¿›ç¨‹id,è„šæœ¬å®ç°è‡ªåŠ¨é‡å¯        $pid = <span class="hljs-string">&quot;&#123;$server-&gt;master_pid&#125;</span><span class="hljs-string">&#123;$server-&gt;manager_pid&#125;&quot;</span>;        file_put_contents($this-&gt;pidPath, $pid);    &#125;    //ç›‘å¬è¿æ¥è¿›å…¥äº‹ä»¶    public function onConnect($server, $fd, $from_id)    &#123;        $server-&gt;<span class="hljs-keyword">send</span>($fd, <span class="hljs-string">&quot;Hello &#123;$fd&#125;!&quot;</span> );    &#125;    // ç›‘å¬æ•°æ®æ¥æ”¶äº‹ä»¶    public function onReceive(swoole_server $server, $fd, $from_id, $data)    &#123;        $res[<span class="hljs-string">&#x27;result&#x27;</span>] = <span class="hljs-string">&#x27;success&#x27;</span>;        $server-&gt;<span class="hljs-keyword">send</span>($fd, json_encode($res)); <span class="hljs-regexp">//</span> åŒæ­¥è¿”å›æ¶ˆæ¯ç»™å®¢æˆ·ç«¯        $server-&gt;task($data);  <span class="hljs-regexp">//</span> æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡    &#125;    /*      @param $server swoole_server swoole_serverå¯¹è±¡      @param $task_id <span class="hljs-keyword">int</span> ä»»åŠ¡id      @param $from_id <span class="hljs-keyword">int</span> æŠ•é€’ä»»åŠ¡çš„worker_id      @param $data string æŠ•é€’çš„æ•°æ®     /    public function onTask(swoole_server $server, $task_id, $from_id, $data)    &#123;        $res[<span class="hljs-string">&#x27;result&#x27;</span>] = <span class="hljs-string">&#x27;failed&#x27;</span>;        $req = json_decode($data, true);        $action = $req[<span class="hljs-string">&#x27;action&#x27;</span>];        echo date(<span class="hljs-string">&#x27;Y-m-d H:i:s&#x27;</span>).<span class="hljs-string">&quot; onTask: [&quot;</span>.$action.<span class="hljs-string">&quot;].</span><span class="hljs-string">&quot;</span>;        switch ($action) &#123;            case <span class="hljs-string">&#x27;sendMail&#x27;</span>: <span class="hljs-regexp">//</span>å‘é€å•ä¸ªé‚®ä»¶                $mailData = [                    <span class="hljs-string">&#x27;emailAddress&#x27;</span> =&gt; $req[<span class="hljs-string">&#x27;to&#x27;</span>], <span class="hljs-regexp">//</span>æ¥æ”¶æ–¹ï¼Œæ”¹æˆè‡ªå·±çš„é‚®ç®±å¯ä»¥æµ‹è¯•æ¥æ”¶é‚®ä»¶                    <span class="hljs-string">&#x27;subject&#x27;</span> =&gt; $req[<span class="hljs-string">&#x27;subject&#x27;</span>],                    <span class="hljs-string">&#x27;body&#x27;</span> =&gt; $req[<span class="hljs-string">&#x27;body&#x27;</span>],                ];                $this-&gt;sendMail($mailData);                <span class="hljs-keyword">break</span>;            default:                <span class="hljs-keyword">break</span>;        &#125;    &#125;    /*      @param $server swoole_server swoole_serverå¯¹è±¡      @param $task_id <span class="hljs-keyword">int</span> ä»»åŠ¡id      @param $data string ä»»åŠ¡è¿”å›çš„æ•°æ®     *<span class="hljs-regexp">/</span><span class="hljs-regexp">    public function onFinish(swoole_server $server, $task_id, $data)</span><span class="hljs-regexp">    &#123;</span><span class="hljs-regexp">        /</span><span class="hljs-regexp">/</span><span class="hljs-regexp">    &#125;</span><span class="hljs-regexp"></span><span class="hljs-regexp"></span><span class="hljs-regexp">    /</span><span class="hljs-regexp">/ ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span><span class="hljs-regexp">    public function onClose($server, $fd, $from_id) &#123;</span><span class="hljs-regexp">        echo &quot;Client &#123;$fd&#125; close connection</span><span class="hljs-regexp">&quot;;</span><span class="hljs-regexp">    &#125;</span><span class="hljs-regexp"></span><span class="hljs-regexp"></span><span class="hljs-regexp">    public function stop()</span><span class="hljs-regexp">    &#123;</span><span class="hljs-regexp">        $this-&gt;server-&gt;stop();</span><span class="hljs-regexp">    &#125;</span><span class="hljs-regexp"></span><span class="hljs-regexp"></span><span class="hljs-regexp">    private function sendMail($mailData = [])</span><span class="hljs-regexp">    &#123;</span><span class="hljs-regexp">        $mail = new PHPMailer(true);</span><span class="hljs-regexp"></span><span class="hljs-regexp"></span><span class="hljs-regexp">        try &#123;</span><span class="hljs-regexp">            $mailConfig = $this-&gt;mailConfig;</span><span class="hljs-regexp">            $mail-&gt;isSMTP();                                   /</span><span class="hljs-regexp">/ TCP port to connect to</span><span class="hljs-regexp">            $mail-&gt;Host = $mailConfig[&#x27;smtp_host&#x27;];  /</span><span class="hljs-regexp">/ SMTPæœåŠ¡</span><span class="hljs-regexp">            $mail-&gt;SMTPAuth = true;                  /</span><span class="hljs-regexp">/ Enable SMTP authentication</span><span class="hljs-regexp">            $mail-&gt;Username = $mailConfig[&#x27;username&#x27;];    /</span><span class="hljs-regexp">/ SMTP ç”¨æˆ·å</span><span class="hljs-regexp">            $mail-&gt;Password = $mailConfig[&#x27;password&#x27;];     /</span><span class="hljs-regexp">/ SMTP å¯†ç /</span>å£ä»¤            $mail-&gt;SMTPSecure = $mailConfig[<span class="hljs-string">&#x27;secure&#x27;</span>];     <span class="hljs-regexp">//</span> Enable TLS encryption, ssl also accepted            $mail-&gt;Port = $mailConfig[<span class="hljs-string">&#x27;port&#x27;</span>];    <span class="hljs-regexp">//</span> TCP ç«¯å£            //Recipients            $mail-&gt;setFrom(<span class="hljs-string">&#x27;sai0556@163.com&#x27;</span>, <span class="hljs-string">&#x27;13sai&#x27;</span>);            $mail-&gt;addAddress(<span class="hljs-string">&#x27;957042781@qq.com&#x27;</span>);               <span class="hljs-regexp">//</span> Name is optional            $mail-&gt;addReplyTo(<span class="hljs-string">&#x27;957042781@qq.com&#x27;</span>, <span class="hljs-string">&#x27;Information&#x27;</span>);            <span class="hljs-regexp">//</span>Content            $mail-&gt;isHTML(true);                                  <span class="hljs-regexp">//</span> Set email <span class="hljs-keyword">format</span> to HTML            $mail-&gt;Subject = <span class="hljs-string">&#x27;Here is the subject&#x27;</span>;            $mail-&gt;Body    = <span class="hljs-string">&#x27;This is the HTML message body &lt;b&gt;in bold!&lt;/b&gt;&#x27;</span>;            $mail-&gt;AltBody = <span class="hljs-string">&#x27;This is the body in plain text for non-HTML mail clients&#x27;</span>;            $mail-&gt;<span class="hljs-keyword">send</span>();            echo <span class="hljs-string">&#x27;Message has been sent&#x27;</span>;        &#125; catch (Exception $e) &#123;            echo <span class="hljs-string">&#x27;Message could not be sent.&#x27;</span>;            echo <span class="hljs-string">&#x27;Mailer Error: &#x27;</span> . $mail-&gt;ErrorInfo;        &#125;        try &#123;            $mailConfig = $this-&gt;mailConfig;            $mail-&gt;isSMTP();   <span class="hljs-regexp">//</span> Set mailer to <span class="hljs-keyword">use</span> SMTP            $mail-&gt;Host = $mailConfig[<span class="hljs-string">&#x27;smtp_host&#x27;</span>];  <span class="hljs-regexp">//</span> SMTPæœåŠ¡            $mail-&gt;SMTPAuth = true;                  <span class="hljs-regexp">//</span> Enable SMTP authentication            $mail-&gt;Username = $mailConfig[<span class="hljs-string">&#x27;username&#x27;</span>];    <span class="hljs-regexp">//</span> SMTP ç”¨æˆ·å            $mail-&gt;Password = $mailConfig[<span class="hljs-string">&#x27;password&#x27;</span>];     <span class="hljs-regexp">//</span> SMTP å¯†ç /å£ä»¤            $mail-&gt;SMTPSecure = $mailConfig[<span class="hljs-string">&#x27;secure&#x27;</span>];     <span class="hljs-regexp">//</span> Enable TLS encryption, ssl also accepted            $mail-&gt;Port = $mailConfig[<span class="hljs-string">&#x27;port&#x27;</span>];    <span class="hljs-regexp">//</span> TCP ç«¯å£            $mail-&gt;CharSet  = <span class="hljs-string">&quot;UTF-8&quot;</span>; <span class="hljs-regexp">//</span>å­—ç¬¦é›†            $mail-&gt;setFrom($mailConfig[<span class="hljs-string">&#x27;username&#x27;</span>], <span class="hljs-string">&#x27;13sai&#x27;</span>); <span class="hljs-regexp">//</span>å‘ä»¶äººåœ°å€ï¼Œåç§°            $mail-&gt;addAddress($mailData[<span class="hljs-string">&#x27;emailAddress&#x27;</span>], <span class="hljs-string">&#x27;äº²&#x27;</span>);     <span class="hljs-regexp">//</span> æ”¶ä»¶äººåœ°å€å’Œåç§°            //$mail-&gt;addCC(<span class="hljs-string">&#x27;hellowebanet@163.com&#x27;</span>); <span class="hljs-regexp">//</span> æŠ„é€            <span class="hljs-keyword">if</span> (isset($mailData[<span class="hljs-string">&#x27;attach&#x27;</span>])) &#123;                $mail-&gt;addAttachment($mailData[<span class="hljs-string">&#x27;attach&#x27;</span>]);         <span class="hljs-regexp">//</span> æ·»åŠ é™„ä»¶            &#125;            //$mail-&gt;addAttachment(<span class="hljs-string">&#x27;/tmp/image.jpg&#x27;</span>, <span class="hljs-string">&#x27;new.jpg&#x27;</span>);    <span class="hljs-regexp">//</span> Optional name            //Content            $mail-&gt;isHTML(true);                                  <span class="hljs-regexp">//</span> Set email <span class="hljs-keyword">format</span> to HTML            $mail-&gt;Subject = $mailData[<span class="hljs-string">&#x27;subject&#x27;</span>];            $mail-&gt;Body    = $mailData[<span class="hljs-string">&#x27;body&#x27;</span>];            $mail-&gt;<span class="hljs-keyword">send</span>();            <span class="hljs-keyword">return</span> true;        &#125; catch (\Exception $e) &#123;            echo <span class="hljs-string">&#x27;Message could not be sent. Mailer Error: &#x27;</span>. $mail-&gt;ErrorInfo;            <span class="hljs-keyword">return</span> false;        &#125;    &#125;&#125;</code></pre></div><h2 id="æœåŠ¡ï¼š"><a href="#æœåŠ¡ï¼š" class="headerlink" title="æœåŠ¡ï¼š"></a>æœåŠ¡ï¼š</h2><div class="code-wrapper"><pre><code class="hljs awk">&lt;?php/*  Created by PhpStorm.  User: <span class="hljs-number">13</span>sai  Date: <span class="hljs-number">2018</span><span class="hljs-regexp">/11/</span><span class="hljs-number">29</span>  Time: <span class="hljs-number">14</span>:<span class="hljs-number">09</span> /require DIR . <span class="hljs-string">&#x27;/Mailer.php&#x27;</span>;<span class="hljs-variable">$config</span> = [    <span class="hljs-string">&#x27;smtp_host&#x27;</span> =&gt; <span class="hljs-string">&#x27;smtp.163.com&#x27;</span>,    <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;sai@163.com&#x27;</span>,    <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,    <span class="hljs-string">&#x27;secure&#x27;</span> =&gt; <span class="hljs-string">&#x27;ssl&#x27;</span>,    <span class="hljs-string">&#x27;port&#x27;</span> =&gt; <span class="hljs-number">465</span>];<span class="hljs-variable">$server</span> = new Mailer(<span class="hljs-variable">$config</span>);<span class="hljs-variable">$server</span>-&gt;start();</code></pre></div><h2 id="å‘é€"><a href="#å‘é€" class="headerlink" title="å‘é€"></a>å‘é€</h2><div class="code-wrapper"><pre><code class="hljs perl">&lt;?php/**  Created by PhpStorm.  User: <span class="hljs-number">13</span>sai  Date: <span class="hljs-number">2018</span>/<span class="hljs-number">11</span>/<span class="hljs-number">29</span>  Time: <span class="hljs-number">14</span>:<span class="hljs-number">14</span> /class Client&#123;    private $client;    public function __construct() &#123;        $this-&gt;client = new swoole_client(SWOOLE_SOCK_TCP);    &#125;    public function <span class="hljs-keyword">send</span>() &#123;        <span class="hljs-keyword">if</span>( !$this-&gt;client-&gt;<span class="hljs-keyword">connect</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">9502</span> , <span class="hljs-number">1</span>) ) &#123;            echo <span class="hljs-string">&quot;Error: &#123;$this-&gt;client-&gt;errMsg&#125;[&#123;$this-&gt;client-&gt;errCode&#125;]</span><span class="hljs-string">&quot;</span>;        &#125;        $action = <span class="hljs-string">&#x27;sendMail&#x27;</span>;        $time = <span class="hljs-keyword">time</span>();        $data = [            <span class="hljs-string">&#x27;action&#x27;</span> =&gt; $action,            <span class="hljs-string">&#x27;to&#x27;</span> =&gt; <span class="hljs-string">&#x27;957042781@qq.com&#x27;</span>,            <span class="hljs-string">&#x27;subject&#x27;</span> =&gt; <span class="hljs-string">&#x27;wow&#x27;</span>,            <span class="hljs-string">&#x27;body&#x27;</span> =&gt; <span class="hljs-string">&#x27;hello, 13sai!&#x27;</span>        ];        $msg = json_encode($data);        $this-&gt;client-&gt;<span class="hljs-keyword">send</span>( $msg );        $message = $this-&gt;client-&gt;<span class="hljs-keyword">recv</span>();        echo <span class="hljs-string">&quot;Get Message From Server:&#123;$message&#125;</span><span class="hljs-string">&quot;</span>;    &#125;&#125;$client = new Client();$client-&gt;<span class="hljs-keyword">send</span>();</code></pre></div><p>æµ‹è¯•é€šè¿‡ï¼</p><p>æ³¨æ„ï¼š</p><p>æ­¤å¤„æˆ‘ç”¨äº†25ç«¯å£ï¼Œéƒ¨ç½²åˆ°Linuxæ—¶ä¸Šå‘é€é‚®ä»¶å‘ä¸å‡ºå»ï¼ŒæŠŠPHPMailerçš„é”™è¯¯è¯´æ˜æŸ¥äº†ä¸ªéï¼Œwrongï¼Œç«¯å£æ”¹ä¸º465ï¼Œä½¿ç”¨sslå‘é€ï¼Œokï¼</p><p>å¿ƒç´¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>swoole</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginxå¥åº·æ£€æŸ¥</title>
    <link href="/2018/10/19/Nginx4/"/>
    <url>/2018/10/19/Nginx4/</url>
    
    <content type="html"><![CDATA[<p>é¢è¯•è¢«é—®åˆ°å¥åº·æ£€æµ‹ï¼Œè‡ªå·±ä¸äº†è§£ï¼Œä¾¿æœ‰äº†ä¸‹æ–‡ã€‚</p><p>å½“é¡¹ç›®è®¿é—®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡ã€‚</p><p>å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-comment">#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒ</span><span class="hljs-section">http</span> &#123;    <span class="hljs-comment">#è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰</span>    <span class="hljs-attribute">include</span>             /etc/nginx/mime.types;    <span class="hljs-attribute">default_type</span>    application/octet-stream;    <span class="hljs-comment">#è®¾å®šæ—¥å¿—æ ¼å¼</span>    <span class="hljs-attribute">access_log</span>        /var/log/nginx/access.log;    <span class="hljs-comment">#çœç•¥ä¸Šæ–‡æœ‰çš„ä¸€äº›é…ç½®èŠ‚ç‚¹</span>    <span class="hljs-comment">#ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span>    <span class="hljs-comment">#è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨</span>    <span class="hljs-attribute">upstream</span> sai&#123;        <span class="hljs-comment">#weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.8.1:3128</span> weight=<span class="hljs-number">5</span>;        <span class="hljs-comment">#æœ¬æœºä¸Šçš„Squidå¼€å¯3128ç«¯å£,ä¸æ˜¯å¿…é¡»è¦squid</span>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.8.2:80</span>    weight=<span class="hljs-number">1</span>;        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.8.3:80</span>    weight=<span class="hljs-number">6</span>;    &#125;            <span class="hljs-comment">#ç¬¬ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨</span>    <span class="hljs-section">server</span> &#123;        <span class="hljs-comment">#ä¾¦å¬192.168.8.xçš„80ç«¯å£</span>        <span class="hljs-attribute">listen</span>             <span class="hljs-number">80</span>;        <span class="hljs-attribute">server_name</span>    www.13sai.com;        <span class="hljs-comment">#å¯¹aspxåç¼€çš„è¿›è¡Œè´Ÿè½½å‡è¡¡è¯·æ±‚</span>        <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ .*.php$</span> &#123;            <span class="hljs-comment">#å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span>            <span class="hljs-attribute">root</span>     /root;             <span class="hljs-comment">#å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span>            <span class="hljs-attribute">index</span> index.php index.html index.htm;                        <span class="hljs-comment">#è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨</span>            <span class="hljs-attribute">proxy_pass</span>    http://sai;            <span class="hljs-comment">#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤.</span>            <span class="hljs-attribute">proxy_redirect</span> <span class="hljs-literal">off</span>;            <span class="hljs-comment">#åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span>            <span class="hljs-attribute">proxy_set_header</span> Host $host;            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP $remote_addr;            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;            <span class="hljs-comment">#å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span>            <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">10m</span>;             <span class="hljs-comment">#ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ</span>            <span class="hljs-attribute">client_body_buffer_size</span> <span class="hljs-number">128k</span>;            <span class="hljs-comment">#nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span>            <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">90</span>;            <span class="hljs-comment">#è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span>            <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">90</span>;            <span class="hljs-comment">#è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span>            <span class="hljs-attribute">proxy_buffer_size</span> <span class="hljs-number">4k</span>;            <span class="hljs-comment">#proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®</span>            <span class="hljs-attribute">proxy_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">32k</span>;            <span class="hljs-comment">#é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span>            <span class="hljs-attribute">proxy_busy_buffers_size</span> <span class="hljs-number">64k</span>;             <span class="hljs-comment">#è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span>            <span class="hljs-attribute">proxy_temp_file_write_size</span> <span class="hljs-number">64k</span>;            &#125;    &#125;&#125;</code></pre></div><p>è¿™æ˜¯nginxä¸­æ–‡ç½‘ä¸Šçš„ä¸€ä¸ªå®ä¾‹ï¼ˆæœ‰åˆ æ”¹ï¼‰ï¼Œè¿™æ ·å¤„ç†åˆ†å‘æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åŠ å…¥äº†ä¸‰å°æœºå™¨ï¼Œä¿è¯äº†é¡¹ç›®çš„è´Ÿè½½é‡ã€‚</p><p>ç„¶è€Œï¼Œæˆ‘ä»¬å¸¸å¸¸å¿½ç•¥å¦ä¸€ä»¶äº‹ï¼Œå°±æ˜¯å¥åº·æ£€æŸ¥ã€‚ï¼ˆå¥½å§ï¼Œå…¶å®æˆ‘ä¹Ÿå¿½ç•¥äº†è¿™ä¸ªé—®é¢˜ï¼Œé¢è¯•è¢«é—®åˆ°ï¼Œä¸€è„¸æ‡µï¼ï¼ï¼ï¼‰</p><p>ä½•ä¸ºå¥åº·ç›‘æµ‹ï¼Ÿ</p><p>å‡å¦‚æˆ‘ä»¬åŠ å…¥çš„3å°æœºå™¨ä¸­æœ‰ä¸€å°å› ä¸ºå…¶ä»–åŸå› æŒ‚æ‰äº†ï¼Œä½†åˆ†å‘çš„æœåŠ¡å™¨æ˜¯ä¸çŸ¥é“çš„ï¼Œä¾æ—§æ­£å¸¸åˆ†å‘è¯·æ±‚ï¼Œå¿…ç„¶å°±å¯¼è‡´éƒ¨åˆ†ç”¨æˆ·è®¿é—®å¤±è´¥ï¼Œè¿™æ˜¯å¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°å¥åº·æ£€æŸ¥äº†ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸¤ç§å¥åº·æ£€æŸ¥ï¼š</p><p><strong>è¢«åŠ¨æ£€æŸ¥ï¼š</strong></p><blockquote><p>å¦‚æœ Nginx åœ¨ 10 ç§’å†…æœ‰ 2 ä¸ªè¯·æ±‚å‘é€å¤±è´¥æˆ–æ²¡æœ‰æ¥æ”¶åˆ°å“åº”ï¼Œåˆ™æ ‡è®°æœåŠ¡å™¨ä¸ºä¸å¯ç”¨</p></blockquote><div class="code-wrapper"><pre><code class="hljs routeros">upstream sai&#123;   <span class="hljs-built_in"> server </span>192.168.8.1:3128  <span class="hljs-attribute">max_fails</span>=2 <span class="hljs-attribute">fail_timeout</span>=10s <span class="hljs-attribute">weight</span>=5;   <span class="hljs-built_in"> server </span>192.168.8.2:80    <span class="hljs-attribute">max_fails</span>=2 <span class="hljs-attribute">fail_timeout</span>=10s <span class="hljs-attribute">weight</span>=1;   <span class="hljs-built_in"> server </span>192.168.8.3:80    <span class="hljs-attribute">max_fails</span>=2 <span class="hljs-attribute">fail_timeout</span>=10s <span class="hljs-attribute">weight</span>=6;&#125;Copy</code></pre></div><p><strong>ä¸»åŠ¨æ£€æŸ¥ï¼š</strong></p><p>éœ€è¦å…ˆå¼€å¯health_check</p><div class="code-wrapper"><pre><code class="hljs nix">upstream sai&#123;    zone sai <span class="hljs-number">64</span>k;    server <span class="hljs-number">192.168</span>.<span class="hljs-number">8.1</span>:<span class="hljs-number">3128</span>  <span class="hljs-attr">max_fails=2</span> <span class="hljs-attr">fail_timeout=10s</span> <span class="hljs-attr">weight=5;</span>    server <span class="hljs-number">192.168</span>.<span class="hljs-number">8.2</span>:<span class="hljs-number">80</span>    <span class="hljs-attr">max_fails=2</span> <span class="hljs-attr">fail_timeout=10s</span> <span class="hljs-attr">weight=1;</span>    server <span class="hljs-number">192.168</span>.<span class="hljs-number">8.3</span>:<span class="hljs-number">80</span>    <span class="hljs-attr">max_fails=2</span> <span class="hljs-attr">fail_timeout=10s</span> <span class="hljs-attr">weight=6;</span>&#125;location ~ .*.php$ &#123;    <span class="hljs-comment">#å…¶ä»–çœç•¥</span>    â€¦    proxy_pass http://sai;    health_check <span class="hljs-attr">interval=10</span> <span class="hljs-attr">fails=3</span> <span class="hljs-attr">passes=2;</span>    <span class="hljs-comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤ç§ï¼ŒæŒ‡å®šç‰¹å®šæ¥å£ health_check uri=/some/path;</span>&#125;Copy</code></pre></div><p>é…ç½®èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p><h3 id="proxy-next-upstream"><a href="#proxy-next-upstream" class="headerlink" title="proxy_next_upstream"></a>proxy_next_upstream</h3><div class="code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment"># å¼€å¯proxy_next_upstream </span>proxy_next_upstream onupstream proxy_web&#123;      server <span class="hljs-number">192.168</span>.<span class="hljs-number">1.120</span>:<span class="hljs-number">7851</span> weight=<span class="hljs-number">2</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">100</span>s;      server <span class="hljs-number">192.168</span>.<span class="hljs-number">1.121</span>:<span class="hljs-number">7851</span> weight=<span class="hljs-number">2</span>  max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">100</span>s;&#125;server &#123;    listen <span class="hljs-number">80</span>;    server_name blog.<span class="hljs-number">13</span>sai.com;    root /www;    index index.html;    location /sys  &#123;        proxy_pass http:<span class="hljs-regexp">//</span>proxy_web;        proxy_set_header Host <span class="hljs-variable">$host</span>;        proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;        proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<span class="hljs-regexp">//</span> <span class="hljs-number">502</span>,<span class="hljs-number">404</span>,errorè‡ªåŠ¨ä»£ç†åˆ°ä¸‹ä¸€ä¸ªserver    proxy_next_upstream http_502 http_504 error timeout invalid_header;     &#125;&#125;</code></pre></div><p>å¦‚è¦äº†è§£æ›´å¤šå¯ä»¥æŸ¥çœ‹nginxæ‰‹å†Œï¼š</p><p><a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-health-check/">nginxå¥åº·ç›‘æµ‹</a></p>]]></content>
    
    
    <categories>
      
      <category>Nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºRedisçš„ç§’æ€</title>
    <link href="/2018/08/09/165/"/>
    <url>/2018/08/09/165/</url>
    
    <content type="html"><![CDATA[<p>éšç€ç”µå•†ä¸šåŠ¡çš„å‘å±•ï¼Œç§’æ€æ˜¯ä¸ªååˆ†å¸¸è§çš„åœºæ™¯ï¼Œä»Šå¤©æˆ‘ä»¬æ¥åˆ©ç”¨Rediså®ç°ä¸€ä¸ªç®€å•çš„ç§’æ€ç³»ç»Ÿã€‚</p><p>å‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªå•†å“idä¸º1ï¼Œç§’æ€æ•°é‡æ˜¯5ã€‚</p><p>ä¸€èˆ¬åœºæ™¯ï¼š</p><div class="code-wrapper"><pre><code class="hljs zephir">include <span class="hljs-string">&#x27;db.php&#x27;</span>;$db = <span class="hljs-keyword">new</span> db([    <span class="hljs-string">&#x27;database_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;mysql&#x27;</span>,    <span class="hljs-string">&#x27;database_name&#x27;</span> =&gt; <span class="hljs-string">&#x27;test&#x27;</span>,    <span class="hljs-string">&#x27;server&#x27;</span> =&gt; <span class="hljs-string">&#x27;www.13sai.com&#x27;</span>,    <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;13sai&#x27;</span>,    <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;*&#x27;</span>,    <span class="hljs-string">&#x27;charset&#x27;</span> =&gt; <span class="hljs-string">&#x27;utf8&#x27;</span>]);$stock_num= $db-&gt;get(<span class="hljs-string">&#x27;goods&#x27;</span>, <span class="hljs-string">&#x27;stock_num&#x27;</span>, [<span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">1</span>]);<span class="hljs-comment">// æ£€æµ‹åº“å­˜</span><span class="hljs-keyword">if</span> ($stock_num&gt; <span class="hljs-number">0</span>) &#123;    sleep(<span class="hljs-number">1</span>); <span class="hljs-comment">//æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ</span>    $db-&gt;update(<span class="hljs-string">&#x27;goods&#x27;</span>, [<span class="hljs-string">&quot;stock_num[-]&quot;</span> =&gt; <span class="hljs-number">1</span>], [<span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">1</span>]);    print_r(<span class="hljs-string">&#x27;ok&#x27;</span>)&#125; <span class="hljs-keyword">else</span> &#123;    print_r(<span class="hljs-string">&#x27;sorry&#x27;</span>)&#125;</code></pre></div><p>æˆ‘ä»¬å°è¯•æ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯ï¼Œä½¿ç”¨abå‹æµ‹å·¥å…·ï¼Œ</p><blockquote><p>ab -n 500 -c 500 <a href="http://www.13sai.com/test/miaosha.php">http://www.13sai.com/test/miaosha.php</a></p></blockquote><p>è¿è¡Œåå‘ç°åº“å­˜stock_numå¾ˆå¯èƒ½å·²ç»å˜æˆè´Ÿæ•°äº†ï¼Œå‡ºç°äº†è¶…å–é—®é¢˜ã€‚</p><p>å¼•å…¥Redis</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">//å®ä¾‹åŒ–Redis</span><span class="hljs-variable">$Redis</span> = <span class="hljs-keyword">new</span> Redis();<span class="hljs-comment">//è¿æ¥</span><span class="hljs-variable">$Redis</span>-&gt;connect(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">6379</span>);<span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;sale&#x27;</span>;<span class="hljs-comment">//æ£€æµ‹æ˜¯å¦è¿æ¥æˆåŠŸ</span><span class="hljs-comment">// echo &quot;Server is running: &quot; . $Redis-&gt;ping();</span><span class="hljs-variable">$Redis</span>-&gt;setnx(<span class="hljs-variable">$key</span>, <span class="hljs-number">0</span>);<span class="hljs-variable">$Redis</span>-&gt;watch(<span class="hljs-variable">$key</span>); <span class="hljs-comment">//ç›‘æµ‹ä¸€ä¸ªkeyçš„å€¼æ˜¯å¦è¢«æ›´æ”¹</span><span class="hljs-variable">$sale_num</span> = <span class="hljs-variable">$Redis</span>-&gt;get(<span class="hljs-variable">$key</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$sale_num</span> &gt; <span class="hljs-number">4</span>) &#123;    <span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$Redis</span>-&gt;multi(); <span class="hljs-comment">//æ ‡è®°äº‹åŠ¡</span><span class="hljs-variable">$Redis</span>-&gt;incr(<span class="hljs-variable">$key</span>);  <span class="hljs-comment">//é”€é‡+1</span>sleep(<span class="hljs-number">1</span>); <span class="hljs-comment">//æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ</span><span class="hljs-variable">$ret</span> = <span class="hljs-variable">$Redis</span>-&gt;exec(); <span class="hljs-comment">// äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚</span><span class="hljs-keyword">if</span> (<span class="hljs-variable">$ret</span>) &#123;    <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;db.php&#x27;</span>;    <span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> db([        <span class="hljs-string">&#x27;database_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;mysql&#x27;</span>,        <span class="hljs-string">&#x27;database_name&#x27;</span> =&gt; <span class="hljs-string">&#x27;test&#x27;</span>,        <span class="hljs-string">&#x27;server&#x27;</span> =&gt; <span class="hljs-string">&#x27;www.13sai.com&amp;#39;,</span><span class="hljs-string">        &#x27;</span>username<span class="hljs-string">&#x27; =&gt; &#x27;</span><span class="hljs-number">13</span>sai<span class="hljs-string">&#x27;,</span><span class="hljs-string">        &#x27;</span>password<span class="hljs-string">&#x27; =&gt; &#x27;</span>*<span class="hljs-string">&#x27;,</span><span class="hljs-string">        &#x27;</span>charset<span class="hljs-string">&#x27; =&gt; &#x27;</span>utf8<span class="hljs-string">&#x27;</span><span class="hljs-string">    ]);</span><span class="hljs-string">    $db-&gt;update(&#x27;</span>goods<span class="hljs-string">&#x27;, [&quot;stock_num[-]&quot; =&gt; 1], [&#x27;</span>id<span class="hljs-string">&#x27; =&gt; 1]);</span><span class="hljs-string">&#125;</span></code></pre></div><p>é‡æ–°å¢åŠ åº“å­˜åˆ°5ï¼Œå¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°åº“å­˜å¹¶æ— å‡ºç°è´Ÿæ•°æƒ…å†µï¼Œæµ‹è¯•é€šè¿‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸¤ä¸ªå…³äºLinuxçš„é—®é¢˜</title>
    <link href="/2018/07/06/163/"/>
    <url>/2018/07/06/163/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ç‚¹å¿™ï¼Œä¸€ä¼šä¸‹ç­ï¼Œä¹Ÿä¸æƒ³æ•²ä»£ç äº†ï¼Œå†™å†™å‰æ®µæ—¶é—´é‡åˆ°çš„ä¸¤ä¸ªå…³äºLinuxçš„é—®é¢˜ã€‚è™½ç„¶ä¸¤ä¸ªé—®é¢˜éƒ½æ˜¯åŒäº‹è§£å†³çš„ï¼Œä½†æœ‰å¿…è¦åˆ†äº«ä¸€ä¸‹ã€‚</p><h3 id="OOM"><a href="#OOM" class="headerlink" title="OOM"></a>OOM</h3><blockquote><p>OOM killerï¼ˆOut-Of-Memory killerï¼‰ï¼Œè¯¥æœºåˆ¶ä¼šç›‘æ§é‚£äº›å ç”¨å†…å­˜è¿‡å¤§ï¼Œå°¤å…¶æ˜¯ç¬é—´å¾ˆå¿«æ¶ˆè€—å¤§é‡å†…å­˜çš„è¿›ç¨‹ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜è€—å°½è€Œå†…æ ¸ä¼šæŠŠè¯¥è¿›ç¨‹æ€æ‰ã€‚</p></blockquote><p>èµ·å› ï¼šå¯¼å‡ºç›¸å½“å¤§çš„æ•°æ®æ—¶å¯¼è‡´å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼ŒæœåŠ¡å™¨è´Ÿè½½å¾ˆå¤§ï¼Œç„¶åOOMè¿™ä¸ªè¿›ç¨‹æ¯æ¬¡å°±æŠŠæˆ‘å¯¼å‡ºçš„è¿›ç¨‹å¹²è¶´ä¸‹äº†ã€‚</p><h3 id="æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°"><a href="#æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°" class="headerlink" title="æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°"></a>æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°</h3><div class="code-wrapper"><pre><code class="hljs awk">ulimit -n  <span class="hljs-regexp">//</span>æŸ¥çœ‹æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°lsof |wc -l  <span class="hljs-regexp">//</span>å½“å‰æ–‡ä»¶æ‰“å¼€æ•°é‡</code></pre></div><p>èµ·å› ï¼šå®ˆæŠ¤è¿›ç¨‹é‡Œæœ‰ä¸ªç¨‹åºï¼Œä¸€ç›´åœ¨fopenï¼Œå¯¼è‡´æ–‡ä»¶æ‰“å¼€æ•°è¿‡å¤§ï¼ŒæœåŠ¡å™¨æŒ‚æ‰äº†ã€‚</p><p>è§£å†³æ–¹æ¡ˆæ¯”è¾ƒç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºå¤§è¡¨æŸ¥è¯¢æœ€åå‡ é¡µè¿‡æ…¢çš„åŸå› </title>
    <link href="/2018/05/31/157/"/>
    <url>/2018/05/31/157/</url>
    
    <content type="html"><![CDATA[<p>mysqlæ•°æ®é‡å¾ˆå¤§ä½¿ç”¨limitæŸ¥è¯¢æœ€åå‡ é¡µå¾ˆæ…¢ï¼Œä½ çŸ¥é“åŸå› ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¬ä¸å¦¨å…ˆæ¥çœ‹çœ‹å‡ æ¡æŸ¥è¯¢è¯­å¥ä¸ç»“æœã€‚</p><div class="code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">where</span> id&gt;<span class="hljs-number">9900000</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">10</span>;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">limit</span> <span class="hljs-number">9900000</span>,<span class="hljs-number">10</span>;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> b.id <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">where</span> id&gt;<span class="hljs-number">9900000</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">10</span>) <span class="hljs-keyword">as</span> b); //å­æŸ¥è¯¢</code></pre></div><hr><div class="code-wrapper"><pre><code class="hljs pgsql">[<span class="hljs-keyword">SQL</span>]<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">where</span> id&gt;<span class="hljs-number">9900000</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">10</span>;å—å½±å“çš„è¡Œ: <span class="hljs-number">0</span>æ—¶é—´: <span class="hljs-number">0.019</span>s[<span class="hljs-keyword">SQL</span>]<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">limit</span> <span class="hljs-number">9900000</span>,<span class="hljs-number">10</span>;å—å½±å“çš„è¡Œ: <span class="hljs-number">0</span>æ—¶é—´: <span class="hljs-number">1.147</span>s[<span class="hljs-keyword">SQL</span>]<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> b.id <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> test_user <span class="hljs-keyword">where</span> id&gt;<span class="hljs-number">9900000</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">10</span>) <span class="hljs-keyword">as</span> b);å—å½±å“çš„è¡Œ: <span class="hljs-number">0</span>æ—¶é—´: <span class="hljs-number">0.001</span>s</code></pre></div><p>å…¶å®ï¼ŒåŸå› å°±åœ¨äºï¼š</p><blockquote><p>limit10000,20çš„æ„æ€æ‰«ææ»¡è¶³æ¡ä»¶çš„10020è¡Œï¼Œæ‰”æ‰å‰é¢çš„10000è¡Œï¼Œè¿”å›æœ€åçš„20è¡Œï¼Œé—®é¢˜å°±åœ¨è¿™é‡Œã€‚</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>è¿‡ä¸€åŠæ•°æ®é‡‡ç”¨å€’åºæŸ¥è¯¢</li><li>è¿ç”¨å­æŸ¥è¯¢</li></ol>]]></content>
    
    
    <categories>
      
      <category>db</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitè§£å†³æ€»è¦è¾“å…¥å¯†ç çš„é—®é¢˜</title>
    <link href="/2018/05/09/153/"/>
    <url>/2018/05/09/153/</url>
    
    <content type="html"><![CDATA[ <p data-source-line="1" style="box-sizing: border-box; margin-bottom: 16px; color: rgb(36, 41, 46); font-family: -apple-system, BlinkMacSystemFont, å¾®è½¯é›…é»‘, &quot;PingFang SC&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, SimSun, å®‹ä½“, Heiti, é»‘ä½“, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); margin-top: 0px !important;">ä¹‹å‰æ¯æ¬¡pullå’Œpushæ€»è¦è¾“å…¥å¯†ç ï¼Œç¹çã€‚æ“ä½œä¸¤æ­¥ï¼Œè§£å†³é—®é¢˜ï¼</p><ol data-source-line="4" style="box-sizing: border-box; padding-left: 2em; margin-bottom: 16px; color: rgb(36, 41, 46); font-family: -apple-system, BlinkMacSystemFont, å¾®è½¯é›…é»‘, &quot;PingFang SC&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, SimSun, å®‹ä½“, Heiti, é»‘ä½“, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>ç”Ÿæˆå…¬é’¥</p></li></ol><div class="code-wrapper"><pre data-source-line="5" style="box-sizing: border-box; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 16px; font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; line-height: 1.45; word-wrap: normal; padding: 16px; overflow: auto; background-color: rgb(246, 248, 250); border-radius: 3px; color: rgb(36, 41, 46);">cd&nbsp;~/.sshssh-keygen&nbsp;-t&nbsp;rsa&nbsp;-C&nbsp;&quot;æ³¨é‡Š&quot;</pre></div><ol start="2" data-source-line="10" style="box-sizing: border-box; padding-left: 2em; margin-bottom: 16px; color: rgb(36, 41, 46); font-family: -apple-system, BlinkMacSystemFont, å¾®è½¯é›…é»‘, &quot;PingFang SC&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, SimSun, å®‹ä½“, Heiti, é»‘ä½“, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>æ‹·è´å…¬é’¥åˆ°è¿œç¨‹ä¸»æœº</p></li></ol><blockquote data-source-line="11" style="box-sizing: border-box; margin: 0px 0px 16px; padding: 0px 1em; color: rgb(106, 115, 125); border-left: 0.25em solid rgb(223, 226, 229); font-family: -apple-system, BlinkMacSystemFont, å¾®è½¯é›…é»‘, &quot;PingFang SC&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, SimSun, å®‹ä½“, Heiti, é»‘ä½“, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;">ssh-copy-id&nbsp;<a href="mailto:git@xxx.com" style="box-sizing: border-box; background-color: transparent; color: rgb(3, 102, 214); text-decoration-line: none;">git@xxx.com</a></p></blockquote><p data-source-line="14" style="box-sizing: border-box; margin-top: 0px; color: rgb(36, 41, 46); font-family: -apple-system, BlinkMacSystemFont, å¾®è½¯é›…é»‘, &quot;PingFang SC&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, SimSun, å®‹ä½“, Heiti, é»‘ä½“, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); margin-bottom: 0px !important;">okï¼</p><p><br/></p>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLè§¦å‘å™¨</title>
    <link href="/2018/04/18/152/"/>
    <url>/2018/04/18/152/</url>
    
    <content type="html"><![CDATA[<p>å»å¹´å¹´åº•åšæ–°åŠŸèƒ½æ—¶è€ƒè™‘ä½¿ç”¨è§¦å‘å™¨ï¼Œæ¥èŠèŠè§¦å‘å™¨ã€‚</p><p>è§¦å‘å™¨æ˜¯ä¸è¡¨æœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼Œåœ¨æ»¡è¶³å®šä¹‰æ¡ä»¶æ—¶è§¦å‘ï¼Œå¹¶æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„è¯­å¥é›†åˆã€‚è§¦å‘å™¨çš„è¿™ç§ç‰¹æ€§å¯ä»¥ååŠ©åº”ç”¨åœ¨æ•°æ®åº“ç«¯ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><div class="code-wrapper"><pre><code class="sql">DELIMITER;;//å®šä¹‰ç»“æŸç¬¦CREATE TRIGGER `updateData` AFTER UPDATE ON `buyer` FOR EACH ROW begin    set @phone = right(new.phone,11); // å–æ‰‹æœºå·    set @main_id = (select id from main where u_id = new.u_id); // ä»è¡¨mainå–id    set @new_last_trade_time = IF( UNIX_TIMESTAMP(new.last_trade_time) &amp;gt; @old_last_trade_time, UNIX_TIMESTAMP(new.last_trade_time), @old_last_trade_time);    set @add_trade_count = (new.trade_count - old.trade_count);    set @add_trade_amount = (new.trade_amount - old.trade_amount);    // æ›´æ–°æ“ä½œ    update member set         trade_count=trade_count+@add_trade_count,        trade_amount=trade_amount+@add_trade_amount,        last_trade_time=@new_last_trade_time      where main_id = @main_id and phone = @phone;end;;DELIMITER ;æ€§èƒ½é—®é¢˜ï¼šé€šè¿‡æµ‹è¯•ï¼Œè‹¥æˆ‘æ¯ç§’é’Ÿå‘æ•°æ®åº“ä¸­æ’å…¥700æ¡å·¦å³çš„å‘Šè­¦ä¿¡æ¯ï¼Œæ­¤æ—¶è‹¥ä½¿ç”¨è§¦å‘å™¨ï¼Œæ¯ç§’ä¸­åªä¼šæ’å…¥æ•°æ®åº“ä¸­50å·¦å³ï¼Œè‹¥ä¸å¼€å¯è§¦å‘å™¨ï¼Œé‚£ä¹ˆ700æ¡å…¨éƒ¨å¯ä»¥æ’å…¥æ•°æ®åº“ä¸­ã€‚ï¼ˆæ¥è‡ªç½‘ç»œï¼‰</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>selfå’Œstatic</title>
    <link href="/2017/12/07/142/"/>
    <url>/2017/12/07/142/</url>
    
    <content type="html"><![CDATA[<blockquote><p>PHPå®˜æ–¹ä¹Ÿè¯´è¿‡ï¼Œå¤§æ¦‚æ˜¯è¯´selfè°ƒç”¨çš„å°±æ˜¯æœ¬èº«ä»£ç ç‰‡æ®µè¿™ä¸ªç±»ï¼Œè€Œstaticè°ƒç”¨çš„æ˜¯ä»å †å†…å­˜ä¸­æå–å‡ºæ¥ï¼Œè®¿é—®çš„æ˜¯å½“å‰å®ä¾‹åŒ–çš„é‚£ä¸ªç±»ï¼Œé‚£ä¹ˆ static ä»£è¡¨çš„å°±æ˜¯é‚£ä¸ªç±»ã€‚</p></blockquote><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span><span class="hljs-class"></span>&#123;      <span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;This is class A&quot;</span>;      <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStr</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;                <span class="hljs-keyword">echo</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$str</span>;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span></span><span class="hljs-class"></span>&#123;      <span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;This is class B&quot;</span>;&#125;B::getStr();<span class="hljs-comment">// è¾“å‡ºThis is class A</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span><span class="hljs-class"></span>&#123;      <span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;This is class A&quot;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStr</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;              <span class="hljs-keyword">echo</span> <span class="hljs-built_in">static</span>::<span class="hljs-variable">$str</span>;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span></span><span class="hljs-class"></span>&#123;      <span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;This is class B&quot;</span>;&#125;B::getStr();<span class="hljs-comment">// è¾“å‡ºThis is class B</span></code></pre></div><h2 id="self-å°±æ˜¯è¿™ä¸ªç±»ï¼Œæ˜¯ä»£ç æ®µé‡Œé¢çš„è¿™ä¸ªç±»ã€‚"><a href="#self-å°±æ˜¯è¿™ä¸ªç±»ï¼Œæ˜¯ä»£ç æ®µé‡Œé¢çš„è¿™ä¸ªç±»ã€‚" class="headerlink" title="self - å°±æ˜¯è¿™ä¸ªç±»ï¼Œæ˜¯ä»£ç æ®µé‡Œé¢çš„è¿™ä¸ªç±»ã€‚"></a>self - å°±æ˜¯è¿™ä¸ªç±»ï¼Œæ˜¯ä»£ç æ®µé‡Œé¢çš„è¿™ä¸ªç±»ã€‚</h2><p>static - PHP 5.3æ–°ç‰¹æ€§ã€‚å½“å‰è¿™ä¸ªç±»ï¼Œæœ‰ç‚¹åƒ$thisçš„æ„æ€ï¼Œä»å †å†…å­˜ä¸­æå–å‡ºæ¥ï¼Œè®¿é—®çš„æ˜¯å½“å‰å®ä¾‹åŒ–çš„é‚£ä¸ªç±»ï¼Œé‚£ä¹ˆ static ä»£è¡¨çš„å°±æ˜¯é‚£ä¸ªç±»ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span><span class="hljs-class"></span>&#123;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelf</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>();    &#125;            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStatic</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">static</span>();    &#125;&#125;<span class="hljs-variable">$f</span> = <span class="hljs-keyword">new</span> A();<span class="hljs-keyword">print</span> get_class(<span class="hljs-variable">$f</span>-&gt;getSelf());<span class="hljs-keyword">print</span> get_class(<span class="hljs-variable">$f</span>-&gt;getStatic());<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span></span>&#123;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelf2</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>();    &#125;            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStatic2</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">static</span>();    &#125;&#125;<span class="hljs-variable">$f</span> = <span class="hljs-keyword">new</span> B();<span class="hljs-keyword">print</span> get_class(<span class="hljs-variable">$f</span>-&gt;getSelf());<span class="hljs-keyword">print</span> get_class(<span class="hljs-variable">$f</span>-&gt;getStatic());<span class="hljs-keyword">print</span> get_class(<span class="hljs-variable">$f</span>-&gt;getSelf2());<span class="hljs-keyword">print</span> get_class(<span class="hljs-variable">$f</span>-&gt;getStatic2());<span class="hljs-comment">// è¾“å‡ºAAABBB</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2017/11/17/141/"/>
    <url>/2017/11/17/141/</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æ²¡ç”¨è¿‡gitï¼Œè¿˜åœ¨æŒç»­è¸©å‘ä¸­ï¼Œåç»­ç»§ç»­æ›´æ–°ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><hr><h4 id="åˆ—å‡ºtag"><a href="#åˆ—å‡ºtag" class="headerlink" title="åˆ—å‡ºtag"></a>åˆ—å‡ºtag</h4><blockquote><p>git tag # åœ¨æ§åˆ¶å°æ‰“å°å‡ºå½“å‰ä»“åº“çš„æ‰€æœ‰tag&gt; git tag -l â€˜v0.1.*â€™ # æœç´¢ç¬¦åˆæ¨¡å¼çš„Tag æ‰“tag</p></blockquote><p>git tagåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šè½»é‡tagå’Œé™„æ³¨tagã€‚è½»é‡tagæ˜¯æŒ‡å‘æäº¤å¯¹è±¡çš„å¼•ç”¨ï¼Œé™„æ³¨Tagåˆ™æ˜¯ä»“åº“ä¸­çš„ä¸€ä¸ªç‹¬ç«‹å¯¹è±¡ã€‚å»ºè®®ä½¿ç”¨é™„æ³¨Tagã€‚</p><h4 id="åˆ›å»ºè½»é‡Tag"><a href="#åˆ›å»ºè½»é‡Tag" class="headerlink" title="åˆ›å»ºè½»é‡Tag"></a>åˆ›å»ºè½»é‡Tag</h4><blockquote><p>git tag v0.1.2-light</p></blockquote><h4 id="åˆ›å»ºé™„æ³¨Tag"><a href="#åˆ›å»ºé™„æ³¨Tag" class="headerlink" title="åˆ›å»ºé™„æ³¨Tag"></a>åˆ›å»ºé™„æ³¨Tag</h4><blockquote><p>git tag -a v0.1.2 -m â€œ0.1.2ç‰ˆæœ¬â€</p></blockquote><p>åˆ›å»ºè½»é‡Tagä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œç›´æ¥æŒ‡å®šTagåç§°å³å¯ã€‚</p><p>åˆ›å»ºé™„æ³¨Tagæ—¶ï¼Œå‚æ•°aå³annotatedçš„ç¼©å†™ï¼ŒæŒ‡å®šTagç±»å‹ï¼Œåé™„Tagåã€‚å‚æ•°mæŒ‡å®šTagè¯´æ˜ï¼Œè¯´æ˜ä¿¡æ¯ä¼šä¿å­˜åœ¨Tagå¯¹è±¡ä¸­ã€‚</p><h4 id="åˆ‡æ¢åˆ°Tag"><a href="#åˆ‡æ¢åˆ°Tag" class="headerlink" title="åˆ‡æ¢åˆ°Tag"></a>åˆ‡æ¢åˆ°Tag</h4><p>ä¸åˆ‡æ¢åˆ†æ”¯å‘½ä»¤ç›¸åŒï¼Œç”¨</p><blockquote><p>git checkout [tagname]</p></blockquote><h4 id="æŸ¥çœ‹Tagä¿¡æ¯"><a href="#æŸ¥çœ‹Tagä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹Tagä¿¡æ¯"></a>æŸ¥çœ‹Tagä¿¡æ¯</h4><p>ç”¨git showå‘½ä»¤å¯ä»¥æŸ¥çœ‹Tagçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><blockquote><p>git show v0.1.2</p></blockquote><h4 id="åˆ é™¤Tag"><a href="#åˆ é™¤Tag" class="headerlink" title="åˆ é™¤Tag"></a>åˆ é™¤Tag</h4><p>è¯¯æ‰“æˆ–éœ€è¦ä¿®æ”¹Tagæ—¶ï¼Œéœ€è¦å…ˆå°†Tagåˆ é™¤ï¼Œå†æ‰“æ–°Tagã€‚</p><blockquote><p>git tag -d v0.1.2 # åˆ é™¤Tag</p></blockquote><p>å‚æ•°då³deleteçš„ç¼©å†™ï¼Œæ„ä¸ºåˆ é™¤å…¶åæŒ‡å®šçš„Tagã€‚</p><p>ç»™æŒ‡å®šçš„commitæ‰“Tag æ‰“Tagä¸å¿…è¦åœ¨headä¹‹ä¸Šï¼Œä¹Ÿå¯åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸Šæ‰“ï¼Œè¿™éœ€è¦ä½ çŸ¥é“æŸä¸ªæäº¤å¯¹è±¡çš„æ ¡éªŒå’Œï¼ˆé€šè¿‡git logè·å–ï¼‰ã€‚</p><h4 id="è¡¥æ‰“Tag"><a href="#è¡¥æ‰“Tag" class="headerlink" title="è¡¥æ‰“Tag"></a>è¡¥æ‰“Tag</h4><blockquote><p>git tag -a v0.1.1 9fbc3d0</p></blockquote><p>Tagæ¨é€åˆ°æœåŠ¡å™¨ é€šå¸¸çš„git pushä¸ä¼šå°†Tagå¯¹è±¡æäº¤åˆ°gitæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ˜¾å¼çš„æ“ä½œï¼š</p><blockquote><p>git push origin v0.1.2 # å°†v0.1.2 Tagæäº¤åˆ°gitæœåŠ¡å™¨&gt; git push origin â€“-tags # å°†æœ¬åœ°æ‰€æœ‰Tagä¸€æ¬¡æ€§æäº¤åˆ°gitæœåŠ¡å™¨</p></blockquote><p>æ³¨æ„ï¼šå¦‚æœæƒ³çœ‹ä¹‹å‰æŸä¸ªTagçŠ¶æ€ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·æ“ä½œ</p><ol><li><p> git tag æŸ¥çœ‹å½“å‰åˆ†æ”¯ä¸‹çš„Tag</p></li><li><p> git checkout v0.21 æ­¤æ—¶ä¼šæŒ‡å‘æ‰“v0.21 Tagæ—¶çš„ä»£ç çŠ¶æ€ï¼Œï¼ˆä½†ç°åœ¨å¤„äºä¸€ä¸ªç©ºçš„åˆ†æ”¯ä¸Šï¼‰</p></li></ol><h4 id="åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag"><a href="#åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag" class="headerlink" title="åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag"></a>åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag</h4><p>åœ¨Git v1.7.0 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p><blockquote><p>git push origin â€“delete <branchName></p></blockquote><p>åˆ é™¤tagè¿™ä¹ˆç”¨ï¼š</p><blockquote><p>git push origin â€“delete tag <tagname></p></blockquote><p>å¦åˆ™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºåˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ï¼Œå…¶å®å°±ç›¸å½“äºåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p><blockquote><p>git push origin :<branchName></p></blockquote><p>è¿™æ˜¯åˆ é™¤tagçš„æ–¹æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºtagåˆ°è¿œç¨‹tagï¼š</p><blockquote><p>git tag -d <tagname>&gt; git push origin :refs/tags/<tagname></p></blockquote><h4 id="é‡å‘½åè¿œç¨‹åˆ†æ”¯"><a href="#é‡å‘½åè¿œç¨‹åˆ†æ”¯" class="headerlink" title="é‡å‘½åè¿œç¨‹åˆ†æ”¯"></a>é‡å‘½åè¿œç¨‹åˆ†æ”¯</h4><p>åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p><blockquote><p>git push â€“delete origin devel</p></blockquote><p>é‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼š</p><blockquote><p>git branch -m devel develop</p></blockquote><p>æ¨é€æœ¬åœ°åˆ†æ”¯ï¼š</p><blockquote><p>git push origin develop</p></blockquote><h4 id="æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹"><a href="#æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹" class="headerlink" title="æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹"></a>æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹</h4><blockquote><p>git push â€“tags # æ¨é€æ‰€æœ‰tag&gt; git push origin :tag # æ¨é€tag</p></blockquote><p>â€”â€” 2017/12/04</p><hr><ol><li> å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰</li></ol><p>å°±æ˜¯ä½ åœ¨ç”µè„‘é‡Œèƒ½çœ‹åˆ°çš„ç›®å½•ï¼Œæ¯”å¦‚æˆ‘çš„gitæ–‡ä»¶å¤¹å°±æ˜¯ä¸€ä¸ªå·¥ä½œåŒºã€‚</p><ol><li> ç‰ˆæœ¬åº“ï¼ˆRepositoryï¼‰</li></ol><p>å·¥ä½œåŒºæœ‰ä¸€ä¸ªéšè—ç›®å½•.gitï¼Œè¿™ä¸ªä¸ç®—å·¥ä½œåŒºï¼Œè€Œæ˜¯Gitçš„ç‰ˆæœ¬åº“ã€‚</p><ol><li> æš‚å­˜åŒº</li></ol><p>Gitçš„ç‰ˆæœ¬åº“é‡Œå­˜äº†å¾ˆå¤šä¸œè¥¿ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ç§°ä¸ºstageï¼ˆæˆ–è€…å«indexï¼‰çš„æš‚å­˜åŒºï¼Œè¿˜æœ‰Gitä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„ç¬¬ä¸€ä¸ªåˆ†æ”¯masterï¼Œä»¥åŠæŒ‡å‘masterçš„ä¸€ä¸ªæŒ‡é’ˆå«HEADã€‚</p><blockquote><p>git addæŠŠæ–‡ä»¶æ·»åŠ è¿›å»ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠæ–‡ä»¶ä¿®æ”¹æ·»åŠ åˆ°æš‚å­˜åŒºï¼› git commitæäº¤æ›´æ”¹ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠæš‚å­˜åŒºçš„æ‰€æœ‰å†…å®¹æäº¤åˆ°å½“å‰åˆ†æ”¯ã€‚</p></blockquote><table data-source-line="20"><thead style="box-sizing: border-box;"><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);" class="firstRow"><th style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å‘½ä»¤</th><th style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">è¯´æ˜</th></tr></thead><tbody style="box-sizing: border-box;"><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git clone</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å…‹éš†</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git branch (åˆ†æ”¯å)</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">åˆ›å»ºåˆ†æ”¯ -Dåˆ é™¤åˆ†æ”¯</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git checkout (åˆ†æ”¯å)</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">åˆ‡æ¢åˆ†æ”¯ -båˆ›å»ºå¹¶åˆ‡æ¢</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git checkout (æ–‡ä»¶å)</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">æ’¤é”€æ­¤æ–‡ä»¶ä¿®æ”¹</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git add</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git status</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">æŸ¥çœ‹åœ¨ä½ ä¸Šæ¬¡æäº¤ä¹‹åæ˜¯å¦æœ‰ä¿®æ”¹</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git commit</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å°†ç¼“å­˜åŒºå†…å®¹æ·»åŠ åˆ°ä»“åº“ä¸­</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git diff</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">æ¥æŸ¥çœ‹æ‰§è¡Œ git status çš„ç»“æœçš„è¯¦ç»†ä¿¡æ¯</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git reset HEAD</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å‘½ä»¤ç”¨äºå–æ¶ˆå·²ç¼“å­˜çš„å†…å®¹</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git rm æ–‡ä»¶</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">åˆ é™¤æ–‡ä»¶-få¼ºåˆ¶åˆ é™¤</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git mv</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">ç§»åŠ¨æ–‡ä»¶</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git merge</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">åˆå¹¶åˆ†æ”¯</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git fetch</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git push <è¿œç¨‹ä¸»æœºå> <æœ¬åœ°åˆ†æ”¯å>:<è¿œç¨‹åˆ†æ”¯å></td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°ï¼Œæ¨é€åˆ°è¿œç¨‹ä¸»æœº</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git push origin --delete test</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">åˆ é™¤è¿œç¨‹åˆ†æ”¯test</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git pull <è¿œç¨‹ä¸»æœºå> <è¿œç¨‹åˆ†æ”¯å>:<æœ¬åœ°åˆ†æ”¯å></td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å°†è¿œç¨‹å­˜å‚¨åº“ä¸­çš„æ›´æ”¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git rebase</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å‘½ä»¤åœ¨å¦ä¸€ä¸ªåˆ†æ”¯åŸºç¡€ä¹‹ä¸Šé‡æ–°åº”ç”¨ï¼Œç”¨äºæŠŠä¸€ä¸ªåˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git log</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å‘½ä»¤ç”¨äºæ˜¾ç¤ºæäº¤æ—¥å¿—ä¿¡æ¯ã€‚</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git reflog</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">æ˜¾ç¤ºæ¯ä¸€æ¬¡å‘½ä»¤</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git revert</td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">ç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤é”€æŸæ¬¡æäº¤ï¼Œæ­¤æ¬¡æäº¤ä¹‹å‰çš„commitéƒ½ä¼šè¢«ä¿ç•™</td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);"><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">git reset HEAD <file></td><td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">å¦‚æœå‘ç°é”™è¯¯çš„å°†ä¸æƒ³æš‚å­˜çš„æ–‡ä»¶è¢«git addè¿›å…¥ç´¢å¼•ä¹‹åï¼Œæƒ³å›é€€å–æ¶ˆï¼Œåˆ™å¯ä»¥ä½¿ç”¨</td></tr></tbody></table><h3 id="è®¾ç½®ç”¨æˆ·åé‚®ç®±ï¼š"><a href="#è®¾ç½®ç”¨æˆ·åé‚®ç®±ï¼š" class="headerlink" title="è®¾ç½®ç”¨æˆ·åé‚®ç®±ï¼š"></a>è®¾ç½®ç”¨æˆ·åé‚®ç®±ï¼š</h3><blockquote><p>git config â€“global user.name â€œ13saiâ€</p></blockquote><blockquote><p>git config â€“global user.email â€œ<a href="mailto:&#57;&#x35;&#55;&#x30;&#x34;&#x32;&#55;&#56;&#49;&#x40;&#113;&#x71;&#46;&#99;&#x6f;&#109;">&#57;&#x35;&#55;&#x30;&#x34;&#x32;&#55;&#56;&#49;&#x40;&#113;&#x71;&#46;&#99;&#x6f;&#109;</a>â€œ</p></blockquote><div class="code-wrapper"><pre><code class="hljs vim">fata<span class="hljs-variable">l:</span> No configured push destination.è§£å†³ï¼š$ git remote <span class="hljs-built_in">add</span> -<span class="hljs-keyword">f</span> -t master -<span class="hljs-keyword">m</span> master origin gi<span class="hljs-variable">t:</span>//example.<span class="hljs-keyword">com</span>/git.git/fata<span class="hljs-variable">l:</span> The current branch test <span class="hljs-built_in">has</span> <span class="hljs-keyword">no</span> upstream branch.è§£å†³ï¼šgit push --<span class="hljs-keyword">set</span>-upstream origin testæ¨¡ä»¿ git cloneï¼Œä½†åªè·Ÿè¸ªé€‰å®šçš„åˆ†æ”¯$ <span class="hljs-built_in">mkdir</span> project.git$ <span class="hljs-keyword">cd</span> project.git$ git init$ git remote <span class="hljs-built_in">add</span> -<span class="hljs-keyword">f</span> -t master -<span class="hljs-keyword">m</span> master origin gi<span class="hljs-variable">t:</span>//example.<span class="hljs-keyword">com</span>/git.git/$ git merge originfatalï¼šUnable <span class="hljs-keyword">to</span> create <span class="hljs-string">&#x27;E:/project/scrm/.git/index.lock&#x27;</span>: File <span class="hljs-built_in">exists</span>.rm -<span class="hljs-keyword">f</span> ./.git/<span class="hljs-built_in">index</span>.lock</code></pre></div><div class="code-wrapper"><pre><code class="hljs applescript">git <span class="hljs-built_in">log</span>-p æŸ¥çœ‹å·®å¼‚-n(nä¸ºæ­£æ•´æ•°) æŸ¥çœ‹æœ€è¿‘næ¬¡çš„æäº¤<span class="hljs-comment">--pretty    æŒ‰æŒ‡å®šæ ¼å¼æ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯,å¯é€‰é¡¹æœ‰ï¼šoneline,short,medium,full,fuller,email,rawä»¥åŠformat:&lt;string&gt;,é»˜è®¤ä¸ºmediumï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æŒ‡å®šé»˜è®¤çš„æ–¹å¼ã€‚</span>e.g. git <span class="hljs-built_in">log</span> (<span class="hljs-comment">--pretty=)oneline</span><span class="hljs-comment">--stat  åˆ—å‡ºæ–‡ä»¶çš„ä¿®æ”¹è¡Œæ•°</span><span class="hljs-comment">--sortstat      åªæ˜¾ç¤º--statä¸­æœ€åè¡Œæ•°ä¿®æ”¹æ·»åŠ ç§»é™¤çš„ç»Ÿè®¡</span><span class="hljs-comment">--graph ä»¥ç®€å•çš„å›¾å½¢æ–¹å¼åˆ—å‡ºæäº¤è®°å½•</span><span class="hljs-comment">--abbrev-commit ä»…æ˜¾ç¤º SHA-1 çš„å‰å‡ ä¸ªå­—ç¬¦ï¼Œè€Œéæ‰€æœ‰çš„ 40 ä¸ªå­—ç¬¦ã€‚</span><span class="hljs-comment">--relative-date ä½¿ç”¨è¾ƒçŸ­çš„ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆæ¯”å¦‚ï¼Œâ€œ2 weeks agoâ€ï¼‰ã€‚</span><span class="hljs-comment">--name-only ä»…åœ¨æäº¤ä¿¡æ¯åæ˜¾ç¤ºå·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•ã€‚</span><span class="hljs-comment">--name-status æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶æ¸…å•ã€‚</span></code></pre></div><p>â€”â€”2017/12/01</p><hr><table ><thead ><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);" class="firstRow">    <th style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å‘½ä»¤    </th>    <th style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        è¯´æ˜    </th></tr></thead><tbody ><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git clone    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å…‹éš†    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git branch (åˆ†æ”¯å)    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        åˆ›å»ºåˆ†æ”¯ -Dåˆ é™¤åˆ†æ”¯    </td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git checkout (åˆ†æ”¯å)    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        åˆ‡æ¢åˆ†æ”¯ -båˆ›å»ºå¹¶åˆ‡æ¢    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git add    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜    </td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git status    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        æŸ¥çœ‹åœ¨ä½ ä¸Šæ¬¡æäº¤ä¹‹åæ˜¯å¦æœ‰ä¿®æ”¹    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git commit    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å°†ç¼“å­˜åŒºå†…å®¹æ·»åŠ åˆ°ä»“åº“ä¸­    </td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git diff    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        æ¥æŸ¥çœ‹æ‰§è¡Œ git status çš„ç»“æœçš„è¯¦ç»†ä¿¡æ¯    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git reset HEAD    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å‘½ä»¤ç”¨äºå–æ¶ˆå·²ç¼“å­˜çš„å†…å®¹    </td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git rm æ–‡ä»¶    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        åˆ é™¤æ–‡ä»¶-få¼ºåˆ¶åˆ é™¤    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git mv    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        ç§»åŠ¨æ–‡ä»¶    </td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git merge    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        åˆå¹¶åˆ†æ”¯    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git fetch    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°    </td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git push <è¿œç¨‹ä¸»æœºå><æœ¬åœ°åˆ†æ”¯å>:<è¿œç¨‹åˆ†æ”¯å>    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°ï¼Œæ¨é€åˆ°è¿œç¨‹ä¸»æœº    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git push origin --delete test    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        åˆ é™¤è¿œç¨‹åˆ†æ”¯test    </td></tr><tr style="box-sizing: border-box; border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git pull <è¿œç¨‹ä¸»æœºå><è¿œç¨‹åˆ†æ”¯å>:<æœ¬åœ°åˆ†æ”¯å>    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å°†è¿œç¨‹å­˜å‚¨åº“ä¸­çš„æ›´æ”¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­    </td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top: 1px solid rgb(198, 203, 209);">    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        git rebase    </td>    <td style="box-sizing: border-box; padding: 6px 13px; border-color: rgb(223, 226, 229); word-break: break-all;">        å‘½ä»¤åœ¨å¦ä¸€ä¸ªåˆ†æ”¯åŸºç¡€ä¹‹ä¸Šé‡æ–°åº”ç”¨ï¼Œç”¨äºæŠŠä¸€ä¸ªåˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚    </td></tr></tbody></table><div class="code-wrapper"><pre><code class="hljs gams">fatal: <span class="hljs-keyword">No</span> configured push destination.è§£å†³ï¼š<span class="hljs-symbol">$</span> git remote add -f -t master -m master origin git:<span class="hljs-comment">//example.com/git.git/</span>fatal: The current branch test has <span class="hljs-keyword">no</span> upstream branch.è§£å†³ï¼šgit push --<span class="hljs-keyword">set</span>-upstream <span class="hljs-comment">origin test</span>æ¨¡ä»¿ git <span class="hljs-comment">clone</span>ï¼Œä½†åªè·Ÿè¸ªé€‰å®šçš„åˆ†æ”¯$ mkdir <span class="hljs-comment">project.git</span>$ cd <span class="hljs-comment">project.git</span>$ git <span class="hljs-comment">init</span>$ git <span class="hljs-comment">remote add -f -t master -m master origin git:</span>//<span class="hljs-comment">example.com</span>/git.git/$ git <span class="hljs-comment">merge origin</span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆè¯†gulp</title>
    <link href="/2017/11/12/140/"/>
    <url>/2017/11/12/140/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ gulp ä¹‹å‰è¯·å®‰è£…å¥½nodeå’Œnpmï¼Œä¸ºäº†é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç”¨cnpmã€‚</p><h2 id="å…¨å±€å®‰è£…"><a href="#å…¨å±€å®‰è£…" class="headerlink" title="å…¨å±€å®‰è£…"></a>å…¨å±€å®‰è£…</h2><blockquote><p>cnpm install gulp -g</p></blockquote><blockquote><p>glup -v // è¾“å…¥ç‰ˆæœ¬ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚</p></blockquote><h2 id="æ–°å»ºpackage-json"><a href="#æ–°å»ºpackage-json" class="headerlink" title="æ–°å»ºpackage.json"></a>æ–°å»ºpackage.json</h2><div class="code-wrapper"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;sai&quot;</span>,<span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0&quot;</span>,<span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;gulp css!&quot;</span>,<span class="hljs-attr">&quot;author&quot;</span>: &#123;<span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;13sai&quot;</span>,<span class="hljs-attr">&quot;email&quot;</span>: <span class="hljs-string">&quot;95742781@qq.com&quot;</span>&#125;,<span class="hljs-attr">&quot;license&quot;</span>: <span class="hljs-string">&quot;MIT&quot;</span>,<span class="hljs-attr">&quot;devDependencies&quot;</span>: &#123;<span class="hljs-attr">&quot;gulp&quot;</span>: <span class="hljs-string">&quot;^3.9.1&quot;</span>,<span class="hljs-attr">&quot;gulp-minify-css&quot;</span>: <span class="hljs-string">&quot;^1.2.4&quot;</span>&#125;&#125;</code></pre></div><h2 id="æœ¬åœ°å®‰è£…gulpï¼Œgulp-minify-cssã€‚"><a href="#æœ¬åœ°å®‰è£…gulpï¼Œgulp-minify-cssã€‚" class="headerlink" title="æœ¬åœ°å®‰è£…gulpï¼Œgulp-minify-cssã€‚"></a>æœ¬åœ°å®‰è£…gulpï¼Œgulp-minify-cssã€‚</h2><div class="code-wrapper"><pre><code class="hljs q">cnpm install gulp --<span class="hljs-built_in">save</span>-<span class="hljs-built_in">dev</span> cnpm install gulp-minify-css --<span class="hljs-built_in">save</span>-<span class="hljs-built_in">dev</span></code></pre></div><h2 id="æ–°å»ºgulpfile-js"><a href="#æ–°å»ºgulpfile-js" class="headerlink" title="æ–°å»ºgulpfile.js"></a>æ–°å»ºgulpfile.js</h2><div class="code-wrapper"><pre><code class="hljs awk">var gulp = require(<span class="hljs-string">&#x27;gulp&#x27;</span>),    mincss = require(<span class="hljs-string">&#x27;gulp-minify-css&#x27;</span>);<span class="hljs-regexp">//</span>å®šä¹‰ä¸€ä¸ªsaiä»»åŠ¡gulp.task(<span class="hljs-string">&#x27;sai&#x27;</span>, <span class="hljs-keyword">function</span> () &#123;    gulp.src(<span class="hljs-string">&#x27;assets/css/*.css&#x27;</span>) <span class="hljs-regexp">//</span>è¯¥ä»»åŠ¡é’ˆå¯¹çš„æ–‡ä»¶        .pipe(mincss()) <span class="hljs-regexp">//</span>è¯¥ä»»åŠ¡è°ƒç”¨çš„æ¨¡å—        .pipe(gulp.dest(<span class="hljs-string">&#x27;assets/mini&#x27;</span>)); <span class="hljs-regexp">//</span>å°†ä¼šåœ¨assets/miniä¸‹ç”Ÿæˆcss&#125;); gulp.task(<span class="hljs-string">&#x27;default&#x27;</span>,[<span class="hljs-string">&#x27;sai&#x27;</span>]); <span class="hljs-regexp">//</span>å®šä¹‰é»˜è®¤ä»»åŠ¡</code></pre></div><h2 id="cmdæ‰§è¡Œgulp"><a href="#cmdæ‰§è¡Œgulp" class="headerlink" title="cmdæ‰§è¡Œgulp"></a>cmdæ‰§è¡Œgulp</h2><blockquote><p>gulp</p></blockquote><p>ä¼šçœ‹åˆ°ä»»åŠ¡saiå¼€å§‹ï¼Œå®Œæˆï¼Œè¿™æ ·å°±å®Œæˆäº†gulpå‹ç¼©cssã€‚</p><p>æ­¤å¤–ï¼Œgulpè¿˜å¯ä»¥å‹ç¼©jsï¼Œimgã€‚</p>]]></content>
    
    
    <categories>
      
      <category>js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gulp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SVNæœåŠ¡å™¨ä¸webç«™ç‚¹ä»£ç åŒæ­¥æ›´æ–°</title>
    <link href="/2017/10/09/138/"/>
    <url>/2017/10/09/138/</url>
    
    <content type="html"><![CDATA[<p>å› ä¸ºSVNæœåŠ¡å™¨ä¸webç«™ç‚¹ä»£ç æ˜¯æ”¾åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•æ¥åšä¸€ä¸ªåŒæ­¥æ›´æ–°ã€‚</p><p>ä½†æ˜¯æ–‡ä»¶ä¸Šä¼ åˆ°SVNç‰ˆæœ¬åº“å,ä¸Šä¼ çš„æ–‡ä»¶ä¸å†ä»¥æ–‡ä»¶åŸæ¥çš„æ ¼å¼å­˜å‚¨,è€Œæ˜¯è¢«svnä»¥å®ƒè‡ªå®šä¹‰çš„æ ¼å¼å‹ç¼©æˆç‰ˆæœ¬åº“æ•°æ®,å­˜æ”¾åœ¨ç‰ˆæœ¬åº“ä¸­ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å°±é€‰æ‹©ä½¿ç”¨SVNè‡ªå¸¦çš„hooksæ¥åšwebç«™ç‚¹ä»£ç æ›´æ–°ã€‚</p><p>è¿›å…¥å¯¹åº”ç‰ˆæœ¬åº“ä¸‹çš„hooksç›®å½•ï¼Œå¤åˆ¶ post-commit.tmplä¸ºpost-commitã€‚</p><p>æ‰“å¼€ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs awk">export.UTF-<span class="hljs-number">8</span> REPOS=<span class="hljs-string">&quot;$1&quot;</span> REV=<span class="hljs-string">&quot;$2&quot;</span> SVN_PATH=<span class="hljs-regexp">/usr/</span>bin/svn <span class="hljs-comment">#æ³¨æ„ï¼Œæ­¤å¤„æ˜¯svnå‘½ä»¤ç›®å½• </span>WEB_PATH=<span class="hljs-regexp">/web/</span>trunk <span class="hljs-comment">#ç«™ç‚¹ç›®å½• </span>LOG_PATH=<span class="hljs-regexp">/home/</span>svn<span class="hljs-regexp">/trunk/</span>svn.log echo <span class="hljs-string">&quot;##########å¼€å§‹æäº¤ &quot;</span> `date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>` <span class="hljs-string">&#x27;##################&#x27;</span> &gt;&gt; <span class="hljs-variable">$LOG_PATH</span> <span class="hljs-variable">$SVN_PATH</span> update --username <span class="hljs-number">13</span>sai --password <span class="hljs-number">123456</span> <span class="hljs-variable">$WEB_PATH</span> --no-auth-cache &gt;&gt; <span class="hljs-variable">$LOG_PATH</span></code></pre></div><p>è®°å¾—è¦ä¿®æ”¹ä¸‹post-commitçš„æ‰§è¡Œæƒé™ï¼Œç„¶åæµ‹è¯•ï¼Œå¦‚æœæˆåŠŸäº†ï¼Œé‚£æ­å–œä½ ï¼</p>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>svn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxæ­å»ºsvnæœåŠ¡å™¨</title>
    <link href="/2017/10/09/137/"/>
    <url>/2017/10/09/137/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒï¼šcentos6-3"><a href="#ç¯å¢ƒï¼šcentos6-3" class="headerlink" title="ç¯å¢ƒï¼šcentos6.3"></a>ç¯å¢ƒï¼šcentos6.3</h2><h3 id="å®‰è£…svn"><a href="#å®‰è£…svn" class="headerlink" title="å®‰è£…svn"></a>å®‰è£…svn</h3><blockquote><p>yum install subversion</p></blockquote><h3 id="åˆ›å»ºç‰ˆæœ¬åº“"><a href="#åˆ›å»ºç‰ˆæœ¬åº“" class="headerlink" title="åˆ›å»ºç‰ˆæœ¬åº“"></a>åˆ›å»ºç‰ˆæœ¬åº“</h3><blockquote><p>svnadmin create /home/repo  //æ–‡ä»¶ç›®å½•è‡ªå·±è®¾ç½®</p></blockquote><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><blockquote><p>cd /home/repo/conf    // è¿›å…¥ç›®å½•</p></blockquote><p>é…ç½®ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶</p><div class="code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">authz</span> æƒé™passwd è´¦å·å¯†ç svnserve.conf ç‰ˆæœ¬åº“é…ç½®</code></pre></div><p>ç¼–è¾‘ç”¨æˆ·æ–‡ä»¶passwdï¼Œæ–°å¢ä¸¤ä¸ªç”¨æˆ·ï¼šadminå’Œguestã€‚</p><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[users]</span><span class="hljs-attr">admin</span> = <span class="hljs-number">111111</span><span class="hljs-attr">guest</span> = <span class="hljs-number">123456</span></code></pre></div><p>ç¼–è¾‘æƒé™æ–‡ä»¶authzï¼Œç”¨æˆ·adminè®¾ç½®å¯è¯»å†™æƒé™ï¼Œguestè®¾ç½®åªè¯»æƒé™ã€‚</p><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[/]</span><span class="hljs-attr">admin</span> = rw<span class="hljs-attr">guest</span> = r</code></pre></div><p>ç¼–è¾‘svnserve.confï¼š</p><div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[general]</span><span class="hljs-attr">anon-access</span> = none                     <span class="hljs-comment">#æ§åˆ¶éé‰´æƒç”¨æˆ·è®¿é—®ç‰ˆæœ¬åº“çš„æƒé™</span><span class="hljs-attr">auth-access</span> = write                    <span class="hljs-comment">#æ§åˆ¶é‰´æƒç”¨æˆ·è®¿é—®ç‰ˆæœ¬åº“çš„æƒé™</span><span class="hljs-attr">password-db</span> = passwd                   <span class="hljs-comment">#æŒ‡å®šç”¨æˆ·åå£ä»¤æ–‡ä»¶å</span><span class="hljs-attr">authz-db</span> = authz                       <span class="hljs-comment">#æŒ‡å®šæƒé™é…ç½®æ–‡ä»¶å</span><span class="hljs-attr">realm</span> = repo                           <span class="hljs-comment">#æŒ‡å®šç‰ˆæœ¬åº“çš„è®¤è¯åŸŸï¼Œå³åœ¨ç™»å½•æ—¶æç¤ºçš„è®¤è¯åŸŸåç§°</span></code></pre></div><h3 id="é…ç½®ipï¼Œæ‰“å¼€3369ç«¯å£å¹¶é‡å¯"><a href="#é…ç½®ipï¼Œæ‰“å¼€3369ç«¯å£å¹¶é‡å¯" class="headerlink" title="é…ç½®ipï¼Œæ‰“å¼€3369ç«¯å£å¹¶é‡å¯"></a>é…ç½®ipï¼Œæ‰“å¼€3369ç«¯å£å¹¶é‡å¯</h3><h3 id="å¯åŠ¨svn"><a href="#å¯åŠ¨svn" class="headerlink" title="å¯åŠ¨svn"></a>å¯åŠ¨svn</h3><blockquote><p>svnserve -d -r /home/repo</p></blockquote><h3 id="æœ¬åœ°æµ‹è¯•"><a href="#æœ¬åœ°æµ‹è¯•" class="headerlink" title="æœ¬åœ°æµ‹è¯•"></a>æœ¬åœ°æµ‹è¯•</h3><p>cmdè¾“å…¥svn checkout svn://***/repoï¼ŒåŠ å…¥æç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œå¹¶èƒ½ç”¨ä¹‹å‰è´¦å·ç™»å½•ï¼Œå°±è¡¨ç¤ºé…ç½®æˆåŠŸã€‚</p><hr><p>å¦‚æœæœ¬åœ°è£…äº†ç±»ä¼¼TortoiseSVNè½¯ä»¶ï¼Œå¯ä»¥æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶åcheckoutï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œæµ‹è¯•æˆåŠŸï¼</p>]]></content>
    
    
    <categories>
      
      <category>CI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SVN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é˜¿é‡Œäº‘èº«ä»½è¯å®åè®¤è¯</title>
    <link href="/2017/07/25/130/"/>
    <url>/2017/07/25/130/</url>
    
    <content type="html"><![CDATA[<p>ç›´æ¥ä¸Šä»£ç ï¼Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„æ¥å£ã€‚</p><div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-comment">/*</span><span class="hljs-comment"> * èº«ä»½è¯æ ¡éªŒ</span><span class="hljs-comment"> *</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sfz_verify</span>(<span class="hljs-params"><span class="hljs-variable">$idcard</span>, <span class="hljs-variable">$name</span></span>)</span>&#123;    <span class="hljs-variable">$host</span> = <span class="hljs-string">&quot;http://idcard.market.alicloudapi.com&quot;</span>;    <span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;/lianzhuo/idcard&quot;</span>;    <span class="hljs-variable">$method</span> = <span class="hljs-string">&quot;GET&quot;</span>;    <span class="hljs-variable">$appcode</span> = z_get_config(<span class="hljs-string">&#x27;sfz_appcode&#x27;</span>);    <span class="hljs-variable">$headers</span> = <span class="hljs-keyword">array</span>();    array_push(<span class="hljs-variable">$headers</span>, <span class="hljs-string">&quot;Authorization:APPCODE &quot;</span> . <span class="hljs-variable">$appcode</span>);    <span class="hljs-variable">$querys</span> = <span class="hljs-string">&quot;cardno=<span class="hljs-subst">$idcard</span>&amp;name=<span class="hljs-subst">$name</span>&quot;</span>;    <span class="hljs-variable">$bodys</span> = <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-variable">$url</span> = <span class="hljs-variable">$host</span> . <span class="hljs-variable">$path</span> . <span class="hljs-string">&quot;?&quot;</span> . <span class="hljs-variable">$querys</span>;    <span class="hljs-variable">$curl</span> = curl_init();    curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_CUSTOMREQUEST, <span class="hljs-variable">$method</span>);    curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);    curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_HTTPHEADER, <span class="hljs-variable">$headers</span>);    curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_FAILONERROR, <span class="hljs-literal">false</span>);    curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);    curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_HEADER, <span class="hljs-literal">true</span>);    <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> == strpos(<span class="hljs-string">&quot;$&quot;</span>.<span class="hljs-variable">$host</span>, <span class="hljs-string">&quot;https://&quot;</span>))&#123;        curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_SSL_VERIFYPEER, <span class="hljs-literal">false</span>);        curl_setopt(<span class="hljs-variable">$curl</span>, CURLOPT_SSL_VERIFYHOST, <span class="hljs-literal">false</span>);    &#125;    <span class="hljs-variable">$output</span> = curl_exec(<span class="hljs-variable">$curl</span>);        <span class="hljs-keyword">if</span> (curl_getinfo(<span class="hljs-variable">$curl</span>, CURLINFO_HTTP_CODE) == <span class="hljs-string">&#x27;200&#x27;</span>) &#123;        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$header</span>, <span class="hljs-variable">$body</span>) = explode(<span class="hljs-string">&quot;\r\n\r\n&quot;</span>, <span class="hljs-variable">$output</span>, <span class="hljs-number">2</span>);    &#125;    <span class="hljs-comment">//dump($output);</span>        curl_close(<span class="hljs-variable">$curl</span>);    <span class="hljs-keyword">return</span> <span class="hljs-variable">$body</span>;&#125;</code></pre></div><p>æ­£ç¡®è¿”å›å€¼å¦‚ä¸‹ï¼š</p><div class="code-wrapper"><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;resp&quot;</span>: &#123;    <span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">&quot;desc&quot;</span>: <span class="hljs-string">&quot;åŒ¹é…&quot;</span>  &#125;,  <span class="hljs-attr">&quot;data&quot;</span>: &#123;    <span class="hljs-attr">&quot;sex&quot;</span>: <span class="hljs-string">&quot;ç”·&quot;</span>,    <span class="hljs-attr">&quot;address&quot;</span>: <span class="hljs-string">&quot;å¹¿ä¸œçœæ¸…è¿œå¸‚æ¸…æ–°å¿&quot;</span>,    <span class="hljs-attr">&quot;birthday&quot;</span>: <span class="hljs-string">&quot;1989-05-25&quot;</span>  &#125;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ueditorè¿œç¨‹å›¾ç‰‡æœ¬åœ°åŒ–çš„å®ç°</title>
    <link href="/2017/07/13/127/"/>
    <url>/2017/07/13/127/</url>
    
    <content type="html"><![CDATA[ <p data-source-line="1" style="box-sizing: border-box; margin-top: 0px !important; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">å‰ä¸ä¹…å®¢æˆ·åé¦ˆè¯´ï¼Œåœ¨ç§€ç±³ç½‘ä¸Šç¼–è¾‘å¥½æ–‡ç« ï¼Œå‘å¸ƒåˆ°æˆ‘ä»¬åå°ï¼Œå‰å°å›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼Œæœ€å…ˆæƒ³åˆ°çš„æ˜¯å›¾ç‰‡åŸŸåé™åˆ¶ã€‚å‘é‚®ä»¶ç»™ç§€ç±³ï¼Œç§€ç±³ç»™å‡ºçš„å»ºè®®æ˜¯ç±»ä¼¼å¾®ä¿¡åå°åšå›¾ç‰‡æœ¬åœ°åŒ–ã€‚</p><p data-source-line="3" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">å¼€å‘ç»„å†…éƒ¨è®¨è®ºåï¼Œçœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼Œ<a href="http://blog.csdn.net/alex_fung/article/details/50802565" style="box-sizing: border-box; color: rgb(64, 120, 192); text-decoration: none; background-color: transparent;">UEditorç¼–è¾‘å™¨å¦‚ä½•å…³é—­æŠ“å–è¿œç¨‹å›¾ç‰‡æœ¬åœ°åŒ–åŠŸèƒ½</a>ï¼Œso easy?æŒ‰æ–‡ç« è¯´æ˜è®¾ç½®ï¼Œæµ‹è¯•,å¤±è´¥ï¼</p><p data-source-line="5" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ç™¾åº¦çœ‹äº†ä¸‹ï¼Œå¤§éƒ½æ˜¯è¿™æ ·è§£ç­”ï¼Œè¯´æ˜åº”è¯¥æ˜¯æœ‰äººå®ç°äº†ï¼Œç§€ç±³ç¼–è¾‘å™¨æ ¸å¿ƒä»£ç ä¹Ÿæ­£æ˜¯ueditoræ ¸å¿ƒä»£ç ï¼Œé‚£å°±åªèƒ½è‡ªå·±æ£é¼“äº†ã€‚</p><p data-source-line="7" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">å…·ä½“æ£é¼“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><blockquote data-source-line="8" style="box-sizing: border-box; margin: 0px 0px 16px; padding: 0px 1em; color: rgb(119, 119, 119); border-left-width: 0.25em; border-left-style: solid; border-left-color: rgb(221, 221, 221); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;">æ³¨æ„ï¼šæ£é¼“å‰å…ˆå¤‡ä»½ä¸‹ï¼Œä»¥å¤‡ä¿®æ”¹é”™è¯¯å¯¼è‡´å…¶ä»–é—®é¢˜</p></blockquote><ol data-source-line="10" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>æ‰“å¼€ueditor.config.jsï¼Œåœ¨é…ç½®é¡¹ä¸­åŠ å…¥</p></li></ol><div class="code-wrapper"><pre data-source-line="11" style="box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 11.9px; line-height: 1.45; font-family: Consolas, &#39;Liberation Mono&#39;, Menlo, Courier, monospace; word-wrap: normal; margin-top: 0px; margin-bottom: 16px; padding: 16px; overflow: auto; border-radius: 3px; color: rgb(51, 51, 51); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247);">,catchRemoteImageEnable:true</pre></div><ol start="2" data-source-line="14" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>æ‰“å¼€ueditor.config.jsï¼Œæœç´¢catchremoteimageï¼Œåœ¨åŠ å…¥console.warn(url)ï¼Œçœ‹çœ‹ä¸Šä¼ åœ°å€ã€‚å‰å°æµ‹è¯•åçœ‹åˆ°/Skin/public/ueditor/php/controller.php?action=catchimage</p></li><li><p>æ‰“å¼€php/controller.php å¯ä»¥çœ‹åˆ°</p></li></ol><div class="code-wrapper"><pre data-source-line="17" style="box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 11.9px; line-height: 1.45; font-family: Consolas, &#39;Liberation Mono&#39;, Menlo, Courier, monospace; word-wrap: normal; margin-top: 0px; margin-bottom: 16px; padding: 16px; overflow: auto; border-radius: 3px; color: rgb(51, 51, 51); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247);">case&nbsp;&#39;catchimage&#39;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;include(&quot;action_crawler.php&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</pre></div><p data-source-line="22" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">æ¥ç€æ‰“å¼€ç»Ÿè®¡ç›®å½•ä¸‹action_crawler.php</p><div class="code-wrapper"><pre data-source-line="23" style="box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 11.9px; line-height: 1.45; font-family: Consolas, &#39;Liberation Mono&#39;, Menlo, Courier, monospace; word-wrap: normal; margin-top: 0px; margin-bottom: 16px; padding: 16px; overflow: auto; border-radius: 3px; color: rgb(51, 51, 51); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247);">include(&quot;Uploader.class.php&quot;);$item&nbsp;=&nbsp;new&nbsp;Uploader($imgUrl,&nbsp;$config,&nbsp;&quot;remote&quot;);</pre></div><p data-source-line="29" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">çœ‹åˆ°è¿™ä¸¤æ®µä»£ç ã€‚ç»§ç»­æ‰“å¼€ç»Ÿè®¡ç›®å½•ä¸‹Uploader.class.php</p><div class="code-wrapper"><pre data-source-line="30" style="box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 11.9px; line-height: 1.45; font-family: Consolas, &#39;Liberation Mono&#39;, Menlo, Courier, monospace; word-wrap: normal; margin-top: 0px; margin-bottom: 16px; padding: 16px; overflow: auto; border-radius: 3px; color: rgb(51, 51, 51); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247);">//æ„é€ å‡½æ•°å¦‚ä¸‹public&nbsp;function&nbsp;__construct($fileField,&nbsp;$config,&nbsp;$type&nbsp;=&nbsp;&quot;upload&quot;)&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileField&nbsp;=&nbsp;$fileField;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;config&nbsp;=&nbsp;$config;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;type&nbsp;=&nbsp;$type;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($type&nbsp;==&nbsp;&quot;remote&quot;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;saveRemote();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if($type&nbsp;==&nbsp;&quot;base64&quot;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;upBase64();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;upFile();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateMap[&#39;ERROR_TYPE_NOT_ALLOWED&#39;]&nbsp;=&nbsp;iconv(&#39;unicode&#39;,&nbsp;&#39;utf-8&#39;,&nbsp;$this-&gt;stateMap[&#39;ERROR_TYPE_NOT_ALLOWED&#39;]);&nbsp;&nbsp;&nbsp;&nbsp;}</pre></div><p data-source-line="48" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">æœç´¢saveRemoteï¼Œä¸»è¦ä¿®å¤fileTypeä¸oriNameä¸¤å—ã€‚</p><div class="code-wrapper"><pre data-source-line="49" style="box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 11.9px; line-height: 1.45; font-family: Consolas, &#39;Liberation Mono&#39;, Menlo, Courier, monospace; word-wrap: normal; margin-top: 0px; margin-bottom: 16px; padding: 16px; overflow: auto; border-radius: 3px; color: rgb(51, 51, 51); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247);">/**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;æ‹‰å–è¿œç¨‹å›¾ç‰‡&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;mixed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;saveRemote()&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$imgUrl&nbsp;=&nbsp;htmlspecialchars($this-&gt;fileField);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$imgUrl&nbsp;=&nbsp;str_replace(&quot;&amp;amp;&quot;,&nbsp;&quot;&amp;&quot;,&nbsp;$imgUrl);<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//httpå¼€å¤´éªŒè¯<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strpos($imgUrl,&nbsp;&quot;http&quot;)&nbsp;!==&nbsp;0)&nbsp;{&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_HTTP_LINK&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preg_match(&#39;/(^https*://[^:/]+)/&#39;,&nbsp;$imgUrl,&nbsp;$matches);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$host_with_protocol&nbsp;=&nbsp;count($matches)&nbsp;&gt;&nbsp;1&nbsp;?&nbsp;$matches[1]&nbsp;:&nbsp;&#39;&#39;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•&nbsp;url<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!filter_var($host_with_protocol,&nbsp;FILTER_VALIDATE_URL))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;INVALID_URL&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preg_match(&#39;/^https*://(.+)/&#39;,&nbsp;$host_with_protocol,&nbsp;$matches);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$host_without_protocol&nbsp;=&nbsp;count($matches)&nbsp;&gt;&nbsp;1&nbsp;?&nbsp;$matches[1]&nbsp;:&nbsp;&#39;&#39;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æ­¤æ—¶æå–å‡ºæ¥çš„å¯èƒ½æ˜¯&nbsp;ip&nbsp;ä¹Ÿæœ‰å¯èƒ½æ˜¯åŸŸåï¼Œå…ˆè·å–&nbsp;ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ip&nbsp;=&nbsp;gethostbyname($host_without_protocol);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;åˆ¤æ–­æ˜¯å¦æ˜¯ç§æœ‰&nbsp;ip<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!filter_var($ip,&nbsp;FILTER_VALIDATE_IP,&nbsp;FILTER_FLAG_NO_PRIV_RANGE))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;INVALID_IP&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//è·å–è¯·æ±‚å¤´å¹¶æ£€æµ‹æ­»é“¾&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$heads&nbsp;=&nbsp;get_headers($imgUrl,&nbsp;1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(stristr($heads[0],&nbsp;&quot;200&quot;)&nbsp;&amp;&amp;&nbsp;stristr($heads[0],&nbsp;&quot;OK&quot;)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_DEAD_LINK&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ ¼å¼éªŒè¯(æ‰©å±•åéªŒè¯å’ŒContent-TypeéªŒè¯)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileType&nbsp;=&nbsp;strtolower(strrchr($imgUrl,&nbsp;&#39;.&#39;));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//13sai&nbsp;20170712&nbsp;&nbsp;ç§€ç±³ç½‘é“¾æ¥æ¥å¦‚ä¸‹<a href="http://img.xiumi.us/xmi/ua/h4qG/i/b8f2af6986e8dba51615a9d85cc82f3b-sz_1952250.JPG?x-oss-process=style/xm&nbsp;%EF%BC%8C%E6%88%91%E4%BB%AC%E5%AE%8C%E5%96%84%E4%B8%8B">http://img.xiumi.us/xmi/ua/h4qG/i/b8f2af6986e8dba51615a9d85cc82f3b-sz_1952250.JPG?x-oss-process=style/xm&nbsp;ï¼Œæˆ‘ä»¬å®Œå–„ä¸‹</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileType&nbsp;=&nbsp;(strpos($fileType,&nbsp;&#39;?&#39;)&nbsp;&gt;&nbsp;0)?&nbsp;strtolower(substr($fileType,0,strpos($fileType,&#39;?&#39;)))&nbsp;:&nbsp;strtolower($fileType);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;$fileType;die();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!in_array($fileType,&nbsp;$this-&gt;config[&#39;allowFiles&#39;])&nbsp;||&nbsp;!isset($heads[&#39;Content-Type&#39;])&nbsp;||&nbsp;!stristr($heads[&#39;Content-Type&#39;],&nbsp;&quot;image&quot;))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_HTTP_CONTENTTYPE&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ‰“å¼€è¾“å‡ºç¼“å†²åŒºå¹¶è·å–è¿œç¨‹å›¾ç‰‡<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob_start();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$context&nbsp;=&nbsp;stream_context_create(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(&#39;http&#39;&nbsp;=&gt;&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;follow_location&#39;&nbsp;=&gt;&nbsp;false&nbsp;//&nbsp;don&#39;t&nbsp;follow&nbsp;redirects<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readfile($imgUrl,&nbsp;false,&nbsp;$context);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$img&nbsp;=&nbsp;ob_get_contents();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob_end_clean();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//13sai&nbsp;20170712&nbsp;&nbsp;æ­¤å¤„æ­£åˆ™æœ‰é—®é¢˜ï¼Œä¿®æ”¹å¦‚ä¸‹<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//preg_match(&quot;/<a href="%5B%5E/%5D*">/</a>[.]?[^./]*$/&quot;,&nbsp;$imgUrl,&nbsp;$m);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preg_match(&quot;//[A-za-z0-9-]+.&quot;.$fileType.&quot;/&quot;,&nbsp;strtolower($imgUrl),&nbsp;$m);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//var_dump($m);die();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;oriName&nbsp;=&nbsp;$m&nbsp;?&nbsp;ltrim($m[0],&#39;/&#39;):&quot;&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$this-&gt;oriName&nbsp;=&nbsp;$m&nbsp;?&nbsp;$m[1]:&quot;&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;$this-&gt;oriName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//die();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileSize&nbsp;=&nbsp;strlen($img);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileType&nbsp;=&nbsp;$this-&gt;getFileExt();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fullName&nbsp;=&nbsp;$this-&gt;getFullName();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;filePath&nbsp;=&nbsp;$this-&gt;getFilePath();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileName&nbsp;=&nbsp;$this-&gt;getFileName();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dirname&nbsp;=&nbsp;dirname($this-&gt;filePath);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…å‡ºé™åˆ¶<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$this-&gt;checkSize())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_SIZE_EXCEED&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//åˆ›å»ºç›®å½•å¤±è´¥<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!file_exists($dirname)&nbsp;&amp;&amp;&nbsp;!mkdir($dirname,&nbsp;0777,&nbsp;true))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_CREATE_DIR&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(!is_writeable($dirname))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_DIR_NOT_WRITEABLE&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//ç§»åŠ¨æ–‡ä»¶<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(file_put_contents($this-&gt;filePath,&nbsp;$img)&nbsp;&amp;&amp;&nbsp;file_exists($this-&gt;filePath)))&nbsp;{&nbsp;//ç§»åŠ¨å¤±è´¥<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_WRITE_CONTENT&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;//ç§»åŠ¨æˆåŠŸ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;stateMap[0];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</pre></div><ol start="4" data-source-line="151" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>æ‰“å¼€php/config.jsonï¼Œä¿®æ”¹å¤§å°ã€æ ¼å¼ã€å­˜å‚¨è·¯å¾„ç­‰å‚æ•°</p></li></ol><div class="code-wrapper"><pre data-source-line="152" style="box-sizing: border-box; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 11.9px; line-height: 1.45; font-family: Consolas, &#39;Liberation Mono&#39;, Menlo, Courier, monospace; word-wrap: normal; margin-top: 0px; margin-bottom: 16px; padding: 16px; overflow: auto; border-radius: 3px; color: rgb(51, 51, 51); letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 247, 247);">/<em>&nbsp;æŠ“å–è¿œç¨‹å›¾ç‰‡é…ç½®&nbsp;</em>/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherLocalDomain&quot;:&nbsp;[&quot;127.0.0.1&quot;,&nbsp;&quot;localhost&quot;,&nbsp;&quot;img.baidu.com&quot;],&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherActionName&quot;:&nbsp;&quot;catchimage&quot;,&nbsp;/<em>&nbsp;æ‰§è¡ŒæŠ“å–è¿œç¨‹å›¾ç‰‡çš„actionåç§°&nbsp;</em>/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherFieldName&quot;:&nbsp;&quot;source&quot;,&nbsp;/<em>&nbsp;æäº¤çš„å›¾ç‰‡åˆ—è¡¨è¡¨å•åç§°&nbsp;</em>/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherPathFormat&quot;:&nbsp;&quot;/Upload/ueditor/image/{yyyy}{mm}{dd}/{time}{rand:6}&quot;,&nbsp;/<em>&nbsp;ä¸Šä¼ ä¿å­˜è·¯å¾„,å¯ä»¥è‡ªå®šä¹‰ä¿å­˜è·¯å¾„å’Œæ–‡ä»¶åæ ¼å¼&nbsp;</em>/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherUrlPrefix&quot;:&nbsp;&quot;&quot;,&nbsp;/<em>&nbsp;å›¾ç‰‡è®¿é—®è·¯å¾„å‰ç¼€&nbsp;</em>/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherMaxSize&quot;:&nbsp;20480000,&nbsp;/<em>&nbsp;ä¸Šä¼ å¤§å°é™åˆ¶ï¼Œå•ä½B&nbsp;</em>/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherAllowFiles&quot;:&nbsp;[&quot;.png&quot;,&nbsp;&quot;.jpg&quot;,&nbsp;&quot;.jpeg&quot;,&nbsp;&quot;.gif&quot;,&nbsp;&quot;.bmp&quot;],&nbsp;/<em>&nbsp;æŠ“å–å›¾ç‰‡æ ¼å¼æ˜¾ç¤º&nbsp;</em>/</pre></div><p data-source-line="163" style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px !important; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 21px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">5.ä¿å­˜ä¿®æ”¹ä¸Šä¼ ï¼Œæµ‹è¯•æˆåŠŸï¼</p><p><br/></p></p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ueditor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonçˆ¬è™«</title>
    <link href="/2017/01/14/98/"/>
    <url>/2017/01/14/98/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åœ¨ç©Pythonï¼Œè‡ªå·±å¹³æ—¶å–œæ¬¢å’ŒåŒäº‹çœ‹ç”µå½±ï¼Œå°±å¯»æ€å†™äº†ä¸ªçˆ¬è™«æ¥å®šæ—¶çˆ¬å–ä¼˜æƒ ç”µå½±ã€‚</p></blockquote><div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># author: 13sai    </span><span class="hljs-comment"># code: utf-8    </span><span class="hljs-keyword">from</span> urllib.request <span class="hljs-keyword">import</span> urlopen    <span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup    <span class="hljs-keyword">import</span> re    <span class="hljs-keyword">import</span> datetime    now = datetime.datetime.now()    week = now.weekday()    <span class="hljs-keyword">if</span> week &lt; <span class="hljs-number">5</span>:        week = <span class="hljs-number">4</span> - week    <span class="hljs-keyword">else</span>:        week = <span class="hljs-number">12</span> - week    delta = datetime.timedelta(days=week)    n_days = now + delta    nowtime = n_days.strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>)  <span class="hljs-comment"># æ¯å‘¨äº”    </span>jiage = <span class="hljs-built_in">int</span>(<span class="hljs-number">30</span>)  <span class="hljs-comment">#ä»·æ ¼    </span>url_gwl = urlopen(<span class="hljs-string">&quot;http://www.gewara.com/cinema/ajax/getOpiItemPage.xhtml?cid=cinemaid&amp;mid=&amp;fyrq=&quot;</span>+nowtime).read().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)    soupurl_gwl = BeautifulSoup(url_gwl,<span class="hljs-string">&quot;html.parser&quot;</span>)    ids_gwl = soupurl_gwl.findAll(<span class="hljs-string">&quot;a&quot;</span>,attrs =&#123;<span class="hljs-string">&quot;href&quot;</span>:<span class="hljs-string">&quot;javascript:void(0);&quot;</span>&#125;)    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span>    str1 = <span class="hljs-string">&#x27;&#x27;</span>    str2 = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> idattr_gwl <span class="hljs-keyword">in</span> ids_gwl:        res_gwl = urlopen(<span class="hljs-string">&quot;http://www.gewara.com/movie/ajax/getOpiItemNew.xhtml?movieid=&quot;</span>+idattr_gwl[<span class="hljs-string">&#x27;id&#x27;</span>]+<span class="hljs-string">&quot;&amp;fyrq=&quot;</span>+nowtime+<span class="hljs-string">&quot;&amp;cid=cinemaid&quot;</span>).read().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)        soup_gwl = BeautifulSoup(res_gwl,<span class="hljs-string">&quot;html.parser&quot;</span>)        <span class="hljs-comment"># print(soup)    </span>    links_gwl = soup_gwl.findAll(<span class="hljs-string">&quot;span&quot;</span>,attrs =&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;opiPrice&quot;</span>&#125;)        arrtime_gwl = soup_gwl.findAll(<span class="hljs-string">&quot;span&quot;</span>,attrs =&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;opitime&quot;</span>&#125;)        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(links_gwl)):        <span class="hljs-keyword">if</span> links_gwl[i].find(<span class="hljs-string">&quot;b&quot;</span>) != <span class="hljs-literal">None</span>:               <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(links_gwl[i].find(<span class="hljs-string">&quot;b&quot;</span>).get_text()) &lt; jiage:                   str1 = str1+<span class="hljs-string">&quot;&lt;p&gt;&quot;</span>+arrtime_gwl[i].get_text()+<span class="hljs-string">&quot;ç¥¨ä»·ï¼š&quot;</span>+links_gwl[i].find(<span class="hljs-string">&quot;b&quot;</span>).get_text()+idattr_gwl.find(<span class="hljs-string">&#x27;img&#x27;</span>)[<span class="hljs-string">&#x27;alt&#x27;</span>]+<span class="hljs-string">&quot;&lt;a href=&#x27;http://www.gewara.com/movie/ajax/getOpiItemNew.xhtml?movieid=&quot;</span>+idattr_gwl[<span class="hljs-string">&#x27;id&#x27;</span>]+<span class="hljs-string">&quot;&amp;fyrq=&quot;</span>+nowtime+<span class="hljs-string">&quot;&amp;cid=cinemaid&#x27;&gt;ç‚¹å‡»æŸ¥çœ‹&lt;/a&gt;&lt;/p&gt;&quot;</span>    url_tb = urlopen(<span class="hljs-string">&quot;http://dianying.taobao.com/showList.htm?spm=a1z21.3046609.w2.3.9ilG5t&amp;n_s=new&quot;</span>).read().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)    soupurl_tb = BeautifulSoup(url_tb,<span class="hljs-string">&quot;html.parser&quot;</span>)    ids_tb = soupurl_tb.findAll(<span class="hljs-string">&quot;a&quot;</span>,attrs =&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;movie-card&quot;</span>&#125;)    <span class="hljs-keyword">for</span> idattr_tb <span class="hljs-keyword">in</span> ids_tb:        pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;showId=(\d+)&quot;</span>)        id_group_tb = pattern.search(idattr_tb[<span class="hljs-string">&#x27;href&#x27;</span>])        <span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span>:            res_tb = urlopen(<span class="hljs-string">&quot;http://dianying.taobao.com/cinemaDetailSchedule.htm?cinemaId=cinemaid&amp;activityId=&amp;fCode=&amp;showId=&quot;</span>+id_group_tb.group(<span class="hljs-number">1</span>)+<span class="hljs-string">&quot;&amp;showDate=&quot;</span>+nowtime).read().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)            soup_tb = BeautifulSoup(res_tb,<span class="hljs-string">&quot;html.parser&quot;</span>)            <span class="hljs-comment"># print(soup)    </span>        links_tb = soup_tb.findAll(<span class="hljs-string">&quot;td&quot;</span>,attrs =&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;hall-price&quot;</span>&#125;)            arrtime_tb = soup_tb.findAll(<span class="hljs-string">&quot;td&quot;</span>,attrs =&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;hall-time&quot;</span>&#125;)            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(links_tb)):            <span class="hljs-keyword">if</span> links_tb[i].find(<span class="hljs-string">&quot;em&quot;</span>) != <span class="hljs-literal">None</span>:                   <span class="hljs-keyword">if</span> <span class="hljs-built_in">float</span>(links_tb[i].find(<span class="hljs-string">&quot;em&quot;</span>).get_text()) &lt; jiage:                       name_tb = idattr_tb.find(<span class="hljs-string">&#x27;span&#x27;</span>,attrs=&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;bt-l&quot;</span>&#125;)                       str2 = str2+<span class="hljs-string">&quot;&lt;p&gt;&quot;</span>+arrtime_tb[i].get_text()+<span class="hljs-string">&quot;ç¥¨ä»·ï¼š&quot;</span>+links_tb[i].find(<span class="hljs-string">&quot;em&quot;</span>).get_text()+name_tb.get_text()+<span class="hljs-string">&quot;&lt;a href=&#x27;http://dianying.taobao.com/cinemaDetailSchedule.htm?cinemaId=cinemaid&amp;activityId=&amp;fCode=&amp;showId=&quot;</span>+id_group_tb.group(<span class="hljs-number">1</span>)+<span class="hljs-string">&quot;&amp;showDate=&quot;</span>+nowtime+<span class="hljs-string">&quot;&#x27;&gt;ç‚¹å‡»æŸ¥çœ‹&lt;/a&gt;&lt;/p&gt;&quot;</span>    str1 = str1.strip()    str2 = str2.strip()    <span class="hljs-keyword">if</span> str1 != <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> str2 != <span class="hljs-string">&#x27;&#x27;</span>:        <span class="hljs-keyword">from</span> email <span class="hljs-keyword">import</span> encoders        <span class="hljs-keyword">from</span> email.header <span class="hljs-keyword">import</span> Header        <span class="hljs-keyword">from</span> email.mime.text <span class="hljs-keyword">import</span> MIMEText        <span class="hljs-keyword">from</span> email.utils <span class="hljs-keyword">import</span> parseaddr, formataddr        <span class="hljs-keyword">import</span> smtplib        <span class="hljs-comment"># ç¬¬ä¸‰æ–¹ SMTP æœåŠ¡      </span>    mail_host=<span class="hljs-string">&quot;smtp.qq.com&quot;</span>  <span class="hljs-comment">#è®¾ç½®æœåŠ¡å™¨      </span>    mail_user=<span class="hljs-string">&quot;@&quot;</span>    <span class="hljs-comment">#ç”¨æˆ·å      </span>    mail_pass=<span class="hljs-string">&quot;@&quot;</span>   <span class="hljs-comment">#å£ä»¤,QQé‚®ç®±æ˜¯è¾“å…¥æˆæƒç     </span>    sender = <span class="hljs-string">&#x27;@&#x27;</span>          receivers = [<span class="hljs-string">&#x27;@&#x27;</span>]  <span class="hljs-comment"># æ¥æ”¶é‚®ä»¶ï¼Œå¯è®¾ç½®ä¸ºä½ çš„QQé‚®ç®±æˆ–è€…å…¶ä»–é‚®ç®±      </span>    <span class="hljs-keyword">if</span> str1 != <span class="hljs-string">&#x27;&#x27;</span>:            <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;æ ¼ç“¦æ‹‰ï¼š&lt;br/&gt;&quot;</span>+str1+<span class="hljs-string">&quot;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>        <span class="hljs-keyword">if</span> str2 != <span class="hljs-string">&#x27;&#x27;</span>:            <span class="hljs-built_in">str</span> = <span class="hljs-built_in">str</span>+<span class="hljs-string">&quot;æ·˜ç¥¨ç¥¨ï¼š&lt;br/&gt;&quot;</span>+str2+<span class="hljs-string">&quot;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>        message = MIMEText(<span class="hljs-built_in">str</span>, <span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>)        message[<span class="hljs-string">&#x27;From&#x27;</span>] = Header(<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>)        message[<span class="hljs-string">&#x27;To&#x27;</span>] =  Header(<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>)        subject = <span class="hljs-string">&#x27;ä¼˜æƒ ç”µå½±&#x27;</span>         message[<span class="hljs-string">&#x27;Subject&#x27;</span>] = Header(subject, <span class="hljs-string">&#x27;utf-8&#x27;</span>)        <span class="hljs-keyword">try</span>:        smtpObj = smtplib.SMTP_SSL(mail_host, <span class="hljs-number">465</span>)        smtpObj.login(mail_user,mail_pass)        smtpObj.sendmail(sender, receivers, message.as_string())        smtpObj.quit()        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é‚®ä»¶å‘é€æˆåŠŸ&quot;</span>)        <span class="hljs-keyword">except</span> smtplib.SMTPException:        <span class="hljs-built_in">print</span>(smtplib.SMTPException)    <span class="hljs-keyword">else</span>:        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æš‚æ— ä¼˜æƒ ç”µå½±&quot;</span>)</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windows7åˆ›å»ºä»»åŠ¡è®¡åˆ’</title>
    <link href="/2017/01/05/95/"/>
    <url>/2017/01/05/95/</url>
    
    <content type="html"><![CDATA[ <p><span style="border: medium none;"></span>æœ€è¿‘åœ¨åšä¸ªç¨‹åºï¼Œçˆ¬å–ä¼˜æƒ ç”µå½±ç¥¨çš„ç¨‹åºï¼Œç¨‹åºå­˜åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡éœ€è¦cmdè¿è¡Œä¸‹ï¼Œæœ‰ç‚¹éº»çƒ¦ï¼Œæœ‰æ—¶å€™ä¼šå¿˜è®°ï¼Œå› ä¸ºè€ƒè™‘åˆ›å»ºä»»åŠ¡è®¡åˆ’ã€‚</p><p>åˆ›å»ºå…¶å®å¾ˆç®€å•ï¼Œç¬¬ä¸€æ­¥ï¼Œè¿›å…¥ä»»åŠ¡è®¡åˆ’ç®¡ç†ï¼ˆæ§åˆ¶é¢æ¿æˆ–è€…ç›´æ¥æœç´¢ç¨‹åºï¼‰</p><p><img src="/upload/ueditor/image/20170105/1483593956686165.png" title="1483593956686165.png" alt="1.png"/></p><p><br/></p><p>ä½ å¯ä»¥çœ‹è§æœ¬æœºçš„ä»»åŠ¡è®¡åˆ’åˆ—è¡¨ã€‚</p><p>ç‚¹å‡»å³ä¾§åˆ›å»ºåŸºæœ¬ä»»åŠ¡ï¼Œ</p><p><br/></p><p><img src="/upload/ueditor/image/20170105/1483594065861502.png" style="" title="1483594065861502.png"/></p><p>åç§°æè¿°è§¦å‘æ—¶é—´å°±ç”±ä½ å®šï¼Œ<br/></p><p><img src="/upload/ueditor/image/20170105/1483594065556877.png" style="" title="1483594065556877.png"/></p><p><br/></p><p>é€‰æ‹©å¯åŠ¨ç¨‹åºï¼Œç¨‹åºè„šæœ¬å†™åœ¨ä¸Šé¢ï¼Œèµ·å§‹äºå†™å…¥æ”¹ç¨‹åºæ‰€åœ¨ç›®å½•ã€‚</p><p><br/></p><p><img src="/upload/ueditor/image/20170105/1483594065442904.png" style="" title="1483594065442904.png"/></p><p><br/></p><p>ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç‚¹å‡»å®Œæˆï¼Œè¿™æ ·å°±å®Œæˆäº†ã€‚</p><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚<br/></p><p><br/></p>]]></content>
    
    
    <categories>
      
      <category>windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>background-imageçš„urlå±æ€§ä¸ºç©º</title>
    <link href="/2016/10/11/76/"/>
    <url>/2016/10/11/76/</url>
    
    <content type="html"><![CDATA[<p>å‰å¤©åŒäº‹å¼€å‘æ—¶ï¼Œé‡åˆ°ä¸€ä¸ªè¯¡å¼‚çš„é—®é¢˜ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢ï¼Œæµè§ˆé‡ä¼šåŠ 2ï¼Œè€Œä¸æ˜¯æƒ³è¦çš„åŠ 1ã€‚</p><p>æ£€æŸ¥äº†ä»£ç æ§åˆ¶å™¨ï¼Œæ²¡æœ‰ä¸æ¯«é—®é¢˜ï¼Œä¸Šæ¬¡å‡ºç°æµè§ˆé‡ä¼šåŠ 2çš„æƒ…å†µæ˜¯å› ä¸ºå¤šå†™äº†ä¸€æ¬¡displayï¼Œåªèƒ½å»å¤´å»å°¾ï¼Œä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†æ’æŸ¥ï¼Œæœ€åå‘ç°æ˜¯å¤´éƒ¨ç”¨äº†ä¸ªbackgroundï¼Œé‡Œé¢çš„urlæ˜¯ç©ºå€¼ï¼Œå»æ‰ï¼Œæ­£å¸¸ã€‚</p><p>åˆšæŸ¥äº†ä¸‹ç½‘ä¸Šç¡®å®æœ‰å‡ºç°background-imageçš„urlå±æ€§ä¸ºç©ºå¯¼è‡´äºŒæ¬¡æäº¤çš„æƒ…å†µï¼ŒåŒäº‹å‡ºç°æµè§ˆé‡åŠ 2ä¹Ÿæ˜¯å› æ­¤å¯¼è‡´ã€‚</p><p>è¯´æ˜ï¼š</p><ol><li>æ”¹å˜ä»£ç ä¹ æƒ¯ã€‚ä¸¥ç¦ä»£ç ä¸­ï¼Œurl/href/src å€¼ä¸ºç©ºæˆ– # . è¿™åº”è¯¥æ˜¯ç›®å‰æœ€å¥½çš„ä¸€ç§æ–¹å¼ã€‚</li><li>é¿å…ç©ºé“¾æ¥å±æ€§ç©ºçš„é“¾æ¥å±æ€§æ˜¯æŒ‡imgã€linkã€scriptã€ifrrameå…ƒç´ çš„srcæˆ–hrefå±æ€§è¢«è®¾ç½®äº†ï¼Œä½†æ˜¯å±æ€§å´ä¸ºç©ºã€‚æ—©äº›ç‰ˆæœ¬çš„Webkitå†…æ ¸æµè§ˆå™¨ ä¸Firefox ä¼šæŠŠç©ºåœ°å€è§£æä¸ºå½“å‰é¡µé¢çš„åœ°å€ã€‚å¦‚æœé¡µé¢å†…æœ‰å¤šä¸ªç©ºé“¾æ¥å±æ€§å…ƒç´ ï¼Œå½“å‰é¡µé¢çš„æœåŠ¡å™¨åˆ™ä¼šè¢«è¯·æ±‚å¤šæ¬¡ï¼Œå¢åŠ æœåŠ¡å™¨çš„è´Ÿè½½ã€‚ç›¸è¾ƒæ¡Œé¢æµè§ˆå™¨å¯¹å†…æ ¸çš„æ›´æ–°å‡çº§è¾ƒç§¯æï¼Œè¿™ä¸ªé—®é¢˜åœ¨ç§»åŠ¨æµè§ˆå™¨ä¸Šé—®é¢˜å¯èƒ½è¾ƒä¸¥é‡ã€‚<br>  å¹¸è¿çš„æ˜¯æ‰€æœ‰ä¸»æµæµè§ˆå™¨é¢å¯¹iframeçš„srcå±æ€§ä¸ºç©ºæ—¶ï¼Œä¼šæŠŠç©ºåœ°å€è§£æä¸ºabout:blankåœ°å€ï¼Œè€Œä¸ä¼šå‘æœåŠ¡å™¨å‘å‡ºé¢å¤–çš„è¯·æ±‚ã€‚å› æ­¤é“¾æ¥é¿å…ä¸äº†å‡ºç°ç©ºçš„æƒ…å†µï¼Œå¯ä»¥ç”¨aboutï¼šblankæ¥ä»£æ›¿ç©ºçš„æƒ…å†µã€‚</li></ol><p>è´´ä¸Šæ–‡ç« : </p><ul><li><a href="https://lifesinger.wordpress.com/2011/09/22/empty-src-is-dangerous/"> ç©ºè·¯å¾„å¯¹é¡µé¢æ€§èƒ½çš„å½±å“</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>html</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šç§font-family</title>
    <link href="/2016/04/06/38/"/>
    <url>/2016/04/06/38/</url>
    
    <content type="html"><![CDATA[<p>ä¿®æ”¹ä¸€ä¸ªä¸­è‹±æ–‡æ··åˆcsséœ€æ±‚æ—¶ï¼Œçœ‹åˆ°äº†ä»¥ä¸‹æ ·å¼ã€‚</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">font</span>: <span class="hljs-number">12</span>px/<span class="hljs-number">25</span>px <span class="hljs-string">&quot;Microsoft Yahei&quot;</span>, <span class="hljs-string">&quot;å¾®è½¯é›…é»‘&quot;</span>, <span class="hljs-string">&quot;å®‹ä½“&quot;</span>, <span class="hljs-string">&quot;Helvetica Neue&quot;</span>, Helvetica, Arial, sans-serif;</code></pre></div><p>å±…ç„¶è®¾ç½®äº†è¿™ä¹ˆå¤šå­—ä½“ã€‚ç„¶åå°±æŸ¥äº†æŸ¥ï¼Œè´´ä¸Šæ¥ã€‚</p><p>font-familyçš„è°ƒç”¨æ–¹æ³•:</p><p>ä»£ç å¦‚ä¸‹:</p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;    <span class="hljs-attribute">font-family</span>:Arial,<span class="hljs-string">&#x27;Times New Roman&#x27;</span>,<span class="hljs-string">&#x27;Microsoft YaHei&#x27;</span>,SimHei;     <span class="hljs-attribute">font</span>:bold <span class="hljs-number">12px</span>/<span class="hljs-number">0.75em</span> Arial,<span class="hljs-string">&#x27;Times New Roman&#x27;</span>,<span class="hljs-string">&#x27;Microsoft YaHei&#x27;</span>,SimHei; &#125;</code></pre></div><p>font-family å¯ä»¥æŠŠå¤šä¸ªå­—ä½“åç§°ä½œä¸ºä¸€ä¸ªâ€œå›é€€â€ç³»ç»Ÿæ¥ä¿å­˜ã€‚å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒç¬¬ä¸€ä¸ªå­—ä½“ï¼Œåˆ™ä¼šå°è¯•ä¸‹ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfont-family å±æ€§çš„å€¼æ˜¯ç”¨äºæŸä¸ªå…ƒç´ çš„å­—ä½“æ—åç§°æˆ–/åŠç±»æ—åç§°çš„ä¸€ä¸ªä¼˜å…ˆè¡¨ã€‚æµè§ˆå™¨ä¼šä½¿ç”¨å®ƒå¯è¯†åˆ«çš„ç¬¬ä¸€ä¸ªå€¼ã€‚</p><p>æ ¹æ®font-familyçš„å­—ä½“è°ƒç”¨åŸåˆ™æˆ‘ä»¬å¯ä»¥ä¸ºè‹±æ–‡,ä¸­æ–‡,ç­‰ä¸¤ç§å­—ä½“è°ƒç”¨ä¸åŒçš„å­—ä½“æ¥æ¸²æŸ“ã€‚</p><p>å¦‚:<code>Arial,â€™Times New Romanâ€™</code>è¿™ä¸¤ç§å­—ä½“ä¸è®¤è¯†ä¸­æ–‡,åªè®¤è¯†è‹±æ–‡,æ‰€ä»¥,è¿™ä¸¤ç§å­—ä½“åªèƒ½æ¸²æŸ“è‹±æ–‡æ•°å­—å’Œä¸€äº›ç‰¹æ®Šç¬¦å·,è€Œé¡µé¢ä¸­çš„ä¸­æ–‡å°±ä¼šè‡ªåŠ¨è°ƒç”¨ç¬¬ä¸‰ç§å­—ä½“<code>Microsoft YaHei</code>(PS:å‡å¦‚å­˜åœ¨è¿™ç§å­—ä½“çš„è¯)ã€‚</p><p>æ‰€ä»¥,åœ¨å®šä¹‰å­—ä½“çš„æ—¶å€™æŠŠè‹±æ–‡çš„å­—ä½“å†™åœ¨å‰é¢æŠŠä¸­æ–‡çš„å†™åœ¨åé¢ã€‚è¿™æ ·ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æŒ‰é¡ºåºä¾æ¬¡ç»™å­—ç”¨å­—ä½“ï¼Œå¦‚æœå½“å‰å­—ä½“ä¸æ”¯æŒæ–‡æœ¬ï¼Œè‡ªåŠ¨æ¢ç”¨åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå­—ä½“ã€‚</p><p>ç»è¿‡æµ‹è¯•ï¼ŒIE9ã€IE9å…¼å®¹æ¨¡å¼ï¼ˆå…¼å®¹IE8ï¼‰ã€Chromeæµè§ˆå™¨æœ€æ–°ç‰ˆæœ¬ï¼ˆ34.0ï¼‰ã€ Firefoxæµè§ˆå™¨æœ€æ–°ç‰ˆæœ¬ï¼ˆ29.0ï¼‰æ”¯æŒè¯¥font-familyå±æ€§ï¼›ä½†æ˜¯æŸäº›ç‰ˆæœ¬çš„IEæµè§ˆå™¨ï¼ˆIE7ã€IE8ï¼‰æ— æ³•å®ç°è¯¥font-familyå±æ€§çš„è¦æ±‚ï¼Œè¿˜ä¼šæš´éœ²å‡ºä¸€äº›å¥‡æ€ªçš„ bugã€‚å¦‚åœ¨è¿™äº›ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸‹ä½¿ç”¨ä¸­æ–‡å­—ä½“ï¼ˆæ¯”å¦‚å¾®è½¯é›…é»‘ï¼‰ï¼Œéœ€è¦æŠŠè¯¥ä¸­æ–‡å­—ä½“æ”¾åˆ°font-familyå±æ€§çš„é¦–ä½ï¼Œä½†æ˜¯ä¼šå¯¼è‡´è‹±æ–‡å­—ä½“ä¹Ÿä¼šä½¿ç”¨è¯¥ä¸­ æ–‡å­—ä½“æ¸²æŸ“ã€‚å³åœ¨è¿™äº›æµè§ˆå™¨ï¼ˆIE7ã€IE8ï¼‰ä¸‹ä¸æ”¯æŒåœ¨font-familyå±æ€§ä¸­ä¸ºè‹±æ–‡å’Œä¸­æ–‡å­—ä½“åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„å­—ä½“ã€‚</p><p>æˆ‘æ”¹æˆè¿™æ ·ï¼Œ</p><div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">font</span>: <span class="hljs-number">12</span>px/<span class="hljs-number">25</span>px <span class="hljs-string">&quot;Times New Roman&quot;</span>, <span class="hljs-string">&quot;Microsoft Yahei&quot;</span>, <span class="hljs-string">&quot;Helvetica Neue&quot;</span>, Helvetica, Arial, sans-serif;</code></pre></div><p>ç”¨360å…¼å®¹æ¨¡å¼æµ‹äº†ä¸‹ï¼ŒIE7ï¼Œ8éƒ½æ²¡å‘ç°æ–‡ç« ä¸­è¯´çš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>css</category>
      
    </categories>
    
    
    <tags>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å»æ‰å—çŠ¶å…ƒç´ ä¸imgä¹‹é—´é—´éš™</title>
    <link href="/2015/12/22/7/"/>
    <url>/2015/12/22/7/</url>
    
    <content type="html"><![CDATA[<p>é€ æˆå›¾ç‰‡ä¸å®¹å™¨ä¸‹è¾¹ç•Œæœ‰ç©ºéš™çš„åŸå› </p><p>åœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œ </p><p>å›¾ç‰‡æ–‡å­—ç­‰inlineå…ƒç´ é»˜è®¤æ˜¯å’Œçˆ¶çº§å…ƒç´ çš„baselineå¯¹é½çš„ï¼Œè€Œbaselineåˆå’Œçˆ¶çº§åº•è¾¹æœ‰ä¸€å®šè·ç¦»ï¼ˆè¿™ä¸ªè·ç¦»å’Œ font-sizeï¼Œfont-family ç›¸å…³ï¼Œä¸ä¸€å®šæ˜¯ 3pxï¼‰ï¼Œæ‰€ä»¥è®¾ç½® vertical-align:top/bottom/text-top/text-bottom éƒ½å¯ä»¥é¿å…è¿™ç§æƒ…å†µå‡ºç°ã€‚è€Œä¸”ä¸å…‰liï¼Œå…¶ä»–çš„blockå…ƒç´ ä¸­åŒ…å«imgä¹Ÿä¼šæœ‰è¿™ä¸ªç°è±¡ã€‚ </p><p>åªè¦vertical-alignä¸å–baselineï¼Œè¿™ä¸ªç©ºéš™å°±æ¶ˆå¤±äº†ã€‚</p><p>è¯·çœ‹å¦‚ä¸‹å®ä¾‹(æ³¨æ„::æµ‹è¯•å·¥å…·ï¼šffï¼Œchromeï¼Œ360â€“æ”¯æŒIE7+)</p><div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"></span><span class="css"><span class="hljs-selector-id">#l1</span> &#123;<span class="hljs-attribute">float</span><span class="hljs-selector-pseudo">:left</span>;<span class="hljs-attribute">background</span>:<span class="hljs-number">#000</span>;&#125;</span><span class="css"><span class="hljs-selector-id">#l1</span> <span class="hljs-selector-tag">ul</span> <span class="hljs-selector-tag">li</span> &#123;<span class="hljs-attribute">list-style</span>:none;<span class="hljs-attribute">padding</span>:<span class="hljs-number">0</span>;<span class="hljs-attribute">margin</span>:<span class="hljs-number">0</span>&#125;</span><span class="css"><span class="hljs-selector-tag">img</span> &#123;<span class="hljs-attribute">height</span>:<span class="hljs-number">100px</span>;&#125;</span><span class="css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;l1&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;30-023131_451.jpg&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;30-023131_451.jpg&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;30-023131_451.jpg&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>æˆ‘ä»¬ä¼šå‘ç°liåº•éƒ¨ä¸imgåº•éƒ¨æœ‰é—´éš™ï¼Œso badï¼</p><p>ç¬¬ä¸€ï¼Œç»™å›¾ç‰‡imgæ ‡ç­¾<code>display:block</code>ã€‚</p><p>å…¼å®¹æ€§IE8+ï¼Œfirefoxï¼Œchrome</p><p>ç¬¬äºŒï¼Œå®šä¹‰å®¹å™¨é‡Œçš„å­—ä½“å¤§å°ä¸º0ã€‚font-size:0 </p><p>å…¼å®¹æ€§IE8+ï¼Œfirefoxï¼Œchrome</p><p>ç¬¬ä¸‰ï¼Œå®šä¹‰å›¾ç‰‡imgæ ‡ç­¾<code>vertical-align:bottom</code>ï¼Œ<code>vertical-align:middle</code>ï¼Œ<code>vertical-align:top</code></p><div class="code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">img</span>&#123;<span class="hljs-attribute">vertical-align</span>:bottom&#125;</code></pre></div><p>å…¼å®¹æ€§IE7+ï¼Œfirefoxï¼Œchrome</p><p>ç¬¬å››ï¼Œç»™liåŠ é«˜åº¦</p><p>å…¼å®¹æ€§IE7+ï¼Œfirefoxï¼Œchrome</p><p>æµ‹è¯•å‘ç°ï¼Œç»™imgåŠ <code>vertical-align</code>æ•ˆæœæœ€ä½³</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
